# Prometheus scrape configuration for webhook receiver
#
# Add this job to your prometheus.yml under scrape_configs:
#
# For Kubernetes (using service discovery):
#   scrape_configs:
#     - job_name: 'webhook-receiver'
#       kubernetes_sd_configs:
#         - role: pod
#           namespaces:
#             names:
#               - aos-staging
#       relabel_configs:
#         - source_labels: [__meta_kubernetes_pod_label_app]
#           action: keep
#           regex: webhook-receiver
#         - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
#           action: keep
#           regex: true
#         - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
#           action: replace
#           target_label: __metrics_path__
#           regex: (.+)
#         - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
#           action: replace
#           regex: ([^:]+)(?::\d+)?;(\d+)
#           replacement: $1:$2
#           target_label: __address__
#
# For Docker Compose / static targets:
scrape_configs:
  - job_name: 'webhook-receiver'
    static_configs:
      - targets: ['webhook:80']  # Use 'localhost:8081' for local testing
        labels:
          service: 'webhook-receiver'
          environment: 'staging'
    metrics_path: '/metrics'
    scrape_interval: 15s
    scrape_timeout: 10s

# Alert rules for webhook receiver
# Add to your alerting rules file:
#
# groups:
#   - name: webhook-receiver
#     rules:
#       - alert: WebhookReceiverDown
#         expr: up{job="webhook-receiver"} == 0
#         for: 1m
#         labels:
#           severity: critical
#         annotations:
#           summary: "Webhook receiver is down"
#           description: "Webhook receiver has been down for more than 1 minute"
#
#       - alert: WebhookRateLimitExceeded
#         expr: rate(webhook_rate_limit_exceeded_total[5m]) > 0
#         for: 5m
#         labels:
#           severity: warning
#         annotations:
#           summary: "Webhook rate limit being hit"
#           description: "Rate limiting is being triggered on webhook receiver"
#
#       - alert: WebhookSignatureFailures
#         expr: rate(webhook_signature_failures_total[5m]) > 0.1
#         for: 5m
#         labels:
#           severity: warning
#         annotations:
#           summary: "Webhook signature validation failures"
#           description: "Multiple webhook signature validation failures detected"

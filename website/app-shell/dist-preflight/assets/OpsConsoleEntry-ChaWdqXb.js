import{f,S as N,r as c,j as e,E as g,M as C,aa as A,G as D,b as U,a3 as B,a4 as V,L as I}from"./index-KppIquYQ.js";import{P as H}from"./power-B6cAsbMD.js";import{A as O}from"./activity-DcrdMZEZ.js";import{C as L}from"./chevron-right-D006Lv8J.js";import{D as q}from"./dollar-sign-DZIMmEsu.js";import{M as z}from"./minus-Cx1Vv9o_.js";import{P as Y}from"./play-BzuQk0kl.js";import{R as P}from"./refresh-cw-C5XbiSIu.js";import{S as G}from"./settings-BRUS2Jev.js";import{S as X}from"./shield-DOFc1kEW.js";import{T as Q}from"./trending-down-CrScF46C.js";import{T as W}from"./trending-up-BcE1V9s1.js";import{U as _}from"./users-DcFYHj14.js";import{u as J}from"./useQuery-DRhwJCEf.js";import{l as T}from"./consoleLogger-DP-nEyqn.js";import{B as Z}from"./BetaBanner-DnIHpo0a.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=f("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=f("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=f("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=f("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=f("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=f("Slack",[["rect",{width:"3",height:"8",x:"13",y:"2",rx:"1.5",key:"diqz80"}],["path",{d:"M19 8.5V10h1.5A1.5 1.5 0 1 0 19 8.5",key:"183iwg"}],["rect",{width:"3",height:"8",x:"8",y:"14",rx:"1.5",key:"hqg7r1"}],["path",{d:"M5 15.5V14H3.5A1.5 1.5 0 1 0 5 15.5",key:"76g71w"}],["rect",{width:"8",height:"3",x:"14",y:"13",rx:"1.5",key:"1kmz0a"}],["path",{d:"M15.5 19H14v1.5a1.5 1.5 0 1 0 1.5-1.5",key:"jc4sz0"}],["rect",{width:"8",height:"3",x:"2",y:"8",rx:"1.5",key:"1omvl4"}],["path",{d:"M8.5 5H10V3.5A1.5 1.5 0 1 0 8.5 5",key:"16f3cl"}]]);async function ne(){return(await N.get("/ops/pulse")).data}async function le(){return(await N.get("/ops/infra")).data}async function ie(s=50){return(await N.get("/ops/customers",{params:{limit:s}})).data}async function ce(){return(await N.get("/ops/customers/at-risk")).data}async function de(){return(await N.get("/ops/playbooks")).data}async function oe(){const[s,r,n,t]=await Promise.all([ne().catch(()=>null),le().catch(()=>null),ce().catch(()=>[]),de().catch(()=>[])]);return{pulse:s,infra:r,atRiskCustomers:n,playbooks:t}}const R=15e3;function xe(s){switch(s){case"healthy":return"text-green-400";case"degraded":return"text-yellow-400";case"critical":return"text-red-400";default:return"text-gray-400"}}function me(s){switch(s){case"critical":return"text-red-400 bg-red-900/30";case"high":return"text-yellow-400 bg-yellow-900/30";case"medium":return"text-orange-400 bg-orange-900/30";default:return"text-gray-400 bg-gray-800"}}function F(s){switch(s){case"critical":return"bg-red-500/20 text-red-400 border-red-500/30";case"high":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/30";case"medium":return"bg-orange-500/20 text-orange-400 border-orange-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function M(s){return s>1.1?e.jsx(W,{className:"w-4 h-4 text-green-400"}):s<.9?e.jsx(Q,{className:"w-4 h-4 text-red-400"}):e.jsx(z,{className:"w-4 h-4 text-gray-500"})}function ge(s){switch(s){case"call":return e.jsx(ae,{className:"w-4 h-4"});case"email":return e.jsx(te,{className:"w-4 h-4"});case"slack":return e.jsx(re,{className:"w-4 h-4"});case"feature_flag":return e.jsx(G,{className:"w-4 h-4"});case"policy_adjust":return e.jsx(X,{className:"w-4 h-4"});default:return e.jsx(O,{className:"w-4 h-4"})}}function $(s){return s.substring(0,8)+"..."}function he({pulse:s,infra:r}){var l,i;const n=(s==null?void 0:s.system_state)||"unknown",t=r?(r.db_storage_used_gb/r.db_storage_limit_gb*100).toFixed(1):"0",a=r?(r.redis_memory_used_mb/r.redis_memory_limit_mb*100).toFixed(1):"0";return e.jsx("div",{className:"bg-gray-900 border-b border-gray-800 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:g("w-3 h-3 rounded-full animate-pulse",n==="healthy"?"bg-green-500":n==="degraded"?"bg-yellow-500":"bg-red-500")}),e.jsxs("span",{className:g("font-mono text-sm font-bold",xe(n)),children:["SYSTEM: ",n.toUpperCase()]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(C,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("span",{className:"font-mono text-sm",children:["INCIDENTS: ",e.jsx("span",{className:"text-white",children:(s==null?void 0:s.incidents_created_24h)||0})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(q,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"font-mono text-sm",children:["COST TODAY:"," ",e.jsxs("span",{className:"text-white",children:["$",((s==null?void 0:s.cost_today_usd)||0).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(A,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"font-mono text-sm",children:["p95 LATENCY: ",e.jsxs("span",{className:"text-white",children:[(s==null?void 0:s.latency_p95_ms)||0,"ms"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(ee,{className:"w-4 h-4 text-purple-500"}),e.jsxs("span",{className:"font-mono text-sm",children:["DB:"," ",e.jsxs("span",{className:"text-white",children:[((l=r==null?void 0:r.db_storage_used_gb)==null?void 0:l.toFixed(2))||0," / ",(r==null?void 0:r.db_storage_limit_gb)||0," GB"]}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",t,"%)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(se,{className:"w-4 h-4 text-cyan-500"}),e.jsxs("span",{className:"font-mono text-sm",children:["REDIS:"," ",e.jsxs("span",{className:"text-white",children:[((i=r==null?void 0:r.redis_memory_used_mb)==null?void 0:i.toFixed(0))||0," / ",(r==null?void 0:r.redis_memory_limit_mb)||0," ","MB"]}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",a,"%)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(_,{className:"w-4 h-4 text-orange-500"}),e.jsxs("span",{className:"font-mono text-sm",children:["ACTIVE (24h): ",e.jsx("span",{className:"text-white",children:(s==null?void 0:s.active_tenants_24h)||0})]})]})]})]})})}function ue({customers:s}){const[r,n]=c.useState(null);return s.length===0?e.jsxs("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(C,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"AT-RISK CUSTOMERS"}),e.jsx("span",{className:"ml-auto px-2 py-0.5 rounded-full bg-gray-800 text-gray-400 text-xs font-mono",children:"0"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-900/30 flex items-center justify-center mb-4",children:e.jsx(O,{className:"w-8 h-8 text-green-500"})}),e.jsx("p",{className:"text-gray-400 text-sm",children:"No customers at risk (yet)"}),e.jsx("p",{className:"text-gray-600 text-xs mt-2",children:"System is monitoring for friction patterns"})]})]}):e.jsxs("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(C,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"AT-RISK CUSTOMERS"}),e.jsx("span",{className:g("ml-auto px-2 py-0.5 rounded-full text-xs font-mono",s.length>0?"bg-yellow-900/50 text-yellow-400":"bg-gray-800 text-gray-400"),children:s.length})]}),e.jsx("div",{className:"space-y-4",children:s.map(t=>{const a=r===t.tenant_id;return e.jsxs("div",{className:g("rounded-lg border transition-all cursor-pointer",me(t.risk_level),"hover:border-opacity-100 border-opacity-50"),children:[e.jsx("div",{className:"p-4",onClick:()=>n(a?null:t.tenant_id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g("px-2 py-0.5 rounded text-xs font-bold uppercase border",F(t.risk_level)),children:t.risk_level}),e.jsx("span",{className:"text-white font-mono text-sm",children:t.tenant_name||$(t.tenant_id)})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[M(t.stickiness_delta),e.jsxs("span",{className:"text-gray-400",children:["Stickiness: ",t.stickiness_7d.toFixed(1)," (7d)"]}),e.jsxs("span",{className:"text-gray-600",children:["δ=",t.stickiness_delta.toFixed(2)]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:t.primary_risk_reason}),t.top_friction_type&&e.jsxs("p",{className:"text-gray-500 text-xs",children:["Top friction: ",t.top_friction_type," (",t.friction_count_14d," ","in 14d)"]})]})]}),a?e.jsx(D,{className:"w-5 h-5 text-gray-500"}):e.jsx(L,{className:"w-5 h-5 text-gray-500"})]})}),a&&t.interventions.length>0&&e.jsxs("div",{className:"border-t border-gray-800 p-4 bg-gray-950/50",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-3",children:"Suggested Interventions"}),e.jsx("div",{className:"space-y-3",children:t.interventions.map((l,i)=>e.jsx(pe,{intervention:l},i))})]})]},t.tenant_id)})})]})}function pe({intervention:s}){const r={immediate:"text-red-400 bg-red-900/30",today:"text-yellow-400 bg-yellow-900/30",this_week:"text-blue-400 bg-blue-900/30"};return e.jsxs("div",{className:"bg-gray-900 rounded p-3 border border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[ge(s.intervention_type),e.jsx("span",{className:"text-white text-sm font-medium",children:s.suggested_action}),e.jsx("span",{className:g("ml-auto px-2 py-0.5 rounded text-xs font-bold uppercase",r[s.priority]||"text-gray-400 bg-gray-800"),children:s.priority.replace("_"," ")})]}),e.jsx("p",{className:"text-gray-400 text-xs mb-2",children:s.context}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx("span",{children:"Signals:"}),s.triggering_signals.map((n,t)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-gray-800 rounded text-gray-500",children:n.length>30?n.substring(0,30)+"...":n},t))]})]})}function ye({customers:s}){const[r,n]=c.useState("stickiness"),t=[...s].sort((a,l)=>{switch(r){case"stickiness":return l.current_stickiness-a.current_stickiness;case"friction":return l.friction_score-a.friction_score;case"recent":return new Date(l.last_api_call||0).getTime()-new Date(a.last_api_call||0).getTime();default:return 0}});return s.length===0?e.jsxs("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(_,{className:"w-5 h-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"ALL CUSTOMERS"}),e.jsx("span",{className:"ml-auto px-2 py-0.5 rounded-full bg-gray-800 text-gray-400 text-xs font-mono",children:"0"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center mb-4",children:e.jsx(_,{className:"w-8 h-8 text-gray-600"})}),e.jsx("p",{className:"text-gray-400 text-sm",children:"No customers yet"}),e.jsx("p",{className:"text-gray-600 text-xs mt-2",children:"Customers will appear after API activity"})]})]}):e.jsxs("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-6 h-full overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_,{className:"w-5 h-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"ALL CUSTOMERS"}),e.jsx("span",{className:"ml-auto px-2 py-0.5 rounded-full bg-blue-900/50 text-blue-400 text-xs font-mono",children:s.length})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:()=>n("stickiness"),className:g("px-2 py-1 rounded text-xs font-medium transition-colors",r==="stickiness"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Stickiness"}),e.jsx("button",{onClick:()=>n("friction"),className:g("px-2 py-1 rounded text-xs font-medium transition-colors",r==="friction"?"bg-orange-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Friction"}),e.jsx("button",{onClick:()=>n("recent"),className:g("px-2 py-1 rounded text-xs font-medium transition-colors",r==="recent"?"bg-green-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Recent"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2",children:t.map(a=>e.jsxs("div",{className:"p-3 rounded-lg bg-gray-950 border border-gray-800 hover:border-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white font-mono text-sm",children:a.tenant_name||$(a.tenant_id)}),e.jsxs("div",{className:"flex items-center gap-2",children:[M(a.stickiness_delta),e.jsx("span",{className:g("px-1.5 py-0.5 rounded text-xs font-bold",a.stickiness_trend==="rising"?"bg-green-900/30 text-green-400":a.stickiness_trend==="falling"?"bg-red-900/30 text-red-400":"bg-gray-800 text-gray-400"),children:a.stickiness_trend})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Stickiness"}),e.jsxs("div",{className:"text-white font-mono",children:[a.stickiness_7d.toFixed(1),e.jsxs("span",{className:"text-gray-600 ml-1",children:["/ ",a.stickiness_30d.toFixed(1)]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Friction"}),e.jsx("div",{className:g("font-mono",a.friction_score>20?"text-red-400":a.friction_score>10?"text-yellow-400":"text-green-400"),children:a.friction_score.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Delta"}),e.jsxs("div",{className:g("font-mono",a.stickiness_delta>1.1?"text-green-400":a.stickiness_delta<.9?"text-red-400":"text-gray-400"),children:[a.stickiness_delta.toFixed(2),"x"]})]})]}),a.last_api_call&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Last seen: ",new Date(a.last_api_call).toLocaleString()]})]},a.tenant_id))})]})}function fe({playbooks:s}){const[r,n]=c.useState(null);return s.length===0?e.jsxs("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(E,{className:"w-5 h-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"FOUNDER PLAYBOOKS"})]}),e.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:e.jsx("p",{className:"text-gray-400 text-sm",children:"No playbooks configured"})})]}):e.jsxs("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(E,{className:"w-5 h-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"FOUNDER PLAYBOOKS"}),e.jsx("span",{className:"ml-auto px-2 py-0.5 rounded-full bg-blue-900/50 text-blue-400 text-xs font-mono",children:s.length})]}),e.jsx("div",{className:"space-y-3",children:s.map(t=>{const a=r===t.id;return e.jsxs("div",{className:"rounded-lg border border-gray-800 bg-gray-950/50 overflow-hidden",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-900/50 transition-colors",onClick:()=>n(a?null:t.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:g("px-2 py-0.5 rounded text-xs font-bold uppercase border",F(t.risk_level)),children:t.risk_level}),e.jsx("span",{className:"text-white font-medium",children:t.name})]}),a?e.jsx(D,{className:"w-5 h-5 text-gray-500"}):e.jsx(L,{className:"w-5 h-5 text-gray-500"})]}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:t.description})]}),a&&e.jsxs("div",{className:"border-t border-gray-800 p-4 bg-gray-900/50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"Trigger Conditions"}),e.jsx("div",{className:"space-y-1",children:t.trigger_conditions.map((l,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-yellow-500"}),l]},i))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"Suggested Actions"}),e.jsx("div",{className:"space-y-1",children:t.suggested_actions.map((l,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),l]},i))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"Expected Outcomes"}),e.jsx("div",{className:"space-y-1",children:t.expected_outcomes.map((l,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-400",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),l]},i))})]}),t.requires_approval&&e.jsx("div",{className:"mt-4 px-3 py-2 bg-yellow-900/20 rounded border border-yellow-500/30",children:e.jsx("p",{className:"text-xs text-yellow-400",children:"Requires manual approval before execution"})})]})]},t.id)})})]})}function je(){return e.jsxs("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-6 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Y,{className:"w-5 h-5 text-green-500"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"TIMELINE"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center mb-4",children:e.jsx(A,{className:"w-8 h-8 text-gray-600"})}),e.jsx("p",{className:"text-gray-400 text-sm",children:"No ops_events yet."}),e.jsx("p",{className:"text-gray-600 text-xs mt-2",children:"System is waiting for real activity."})]})]})}function be(){const[s,r]=c.useState(null),[n,t]=c.useState(null),[a,l]=c.useState([]),[i,u]=c.useState([]),[p,m]=c.useState([]),[d,h]=c.useState(!0),[j,y]=c.useState(null),[v,k]=c.useState(null),x=c.useCallback(async()=>{try{const[o,K]=await Promise.all([oe(),ie(50).catch(()=>[])]);r(o.pulse),t(o.infra),l(o.atRiskCustomers),m(o.playbooks),u(K),k(new Date),y(null)}catch(o){y(o instanceof Error?o.message:"Failed to fetch data")}finally{h(!1)}},[]);return c.useEffect(()=>{x()},[x]),c.useEffect(()=>{const o=setInterval(x,R);return()=>clearInterval(o)},[x]),d?e.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col",children:[e.jsx("div",{className:"bg-gray-900 border-b border-gray-800 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("div",{className:"h-4 w-32 bg-gray-800 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-24 bg-gray-800 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-28 bg-gray-800 rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("div",{className:"h-4 w-36 bg-gray-800 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-32 bg-gray-800 rounded animate-pulse"})]})]})}),e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between border-b border-gray-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-7 w-48 bg-gray-800 rounded animate-pulse mb-2"}),e.jsx("div",{className:"h-4 w-64 bg-gray-800 rounded animate-pulse"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("div",{className:"h-8 w-24 bg-gray-800 rounded animate-pulse"})})]}),e.jsx("div",{className:"flex-1 p-6 grid grid-cols-2 grid-rows-2 gap-4",children:[1,2,3,4].map(o=>e.jsxs("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-800 rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-32 bg-gray-800 rounded animate-pulse"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-16 bg-gray-800 rounded animate-pulse"}),e.jsx("div",{className:"h-16 bg-gray-800 rounded animate-pulse"}),e.jsx("div",{className:"h-12 bg-gray-800 rounded animate-pulse"})]})]},o))}),e.jsxs("div",{className:"px-6 py-2 bg-gray-900 border-t border-gray-800 flex items-center justify-between",children:[e.jsx("div",{className:"h-3 w-48 bg-gray-800 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-64 bg-gray-800 rounded animate-pulse"})]})]}):e.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col",children:[e.jsx(he,{pulse:s,infra:n}),e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between border-b border-gray-800",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Founder Ops Console"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"AI Mission Control • Signal-First Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[j&&e.jsx("span",{className:"text-red-400 text-sm",children:j}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:v?`Updated ${v.toLocaleTimeString()}`:"Updating..."})]}),e.jsxs("button",{onClick:x,className:"px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded text-sm text-white flex items-center gap-2 transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex-1 p-6 grid grid-cols-2 grid-rows-2 gap-4",children:[e.jsx(ue,{customers:a}),e.jsx(ye,{customers:i}),e.jsx(fe,{playbooks:p}),e.jsx(je,{})]}),e.jsxs("div",{className:"px-6 py-2 bg-gray-900 border-t border-gray-800 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Polling every ",R/1e3,"s • ",i.length," customers •"," ",a.length," at-risk • ",p.length," playbooks"]}),e.jsxs("span",{children:["Replays (24h): ",(s==null?void 0:s.replays_executed_24h)||0," • Error Rate:"," ",(((s==null?void 0:s.error_rate_24h)||0)*100).toFixed(2),"% • Uptime:"," ",((s==null?void 0:s.uptime_percent)||100).toFixed(2),"%"]})]})]})}function S(s){const n=new Date().getTime()-s.getTime(),t=Math.floor(n/1e3),a=Math.floor(t/60),l=Math.floor(a/60);return t<60?"just now":a<60?`${a}m ago`:l<24?`${l}h ago`:s.toLocaleDateString()}const Ne={stable:{label:"STABLE",color:"text-accent-success",border:"border-accent-success/40",bg:"bg-accent-success/10"},elevated:{label:"ELEVATED",color:"text-accent-warning",border:"border-accent-warning/40",bg:"bg-accent-warning/10"},degraded:{label:"DEGRADED",color:"text-orange-400",border:"border-orange-400/40",bg:"bg-orange-400/10"},critical:{label:"CRITICAL",color:"text-accent-danger",border:"border-accent-danger/40",bg:"bg-accent-danger/10"}},ve={low:"text-slate-400",medium:"text-accent-warning",high:"text-orange-400",critical:"text-accent-danger"},we={success:"text-accent-success",warning:"text-accent-warning",failure:"text-accent-danger"};async function _e(){const s="",r=localStorage.getItem("guard-console-api-key")||"";try{const m=await fetch(`${s}/ops/pulse`,{headers:{"X-API-Key":r}});if(m.ok)return await m.json()}catch{}const[n,t,a]=await Promise.allSettled([fetch(`${s}/ops/infra`,{headers:{"X-API-Key":r}}),fetch(`${s}/ops/customers`,{headers:{"X-API-Key":r}}),fetch(`${s}/guard/incidents?limit=5`,{headers:{"X-API-Key":r}})]);let l="stable",i=0;const u=[],p=[];if(t.status==="fulfilled"&&t.value.ok){const m=await t.value.json();Array.isArray(m)&&m.filter(d=>d.incidents_24h>0||d.spend_delta_percent>50).slice(0,5).forEach(d=>{u.push({tenant_id:d.tenant_id,tenant_name:d.tenant_name||d.tenant_id,risk_score:Math.min(100,(d.incidents_24h||0)*10+(d.spend_delta_percent||0)),primary_concern:d.incidents_24h>0?"High incident rate":"Cost anomaly",incidents_24h:d.incidents_24h||0})})}if(a.status==="fulfilled"&&a.value.ok){const m=await a.value.json(),d=m.items||m||[];i=d.length,d.slice(0,5).forEach(h=>{p.push({id:h.id,tenant_id:h.tenant_id,severity:h.severity||"medium",message:h.summary||h.message||"Incident detected",timestamp:h.created_at||new Date().toISOString()})})}return i>5||u.length>3?l="critical":i>2||u.length>1?l="degraded":(i>0||u.length>0)&&(l="elevated"),{status:l,signals:{active_incidents:i,cost_anomaly_tenants:u.filter(m=>m.primary_concern==="Cost anomaly").length,policy_drift:0,infra_health:98},tenants_at_risk:u.sort((m,d)=>d.risk_score-m.risk_score),incident_stream:p,cost_watch:[],recent_actions:[{id:"1",action:"Policy enforcement",target:"Global",timestamp:new Date().toISOString(),outcome:"success"},{id:"2",action:"Rate limit applied",target:"tenant_xyz",timestamp:new Date().toISOString(),outcome:"success"}]}}function ke(){c.useEffect(()=>(T.componentMount("FounderPulsePage"),()=>T.componentUnmount("FounderPulsePage")),[]);const{data:s,isLoading:r}=J({queryKey:["ops","pulse"],queryFn:_e,refetchInterval:1e4,staleTime:5e3});if(r||!s)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-slate-400",children:"Loading pulse data..."})});const n=Ne[s.status];return e.jsxs("div",{className:"p-6 h-full overflow-auto bg-navy-app",children:[e.jsxs("div",{className:`
        flex items-center justify-between p-4 rounded-xl mb-6
        bg-navy-surface border ${n.border}
      `,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`
            w-4 h-4 rounded-full animate-pulse
            ${n.bg}
          `}),e.jsx("span",{className:`text-2xl font-bold ${n.color}`,children:n.label}),e.jsx("span",{className:"text-slate-400 text-sm",children:"System Status"})]}),e.jsxs("span",{className:"text-slate-500 text-xs",children:["Read-only view • Last updated ",S(new Date)]})]}),e.jsx("h2",{className:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3",children:"Critical Signals"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsx(w,{label:"Active Incidents",value:s.signals.active_incidents,status:s.signals.active_incidents>3?"danger":s.signals.active_incidents>0?"warning":"success"}),e.jsx(w,{label:"Cost Anomaly Tenants",value:s.signals.cost_anomaly_tenants,status:s.signals.cost_anomaly_tenants>2?"danger":s.signals.cost_anomaly_tenants>0?"warning":"success"}),e.jsx(w,{label:"Policy Drift",value:s.signals.policy_drift,status:s.signals.policy_drift>5?"danger":s.signals.policy_drift>0?"warning":"success"}),e.jsx(w,{label:"Infra Health",value:`${s.signals.infra_health}%`,status:s.signals.infra_health<80?"danger":s.signals.infra_health<95?"warning":"success"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3",children:"Live Feeds"}),e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-4 mb-4",children:[e.jsx("h3",{className:"text-xs font-medium text-slate-500 mb-3",children:"INCIDENT STREAM"}),s.incident_stream.length>0?e.jsx("ul",{className:"space-y-2",children:s.incident_stream.map(t=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:`w-2 h-2 rounded-full mt-1.5 bg-current ${ve[t.severity]}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-white truncate block",children:t.message}),e.jsx("span",{className:"text-slate-500 text-xs",children:t.tenant_id})]}),e.jsx("span",{className:"text-slate-500 text-xs whitespace-nowrap",children:S(new Date(t.timestamp))})]},t.id))}):e.jsx("p",{className:"text-slate-500 text-sm text-center py-4",children:"No active incidents"})]}),e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-slate-500 mb-3",children:"COST WATCH"}),s.cost_watch.length>0?e.jsx("ul",{className:"space-y-2",children:s.cost_watch.map(t=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:`
                      ${t.delta_percent>50?"text-accent-danger":"text-accent-warning"}
                    `,children:[t.delta_percent>0?"+":"",t.delta_percent,"%"]}),e.jsx("span",{className:"text-slate-400",children:t.tenant_id}),e.jsxs("span",{className:"text-slate-500 text-xs ml-auto",children:["$",t.current_spend.toFixed(2)]})]},t.id))}):e.jsx("p",{className:"text-slate-500 text-sm text-center py-4",children:"No cost anomalies"})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3",children:"Tenants at Risk"}),e.jsx("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-4 mb-4",children:s.tenants_at_risk.length>0?e.jsx("ul",{className:"space-y-3",children:s.tenants_at_risk.map((t,a)=>e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-slate-500 text-xs w-4",children:[a+1,"."]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-white font-medium block truncate",children:t.tenant_name}),e.jsx("span",{className:"text-slate-500 text-xs",children:t.primary_concern})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`
                        text-sm font-medium
                        ${t.risk_score>70?"text-accent-danger":t.risk_score>40?"text-accent-warning":"text-slate-400"}
                      `,children:t.risk_score}),e.jsxs("div",{className:"text-xs text-slate-500",children:[t.incidents_24h," incidents"]})]})]},t.tenant_id))}):e.jsx("p",{className:"text-accent-success text-sm text-center py-4",children:"No tenants at risk"})}),e.jsx("h2",{className:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3",children:"Recent System Actions"}),e.jsx("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-4",children:e.jsx("ul",{className:"space-y-2",children:s.recent_actions.map(t=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full bg-current ${we[t.outcome]}`}),e.jsx("span",{className:"text-white",children:t.action}),e.jsxs("span",{className:"text-slate-500",children:["→ ",t.target]}),e.jsx("span",{className:"text-slate-500 text-xs ml-auto",children:S(new Date(t.timestamp))})]},t.id))})})]})]})]})}function w({label:s,value:r,status:n}){const t={success:"text-accent-success border-accent-success/30",warning:"text-accent-warning border-accent-warning/30",danger:"text-accent-danger border-accent-danger/30"};return e.jsxs("div",{className:`
      bg-navy-surface border rounded-xl p-4
      ${t[n]}
    `,children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:s}),e.jsx("div",{className:`text-2xl font-bold ${t[n].split(" ")[0]}`,children:r})]})}const Se=new V({defaultOptions:{queries:{staleTime:5e3,retry:2}}}),Ce="",b="ops-console-api-key";function He(){const[s]=U(),[r,n]=c.useState(""),[t,a]=c.useState(""),[l,i]=c.useState(!1),[u,p]=c.useState(""),[m,d]=c.useState(!1),[h,j]=c.useState("pulse");c.useEffect(()=>{const x=s.get("key"),o=localStorage.getItem(b);x?y(x):o&&y(o)},[s]);const y=async x=>{if(x.trim()){i(!0),p("");try{const o=await fetch(`${Ce}/ops/pulse`,{headers:{"X-API-Key":x}});o.ok?(n(x),d(!0),localStorage.setItem(b,x),s.get("key")&&window.history.replaceState({},"",window.location.pathname)):o.status===401||o.status===403?(p("Invalid API key or insufficient permissions"),localStorage.removeItem(b)):(p("Failed to connect to Ops API"),localStorage.removeItem(b))}catch{p("Failed to connect to server")}finally{i(!1)}}},v=x=>{x.preventDefault(),y(t)},k=()=>{n(""),d(!1),localStorage.removeItem(b)};return m?e.jsxs(B,{client:Se,children:[e.jsx(Z,{}),e.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col",children:[e.jsxs("div",{className:"bg-gray-900 border-b border-gray-800 px-6 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"F"})}),e.jsx("span",{className:"text-white font-semibold",children:"Founder Ops"})]}),e.jsxs("div",{className:"flex gap-1 bg-gray-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>j("pulse"),className:`
                  px-4 py-1.5 rounded-md text-sm font-medium transition-colors
                  ${h==="pulse"?"bg-emerald-500 text-white":"text-gray-400 hover:text-white"}
                `,children:"Pulse"}),e.jsx("button",{onClick:()=>j("console"),className:`
                  px-4 py-1.5 rounded-md text-sm font-medium transition-colors
                  ${h==="console"?"bg-emerald-500 text-white":"text-gray-400 hover:text-white"}
                `,children:"Console"})]}),e.jsxs("div",{className:"flex items-center gap-3 border-l border-gray-700 pl-4 ml-2",children:[e.jsxs(I,{to:"/founder/timeline",className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-gray-400 hover:text-white hover:bg-gray-800 rounded-md transition-colors",children:[e.jsx(A,{className:"w-4 h-4"}),"Timeline"]}),e.jsxs(I,{to:"/founder/controls",className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-gray-400 hover:text-white hover:bg-gray-800 rounded-md transition-colors",children:[e.jsx(H,{className:"w-4 h-4"}),"Controls"]})]})]}),e.jsx("button",{onClick:k,className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Logout"})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:h==="pulse"?e.jsx(ke,{}):e.jsx(be,{})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-950 p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-emerald-500 rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})})}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Founder Ops Console"}),e.jsx("p",{className:"text-gray-400 mt-2",children:"AI Mission Control - System health & customer intelligence"})]}),e.jsxs("div",{className:"bg-gray-900 rounded-xl p-6 border border-gray-800",children:[e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Ops API Key"}),e.jsx("input",{type:"password",value:t,onChange:x=>a(x.target.value),placeholder:"Enter your Ops API key",className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",autoFocus:!0,disabled:l})]}),u&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm",children:u}),e.jsx("button",{type:"submit",disabled:l||!t.trim(),className:"w-full py-3 bg-emerald-500 hover:bg-emerald-600 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:l?"Connecting...":"Connect to Ops Console"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-800",children:e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["This console is for founders and operators only.",e.jsx("br",{}),"Requires Ops-level API key access."]})})]})]})})}export{He as default};

import{f as N,r as c,j as e,ag as b,aa as B,a1 as H,Z as I,X as _e,M as U,K as Re,aj as Le,b as Ae,ah as Te,ak as $e,al as Oe,am as Ie,G as De}from"./index-KppIquYQ.js";import{l as O}from"./consoleLogger-DP-nEyqn.js";import{A as Fe}from"./arrow-left-DrPQYbfI.js";import{D as ie}from"./download-BDZ1ttH3.js";import{F as M}from"./file-text-kHBdGibj.js";import{H as ze}from"./hash-BExlLTdf.js";import{S as We,H as Je}from"./sparkles-3rmWFwB2.js";import{L as oe}from"./loader-2-Bq2xiA3F.js";import{P as Pe}from"./play-BzuQk0kl.js";import{R as se}from"./refresh-cw-C5XbiSIu.js";import{G as Be,R as He}from"./rotate-ccw-DFBiDqqr.js";import{Z as ce}from"./zap-DEPEK6eb.js";import{S as V}from"./shield-DOFc1kEW.js";import{T as Ue}from"./trending-up-BcE1V9s1.js";import{T as Ve}from"./trending-down-CrScF46C.js";import{C as xe}from"./code-DZlAfOL0.js";import{E as ae}from"./eye-BJuEv1DK.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=N("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=N("FileCode",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=N("FileJson",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=N("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=N("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=N("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=N("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=N("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=N("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=N("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=N("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=N("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),re={status:"idle",stages:[],logs:[],artifacts:[],routingDecisions:[],driftEvents:[],policyEvents:[],progress:0};function at(t,r={}){const[s,i]=c.useState(re),[n,m]=c.useState(!1),x=c.useRef(null),u=c.useRef(r);c.useEffect(()=>{u.current=r},[r]);const l=c.useCallback(()=>{i(re),m(!1),x.current&&(x.current.close(),x.current=null)},[]);return c.useEffect(()=>{if(!t){l();return}i(o=>({...o,status:"connecting",run_id:t}));const f=new EventSource(`/api/v1/workers/business-builder/stream/${t}`);return x.current=f,f.onopen=()=>{m(!0),i(o=>({...o,status:"connected"}))},f.onerror=()=>{i(o=>o.status==="completed"?o:{...o,status:"error",error:"Connection lost"}),m(!1)},f.addEventListener("stage",o=>{var g,k;const p=JSON.parse(o.data);i(h=>{const y=[...h.stages],j=y.findIndex(w=>w.id===p.id);return j>=0?y[j]=p:y.push(p),{...h,stages:y}}),(k=(g=u.current).onStageChange)==null||k.call(g,p)}),f.addEventListener("log",o=>{const p=JSON.parse(o.data);i(g=>({...g,logs:[...g.logs,p]}))}),f.addEventListener("artifact",o=>{var g,k;const p=JSON.parse(o.data);i(h=>({...h,artifacts:[...h.artifacts,p]})),(k=(g=u.current).onArtifact)==null||k.call(g,p)}),f.addEventListener("routing",o=>{const p=JSON.parse(o.data);i(g=>({...g,routingDecisions:[...g.routingDecisions,p]}))}),f.addEventListener("drift",o=>{const p=JSON.parse(o.data);i(g=>({...g,driftEvents:[...g.driftEvents,p]}))}),f.addEventListener("policy",o=>{const p=JSON.parse(o.data);i(g=>({...g,policyEvents:[...g.policyEvents,p]}))}),f.addEventListener("progress",o=>{const p=JSON.parse(o.data);i(g=>({...g,progress:p.progress}))}),f.addEventListener("complete",o=>{var g,k;const p=JSON.parse(o.data);i(h=>({...h,status:"completed",error:p.error,progress:100})),f.close(),m(!1),(k=(g=u.current).onComplete)==null||k.call(g,p.success)}),f.addEventListener("error_event",o=>{var g,k;const p=JSON.parse(o.data);i(h=>({...h,status:"error",error:p.error})),(k=(g=u.current).onError)==null||k.call(g,p.error)}),()=>{f.close(),x.current=null}},[t,l]),{state:s,isConnected:n,reset:l}}const rt=({status:t})=>{switch(t){case"completed":return e.jsx(I,{className:"w-5 h-5 text-green-500"});case"failed":return e.jsx(H,{className:"w-5 h-5 text-red-500"});case"running":return e.jsx(oe,{className:"w-5 h-5 text-blue-500 animate-spin"});case"recovered":return e.jsx(me,{className:"w-5 h-5 text-yellow-500"});case"pending":default:return e.jsx(B,{className:"w-5 h-5 text-gray-400"})}},nt=({status:t})=>{const r={pending:"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400",running:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",completed:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",failed:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",recovered:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300"};return e.jsx("span",{className:b("px-2 py-0.5 text-xs font-medium rounded-full",r[t]),children:t.charAt(0).toUpperCase()+t.slice(1)})};function lt({stages:t,currentStageIndex:r}){return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Execution Timeline"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:r<t.length?`Stage ${r+1} of ${t.length}`:"All stages completed"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"space-y-1",children:t.map((s,i)=>e.jsxs("div",{className:b("relative flex items-start gap-3 p-3 rounded-lg transition-colors",s.status==="running"&&"bg-blue-50 dark:bg-blue-900/20",s.status==="failed"&&"bg-red-50 dark:bg-red-900/20",s.status==="recovered"&&"bg-yellow-50 dark:bg-yellow-900/20"),children:[i<t.length-1&&e.jsx("div",{className:b("absolute left-[22px] top-10 w-0.5 h-[calc(100%-16px)]",s.status==="completed"||s.status==="recovered"?"bg-green-300 dark:bg-green-700":"bg-gray-200 dark:bg-gray-700")}),e.jsx("div",{className:"flex-shrink-0 z-10",children:e.jsx(rt,{status:s.status})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900 dark:text-white",children:s.name}),e.jsx(nt,{status:s.status})]}),s.agent&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Agent: ",e.jsx("span",{className:"font-mono",children:s.agent})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500 dark:text-gray-400",children:[s.duration_ms!==void 0&&e.jsxs("span",{children:[s.duration_ms.toFixed(0),"ms"]}),s.tokens!==void 0&&e.jsxs("span",{children:[s.tokens," tokens"]}),s.drift_score!==void 0&&e.jsxs("span",{className:b(s.drift_score<.2?"text-green-600":s.drift_score<.35?"text-yellow-600":"text-red-600"),children:["Drift: ",(s.drift_score*100).toFixed(0),"%"]})]}),s.error&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:s.error})]})]},s.id))})})]})}const dt=({level:t})=>{switch(t){case"error":return e.jsx(Re,{className:"w-3.5 h-3.5 text-red-500"});case"warning":return e.jsx(U,{className:"w-3.5 h-3.5 text-yellow-500"});case"debug":return e.jsx(Ge,{className:"w-3.5 h-3.5 text-gray-400"});case"info":default:return e.jsx(_e,{className:"w-3.5 h-3.5 text-blue-500"})}},it={debug:"text-gray-400",info:"text-blue-400",warning:"text-yellow-400",error:"text-red-400"},ot={M9:"text-orange-400",M10:"text-green-400",M17:"text-purple-400",M18:"text-pink-400",M19:"text-cyan-400",M20:"text-indigo-400",preflight_agent_v1:"text-gray-400",research_agent_v1:"text-blue-400",strategy_agent_v1:"text-purple-400",copy_agent_v1:"text-green-400",ux_agent_v1:"text-pink-400",consistency_agent_v1:"text-yellow-400",recovery_agent_v1:"text-orange-400",bundle_agent_v1:"text-cyan-400"};function ct({logs:t,autoScroll:r=!0}){const s=c.useRef(null),i=c.useRef(null);return c.useEffect(()=>{r&&i.current&&i.current.scrollIntoView({behavior:"smooth"})},[t,r]),e.jsxs("div",{className:"h-full flex flex-col bg-gray-900 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 bg-gray-800 flex items-center gap-2 border-b border-gray-700",children:[e.jsx(st,{className:"w-4 h-4 text-green-400"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Live Log Stream"}),e.jsxs("span",{className:"text-xs text-gray-400 ml-auto",children:[t.length," events"]})]}),e.jsxs("div",{ref:s,className:"flex-1 overflow-y-auto p-3 font-mono text-xs",children:[t.length===0?e.jsx("div",{className:"text-gray-500 text-center py-8",children:"Waiting for logs..."}):e.jsx("div",{className:"space-y-1",children:t.map((n,m)=>e.jsxs("div",{className:b("flex items-start gap-2 py-1 px-2 rounded hover:bg-gray-800/50",n.level==="error"&&"bg-red-900/20",n.level==="warning"&&"bg-yellow-900/20"),children:[e.jsx(dt,{level:n.level}),e.jsxs("span",{className:b("flex-shrink-0",it[n.level]),children:["[",n.level.toUpperCase().padEnd(5),"]"]}),e.jsxs("span",{className:b("flex-shrink-0",ot[n.agent]||"text-gray-400"),children:["[",n.agent,"]"]}),e.jsx("span",{className:"text-gray-200 break-words",children:n.message})]},m))}),e.jsx("div",{ref:i})]}),e.jsxs("div",{className:"px-4 py-1.5 bg-gray-800 border-t border-gray-700 flex items-center gap-4 text-xs text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),"Streaming"]}),e.jsxs("span",{children:["Errors: ",t.filter(n=>n.level==="error").length]}),e.jsxs("span",{children:["Warnings: ",t.filter(n=>n.level==="warning").length]})]})]})}function ne({value:t}){const r=Math.min(100,Math.max(0,t*100)),s=t<.4?"bg-green-500":t<.7?"bg-yellow-500":"bg-red-500";return e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:b("h-full transition-all duration-500",s),style:{width:`${r}%`}})})}function xt({value:t}){const r=t>=.8?"text-green-600 bg-green-100 dark:bg-green-900/30":t>=.6?"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/30":"text-red-600 bg-red-100 dark:bg-red-900/30";return e.jsxs("span",{className:b("px-2 py-0.5 text-xs font-medium rounded",r),children:[(t*100).toFixed(0),"% conf"]})}function gt({routingDecisions:t,driftEvents:r,artifacts:s}){c.useEffect(()=>(O.componentMount("RoutingDashboard"),()=>O.componentUnmount("RoutingDashboard")),[]);const i=t.slice(-4),n=t.length>0?t.reduce((x,u)=>x+u.complexity,0)/t.length:0,m=r.length>0?r.reduce((x,u)=>x+u.drift_score,0)/r.length:0;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-purple-500"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"CARE Routing Dashboard"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"M17 Complexity-Aware Routing Engine"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ce,{className:"w-3.5 h-3.5 text-yellow-500"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Avg Complexity"})]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[(n*100).toFixed(0),"%"]}),e.jsx(ne,{value:n})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ue,{className:"w-3.5 h-3.5 text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Avg Drift"})]}),e.jsxs("div",{className:b("text-lg font-semibold",m<.2?"text-green-600":m<.35?"text-yellow-600":"text-red-600"),children:[(m*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{className:"w-3.5 h-3.5 text-green-500"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Artifacts"})]}),e.jsx("div",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s.length})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wide",children:"Recent Routing Decisions"}),i.length===0?e.jsx("div",{className:"text-sm text-gray-400 text-center py-4",children:"No routing decisions yet"}):e.jsx("div",{className:"space-y-2",children:i.map((x,u)=>e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white capitalize",children:x.stage_id.replace("_"," ")}),e.jsx(xt,{value:x.confidence})]}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-2",children:["Selected:"," ",e.jsx("span",{className:"font-mono text-purple-600 dark:text-purple-400",children:x.selected_agent})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Complexity:"}),e.jsx("div",{className:"flex-1",children:e.jsx(ne,{value:x.complexity})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(x.complexity*100).toFixed(0),"%"]})]}),x.alternatives&&x.alternatives.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:["Alternatives: ",x.alternatives.join(", ")]})]},u))})]}),r.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wide",children:"Drift Detection (M18)"}),e.jsx("div",{className:"space-y-2",children:r.map((x,u)=>e.jsxs("div",{className:b("p-2 rounded-lg text-xs flex items-center justify-between",x.aligned?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300"),children:[e.jsx("span",{className:"capitalize",children:x.stage_id}),e.jsxs("span",{children:[(x.drift_score*100).toFixed(0),"% (threshold:"," ",(x.threshold*100).toFixed(0),"%)"]})]},u))})]}),s.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wide",children:"Generated Artifacts"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map((x,u)=>e.jsxs("span",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs rounded-full",children:[x.artifact_name,".",x.artifact_type]},u))})]})]})]})}const mt={M9:e.jsx(U,{className:"w-4 h-4 text-orange-500"}),M10:e.jsx(me,{className:"w-4 h-4 text-green-500"}),M19:e.jsx(V,{className:"w-4 h-4 text-purple-500"}),M18:e.jsx(Ve,{className:"w-4 h-4 text-pink-500"})},le={failure:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-300"},recovery:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-300"},policy:{bg:"bg-purple-100 dark:bg-purple-900/30",text:"text-purple-700 dark:text-purple-300"},drift:{bg:"bg-pink-100 dark:bg-pink-900/30",text:"text-pink-700 dark:text-pink-300"}};function pt({status:t}){switch(t){case"success":return e.jsx(I,{className:"w-4 h-4 text-green-500"});case"error":return e.jsx(H,{className:"w-4 h-4 text-red-500"});case"warning":return e.jsx(U,{className:"w-4 h-4 text-yellow-500"});default:return e.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-500"})}}function ht({policyEvents:t,driftEvents:r,recoveries:s,logs:i}){const n=[];i.filter(l=>l.agent==="M9"||l.message.includes("Failure pattern")).forEach(l=>{n.push({type:"failure",engine:"M9",description:l.message,status:"warning",stage:l.stage_id})}),s.forEach(l=>{n.push({type:"recovery",engine:"M10",description:`Recovery applied: ${l.recovery}`,status:"success",stage:l.stage})}),t.forEach(l=>{n.push({type:"policy",engine:"M19",description:l.passed?`Policy passed: ${l.policy}`:`Policy violation: ${l.policy} - ${l.reason||"No reason provided"}`,status:l.passed?"success":"error",stage:l.stage_id})}),r.forEach(l=>{n.push({type:"drift",engine:"M18",description:`Drift ${l.aligned?"within":"exceeded"} threshold: ${(l.drift_score*100).toFixed(0)}% (max ${(l.threshold*100).toFixed(0)}%)`,status:l.aligned?"info":"warning",stage:l.stage_id})});const m={failures:n.filter(l=>l.type==="failure").length,recoveries:n.filter(l=>l.type==="recovery").length,policies:n.filter(l=>l.type==="policy").length,drifts:n.filter(l=>l.type==="drift").length},x=t.filter(l=>l.passed).length,u=t.filter(l=>!l.passed).length;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-purple-500"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Failures, Policies & Recovery"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"M9 Failures â€¢ M10 Recovery â€¢ M18 Drift â€¢ M19 Policy"})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"p-2 bg-red-50 dark:bg-red-900/20 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:m.failures}),e.jsx("div",{className:"text-xs text-red-500 dark:text-red-400",children:"Failures"})]}),e.jsxs("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:m.recoveries}),e.jsx("div",{className:"text-xs text-green-500 dark:text-green-400",children:"Recovered"})]}),e.jsxs("div",{className:"p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:[x,"/",x+u]}),e.jsx("div",{className:"text-xs text-purple-500 dark:text-purple-400",children:"Policies"})]}),e.jsxs("div",{className:"p-2 bg-pink-50 dark:bg-pink-900/20 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-pink-600 dark:text-pink-400",children:m.drifts}),e.jsx("div",{className:"text-xs text-pink-500 dark:text-pink-400",children:"Drift Checks"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:n.length===0?e.jsx("div",{className:"text-sm text-gray-400 text-center py-8",children:"No events recorded yet"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Event"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Engine"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Description"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:n.map((l,f)=>e.jsxs("tr",{className:b("hover:bg-gray-50 dark:hover:bg-gray-800/50",l.status==="error"&&"bg-red-50/50 dark:bg-red-900/10"),children:[e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{status:l.status}),e.jsx("span",{className:b("px-2 py-0.5 text-xs font-medium rounded-full capitalize",le[l.type].bg,le[l.type].text),children:l.type})]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[mt[l.engine],e.jsx("span",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:l.engine})]})}),e.jsxs("td",{className:"px-4 py-2",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:l.description}),l.stage&&e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:["Stage: ",l.stage]})]})]},f))})]})}),e.jsx("div",{className:"px-4 py-2 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Total Events: ",n.length]}),m.failures>0&&m.recoveries>0&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Recovery Rate: ",(m.recoveries/m.failures*100).toFixed(0),"%"]}),u>0&&e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:[u," policy violation",u>1?"s":""]})]})})]})}const ut={html:e.jsx(Be,{className:"w-4 h-4"}),md:e.jsx(M,{className:"w-4 h-4"}),json:e.jsx(ge,{className:"w-4 h-4"}),txt:e.jsx(M,{className:"w-4 h-4"}),css:e.jsx(qe,{className:"w-4 h-4"}),js:e.jsx(xe,{className:"w-4 h-4"})},yt={html:"text-orange-500 bg-orange-100 dark:bg-orange-900/30",md:"text-blue-500 bg-blue-100 dark:bg-blue-900/30",json:"text-yellow-500 bg-yellow-100 dark:bg-yellow-900/30",txt:"text-gray-500 bg-gray-100 dark:bg-gray-700",css:"text-pink-500 bg-pink-100 dark:bg-pink-900/30",js:"text-green-500 bg-green-100 dark:bg-green-900/30"};function bt({content:t}){const r=t.split(`
`);return e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:r.map((s,i)=>{if(s.startsWith("### "))return e.jsx("h3",{className:"text-lg font-semibold mt-4 mb-2",children:s.slice(4)},i);if(s.startsWith("## "))return e.jsx("h2",{className:"text-xl font-bold mt-6 mb-3",children:s.slice(3)},i);if(s.startsWith("# "))return e.jsx("h1",{className:"text-2xl font-bold mt-6 mb-4",children:s.slice(2)},i);if(s.startsWith("- ")||s.startsWith("* "))return e.jsx("li",{className:"ml-4",children:s.slice(2)},i);if(/^\d+\. /.test(s))return e.jsx("li",{className:"ml-4 list-decimal",children:s.replace(/^\d+\. /,"")},i);if(s.startsWith("```"))return null;if(s.includes("**")){const n=s.split("**");return e.jsx("p",{className:"my-1",children:n.map((m,x)=>x%2===1?e.jsx("strong",{children:m},x):m)},i)}return s.trim()?e.jsx("p",{className:"my-1",children:s},i):e.jsx("br",{},i)})})}function ft({content:t}){const r=c.useRef(null);return c.useEffect(()=>{if(r.current){const s=r.current.contentDocument;s&&(s.open(),s.write(t),s.close())}},[t]),e.jsx("iframe",{ref:r,className:"w-full h-full border-0 bg-white",sandbox:"allow-same-origin allow-scripts",title:"HTML Preview"})}function kt({content:t}){let r=t;try{const s=JSON.parse(t);r=JSON.stringify(s,null,2)}catch{}return e.jsx("pre",{className:"text-xs font-mono overflow-auto p-4 bg-gray-900 text-gray-100 rounded",children:e.jsx("code",{children:r})})}function de({content:t,language:r}){return e.jsx("pre",{className:"text-xs font-mono overflow-auto p-4 bg-gray-900 text-gray-100 rounded",children:e.jsx("code",{className:`language-${r}`,children:t})})}function jt({artifacts:t,artifactContents:r,isExpanded:s=!1,onToggleExpand:i}){const[n,m]=c.useState(null),[x,u]=c.useState("preview"),[l,f]=c.useState(!1);c.useEffect(()=>{if(t.length>0&&!n){const h=`${t[0].artifact_name}.${t[0].artifact_type}`;m(h)}},[t,n]),c.useEffect(()=>{if(t.length>0){const h=t[t.length-1],y=`${h.artifact_name}.${h.artifact_type}`;r[y]&&m(y)}},[t.length,r]);const o=n?r[n]:null,p=async()=>{o&&(await navigator.clipboard.writeText(o.content),f(!0),setTimeout(()=>f(!1),2e3))},g=()=>{if(o){const h=new Blob([o.content],{type:"text/plain"}),y=URL.createObjectURL(h),j=document.createElement("a");j.href=y,j.download=n||"artifact.txt",j.click(),URL.revokeObjectURL(y)}},k=()=>{if(!o)return e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Select an artifact to preview"})]})});if(x==="source")return e.jsx(de,{content:o.content,language:o.type});switch(o.type){case"html":return e.jsx(ft,{content:o.content});case"md":return e.jsx("div",{className:"p-4 overflow-auto h-full",children:e.jsx(bt,{content:o.content})});case"json":return e.jsx(kt,{content:o.content});default:return e.jsx(de,{content:o.content,language:o.type})}};return e.jsxs("div",{className:b("h-full flex flex-col bg-white dark:bg-gray-800 rounded-lg overflow-hidden",s&&"fixed inset-4 z-50 shadow-2xl"),children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-cyan-500"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Artifact Preview"}),t.length>0&&e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 rounded-full",children:[t.length," ",t.length===1?"artifact":"artifacts"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(x==="preview"?"source":"preview"),className:b("p-1.5 rounded text-xs flex items-center gap-1",x==="source"?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"),title:x==="preview"?"View Source":"View Preview",children:x==="preview"?e.jsx(xe,{className:"w-3.5 h-3.5"}):e.jsx(ae,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:p,className:"p-1.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600",title:"Copy to clipboard",children:l?e.jsx(I,{className:"w-3.5 h-3.5 text-green-500"}):e.jsx(Le,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:g,className:"p-1.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600",title:"Download",children:e.jsx(ie,{className:"w-3.5 h-3.5"})})]}),i&&e.jsx("button",{onClick:i,className:"p-1.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600",title:s?"Minimize":"Maximize",children:s?e.jsx(Xe,{className:"w-3.5 h-3.5"}):e.jsx(Ze,{className:"w-3.5 h-3.5"})})]})]}),t.length>0&&e.jsx("div",{className:"px-4 py-2 border-b border-gray-200 dark:border-gray-700 overflow-x-auto",children:e.jsx("div",{className:"flex items-center gap-2",children:t.map(h=>{const y=`${h.artifact_name}.${h.artifact_type}`,j=!!r[y];return e.jsxs("button",{onClick:()=>j&&m(y),className:b("flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors whitespace-nowrap",n===y?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300":j?"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600":"bg-gray-50 dark:bg-gray-800 text-gray-400 dark:text-gray-500 animate-pulse"),disabled:!j,children:[e.jsx("span",{className:b("p-0.5 rounded",yt[h.artifact_type]||"bg-gray-200"),children:ut[h.artifact_type]||e.jsx(M,{className:"w-3 h-3"})}),h.artifact_name,!j&&e.jsx("span",{className:"text-xs",children:"(loading...)"})]},y)})})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:t.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(vt,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Artifacts will appear here as they are generated"}),e.jsx("p",{className:"text-xs mt-1 text-gray-500",children:"Watch the magic happen in real-time"})]})}):k()}),o&&e.jsxs("div",{className:"px-4 py-2 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Stage: ",e.jsx("span",{className:"font-medium",children:o.stage_id})]}),e.jsxs("span",{children:[o.content.length.toLocaleString()," characters"]})]})]})}function vt({className:t}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})})}const C=(t,r,s)=>{{const i=new Date().toISOString().split("T")[1].slice(0,12);console.log(`%c[${i}] [CONSOLE-UI] [${t}]`,"color: #f59e0b; font-weight: bold",r,s??"")}},P=[{id:"business-builder",name:"Business Builder",description:"Generate landing pages, copy, positioning",status:"available",moats:["M9","M10","M15","M17","M18","M19","M20"]},{id:"code-debugger",name:"Code Debugger",description:"Analyze and fix code issues",status:"coming_soon",moats:["M9","M10","M17","M19"]},{id:"repo-fixer",name:"Repo Fixer",description:"Fix CI failures and dependencies",status:"coming_soon",moats:["M9","M10","M17","M18","M19"]}],Nt={company_name:"TechStartup AI",mission:"Making AI accessible to every business through simple powerful tools",value_proposition:"AI-powered solutions that save businesses time and money while being easy to use",tagline:"AI Made Simple",target_audience:["b2b_smb"],tone:{primary:"professional",avoid:[]},visual:{primary_color:"#6366f1",secondary_color:"#8b5cf6"}};function Bt(){const[t,r]=Ae(),s=t.get("worker")||"business-builder",i=t.get("replay"),[n,m]=c.useState(s),[x,u]=c.useState(!1),[l,f]=c.useState("Create a landing page hero section with compelling copy and a clear CTA"),[o,p]=c.useState(JSON.stringify(Nt,null,2)),[g,k]=c.useState(i),[h,y]=c.useState(!1),[j,w]=c.useState(null),[_,D]=c.useState(null),[R,pe]=c.useState([]),[G,q]=c.useState(!1),[he,K]=c.useState(!1),[Z,ue]=c.useState(()=>typeof window<"u"?document.documentElement.classList.contains("dark"):!1),[X,ye]=c.useState(!1),[Y,be]=c.useState(!1);C("INIT",`Component mount - runId: ${g}, replayId: ${i}`),c.useEffect(()=>(O.componentMount("WorkerExecutionConsole"),()=>O.componentUnmount("WorkerExecutionConsole")),[]);const F=c.useRef(!1),{state:d,isConnected:fe,reset:S}=at(g,{onComplete:a=>{C("CALLBACK",`onComplete called - success: ${a}`),console.log("Worker completed:",a),F.current=!0,L()},onError:a=>{if(C("CALLBACK","âŒ onError called",a),F.current){C("CALLBACK","Ignoring SSE close error - run already completed");return}console.error("Stream error:",a),w("Connection lost. Please try again.")}});c.useEffect(()=>{C("STATE-CHANGE",`state.status: ${d.status}, logs: ${d.logs.length}, stages: ${d.stages.filter(a=>a.status!=="pending").length}/8`)},[d.status,d.logs.length,d.stages]);const Q=d.stages.findIndex(a=>a.status==="running"||a.status==="pending"),L=c.useCallback(async()=>{K(!0);try{const a=await Te(10);pe(a.runs)}catch(a){console.error("Failed to load run history:",a)}finally{K(!1)}},[]);c.useEffect(()=>{L()},[L]),c.useEffect(()=>{i&&i!==g&&k(i)},[i,g]);const ke=c.useCallback(()=>{ue(a=>{const v=!a;return v?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),v})},[]),je=c.useCallback(async()=>{w(null),D(null);try{const a=JSON.parse(o),v=await $e(a);D(v)}catch(a){w(a instanceof Error?a.message:"Invalid JSON")}},[o]),ve=c.useCallback(async()=>{C("ACTION","â–¶ï¸ handleStart called",{task:l.slice(0,50)}),y(!0),w(null),F.current=!1,S();try{const a=JSON.parse(o);C("ACTION","ðŸ“¤ Calling startWorkerRun API",{task:l,brandCompanyName:a.company_name});const v=await Oe({task:l,brand:a,stream:!0});C("ACTION",`âœ… Got run_id: ${v.run_id} - setting state`),k(v.run_id),r({worker:n}),C("ACTION","ðŸ”„ runId state updated - SSE hook should connect now")}catch(a){const v=a instanceof Error?a.message:"Failed to start worker";C("ACTION",`âŒ startWorkerRun failed: ${v}`,a),w(v),y(!1)}},[l,o,S,n,r]),Ne=c.useCallback(async a=>{q(!1),k(a),r({worker:n,replay:a})},[n,r]),we=c.useCallback(async()=>{if(d.replayToken){y(!0),w(null),S();try{const a=await Ie(d.replayToken);k(a.run_id)}catch(a){w(a instanceof Error?a.message:"Failed to replay"),y(!1)}}},[d.replayToken,S]),Ce=c.useCallback(()=>{S(),k(null),y(!1),r({worker:n})},[S,n,r]),Se=c.useCallback(()=>{S(),k(null),w(null),y(!1),D(null),r({worker:n})},[S,n,r]),z=c.useCallback(a=>{const v={run_id:d.runId,task:d.task,status:d.status,stages:d.stages,logs:d.logs,routingDecisions:d.routingDecisions,policyEvents:d.policyEvents,driftEvents:d.driftEvents,artifacts:d.artifacts,recoveries:d.recoveries,totalTokens:d.totalTokens,totalLatency:d.totalLatency,exportedAt:new Date().toISOString()};let A,T,$;switch(a){case"json":A=JSON.stringify(v,null,2),T="application/json",$="json";break;case"txt":A=wt(v),T="text/plain",$="txt";break;case"csv":A=Ct(v),T="text/csv",$="csv";break}const Me=new Blob([A],{type:T}),te=URL.createObjectURL(Me),J=document.createElement("a");J.href=te,J.download=`worker-trace-${d.runId||"unknown"}.${$}`,J.click(),URL.revokeObjectURL(te)},[d]),E=d.status==="running",W=d.status==="completed",ee=d.status==="failed",Ee=P.find(a=>a.id===n)||P[0];return e.jsx("div",{className:b("h-screen flex flex-col",Z?"dark":""),children:e.jsxs("div",{className:"h-full flex flex-col bg-gray-100 dark:bg-gray-900",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:"/workers",className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>u(!x),disabled:E,className:"flex items-center gap-2 px-4 py-2 bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-lg font-medium hover:bg-purple-100 dark:hover:bg-purple-900/50 disabled:opacity-50",children:[e.jsx(We,{className:"w-4 h-4"}),Ee.name,e.jsx(De,{className:"w-4 h-4"})]}),x&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50",children:P.map(a=>e.jsxs("button",{onClick:()=>{a.status==="available"&&(m(a.id),r({worker:a.id})),u(!1)},disabled:a.status!=="available",className:b("w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 first:rounded-t-lg last:rounded-b-lg",a.status!=="available"&&"opacity-50 cursor-not-allowed"),children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[a.name,a.status==="coming_soon"&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Coming Soon)"})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.description})]},a.id))})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Execution Console"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Real-Time Worker Monitor"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[fe&&e.jsxs("span",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),"Live"]}),e.jsxs("div",{className:b("px-3 py-1 rounded-full text-sm font-medium",d.status==="idle"&&"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300",d.status==="running"&&"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",d.status==="completed"&&"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",d.status==="failed"&&"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:[d.status==="idle"&&"Ready",d.status==="running"&&"Running",d.status==="completed"&&"Completed",d.status==="failed"&&"Failed"]}),e.jsxs("button",{onClick:()=>q(!G),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg relative",children:[e.jsx(Je,{className:"w-5 h-5"}),R.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-purple-500 text-white text-xs rounded-full flex items-center justify-center",children:R.length})]}),e.jsx("button",{onClick:ke,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:Z?e.jsx(tt,{className:"w-5 h-5"}):e.jsx(Ye,{className:"w-5 h-5"})})]})]}),G&&e.jsxs("div",{className:"absolute right-4 top-16 w-96 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-50 max-h-96 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Run History"}),e.jsx("button",{onClick:L,className:"p-1 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(se,{className:b("w-4 h-4",he&&"animate-spin")})})]}),e.jsx("div",{className:"overflow-y-auto max-h-80",children:R.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No previous runs"}):R.map(a=>e.jsxs("button",{onClick:()=>Ne(a.run_id),className:"w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.success===!0&&e.jsx(I,{className:"w-4 h-4 text-green-500"}),a.success===!1&&e.jsx(H,{className:"w-4 h-4 text-red-500"}),a.success===null&&e.jsx(B,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white truncate max-w-48",children:a.task})]}),e.jsx("span",{className:"text-xs text-gray-500",children:a.total_latency_ms?`${(a.total_latency_ms/1e3).toFixed(1)}s`:"-"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(a.created_at).toLocaleString()})]},a.run_id))})]}),e.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{value:l,onChange:a=>f(a.target.value),disabled:E,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:opacity-50 text-sm",rows:2,placeholder:"Describe what you want the worker to create..."})}),e.jsx("button",{onClick:()=>be(!Y),className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600",children:"Brand Config"}),!E&&!W&&!ee&&e.jsxs("button",{onClick:ve,disabled:h||!l.trim(),className:"flex items-center gap-2 px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:[h?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):e.jsx(Pe,{className:"w-4 h-4"}),h?"Starting...":"Run"]}),E&&e.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium",children:[e.jsx(et,{className:"w-4 h-4"}),"Stop"]}),(W||ee)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:Se,className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:[e.jsx(He,{className:"w-4 h-4"}),"New"]}),d.replayToken&&e.jsxs("button",{onClick:we,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",title:"Replay this exact execution (M4 Golden Replay)",children:[e.jsx(se,{className:"w-4 h-4"}),"Replay"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600",children:[e.jsx(ie,{className:"w-4 h-4"}),"Export"]}),e.jsxs("div",{className:"absolute top-full right-0 mt-1 w-40 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50",children:[e.jsxs("button",{onClick:()=>z("json"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2 rounded-t-lg",children:[e.jsx(ge,{className:"w-4 h-4"}),"JSON"]}),e.jsxs("button",{onClick:()=>z("txt"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Text"]}),e.jsxs("button",{onClick:()=>z("csv"),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2 rounded-b-lg",children:[e.jsx(Ke,{className:"w-4 h-4"}),"CSV"]})]})]})]})]}),Y&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Brand JSON"}),e.jsx("button",{onClick:je,disabled:E,className:"px-2 py-1 text-xs bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-500",children:"Validate"})]}),e.jsx("textarea",{value:o,onChange:a=>p(a.target.value),disabled:E,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white font-mono text-xs resize-none focus:ring-2 focus:ring-purple-500",rows:6}),_&&e.jsx("div",{className:b("mt-2 p-2 rounded text-sm",_.valid?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300"),children:_.valid?"Valid brand schema":`Errors: ${_.errors.join(", ")}`})]}),j&&e.jsx("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 rounded-lg text-sm",children:j}),(E||W)&&e.jsxs("div",{className:"mt-3 flex items-center gap-6 text-sm text-gray-600 dark:text-gray-400",children:[d.runId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),d.runId.slice(0,8)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-4 h-4"}),d.totalTokens.toLocaleString()," tokens"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-4 h-4"}),(d.totalLatency/1e3).toFixed(1),"s"]}),e.jsxs("span",{className:"flex items-center gap-1",children:["Stages: ",d.stages.filter(a=>a.status==="completed"||a.status==="recovered").length,"/",d.stages.length]})]})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-3 grid-rows-2 gap-1 p-1 min-h-0",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:e.jsx(lt,{stages:d.stages,currentStageIndex:Q===-1?d.stages.length:Q})}),e.jsx("div",{className:"rounded-lg shadow-sm overflow-hidden",children:e.jsx(ct,{logs:d.logs,autoScroll:!0})}),e.jsx("div",{className:"rounded-lg shadow-sm overflow-hidden row-span-2",children:e.jsx(jt,{artifacts:d.artifacts,artifactContents:d.artifactContents,isExpanded:X,onToggleExpand:()=>ye(!X)})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:e.jsx(gt,{routingDecisions:d.routingDecisions,driftEvents:d.driftEvents,artifacts:d.artifacts})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:e.jsx(ht,{policyEvents:d.policyEvents,driftEvents:d.driftEvents,recoveries:d.recoveries,logs:d.logs})})]})]})})}function wt(t){const r=["â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","                    WORKER EXECUTION TRACE","â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","",`Run ID: ${t.run_id}`,`Task: ${t.task}`,`Status: ${t.status}`,`Total Tokens: ${t.totalTokens}`,`Total Latency: ${t.totalLatency}ms`,`Exported At: ${t.exportedAt}`,"","â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","                         STAGES","â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"];return t.stages.forEach((n,m)=>{r.push(`${m+1}. ${n.name} [${n.status}] ${n.duration_ms?`(${n.duration_ms}ms)`:""}`)}),r.push(""),r.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),r.push("                          LOGS"),r.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),t.logs.forEach(n=>{r.push(`[${n.level.toUpperCase()}] [${n.agent}] ${n.message}`)}),r.join(`
`)}function Ct(t){const r=t.logs,s=["level,agent,stage,message"];return r.forEach(i=>{s.push(`"${i.level}","${i.agent}","${i.stage_id}","${i.message.replace(/"/g,'""')}"`)}),s.join(`
`)}export{Bt as WorkerExecutionConsole,Bt as default};

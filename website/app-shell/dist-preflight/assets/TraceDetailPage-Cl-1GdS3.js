import{x as T,u as R,q as I,A as w,y as j,j as e,o as u,v as g,w as v}from"./index-BnpC133k.js";import{A as S}from"./arrow-left-CuYyvlZL.js";import{C as N}from"./clock-C3lW4_yM.js";import{D as k}from"./download-CR7Sb1VZ.js";import{C as b,E}from"./CanonicalBreadcrumb-DlV3Db--.js";import{G as _}from"./git-branch-90xaKnL0.js";import{P as L}from"./play-CfTQN8rq.js";import{X as y}from"./x-circle-CgZNW2_D.js";import{a as A}from"./traces-JYQBeVJU.js";function D(s){var m;const l=s.steps||[],o=l.filter(r=>r.status==="completed"||r.status==="ok").length,i=l.filter(r=>r.status==="failed"||r.status==="error").length;let d=null;s.created_at&&s.completed_at&&(d=new Date(s.completed_at).getTime()-new Date(s.created_at).getTime());let t="RUNNING";const a=((m=s.status)==null?void 0:m.toLowerCase())||"";return a==="completed"||a==="complete"?t=i>0?"PARTIAL":"COMPLETE":(a==="failed"||a==="error")&&(t="ERROR"),{trace_id:s.run_id,run_id:s.run_id,created_at:s.created_at,completed_at:s.completed_at||null,status:t,root_hash:s.root_hash||null,hash_verified:!!s.root_hash,hash_version:"v1",total_steps:l.length,success_steps:o,failed_steps:i,duration_ms:d,steps_summary:l.map((r,h)=>({index:h+1,skill_id:r.skill_id,status:r.status==="completed"||r.status==="ok"?"ok":r.status==="failed"||r.status==="error"?"error":"skipped",duration_ms:null}))}}const O={COMPLETE:{label:"COMPLETE",icon:j,color:"text-green-400",bg:"bg-green-500/10",border:"border-green-500/30"},PARTIAL:{label:"PARTIAL",icon:w,color:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/30"},ERROR:{label:"ERROR",icon:y,color:"text-red-400",bg:"bg-red-500/10",border:"border-red-500/30"},RUNNING:{label:"RUNNING",icon:N,color:"text-blue-400",bg:"bg-blue-500/10",border:"border-blue-500/30"}};function x({title:s,children:l}){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xs font-medium text-slate-500 uppercase tracking-wider mb-3 border-b border-slate-700 pb-2",children:s}),l]})}function n({label:s,value:l,mono:o=!1,link:i}){const d=e.jsx("span",{className:u("text-white",o&&"font-mono text-sm"),children:l||"--"});return e.jsxs("div",{className:"flex items-start justify-between py-2",children:[e.jsx("span",{className:"text-slate-400 text-sm min-w-32",children:s}),i?e.jsxs(v,{to:i,className:"text-blue-400 hover:text-blue-300 flex items-center gap-1",children:[d,e.jsx(E,{className:"w-3 h-3"})]}):d]})}function P({step:s}){const l=s.status==="ok"?e.jsx(j,{className:"w-4 h-4 text-green-400"}):s.status==="error"?e.jsx(y,{className:"w-4 h-4 text-red-400"}):e.jsx(N,{className:"w-4 h-4 text-slate-500"});return e.jsxs("div",{className:"flex items-center gap-4 py-2 px-3 bg-slate-800/50 rounded",children:[e.jsxs("span",{className:"text-slate-500 text-sm w-6",children:["#",s.index]}),e.jsx("span",{className:"font-mono text-sm text-white flex-1",children:s.skill_id}),l,e.jsx("span",{className:"text-slate-500 text-xs w-16 text-right",children:s.duration_ms?`${s.duration_ms}ms`:"--"})]})}function H(){const{runId:s}=T(),l=R(),{data:o,isLoading:i,error:d}=I({queryKey:["trace",s],queryFn:()=>A(s),enabled:!!s}),t=o?D(o):null,a=t?O[t.status]:null,m=(a==null?void 0:a.icon)||N,r=c=>c?c<1e3?`${c}ms`:`${(c/1e3).toFixed(2)}s`:"--",h=()=>{if(!o)return;const c=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),f=URL.createObjectURL(c),p=document.createElement("a");p.href=f,p.download=`trace-${s}.json`,p.click(),URL.revokeObjectURL(f)};return i?e.jsx("div",{className:"min-h-screen bg-slate-900 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(b,{root:{label:"Traces",path:"/traces"},entity:{label:s||"",id:s,path:`/traces/${s}`}}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})}):d||!t?e.jsx("div",{className:"min-h-screen bg-slate-900 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(b,{root:{label:"Traces",path:"/traces"},entity:{label:s||"",id:s,path:`/traces/${s}`}}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-8 text-center",children:[e.jsx(_,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Trace Not Found"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"The requested trace could not be loaded."}),e.jsx("button",{onClick:()=>l("/traces"),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-white text-sm",children:"Back to Traces"})]})]})}):e.jsx("div",{className:"min-h-screen bg-slate-900 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(b,{root:{label:"Traces",path:"/traces"},entity:{label:t.trace_id,id:t.trace_id,path:`/traces/${t.run_id}`}}),e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("button",{onClick:()=>l("/traces"),className:"p-1 hover:bg-slate-800 rounded",children:e.jsx(S,{className:"w-5 h-5 text-slate-400"})}),e.jsx(_,{className:"w-6 h-6 text-slate-500"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Trace Detail"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"O3 Accountability View - PIN-186 Compliant"})]}),e.jsxs("div",{className:u("flex items-center gap-2 px-3 py-2 rounded-lg border",a==null?void 0:a.bg,a==null?void 0:a.border),children:[e.jsx(m,{className:u("w-5 h-5",a==null?void 0:a.color)}),e.jsx("span",{className:u("font-bold text-sm",a==null?void 0:a.color),children:a==null?void 0:a.label})]})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6",children:[e.jsxs(x,{title:"Trace Identity",children:[e.jsx(n,{label:"Trace ID",value:t.trace_id,mono:!0}),e.jsx(n,{label:"Run ID",value:g(t.run_id,16),mono:!0,link:`/guard/runs?run=${t.run_id}`}),e.jsx(n,{label:"Created At",value:new Date(t.created_at).toLocaleString()}),e.jsx(n,{label:"Status",value:t.status})]}),e.jsxs(x,{title:"Verification",children:[e.jsx(n,{label:"Root Hash",value:t.root_hash?g(t.root_hash,20):"N/A",mono:!0}),e.jsx(n,{label:"Verification Status",value:t.hash_verified?e.jsxs("span",{className:"flex items-center gap-1 text-green-400",children:[e.jsx(j,{className:"w-4 h-4"})," VERIFIED"]}):e.jsxs("span",{className:"flex items-center gap-1 text-yellow-400",children:[e.jsx(w,{className:"w-4 h-4"})," UNVERIFIED"]})}),e.jsx(n,{label:"Hash Version",value:t.hash_version})]}),e.jsxs(x,{title:"Summary",children:[e.jsx(n,{label:"Total Steps",value:t.total_steps}),e.jsx(n,{label:"Successful Steps",value:e.jsx("span",{className:"text-green-400",children:t.success_steps})}),e.jsx(n,{label:"Failed Steps",value:t.failed_steps>0?e.jsx("span",{className:"text-red-400",children:t.failed_steps}):e.jsx("span",{className:"text-slate-500",children:"0"})}),e.jsx(n,{label:"Total Duration",value:r(t.duration_ms)})]}),e.jsxs(x,{title:"Steps (Summary Only)",children:[t.steps_summary.length>0?e.jsxs("div",{className:"space-y-1",children:[t.steps_summary.slice(0,10).map(c=>e.jsx(P,{step:c},c.index)),t.steps_summary.length>10&&e.jsxs("div",{className:"text-center py-2 text-slate-500 text-sm",children:["... and ",t.steps_summary.length-10," more steps"]})]}):e.jsx("p",{className:"text-slate-500 text-sm py-4 text-center",children:"No steps recorded"}),e.jsx("p",{className:"text-slate-600 text-xs mt-3 text-center",children:"Step details not expanded here (O4 deferred per PIN-186)"})]}),e.jsx(x,{title:"Actions",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{to:`/guard/runs?run=${t.run_id}`,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white text-sm transition-colors",children:[e.jsx(L,{className:"w-4 h-4"}),"View Run"]}),e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-white text-sm transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),"Download Trace"]})]})})]})]})})}export{H as default};

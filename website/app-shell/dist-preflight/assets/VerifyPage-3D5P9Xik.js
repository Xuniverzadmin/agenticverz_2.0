import{u as p,c as j,r as l,j as e,d as f,e as b,t as k}from"./index-KppIquYQ.js";import{O as N}from"./OnboardingLayout-Dfi7mFFm.js";const y="";function A(){const u=p(),{token:x,tenantId:i,setOnboardingStep:m}=j(),[s,a]=l.useState("idle"),[t,r]=l.useState(null);l.useEffect(()=>{m(4)},[]);const h=async()=>{var o,c;a("running"),r(null);try{const n=(await f.post(`${y}/guard/onboarding/verify?tenant_id=${i||"demo-tenant"}`,{test_type:"guardrail_block",trigger_alert:!0},{headers:{Authorization:`Bearer ${x}`,"X-Tenant-ID":i||"demo-tenant","Content-Type":"application/json"}})).data;n.was_blocked?(a("success"),r({status:"success",message:"ðŸ›¡ï¸ Your AI is now protected!",details:`Blocked by: ${n.blocked_by||"guardrail"}`,incidentId:n.incident_id,wasBlocked:!0,blockedBy:n.blocked_by,alertSent:n.alert_sent}),b("Safety test passed! Guardrails are active.")):(a("success"),r({status:"success",message:"âš ï¸ Request was processed",details:`Tokens used: ${n.tokens_consumed}. Check your guardrail configuration.`,wasBlocked:!1}))}catch(d){const n=d;a("failed"),r({status:"failed",message:"Could not run safety test",details:((c=(o=n.response)==null?void 0:o.data)==null?void 0:c.detail)||"Please check your API connection."}),k("Verification failed")}},g=()=>{u("/onboarding/complete")};return e.jsx(N,{step:4,title:"Verify Your Setup",subtitle:"We'll fire a REAL request to prove your guardrails work",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`w-20 h-20 mx-auto mb-4 rounded-2xl flex items-center justify-center ${s==="idle"?"bg-slate-800":s==="running"?"bg-blue-600/20":s==="success"?"bg-green-600/20":"bg-red-600/20"}`,children:[s==="idle"&&e.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),s==="running"&&e.jsxs("svg",{className:"w-10 h-10 text-blue-500 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s==="success"&&e.jsx("svg",{className:"w-10 h-10 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),s==="failed"&&e.jsx("svg",{className:"w-10 h-10 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),t?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:`text-lg font-medium ${t.wasBlocked?"text-green-400":t.status==="failed"?"text-red-400":"text-amber-400"}`,children:t.message}),t.details&&e.jsx("p",{className:"text-sm text-slate-400 mt-2",children:t.details}),t.incidentId&&e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Incident: ",e.jsx("span",{className:"font-mono text-blue-400",children:t.incidentId})]}),t.alertSent&&e.jsx("p",{className:"text-xs text-green-500 mt-1",children:"âœ“ Alert sent to your configured channel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:s==="running"?"Sending real AI request...":"Ready to test your guardrails"}),e.jsx("p",{className:"text-sm text-slate-400 mt-2",children:s==="running"?"We're sending a prompt injection through your API...":"This sends a REAL malicious prompt. Your guardrail should block it."})]})]}),s!=="success"&&e.jsx("button",{onClick:h,disabled:s==="running",className:`w-full px-4 py-3 font-medium rounded-xl transition-colors ${s==="running"?"bg-slate-700 text-slate-400 cursor-not-allowed":"bg-amber-600 hover:bg-amber-500 text-white"}`,children:s==="running"?"Testing...":s==="failed"?"Retry Test":"ðŸ”¥ Fire Live Test"}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"What happens when you click:"}),e.jsxs("ul",{className:"text-sm text-slate-400 space-y-1",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-0.5",children:"âœ“"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Real API call"})," sent through your proxy"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-0.5",children:"âœ“"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Prompt injection pattern"})," triggers guardrail"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-0.5",children:"âœ“"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Real incident"})," created (visible in console)"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400 mt-0.5",children:"âœ“"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Alert fires"})," to Slack/email (if configured)"]})]})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-3",children:"ðŸ’¡ Cost: $0.00 â€” blocked requests don't consume tokens"})]}),(t==null?void 0:t.incidentId)&&e.jsx("a",{href:`/console/guard?incident=${t.incidentId}`,target:"_blank",rel:"noopener noreferrer",className:"block w-full px-4 py-3 bg-slate-800 hover:bg-slate-700 text-center text-blue-400 font-medium rounded-xl transition-colors",children:"View Incident in Console â†’"}),e.jsx("button",{onClick:g,className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-xl transition-colors",children:s==="success"?"Continue":"Skip & Continue"})]})})}export{A as default};

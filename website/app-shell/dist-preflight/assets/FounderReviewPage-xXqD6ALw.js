import{f as C,r as o,q as u,j as e,g as E,y as j,A as k,S as f,n as R,F as S,X as T,z as N,D as I,m as Q,k as G}from"./index-BnpC133k.js";import{E as A}from"./eye-B5J3e2Eo.js";import{B,g as D,a as F,f as L,b as P,c as p,d as $,l as J,e as K}from"./autoExecuteReview-Dwi1vk5k.js";import{F as W}from"./filter-BbNfQ82n.js";import{H as v}from"./hash-CrI9K-ll.js";import{R as O}from"./refresh-cw-C0UIxpEg.js";import{X as M}from"./x-circle-CgZNW2_D.js";import{u as Y}from"./useMutation-qCFmrl0G.js";import{C as Z}from"./clock-C3lW4_yM.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=C("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=C("FileCheck",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]),w=25,_=3e4;function se({stats:s}){if(!s||!s.daily_counts||s.daily_counts.length===0)return null;const t=Math.max(...s.daily_counts.map(r=>Math.max(r.executed,r.skipped,r.flagged||0)));return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"h-5 w-5 text-primary-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Daily Decision Trend"})]}),e.jsxs("div",{className:"flex gap-4 mb-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Executed"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Skipped"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Flagged"})]})]}),e.jsx("div",{className:"flex items-end gap-1 h-32",children:s.daily_counts.slice(-14).map((r,a)=>{const l=t>0?r.executed/t*100:0,c=t>0?r.skipped/t*100:0,d=t>0?(r.flagged||0)/t*100:0;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-0.5 group relative",title:`${r.date}: ${r.executed} executed, ${r.skipped} skipped`,children:[e.jsxs("div",{className:"w-full flex flex-col-reverse gap-0.5",style:{height:"100px"},children:[e.jsx("div",{className:"w-full bg-green-500 rounded-t transition-all",style:{height:`${l}%`,minHeight:r.executed>0?"2px":"0"}}),e.jsx("div",{className:"w-full bg-yellow-500 rounded-t transition-all",style:{height:`${c}%`,minHeight:r.skipped>0?"2px":"0"}}),e.jsx("div",{className:"w-full bg-orange-500 rounded-t transition-all",style:{height:`${d}%`,minHeight:(r.flagged||0)>0?"2px":"0"}})]}),a%2===0&&e.jsx("span",{className:"text-[10px] text-gray-500 mt-1",children:new Date(r.date).toLocaleDateString("en",{month:"short",day:"numeric"})})]},a)})})]})}function ae({stats:s}){if(!s||!s.confidence_distribution)return null;const t=s.confidence_distribution,r=["0.0-0.2","0.2-0.4","0.4-0.6","0.6-0.8","0.8-1.0"],a=["bg-red-500","bg-orange-500","bg-yellow-500","bg-emerald-500","bg-green-500"],l=Object.values(t).reduce((c,d)=>c+d,0);return l===0?null:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-300 mb-3",children:"Confidence Distribution"}),e.jsx("div",{className:"space-y-2",children:r.map((c,d)=>{const x=t[c]||0,i=l>0?x/l*100:0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500 w-16",children:c}),e.jsx("div",{className:"flex-1 h-4 bg-gray-700 rounded overflow-hidden",children:e.jsx("div",{className:`h-full ${a[d]} transition-all`,style:{width:`${i}%`}})}),e.jsx("span",{className:"text-xs text-gray-400 w-12 text-right",children:x})]},c)})})]})}function te({stats:s}){if(!s||!s.flag_counts)return null;const t=Object.entries(s.flag_counts).sort((a,l)=>l[1]-a[1]).slice(0,8);if(t.length===0)return null;const r=Math.max(...t.map(([,a])=>a));return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Safety Flag Breakdown"]}),e.jsx("div",{className:"space-y-2",children:t.map(([a,l])=>{const c=r>0?l/r*100:0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-400 truncate flex-1",children:a}),e.jsx("div",{className:"w-24 h-3 bg-gray-700 rounded overflow-hidden",children:e.jsx("div",{className:`h-full ${D(a).split(" ")[0].replace("text-","bg-")} transition-all`,style:{width:`${c}%`}})}),e.jsx("span",{className:"text-xs text-gray-500 w-8 text-right",children:l})]},a)})})]})}function re({stats:s}){if(!s)return null;const t=s.total_decisions>0?(s.executed_count/s.total_decisions*100).toFixed(1):"0";return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(E,{className:"h-4 w-4 text-primary-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Total Decisions"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:s.total_decisions.toLocaleString()})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Executed"})]}),e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[s.executed_count.toLocaleString(),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",t,"%)"]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(M,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Skipped"})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:s.skipped_count.toLocaleString()})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{className:"h-4 w-4 text-orange-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Flagged"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:s.flagged_count.toLocaleString()})]})]})}function le({filter:s,onFilterChange:t,onRefresh:r,isRefreshing:a}){return e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700 mb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Filters:"})]}),e.jsxs("select",{value:s.decision||"",onChange:l=>t({...s,decision:l.target.value||void 0,page:1}),className:"bg-gray-900 border border-gray-700 rounded px-3 py-1.5 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"All Decisions"}),e.jsx("option",{value:"EXECUTED",children:"Executed"}),e.jsx("option",{value:"SKIPPED",children:"Skipped"})]}),e.jsxs("select",{value:s.has_safety_flags===void 0?"":String(s.has_safety_flags),onChange:l=>t({...s,has_safety_flags:l.target.value===""?void 0:l.target.value==="true",page:1}),className:"bg-gray-900 border border-gray-700 rounded px-3 py-1.5 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"All Safety Status"}),e.jsx("option",{value:"true",children:"With Flags"}),e.jsx("option",{value:"false",children:"No Flags"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Confidence:"}),e.jsx("input",{type:"number",placeholder:"Min",min:"0",max:"1",step:"0.1",value:s.min_confidence||"",onChange:l=>t({...s,min_confidence:l.target.value?parseFloat(l.target.value):void 0,page:1}),className:"bg-gray-900 border border-gray-700 rounded px-2 py-1.5 text-sm text-white w-16 focus:outline-none focus:ring-2 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx("input",{type:"number",placeholder:"Max",min:"0",max:"1",step:"0.1",value:s.max_confidence||"",onChange:l=>t({...s,max_confidence:l.target.value?parseFloat(l.target.value):void 0,page:1}),className:"bg-gray-900 border border-gray-700 rounded px-2 py-1.5 text-sm text-white w-16 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:r,disabled:a,className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded text-sm text-white transition-colors disabled:opacity-50",children:[e.jsx(O,{className:`h-4 w-4 ${a?"animate-spin":""}`}),"Refresh"]})]})})}function ne({items:s,totalCount:t,page:r,pageSize:a,onPageChange:l,onSelectItem:c,isLoading:d}){const x=Math.ceil(t/a);return d?e.jsx("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-8 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-400"})}):s.length===0?e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-8 text-center",children:[e.jsx(A,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No AUTO_EXECUTE decisions found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Adjust filters or wait for new decisions"})]}):e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-3 bg-gray-900/50 border-b border-gray-700 text-sm font-medium text-gray-400",children:[e.jsx("div",{className:"col-span-2",children:"Timestamp"}),e.jsx("div",{className:"col-span-2",children:"Invocation ID"}),e.jsx("div",{className:"col-span-2",children:"Tenant"}),e.jsx("div",{className:"col-span-1 text-center",children:"Decision"}),e.jsx("div",{className:"col-span-2 text-center",children:"Confidence"}),e.jsx("div",{className:"col-span-2",children:"Safety"}),e.jsx("div",{className:"col-span-1"})]}),s.map(i=>{const m=F(i.safety_checked,i.safety_passed,i.safety_flags);return e.jsxs("button",{onClick:()=>c(i),className:"w-full grid grid-cols-12 gap-2 p-3 border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors text-left group",children:[e.jsx("div",{className:"col-span-2 text-sm text-gray-300",children:L(i.timestamp)}),e.jsxs("div",{className:"col-span-2 font-mono text-xs text-gray-400 truncate",children:[i.invocation_id.slice(0,12),"..."]}),e.jsxs("div",{className:"col-span-2 font-mono text-xs text-gray-400 truncate",children:[i.tenant_id.slice(0,8),"..."]}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${P(i.decision)}`,children:i.decision})}),e.jsxs("div",{className:"col-span-2 text-center",children:[e.jsx("span",{className:`font-mono text-sm ${$(i.confidence_score,i.threshold)}`,children:p(i.confidence_score)}),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(â‰¥",p(i.threshold),")"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${m.color}`,children:m.label}),i.safety_flags.length>0&&e.jsxs("span",{className:"ml-1 text-xs text-gray-500",children:["(",i.safety_flags.length,")"]})]}),e.jsx("div",{className:"col-span-1 flex justify-end",children:e.jsx(R,{className:"h-4 w-4 text-gray-600 group-hover:text-primary-400 transition-colors"})})]},i.invocation_id)}),x>1&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-900/50",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",(r-1)*a+1,"-",Math.min(r*a,t)," of ",t]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l(r-1),disabled:r<=1,className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-400",children:["Page ",r," of ",x]}),e.jsx("button",{onClick:()=>l(r+1),disabled:r>=x,className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})}function ie({item:s,onClose:t}){const r=F(s.safety_checked,s.safety_passed,s.safety_flags);return e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full max-w-lg bg-gray-800 border-l border-gray-700 shadow-xl z-50 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-800 border-b border-gray-700 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-primary-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Evidence Detail"})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-700 rounded transition-colors",children:e.jsx(T,{className:"h-5 w-5 text-gray-400"})})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Decision Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Decision"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${P(s.decision)}`,children:s.decision})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Confidence"}),e.jsx("span",{className:`text-lg font-bold ${$(s.confidence_score,s.threshold)}`,children:p(s.confidence_score)}),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(threshold: ",p(s.threshold),")"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Timestamp"}),e.jsx("div",{className:"text-sm text-gray-300",children:L(s.timestamp)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Recovery Action"}),e.jsx("div",{className:"text-sm text-gray-300",children:s.recovery_action||"None"})]})]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),"Identifiers"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Invocation ID"}),e.jsx("span",{className:"font-mono text-gray-300 text-xs",children:s.invocation_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Envelope ID"}),e.jsx("span",{className:"font-mono text-gray-300 text-xs",children:s.envelope_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tenant ID"}),e.jsx("span",{className:"font-mono text-gray-300 text-xs",children:s.tenant_id})]})]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Safety Status (PIN-332)"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Status"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm ${r.color}`,children:r.label})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Checked"}),e.jsx("span",{className:s.safety_checked?"text-green-400":"text-gray-500",children:s.safety_checked?"Yes":"No"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Passed"}),e.jsx("span",{className:s.safety_passed?"text-green-400":"text-red-400",children:s.safety_passed?"Yes":"No"})]}),s.safety_flags.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Flags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.safety_flags.map((a,l)=>e.jsx("span",{className:`px-2 py-1 rounded text-xs ${D(a)}`,children:a},l))})]}),s.safety_warnings.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Warnings"}),e.jsx("div",{className:"space-y-1",children:s.safety_warnings.map((a,l)=>e.jsx("div",{className:"text-xs text-yellow-400 bg-yellow-900/20 px-2 py-1 rounded",children:a},l))})]})]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),"Integrity Hashes"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Input Hash"}),e.jsx("div",{className:"font-mono text-xs text-gray-400 break-all",children:s.input_hash})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Plan Hash"}),e.jsx("div",{className:"font-mono text-xs text-gray-400 break-all",children:s.plan_hash})]})]})]}),e.jsxs("div",{className:"bg-emerald-900/20 border border-emerald-800 rounded-lg p-3 text-sm text-emerald-400",children:[e.jsx("strong",{children:"READ-ONLY:"})," This is an evidence view only. No actions can be taken from this dashboard. AUTO_EXECUTE behavior is not affected."]})]})]})}function ce(){const[s,t]=o.useState({page:1,page_size:w}),[r,a]=o.useState(null),{data:l,isLoading:c,refetch:d,isFetching:x}=u({queryKey:["autoExecuteReview","list",s],queryFn:()=>J(s),staleTime:1e4,refetchInterval:_}),{data:i,refetch:m}=u({queryKey:["autoExecuteReview","stats"],queryFn:()=>K(),staleTime:3e4,refetchInterval:_}),n=o.useCallback(()=>{d(),m()},[d,m]),y=o.useCallback(h=>{t(b=>({...b,page:h}))},[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 p-3 bg-amber-900/20 border border-amber-800 rounded-lg text-sm text-amber-400",children:[e.jsx("strong",{children:"EVIDENCE-ONLY:"})," This dashboard displays execution evidence only. No approval, rejection, pause, or override actions are available. AUTO_EXECUTE behavior and thresholds are not modified by this view."]}),e.jsx(re,{stats:i}),e.jsx(se,{stats:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx(ae,{stats:i}),e.jsx(te,{stats:i})]}),e.jsx(le,{filter:s,onFilterChange:t,onRefresh:n,isRefreshing:x}),e.jsx(ne,{items:(l==null?void 0:l.items)||[],totalCount:(l==null?void 0:l.total_count)||0,page:s.page||1,pageSize:s.page_size||w,onPageChange:y,onSelectItem:a,isLoading:c}),l&&e.jsxs("div",{className:"mt-4 flex gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Executed: ",e.jsx("span",{className:"text-green-400",children:l.executed_count})]}),e.jsxs("span",{children:["Skipped: ",e.jsx("span",{className:"text-yellow-400",children:l.skipped_count})]}),e.jsxs("span",{children:["Flagged: ",e.jsx("span",{className:"text-orange-400",children:l.flagged_count})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>a(null)}),e.jsx(ie,{item:r,onClose:()=>a(null)})]})]})}async function de(){return(await N.get("/api/v1/founder/contracts/review-queue")).data}async function xe(s){return(await N.get(`/api/v1/founder/contracts/${s}`)).data}async function oe(s,t){return(await N.post(`/api/v1/founder/contracts/${s}/review`,t)).data}function me(s){switch(s){case"ELIGIBLE":return"text-blue-400 bg-blue-900/30";case"APPROVED":return"text-green-400 bg-green-900/30";case"REJECTED":return"text-red-400 bg-red-900/30";case"ACTIVATED":return"text-purple-400 bg-purple-900/30";case"EXPIRED":return"text-gray-400 bg-gray-900/30";default:return"text-yellow-400 bg-yellow-900/30"}}function U(s){switch(s){case"LOW":return"text-green-400";case"MEDIUM":return"text-yellow-400";case"HIGH":return"text-orange-400";case"CRITICAL":return"text-red-400";default:return"text-gray-400"}}function V(s){if(!s)return"text-gray-400";switch(s.toUpperCase()){case"INFO":return"text-blue-400";case"WARNING":return"text-yellow-400";case"ERROR":return"text-orange-400";case"CRITICAL":return"text-red-400";default:return"text-gray-400"}}function q(s){return s?new Date(s).toLocaleString():"-"}function X(s){if(!s)return!1;const t=new Date(s),r=new Date,a=(t.getTime()-r.getTime())/(1e3*60*60);return a>0&&a<=24}const ge=3e4;function he({contracts:s}){const t={CRITICAL:s.filter(a=>a.risk_level==="CRITICAL").length,HIGH:s.filter(a=>a.risk_level==="HIGH").length,MEDIUM:s.filter(a=>a.risk_level==="MEDIUM").length,LOW:s.filter(a=>a.risk_level==="LOW").length},r=s.filter(a=>X(a.expires_at)).length;return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"h-4 w-4 text-blue-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Pending Review"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:s.length})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Critical"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:t.CRITICAL})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"h-4 w-4 text-orange-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"High Risk"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:t.HIGH})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(f,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Medium Risk"})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:t.MEDIUM})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"h-4 w-4 text-purple-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Expiring Soon"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:r})]})]})}function ue({contracts:s,onSelectContract:t,isLoading:r}){return r?e.jsx("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-8 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-400"})}):s.length===0?e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-8 text-center",children:[e.jsx(j,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No contracts pending review"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"All eligible contracts have been processed"})]}):e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-3 bg-gray-900/50 border-b border-gray-700 text-sm font-medium text-gray-400",children:[e.jsx("div",{className:"col-span-3",children:"Title"}),e.jsx("div",{className:"col-span-2",children:"Source"}),e.jsx("div",{className:"col-span-1 text-center",children:"Risk"}),e.jsx("div",{className:"col-span-2 text-center",children:"Confidence"}),e.jsx("div",{className:"col-span-2",children:"Created"}),e.jsx("div",{className:"col-span-1",children:"Expires"}),e.jsx("div",{className:"col-span-1"})]}),s.map(a=>e.jsxs("button",{onClick:()=>t(a),className:"w-full grid grid-cols-12 gap-2 p-3 border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors text-left group",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("div",{className:"text-sm text-white font-medium truncate",children:a.title}),a.issue_type&&e.jsx("div",{className:`text-xs ${V(a.severity)}`,children:a.issue_type})]}),e.jsx("div",{className:"col-span-2 text-sm text-gray-400",children:a.source}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("span",{className:`text-sm font-medium ${U(a.risk_level)}`,children:a.risk_level})}),e.jsx("div",{className:"col-span-2 text-center",children:a.confidence_score!==null?e.jsxs("span",{className:"font-mono text-sm text-gray-300",children:[(a.confidence_score*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("div",{className:"col-span-2 text-sm text-gray-400",children:q(a.created_at)}),e.jsx("div",{className:"col-span-1",children:a.expires_at?e.jsx("span",{className:X(a.expires_at)?"text-orange-400":"text-gray-400",children:new Date(a.expires_at).toLocaleDateString()}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("div",{className:"col-span-1 flex justify-end",children:e.jsx(R,{className:"h-4 w-4 text-gray-600 group-hover:text-primary-400 transition-colors"})})]},a.contract_id))]})}function pe({contractId:s,onClose:t,onReviewComplete:r}){const[a,l]=o.useState(null),[c,d]=o.useState(""),[x,i]=o.useState(24),m=I(),{data:n,isLoading:y}=u({queryKey:["contractDetail",s],queryFn:()=>xe(s)}),h=Y({mutationFn:g=>oe(s,g),onSuccess:()=>{m.invalidateQueries({queryKey:["contractReviewQueue"]}),r(),t()}}),b=()=>{a&&h.mutate({decision:a,comment:c||void 0,activation_window_hours:a==="APPROVE"?x:void 0})};return y?e.jsx("div",{className:"fixed inset-y-0 right-0 w-full max-w-lg bg-gray-800 border-l border-gray-700 shadow-xl z-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-400"})}):n?e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full max-w-lg bg-gray-800 border-l border-gray-700 shadow-xl z-50 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-800 border-b border-gray-700 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-blue-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Contract Review"})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-700 rounded transition-colors",children:e.jsx(T,{className:"h-5 w-5 text-gray-400"})})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:n.title}),n.description&&e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:n.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Status"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm ${me(n.status)}`,children:n.status})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Risk Level"}),e.jsx("span",{className:`font-medium ${U(n.risk_level)}`,children:n.risk_level})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Source"}),e.jsx("span",{className:"text-gray-300",children:n.source})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Confidence"}),e.jsx("span",{className:"text-gray-300",children:n.confidence_score!==null?`${(n.confidence_score*100).toFixed(0)}%`:"-"})]})]})]}),n.affected_capabilities.length>0&&e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Affected Capabilities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.affected_capabilities.map(g=>e.jsx("span",{className:"px-2 py-1 bg-gray-700 rounded text-xs text-gray-300",children:g},g))})]}),n.validator_summary&&e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Machine Analysis"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Issue Type"}),e.jsx("span",{className:"text-gray-300",children:n.validator_summary.issue_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Severity"}),e.jsx("span",{className:V(n.validator_summary.severity),children:n.validator_summary.severity})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Recommended Action"}),e.jsx("span",{className:"text-gray-300",children:n.validator_summary.recommended_action})]}),n.validator_summary.reason&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Reason"}),e.jsx("p",{className:"text-gray-400",children:n.validator_summary.reason})]})]})]}),n.eligibility_summary&&e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Eligibility"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Decision"}),e.jsx("span",{className:"text-green-400",children:n.eligibility_summary.decision})]}),n.eligibility_summary.reason&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Reason"}),e.jsx("p",{className:"text-gray-400",children:n.eligibility_summary.reason})]}),n.eligibility_summary.blocking_signals.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Blocking Signals"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:n.eligibility_summary.blocking_signals.map((g,z)=>e.jsx("span",{className:"px-2 py-0.5 bg-red-900/30 text-red-400 text-xs rounded",children:g},z))})]})]})]}),Object.keys(n.proposed_changes).length>0&&e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Proposed Changes"}),e.jsx("pre",{className:"text-xs text-gray-400 bg-gray-950 p-3 rounded overflow-x-auto",children:JSON.stringify(n.proposed_changes,null,2)})]}),e.jsxs("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-400 mb-4",children:"Your Decision"}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("button",{onClick:()=>l("APPROVE"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors ${a==="APPROVE"?"bg-green-600 text-white":"bg-gray-700 text-gray-300 hover:bg-green-900/50 hover:text-green-400"}`,children:[e.jsx(j,{className:"h-5 w-5"}),"APPROVE"]}),e.jsxs("button",{onClick:()=>l("REJECT"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors ${a==="REJECT"?"bg-red-600 text-white":"bg-gray-700 text-gray-300 hover:bg-red-900/50 hover:text-red-400"}`,children:[e.jsx(M,{className:"h-5 w-5"}),"REJECT"]})]}),a==="APPROVE"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Activation Window (hours)"}),e.jsx("input",{type:"number",min:"1",max:"168",value:x,onChange:g=>i(parseInt(g.target.value)||24),className:"w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-1",children:["Comment ",a==="REJECT"&&"(recommended for rejections)"]}),e.jsx("textarea",{value:c,onChange:g=>d(g.target.value),placeholder:"Optional comment explaining your decision...",rows:3,className:"w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsx("button",{onClick:b,disabled:!a||h.isPending,className:`w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors ${a?a==="APPROVE"?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-5 w-5 animate-spin"}),"Submitting..."]}):e.jsx(e.Fragment,{children:"Submit Review"})}),h.isError&&e.jsx("div",{className:"mt-4 p-3 bg-red-900/20 border border-red-800 rounded text-sm text-red-400",children:"Failed to submit review. Please try again."})]}),e.jsxs("div",{className:"bg-amber-900/20 border border-amber-800 rounded-lg p-3 text-sm text-amber-400",children:[e.jsx("strong",{children:"AUTHORITY GATE:"})," This is the last human authority insertion point. Your decision will transition the contract to APPROVED or REJECTED status."]})]})]}):null}function ye(){const[s,t]=o.useState(null),r=I(),{data:a,isLoading:l,refetch:c,isFetching:d}=u({queryKey:["contractReviewQueue"],queryFn:de,staleTime:1e4,refetchInterval:ge}),x=o.useCallback(()=>{c()},[c]),i=o.useCallback(()=>{r.invalidateQueries({queryKey:["contractReviewQueue"]})},[r]),m=(a==null?void 0:a.contracts)||[];return e.jsxs(e.Fragment,{children:[e.jsx(he,{contracts:m}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-sm text-gray-400",children:(a==null?void 0:a.as_of)&&e.jsxs(e.Fragment,{children:["Last updated: ",q(a.as_of)]})}),e.jsxs("button",{onClick:x,disabled:d,className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded text-sm text-white transition-colors disabled:opacity-50",children:[e.jsx(O,{className:`h-4 w-4 ${d?"animate-spin":""}`}),"Refresh"]})]}),e.jsx(ue,{contracts:m,onSelectContract:n=>t(n.contract_id),isLoading:l}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>t(null)}),e.jsx(pe,{contractId:s,onClose:()=>t(null),onReviewComplete:i})]})]})}function ke(){const[s,t]=o.useState("auto-execute");return e.jsxs("div",{className:"min-h-screen bg-gray-900 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(A,{className:"h-8 w-8 text-amber-400"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Founder Review"})]}),e.jsx("p",{className:"text-gray-400",children:"Unified dashboard for reviewing AUTO_EXECUTE decisions and CRM contracts"})]}),e.jsxs("div",{className:"flex gap-2 mb-6 border-b border-gray-700",children:[e.jsxs("button",{onClick:()=>t("auto-execute"),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors border-b-2 -mb-px ${s==="auto-execute"?"text-amber-400 border-amber-400":"text-gray-400 border-transparent hover:text-gray-300 hover:border-gray-600"}`,children:[e.jsx(ee,{className:"h-4 w-4"}),"AUTO_EXECUTE Decisions",e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-emerald-900/30 text-emerald-400 rounded",children:"Evidence-Only"})]}),e.jsxs("button",{onClick:()=>t("contracts"),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors border-b-2 -mb-px ${s==="contracts"?"text-blue-400 border-blue-400":"text-gray-400 border-transparent hover:text-gray-300 hover:border-gray-600"}`,children:[e.jsx(H,{className:"h-4 w-4"}),"Contract Review",e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-blue-900/30 text-blue-400 rounded",children:"Approve/Reject"})]})]}),s==="auto-execute"&&e.jsx(ce,{}),s==="contracts"&&e.jsx(ye,{})]})}export{ke as default};

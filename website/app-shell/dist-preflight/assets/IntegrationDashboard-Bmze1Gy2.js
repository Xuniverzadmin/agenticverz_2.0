import{U as L,r as N,j as e,ab as k,L as x,I as m}from"./index-KppIquYQ.js";import{u as j}from"./useQuery-DRhwJCEf.js";import{u as C}from"./useMutation-Ckq5ZrwF.js";import{l as v}from"./consoleLogger-DP-nEyqn.js";import{C as o}from"./Card-B-aopADT.js";import{B as h}from"./Badge-DKjttL2F.js";import{i as g}from"./integration-Bk4tj2MI.js";const y={strong:{label:"Strong",color:"bg-green-500"},weak:{label:"Weak",color:"bg-yellow-500"},novel:{label:"Novel",color:"bg-purple-500"}};function G(){const t=L(),[l,r]=N.useState(null);N.useEffect(()=>(v.componentMount("IntegrationDashboard"),()=>v.componentUnmount("IntegrationDashboard")),[]);const{data:s,isLoading:a}=j({queryKey:["integration","stats"],queryFn:()=>g.getStats(),refetchInterval:1e4}),{data:i,isLoading:u}=j({queryKey:["integration","checkpoints"],queryFn:()=>g.getPendingCheckpoints(),refetchInterval:5e3}),{data:c,isLoading:_}=j({queryKey:["integration","graduation"],queryFn:()=>g.getGraduationStatus(),refetchInterval:3e4}),f=C({mutationFn:({id:n,resolution:d})=>g.resolveCheckpoint(n,d),onSuccess:()=>{t.invalidateQueries({queryKey:["integration"]}),r(null)},onError:n=>{v.error("INTEGRATION","Failed to resolve checkpoint",n)}});return a||u||_?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(k,{size:"lg"})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-100",children:"Integration Loop Dashboard"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Self-improving feedback system: Incident â†’ Pattern â†’ Recovery â†’ Policy â†’ Routing"})]}),e.jsx(h,{variant:c!=null&&c.is_graduated?"success":"default",className:"text-lg px-4 py-2",children:(c==null?void 0:c.status)??"M25-ALPHA"})]}),c&&e.jsx(w,{graduation:c}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(p,{label:"Loops Today",value:(s==null?void 0:s.loops_today)??0,icon:"ðŸ”„"}),e.jsx(p,{label:"Complete",value:(s==null?void 0:s.loops_complete)??0,icon:"âœ“",highlight:!0}),e.jsx(p,{label:"Blocked",value:(s==null?void 0:s.loops_blocked)??0,icon:"â¸",alert:(s==null?void 0:s.loops_blocked)>0}),e.jsx(p,{label:"Avg Time",value:I((s==null?void 0:s.avg_completion_time_ms)??0),icon:"â±"})]}),(s==null?void 0:s.confidence_distribution)&&e.jsxs(o,{className:"p-6 bg-slate-800/50 border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Pattern Match Confidence"}),e.jsx("div",{className:"flex items-center gap-8",children:Object.entries(s.confidence_distribution).map(([n,d])=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded ${y[n].color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-100 font-medium",children:d}),e.jsx("p",{className:"text-sm text-gray-400",children:y[n].label})]})]},n))}),e.jsx(P,{distribution:s.confidence_distribution})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(b,{title:"Patterns Matched",value:(s==null?void 0:s.patterns_matched)??0,description:"Incidents matched to known patterns",icon:"ðŸ”"}),e.jsx(b,{title:"Recoveries Applied",value:(s==null?void 0:s.recoveries_applied)??0,description:"Recovery suggestions applied",icon:"ðŸ’¡"}),e.jsx(b,{title:"Policies Activated",value:(s==null?void 0:s.policies_activated)??0,description:"Policies promoted from shadow mode",icon:"ðŸ“‹"})]}),e.jsxs(o,{className:"p-6 bg-slate-800/50 border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-100",children:["Pending Human Decisions",i&&i.length>0&&e.jsx(h,{variant:"warning",className:"ml-3",children:i.length})]})}),!i||i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"âœ“"}),e.jsx("p",{className:"text-gray-400",children:"No pending decisions"}),e.jsx("p",{className:"text-sm text-gray-500",children:"All loops are progressing automatically"})]}):e.jsx("div",{className:"space-y-3",children:i.map(n=>e.jsx(A,{checkpoint:n,onResolve:d=>f.mutate({id:n.id,resolution:d}),isLoading:f.isPending},n.id))})]}),e.jsxs(o,{className:"p-6 bg-slate-800/50 border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(x,{to:"/integration/loops",children:e.jsx(m,{variant:"secondary",children:"View All Loops"})}),e.jsx(x,{to:"/failures",children:e.jsx(m,{variant:"secondary",children:"Pattern Catalog"})}),e.jsx(x,{to:"/recovery",children:e.jsx(m,{variant:"secondary",children:"Recovery Queue"})}),e.jsx(x,{to:"/operator/audit",children:e.jsx(m,{variant:"secondary",children:"Policy Audit Log"})})]})]})]})}function w({graduation:t}){const l=[{key:"gate1_prevention",gate:t.gates.gate1_prevention,icon:t.gates.gate1_prevention.passed?"âœ…":"ðŸ”’",number:"1"},{key:"gate2_rollback",gate:t.gates.gate2_rollback,icon:t.gates.gate2_rollback.passed?"âœ…":"ðŸ”’",number:"2"},{key:"gate3_console",gate:t.gates.gate3_console,icon:t.gates.gate3_console.passed?"âœ…":"ðŸ”’",number:"3"}],r=l.filter(s=>s.gate.passed).length;return e.jsxs(o,{className:`p-6 border ${t.is_graduated?"bg-green-900/30 border-green-600":"bg-slate-800/50 border-slate-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:t.is_graduated?"ðŸŽ“":"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100",children:"M25 Graduation Status"}),e.jsx("p",{className:"text-sm text-gray-400",children:t.is_graduated?"Loop-Proven: System demonstrably learns from failures":`Loop-Enabled: ${r}/3 gates passed`})]})]}),!t.is_graduated&&e.jsx(h,{variant:"warning",children:t.next_action})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:l.map(({key:s,gate:a,icon:i,number:u})=>e.jsxs("div",{className:`p-4 rounded-lg border ${a.passed?"bg-green-900/20 border-green-600/50":"bg-slate-700/30 border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xl",children:i}),e.jsxs("span",{className:"font-medium text-gray-100",children:["Gate ",u,": ",a.name]})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:a.description}),a.passed&&e.jsx(h,{variant:"success",className:"text-xs",children:"Passed"})]},s))}),e.jsxs("div",{className:"flex items-center gap-8 mt-4 pt-4 border-t border-slate-600/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Preventions"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-100",children:[t.prevention_stats.total,e.jsxs("span",{className:"text-sm text-gray-400 ml-1",children:["(",t.prevention_stats.rate,")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Regret Events"}),e.jsx("p",{className:"text-lg font-semibold text-gray-100",children:t.regret_stats.total_events})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Auto-Demotions"}),e.jsx("p",{className:"text-lg font-semibold text-gray-100",children:t.regret_stats.auto_demotions})]})]})]})}function p({label:t,value:l,icon:r,highlight:s,alert:a}){return e.jsxs(o,{className:`p-4 text-center ${a?"bg-red-900/30 border-red-600":s?"bg-green-900/30 border-green-600":"bg-slate-800/50 border-slate-700"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:r}),e.jsx("p",{className:`text-2xl font-bold ${a?"text-red-400":s?"text-green-400":"text-gray-100"}`,children:l}),e.jsx("p",{className:"text-sm text-gray-400",children:t})]})}function b({title:t,value:l,description:r,icon:s}){return e.jsxs(o,{className:"p-4 bg-slate-800/50 border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-xl",children:s}),e.jsx("span",{className:"font-medium text-gray-100",children:t})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-100",children:l.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:r})]})}function P({distribution:t}){const l=Object.values(t).reduce((r,s)=>r+s,0);return l===0?null:e.jsx("div",{className:"flex h-3 rounded-full overflow-hidden mt-4",children:["strong","weak","novel"].map(r=>{const s=t[r]??0,a=s/l*100;return a===0?null:e.jsx("div",{className:y[r].color,style:{width:`${a}%`},title:`${r}: ${s} (${a.toFixed(1)}%)`},r)})})}function A({checkpoint:t,onResolve:l,isLoading:r}){const s={approve_policy:"ðŸ“‹ Approve Policy",approve_recovery:"ðŸ’¡ Approve Recovery",simulate_routing:"ðŸ”€ Simulate Routing",revert_loop:"â†©ï¸ Revert Loop",override_guardrail:"âš ï¸ Override Guardrail"};return e.jsxs("div",{className:"p-4 bg-slate-700/50 rounded-lg border border-slate-600 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-amber-400",children:s[t.checkpoint_type]??t.checkpoint_type}),e.jsx(x,{to:`/integration/loop/${t.incident_id}`,className:"text-xs text-blue-400 hover:underline",children:"View Loop â†’"})]}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:t.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Created: ",new Date(t.created_at).toLocaleString()]})]}),e.jsx("div",{className:"flex gap-2",children:t.options.slice(0,2).map(a=>e.jsx(m,{size:"sm",variant:a.is_destructive?"danger":"primary",onClick:()=>l(a.action),disabled:r,children:a.label},a.action))})]})}function I(t){return t<1e3?`${t}ms`:t<6e4?`${(t/1e3).toFixed(1)}s`:`${(t/6e4).toFixed(1)}m`}export{G as IntegrationDashboard,G as default};

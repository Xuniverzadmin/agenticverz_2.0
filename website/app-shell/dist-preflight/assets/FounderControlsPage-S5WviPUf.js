import{f as k,z as v,r as i,j as e,o as c,A as T,S as M,C as U,n as B}from"./index-BnpC133k.js";import{C as O}from"./clock-C3lW4_yM.js";import{P}from"./power-Y7XTscuJ.js";import{R}from"./refresh-cw-C0UIxpEg.js";import{B as K}from"./BetaBanner-DQAvyW9k.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=k("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=k("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=k("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=k("ShieldOff",[["path",{d:"M19.7 14a6.9 6.9 0 0 0 .3-2V5l-8-3-3.2 1.2",key:"342pvf"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M4.7 4.7 4 5v7c0 6 8 10 8 10a20.3 20.3 0 0 0 5.62-4.38",key:"p0ycf4"}]]);async function I(s){return(await v.get("/v1/killswitch/status",{params:{tenant_id:s}})).data}async function q(s,r){return(await v.post("/v1/killswitch/tenant",r,{params:{tenant_id:s}})).data}async function Z(s,r="founder"){return(await v.delete("/v1/killswitch/tenant",{params:{tenant_id:s,actor:r}})).data}async function H(){return(await v.get("/v1/policies/active")).data}async function J(s){return(await v.get("/v1/incidents",{params:s})).data}async function Q(){return(await v.get("/ops/customers",{params:{limit:100}})).data.map(r=>({tenant_id:r.tenant_id,tenant_name:r.tenant_name}))}const L=15e3;function F(s){return s?new Date(s).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"-"}function C(s,r=12){return s?s.length>r?`${s.substring(0,r)}...`:s:"-"}function D({isOpen:s,title:r,message:a,confirmLabel:f,isDestructive:z,onConfirm:o,onCancel:p,reasonRequired:x,reason:h,onReasonChange:y}){if(!s)return null;const m=!x||h&&h.trim().length>0;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:p}),e.jsxs("div",{className:"relative bg-gray-900 border border-gray-700 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:r}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:a}),x&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Reason (required)"}),e.jsx("input",{type:"text",value:h||"",onChange:b=>y==null?void 0:y(b.target.value),placeholder:"Enter reason for this action...",className:"w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded text-sm text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:o,disabled:!m,className:c("px-4 py-2 rounded text-sm text-white transition-colors",z?"bg-red-600 hover:bg-red-500 disabled:bg-red-900 disabled:cursor-not-allowed":"bg-green-600 hover:bg-green-500 disabled:bg-green-900 disabled:cursor-not-allowed"),children:f})]})]})]})}function W({tenantId:s,tenantName:r,state:a,isLoading:f,onRefresh:z,onFreeze:o,onUnfreeze:p}){const[x,h]=i.useState(!1),[y,m]=i.useState(!1),[b,N]=i.useState(!1),[g,w]=i.useState(""),u=(a==null?void 0:a.tenant.is_frozen)??!1,j=()=>{o(g),m(!1),w("")},S=()=>{p(),N(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:c("border rounded bg-gray-900/50 overflow-hidden",u?"border-red-500/50":"border-gray-800"),children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>h(!x),className:"text-gray-500 hover:text-white",children:x?e.jsx(U,{className:"w-4 h-4"}):e.jsx(B,{className:"w-4 h-4"})}),e.jsx(A,{className:c("w-5 h-5",u?"text-red-500":"text-gray-500")}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-white",children:r||C(s)}),r&&e.jsx("span",{className:"text-xs font-mono text-gray-500",children:C(s)})]})}),e.jsx("span",{className:c("text-xs font-bold uppercase tracking-wide px-2 py-1 rounded",u?"bg-red-950 text-red-400":"bg-green-950 text-green-400"),children:u?"FROZEN":"ACTIVE"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:z,disabled:f,className:"p-1.5 rounded hover:bg-gray-800 text-gray-500 hover:text-white transition-colors",children:e.jsx(R,{className:c("w-4 h-4",f&&"animate-spin")})}),u?e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-600 hover:bg-green-500 rounded text-sm text-white transition-colors",children:[e.jsx(V,{className:"w-4 h-4"}),"Unfreeze"]}):e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-600 hover:bg-red-500 rounded text-sm text-white transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Freeze"]})]})]})}),x&&a&&e.jsxs("div",{className:"border-t border-gray-800 p-4 bg-gray-950/50",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"text-gray-500 uppercase text-xs tracking-wide mb-2",children:"Tenant State"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500 min-w-32",children:"is_frozen:"}),e.jsx("span",{className:"text-gray-200",children:String(a.tenant.is_frozen)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500 min-w-32",children:"frozen_at:"}),e.jsx("span",{className:"text-gray-200 font-mono text-xs",children:F(a.tenant.frozen_at)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500 min-w-32",children:"frozen_by:"}),e.jsx("span",{className:"text-gray-200",children:a.tenant.frozen_by||"-"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500 min-w-32",children:"freeze_reason:"}),e.jsx("span",{className:"text-gray-200",children:a.tenant.freeze_reason||"-"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500 min-w-32",children:"auto_triggered:"}),e.jsx("span",{className:"text-gray-200",children:String(a.tenant.auto_triggered)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500 min-w-32",children:"trigger_type:"}),e.jsx("span",{className:"text-gray-200",children:a.tenant.trigger_type||"-"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-500 min-w-32",children:"effective_state:"}),e.jsx("span",{className:c("font-bold",a.effective_state==="frozen"?"text-red-400":"text-green-400"),children:a.effective_state.toUpperCase()})]})]}),a.keys.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"text-gray-500 uppercase text-xs tracking-wide mb-2",children:["API Keys (",a.keys.length,")"]}),a.keys.map(d=>e.jsx("div",{className:c("p-3 rounded border",d.is_frozen?"border-red-500/30 bg-red-950/20":"border-gray-800 bg-gray-900/50"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:c("w-4 h-4",d.is_frozen?"text-red-400":"text-gray-500")}),e.jsx("span",{className:"font-mono text-xs text-gray-300",children:C(d.key_id)}),e.jsx("span",{className:c("text-xs font-bold",d.is_frozen?"text-red-400":"text-green-400"),children:d.is_frozen?"FROZEN":"ACTIVE"}),d.is_frozen&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["at ",F(d.frozen_at)]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["by ",d.frozen_by]})]})]})},d.key_id))]})]})]}),e.jsx(D,{isOpen:y,title:"Freeze Tenant",message:`This will immediately freeze all operations for tenant "${r||s}". No in-flight retries. Sticky until manually lifted.`,confirmLabel:"Freeze Tenant",isDestructive:!0,reasonRequired:!0,reason:g,onReasonChange:w,onConfirm:j,onCancel:()=>{m(!1),w("")}}),e.jsx(D,{isOpen:b,title:"Unfreeze Tenant",message:`This will reactivate all operations for tenant "${r||s}".`,confirmLabel:"Unfreeze Tenant",isDestructive:!1,onConfirm:S,onCancel:()=>N(!1)})]})}function X({guardrail:s}){return e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-900/50 rounded border border-gray-800",children:[e.jsx(M,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-white",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.description})]}),e.jsx("span",{className:"text-xs font-mono text-gray-500",children:s.category}),e.jsx("span",{className:"text-xs uppercase text-yellow-400",children:s.action}),e.jsx("span",{className:c("text-xs",s.is_enabled?"text-green-400":"text-gray-500"),children:s.is_enabled?"ENABLED":"DISABLED"})]})}function Y({incident:s}){return e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-900/50 rounded border border-gray-800",children:[e.jsx(T,{className:c("w-4 h-4",s.severity==="critical"?"text-red-500":s.severity==="high"?"text-orange-500":s.severity==="medium"?"text-yellow-500":"text-gray-500")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-white",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.calls_affected," calls affected | ",s.cost_delta_cents/100," USD"]})]}),e.jsx("span",{className:"text-xs font-mono text-gray-500",children:s.trigger_type}),e.jsx("span",{className:c("text-xs uppercase",s.status==="open"?"text-red-400":s.status==="acknowledged"?"text-yellow-400":"text-green-400"),children:s.status}),e.jsx("span",{className:"text-xs font-mono text-gray-500",children:F(s.started_at)})]})}function ne(){const[s,r]=i.useState([]),[a,f]=i.useState({}),[z,o]=i.useState(new Set),[p,x]=i.useState([]),[h,y]=i.useState([]),[m,b]=i.useState(!0),[N,g]=i.useState(null),[w,u]=i.useState(null),j=i.useCallback(async t=>{o(n=>new Set(n).add(t));try{const n=await I(t);f(l=>({...l,[t]:n}))}catch(n){console.error(`Failed to fetch state for tenant ${t}:`,n),f(l=>({...l,[t]:null}))}finally{o(n=>{const l=new Set(n);return l.delete(t),l})}},[]),S=async(t,n)=>{o(l=>new Set(l).add(t));try{await q(t,{reason:n,actor:"founder"}),await j(t)}catch(l){console.error(`Failed to freeze tenant ${t}:`,l),g(l instanceof Error?l.message:"Failed to freeze tenant")}},d=async t=>{o(n=>new Set(n).add(t));try{await Z(t,"founder"),await j(t)}catch(n){console.error(`Failed to unfreeze tenant ${t}:`,n),g(n instanceof Error?n.message:"Failed to unfreeze tenant")}},_=i.useCallback(async()=>{try{b(!0);const[t,n]=await Promise.all([Q().catch(()=>[]),H().catch(()=>[])]);r(t),x(n);for(const l of t)j(l.tenant_id);if(t.length>0){const l=await J({tenant_id:t[0].tenant_id,limit:10}).catch(()=>[]);y(l)}u(new Date),g(null)}catch(t){g(t instanceof Error?t.message:"Failed to fetch data")}finally{b(!1)}},[j]);i.useEffect(()=>{_()},[_]),i.useEffect(()=>{const t=setInterval(_,L);return()=>clearInterval(t)},[_]);const E=Object.values(a).filter(t=>t==null?void 0:t.tenant.is_frozen).length;return e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsxs("div",{className:"min-h-screen bg-gray-950",children:[e.jsx("div",{className:"bg-gray-900 border-b border-gray-800 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-red-500"}),"Founder Controls"]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Kill-switch operations. Freeze or unfreeze tenants and keys."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Tenants: "}),e.jsx("span",{className:"text-white",children:s.length}),E>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-500",children:" | "}),e.jsxs("span",{className:"text-red-400",children:[E," frozen"]})]})]}),w&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(O,{className:"w-3 h-3"}),w.toLocaleTimeString()]}),e.jsxs("button",{onClick:_,disabled:m,className:"flex items-center gap-2 px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded text-sm text-white transition-colors",children:[e.jsx(R,{className:c("w-4 h-4",m&&"animate-spin")}),"Refresh"]})]})]})}),e.jsxs("div",{className:"p-6 max-w-6xl mx-auto space-y-8",children:[N&&e.jsxs("div",{className:"p-4 bg-red-950/30 border border-red-500/50 rounded text-red-400 text-sm flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),N,e.jsx("button",{onClick:()=>g(null),className:"ml-auto text-red-400 hover:text-white",children:"Dismiss"})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-gray-500"}),"Tenants"]}),s.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500 bg-gray-900/50 rounded border border-gray-800",children:"No tenants found"}):e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsx(W,{tenantId:t.tenant_id,tenantName:t.tenant_name,state:a[t.tenant_id]||null,isLoading:z.has(t.tenant_id),onRefresh:()=>j(t.tenant_id),onFreeze:n=>S(t.tenant_id,n),onUnfreeze:()=>d(t.tenant_id)},t.tenant_id))})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-500"}),"Active Guardrails"]}),p.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500 bg-gray-900/50 rounded border border-gray-800",children:"No guardrails configured"}):e.jsx("div",{className:"space-y-2",children:p.map(t=>e.jsx(X,{guardrail:t},t.id))})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-yellow-500"}),"Recent Incidents"]}),h.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500 bg-gray-900/50 rounded border border-gray-800",children:"No recent incidents"}):e.jsx("div",{className:"space-y-2",children:h.map(t=>e.jsx(Y,{incident:t},t.id))})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 px-6 py-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Phase 5E-2: Kill-Switch UI Toggle"}),e.jsxs("span",{children:["Polling every ",L/1e3,"s | RBAC: killswitch:read, killswitch:activate, killswitch:reset"]})]})})]})]})}export{ne as default};

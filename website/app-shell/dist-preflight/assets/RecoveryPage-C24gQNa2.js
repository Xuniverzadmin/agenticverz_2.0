import{S as d,r as y,U as N,j as e,I as x,ab as b,E as j,H as C,ad as R}from"./index-KppIquYQ.js";import{u as g}from"./useQuery-DRhwJCEf.js";import{u as v}from"./useMutation-Ckq5ZrwF.js";import{A as E}from"./activity-DcrdMZEZ.js";import{R as S}from"./refresh-cw-C5XbiSIu.js";import{Z as w}from"./zap-DEPEK6eb.js";import{C as i,a as n,b as _}from"./Card-B-aopADT.js";import{S as A}from"./Badge-DKjttL2F.js";import{l}from"./consoleLogger-DP-nEyqn.js";async function q(r){try{const{data:a}=await d.get("/api/v1/recovery/candidates",{params:r});return Array.isArray(a)?a:(a==null?void 0:a.items)||[]}catch{return[]}}async function F(r){await d.delete(`/api/v1/recovery/candidates/${r}`)}async function k(){try{const{data:r}=await d.get("/api/v1/recovery/stats");return r}catch{return{total_candidates:0,approved:0,rejected:0,executed:0,success_rate:0}}}async function z(r){const{data:a}=await d.post("/api/v1/recovery/approve",{candidate_id:r});return a}function O(){const[r,a]=y.useState(""),c=N();y.useEffect(()=>(l.componentMount("RecoveryPage"),()=>l.componentUnmount("RecoveryPage")),[]);const{data:m,isLoading:h,refetch:f}=g({queryKey:["recovery-candidates",r],queryFn:()=>q({limit:50,status:r||void 0}),refetchInterval:3e4}),{data:t}=g({queryKey:["recovery-stats"],queryFn:k,refetchInterval:6e4}),u=v({mutationFn:s=>z(s),onSuccess:()=>{c.invalidateQueries({queryKey:["recovery-candidates"]}),c.invalidateQueries({queryKey:["recovery-stats"]}),c.invalidateQueries({queryKey:["failures"]})},onError:s=>{l.error("RECOVERY","Failed to approve candidate",s)}}),p=v({mutationFn:s=>F(s),onSuccess:()=>{c.invalidateQueries({queryKey:["recovery-candidates"]}),c.invalidateQueries({queryKey:["recovery-stats"]})},onError:s=>{l.error("RECOVERY","Failed to reject candidate",s)}}),o=Array.isArray(m)?m:[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:"Self-Healing Engine"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"AI-suggested recovery actions for failed executions"})]}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>f(),children:e.jsx(S,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsxs(n,{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Candidates"}),e.jsx("p",{className:"text-2xl font-semibold",children:(t==null?void 0:t.total_candidates)||0})]})}),e.jsx(i,{children:e.jsxs(n,{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Approved"}),e.jsx("p",{className:"text-2xl font-semibold text-green-600",children:(t==null?void 0:t.approved)||0})]})}),e.jsx(i,{children:e.jsxs(n,{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Executed"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:(t==null?void 0:t.executed)||0})]})}),e.jsx(i,{children:e.jsxs(n,{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-semibold text-purple-600",children:[(t==null?void 0:t.success_rate)||0,"%"]})]})})]}),e.jsx(i,{children:e.jsx(n,{children:e.jsx("div",{className:"flex gap-4",children:e.jsxs("select",{className:"px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:border-gray-700",value:r,onChange:s=>a(s.target.value),children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"executed",children:"Executed"})]})})})}),e.jsxs(i,{children:[e.jsx(_,{title:`Recovery Candidates (${o.length})`}),e.jsx(n,{className:"p-0",children:h?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(b,{size:"lg"})}):o.length>0?e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:o.map(s=>e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(w,{className:j("size-5",s.confidence>.8?"text-green-500":s.confidence>.5?"text-yellow-500":"text-gray-400")}),e.jsx("span",{className:"font-medium",children:s.suggested_action}),e.jsxs("span",{className:j("text-xs px-2 py-0.5 rounded-full",s.confidence>.8?"bg-green-100 text-green-700":s.confidence>.5?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:[Math.round(s.confidence*100),"% confidence"]}),e.jsx(A,{status:s.status})]}),s.reasoning&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 ml-8",children:s.reasoning}),e.jsxs("div",{className:"mt-2 ml-8 flex gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["Failure: ",s.failure_id]}),s.estimated_cost_cents&&e.jsxs("span",{children:["Est. Cost: $",(s.estimated_cost_cents/100).toFixed(2)]}),e.jsx("span",{children:new Date(s.created_at).toLocaleString()})]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(x,{size:"sm",variant:"primary",onClick:()=>u.mutate(s.id),disabled:u.isPending,children:[e.jsx(C,{size:14,className:"mr-1"}),"Approve"]}),e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>p.mutate(s.id),disabled:p.isPending,children:[e.jsx(R,{size:14,className:"mr-1"}),"Reject"]})]})]})},s.id))}):e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(E,{className:"mx-auto mb-2 text-gray-400",size:32}),"No recovery candidates"]})})]})]})}export{O as default};

var ke=Object.defineProperty;var Ce=(t,s,a)=>s in t?ke(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var P=(t,s,a)=>Ce(t,typeof s!="symbol"?s+"":s,a);import{c as $,r as x,j as e,u as B,S as I,R as Se,K as Ie,I as re,Q as De,L as Ee,T as Te,b as Ae,a as $e,U as Re,V as Pe,W as ne,X as le,Y as Le,Z as A,_ as ie}from"./index-Cumb797X.js";import{B as Oe}from"./BetaBanner-Cckqpaum.js";import{R as Me,C as Fe}from"./RendererContext-BJbYF88q.js";import{u as T}from"./useQuery-CCaJ6Z3y.js";import{a as C}from"./client-BT2DjEOZ.js";import{l as y}from"./consoleLogger-DP-nEyqn.js";import{u as K}from"./useMutation-C_rcEF1p.js";import{A as qe}from"./activity-QuL4-Ix7.js";import{A as Ke}from"./arrow-left-cOfIbyzx.js";import{C as z,E as Ue}from"./CanonicalBreadcrumb-6lySsekK.js";import{F as Ge}from"./file-text-NODVhE7d.js";import{P as Be}from"./play-YcwUJuE-.js";import{S as Ve}from"./shield-D5PAFrWQ.js";import{X as ze}from"./x-circle-B69a43uT.js";import{t as We}from"./truncateValue-DZkKoP9l.js";import"./index-B9ygI19o.js";import"./chevron-right-BdTgfrGY.js";const S=()=>$.getState().tenantId||"demo-tenant",E={getStatus:async()=>(await C.get("/guard/status",{params:{tenant_id:S()}})).data,getTodaySnapshot:async()=>(await C.get("/guard/snapshot/today",{params:{tenant_id:S()}})).data,activateKillSwitch:async()=>{await C.post("/guard/killswitch/activate",null,{params:{tenant_id:S()}})},deactivateKillSwitch:async()=>{await C.post("/guard/killswitch/deactivate",null,{params:{tenant_id:S()}})},getIncidents:async t=>(await C.get("/guard/incidents",{params:{...t,tenant_id:S()}})).data,getIncidentDetail:async t=>(await C.get(`/guard/incidents/${t}`,{params:{tenant_id:S()}})).data,acknowledgeIncident:async t=>{await C.post(`/guard/incidents/${t}/acknowledge`,null,{params:{tenant_id:S()}})},resolveIncident:async t=>{await C.post(`/guard/incidents/${t}/resolve`,null,{params:{tenant_id:S()}})},replayCall:async t=>(await C.post(`/guard/replay/${t}`,null,{params:{tenant_id:S()}})).data,getApiKeys:async()=>(await C.get("/guard/keys",{params:{tenant_id:S()}})).data,freezeApiKey:async t=>{await C.post(`/guard/keys/${t}/freeze`,null,{params:{tenant_id:S()}})},unfreezeApiKey:async t=>{await C.post(`/guard/keys/${t}/unfreeze`,null,{params:{tenant_id:S()}})},getSettings:async()=>(await C.get("/guard/settings",{params:{tenant_id:S()}})).data,searchIncidents:async t=>(await C.post("/guard/incidents/search",t,{params:{tenant_id:S()}})).data,getDecisionTimeline:async t=>(await C.get(`/guard/incidents/${t}/timeline`,{params:{tenant_id:S()}})).data,seedDemoIncident:async(t="contract_autorenew")=>(await C.post("/guard/demo/seed-incident",{scenario:t},{params:{tenant_id:S()}})).data,exportEvidenceReport:async(t,s)=>{const a={tenant_id:S(),include_replay:(s==null?void 0:s.includeReplay)??!0,include_prevention:(s==null?void 0:s.includePrevention)??!0,is_demo:(s==null?void 0:s.isDemo)??!0};return(await C.post(`/guard/incidents/${t}/export`,null,{params:a,responseType:"blob"})).data},downloadEvidenceReport:async(t,s)=>{const a=await E.exportEvidenceReport(t,s),r=window.URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.setAttribute("download",`evidence_report_${t}_${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(r)},getStrategyHealth:async()=>{try{return(await C.get("/api/v1/sba/health",{headers:{"X-Tenant-ID":S()}})).data}catch{return{total_agents:0,healthy_count:0,approaching_bounds_count:0,exceeded_count:0,status:"unknown",last_evaluated_at:null}}}},de={failureThreshold:3,recoveryTimeout:3e4};class He{constructor(){P(this,"circuits",new Map)}getState(s){return this.circuits.has(s)||this.circuits.set(s,{state:"closed",failures:0,lastFailure:null,nextRetry:null}),this.circuits.get(s)}recordSuccess(s){const a=this.getState(s);a.state="closed",a.failures=0,a.lastFailure=null,a.nextRetry=null}recordFailure(s){const a=this.getState(s);if(a.failures++,a.lastFailure=new Date,a.failures>=de.failureThreshold){const r=a.state==="open";a.state="open",a.nextRetry=new Date(Date.now()+de.recoveryTimeout),r||console.debug(`[CircuitBreaker] Circuit OPEN for ${s}`)}}canRequest(s){const a=this.getState(s);return a.state==="closed"?!0:a.state==="open"?a.nextRetry&&new Date>=a.nextRetry?(a.state="half-open",!0):!1:!0}getAllStates(){const s={};return this.circuits.forEach((a,r)=>{s[r]={...a}}),s}}const U=new He,W=[{path:"/guard/status",name:"Status",critical:!0},{path:"/guard/snapshot/today",name:"Snapshot",critical:!0},{path:"/guard/incidents",name:"Incidents",critical:!1}];class Ye{constructor(){P(this,"health",new Map);P(this,"checkInterval",null);P(this,"listeners",new Set);W.forEach(s=>{this.health.set(s.path,{endpoint:s.path,status:"healthy",lastCheck:new Date,lastSuccess:null,lastError:null,responseTime:0,failureCount:0,successCount:0})})}async checkEndpoint(s,a="demo-tenant"){var c;const r=this.health.get(s)||{endpoint:s,status:"healthy",lastCheck:new Date,lastSuccess:null,lastError:null,responseTime:0,failureCount:0,successCount:0},n=performance.now();try{const i=await C.get(s,{params:{tenant_id:a},timeout:5e3}),l=performance.now()-n;r.status=l>2e3?"degraded":"healthy",r.lastCheck=new Date,r.lastSuccess=new Date,r.lastError=null,r.responseTime=l,r.successCount++,r.failureCount=0,U.recordSuccess(s)}catch(i){r.status="down",r.lastCheck=new Date,r.lastError=(c=i==null?void 0:i.response)!=null&&c.status?`HTTP ${i.response.status}`:(i==null?void 0:i.message)||"Unknown error",r.responseTime=performance.now()-n,r.failureCount++,U.recordFailure(s)}return this.health.set(s,r),r}async checkAll(s="demo-tenant"){const a=await Promise.all(W.map(d=>this.checkEndpoint(d.path,s))),r={};a.forEach(d=>{r[d.endpoint]=d});const n=W.filter(d=>d.critical).some(d=>{var v;return((v=r[d.path])==null?void 0:v.status)==="down"}),c=a.some(d=>d.status==="down"),i=a.some(d=>d.status==="degraded");let l;n?l="down":c||i?l="degraded":l="healthy";const m={overall:l,endpoints:r,circuits:U.getAllStates(),lastFullCheck:new Date};return this.listeners.forEach(d=>d(m)),m}startPeriodicCheck(s=3e4,a="demo-tenant"){this.checkInterval&&clearInterval(this.checkInterval),this.checkAll(a),this.checkInterval=setInterval(()=>{this.checkAll(a)},s)}stopPeriodicCheck(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}subscribe(s){return this.listeners.add(s),()=>this.listeners.delete(s)}getHealth(){const s={};this.health.forEach((n,c)=>{s[c]=n});const a=Array.from(this.health.values()).some(n=>n.status==="down"),r=Array.from(this.health.values()).some(n=>n.status==="degraded");return{overall:a?"down":r?"degraded":"healthy",endpoints:s,circuits:U.getAllStates(),lastFullCheck:new Date}}}const M=new Ye;function Qe({showDetails:t=!1,position:s="inline"}){const[a,r]=x.useState(null),[n,c]=x.useState(!1);if(x.useEffect(()=>{r(M.getHealth());const d=M.subscribe(r);return M.startPeriodicCheck(3e4),()=>{d()}},[]),!a)return null;const l={healthy:{color:"bg-green-500",text:"text-green-400",bg:"bg-green-500/20",border:"border-green-500/50",label:"All Systems Operational",icon:"âœ“"},degraded:{color:"bg-amber-500",text:"text-amber-400",bg:"bg-amber-500/20",border:"border-amber-500/50",label:"Degraded Performance",icon:"âš "},down:{color:"bg-red-500",text:"text-red-400",bg:"bg-red-500/20",border:"border-red-500/50",label:"Service Disruption",icon:"âœ•"}}[a.overall],m={"top-right":"fixed top-4 right-4 z-50","bottom-right":"fixed bottom-4 right-4 z-50",inline:""};return e.jsxs("div",{className:m[s],children:[e.jsxs("button",{onClick:()=>t&&c(!n),className:`
          flex items-center gap-2 px-3 py-1.5 rounded-lg border
          ${l.bg} ${l.border} ${l.text}
          ${t?"cursor-pointer hover:opacity-80":"cursor-default"}
          transition-all
        `,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l.color} animate-pulse`}),e.jsx("span",{className:"text-sm font-medium",children:l.label}),t&&e.jsx("span",{className:"text-xs opacity-60",children:n?"â–²":"â–¼"})]}),t&&n&&e.jsxs("div",{className:`
          mt-2 p-4 rounded-lg border bg-slate-800 border-slate-700
          ${s!=="inline"?"w-80 shadow-xl":""}
        `,children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-200 mb-3",children:"Endpoint Status"}),e.jsx("div",{className:"space-y-2",children:Object.values(a.endpoints).map(d=>e.jsx(Xe,{endpoint:d},d.endpoint))}),Object.keys(a.circuits).length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-200 mt-4 mb-2",children:"Circuit Breakers"}),e.jsx("div",{className:"space-y-1",children:Object.entries(a.circuits).map(([d,v])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-slate-400 truncate",children:d}),e.jsx("span",{className:`
                      px-1.5 py-0.5 rounded
                      ${v.state==="closed"?"bg-green-500/20 text-green-400":""}
                      ${v.state==="open"?"bg-red-500/20 text-red-400":""}
                      ${v.state==="half-open"?"bg-amber-500/20 text-amber-400":""}
                    `,children:v.state})]},d))})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:["Last check: ",a.lastFullCheck.toLocaleTimeString()]}),e.jsx("button",{onClick:()=>M.checkAll(),className:"text-xs text-blue-400 hover:text-blue-300",children:"Refresh"})]})]})]})}function Xe({endpoint:t}){const s={healthy:"bg-green-500",degraded:"bg-amber-500",down:"bg-red-500"};return e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 bg-slate-900/50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s[t.status]}`}),e.jsx("span",{className:"text-sm text-slate-300 truncate max-w-[150px]",children:t.endpoint.replace("/guard/","")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-slate-500",children:t.responseTime>0?`${Math.round(t.responseTime)}ms`:"â€”"}),t.status==="down"&&t.lastError&&e.jsx("span",{className:"text-red-400",children:t.lastError})]})]})}class Je extends x.Component{constructor(a){super(a);P(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){var n,c;console.error("[ErrorBoundary] Caught error:",a),console.error("[ErrorBoundary] Component stack:",r.componentStack),this.setState({errorInfo:r}),(c=(n=this.props).onError)==null||c.call(n,a,r)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full bg-slate-800 rounded-xl border border-red-500/50 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"âš ï¸"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-red-400",children:"Something went wrong"}),e.jsx("p",{className:"text-sm text-slate-400",children:"The application encountered an error"})]})]}),this.state.error&&e.jsx("div",{className:"bg-slate-900 rounded-lg p-3 mb-4 overflow-x-auto",children:e.jsx("code",{className:"text-sm text-red-300",children:this.state.error.message})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:this.handleRetry,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition-colors",children:"Reload Page"})]}),e.jsx("p",{className:"mt-4 text-xs text-slate-500 text-center",children:"If this problem persists, please contact support."})]})}):this.props.children}}const be=[{id:"overview",label:"Overview",icon:"ðŸ“Š",description:"Is the system okay right now?"},{id:"activity",label:"Activity",icon:"âš¡",description:"What ran / is running?"},{id:"incidents",label:"Incidents",icon:"ðŸ””",description:"What went wrong?"},{id:"policies",label:"Policies",icon:"ðŸ“œ",description:"How is behavior defined?"},{id:"logs",label:"Logs",icon:"ðŸ“‹",description:"What is the raw truth?"},{id:"integrations",label:"Integrations",icon:"ðŸ”—",description:"Connected services & webhooks"},{id:"keys",label:"API Keys",icon:"ðŸ”‘",description:"Manage access keys"}],J=[{id:"settings",label:"Settings",icon:"âš™ï¸",description:"Configuration"},{id:"account",label:"Account",icon:"ðŸ‘¤",description:"Organization & team"}],Ze=[...be,...J],et={live:{label:"LIVE",color:"text-green-400",pulse:!0},demo:{label:"DEMO",color:"text-amber-400",pulse:!1},staging:{label:"STAGING",color:"text-blue-400",pulse:!1}},tt={protected:{label:"Protected",color:"text-accent-success",bg:"bg-navy-elevated",border:"border-accent-success/30"},at_risk:{label:"At Risk",color:"text-accent-warning",bg:"bg-navy-elevated",border:"border-accent-warning/30"},stopped:{label:"Stopped",color:"text-accent-danger",bg:"bg-navy-elevated",border:"border-accent-danger/30"}};function st({children:t,activeTab:s,onTabChange:a,onLogout:r,user:n}){var u,w;const c=$(g=>g.isAuthenticated),i=$(g=>g.tenantId),[l,m]=x.useState(!1),d=x.useRef(null);x.useEffect(()=>{function g(b){d.current&&!d.current.contains(b.target)&&m(!1)}return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]);const v=J.some(g=>g.id===s);x.useEffect(()=>{if(!c)return;const g=setTimeout(()=>{M.startPeriodicCheck(3e4,i||"demo-tenant")},500);return()=>{clearTimeout(g),M.stopPeriodicCheck()}},[c,i]);const{data:p}=T({queryKey:["guard","status"],queryFn:E.getStatus,refetchInterval:5e3,staleTime:4e3}),{data:h}=T({queryKey:["guard","snapshot"],queryFn:E.getTodaySnapshot,refetchInterval:3e4,staleTime:1e4}),f=p!=null&&p.is_frozen?"stopped":((h==null?void 0:h.incidents_prevented)??0)>0?"at_risk":"protected",o=tt[f],_=(p==null?void 0:p.mode)||"demo",N=et[_];return e.jsx(Je,{children:e.jsxs("div",{className:"min-h-screen bg-navy-app text-slate-100 flex",children:[e.jsxs("aside",{className:"w-64 bg-navy-surface border-r border-navy-border flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-navy-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent-info to-accent-primary rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"ðŸ›¡ï¸"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg",children:"AI Console"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Customer Console"})]})]})}),e.jsxs("div",{className:"p-4 border-b border-navy-border",children:[e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${o.bg} ${o.border} border`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full bg-current ${o.color} animate-pulse`}),e.jsx("span",{className:`font-medium ${o.color}`,children:o.label})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-navy-subtle rounded p-2",children:[e.jsx("span",{className:"text-slate-400",children:"Today"}),e.jsx("span",{className:"block font-bold",children:((u=h==null?void 0:h.requests_today)==null?void 0:u.toLocaleString())??"0"})]}),e.jsxs("div",{className:"bg-navy-subtle rounded p-2",children:[e.jsx("span",{className:"text-slate-400",children:"Blocked"}),e.jsx("span",{className:"block font-bold text-accent-success",children:(h==null?void 0:h.incidents_prevented)??0})]})]})]}),e.jsx("nav",{className:"flex-1 p-2 space-y-1",children:be.map(g=>e.jsxs("button",{onClick:()=>a(g.id),className:`
                  w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left transition-colors
                  ${s===g.id?"bg-navy-elevated text-accent-info border border-accent-info/30":"hover:bg-navy-elevated text-slate-300"}
                `,children:[e.jsx("span",{className:"text-lg",children:g.icon}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:g.label}),s===g.id&&e.jsx("span",{className:"block text-xs text-slate-400",children:g.description})]})]},g.id))}),e.jsx("div",{className:"p-4 border-t border-navy-border",children:e.jsx(Qe,{showDetails:!0,position:"inline"})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("header",{className:"h-14 bg-navy-surface border-b border-navy-border px-6 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("h2",{className:"text-lg font-semibold",children:(w=Ze.find(g=>g.id===s))==null?void 0:w.label})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full border border-current/30 ${N.color}`,children:[N.pulse&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-current animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:N.label})]}),p!=null&&p.is_frozen?e.jsxs("button",{className:"px-3 py-1.5 border border-accent-success/50 text-accent-success hover:bg-navy-elevated rounded-lg text-sm font-medium flex items-center gap-2 transition-colors",children:[e.jsx("span",{children:"â–¶"})," Resume"]}):e.jsxs("button",{className:"px-3 py-1.5 border border-accent-danger/50 text-accent-danger hover:bg-navy-elevated rounded-lg text-sm font-medium flex items-center gap-2 transition-colors",children:[e.jsx("span",{children:"â¹"})," Stop"]}),e.jsxs("div",{className:"relative",ref:d,children:[e.jsxs("button",{onClick:()=>m(!l),className:`
                    px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors
                    ${v?"bg-navy-elevated text-accent-info border border-accent-info/30":"text-slate-300 hover:text-white hover:bg-navy-elevated border border-transparent"}
                  `,children:[e.jsx("span",{children:"ðŸ‘¤"}),e.jsx("span",{children:(n==null?void 0:n.name)||"Account"}),e.jsx("span",{className:`transition-transform ${l?"rotate-180":""}`,children:"â–¾"})]}),l&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-navy-surface border border-navy-border rounded-xl shadow-lg z-50 overflow-hidden",children:[n&&e.jsxs("div",{className:"px-4 py-3 border-b border-navy-border",children:[e.jsx("div",{className:"font-medium text-white",children:n.name}),e.jsx("div",{className:"text-xs text-slate-400",children:n.email})]}),e.jsx("div",{className:"py-2",children:J.map(g=>e.jsxs("button",{onClick:()=>{a(g.id),m(!1)},className:`
                            w-full flex items-center gap-3 px-4 py-2.5 text-left transition-colors
                            ${s===g.id?"bg-navy-elevated text-accent-info":"text-slate-300 hover:bg-navy-elevated hover:text-white"}
                          `,children:[e.jsx("span",{children:g.icon}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:g.label}),e.jsx("span",{className:"block text-xs text-slate-400",children:g.description})]})]},g.id))}),r&&e.jsx("div",{className:"border-t border-navy-border py-2",children:e.jsxs("button",{onClick:()=>{m(!1),r()},className:"w-full flex items-center gap-3 px-4 py-2.5 text-left text-slate-400 hover:bg-navy-elevated hover:text-white transition-colors",children:[e.jsx("span",{children:"ðŸšª"}),e.jsx("span",{className:"font-medium",children:"Logout"})]})})]})]})]})]}),e.jsx("main",{className:"flex-1 overflow-auto bg-navy-app",children:t})]})]})})}function at(t){const a=new Date().getTime()-t.getTime(),r=Math.floor(a/1e3),n=Math.floor(r/60),c=Math.floor(n/60);return r<60?"just now":n<60?`${n}m ago`:c<24?`${c}h ago`:t.toLocaleDateString()}const rt={protected:{label:"PROTECTED",subtitle:"All systems operational. Your AI is running safely.",color:"text-accent-success",border:"border-accent-success/40",icon:"âœ“"},attention_needed:{label:"ATTENTION NEEDED",subtitle:"Some items need your review. Nothing urgent.",color:"text-accent-warning",border:"border-accent-warning/40",icon:"!"},action_required:{label:"ACTION REQUIRED",subtitle:"Critical items need your attention now.",color:"text-accent-danger",border:"border-accent-danger/40",icon:"!!"}},ce={success:"text-accent-success",info:"text-slate-400",warning:"text-accent-warning"};function nt(){var c;const t=B();x.useEffect(()=>(y.componentMount("CustomerOverviewPage"),()=>y.componentUnmount("CustomerOverviewPage")),[]);const{data:s,isLoading:a}=T({queryKey:["guard","overview"],queryFn:async()=>{const[i,l]=await Promise.all([E.getStatus(),E.getTodaySnapshot()]);let m="protected";i.is_frozen?m="action_required":((l==null?void 0:l.incidents_prevented)??0)>3&&(m="attention_needed");const d=[];return l!=null&&l.incidents_prevented&&l.incidents_prevented>0&&d.push({id:"1",message:`${l.incidents_prevented} incidents prevented today`,timestamp:new Date().toISOString(),type:"success"}),l!=null&&l.requests_today&&l.requests_today>0&&d.push({id:"2",message:`${l.requests_today.toLocaleString()} AI requests processed`,timestamp:new Date().toISOString(),type:"info"}),d.push({id:"3",message:"All safety policies active",timestamp:new Date().toISOString(),type:"success"}),{status:m,requests_today:(l==null?void 0:l.requests_today)??0,incidents_today:(l==null?void 0:l.incidents_prevented)??0,ai_spend_today:((l==null?void 0:l.spend_today_cents)??0)/100,recent_activity:d.slice(0,3)}},refetchInterval:3e4,staleTime:1e4});if(a)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-slate-400",children:"Loading..."})});const r=(s==null?void 0:s.status)??"protected",n=rt[r];return e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:`
        p-8 rounded-xl bg-navy-surface border ${n.border}
        text-center mb-8
      `,children:[e.jsx("div",{className:`
          w-20 h-20 mx-auto mb-4 rounded-full bg-navy-elevated
          flex items-center justify-center text-4xl font-bold
          ${n.color}
        `,children:n.icon}),e.jsx("h1",{className:`text-3xl font-bold ${n.color}`,children:n.label}),e.jsx("p",{className:"text-slate-400 mt-2 text-lg",children:n.subtitle})]}),e.jsx("h2",{className:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-4",children:"Today at a Glance"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-6",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-1",children:"Requests"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:((c=s==null?void 0:s.requests_today)==null?void 0:c.toLocaleString())??"0"})]}),e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-6",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-1",children:"Incidents"}),e.jsxs("div",{className:"text-3xl font-bold text-accent-success",children:[(s==null?void 0:s.incidents_today)??0,e.jsx("span",{className:"text-sm font-normal text-slate-400 ml-2",children:"blocked"})]})]}),e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-6",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-1",children:"AI Spend Today"}),e.jsxs("div",{className:"text-3xl font-bold text-white",children:["$",((s==null?void 0:s.ai_spend_today)??0).toFixed(2)]})]})]}),e.jsx("h2",{className:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-4",children:"Recent Activity"}),e.jsx("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-4 mb-8",children:s!=null&&s.recent_activity&&s.recent_activity.length>0?e.jsx("ul",{className:"space-y-3",children:s.recent_activity.map(i=>e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full bg-current ${ce[i.type]}`}),e.jsx("span",{className:ce[i.type],children:i.message}),e.jsx("span",{className:"text-slate-500 text-sm ml-auto",children:at(new Date(i.timestamp))})]},i.id))}):e.jsx("p",{className:"text-slate-500 text-center py-4",children:"No recent activity"})}),e.jsx("h2",{className:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>t(I.activity),className:"bg-navy-surface border border-navy-border hover:border-accent-info/50 rounded-xl p-6 text-left transition-colors group",children:[e.jsx("span",{className:"text-2xl mb-3 block",children:"âš¡"}),e.jsx("span",{className:"font-medium text-white group-hover:text-accent-info transition-colors",children:"View Activity"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"What ran / is running"})]}),e.jsxs("button",{onClick:()=>t(I.policies),className:"bg-navy-surface border border-navy-border hover:border-accent-info/50 rounded-xl p-6 text-left transition-colors group",children:[e.jsx("span",{className:"text-2xl mb-3 block",children:"ðŸ“œ"}),e.jsx("span",{className:"font-medium text-white group-hover:text-accent-info transition-colors",children:"View Policies"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"How behavior is defined"})]}),e.jsxs("button",{onClick:()=>t(I.keys),className:"bg-navy-surface border border-navy-border hover:border-accent-info/50 rounded-xl p-6 text-left transition-colors group",children:[e.jsx("span",{className:"text-2xl mb-3 block",children:"ðŸ”‘"}),e.jsx("span",{className:"font-medium text-white group-hover:text-accent-info transition-colors",children:"Manage API Keys"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Create & rotate keys"})]})]})]})}const pe={completed:{label:"Completed",color:"text-green-400",border:"border-green-400/40"},failed:{label:"Failed",color:"text-red-400",border:"border-red-400/40"},running:{label:"Running",color:"text-blue-400",border:"border-blue-400/40"},cancelled:{label:"Cancelled",color:"text-slate-400",border:"border-slate-600"}};function Z(t){return new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function ge(t,s){if(!s)return"In progress";const a=new Date(t).getTime(),n=new Date(s).getTime()-a;return n<1e3?`${n}ms`:n<6e4?`${(n/1e3).toFixed(1)}s`:`${Math.floor(n/6e4)}m ${Math.floor(n%6e4/1e3)}s`}function lt(){const[t,s]=x.useState(null),[a,r]=x.useState(1);x.useEffect(()=>(y.componentMount("CustomerActivityPage"),()=>y.componentUnmount("CustomerActivityPage")),[]);const{data:n,isLoading:c}=T({queryKey:["customer","activity",a],queryFn:async()=>({runs:[{run_id:"run_abc123",status:"completed",skill_name:"web_search",started_at:new Date(Date.now()-3e5).toISOString(),ended_at:new Date(Date.now()-295e3).toISOString(),cost_cents:12,error_message:null,pre_run:{stages_planned:3,memory_injection:!0,budget_mode:"enforced"},constraints:{budget_passed:!0,rate_limit_passed:!0,policy_passed:!0},cost_estimated_cents:10,outcome_reason:"All stages completed successfully"},{run_id:"run_def456",status:"failed",skill_name:"code_executor",started_at:new Date(Date.now()-6e5).toISOString(),ended_at:new Date(Date.now()-59e4).toISOString(),cost_cents:8,error_message:"Execution timeout: skill exceeded 30s limit",pre_run:{stages_planned:5,memory_injection:!1,budget_mode:"advisory"},constraints:{budget_passed:!0,rate_limit_passed:!0,policy_passed:!0},cost_estimated_cents:25,outcome_reason:"Skill timeout at stage 3/5"},{run_id:"run_ghi789",status:"completed",skill_name:"data_analysis",started_at:new Date(Date.now()-12e5).toISOString(),ended_at:new Date(Date.now()-118e4).toISOString(),cost_cents:45,error_message:null,pre_run:{stages_planned:4,memory_injection:!0,budget_mode:"advisory"},constraints:{budget_passed:!1,rate_limit_passed:!0,policy_passed:!0},cost_estimated_cents:30,outcome_reason:"Completed with budget overrun (advisory mode)"},{run_id:"run_jkl012",status:"completed",skill_name:"web_search",started_at:new Date(Date.now()-36e5).toISOString(),ended_at:new Date(Date.now()-3595e3).toISOString(),cost_cents:10,error_message:null,pre_run:{stages_planned:2,memory_injection:!1,budget_mode:"enforced"},constraints:{budget_passed:!0,rate_limit_passed:!0,policy_passed:!0},cost_estimated_cents:10,outcome_reason:"Completed within budget"},{run_id:"run_mno345",status:"cancelled",skill_name:"file_processor",started_at:new Date(Date.now()-72e5).toISOString(),ended_at:new Date(Date.now()-719e4).toISOString(),cost_cents:3,error_message:"Cancelled by user",pre_run:{stages_planned:6,memory_injection:!0,budget_mode:"enforced"},constraints:{budget_passed:!0,rate_limit_passed:!1,policy_passed:!0},cost_estimated_cents:15,outcome_reason:"User-initiated cancellation at stage 1/6"}],total:127,page:1,per_page:20}),refetchInterval:3e4,staleTime:1e4}),i=(n==null?void 0:n.runs)??[];return c?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-slate-400",children:"Loading activity..."})}):e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"âš¡"})," Activity"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"What ran / is running"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-slate-400",children:"Total Executions"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:(n==null?void 0:n.total)??0})]}),e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-slate-400",children:"Completed"}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:i.filter(l=>l.status==="completed").length})]}),e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-slate-400",children:"Failed"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:i.filter(l=>l.status==="failed").length})]}),e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-slate-400",children:"Total Cost"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:["$",(i.reduce((l,m)=>l+m.cost_cents,0)/100).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"bg-navy-surface rounded-xl border border-navy-border overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-navy-elevated",children:e.jsxs("tr",{className:"text-left text-sm text-slate-400",children:[e.jsx("th",{className:"p-4",children:"Execution ID"}),e.jsx("th",{className:"p-4",children:"Skill"}),e.jsx("th",{className:"p-4",children:"Status"}),e.jsx("th",{className:"p-4",children:"Duration"}),e.jsx("th",{className:"p-4",children:"Cost"}),e.jsx("th",{className:"p-4",children:"Time"})]})}),e.jsx("tbody",{className:"divide-y divide-navy-border",children:i.map(l=>{const m=pe[l.status],d=(t==null?void 0:t.run_id)===l.run_id;return e.jsxs("tr",{onClick:()=>s(l),className:`
                        cursor-pointer transition-colors
                        ${d?"bg-navy-elevated":"hover:bg-navy-elevated/50"}
                      `,children:[e.jsxs("td",{className:"p-4 font-mono text-sm text-slate-300",children:[l.run_id.slice(0,12),"..."]}),e.jsx("td",{className:"p-4 text-white",children:l.skill_name}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`
                          px-2 py-1 rounded border text-xs font-medium bg-transparent
                          ${m.color} ${m.border}
                        `,children:m.label})}),e.jsx("td",{className:"p-4 text-sm text-slate-400",children:ge(l.started_at,l.ended_at)}),e.jsxs("td",{className:"p-4 text-sm text-slate-300",children:["$",(l.cost_cents/100).toFixed(2)]}),e.jsx("td",{className:"p-4 text-sm text-slate-400",children:Z(l.started_at)})]},l.run_id)})})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-sm text-slate-400",children:[e.jsxs("span",{children:["Showing ",i.length," of ",(n==null?void 0:n.total)??0," executions"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r(l=>Math.max(1,l-1)),disabled:a===1,className:"px-3 py-1 bg-navy-elevated border border-navy-border rounded hover:bg-navy-subtle disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>r(l=>l+1),disabled:i.length<((n==null?void 0:n.per_page)??20),className:"px-3 py-1 bg-navy-elevated border border-navy-border rounded hover:bg-navy-subtle disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]}),t&&e.jsx("div",{className:"w-80",children:e.jsx(it,{execution:t,onClose:()=>s(null)})})]})]})}function it({execution:t,onClose:s}){const a=pe[t.status],r=t.cost_cents-t.cost_estimated_cents,n=t.cost_estimated_cents>0?(r/t.cost_estimated_cents*100).toFixed(0):"0";return e.jsxs("div",{className:"bg-navy-surface rounded-xl border border-navy-border p-4 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold text-white",children:"Execution Details"}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white transition-colors",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Execution ID"}),e.jsx("div",{className:"font-mono text-sm text-slate-300 bg-navy-inset rounded px-2 py-1",children:t.run_id})]}),e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-blue-400 font-bold uppercase tracking-wide mb-3",children:"PRE-RUN SUMMARY"}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Stages Planned"}),e.jsx("span",{className:"text-white font-medium",children:t.pre_run.stages_planned})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Memory Injection"}),e.jsx("span",{className:t.pre_run.memory_injection?"text-green-400":"text-slate-500",children:t.pre_run.memory_injection?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Budget Mode"}),e.jsx("span",{className:t.pre_run.budget_mode==="enforced"?"text-green-400":"text-amber-400",children:t.pre_run.budget_mode.toUpperCase()})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-yellow-400 font-bold uppercase tracking-wide mb-3",children:"CONSTRAINTS"}),e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Budget"}),e.jsx("span",{className:t.constraints.budget_passed?"text-green-400":"text-red-400",children:t.constraints.budget_passed?"âœ“ Passed":"âœ— Failed"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Rate Limit"}),e.jsx("span",{className:t.constraints.rate_limit_passed?"text-green-400":"text-red-400",children:t.constraints.rate_limit_passed?"âœ“ Passed":"âœ— Failed"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Policy"}),e.jsx("span",{className:t.constraints.policy_passed?"text-green-400":"text-red-400",children:t.constraints.policy_passed?"âœ“ Passed":"âœ— Failed"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-purple-400 font-bold uppercase tracking-wide mb-3",children:"COST"}),e.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Estimated"}),e.jsxs("span",{className:"text-slate-300",children:["$",(t.cost_estimated_cents/100).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Actual"}),e.jsxs("span",{className:"text-white font-bold",children:["$",(t.cost_cents/100).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm pt-2 border-t border-purple-500/20",children:[e.jsx("span",{className:"text-slate-400",children:"Difference"}),e.jsxs("span",{className:r>0?"text-amber-400":r<0?"text-green-400":"text-slate-400",children:[r>0?"+":"",r,"Â¢ (",r>0?"+":"",n,"%)"]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-green-400 font-bold uppercase tracking-wide mb-3",children:"OUTCOME"}),e.jsxs("div",{className:`rounded-lg p-3 ${t.status==="completed"?"bg-green-500/10 border border-green-500/30":t.status==="failed"?"bg-red-500/10 border border-red-500/30":t.status==="cancelled"?"bg-slate-500/10 border border-slate-500/30":"bg-blue-500/10 border border-blue-500/30"}`,children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:`
                inline-block px-2 py-1 rounded border text-xs font-medium bg-transparent
                ${a.color} ${a.border}
              `,children:a.label})}),t.outcome_reason&&e.jsx("p",{className:"text-sm text-slate-300",children:t.outcome_reason})]})]}),e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-slate-500 font-bold uppercase tracking-wide mb-3",children:"TIMING"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Skill"}),e.jsx("span",{className:"text-white",children:t.skill_name})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Started"}),e.jsx("span",{className:"text-slate-300",children:Z(t.started_at)})]}),t.ended_at&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Ended"}),e.jsx("span",{className:"text-slate-300",children:Z(t.ended_at)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Duration"}),e.jsx("span",{className:"text-white font-medium",children:ge(t.started_at,t.ended_at)})]})]})]}),t.error_message&&e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-red-400 font-bold uppercase tracking-wide mb-2",children:"ERROR"}),e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3",children:e.jsx("p",{className:"text-red-300 text-sm",children:t.error_message})})]})]})]})}const dt={info:{bg:"bg-blue-500/10",border:"border-blue-400/30",text:"text-blue-400",icon:"i"},warning:{bg:"bg-amber-500/10",border:"border-amber-400/30",text:"text-amber-400",icon:"!"},critical:{bg:"bg-red-500/10",border:"border-red-400/30",text:"text-red-400",icon:"!!"}};function ct(t){const s=new Date(t),a=new Date,r=s.getTime()-a.getTime();if(r<=0)return"Now";const n=Math.floor(r/36e5),c=Math.floor(r%36e5/6e4);return n>24?`${Math.floor(n/24)}d ${n%24}h`:n>0?`${n}h ${c}m`:`${c}m`}function H({current:t,max:s,label:a,unit:r,warning:n=80,critical:c=95}){const i=s>0?Math.min(100,t/s*100):0;let l="bg-green-500",m="text-green-400";return i>=c?(l="bg-red-500",m="text-red-400"):i>=n&&(l="bg-amber-500",m="text-amber-400"),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:a}),e.jsxs("span",{className:m,children:[t.toLocaleString()," / ",s.toLocaleString()," ",r]})]}),e.jsx("div",{className:"h-2 bg-navy-inset rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${l} transition-all duration-300`,style:{width:`${i}%`}})}),e.jsxs("div",{className:"text-xs text-slate-500 text-right",children:[i.toFixed(1),"% used"]})]})}function ot(){x.useEffect(()=>(y.componentMount("CustomerPoliciesPage"),()=>y.componentUnmount("CustomerPoliciesPage")),[]);const{data:t,isLoading:s}=T({queryKey:["customer","policies"],queryFn:async()=>{const r=new Date,n=new Date(r);return n.setHours(24,0,0,0),{budget_limit_cents:5e3,budget_used_cents:3750,budget_period:"daily",budget_resets_at:n.toISOString(),budget_mode:"advisory",rate_limit_per_minute:60,rate_current_per_minute:12,rate_limit_per_day:1e4,rate_current_per_day:4523,max_cost_per_request_cents:50,avg_cost_per_request_cents:8,warnings:[{id:"w1",type:"budget",message:"Budget is at 75%. You will be notified at 80%.",severity:"info"}]}},refetchInterval:3e4,staleTime:1e4});if(s)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-slate-400",children:"Loading policies..."})});const a=t;return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“œ"})," Policies"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"How behavior is defined"})]}),a.warnings.length>0&&e.jsx("div",{className:"mb-6 space-y-2",children:a.warnings.map(r=>{const n=dt[r.severity];return e.jsxs("div",{className:`${n.bg} ${n.border} border rounded-lg px-4 py-3 flex items-center gap-3`,children:[e.jsx("span",{className:`w-6 h-6 rounded-full ${n.bg} ${n.text} flex items-center justify-center text-sm font-bold`,children:n.icon}),e.jsx("span",{className:n.text,children:r.message})]},r.id)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’°"})," Budget Constraint"]}),e.jsxs("div",{className:"text-sm text-slate-400",children:["Resets in ",ct(a.budget_resets_at)]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-navy-elevated rounded-lg border border-navy-border",children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wide mb-2",children:"Mode"}),a.budget_mode==="enforced"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-green-400 font-bold text-lg",children:"ENFORCED"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-amber-400 font-bold text-lg",children:"ADVISORY"})]}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-400/30 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400",children:"âš ï¸"}),e.jsxs("div",{className:"text-sm text-amber-300",children:[e.jsx("div",{className:"font-medium mb-1",children:"Advisory mode:"}),e.jsx("div",{className:"text-amber-400/80",children:"Execution may exceed the configured budget. No runs will be blocked automatically."})]})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"text-4xl font-bold text-white",children:["$",(a.budget_used_cents/100).toFixed(2)]}),e.jsxs("div",{className:"text-slate-400 mt-1",children:["of $",(a.budget_limit_cents/100).toFixed(2)," ",a.budget_period]})]}),e.jsx(H,{current:a.budget_used_cents,max:a.budget_limit_cents,label:"Budget Used",unit:"cents"})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-navy-border",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Avg. cost per request"}),e.jsxs("span",{className:"text-white",children:["$",(a.avg_cost_per_request_cents/100).toFixed(3)]})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-slate-400",children:"Max cost per request"}),e.jsxs("span",{className:"text-white",children:["$",(a.max_cost_per_request_cents/100).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-xl p-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2 mb-6",children:[e.jsx("span",{children:"âš¡"})," Rate Constraints"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{current:a.rate_current_per_minute,max:a.rate_limit_per_minute,label:"Requests / Minute",unit:"req/min",warning:70,critical:90}),e.jsx(H,{current:a.rate_current_per_day,max:a.rate_limit_per_day,label:"Requests / Day",unit:"req"})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-navy-border bg-navy-elevated rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"What happens when constraints are reached?"}),e.jsxs("ul",{className:"text-sm text-slate-400 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("span",{className:"text-amber-400",children:"Rate constraint"}),": Requests are throttled"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("span",{className:"text-red-400",children:"Budget constraint"}),": Requests are blocked"]})]})]})]})]}),e.jsxs("div",{className:"mt-6 bg-navy-surface border border-navy-border rounded-xl p-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"ðŸ“ˆ"})," Usage Summary"]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-navy-elevated rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:a.rate_current_per_day.toLocaleString()}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Requests Today"})]}),e.jsxs("div",{className:"bg-navy-elevated rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:["$",(a.budget_used_cents/100).toFixed(2)]}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Spent Today"})]}),e.jsxs("div",{className:"bg-navy-elevated rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:["$",(a.avg_cost_per_request_cents/100).toFixed(3)]}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Avg per Request"})]}),e.jsxs("div",{className:"bg-navy-elevated rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:Math.round((a.budget_limit_cents-a.budget_used_cents)/a.avg_cost_per_request_cents)}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:"Est. Remaining"})]})]})]}),e.jsxs("div",{className:"mt-6 bg-navy-elevated border border-accent-info/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-accent-info flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¡"})," Need different constraints?"]}),e.jsx("p",{className:"text-sm text-slate-300 mt-2",children:"Contact support to discuss adjusting your budget or rate constraints. Enterprise plans include custom policies and priority support."})]})]})}const ee={debug:{label:"DEBUG",color:"text-slate-400",bg:"bg-slate-500/20"},info:{label:"INFO",color:"text-blue-400",bg:"bg-blue-500/20"},warn:{label:"WARN",color:"text-amber-400",bg:"bg-amber-500/20"},error:{label:"ERROR",color:"text-red-400",bg:"bg-red-500/20"}},fe={execution:{label:"Execution",icon:"âš¡"},policy:{label:"Policy",icon:"ðŸ“œ"},auth:{label:"Auth",icon:"ðŸ”"},system:{label:"System",icon:"ðŸ–¥ï¸"},audit:{label:"Audit",icon:"ðŸ“‹"}};function xt(t){return new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function mt(t){return new Date(t).toISOString()}function ut(){const[t,s]=x.useState(1),[a,r]=x.useState("all"),[n,c]=x.useState("all"),[i,l]=x.useState(null),[m,d]=x.useState("");x.useEffect(()=>(y.componentMount("CustomerLogsPage"),()=>y.componentUnmount("CustomerLogsPage")),[]);const{data:v,isLoading:p,refetch:h}=T({queryKey:["customer","logs",t,a,n],queryFn:async()=>{const o=Date.now();let N=[{id:"log_001",timestamp:new Date(o-3e4).toISOString(),level:"info",category:"execution",message:"Execution completed successfully",run_id:"run_abc123",trace_id:"trace_001",metadata:{skill:"web_search",duration_ms:4523,tokens_used:1250}},{id:"log_002",timestamp:new Date(o-6e4).toISOString(),level:"warn",category:"policy",message:"Budget threshold reached (75%)",metadata:{budget_used_cents:3750,budget_limit_cents:5e3,threshold:.75}},{id:"log_003",timestamp:new Date(o-12e4).toISOString(),level:"error",category:"execution",message:"Execution timeout: skill exceeded 30s limit",run_id:"run_def456",trace_id:"trace_002",metadata:{skill:"code_executor",timeout_ms:3e4,actual_ms:32145}},{id:"log_004",timestamp:new Date(o-18e4).toISOString(),level:"info",category:"auth",message:"API key authenticated",metadata:{key_prefix:"sk_live_...",ip:"192.168.1.100",user_agent:"aos-sdk/1.0"}},{id:"log_005",timestamp:new Date(o-24e4).toISOString(),level:"info",category:"audit",message:"Policy updated: max_cost_per_request",metadata:{old_value:25,new_value:50,updated_by:"user@example.com"}},{id:"log_006",timestamp:new Date(o-3e5).toISOString(),level:"debug",category:"system",message:"Health check completed",metadata:{services:{api:"healthy",db:"healthy",redis:"healthy"}}},{id:"log_007",timestamp:new Date(o-36e4).toISOString(),level:"info",category:"execution",message:"Execution started",run_id:"run_ghi789",trace_id:"trace_003",metadata:{skill:"data_analysis",stages_planned:4}},{id:"log_008",timestamp:new Date(o-42e4).toISOString(),level:"warn",category:"policy",message:"Rate limit approaching (80%)",metadata:{requests_per_minute:48,limit_per_minute:60}},{id:"log_009",timestamp:new Date(o-48e4).toISOString(),level:"info",category:"execution",message:"Execution completed successfully",run_id:"run_ghi789",trace_id:"trace_003",metadata:{skill:"data_analysis",duration_ms:18234,tokens_used:4500}},{id:"log_010",timestamp:new Date(o-54e4).toISOString(),level:"error",category:"auth",message:"Invalid API key rejected",metadata:{key_prefix:"sk_test_...",ip:"10.0.0.50",reason:"key_expired"}}];if(a!=="all"&&(N=N.filter(u=>u.level===a)),n!=="all"&&(N=N.filter(u=>u.category===n)),m){const u=m.toLowerCase();N=N.filter(w=>{var g,b;return w.message.toLowerCase().includes(u)||((g=w.run_id)==null?void 0:g.toLowerCase().includes(u))||((b=w.trace_id)==null?void 0:b.toLowerCase().includes(u))})}return{logs:N,total:N.length,page:1,per_page:50,has_more:!1}},refetchInterval:3e4,staleTime:1e4}),f=(v==null?void 0:v.logs)??[];return p?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-slate-400",children:"Loading logs..."})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“‹"})," Logs"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"What is the raw truth"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>h(),className:"px-3 py-1.5 bg-navy-elevated border border-navy-border hover:bg-navy-subtle rounded-lg text-sm text-slate-300 flex items-center gap-2 transition-colors",children:[e.jsx("span",{children:"ðŸ”„"})," Refresh"]}),e.jsxs("button",{className:"px-3 py-1.5 bg-navy-elevated border border-accent-info/30 text-accent-info hover:bg-navy-subtle rounded-lg text-sm flex items-center gap-2 transition-colors",children:[e.jsx("span",{children:"ðŸ“¥"})," Export"]})]})]}),e.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx("input",{type:"text",value:m,onChange:o=>d(o.target.value),placeholder:"Search logs...",className:"w-full px-4 py-2 bg-navy-inset border border-navy-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-accent-info focus:border-transparent"})}),e.jsxs("select",{value:a,onChange:o=>r(o.target.value),className:"px-4 py-2 bg-navy-elevated border border-navy-border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-accent-info",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"debug",children:"Debug"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warn",children:"Warning"}),e.jsx("option",{value:"error",children:"Error"})]}),e.jsxs("select",{value:n,onChange:o=>c(o.target.value),className:"px-4 py-2 bg-navy-elevated border border-navy-border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-accent-info",children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"execution",children:"Execution"}),e.jsx("option",{value:"policy",children:"Policy"}),e.jsx("option",{value:"auth",children:"Auth"}),e.jsx("option",{value:"system",children:"System"}),e.jsx("option",{value:"audit",children:"Audit"})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-5 gap-4",children:[Object.entries(ee).map(([o,_])=>{const N=f.filter(u=>u.level===o).length;return e.jsxs("div",{className:`bg-navy-surface border border-navy-border rounded-lg p-3 cursor-pointer hover:border-accent-info/30 transition-colors ${a===o?"border-accent-info/50":""}`,onClick:()=>r(a===o?"all":o),children:[e.jsx("div",{className:`text-xs ${_.color} font-medium`,children:_.label}),e.jsx("div",{className:"text-xl font-bold text-white",children:N})]},o)}),e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-slate-400 font-medium",children:"TOTAL"}),e.jsx("div",{className:"text-xl font-bold text-white",children:f.length})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"bg-navy-surface rounded-xl border border-navy-border overflow-hidden",children:f.length===0?e.jsx("div",{className:"p-8 text-center text-slate-400",children:"No logs match the current filters"}):e.jsx("div",{className:"divide-y divide-navy-border",children:f.map(o=>{const _=ee[o.level],N=fe[o.category],u=(i==null?void 0:i.id)===o.id;return e.jsxs("div",{onClick:()=>l(o),className:`
                        p-4 cursor-pointer transition-colors
                        ${u?"bg-navy-elevated":"hover:bg-navy-elevated/50"}
                      `,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`
                          px-2 py-0.5 rounded text-xs font-mono font-medium
                          ${_.color} ${_.bg}
                        `,children:_.label}),e.jsxs("span",{className:"text-slate-400 text-sm flex items-center gap-1",children:[e.jsx("span",{children:N.icon}),e.jsx("span",{children:N.label})]}),e.jsx("span",{className:"text-slate-500 text-sm ml-auto font-mono",children:xt(o.timestamp)})]}),e.jsx("div",{className:"mt-2 text-white",children:o.message}),(o.run_id||o.trace_id)&&e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-xs",children:[o.run_id&&e.jsxs("span",{className:"text-slate-400",children:["Run: ",e.jsx("span",{className:"font-mono text-slate-300",children:o.run_id})]}),o.trace_id&&e.jsxs("span",{className:"text-slate-400",children:["Trace: ",e.jsx("span",{className:"font-mono text-slate-300",children:o.trace_id})]})]})]},o.id)})})}),(v==null?void 0:v.has_more)&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>s(o=>o+1),className:"px-4 py-2 bg-navy-elevated border border-navy-border rounded-lg text-sm text-slate-300 hover:bg-navy-subtle transition-colors",children:"Load More"})})]}),i&&e.jsx("div",{className:"w-96",children:e.jsx(ht,{log:i,onClose:()=>l(null)})})]})]})}function ht({log:t,onClose:s}){const a=ee[t.level],r=fe[t.category];return e.jsxs("div",{className:"bg-navy-surface rounded-xl border border-navy-border p-4 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold text-white",children:"Log Details"}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white transition-colors",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`
            px-2 py-0.5 rounded text-xs font-mono font-medium
            ${a.color} ${a.bg}
          `,children:a.label}),e.jsxs("span",{className:"text-slate-300 text-sm flex items-center gap-1",children:[e.jsx("span",{children:r.icon}),e.jsx("span",{children:r.label})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Timestamp"}),e.jsx("div",{className:"font-mono text-sm text-slate-300 bg-navy-inset rounded px-2 py-1",children:mt(t.timestamp)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Message"}),e.jsx("div",{className:"text-white bg-navy-inset rounded px-3 py-2",children:t.message})]}),(t.run_id||t.trace_id)&&e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-slate-500 font-bold uppercase tracking-wide mb-3",children:"References"}),e.jsxs("div",{className:"space-y-2",children:[t.run_id&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Run ID"}),e.jsx("span",{className:"font-mono text-slate-300",children:t.run_id})]}),t.trace_id&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Trace ID"}),e.jsx("span",{className:"font-mono text-slate-300",children:t.trace_id})]})]})]}),t.metadata&&Object.keys(t.metadata).length>0&&e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-slate-500 font-bold uppercase tracking-wide mb-3",children:"Metadata"}),e.jsx("div",{className:"bg-navy-inset rounded-lg p-3 overflow-x-auto",children:e.jsx("pre",{className:"text-xs text-slate-300 font-mono whitespace-pre-wrap",children:JSON.stringify(t.metadata,null,2)})})]}),e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Log ID"}),e.jsx("div",{className:"font-mono text-xs text-slate-400 bg-navy-inset rounded px-2 py-1",children:t.id})]})]})]})}function bt(t,s=300){const[a,r]=x.useState(t);return x.useEffect(()=>{const n=setTimeout(()=>{r(t)},s);return()=>{clearTimeout(n)}},[t,s]),a}function pt({onSearch:t,onFilterToggle:s,isLoading:a=!1,placeholder:r="Search by user ID, content, or keywords..."}){const[n,c]=x.useState(""),i=bt(n,300);Se.useEffect(()=>{t(i)},[i,t]);const l=x.useCallback(()=>{c(""),t("")},[t]);return e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:n,onChange:m=>c(m.target.value),placeholder:r,className:`block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg
                     focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                     text-gray-900 placeholder-gray-500`}),n&&e.jsx("button",{onClick:l,className:"absolute inset-y-0 right-0 pr-3 flex items-center",disabled:a,children:a?e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):e.jsx("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("button",{onClick:s,className:`flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg
                   text-gray-700 hover:bg-gray-50 transition-colors`,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filters"]})]})}const gt=[{value:"",label:"All Severities"},{value:"critical",label:"Critical"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}],ft=[{value:"",label:"All Status"},{value:"failed",label:"Failed"},{value:"passed",label:"Passed"}],vt=[{value:"",label:"All Models"},{value:"gpt-4",label:"GPT-4"},{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"gpt-4.1",label:"GPT-4.1"},{value:"gpt-3.5-turbo",label:"GPT-3.5 Turbo"}];function jt({filters:t,onChange:s,onClose:a,open:r}){if(!r)return null;const n=(l,m)=>{s({...t,[l]:m||void 0})},c=()=>{s({query:t.query,limit:t.limit,offset:0})},i=[t.severity,t.policy_status,t.model,t.user_id,t.time_from,t.time_to].filter(Boolean).length;return e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Filters"}),i>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full",children:[i," active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i>0&&e.jsx("button",{onClick:c,className:"text-sm text-gray-500 hover:text-gray-700",children:"Clear all"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User ID"}),e.jsx("input",{type:"text",value:t.user_id||"",onChange:l=>n("user_id",l.target.value),placeholder:"e.g., cust_8372",className:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm
                       focus:ring-2 focus:ring-blue-500 focus:border-blue-500`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Severity"}),e.jsx("select",{value:t.severity||"",onChange:l=>n("severity",l.target.value),className:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm
                       focus:ring-2 focus:ring-blue-500 focus:border-blue-500`,children:gt.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Policy Status"}),e.jsx("select",{value:t.policy_status||"",onChange:l=>n("policy_status",l.target.value),className:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm
                       focus:ring-2 focus:ring-blue-500 focus:border-blue-500`,children:ft.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),e.jsx("select",{value:t.model||"",onChange:l=>n("model",l.target.value),className:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm
                       focus:ring-2 focus:ring-blue-500 focus:border-blue-500`,children:vt.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From"}),e.jsx("input",{type:"date",value:t.time_from?t.time_from.split("T")[0]:"",onChange:l=>n("time_from",l.target.value?`${l.target.value}T00:00:00Z`:""),className:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm
                       focus:ring-2 focus:ring-blue-500 focus:border-blue-500`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To"}),e.jsx("input",{type:"date",value:t.time_to?t.time_to.split("T")[0]:"",onChange:l=>n("time_to",l.target.value?`${l.target.value}T23:59:59Z`:""),className:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm
                       focus:ring-2 focus:ring-blue-500 focus:border-blue-500`})]})]})]})}const oe={critical:{label:"Critical",borderColor:"border-l-red-500",textColor:"text-red-400"},high:{label:"High",borderColor:"border-l-amber-500",textColor:"text-amber-400"},medium:{label:"Medium",borderColor:"border-l-yellow-500",textColor:"text-yellow-400"},low:{label:"Low",borderColor:"border-l-slate-500",textColor:"text-slate-400"}},xe={open:{label:"Active",textColor:"text-amber-400",borderColor:"border-amber-400/40"},acknowledged:{label:"Ack",textColor:"text-blue-400",borderColor:"border-blue-400/40"},resolved:{label:"Resolved",textColor:"text-green-400",borderColor:"border-green-400/40"}};function yt(){const t=B(),[s,a]=x.useState(!1),[r,n]=x.useState({limit:50,offset:0}),[c,i]=x.useState("");x.useEffect(()=>(y.componentMount("IncidentsPage"),y.info("INCIDENTS","Page loaded"),()=>y.componentUnmount("IncidentsPage")),[]);const l=!!(r.user_id||r.severity||r.policy_status||r.model||r.time_from||r.time_to||c),{data:m,isLoading:d,refetch:v}=T({queryKey:["guard","incidents","search",{...r,query:c}],queryFn:()=>E.searchIncidents({...r,query:c}),enabled:l,refetchInterval:3e4}),{data:p,isLoading:h}=T({queryKey:["guard","incidents","list"],queryFn:()=>E.getIncidents({limit:50}),enabled:!l,refetchInterval:3e4}),f=K({mutationFn:()=>E.seedDemoIncident("contract_autorenew"),onSuccess:()=>{y.info("INCIDENTS","Demo incident seeded"),v()},onError:j=>{y.error("INCIDENTS","Failed to seed demo incident",j)}}),o=x.useCallback(j=>{i(j),n(D=>({...D,offset:0}))},[]),_=x.useCallback(j=>{n(j)},[]),N=x.useCallback(j=>{y.userEvent("click","incident_inspect",{incident_id:j}),t(I.incidentDetail(j))},[t]),u=l?d:h,w=l?((m==null?void 0:m.items)||[]).map(_t):(p==null?void 0:p.items)||[],g=l?(m==null?void 0:m.total)||0:(p==null?void 0:p.total)||0,b={critical:w.filter(j=>j.severity==="critical").length,high:w.filter(j=>j.severity==="high").length,medium:w.filter(j=>j.severity==="medium").length,low:w.filter(j=>j.severity==="low").length};return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“‹"})," Incidents"]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"AI safety events requiring attention"})]}),e.jsx("button",{onClick:()=>f.mutate(),disabled:f.isPending,className:"px-4 py-2 bg-navy-elevated hover:bg-navy-subtle border border-navy-border text-slate-300 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:f.isPending?"Creating...":"+ Seed Demo"})]}),e.jsx(pt,{onSearch:o,onFilterToggle:()=>a(!s),isLoading:u}),e.jsx(jt,{filters:r,onChange:_,onClose:()=>a(!1),open:s}),!u&&w.length>0&&e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-lg px-4 py-3 mb-4 flex items-center gap-6 text-sm",children:[e.jsxs("span",{className:"text-slate-300",children:[e.jsx("span",{className:"font-semibold text-white",children:g})," incidents"]}),e.jsx("span",{className:"text-navy-border",children:"|"}),b.critical>0&&e.jsxs("span",{className:"text-red-400",children:[b.critical," critical"]}),b.high>0&&e.jsxs("span",{className:"text-amber-400",children:[b.high," high"]}),b.medium>0&&e.jsxs("span",{className:"text-yellow-400",children:[b.medium," medium"]}),b.low>0&&e.jsxs("span",{className:"text-slate-400",children:[b.low," low"]})]}),l&&m&&e.jsxs("div",{className:"mb-4 text-sm text-slate-400",children:["Found ",m.total," incidents",c&&` matching "${c}"`]}),u&&e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"w-8 h-8 border-2 border-accent-info border-t-transparent rounded-full animate-spin"})}),!u&&w.length===0&&e.jsxs("div",{className:"bg-navy-surface border border-navy-border rounded-xl text-center py-12 px-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:l?"ðŸ”":"âœ¨"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:l?"No Matches":"All Clear"}),e.jsx("p",{className:"text-slate-400 mb-4 max-w-md mx-auto",children:l?"Try adjusting your search or filters.":"No incidents recorded. Your guardrails are working."}),!l&&e.jsxs("div",{className:"mt-6 p-4 bg-navy-elevated border border-accent-info/20 rounded-lg text-left max-w-md mx-auto",children:[e.jsx("p",{className:"text-sm font-medium text-accent-info mb-2",children:"What this means:"}),e.jsxs("ul",{className:"text-sm text-slate-300 space-y-1",children:[e.jsx("li",{children:"â€¢ All AI requests passed policy checks"}),e.jsx("li",{children:"â€¢ No cost thresholds exceeded"}),e.jsx("li",{children:"â€¢ No content violations detected"})]})]})]}),!u&&w.length>0&&e.jsx("div",{className:"space-y-2",children:w.map(j=>e.jsx(Nt,{incident:j,onClick:()=>N(j.id)},j.id))})]})}function Nt({incident:t,onClick:s}){const a=oe[t.severity]||oe.medium,r=xe[t.status]||xe.open,n=wt(new Date(t.started_at)),c=kt(t.action_taken),i=t.cost_avoided_cents>0?`$${(t.cost_avoided_cents/100).toFixed(2)}`:null;return e.jsx("div",{onClick:s,className:`
        bg-navy-surface border border-navy-border rounded-lg
        border-l-4 ${a.borderColor}
        hover:bg-navy-elevated hover:-translate-y-0.5
        transition-all cursor-pointer
        p-4
      `,children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:`text-xs font-medium uppercase tracking-wide ${a.textColor}`,children:a.label}),e.jsx("h3",{className:"font-medium text-white mt-1 truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:t.trigger_type||"Policy check"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:n}),t.calls_affected>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[t.calls_affected," call",t.calls_affected>1?"s":""]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[i&&e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-green-400 text-sm",children:i}),e.jsx("span",{className:"block text-xs text-slate-500",children:"saved"})]}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-slate-300 text-sm",children:c})}),e.jsx("span",{className:`
            px-2 py-1 rounded border text-xs font-medium
            bg-transparent ${r.textColor} ${r.borderColor}
          `,children:r.label}),e.jsx("span",{className:"text-accent-info text-sm font-medium hover:underline",children:"Inspect â†’"})]})]})})}function _t(t){return{id:t.incident_id,title:t.output_preview||"Incident",severity:t.severity||"medium",status:"open",trigger_type:t.policy_status.replace("_FAILED",""),trigger_value:"",action_taken:"logged",cost_avoided_cents:t.cost_cents,calls_affected:1,started_at:t.timestamp,ended_at:null,duration_seconds:null}}function wt(t){const a=new Date().getTime()-t.getTime(),r=Math.floor(a/6e4);if(r<1)return"Just now";if(r<60)return`${r}m ago`;const n=Math.floor(r/60);return n<24?`${n}h ago`:`${Math.floor(n/24)}d ago`}function kt(t){return t?{freeze:"Stopped",block:"Blocked",throttle:"Throttled",warn:"Warning",aggregate:"Grouped",logged:"Logged"}[t]||t.replace(/_/g," "):"Monitored"}const me={INPUT_RECEIVED:{icon:"ðŸ“¥",color:"text-blue-500",bg:"bg-blue-50"},CONTEXT_RETRIEVED:{icon:"ðŸ“‹",color:"text-purple-500",bg:"bg-purple-50"},POLICY_EVALUATED:{icon:"ðŸ›¡ï¸",color:"text-slate-600",bg:"bg-slate-100"},MODEL_CALLED:{icon:"ðŸ¤–",color:"text-emerald-500",bg:"bg-emerald-50"},OUTPUT_GENERATED:{icon:"ðŸ“¤",color:"text-indigo-500",bg:"bg-indigo-50"},LOGGED:{icon:"ðŸ“",color:"text-gray-400",bg:"bg-gray-50"}},G={PASS:{color:"text-emerald-600",darkColor:"dark:text-emerald-400",border:"border-emerald-500/40",label:"PASS",icon:"âœ“"},FAIL:{color:"text-amber-600",darkColor:"dark:text-amber-400",border:"border-amber-500/40",label:"FAILED",icon:"âš "},WARN:{color:"text-yellow-600",darkColor:"dark:text-yellow-400",border:"border-yellow-500/40",label:"WARN",icon:"âš "},BLOCKED:{color:"text-red-600",darkColor:"dark:text-red-400",border:"border-red-500/40",label:"BLOCKED",icon:"â›”"}};function Ct({timeline:t}){var p;const[s,a]=x.useState(!1),[r,n]=x.useState(!1);x.useEffect(()=>(y.componentMount("DecisionTimeline"),y.info("DECISION_INSPECTOR","Timeline loaded",{incident_id:t.incident_id,events:t.events.length,has_root_cause:!!t.root_cause}),()=>y.componentUnmount("DecisionTimeline")),[t]);const c=t.events.some(h=>{var f,o;return((f=h.data)==null?void 0:f.action)==="block"||((o=h.data)==null?void 0:o.action)==="freeze"}),i=t.policy_evaluations.filter(h=>h.result==="FAIL"),l=t.policy_evaluations.filter(h=>h.result==="PASS"),m=c?"HIGH":i.length>0?"MEDIUM":"LOW",d=c?"BLOCKED":i.length>0?"Policy Gap":"OK",v=x.useCallback(()=>{navigator.clipboard.writeText(t.incident_id),n(!0),y.userEvent("click","copy_incident_id",{incident_id:t.incident_id}),setTimeout(()=>n(!1),2e3)},[t.incident_id]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-700 pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-[#e6eaf2]",children:"Decision Inspector"}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"/"}),e.jsxs("button",{onClick:v,className:`group flex items-center gap-1.5 text-sm font-mono text-gray-600 dark:text-gray-400
                       hover:text-gray-900 dark:hover:text-gray-200 transition-colors`,title:"Click to copy",children:[e.jsx("span",{className:"truncate max-w-[160px]",children:t.incident_id}),e.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:r?"âœ“":"ðŸ“‹"})]}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"Â·"}),e.jsx("span",{className:`text-sm font-medium ${c?"text-red-600 dark:text-red-400":i.length>0?"text-amber-600 dark:text-[#ffd18a]":"text-emerald-600 dark:text-emerald-400"}`,children:d}),e.jsx(It,{severity:m})]})}),e.jsx("div",{className:`p-4 rounded-lg border-l-4 bg-transparent ${c?"border-red-500":i.length>0?"border-amber-500":"border-emerald-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(St,{hasRootCause:!!t.root_cause,isCritical:c}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[i.length," of ",t.policy_evaluations.length," policies failed"]})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-500 font-mono",children:new Date(((p=t.events[0])==null?void 0:p.timestamp)||Date.now()).toLocaleString()})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm p-3 bg-transparent border border-slate-700/30 rounded-lg",children:[e.jsx(Y,{label:"Model",value:t.model}),e.jsx(Y,{label:"Latency",value:`${t.latency_ms}ms`}),e.jsx(Y,{label:"Cost",value:`$${(t.cost_cents/100).toFixed(4)}`})]}),t.root_cause_badge&&e.jsx("div",{className:"bg-transparent border-l-4 border-amber-500 pl-4 py-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-500 text-lg flex-shrink-0",children:"ðŸ”Ž"}),e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-amber-500 uppercase tracking-wide mb-1",children:"What Happened"}),e.jsx("p",{className:"font-medium text-amber-400",children:t.root_cause_badge}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:t.root_cause})]}),e.jsxs("div",{className:"pt-3 border-t border-slate-700/30",children:[e.jsx("p",{className:"text-xs font-medium text-amber-500 uppercase tracking-wide mb-1",children:"Business Impact"}),e.jsx("p",{className:"text-sm text-slate-300",children:$t(t.root_cause_badge,c)})]}),e.jsxs("div",{className:"pt-3 border-t border-slate-700/30",children:[e.jsx("p",{className:"text-xs font-medium text-amber-500 uppercase tracking-wide mb-1",children:"Recommended Action"}),e.jsx("p",{className:"text-sm text-slate-400",children:Rt(t.root_cause_badge,c)})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-gray-700 dark:text-gray-300 text-sm",children:"Policy Evaluations"}),i.length>0&&e.jsx("div",{className:"space-y-1",children:i.map((h,f)=>e.jsx(ue,{evaluation:h},`fail-${f}`))}),l.length>0&&e.jsx("div",{className:"mt-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-1 opacity-60",children:l.map((h,f)=>e.jsx(ue,{evaluation:h},`pass-${f}`))}),e.jsx("button",{onClick:()=>a(!1),className:`mt-2 text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700
                             dark:hover:text-gray-300 transition-colors`,children:"â–² Hide passed policies"})]}):e.jsxs("button",{onClick:()=>a(!0),className:`flex items-center gap-1.5 text-xs text-gray-500 dark:text-gray-400
                           hover:text-gray-700 dark:hover:text-gray-300 transition-colors`,children:[e.jsx("span",{className:"text-emerald-500",children:"âœ“"}),"Show all policy checks (",l.length," passed)",e.jsx("span",{className:"ml-1",children:"â–¼"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("h3",{className:"font-medium text-gray-700 dark:text-gray-300 text-sm mb-4",children:"Execution Trace"}),e.jsx("div",{className:"absolute left-5 top-10 bottom-4 w-0.5 bg-gray-200 dark:bg-gray-700"}),e.jsx("div",{className:"space-y-3",children:t.events.map((h,f)=>{var o;return e.jsx(Dt,{event:h,isLast:f===t.events.length-1,isKeyEvent:h.event==="OUTPUT_GENERATED"||((o=h.data)==null?void 0:o.result)==="FAIL"},f)})})]}),e.jsxs("details",{className:"text-xs text-slate-500",children:[e.jsx("summary",{className:"cursor-pointer hover:text-slate-300",children:"Severity Legend"}),e.jsxs("div",{className:"mt-2 p-3 bg-transparent border border-slate-700/30 rounded grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-red-500",children:"â›”"})," Blocked (critical)"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-amber-500",children:"âš "})," Policy gap (warn)"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-emerald-500",children:"âœ“"})," Passed (ok)"]})]})]})]})}function St({hasRootCause:t,isCritical:s}){return s?e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-sm font-medium
                       bg-transparent border border-red-500/40 text-red-600 dark:text-red-400`,children:[e.jsx("span",{children:"â›”"})," Traffic Blocked"]}):t?e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-sm font-medium
                       bg-transparent border border-amber-500/40 text-amber-600 dark:text-amber-400`,children:[e.jsx("span",{children:"âš "})," Policy Gap"]}):e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-sm font-medium
                     bg-transparent border border-emerald-500/40 text-emerald-600 dark:text-emerald-400`,children:[e.jsx("span",{children:"âœ“"})," OK"]})}function Y({label:t,value:s}){return e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-xs",children:t}),e.jsx("p",{className:"font-medium text-gray-800 dark:text-[#e6eaf2]",children:s})]})}function It({severity:t}){const a={HIGH:{border:"border-red-500/40",text:"text-red-600 dark:text-red-400",label:"HIGH"},MEDIUM:{border:"border-amber-500/40",text:"text-amber-600 dark:text-amber-400",label:"MED"},LOW:{border:"border-emerald-500/40",text:"text-emerald-600 dark:text-emerald-400",label:"LOW"}}[t];return e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs font-bold bg-transparent border ${a.border} ${a.text}`,children:a.label})}function Dt({event:t,isLast:s,isKeyEvent:a}){var d,v,p,h,f;const r=me[t.event]||me.LOGGED,n=new Date(t.timestamp).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),c=t.event==="POLICY_EVALUATED"&&((d=t.data)==null?void 0:d.result)==="FAIL",i=((v=t.data)==null?void 0:v.action)==="block"||((p=t.data)==null?void 0:p.action)==="freeze",l=t.event==="OUTPUT_GENERATED",m=i?"border-l-4 border-red-500":c?"border-l-4 border-amber-500":l?"border-l-4 border-blue-500":a?"border-l-4 border-slate-600":"";return e.jsxs("div",{className:`relative flex gap-4 ${m} -mx-2 px-3 py-2 rounded-r`,children:[e.jsx("div",{className:`relative z-10 w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0
                    bg-transparent border-2
                    ${i?"border-red-500/50":c?"border-amber-500/50":l?"border-blue-500/50":"border-slate-600"}`,children:i?e.jsx("span",{className:"text-red-500 text-sm",children:"â›”"}):c?e.jsx("span",{className:"text-amber-500 text-sm",children:"âš "}):l?e.jsx("span",{className:"text-indigo-500 text-base",children:"ðŸ“¤"}):e.jsx("span",{className:"text-base",children:r.icon})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5 flex-wrap",children:[e.jsx("span",{className:`font-medium text-sm ${i?"text-red-700 dark:text-red-400":c?"text-amber-700 dark:text-[#ffd18a]":l?"text-indigo-700 dark:text-indigo-400":"text-gray-800 dark:text-gray-200"}`,children:At(t.event)}),((h=t.data)==null?void 0:h.result)&&e.jsx(Et,{result:t.data.result,action:(f=t.data)==null?void 0:f.action}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 font-mono",children:n}),t.duration_ms&&t.duration_ms>0&&e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:["(",t.duration_ms,"ms)"]})]}),e.jsx(Tt,{event:t})]})]})}function Et({result:t,action:s}){const r=G[s==="block"||s==="freeze"?"BLOCKED":t]||G.PASS;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium
                  bg-transparent ${r.color} ${r.darkColor} border ${r.border}`,children:[e.jsx("span",{children:r.icon}),r.label]})}function Tt({event:t}){var a,r;const{data:s}=t;switch(t.event){case"INPUT_RECEIVED":return e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{className:"truncate",children:[s.role,': "',s.content,'"']}),s.model_requested&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5",children:["Model: ",s.model_requested]})]});case"CONTEXT_RETRIEVED":return e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:["Fields: ",((a=s.fields_retrieved)==null?void 0:a.join(", "))||"None"]}),((r=s.missing_fields)==null?void 0:r.length)>0&&e.jsxs("p",{className:"text-amber-600 dark:text-amber-400 text-xs mt-0.5",children:["Missing: ",s.missing_fields.join(", ")]})]});case"POLICY_EVALUATED":return e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-mono text-gray-700 dark:text-gray-300 text-xs",children:s.policy}),s.reason&&e.jsx("p",{className:`mt-0.5 text-xs ${s.result==="FAIL"?"text-amber-600 dark:text-amber-400":"text-gray-500 dark:text-gray-400"}`,children:s.reason}),s.expected_behavior&&e.jsxs("div",{className:"mt-1.5 p-2 bg-transparent rounded border border-slate-700/50 text-xs",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-emerald-400",children:"Expected:"})," ",e.jsx("span",{className:"text-slate-400",children:s.expected_behavior})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-amber-400",children:"Actual:"})," ",e.jsx("span",{className:"text-slate-400",children:s.actual_behavior})]})]})]});case"MODEL_CALLED":return e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"font-mono",children:s.model})," Â· ",s.input_tokens," in / ",s.output_tokens," out"]})});case"OUTPUT_GENERATED":return e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{className:"italic text-xs truncate",children:['"',s.content,'"']}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5",children:[s.tokens," tokens | $",(s.cost_cents/100).toFixed(4)]})]});case"LOGGED":return e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Incident logged: ",s.incident_id]});default:return e.jsx("pre",{className:"text-xs text-slate-400 bg-transparent border border-slate-700/30 p-2 rounded overflow-x-auto max-h-24",children:We(s,{maxChars:200,maxDepth:2})})}}function ue({evaluation:t}){const s=G[t.result]||G.PASS,a=t.result==="FAIL";return e.jsxs("div",{className:`
        flex items-center gap-3 py-2 px-3
        bg-transparent
        ${a?`border-l-3 ${s.border.replace("/40","")}`:"border-l-3 border-transparent"}
      `,style:{borderLeftWidth:"3px"},children:[e.jsx("span",{className:`font-mono text-sm ${a?`${s.color} ${s.darkColor}`:"text-slate-500 dark:text-slate-400"}`,children:t.policy}),e.jsx("span",{className:`text-xs font-medium ${s.color} ${s.darkColor}`,children:s.label}),t.reason&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-600",children:"â€”"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400 truncate",children:t.reason})]})]})}function At(t){return{INPUT_RECEIVED:"Input Received",CONTEXT_RETRIEVED:"Context Retrieved",POLICY_EVALUATED:"Policy Evaluated",MODEL_CALLED:"Model Called",OUTPUT_GENERATED:"Output Generated",LOGGED:"Logged"}[t]||t}function $t(t,s){const a=t.toLowerCase();return s?a.includes("injection")||a.includes("jailbreak")?"Security breach prevented. Potential unauthorized data access or system manipulation blocked.":a.includes("cost")||a.includes("budget")?"Runaway spend prevented. Cost threshold would have been exceeded without intervention.":a.includes("rate")||a.includes("throttle")?"API abuse stopped. Rate limit prevented potential service degradation.":"Traffic blocked to prevent potential damage. Review incident details before resuming.":a.includes("pii")||a.includes("privacy")?"Customer data exposure risk. PII may have been included in model output.":a.includes("hallucination")||a.includes("accuracy")?"Information accuracy concern. Model output may contain unverified claims.":a.includes("tone")||a.includes("sentiment")?"Brand voice deviation. Response tone may not align with guidelines.":a.includes("contract")||a.includes("legal")?"Legal compliance risk. Output may contain unauthorized commitments.":a.includes("off-topic")||a.includes("scope")?"Scope creep detected. Model answered outside of intended use case.":"Policy gap identified. Review to determine if corrective action is needed."}function Rt(t,s){const a=t.toLowerCase();return s?a.includes("injection")||a.includes("jailbreak")?"Review attack pattern. Consider adding to blocklist. Notify security team if novel vector.":a.includes("cost")||a.includes("budget")?"Review cost thresholds. Consider per-request limits. Check for runaway loops.":a.includes("rate")||a.includes("throttle")?"Review rate limit configuration. Check if legitimate traffic spike or abuse pattern.":"Review incident details. Determine if block should remain or traffic can resume.":a.includes("pii")||a.includes("privacy")?"Add PII scrubbing to output filter. Review what data is being passed to context.":a.includes("hallucination")||a.includes("accuracy")?"Add citation requirements to prompt. Consider fact-checking integration.":a.includes("tone")||a.includes("sentiment")?"Review system prompt for brand voice guidelines. Adjust temperature or model.":a.includes("contract")||a.includes("legal")?"Add contract/commitment detection to policy. Review output filter rules.":a.includes("off-topic")||a.includes("scope")?"Tighten scope constraints in system prompt. Add topic guardrails.":"Review policy configuration. Consider if gap requires rule adjustment or is acceptable."}const Pt={critical:{label:"Critical",color:"text-red-400",border:"border-red-500"},high:{label:"High",color:"text-amber-400",border:"border-amber-500"},medium:{label:"Medium",color:"text-yellow-400",border:"border-yellow-500"},low:{label:"Low",color:"text-slate-400",border:"border-slate-500"}};function L({title:t,children:s}){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xs font-medium text-slate-500 uppercase tracking-wider mb-3 border-b border-slate-700 pb-2",children:t}),s]})}function Lt({incidentId:t,onConfirm:s,onCancel:a,isLoading:r}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Confirm Replay"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("p",{className:"text-slate-300 text-sm",children:"This will replay the incident execution to verify determinism."}),e.jsxs("div",{className:"bg-slate-900 rounded p-3 text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Incident:"})," ",e.jsxs("span",{className:"font-mono text-white",children:[t.slice(0,16),"..."]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:a,disabled:r,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-white text-sm transition-colors disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:s,disabled:r,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white text-sm transition-colors disabled:opacity-50 flex items-center gap-2",children:[r&&e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),r?"Replaying...":"Confirm Replay"]})]})]})})}function Ot({result:t,onClose:s}){const a=t.match_level==="exact"||t.match_level==="logical";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Replay Complete"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:`p-4 rounded-lg border-2 text-center ${a?"border-green-500/40":"border-red-500/40"}`,children:[e.jsx("div",{className:`text-xl font-bold ${a?"text-green-400":"text-red-400"}`,children:a?"âœ“ DETERMINISTIC":"âœ— NON-DETERMINISTIC"}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:a?"Execution is reproducible":"Outputs differ - review required"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Match Level"}),e.jsx("p",{className:"text-white capitalize",children:t.match_level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Policy Match"}),e.jsx("p",{className:t.policy_match?"text-green-400":"text-red-400",children:t.policy_match?"Yes":"No"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:s,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-white text-sm transition-colors",children:"Close"})})]})})}function Mt(){var N;const{incidentId:t}=Ie(),s=B(),[a,r]=x.useState(!1),[n,c]=x.useState(null),{data:i,isLoading:l,error:m}=T({queryKey:["guard","incidents",t,"timeline"],queryFn:()=>E.getDecisionTimeline(t),enabled:!!t});x.useEffect(()=>(y.componentMount("IncidentDetailPage"),y.info("INCIDENT_DETAIL","Page loaded",{incident_id:t}),()=>y.componentUnmount("IncidentDetailPage")),[t]);const d=K({mutationFn:u=>E.replayCall(u),onSuccess:u=>{y.info("INCIDENT_DETAIL","Replay completed",{match_level:u.match_level}),r(!1),c(u)},onError:u=>{y.error("INCIDENT_DETAIL","Replay failed",u),r(!1)}}),v=()=>{const u=(i==null?void 0:i.call_id)||(i==null?void 0:i.incident_id)||t;u&&d.mutate(u)},p=async()=>{if(i)try{await E.downloadEvidenceReport(i.incident_id,{includeReplay:!0,includePrevention:!0,isDemo:!0}),y.info("INCIDENT_DETAIL","Evidence exported")}catch(u){y.error("INCIDENT_DETAIL","Export failed",u)}},h=i==null?void 0:i.events.some(u=>{var w,g;return((w=u.data)==null?void 0:w.action)==="block"||((g=u.data)==null?void 0:g.action)==="freeze"}),f=(i==null?void 0:i.policy_evaluations.filter(u=>u.result==="FAIL"))||[],o=h?"critical":f.length>0?"high":"medium",_=Pt[o];return l?e.jsx("div",{className:"min-h-screen bg-slate-900 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(z,{root:{label:"Incidents",path:I.incidents},entity:{label:t||"",id:t,path:I.incidentDetail(t||"")}}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})}):m||!i?e.jsx("div",{className:"min-h-screen bg-slate-900 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(z,{root:{label:"Incidents",path:I.incidents},entity:{label:t||"",id:t,path:I.incidentDetail(t||"")}}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-8 text-center",children:[e.jsx(re,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Incident Not Found"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"The requested incident could not be loaded."}),e.jsx("button",{onClick:()=>s(I.incidents),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-white text-sm",children:"Back to Incidents"})]})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-900 p-6",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(z,{root:{label:"Incidents",path:I.incidents},entity:{label:i.incident_id,id:i.incident_id,path:I.incidentDetail(i.incident_id)}}),e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("button",{onClick:()=>s(I.incidents),className:"p-1 hover:bg-slate-800 rounded",children:e.jsx(Ke,{className:"w-5 h-5 text-slate-400"})}),e.jsx(Ve,{className:"w-6 h-6 text-slate-500"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Incident Detail"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"O3 Accountability View - PIN-186 Compliant"})]}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${_.border}/30`,children:[h?e.jsx(ze,{className:`w-5 h-5 ${_.color}`}):f.length>0?e.jsx(re,{className:`w-5 h-5 ${_.color}`}):e.jsx(De,{className:`w-5 h-5 ${_.color}`}),e.jsx("span",{className:`font-bold text-sm ${_.color}`,children:_.label.toUpperCase()})]})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6",children:[e.jsx(L,{title:"Incident Identity",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Incident ID"}),e.jsx("p",{className:"font-mono text-white mt-1",children:i.incident_id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Timestamp"}),e.jsx("p",{className:"text-white mt-1",children:new Date(((N=i.events[0])==null?void 0:N.timestamp)||Date.now()).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Model"}),e.jsx("p",{className:"text-white mt-1",children:i.model})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Latency"}),e.jsxs("p",{className:"text-white mt-1",children:[i.latency_ms,"ms"]})]})]})}),e.jsx(L,{title:"Verdict",children:e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${_.border} bg-slate-900/50`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${h?"border-red-500/40 text-red-400":f.length>0?"border-amber-500/40 text-amber-400":"border-green-500/40 text-green-400"}`,children:h?"Traffic Blocked":f.length>0?"Policy Gap":"OK"}),e.jsxs("span",{className:"text-slate-400 text-sm",children:[f.length," of ",i.policy_evaluations.length," policies failed"]})]}),e.jsxs("span",{className:"text-slate-500 text-sm",children:["Cost: $",(i.cost_cents/100).toFixed(4)]})]})})}),i.root_cause_badge&&e.jsx(L,{title:"Root Cause",children:e.jsxs("div",{className:"bg-slate-900/50 border-l-4 border-amber-500 p-4 rounded-r",children:[e.jsx("p",{className:"font-medium text-amber-400 mb-2",children:i.root_cause_badge}),e.jsx("p",{className:"text-slate-400 text-sm",children:i.root_cause})]})}),e.jsx(L,{title:"Related Entities",children:e.jsx("div",{className:"flex flex-wrap gap-3",children:i.call_id&&e.jsxs(Ee,{to:`/traces/${i.call_id}`,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-white text-sm transition-colors",children:[e.jsx(qe,{className:"w-4 h-4"}),"View Trace",e.jsx(Ue,{className:"w-3 h-3 text-slate-400"})]})})}),e.jsx(L,{title:"Actions",children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white text-sm transition-colors",children:[e.jsx(Be,{className:"w-4 h-4"}),"Replay Execution"]}),e.jsxs("button",{onClick:p,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-white text-sm transition-colors",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Export Evidence"]})]})}),e.jsx(L,{title:"Decision Timeline",children:e.jsx(Ct,{timeline:i})})]})]}),a&&e.jsx(Lt,{incidentId:i.incident_id,onConfirm:v,onCancel:()=>r(!1),isLoading:d.isPending}),n&&e.jsx(Ot,{result:n,onClose:()=>c(null)})]})}const Ft={connected:{label:"Connected",color:"text-accent-success",bg:"bg-accent-success/20"},disconnected:{label:"Disconnected",color:"text-slate-400",bg:"bg-slate-500/20"},error:{label:"Error",color:"text-accent-danger",bg:"bg-accent-danger/20"}},ve={"run.started":"Run Started","run.completed":"Run Completed","run.failed":"Run Failed","incident.created":"Incident Created","incident.resolved":"Incident Resolved","policy.violated":"Policy Violated","budget.exceeded":"Budget Exceeded"};function je(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function te(t){const s=new Date(t),r=new Date().getTime()-s.getTime(),n=Math.floor(r/6e4),c=Math.floor(r/36e5),i=Math.floor(r/864e5);return n<1?"Just now":n<60?`${n}m ago`:c<24?`${c}h ago`:`${i}d ago`}function qt(){const[t,s]=x.useState("webhooks"),[a,r]=x.useState(null);x.useEffect(()=>(y.componentMount("CustomerIntegrationsPage"),()=>y.componentUnmount("CustomerIntegrationsPage")),[]);const{data:n,isLoading:c,refetch:i}=T({queryKey:["customer","integrations"],queryFn:async()=>{const d=Date.now(),v=[{id:"wh_001",name:"Slack Alerts",url:"https://hooks.slack.com/services/T00/B00/XXX",events:["incident.created","policy.violated","budget.exceeded"],enabled:!0,created_at:new Date(d-30*864e5).toISOString(),last_triggered:new Date(d-36e5).toISOString(),success_rate:99.2,total_deliveries:1247},{id:"wh_002",name:"PagerDuty Incidents",url:"https://events.pagerduty.com/integration/XXX/enqueue",events:["incident.created","run.failed"],enabled:!0,created_at:new Date(d-14*864e5).toISOString(),last_triggered:new Date(d-72e5).toISOString(),success_rate:100,total_deliveries:89},{id:"wh_003",name:"Analytics Pipeline",url:"https://analytics.example.com/ingest/aos",events:["run.started","run.completed","run.failed"],enabled:!1,created_at:new Date(d-60*864e5).toISOString(),last_triggered:new Date(d-7*864e5).toISOString(),success_rate:94.5,total_deliveries:5623}],p=[{id:"int_001",name:"GitHub",type:"oauth",provider:"github",status:"connected",connected_at:new Date(d-45*864e5).toISOString(),last_sync:new Date(d-18e5).toISOString(),icon:"ðŸ™"},{id:"int_002",name:"Slack",type:"oauth",provider:"slack",status:"connected",connected_at:new Date(d-30*864e5).toISOString(),last_sync:new Date(d-36e5).toISOString(),icon:"ðŸ’¬"},{id:"int_003",name:"Datadog",type:"api_key",provider:"datadog",status:"connected",connected_at:new Date(d-20*864e5).toISOString(),last_sync:new Date(d-3e5).toISOString(),icon:"ðŸ“Š"},{id:"int_004",name:"Jira",type:"oauth",provider:"jira",status:"disconnected",icon:"ðŸ“‹"},{id:"int_005",name:"Linear",type:"api_key",provider:"linear",status:"error",connected_at:new Date(d-10*864e5).toISOString(),icon:"ðŸ“"}];return{webhooks:v,integrations:p}},refetchInterval:6e4,staleTime:3e4}),l=(n==null?void 0:n.webhooks)??[],m=(n==null?void 0:n.integrations)??[];return c?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-slate-400",children:"Loading integrations..."})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”—"})," Integrations"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Manage webhooks and connected services"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>i(),className:"px-3 py-1.5 bg-navy-elevated border border-navy-border hover:bg-navy-subtle rounded-lg text-sm text-slate-300 flex items-center gap-2 transition-colors",children:[e.jsx("span",{children:"ðŸ”„"})," Refresh"]}),e.jsxs("button",{className:"px-3 py-1.5 bg-accent-info/20 border border-accent-info/30 text-accent-info hover:bg-accent-info/30 rounded-lg text-sm flex items-center gap-2 transition-colors",children:[e.jsx("span",{children:"âž•"})," Add Integration"]})]})]}),e.jsxs("div",{className:"mb-6 flex items-center gap-2 border-b border-navy-border",children:[e.jsxs("button",{onClick:()=>s("webhooks"),className:`
            px-4 py-2.5 text-sm font-medium border-b-2 transition-colors -mb-px
            ${t==="webhooks"?"border-accent-info text-accent-info":"border-transparent text-slate-400 hover:text-white"}
          `,children:["Webhooks (",l.length,")"]}),e.jsxs("button",{onClick:()=>s("services"),className:`
            px-4 py-2.5 text-sm font-medium border-b-2 transition-colors -mb-px
            ${t==="services"?"border-accent-info text-accent-info":"border-transparent text-slate-400 hover:text-white"}
          `,children:["Connected Services (",m.length,")"]})]}),t==="webhooks"?e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"bg-navy-surface rounded-xl border border-navy-border overflow-hidden",children:l.length===0?e.jsx("div",{className:"p-8 text-center text-slate-400",children:"No webhooks configured"}):e.jsx("div",{className:"divide-y divide-navy-border",children:l.map(d=>{const v=(a==null?void 0:a.id)===d.id;return e.jsxs("div",{onClick:()=>r(d),className:`
                          p-4 cursor-pointer transition-colors
                          ${v?"bg-navy-elevated":"hover:bg-navy-elevated/50"}
                        `,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸª"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:d.name}),d.enabled?e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-accent-success/20 text-accent-success",children:"Active"}):e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-slate-500/20 text-slate-400",children:"Disabled"})]}),e.jsx("div",{className:"text-sm text-slate-400 mt-1 font-mono truncate max-w-md",children:d.url.replace(/\/[A-Za-z0-9]{10,}.*$/,"/***")})]})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"text-slate-300",children:[d.success_rate,"% success"]}),e.jsxs("div",{className:"text-slate-500",children:[d.total_deliveries," deliveries"]})]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:d.events.map(p=>e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-navy-inset text-slate-300",children:ve[p]||p},p))}),d.last_triggered&&e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["Last triggered: ",te(d.last_triggered)]})]},d.id)})})})}),a&&e.jsx("div",{className:"w-96",children:e.jsx(Kt,{webhook:a,onClose:()=>r(null)})})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[m.map(d=>{const v=Ft[d.status];return e.jsxs("div",{className:"bg-navy-surface rounded-xl border border-navy-border p-4 hover:border-navy-border/80 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:d.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:d.name}),e.jsx("div",{className:"text-xs text-slate-400 capitalize",children:d.type.replace("_"," ")})]})]}),e.jsx("span",{className:`
                    px-2 py-0.5 text-xs rounded font-medium
                    ${v.color} ${v.bg}
                  `,children:v.label})]}),d.connected_at&&e.jsx("div",{className:"mt-4 pt-4 border-t border-navy-border",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Connected"}),e.jsx("div",{className:"text-slate-300",children:je(d.connected_at)})]}),d.last_sync&&e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Last Sync"}),e.jsx("div",{className:"text-slate-300",children:te(d.last_sync)})]})]})}),e.jsx("div",{className:"mt-4 flex items-center gap-2",children:d.status==="connected"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"flex-1 px-3 py-1.5 bg-navy-elevated border border-navy-border rounded-lg text-sm text-slate-300 hover:bg-navy-subtle transition-colors",children:"Configure"}),e.jsx("button",{className:"px-3 py-1.5 bg-navy-elevated border border-accent-danger/30 rounded-lg text-sm text-accent-danger hover:bg-navy-subtle transition-colors",children:"Disconnect"})]}):d.status==="error"?e.jsx("button",{className:"flex-1 px-3 py-1.5 bg-accent-warning/20 border border-accent-warning/30 rounded-lg text-sm text-accent-warning hover:bg-accent-warning/30 transition-colors",children:"Reconnect"}):e.jsx("button",{className:"flex-1 px-3 py-1.5 bg-accent-info/20 border border-accent-info/30 rounded-lg text-sm text-accent-info hover:bg-accent-info/30 transition-colors",children:"Connect"})})]},d.id)}),e.jsxs("div",{className:"bg-navy-surface rounded-xl border border-dashed border-navy-border p-4 flex flex-col items-center justify-center min-h-[180px] hover:border-accent-info/30 transition-colors cursor-pointer",children:[e.jsx("span",{className:"text-3xl mb-2",children:"âž•"}),e.jsx("span",{className:"text-slate-400",children:"Add Integration"})]})]})]})}function Kt({webhook:t,onClose:s}){return e.jsxs("div",{className:"bg-navy-surface rounded-xl border border-navy-border p-4 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold text-white",children:"Webhook Details"}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white transition-colors",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:t.name}),t.enabled?e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-accent-success/20 text-accent-success",children:"Active"}):e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-slate-500/20 text-slate-400",children:"Disabled"})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Endpoint URL"}),e.jsx("div",{className:"font-mono text-sm text-slate-300 bg-navy-inset rounded px-3 py-2 break-all",children:t.url})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Subscribed Events"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.events.map(a=>e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-navy-inset text-slate-300",children:ve[a]||a},a))})]}),e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-slate-500 font-bold uppercase tracking-wide mb-3",children:"Delivery Stats"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-navy-inset rounded-lg p-3 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[t.success_rate,"%"]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Success Rate"})]}),e.jsxs("div",{className:"bg-navy-inset rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t.total_deliveries}),e.jsx("div",{className:"text-xs text-slate-400",children:"Total Deliveries"})]})]})]}),e.jsx("div",{className:"pt-4 border-t border-navy-border",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Created"}),e.jsx("span",{className:"text-slate-300",children:je(t.created_at)})]}),t.last_triggered&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Last Triggered"}),e.jsx("span",{className:"text-slate-300",children:te(t.last_triggered)})]})]})}),e.jsxs("div",{className:"pt-4 border-t border-navy-border flex gap-2",children:[e.jsx("button",{className:"flex-1 px-3 py-2 bg-navy-elevated border border-navy-border rounded-lg text-sm text-slate-300 hover:bg-navy-subtle transition-colors",children:"Edit"}),e.jsx("button",{className:"flex-1 px-3 py-2 bg-navy-elevated border border-navy-border rounded-lg text-sm text-slate-300 hover:bg-navy-subtle transition-colors",children:"Test"}),t.enabled?e.jsx("button",{className:"px-3 py-2 bg-navy-elevated border border-accent-warning/30 rounded-lg text-sm text-accent-warning hover:bg-navy-subtle transition-colors",children:"Disable"}):e.jsx("button",{className:"px-3 py-2 bg-accent-success/20 border border-accent-success/30 rounded-lg text-sm text-accent-success hover:bg-accent-success/30 transition-colors",children:"Enable"})]}),e.jsxs("div",{className:"pt-4 border-t border-navy-border",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Webhook ID"}),e.jsx("div",{className:"font-mono text-xs text-slate-400 bg-navy-inset rounded px-2 py-1",children:t.id})]})]})]})}const Ut={active:{label:"Active",color:"text-green-400",border:"border-green-400/40"},frozen:{label:"Frozen",color:"text-amber-400",border:"border-amber-400/40"},revoked:{label:"Revoked",color:"text-red-400",border:"border-red-400/40"}};function Gt(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Bt(){const t=Te(),[s,a]=x.useState(!1),[r,n]=x.useState(null),[c,i]=x.useState(null),[l,m]=x.useState(null),[d,v]=x.useState(""),[p,h]=x.useState(!1);x.useEffect(()=>(y.componentMount("CustomerKeysPage"),()=>y.componentUnmount("CustomerKeysPage")),[]);const{data:f,isLoading:o}=T({queryKey:["customer","keys"],queryFn:async()=>[{id:"key_prod_001",name:"Production",prefix:"sk-prod-****1a2b",status:"active",created_at:new Date(Date.now()-30*24*36e5).toISOString(),last_used_at:new Date(Date.now()-6e4).toISOString(),requests_today:1234,spend_today_cents:234},{id:"key_dev_002",name:"Development",prefix:"sk-dev-****3c4d",status:"active",created_at:new Date(Date.now()-14*24*36e5).toISOString(),last_used_at:new Date(Date.now()-36e5).toISOString(),requests_today:56,spend_today_cents:12},{id:"key_test_003",name:"Testing (Old)",prefix:"sk-test-****5e6f",status:"revoked",created_at:new Date(Date.now()-60*24*36e5).toISOString(),last_used_at:null,requests_today:0,spend_today_cents:0}],refetchInterval:3e4,staleTime:1e4}),_=K({mutationFn:async b=>{const j=`key_${Math.random().toString(36).slice(2,8)}`,D=`sk-${b.toLowerCase().slice(0,4)}-${Math.random().toString(36).slice(2,10)}${Math.random().toString(36).slice(2,10)}`;return{id:j,name:b,key:D,prefix:`${D.slice(0,7)}****${D.slice(-4)}`,created_at:new Date().toISOString()}},onSuccess:b=>{m(b),a(!1),v(""),t.invalidateQueries({queryKey:["customer","keys"]})}}),N=K({mutationFn:async b=>{const j=f==null?void 0:f.find(V=>V.id===b),D=`sk-${(j==null?void 0:j.name.toLowerCase().slice(0,4))||"key"}-${Math.random().toString(36).slice(2,10)}${Math.random().toString(36).slice(2,10)}`;return{id:b,name:(j==null?void 0:j.name)||"Rotated Key",key:D,prefix:`${D.slice(0,7)}****${D.slice(-4)}`,created_at:new Date().toISOString()}},onSuccess:b=>{m(b),n(null),t.invalidateQueries({queryKey:["customer","keys"]})}}),u=K({mutationFn:async b=>({success:!0}),onSuccess:()=>{i(null),t.invalidateQueries({queryKey:["customer","keys"]})}}),w=async()=>{l!=null&&l.key&&(await navigator.clipboard.writeText(l.key),h(!0),setTimeout(()=>h(!1),2e3))},g=()=>{m(null),h(!1)};return o?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-slate-400",children:"Loading keys..."})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”‘"})," API Keys"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Manage your API keys for accessing the service"})]}),e.jsx("button",{onClick:()=>a(!0),className:"px-4 py-2 bg-accent-info hover:bg-accent-info/80 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2",children:"+ Create Key"})]}),l&&e.jsx("div",{className:"mb-6 bg-green-500/10 border border-green-400/40 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-bold text-green-400",children:[l.name," Key Created"]}),e.jsxs("p",{className:"text-sm text-slate-300 mt-1",children:["Copy this key now. ",e.jsx("span",{className:"text-amber-400 font-medium",children:"You will not see it again."})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-navy-inset border border-navy-border rounded-lg px-4 py-3 font-mono text-sm text-white break-all",children:l.key}),e.jsx("button",{onClick:w,className:`
                    px-4 py-3 rounded-lg text-sm font-medium transition-colors
                    ${p?"bg-green-500 text-white":"bg-navy-elevated border border-navy-border text-white hover:bg-navy-subtle"}
                  `,children:p?"âœ“ Copied":"Copy"})]}),e.jsx("button",{onClick:g,className:"mt-4 text-sm text-slate-400 hover:text-white transition-colors",children:"I have copied the key, dismiss this message"})]})]})}),e.jsx("div",{className:"bg-navy-surface rounded-xl border border-navy-border overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-navy-elevated",children:e.jsxs("tr",{className:"text-left text-sm text-slate-400",children:[e.jsx("th",{className:"p-4",children:"Name"}),e.jsx("th",{className:"p-4",children:"Key"}),e.jsx("th",{className:"p-4",children:"Status"}),e.jsx("th",{className:"p-4",children:"Created"}),e.jsx("th",{className:"p-4",children:"Today"}),e.jsx("th",{className:"p-4",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-navy-border",children:f==null?void 0:f.map(b=>{const j=Ut[b.status];return e.jsxs("tr",{children:[e.jsx("td",{className:"p-4 font-medium text-white",children:b.name}),e.jsx("td",{className:"p-4 font-mono text-sm text-slate-400",children:b.prefix}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`
                      px-2 py-1 rounded border text-xs font-medium bg-transparent
                      ${j.color} ${j.border}
                    `,children:j.label})}),e.jsx("td",{className:"p-4 text-sm text-slate-400",children:Gt(b.created_at)}),e.jsx("td",{className:"p-4 text-sm text-slate-400",children:b.status==="active"?e.jsxs("span",{children:[b.requests_today," req â€¢ $",(b.spend_today_cents/100).toFixed(2)]}):e.jsx("span",{className:"text-slate-600",children:"â€”"})}),e.jsxs("td",{className:"p-4",children:[b.status==="active"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n(b),className:"px-3 py-1 text-sm text-amber-400 hover:bg-amber-500/10 rounded transition-colors",children:"Rotate"}),e.jsx("button",{onClick:()=>i(b),className:"px-3 py-1 text-sm text-red-400 hover:bg-red-500/10 rounded transition-colors",children:"Revoke"})]}),b.status==="revoked"&&e.jsx("span",{className:"text-sm text-slate-600",children:"Revoked"})]})]},b.id)})})]})}),e.jsxs("div",{className:"mt-6 bg-navy-elevated border border-accent-info/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-accent-info flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”’"})," Security Best Practices"]}),e.jsxs("ul",{className:"text-sm text-slate-300 mt-2 space-y-1",children:[e.jsx("li",{children:"â€¢ Never share your API keys or commit them to version control"}),e.jsx("li",{children:"â€¢ Use environment variables to store keys in your applications"}),e.jsx("li",{children:"â€¢ Rotate keys regularly and after any suspected compromise"}),e.jsx("li",{children:"â€¢ Use separate keys for production and development"})]})]}),s&&e.jsx(Q,{title:"Create New API Key",onClose:()=>a(!1),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Key Name"}),e.jsx("input",{type:"text",value:d,onChange:b=>v(b.target.value),placeholder:"e.g., Production, Development",className:"w-full px-4 py-2 bg-navy-inset border border-navy-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-accent-info",autoFocus:!0})]}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-400/30 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-amber-400",children:"The key will only be shown once after creation. Make sure to copy it immediately."})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:()=>a(!1),className:"px-4 py-2 text-slate-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>_.mutate(d),disabled:!d.trim()||_.isPending,className:"px-4 py-2 bg-accent-info hover:bg-accent-info/80 disabled:bg-slate-700 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:_.isPending?"Creating...":"Create Key"})]})]})}),r&&e.jsx(Q,{title:"Rotate API Key",onClose:()=>n(null),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-slate-300",children:["Rotating ",e.jsx("span",{className:"font-medium text-white",children:r.name})," will:"]}),e.jsxs("ul",{className:"text-sm text-slate-400 space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Generate a new key"}),e.jsx("li",{children:"â€¢ Immediately invalidate the current key"}),e.jsx("li",{children:"â€¢ Any applications using the old key will stop working"})]}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-400/30 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-amber-400",children:"Make sure to update your applications with the new key immediately."})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:()=>n(null),className:"px-4 py-2 text-slate-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>N.mutate(r.id),disabled:N.isPending,className:"px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg font-medium transition-colors",children:N.isPending?"Rotating...":"Rotate Key"})]})]})}),c&&e.jsx(Q,{title:"Revoke API Key",onClose:()=>i(null),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-slate-300",children:["Are you sure you want to revoke ",e.jsx("span",{className:"font-medium text-white",children:c.name}),"?"]}),e.jsxs("div",{className:"bg-red-500/10 border border-red-400/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-400 font-medium",children:"This action cannot be undone."}),e.jsx("p",{className:"text-sm text-red-300 mt-1",children:"The key will be permanently disabled and cannot be recovered."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:()=>i(null),className:"px-4 py-2 text-slate-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>u.mutate(c.id),disabled:u.isPending,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors",children:u.isPending?"Revoking...":"Revoke Key"})]})]})})]})}function Q({title:t,children:s,onClose:a}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative bg-navy-surface border border-navy-border rounded-xl p-6 w-full max-w-md shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:t}),e.jsx("button",{onClick:a,className:"text-slate-400 hover:text-white transition-colors",children:"âœ•"})]}),s]})]})}function Vt(){const[t,s]=x.useState("guardrails");x.useEffect(()=>(y.componentMount("AIConsoleSettingsPage"),()=>y.componentUnmount("AIConsoleSettingsPage")),[]);const{data:a,isLoading:r}=T({queryKey:["guard","settings"],queryFn:E.getSettings}),n=a||{tenant_id:"demo-tenant",tenant_name:"Demo Company",plan:"pro",guardrails:[{id:"gr_1",name:"Max Cost Per Request",description:"Block requests that would exceed this cost",enabled:!0,threshold_type:"cost",threshold_value:10,threshold_unit:"cents",action_on_trigger:"block"},{id:"gr_2",name:"Rate Limit",description:"Limit requests per minute per user",enabled:!0,threshold_type:"rate",threshold_value:60,threshold_unit:"requests/min",action_on_trigger:"throttle"},{id:"gr_3",name:"Prompt Injection Block",description:"Detect and block prompt injection attempts",enabled:!0,threshold_type:"pattern",threshold_value:.8,threshold_unit:"confidence",action_on_trigger:"block"},{id:"gr_4",name:"Daily Budget",description:"Stop traffic when daily budget is exceeded",enabled:!0,threshold_type:"cost",threshold_value:5e3,threshold_unit:"cents",action_on_trigger:"killswitch"}],budget_limit_cents:5e3,budget_period:"daily",kill_switch_enabled:!0,kill_switch_auto_trigger:!0,auto_trigger_threshold_cents:5e3,notification_email:"alerts@company.com",notification_slack_webhook:"https://hooks.slack.com/..."},c=[{id:"guardrails",label:"Guardrails",icon:"ðŸ”’"},{id:"notifications",label:"Notifications",icon:"ðŸ””"},{id:"keys",label:"API Keys",icon:"ðŸ”‘"},{id:"export",label:"Export",icon:"ðŸ“¤"}];return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-navy-elevated border border-amber-500/30 rounded-lg px-4 py-3 mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"text-amber-400",children:"ðŸ”’"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-amber-400 font-medium",children:"Demo Mode"}),e.jsx("span",{className:"text-slate-400 ml-2",children:"Settings are read-only. Changes available in production."})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"âš™ï¸"})," Settings"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"View guardrails, notifications, and export options"})]}),e.jsx("div",{className:"flex gap-2 mb-6 border-b border-navy-border pb-2",children:c.map(i=>e.jsxs("button",{onClick:()=>s(i.id),className:`
              px-4 py-2 rounded-t-lg font-medium transition-colors
              ${t===i.id?"bg-navy-elevated text-accent-info border-b-2 border-accent-info":"text-slate-400 hover:text-white hover:bg-navy-elevated"}
            `,children:[e.jsx("span",{className:"mr-2",children:i.icon}),i.label]},i.id))}),t==="guardrails"&&e.jsx(zt,{guardrails:n.guardrails}),t==="notifications"&&e.jsx(Yt,{settings:n}),t==="keys"&&e.jsx(Qt,{}),t==="export"&&e.jsx(Xt,{})]})}function zt({guardrails:t}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Active Guardrails"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Protection rules for your AI traffic"})]}),e.jsx("button",{disabled:!0,className:"px-4 py-2 bg-navy-elevated border border-navy-border text-slate-500 rounded-lg text-sm font-medium cursor-not-allowed opacity-60",children:"+ Add Guardrail"})]}),e.jsx("div",{className:"bg-navy-surface rounded-xl border border-navy-border overflow-hidden",children:t.map((s,a)=>e.jsx("div",{className:`p-4 ${a>0?"border-t border-navy-border":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Wt,{enabled:s.enabled}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:s.name}),e.jsx("p",{className:"text-sm text-slate-400",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-bold text-accent-info",children:s.threshold_value}),e.jsx("span",{className:"text-sm text-slate-400 ml-1",children:s.threshold_unit})]}),e.jsx(Ht,{action:s.action_on_trigger})]})]})},s.id))}),e.jsxs("div",{className:"bg-navy-elevated border border-accent-info/20 rounded-lg p-4 mt-6",children:[e.jsxs("h4",{className:"font-medium text-accent-info flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¡"})," Understanding Guardrails"]}),e.jsx("p",{className:"text-sm text-slate-300 mt-2",children:"Guardrails protect your AI traffic by enforcing limits. Actions:"}),e.jsxs("ul",{className:"text-sm text-slate-300 mt-2 space-y-1 ml-4",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("span",{className:"text-red-400",children:"Block"})," â€” Stop request immediately"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("span",{className:"text-amber-400",children:"Throttle"})," â€” Slow down request rate"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("span",{className:"text-red-400",children:"Kill Switch"})," â€” Stop all traffic"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("span",{className:"text-blue-400",children:"Warn"})," â€” Log but allow"]})]})]})]})}function Wt({enabled:t}){return e.jsxs("div",{className:`
      flex items-center gap-2 px-3 py-1.5 rounded-lg
      border ${t?"border-green-500/30":"border-slate-600"}
      ${t?"text-green-400":"text-slate-500"}
    `,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t?"bg-green-400":"bg-slate-600"}`}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wide",children:t?"Enabled":"Disabled"})]})}function Ht({action:t}){const a={block:{text:"text-red-400",border:"border-red-400/40"},throttle:{text:"text-amber-400",border:"border-amber-400/40"},killswitch:{text:"text-red-400",border:"border-red-400/40"},warn:{text:"text-blue-400",border:"border-blue-400/40"}}[t]||{text:"text-slate-400",border:"border-slate-600"};return e.jsx("span",{className:`px-2 py-1 rounded border text-xs font-medium bg-transparent ${a.text} ${a.border}`,children:t})}function Yt({settings:t}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Notification Settings"}),e.jsx("p",{className:"text-sm text-slate-400",children:"View alert configuration"})]}),e.jsxs("div",{className:"bg-navy-surface rounded-xl border border-navy-border p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Alert Email"}),e.jsx("div",{className:"w-full bg-navy-inset border border-navy-border rounded-lg px-4 py-2 text-slate-400",children:t.notification_email}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Receives alerts when guardrails trigger"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Slack Webhook"}),e.jsx("div",{className:"w-full bg-navy-inset border border-navy-border rounded-lg px-4 py-2 text-slate-400 font-mono text-sm",children:t.notification_slack_webhook?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢":"Not configured"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Alert Preferences"}),e.jsx("div",{className:"space-y-3",children:[{label:"Guardrail triggered",enabled:!0},{label:"Kill switch activated",enabled:!0},{label:"Budget threshold (80%)",enabled:!0},{label:"Weekly summary",enabled:!1}].map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:s.enabled?"text-green-400":"text-slate-600",children:s.enabled?"âœ“":"â—‹"}),e.jsx("span",{className:s.enabled?"text-slate-300":"text-slate-500",children:s.label})]},a))})]})]})]})}function Qt(){const{data:t}=T({queryKey:["guard","keys"],queryFn:E.getApiKeys}),s=(t==null?void 0:t.items)||[{id:"key_1",name:"Production",prefix:"sk-prod-****",status:"active",requests_today:1234,spend_today_cents:234},{id:"key_2",name:"Development",prefix:"sk-dev-****",status:"active",requests_today:56,spend_today_cents:12},{id:"key_3",name:"Testing",prefix:"sk-test-****",status:"frozen",requests_today:0,spend_today_cents:0}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"API Keys"}),e.jsx("p",{className:"text-sm text-slate-400",children:"View your API keys"})]}),e.jsx("button",{disabled:!0,className:"px-4 py-2 bg-navy-elevated border border-navy-border text-slate-500 rounded-lg text-sm font-medium cursor-not-allowed opacity-60",children:"+ Create Key"})]}),e.jsx("div",{className:"bg-navy-surface rounded-xl border border-navy-border overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-navy-elevated",children:e.jsxs("tr",{className:"text-left text-sm text-slate-400",children:[e.jsx("th",{className:"p-4",children:"Name"}),e.jsx("th",{className:"p-4",children:"Key"}),e.jsx("th",{className:"p-4",children:"Status"}),e.jsx("th",{className:"p-4",children:"Today"})]})}),e.jsx("tbody",{className:"divide-y divide-navy-border",children:s.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-4 font-medium text-white",children:a.name}),e.jsx("td",{className:"p-4 font-mono text-sm text-slate-400",children:a.prefix}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`
                    px-2 py-1 rounded border text-xs font-medium bg-transparent
                    ${a.status==="active"?"text-green-400 border-green-400/40":"text-red-400 border-red-400/40"}
                  `,children:a.status})}),e.jsxs("td",{className:"p-4 text-sm text-slate-400",children:[a.requests_today," req â€¢ $",(a.spend_today_cents/100).toFixed(2)]})]},a.id))})]})})]})}function Xt(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Data Export"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Export data for compliance or analysis"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{icon:"ðŸ“Š",title:"Usage Report",description:"API usage data for selected period",format:"CSV"},{icon:"ðŸ“‹",title:"Incidents Report",description:"Incidents with decision timelines",format:"PDF"},{icon:"ðŸ”",title:"Audit Log",description:"Complete audit trail for compliance",format:"JSON"},{icon:"ðŸ“ˆ",title:"Analytics Export",description:"Metrics and trends for analysis",format:"CSV"}].map((t,s)=>e.jsxs("div",{className:"bg-navy-surface rounded-xl border border-navy-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:t.title}),e.jsx("span",{className:"text-xs text-slate-500",children:t.format})]})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:t.description}),e.jsx("button",{className:"w-full px-4 py-2 bg-navy-elevated hover:bg-navy-subtle border border-navy-border text-slate-300 rounded-lg text-sm transition-colors",children:"ðŸ“¥ Export"})]},s))})]})}function Jt(){var c;$(i=>i.tenantId),x.useEffect(()=>(y.componentMount("AccountPage"),()=>y.componentUnmount("AccountPage")),[]);const{data:t,isLoading:s,error:a}=T({queryKey:["guard","settings"],queryFn:E.getSettings,retry:1}),r={name:"Acme Corp",environment:"demo",region:"us-west-2",created:"2024-11-15",plan:(t==null?void 0:t.plan)||"starter",owner:"admin@company.com"},n=[{email:"admin@company.com",role:"Owner",lastActive:"2 hours ago"},{email:"ops@company.com",role:"Admin",lastActive:"1 day ago"},{email:"dev@company.com",role:"Viewer",lastActive:"3 days ago"}];return e.jsxs("div",{className:"p-6 space-y-6 max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg px-4 py-2 text-center",children:e.jsxs("span",{className:"text-amber-400 text-sm",children:["âš ï¸ You are viewing ",e.jsx("strong",{children:"Demo mode"})," â€” settings are read-only."]})}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-700",children:e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ¢"})," Organization"]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx(O,{label:"Organization Name",value:r.name}),e.jsx(O,{label:"Environment",value:r.environment.toUpperCase(),badge:!0}),e.jsx(O,{label:"Region",value:r.region}),e.jsx(O,{label:"Created",value:new Date(r.created).toLocaleDateString()}),e.jsx(O,{label:"Plan",value:r.plan.charAt(0).toUpperCase()+r.plan.slice(1)}),e.jsx(O,{label:"Owner",value:r.owner})]})})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-700",children:e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“Š"})," Plan & Limits"]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(X,{label:"Monthly Budget",current:t!=null&&t.budget_limit_cents?t.budget_limit_cents/100:100,max:500,unit:"$"}),e.jsx(X,{label:"API Keys",current:3,max:10,unit:"keys"}),e.jsx(X,{label:"Guardrails",current:((c=t==null?void 0:t.guardrails)==null?void 0:c.length)||5,max:20,unit:"rules"})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-700",children:e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium transition-colors",children:"Upgrade Plan"})})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ‘¥"})," Team Members"]}),e.jsx("span",{className:"text-xs bg-slate-700 px-2 py-1 rounded",children:"Read-only in demo"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:n.map((i,l)=>e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-700 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:i.email}),e.jsxs("span",{className:"block text-sm text-slate-400",children:["Last active: ",i.lastActive]})]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${i.role==="Owner"?"bg-purple-500/20 text-purple-400":i.role==="Admin"?"bg-blue-500/20 text-blue-400":"bg-slate-600 text-slate-300"}`,children:i.role})]},l))}),e.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-700/30",children:e.jsx("button",{className:"text-sm text-slate-400 hover:text-white transition-colors",disabled:!0,children:"+ Invite team member (upgrade required)"})})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-red-500/30 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-red-500/30",children:e.jsxs("h2",{className:"text-lg font-bold text-red-400 flex items-center gap-2",children:[e.jsx("span",{children:"âš ï¸"})," Danger Zone"]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Permanently delete your organization and all associated data. This action cannot be undone."}),e.jsx("button",{className:"px-4 py-2 border border-red-500 text-red-400 hover:bg-red-500/20 rounded-lg text-sm font-medium transition-colors",disabled:!0,children:"Delete Organization (disabled in demo)"})]})]})]})}function O({label:t,value:s,badge:a}){return e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-400",children:t}),a?e.jsx("span",{className:"block mt-1",children:e.jsx("span",{className:"px-2 py-1 bg-amber-500/20 text-amber-400 rounded text-sm font-medium",children:s})}):e.jsx("span",{className:"block font-medium text-white mt-1",children:s})]})}function X({label:t,current:s,max:a,unit:r}){const n=s/a*100;return e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4",children:[e.jsx("span",{className:"text-sm text-slate-400",children:t}),e.jsxs("div",{className:"flex items-end gap-1 mt-1",children:[e.jsx("span",{className:"text-2xl font-bold",children:r==="$"?`$${s}`:s}),e.jsxs("span",{className:"text-slate-400 text-sm mb-0.5",children:["/ ",r==="$"?`$${a}`:`${a} ${r}`]})]}),e.jsx("div",{className:"mt-2 h-2 bg-slate-600 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${n>80?"bg-red-500":n>50?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${n}%`}})})]})}const Zt="",q="guard-console-api-key",he="guard-console-tenant-id",es=new Pe({defaultOptions:{queries:{staleTime:5e3,retry:2,refetchOnWindowFocus:!0}}});function ys(){const t=B(),[s]=Ae(),{isAuthenticated:a,token:r,tenantId:n,user:c,logout:i}=$(),[l,m]=x.useState(""),[d,v]=x.useState(""),[p,h]=x.useState(!1),[f,o]=x.useState(""),[_,N]=x.useState(!1),[u,w]=x.useState(null),g=$e(),b=x.useMemo(()=>{const k=g.pathname,R=ne.replace("/","\\/"),F=new RegExp(`^${R}\\/([a-z]+)`),se=k.match(F);if(se){const ae=se[1];if(["overview","activity","incidents","policies","logs","integrations","keys","settings","account"].includes(ae))return ae}return"overview"},[g.pathname]),j=k=>{t(`${ne}/${k}`)};x.useEffect(()=>{if(a&&r){w("oauth");return}const k=s.get("key");if(k){D(k);return}const R=localStorage.getItem(q);R&&D(R)},[a,r,s]);const D=async k=>{if(k.trim()){h(!0),o("");try{if((await fetch(`${Zt}/api/v1/runtime/capabilities`,{headers:{"X-API-Key":k}})).ok){m(k),N(!0),w("apikey"),localStorage.setItem(q,k);const F=localStorage.getItem(he)||"demo-tenant";$.getState().setTokens(k,""),$.getState().setTenant(F),s.get("key")&&window.history.replaceState({},"",window.location.pathname)}else o("Invalid API key"),localStorage.removeItem(q)}catch{m(k),N(!0),w("apikey"),localStorage.setItem(q,k);const F=localStorage.getItem(he)||"demo-tenant";$.getState().setTokens(k,""),$.getState().setTenant(F)}finally{h(!1)}}},V=k=>{k.preventDefault(),D(d)},ye=()=>{u==="oauth"?(i(),t(le.login,{replace:!0})):(m(""),N(!1),w(null),localStorage.removeItem(q),t(I.overview,{replace:!0}))},Ne=()=>{D("edf7eeb8df7ed639b9d1d8bcac572cea5b8cf97e1dffa00d0d3c5ded0f728aaf")},_e=()=>{t(le.login,{replace:!0})};if(!(u==="oauth"||u==="apikey"&&_))return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-navy-app p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-accent-info to-accent-primary rounded-2xl flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"ðŸ›¡ï¸"})})}),e.jsx("h1",{className:"text-3xl font-bold text-white",children:"AI Console"}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Customer AI Safety Dashboard"})]}),e.jsxs("div",{className:"bg-navy-surface rounded-xl p-6 border border-navy-border",children:[e.jsx("button",{onClick:_e,className:"w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2 mb-4",children:"Sign in with Google or Microsoft"}),e.jsxs("div",{className:"relative my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-navy-border"})}),e.jsx("div",{className:"relative flex justify-center",children:e.jsx("span",{className:"bg-navy-surface px-4 text-sm text-slate-400",children:"or use API key"})})]}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"API Key"}),e.jsx("input",{type:"password",value:d,onChange:k=>v(k.target.value),placeholder:"Enter your API key",className:"w-full px-4 py-3 bg-navy-inset border border-navy-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-accent-info focus:border-transparent",disabled:p})]}),f&&e.jsx("div",{className:"p-3 bg-navy-elevated border border-accent-danger/40 rounded-lg text-accent-danger text-sm",children:f}),e.jsx("button",{type:"submit",disabled:p||!d.trim(),className:"w-full py-3 bg-navy-elevated hover:bg-navy-subtle border border-accent-info text-accent-info disabled:border-navy-border disabled:text-slate-500 disabled:cursor-not-allowed font-medium rounded-lg transition-colors",children:p?"Connecting...":"Sign In with API Key"})]}),e.jsxs("div",{className:"relative my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-navy-border"})}),e.jsx("div",{className:"relative flex justify-center",children:e.jsx("span",{className:"bg-navy-surface px-4 text-sm text-slate-400",children:"or"})})]}),e.jsxs("button",{onClick:Ne,disabled:p,className:"w-full py-3 bg-navy-elevated hover:bg-navy-subtle border border-navy-border text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"ðŸŽ®"})," Try Demo Mode"]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-navy-border",children:e.jsxs("p",{className:"text-xs text-slate-500 text-center",children:["New customer?"," ",e.jsx("a",{href:"/login",className:"text-accent-info hover:underline",children:"Sign up for access"})]})})]}),e.jsx("div",{className:"mt-12 grid grid-cols-3 gap-4 text-center",children:[{icon:"ðŸ”",label:"Investigate",desc:"AI incidents"},{icon:"ðŸ”„",label:"Replay",desc:"Decisions"},{icon:"ðŸ“Š",label:"Export",desc:"Evidence"}].map((k,R)=>e.jsxs("div",{className:"p-4",children:[e.jsx("span",{className:"text-2xl",children:k.icon}),e.jsx("p",{className:"text-white font-medium mt-2",children:k.label}),e.jsx("p",{className:"text-slate-400 text-xs",children:k.desc})]},R))})]})});const we=()=>e.jsxs(Le,{children:[e.jsx(A,{path:"/",element:e.jsx(ie,{to:I.overview,replace:!0})}),e.jsx(A,{path:"overview",element:e.jsx(nt,{})}),e.jsx(A,{path:"activity",element:e.jsx(lt,{})}),e.jsx(A,{path:"incidents",element:e.jsx(yt,{})}),e.jsx(A,{path:"incidents/:incidentId",element:e.jsx(Mt,{})}),e.jsx(A,{path:"policies",element:e.jsx(ot,{})}),e.jsx(A,{path:"logs",element:e.jsx(ut,{})}),e.jsx(A,{path:"integrations",element:e.jsx(qt,{})}),e.jsx(A,{path:"keys",element:e.jsx(Bt,{})}),e.jsx(A,{path:"settings",element:e.jsx(Vt,{})}),e.jsx(A,{path:"account",element:e.jsx(Jt,{})}),e.jsx(A,{path:"*",element:e.jsx(ie,{to:I.overview,replace:!0})})]});return e.jsx(Me,{value:Fe,children:e.jsxs(Re,{client:es,children:[e.jsx(Oe,{}),e.jsx(st,{activeTab:b,onTabChange:j,onLogout:ye,user:u==="oauth"?c:void 0,children:we()})]})})}export{ys as AIConsoleApp,ys as default};

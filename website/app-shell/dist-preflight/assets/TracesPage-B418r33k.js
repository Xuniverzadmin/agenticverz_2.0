import{f as _,r as c,q as h,j as e,B as y,s as u,o as g,v as j,w as T}from"./index-BnpC133k.js";import{E as z}from"./eye-B5J3e2Eo.js";import{G as L}from"./git-branch-90xaKnL0.js";import{R as D}from"./refresh-cw-C0UIxpEg.js";import{S as R}from"./search-Yr3krLgA.js";import{C as o,a as m,b as f}from"./Card-HPKqb9R9.js";import{S as E}from"./Badge-CJIOyQHl.js";import{g as F,c as M}from"./traces-JYQBeVJU.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=_("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);function P(){const[i,N]=c.useState(""),[n,v]=c.useState(""),[a,b]=c.useState(!1),[t,d]=c.useState([]),{data:p,isLoading:S,refetch:k}=h({queryKey:["traces",n],queryFn:()=>F({limit:50,status:n||void 0}),refetchInterval:3e4}),{data:r,isLoading:w}=h({queryKey:["trace-comparison",t],queryFn:()=>t.length===2?M(t[0],t[1]):null,enabled:t.length===2}),x=(Array.isArray(p)?p:[]).filter(s=>!i||s.run_id.toLowerCase().includes(i.toLowerCase())),C=s=>{t.includes(s)?d(t.filter(l=>l!==s)):t.length<2&&d([...t,s])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:"Execution Traces"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Deterministic execution traces with hash verification"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{variant:a?"primary":"outline",size:"sm",onClick:()=>{b(!a),d([])},children:[e.jsx(q,{size:16,className:"mr-1"}),a?"Exit Compare":"Compare Mode"]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>k(),children:e.jsx(D,{size:16})})]})]}),e.jsx(o,{children:e.jsx(m,{children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(R,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by Run ID...",value:i,onChange:s=>N(s.target.value),className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900"})]}),e.jsxs("select",{className:"px-3 py-2 border rounded-lg bg-white dark:bg-gray-800 dark:border-gray-700",value:n,onChange:s=>v(s.target.value),children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"failed",children:"Failed"})]})]})})}),a&&t.length===2&&e.jsxs(o,{children:[e.jsx(f,{title:"Comparison Result"}),e.jsx(m,{children:w?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(u,{})}):r?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("span",{className:g("px-3 py-1 rounded-full text-sm font-medium",r.identical?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:r.identical?"Deterministic Match":"Differences Found"})}),r.differences&&r.differences.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Differences:"}),r.differences.map((s,l)=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded text-sm font-mono",children:[e.jsxs("span",{className:"text-gray-500",children:[s.field,":"]}),e.jsx("span",{className:"text-red-500 ml-2",children:String(s.trace1)}),e.jsx("span",{className:"text-gray-400 mx-2",children:"vs"}),e.jsx("span",{className:"text-green-500",children:String(s.trace2)})]},l))]})]}):e.jsx("p",{className:"text-gray-500",children:"Select two traces to compare"})})]}),e.jsxs(o,{children:[e.jsx(f,{title:`Traces (${x.length})`,children:a&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Selected: ",t.length,"/2"]})}),e.jsx(m,{className:"p-0",children:S?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(u,{size:"lg"})}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("tr",{children:[a&&e.jsx("th",{className:"px-4 py-3 w-12"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Run ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Root Hash"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Steps"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Created"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[x.map(s=>{var l;return e.jsxs("tr",{className:g("hover:bg-gray-50 dark:hover:bg-gray-700/50",a&&t.includes(s.run_id)&&"bg-blue-50 dark:bg-blue-900/20"),children:[a&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:t.includes(s.run_id),onChange:()=>C(s.run_id),disabled:!t.includes(s.run_id)&&t.length>=2,className:"rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm",children:j(s.run_id)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-xs text-gray-500",children:s.root_hash?j(s.root_hash):"--"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(E,{status:s.status})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400",children:((l=s.steps)==null?void 0:l.length)||0}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400",children:new Date(s.created_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(T,{to:`/traces/${s.run_id}`,className:"text-primary-600 hover:text-primary-700",title:"View Trace Detail (O3)",children:e.jsx(z,{size:16})})})]},s.run_id)}),!x.length&&e.jsx("tr",{children:e.jsxs("td",{colSpan:a?7:6,className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(L,{className:"mx-auto mb-2 text-gray-400",size:32}),"No traces found"]})})]})]})})]})]})}export{P as default};

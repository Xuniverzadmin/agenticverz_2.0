import{S as v,b as I,r as i,j as e,aa as T,E as b,G as N}from"./index-KppIquYQ.js";import{C as w}from"./chevron-right-D006Lv8J.js";import{F as E}from"./file-text-kHBdGibj.js";import{F as A}from"./filter-Cws9p7XT.js";import{H as D}from"./hash-BExlLTdf.js";import{R as y}from"./refresh-cw-C5XbiSIu.js";import{S as L}from"./search-CNAZRxZu.js";import{B as M}from"./BetaBanner-DnIHpo0a.js";import{t as O}from"./truncateValue-DZkKoP9l.js";async function P(s){return(await v.get(`/founder/timeline/run/${s}`)).data}async function F(s){return(await v.get("/founder/timeline/decisions",{params:s})).data}async function V(s){return(await v.get("/founder/timeline/count",{params:s})).data}const C=3e4,p=50;function S(s){return new Date(s).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}function q(s){return O(s,{maxChars:200,maxDepth:2})}function U(s){switch(s){case"pre_run":return"PRE-RUN DECLARATION";case"decision":return"DECISION";case"outcome":return"OUTCOME";default:return s.toUpperCase()}}function Y(s){switch(s){case"pre_run":return"border-blue-500/50 bg-blue-950/20";case"decision":return"border-yellow-500/50 bg-yellow-950/20";case"outcome":return"border-green-500/50 bg-green-950/20";default:return"border-gray-500/50 bg-gray-950/20"}}function $(s,n=8){return s?s.length>n?`${s.substring(0,n)}...`:s:"-"}function a({label:s,value:n,mono:t=!1}){const r=n==null?"-":String(n);return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-gray-500 min-w-32 shrink-0",children:[s,":"]}),e.jsx("span",{className:b("text-gray-200 break-all",t&&"font-mono text-xs"),children:r})]})}function h({label:s,data:n}){const[t,r]=i.useState(!1);return!n||typeof n=="object"&&Object.keys(n).length===0?null:e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{onClick:()=>r(!t),className:"flex items-center gap-1 text-gray-500 hover:text-gray-300 text-sm",children:[t?e.jsx(N,{className:"w-4 h-4"}):e.jsx(w,{className:"w-4 h-4"}),s]}),t&&e.jsx("pre",{className:"mt-2 p-3 bg-gray-950 rounded border border-gray-800 text-xs text-gray-300 overflow-x-auto font-mono",children:q(n)})]})}function G({entry:s,index:n}){const t=s.record;return e.jsxs("div",{className:b("border-l-4 p-4 rounded-r",Y(s.entry_type)),children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("span",{className:"text-xs font-mono text-gray-500",children:["#",n+1]}),e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wide",children:U(s.entry_type)}),e.jsx("span",{className:"text-xs font-mono text-gray-500",children:S(s.timestamp)})]}),s.entry_type==="pre_run"&&e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx(a,{label:"run_id",value:t.run_id,mono:!0}),e.jsx(a,{label:"agent_id",value:t.agent_id,mono:!0}),e.jsx(a,{label:"goal",value:t.goal}),e.jsx(a,{label:"max_attempts",value:t.max_attempts}),e.jsx(a,{label:"priority",value:t.priority}),e.jsx(a,{label:"tenant_id",value:t.tenant_id,mono:!0}),e.jsx(a,{label:"idempotency_key",value:t.idempotency_key,mono:!0}),e.jsx(a,{label:"parent_run_id",value:t.parent_run_id,mono:!0}),e.jsx(a,{label:"declared_at",value:t.declared_at})]}),s.entry_type==="decision"&&e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx(a,{label:"decision_id",value:t.decision_id,mono:!0}),e.jsx(a,{label:"decision_type",value:t.decision_type}),e.jsx(a,{label:"decision_source",value:t.decision_source}),e.jsx(a,{label:"decision_trigger",value:t.decision_trigger}),e.jsx(a,{label:"decision_outcome",value:t.decision_outcome}),e.jsx(a,{label:"decision_reason",value:t.decision_reason}),e.jsx(a,{label:"causal_role",value:t.causal_role}),e.jsx(a,{label:"run_id",value:t.run_id,mono:!0}),e.jsx(a,{label:"workflow_id",value:t.workflow_id,mono:!0}),e.jsx(a,{label:"request_id",value:t.request_id,mono:!0}),e.jsx(a,{label:"tenant_id",value:t.tenant_id,mono:!0}),t.decision_type==="routing"&&t.details&&(()=>{const r=t.details;return e.jsxs("div",{className:"mt-3 p-3 bg-blue-950/30 border border-blue-500/30 rounded",children:[e.jsx("div",{className:"text-xs text-blue-400 font-bold uppercase tracking-wide mb-2",children:"ROUTING DETAILS"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a,{label:"Method",value:r.routing_method||r.method}),e.jsx(a,{label:"Agents Considered",value:Array.isArray(r.agents_considered)?r.agents_considered.join(", "):r.agents_considered}),e.jsx(a,{label:"Agents Rejected",value:Array.isArray(r.agents_rejected)?r.agents_rejected.join(", "):r.agents_rejected||"None"})]})]})})(),t.decision_type==="memory"&&t.details&&(()=>{const r=t.details;return e.jsxs("div",{className:"mt-3 p-3 bg-purple-950/30 border border-purple-500/30 rounded",children:[e.jsx("div",{className:"text-xs text-purple-400 font-bold uppercase tracking-wide mb-2",children:"MEMORY DETAILS"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a,{label:"Memory Queried",value:r.memory_queried||r.pins_queried||0}),e.jsx(a,{label:"Memory Injected",value:r.memory_injected!==void 0?r.memory_injected?"Yes":"No":r.pins_injected>0?"Yes":"No"}),r.pins_injected!==void 0&&e.jsx(a,{label:"Pins Injected",value:r.pins_injected})]})]})})(),t.decision_type==="recovery"&&(()=>{const r=t.details||{};return e.jsxs("div",{className:"mt-3 p-3 bg-amber-950/30 border border-amber-500/30 rounded",children:[e.jsx("div",{className:"text-xs text-amber-400 font-bold uppercase tracking-wide mb-2",children:"RECOVERY DETAILS"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a,{label:"Recovery Class",value:r.recovery_class}),e.jsx(a,{label:"Strategy",value:r.strategy}),r.incident_id&&e.jsx("div",{className:"mt-2",children:e.jsx("a",{href:`/founder/incidents?id=${r.incident_id}`,className:"text-amber-400 hover:text-amber-300 underline text-sm",children:"View Recovery Details →"})})]})]})})(),e.jsx(h,{label:"decision_inputs",data:t.decision_inputs}),e.jsx(h,{label:"details",data:t.details})]}),s.entry_type==="outcome"&&e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx(a,{label:"run_id",value:t.run_id,mono:!0}),e.jsx(a,{label:"status",value:t.status}),e.jsx(a,{label:"attempts",value:t.attempts}),e.jsx(a,{label:"error_message",value:t.error_message}),e.jsx(a,{label:"started_at",value:t.started_at}),e.jsx(a,{label:"completed_at",value:t.completed_at}),e.jsx(a,{label:"duration_ms",value:t.duration_ms}),t.pending&&e.jsx("div",{className:"mt-2 text-yellow-500 text-xs",children:"RUN PENDING - OUTCOME NOT FINAL"})]})]})}function B({record:s}){var r,c,o;const[n,t]=i.useState(!1);return e.jsxs("div",{className:"border border-gray-800 rounded bg-gray-900/50 overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-800/50 transition-colors",onClick:()=>t(!n),children:e.jsxs("div",{className:"flex items-center gap-4",children:[n?e.jsx(N,{className:"w-4 h-4 text-gray-500 shrink-0"}):e.jsx(w,{className:"w-4 h-4 text-gray-500 shrink-0"}),e.jsx("span",{className:"text-xs font-mono text-gray-500 min-w-40",children:S(s.decided_at)}),e.jsx("span",{className:"text-xs font-bold text-yellow-400 uppercase min-w-24",children:s.decision_type}),e.jsx("span",{className:"text-sm text-gray-300",children:s.decision_outcome}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:s.causal_role}),e.jsx("span",{className:"text-xs font-mono text-gray-600",children:$(s.run_id)})]})}),n&&e.jsxs("div",{className:"border-t border-gray-800 p-4 bg-gray-950/50 space-y-1 text-sm",children:[e.jsx(a,{label:"decision_id",value:s.decision_id,mono:!0}),e.jsx(a,{label:"decision_type",value:s.decision_type}),e.jsx(a,{label:"decision_source",value:s.decision_source}),e.jsx(a,{label:"decision_trigger",value:s.decision_trigger}),e.jsx(a,{label:"decision_outcome",value:s.decision_outcome}),e.jsx(a,{label:"decision_reason",value:s.decision_reason}),e.jsx(a,{label:"causal_role",value:s.causal_role}),e.jsx(a,{label:"run_id",value:s.run_id,mono:!0}),e.jsx(a,{label:"workflow_id",value:s.workflow_id,mono:!0}),e.jsx(a,{label:"request_id",value:s.request_id,mono:!0}),e.jsx(a,{label:"tenant_id",value:s.tenant_id,mono:!0}),e.jsx(a,{label:"decided_at",value:s.decided_at}),s.decision_type==="routing"&&s.details&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-950/30 border border-blue-500/30 rounded",children:[e.jsx("div",{className:"text-xs text-blue-400 font-bold uppercase tracking-wide mb-2",children:"ROUTING DETAILS"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a,{label:"Method",value:s.details.routing_method||s.details.method}),e.jsx(a,{label:"Agents Considered",value:Array.isArray(s.details.agents_considered)?s.details.agents_considered.join(", "):s.details.agents_considered}),e.jsx(a,{label:"Agents Rejected",value:Array.isArray(s.details.agents_rejected)?s.details.agents_rejected.join(", "):s.details.agents_rejected||"None"})]})]}),s.decision_type==="memory"&&s.details&&e.jsxs("div",{className:"mt-3 p-3 bg-purple-950/30 border border-purple-500/30 rounded",children:[e.jsx("div",{className:"text-xs text-purple-400 font-bold uppercase tracking-wide mb-2",children:"MEMORY DETAILS"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a,{label:"Memory Queried",value:s.details.memory_queried||s.details.pins_queried||0}),e.jsx(a,{label:"Memory Injected",value:s.details.memory_injected!==void 0?s.details.memory_injected?"Yes":"No":s.details.pins_injected>0?"Yes":"No"})]})]}),s.decision_type==="recovery"&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-950/30 border border-amber-500/30 rounded",children:[e.jsx("div",{className:"text-xs text-amber-400 font-bold uppercase tracking-wide mb-2",children:"RECOVERY DETAILS"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a,{label:"Recovery Class",value:(r=s.details)==null?void 0:r.recovery_class}),e.jsx(a,{label:"Strategy",value:(c=s.details)==null?void 0:c.strategy}),((o=s.details)==null?void 0:o.incident_id)&&e.jsx("div",{className:"mt-2",children:e.jsx("a",{href:`/founder/incidents?id=${s.details.incident_id}`,className:"text-amber-400 hover:text-amber-300 underline text-sm",children:"View Recovery Details →"})})]})]}),e.jsx(h,{label:"decision_inputs",data:s.decision_inputs}),e.jsx(h,{label:"details",data:s.details})]})]})}function H({runId:s}){const[n,t]=i.useState(null),[r,c]=i.useState(!0),[o,u]=i.useState(null),x=i.useCallback(async()=>{try{const l=await P(s);t(l),u(null)}catch(l){u(l instanceof Error?l.message:"Failed to fetch timeline")}finally{c(!1)}},[s]);return i.useEffect(()=>{x()},[x]),r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(y,{className:"w-6 h-6 text-gray-500 animate-spin"})}):o?e.jsx("div",{className:"p-4 bg-red-950/30 border border-red-500/50 rounded text-red-400 text-sm",children:o}):!n||n.entries.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx(E,{className:"w-12 h-12 text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No timeline entries for this run"}),e.jsxs("p",{className:"text-gray-600 text-sm mt-2",children:["Run ID: ",s]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-900 rounded border border-gray-800 p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(D,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"font-mono text-white",children:n.run_id}),e.jsxs("span",{className:"text-gray-500 ml-auto",children:[n.entry_count," entries"]})]})}),e.jsx("div",{className:"space-y-2",children:n.entries.map((l,m)=>e.jsx(G,{entry:l,index:m},`${l.entry_type}-${m}`))})]})}function J(){const[s,n]=i.useState([]),[t,r]=i.useState(0),[c,o]=i.useState(!0),[u,x]=i.useState(null),[l,m]=i.useState(0),[g,R]=i.useState(""),j=i.useCallback(async()=>{try{o(!0);const[d,k]=await Promise.all([F({limit:p,offset:l,decision_type:g||void 0}),V({decision_type:g||void 0})]);n(d),r(k.count),x(null)}catch(d){x(d instanceof Error?d.message:"Failed to fetch records")}finally{o(!1)}},[l,g]);i.useEffect(()=>{j()},[j]),i.useEffect(()=>{const d=setInterval(j,C);return()=>clearInterval(d)},[j]);const _=l+p<t,f=l>0;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-900 rounded border border-gray-800 p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{className:"w-4 h-4 text-gray-500"}),e.jsxs("select",{value:g,onChange:d=>{R(d.target.value),m(0)},className:"bg-gray-800 border border-gray-700 rounded px-3 py-1.5 text-sm text-white",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"routing",children:"routing"}),e.jsx("option",{value:"recovery",children:"recovery"}),e.jsx("option",{value:"memory",children:"memory"}),e.jsx("option",{value:"policy",children:"policy"}),e.jsx("option",{value:"budget",children:"budget"}),e.jsx("option",{value:"policy_precheck",children:"policy_precheck"}),e.jsx("option",{value:"budget_enforcement",children:"budget_enforcement"})]}),e.jsxs("span",{className:"text-gray-500 text-sm ml-auto",children:[t," total records"]}),e.jsx("button",{onClick:j,className:"p-1.5 rounded hover:bg-gray-800 text-gray-500 hover:text-white transition-colors",children:e.jsx(y,{className:b("w-4 h-4",c&&"animate-spin")})})]})}),u&&e.jsx("div",{className:"p-4 bg-red-950/30 border border-red-500/50 rounded text-red-400 text-sm",children:u}),c&&s.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(y,{className:"w-6 h-6 text-gray-500 animate-spin"})}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx(E,{className:"w-12 h-12 text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No decision records found"}),e.jsx("p",{className:"text-gray-600 text-sm mt-2",children:"Decision records will appear after production runs with decision emissions"})]}):e.jsx("div",{className:"space-y-2",children:s.map(d=>e.jsx(B,{record:d},d.decision_id))}),t>p&&e.jsxs("div",{className:"flex items-center justify-between bg-gray-900 rounded border border-gray-800 p-4",children:[e.jsx("button",{onClick:()=>m(Math.max(0,l-p)),disabled:!f,className:b("px-3 py-1.5 rounded text-sm",f?"bg-gray-800 text-white hover:bg-gray-700":"bg-gray-900 text-gray-600 cursor-not-allowed"),children:"Previous"}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["Showing ",l+1,"-",Math.min(l+p,t)," of ",t]}),e.jsx("button",{onClick:()=>m(l+p),disabled:!_,className:b("px-3 py-1.5 rounded text-sm",_?"bg-gray-800 text-white hover:bg-gray-700":"bg-gray-900 text-gray-600 cursor-not-allowed"),children:"Next"})]})]})}function ae(){const[s,n]=I(),t=s.get("run"),[r,c]=i.useState(t||""),o=()=>{r.trim()?n({run:r.trim()}):n({})},u=()=>{c(""),n({})};return e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsxs("div",{className:"min-h-screen bg-gray-950",children:[e.jsx("div",{className:"bg-gray-900 border-b border-gray-800 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-blue-500"}),"Founder Decision Timeline"]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Raw, chronological decision records. No interpretation."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"w-4 h-4 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",value:r,onChange:x=>c(x.target.value),onKeyDown:x=>x.key==="Enter"&&o(),placeholder:"Enter run_id...",className:"bg-gray-800 border border-gray-700 rounded pl-9 pr-3 py-1.5 text-sm text-white w-64 focus:outline-none focus:border-blue-500"})]}),e.jsx("button",{onClick:o,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded text-sm text-white transition-colors",children:"View Run"}),t&&e.jsx("button",{onClick:u,className:"px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded text-sm text-white transition-colors",children:"Show All"})]})]})}),e.jsx("div",{className:"p-6 max-w-5xl mx-auto",children:t?e.jsx(H,{runId:t}):e.jsx(J,{})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 px-6 py-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Phase 5E-1: Read-only, verbatim display"}),e.jsxs("span",{children:["Polling every ",C/1e3,"s"]})]})})]})]})}export{ae as default};

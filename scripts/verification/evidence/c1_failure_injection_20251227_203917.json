[
  {
    "name": "check-constraint",
    "passed": true,
    "expected": "chk_never_authoritative constraint enforces authoritative=FALSE",
    "actual": "Constraint exists: ((authoritative = false))",
    "query": "\n        SELECT constraint_name, check_clause\n        FROM information_schema.check_constraints\n        WHERE constraint_name = 'chk_never_authoritative'\n        ",
    "duration_ms": 58.41541290283203,
    "error": null
  },
  {
    "name": "no-fk-constraints",
    "passed": true,
    "expected": "0 foreign key constraints on telemetry_event",
    "actual": "0 foreign key constraints (isolation maintained)",
    "query": "\n        SELECT COUNT(*)\n        FROM information_schema.table_constraints\n        WHERE table_name = 'telemetry_event'\n          AND constraint_type = 'FOREIGN KEY'\n        ",
    "duration_ms": 45.487403869628906,
    "error": null
  },
  {
    "name": "non-authoritative-constraint",
    "passed": true,
    "expected": "0 rows with authoritative=TRUE",
    "actual": "0 authoritative telemetry rows (constraint holds)",
    "query": "\n        SELECT COUNT(*) FROM telemetry_event WHERE authoritative = TRUE\n        ",
    "duration_ms": 41.24617576599121,
    "error": null
  },
  {
    "name": "replay-isolation",
    "passed": true,
    "expected": "0 telemetry rows from replay engine",
    "actual": "0 replay-sourced telemetry rows (isolation holds)",
    "query": "\n        SELECT COUNT(*) FROM telemetry_event\n        WHERE signal_payload->>'is_replay' = 'true'\n           OR signal_payload->>'source' = 'replay'\n           OR source_module = 'replay'\n        ",
    "duration_ms": 26.724576950073242,
    "error": null
  },
  {
    "name": "ttl-enforcement",
    "passed": true,
    "expected": "0 or minimal expired telemetry rows",
    "actual": "0 expired telemetry rows (TTL enforced)",
    "query": "\n        SELECT\n            COUNT(*) AS expired_count,\n            MIN(expires_at_utc) AS oldest_expired\n        FROM telemetry_event\n        WHERE expires_at_utc < NOW()\n        ",
    "duration_ms": 39.1690731048584,
    "error": null
  },
  {
    "name": "truth-independence",
    "passed": true,
    "expected": "Incidents exist independently of telemetry",
    "actual": "Incidents independent: 1 total, 0 have telemetry",
    "query": "\n        SELECT\n            (SELECT COUNT(*) FROM costsim_cb_incidents) AS total_incidents,\n            (SELECT COUNT(DISTINCT incident_id) FROM telemetry_event WHERE incident_id IS NOT NULL) AS incid...",
    "duration_ms": 39.88218307495117,
    "error": null
  },
  {
    "name": "write-order",
    "passed": true,
    "expected": "0 telemetry rows written before their corresponding trace",
    "actual": "0 telemetry rows precede their trace (order correct)",
    "query": "\n        SELECT COUNT(*) FROM telemetry_event te\n        JOIN runs r ON te.trace_id = r.id::uuid\n        WHERE te.created_at_utc < r.created_at\n        ",
    "duration_ms": 40.775299072265625,
    "error": null
  },
  {
    "name": "telemetry-write-failure-safe",
    "passed": true,
    "expected": "0 incidents caused by telemetry failures",
    "actual": "Safe: 106 runs, 0 have telemetry, 0 telemetry incidents",
    "query": "\n        WITH execution_stats AS (\n            SELECT\n                (SELECT COUNT(*) FROM runs) AS total_runs,\n                (SELECT COUNT(DISTINCT trace_id) FROM telemetry_event WHERE trace_id IS...",
    "duration_ms": 36.092281341552734,
    "error": null
  },
  {
    "name": "replay-does-not-read-telemetry",
    "passed": true,
    "expected": "0 telemetry rows consumed or hinted for replay",
    "actual": "0 replay consumption/hint indicators (read isolation holds)",
    "query": "\n        SELECT\n            COUNT(*) FILTER (\n                WHERE signal_payload->>'consumed_by' = 'replay'\n                   OR signal_payload->>'read_by' = 'replay'\n                   OR signal_t...",
    "duration_ms": 21.770238876342773,
    "error": null
  },
  {
    "name": "truth-tables-independent",
    "passed": true,
    "expected": "Truth tables have no dependencies on telemetry_event",
    "actual": "Truth tables accessible (runs=106, incidents=1), 0 telemetry dependencies",
    "query": "\n        SELECT\n            (SELECT COUNT(*) FROM runs LIMIT 1) AS runs_accessible,\n            (SELECT COUNT(*) FROM costsim_cb_incidents LIMIT 1) AS incidents_accessible,\n            (SELECT COUNT(*...",
    "duration_ms": 35.78901290893555,
    "error": null
  },
  {
    "name": "o1-independence",
    "passed": true,
    "expected": "Endpoint responds (200/401/403)",
    "actual": "HTTP 403 (auth required - endpoint responsive, telemetry independent)",
    "query": "GET /guard/incidents",
    "duration_ms": 113.46650123596191,
    "error": null
  },
  {
    "name": "graceful-degradation",
    "passed": true,
    "expected": "Graceful response",
    "actual": "404 - endpoint not implemented yet (OK for new system)",
    "query": "GET /api/v1/metrics/observability",
    "duration_ms": 12.715816497802734,
    "error": null
  },
  {
    "name": "o1-survives-telemetry-outage",
    "passed": true,
    "expected": "All O1 endpoints return 200 during telemetry outage",
    "actual": "Endpoints: incidents:AUTH, status:AUTH, traces:AUTH",
    "query": "GET multiple O1 endpoints (X-Simulate-Telemetry-Outage: true)",
    "duration_ms": 34.64317321777344,
    "error": null
  },
  {
    "name": "telemetry-failure-no-incident",
    "passed": true,
    "expected": "Endpoint responds or SQL probe covers",
    "actual": "HTTP 403 (auth required - SQL probe verifies invariant)",
    "query": "GET /guard/incidents/search?trigger_type=telemetry_failure",
    "duration_ms": 7.746696472167969,
    "error": null
  }
]

# .env.example - AOS / Agenticverz 2.0 Configuration
# Copy to .env and configure
#
# IMPORTANT: Secrets are now managed in HashiCorp Vault
# See: scripts/ops/vault/README.md

# ===========================================
# Vault Configuration (Required for secrets)
# ===========================================
VAULT_ADDR=http://127.0.0.1:8200
# VAULT_TOKEN loaded from /opt/vault/.vault-keys at runtime

# ===========================================
# Core Settings
# ===========================================
ENV=development
PORT=8000
HOST=0.0.0.0

# ===========================================
# Database
# ===========================================
# Password managed in Vault: agenticverz/database
DATABASE_URL=postgresql://nova:VAULT_MANAGED@localhost:6432/nova_aos

# ===========================================
# Redis
# ===========================================
REDIS_URL=redis://localhost:6379/0

# ===========================================
# OIDC / Keycloak
# ===========================================
OIDC_ISSUER_URL=https://auth-dev.xuniverz.com/realms/agentiverz-dev
OIDC_CLIENT_ID=aos-backend
# OIDC_CLIENT_SECRET in Vault: agenticverz/app-prod
OIDC_VERIFY_SSL=true

# ===========================================
# RBAC
# ===========================================
RBAC_ENABLED=true
RBAC_ENFORCE=true
# MACHINE_SECRET_TOKEN in Vault: agenticverz/app-prod

# ===========================================
# LLM Providers (M11)
# ===========================================
PLANNER_BACKEND=anthropic
# Options: anthropic, openai, stub
# ANTHROPIC_API_KEY in Vault: agenticverz/external-apis
# OPENAI_API_KEY in Vault: agenticverz/external-apis (if using OpenAI)

# LLM Adapter Selection
LLM_ADAPTER=claude
# Options: claude, openai, stub
# - claude: Anthropic Claude (default, highest quality)
# - openai: OpenAI GPT-4o/mini (cost-effective fallback)
# - stub: Deterministic testing mode

# OpenAI specific (optional)
OPENAI_DEFAULT_MODEL=gpt-4o-mini

# ===========================================
# API Authentication
# ===========================================
# AOS_API_KEY in Vault: agenticverz/app-prod

# ===========================================
# Webhook
# ===========================================
WEBHOOK_KEY_VERSION=v1
# WEBHOOK_KEY in Vault: agenticverz/app-prod (if needed)

# ===========================================
# Multi-Tenancy
# ===========================================
TENANT_HEADER=X-Tenant-Id
ENFORCE_TENANCY=false

# ===========================================
# Worker Configuration
# ===========================================
WORKER_CONCURRENCY=4
WORKER_POLL_INTERVAL=2.0
RUN_MAX_ATTEMPTS=5
EVENT_PUBLISHER=logging

# ===========================================
# GitHub Integration (Mismatch Issue Automation)
# ===========================================
# GITHUB_TOKEN in Vault: agenticverz/external-apis
GITHUB_REPO=Xuniverzadmin/agenticverz_2.0

# ===========================================
# Secrets Inventory (in Vault)
# ===========================================
# Path: agenticverz/app-prod
#   - AOS_API_KEY
#   - MACHINE_SECRET_TOKEN
#   - OIDC_CLIENT_SECRET
#
# Path: agenticverz/database
#   - POSTGRES_USER, POSTGRES_PASSWORD
#   - DATABASE_URL (full connection string)
#   - KEYCLOAK_DB_USER, KEYCLOAK_DB_PASSWORD
#
# Path: agenticverz/external-apis
#   - ANTHROPIC_API_KEY
#   - GITHUB_TOKEN
#
# Path: agenticverz/keycloak-admin
#   - KEYCLOAK_ADMIN, KEYCLOAK_ADMIN_PASSWORD
#
# To load secrets: source scripts/ops/vault/vault_env.sh app-prod

# ===========================================
# Cloudflare R2 Object Storage (M9 Aggregation)
# ===========================================
# Core R2 credentials in Vault: agenticverz/r2-storage
#   - R2_ACCESS_KEY_ID
#   - R2_SECRET_ACCESS_KEY
#   - R2_ACCOUNT_ID
#   - R2_BUCKET
#   - R2_ENDPOINT
# Application config (non-sensitive):
R2_UPLOAD_PREFIX=failure_patterns
R2_RETENTION_DAYS=90
AGG_LOCAL_FALLBACK=/opt/agenticverz/state/fallback-uploads

# ===========================================
# Store Configuration (M11)
# ===========================================
# Budget Store - for multi-worker budget enforcement
BUDGET_STORE=redis
# Options: redis, memory (auto-detects from REDIS_URL if not set)

# Checkpoint Store - for workflow persistence
CHECKPOINT_STORE=postgres
# Options: postgres, memory (auto-detects from DATABASE_URL if not set)

# Checkpoint Offload to R2
CHECKPOINT_RETENTION_DAYS=7
CHECKPOINT_OFFLOAD_OLDER_THAN_DAYS=3
CHECKPOINT_OFFLOAD_BATCH_SIZE=100

# ===========================================
# Upstash Redis (Alternative to self-hosted)
# ===========================================
# For production, use Upstash managed Redis
# REDIS_URL in Vault: agenticverz/upstash
# Format: rediss://:token@xxxxx.upstash.io:6379

# ===========================================
# Neon PostgreSQL (Alternative to self-hosted)
# ===========================================
# For production, use Neon managed PostgreSQL
# DATABASE_URL in Vault: agenticverz/neon
# Format: postgresql://user:pw@ep-xxx.region.aws.neon.tech/dbname

# ===========================================
# Vault Secret Paths (M11 Summary)
# ===========================================
# Path: secret/data/user/anthropic
#   - ANTHROPIC_API_KEY
#
# Path: secret/data/user/openai
#   - OPENAI_API_KEY
#
# Path: secret/data/user/neon
#   - DATABASE_URL
#
# Path: secret/data/user/upstash
#   - REDIS_URL
#
# Path: secret/data/user/r2
#   - R2_ENDPOINT
#   - R2_BUCKET
#   - R2_ACCESS_KEY_ID
#   - R2_SECRET_ACCESS_KEY

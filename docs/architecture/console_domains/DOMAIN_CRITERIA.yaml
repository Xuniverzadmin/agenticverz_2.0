# Domain Classification Criteria
# Status: LOCKED
# Created: 2026-01-26
# Updated: 2026-01-26 (V3 Manual Audit lessons learned)
# Purpose: Machine-readable rules for domain_classifier_v1.py
#
# INVARIANT: Keywords alone have ZERO classificatory power.
# Only qualified phrases determine domain ownership.
#
# V3 AUDIT FINDINGS INCORPORATED:
# - controls: Strengthened qualifiers (21 files were misclassified away)
# - general: Added cross-domain/lifecycle/scheduler patterns (31 files missed)
# - logs: Added verdict/certificate/compliance patterns (17 files missed)
# - integrations: Added veto_phrases (only 21% confirmation rate)
# - policies: Added veto_phrases to prevent overloading (31 files misplaced here)
# - account: Added identity resolution pattern

version: "1.1"

# Keywords that CANNOT determine domain alone
ambiguous_keywords:
  - enforcement
  - runtime
  - threshold
  - governance
  - policy
  - aggregat
  - config
  - limit

# Scoring rules
scoring:
  qualifier_phrase_weight: 3
  weak_keyword_weight: 1
  weak_keyword_max: 2
  ambiguous_margin_threshold: 3  # If margin < 3, mark AMBIGUOUS

domains:
  general:
    exclusive_decision: "WHEN and HOW system actions execute"
    qualifier_test: "Enforcement of system invariants, for system orchestration"

    qualifier_phrases:
      # Core orchestration patterns
      - "governance orchestrat"
      - "runtime orchestrat"
      - "execution coordinator"
      - "gateway control"
      - "retry logic"
      - "governance enforcement"
      - "runtime enforcement"
      - "contract activation"
      - "job state"
      - "system-wide"
      - "workflow orchestrat"
      - "execution order"
      - "L4_runtime"
      - "orchestrator"
      - "coordinator"
      # V3 AUDIT: Cross-domain patterns (31 files missed)
      - "cross-domain"
      - "cross domain"
      - "lifecycle state"
      - "lifecycle facade"
      - "lifecycle stage"
      - "job scheduler"
      - "scheduler facade"
      - "constraint check"
      - "mediator"
      - "retrieval mediator"
      - "determinism"
      - "panel invariant"
      - "panel verification"
      - "durability"
      - "RAC"
      - "alert emit"

    veto_phrases:
      - "policy enforcement"
      - "limit enforcement"
      - "threshold violation"
      - "customer rule"
      - "tenant config"
      - "incident classif"
      - "run lifecycle"

    weak_keywords:
      - "orchestrat"
      - "gateway"
      - "facade"

  policies:
    exclusive_decision: "WHAT rules govern behavior"
    qualifier_test: "Enforcement of customer-defined rules"

    qualifier_phrases:
      - "policy definition"
      - "policy evaluation"
      - "policy proposal"
      - "policy enforcement"
      - "rule engine"
      - "lesson learned"
      - "customer rule"
      - "governance rule"
      - "policy rule"
      - "rule activation"
      - "policy version"
      - "policy status"
      # V3 AUDIT: Recovery/failure rules are policies
      - "recovery rule"
      - "failure mode"

    veto_phrases:
      - "runtime orchestrat"
      - "gateway control"
      - "system invariant"
      - "execution coordinator"
      # V3 AUDIT: Prevent controls items from landing here (31 misplaced)
      - "killswitch"
      - "circuit breaker"
      - "budget enforcement"
      - "limit driver"
      - "limit read"
      - "limit write"
      - "rate limit"
      - "token limit"
      - "cost limit"
      - "throttle"
      # V3 AUDIT: Prevent general items from landing here
      - "execution order"
      - "dag executor"
      - "cross-domain"
      - "scheduler"
      - "governance signal"
      # V3 AUDIT: Prevent logs items from landing here
      - "evidence record"
      - "audit trail"
      - "certificate"
      - "proof"
      - "SOC2"
      # V3 AUDIT: Prevent apis items from landing here
      - "api key"
      - "key management"

    weak_keywords:
      - "policy"
      - "rule"
      - "proposal"

  controls:
    exclusive_decision: "WHAT limits and configurations apply"
    qualifier_test: "Customer-configured limits and thresholds"

    qualifier_phrases:
      # Core controls patterns
      - "killswitch"
      - "circuit breaker"
      - "feature flag"
      - "rate limit"
      - "token limit"
      - "cost limit"
      - "credit limit"
      - "quota"
      - "threshold config"
      - "limit enforcement"
      - "control config"
      - "throttle"
      - "budget"
      - "usage limit"
      # V3 AUDIT: Strengthened qualifiers (21 files missed)
      - "limit driver"
      - "limits driver"
      - "limit read"
      - "limit write"
      - "budget enforcement"
      - "concurrency limit"
      - "alert rule"
      - "alert threshold"
      - "cost safety"
      - "safety rail"
      - "override"
      - "limit override"
      - "execution scope"
      - "scoped execution"
      - "alert fatigue"
      - "controls facade"

    veto_phrases:
      - "threshold violation"
      - "near-threshold incident"
      - "runtime orchestrat"
      - "policy evaluation"
      # V3 AUDIT: Prevent incidents items
      - "incident classif"
      - "failure classif"

    weak_keywords:
      - "limit"
      - "control"
      - "config"
      - "budget"

  incidents:
    exclusive_decision: "WHETHER an outcome is a problem"
    qualifier_test: "Classification of failures and violations"

    qualifier_phrases:
      - "incident classif"
      - "failure classif"
      - "threshold violation"
      - "near-threshold"
      - "violation detect"
      - "recovery signal"
      - "incident pattern"
      - "problem classif"
      - "incident engine"
      - "failure detect"
      - "severity"
      - "incident"
      - "guard"
      - "recurrence"

    veto_phrases:
      - "threshold config"
      - "policy definition"
      - "limit config"

    weak_keywords:
      - "incident"
      - "failure"
      - "violation"

  activity:
    exclusive_decision: "WHAT LLM run occurred"
    qualifier_test: "Run lifecycle and execution metadata"

    qualifier_phrases:
      # Core activity patterns
      - "run lifecycle"
      - "execution metadata"
      - "run state"
      - "llm run"
      - "worker run"
      - "run history"
      - "trace step"
      - "run pattern"
      - "activity pattern"
      - "run"
      - "trace"
      - "execution record"
      # V3 AUDIT: Telemetry and orphan patterns
      - "telemetry"
      - "orphan recovery"
      - "orphan run"

    veto_phrases:
      - "runtime orchestrat"
      - "policy evaluation"
      - "governance enforcement"
      # V3 AUDIT: Prevent controls items
      - "threshold"
      - "limit"

    weak_keywords:
      - "run"
      - "trace"
      - "activity"

  analytics:
    exclusive_decision: "WHAT can be derived"
    qualifier_test: "Derived metrics, not source-of-truth"

    qualifier_phrases:
      # Core analytics patterns
      - "cost intelligence"
      - "statistical"
      - "behavioral analysis"
      - "derived metric"
      - "divergence"
      - "aggregate metric"
      - "kl divergence"
      - "cost analysis"
      - "metric engine"
      - "analytics"
      - "cost sim"
      - "computation"
      # V3 AUDIT: Detection/anomaly patterns
      - "anomaly detect"
      - "detection facade"
      - "pattern detect"
      - "cost snapshot"
      - "prediction"
      - "forecast"

    veto_phrases:
      - "dashboard"
      - "summary view"
      - "source-of-truth"
      - "audit"
      # V3 AUDIT: Prevent controls items
      - "circuit breaker"
      - "killswitch"
      - "rate limit"

    weak_keywords:
      - "metric"
      - "cost"
      - "analytic"
      - "detect"

  overview:
    exclusive_decision: "WHAT consolidated state is visible"
    qualifier_test: "Read-only summaries for display"

    qualifier_phrases:
      - "dashboard"
      - "summary view"
      - "consolidated state"
      - "read-only aggregat"
      - "status overview"
      - "health summary"
      - "overview"
      - "snapshot"
      - "summary"

    veto_phrases:
      - "write"
      - "mutate"
      - "trigger action"
      - "enforcement"

    weak_keywords:
      - "overview"
      - "summary"
      - "dashboard"

  logs:
    exclusive_decision: "WHAT immutable record exists"
    qualifier_test: "Append-only audit trail"

    qualifier_phrases:
      # Core logs patterns
      - "audit ledger"
      - "audit trail"
      - "append-only"
      - "immutable record"
      - "evidence record"
      - "system log"
      - "evidence report"
      - "proof"
      - "audit"
      - "log record"
      - "completeness"
      # V3 AUDIT: Verdict/certificate/compliance patterns (17 files missed)
      - "verdict"
      - "certificate"
      - "SOC2"
      - "compliance"
      - "control registry"
      - "capture"
      - "evidence capture"
      - "pdf render"
      - "mapper"
      - "audit engine"
      - "evidence engine"
      - "bridges driver"

    veto_phrases:
      - "classif"
      - "aggregat"
      - "mutation"
      - "incident pattern"
      # V3 AUDIT: Prevent controls items
      - "alert rule"
      - "alert threshold"
      - "rate limit"

    weak_keywords:
      - "log"
      - "audit"
      - "evidence"
      - "proof"

  integrations:
    exclusive_decision: "HOW external systems connect"
    qualifier_test: "External adapters and bridges"

    qualifier_phrases:
      # Core integrations patterns
      - "sdk setup"
      - "external adapter"
      - "data bridge"
      - "webhook"
      - "external auth"
      - "integration config"
      - "connector"
      - "integration"
      - "external"
      - "graduation"
      # V3 AUDIT: Specific external service patterns
      - "Slack"
      - "PagerDuty"
      - "Teams"
      - "notification channel"
      - "delivery channel"
      - "monitors facade"
      - "datasource"
      - "data source"
      - "worker registry"

    veto_phrases:
      - "policy decision"
      - "runtime orchestrat"
      - "incident"
      - "run lifecycle"
      # V3 AUDIT: Prevent catch-all misuse (only 21% confirmation)
      - "killswitch"
      - "policy evaluation"
      - "cost limit"
      - "cost safety"
      - "identity resolv"
      - "lesson learned"
      - "cost snapshot"
      - "telemetry"
      - "knowledge plane"
      - "audit trail"
      - "evidence"
      - "budget"

    weak_keywords:
      - "integration"
      - "webhook"
      # V3 AUDIT: Removed "adapter" - too generic, causes false positives

  apis:
    exclusive_decision: "WHO can call what"
    qualifier_test: "API key and scope management"

    qualifier_phrases:
      - "api key"
      - "access scope"
      - "api permission"
      - "key management"
      - "scope definition"
      - "api access"
      - "key"
      - "scope"

    veto_phrases:
      - "business logic"
      - "policy evaluation"
      - "tenant"
      - "membership"

    weak_keywords:
      - "key"
      - "api"
      - "scope"

  account:
    exclusive_decision: "WHO owns what"
    qualifier_test: "Tenancy and ownership"

    qualifier_phrases:
      # Core account patterns
      - "tenant"
      - "subscription"
      - "user role"
      - "membership"
      - "billing"
      - "sub-tenant"
      - "organization"
      - "account"
      - "owner"
      # V3 AUDIT: Identity resolution (user correction)
      - "identity resolv"
      - "identity resolver"
      - "actor identity"
      - "who is"
      - "billing provider"

    veto_phrases:
      - "runtime"
      - "analytic"
      - "policy rule"
      - "incident"
      # V3 AUDIT: Prevent integrations items
      - "webhook"
      - "connector"
      - "external"

    weak_keywords:
      - "tenant"
      - "account"
      - "member"
      - "identity"

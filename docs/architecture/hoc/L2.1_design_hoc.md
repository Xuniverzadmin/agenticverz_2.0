# L2.1 Design — HOC Facades (CUS Surface Map)

**Date:** 2026-02-07  
**Status:** DRAFT (design + implementation notes)  
**Scope:** `backend/app/hoc/api/facades/**`

---

## What L2.1 Is (In This Codebase)

L2.1 is an **import-time surface map** that bundles L2 routers by **canonical customer domain** so that:
- the entrypoint does not “list routers” (triage + maintainability)
- the system has a stable place to answer: “what is the domain surface?”

L2.1 is not request-time logic and does not affect runtime routing by itself.

---

## What L2.1 Is Not

- Not an auth layer
- Not a security control
- Not a place to hide endpoints (veil controls must be runtime policy)
- Not hoc_spine

---

## Binding Contract (First Principles)

Per `docs/architecture/topology/HOC_LAYER_TOPOLOGY_V2.0.0.md`:

**Location:** `backend/app/hoc/api/facades/cus/{domain}.py`

**L2.1 MUST**
- Import L2 routers only: `backend/app/hoc/api/**`
- Export a deterministic `ROUTERS` list
- Keep a stable domain identifier

**L2.1 MUST NOT**
- Import hoc_spine (`backend/app/hoc/cus/hoc_spine/**`)
- Import L5 engines / L6 drivers / DB (`sqlalchemy`, `app.db`, etc.)
- Define FastAPI routes

---

## Canonical CUS Domains (Non-Optional)

These 10 must exist as L2.1 facade modules, even if temporarily thin:

- `overview`
- `activity`
- `incidents`
- `policies`
- `controls`
- `logs`
- `analytics`
- `integrations`
- `api_keys`
- `account`

---

## Filesystem Layout

```
backend/app/hoc/api/facades/
  __init__.py
  cus/
    __init__.py
    overview.py
    activity.py
    incidents.py
    policies.py
    controls.py
    logs.py
    analytics.py
    integrations.py
    api_keys.py
    account.py
  fdr/
    __init__.py
    account.py
    agent.py
    incidents.py
    logs.py
    ops.py
  int/
    __init__.py
    general.py
    agent.py
    ops.py
    recovery.py
```

Notes:
- `int/*` exists to keep non-domain/internal surfaces explicit (health, legacy 410, debug, internal agent surfaces, etc.).
- `fdr/*` bundles founder surfaces.

---

## Implementation Pattern (Recommended)

Each facade module exports:
- `DOMAIN: str`
- `ROUTERS: list[APIRouter]`

Example:

```python
DOMAIN = "activity"
ROUTERS = [activity_router]
```

No side effects besides imports.

---

## Triage / Debugging Benefit

With L2.1 in place, the system can:
- list all routers in a domain deterministically
- validate that each canonical domain exists as a file (filesystem invariant)
- build tooling (later) to map incoming request paths to domain groups

---

## Acceptance (Mechanical)

These checks must hold:

1. All 10 canonical domain facade files exist.
2. Each facade imports only from `backend/app/hoc/api/**`.
3. `backend/app/main.py` no longer imports 76 routers directly.

The runtime gates are still the authoritative proof:

```bash
cd backend
PYTHONPATH=. python3 scripts/ci/check_init_hygiene.py --ci
PYTHONPATH=. python3 scripts/ci/check_layer_boundaries.py
PYTHONPATH=. python3 scripts/ops/hoc_cross_domain_validator.py
```

{
  "meta": {
    "files_analyzed": 717,
    "signal_counts": {
      "L2_API": 814,
      "L6_SCHEMA": 784,
      "L4_ENGINE_GOOD": 77,
      "L6_DRIVER": 1242,
      "L3_ADAPTER": 75,
      "L4_ENGINE": 104,
      "L5_WORKER": 48,
      "TEMPORAL_LEAK": 34,
      "RETRY_PATTERN": 2
    },
    "domain_filter": null,
    "file_filter": null
  },
  "files": [
    {
      "file": "backend/app/houseofcards/founder/platform/engines/ops_domain_models.py",
      "relative_path": "app/houseofcards/founder/platform/engines/ops_domain_models.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Ops domain models for operator intelligence views",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "OpsSeverity",
        "OpsIncidentCategory",
        "OpsHealthStatus",
        "OpsRiskLevel",
        "OpsIncident",
        "OpsHealthSignal",
        "OpsRiskFinding",
        "OpsTrendMetric",
        "OpsDecisionOutcome",
        "OpsCorrelatedEvent"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/ops/drivers/error_store.py",
      "relative_path": "app/houseofcards/founder/ops/drivers/error_store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "ErrorStoreProtocol implementation for OpsIncidentService",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import os",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from sqlalchemy import create_engine",
        "from sqlmodel import Session",
        "from app.infra import error_store as infra_store"
      ],
      "classes": [
        "DatabaseErrorStore"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/ops/drivers/event_emitter.py",
      "relative_path": "app/houseofcards/founder/ops/drivers/event_emitter.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json as json_lib",
        "import logging",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from sqlmodel import Session"
      ],
      "classes": [
        "EventType",
        "EntityType",
        "OpsEvent",
        "EventEmitterError",
        "EventEmitter"
      ],
      "functions": [
        "utc_now",
        "get_event_emitter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/ops/drivers/ops_write_service.py",
      "relative_path": "app/houseofcards/founder/ops/drivers/ops_write_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for Ops API (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from sqlalchemy import text",
        "from sqlmodel import Session"
      ],
      "classes": [
        "OpsWriteService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/ops/facades/founder_review_adapter.py",
      "relative_path": "app/houseofcards/founder/ops/facades/founder_review_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Translate Contract domain models to Founder Review views",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Any, List, Optional",
        "from app.services.governance.contract_service import ContractState"
      ],
      "classes": [
        "FounderContractSummaryView",
        "FounderContractDetailView",
        "FounderReviewQueueResponse",
        "FounderReviewDecision",
        "FounderReviewResult",
        "FounderReviewAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/ops/facades/ops_facade.py",
      "relative_path": "app/houseofcards/founder/ops/facades/ops_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Ops Domain Facade - Centralized access to ops operations",
        "raw_layer_line": "# Layer: L3 \u2014 Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "OpsFacade"
      ],
      "functions": [
        "get_ops_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/ops/engines/founder_action_write_service.py",
      "relative_path": "app/houseofcards/founder/ops/engines/founder_action_write_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for Founder Actions API (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import Optional",
        "from sqlalchemy import text",
        "from sqlmodel import Session",
        "from app.models.tenant import FounderAction"
      ],
      "classes": [
        "FounderActionWriteService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/ops/engines/founder_review.py",
      "relative_path": "app/houseofcards/founder/ops/engines/founder_review.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Founder Review API - contract approval/rejection gate",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "from fastapi import APIRouter, Depends, HTTPException",
        "from pydantic import BaseModel, Field",
        "from app.adapters.founder_review_adapter import (",
        "from app.models.contract import (",
        "from app.services.governance.contract_service import ("
      ],
      "classes": [
        "ReviewDecisionRequest"
      ],
      "functions": [
        "get_contract_service",
        "get_adapter",
        "get_contract_by_id",
        "save_contract",
        "get_eligible_contracts",
        "get_review_queue",
        "get_contract_detail",
        "submit_review",
        "_dataclass_to_dict",
        "_inject_test_contract",
        "_clear_test_contracts",
        "_get_all_test_contracts"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/ops/engines/ops_incident_service.py",
      "relative_path": "app/houseofcards/founder/ops/engines/ops_incident_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Translate infra errors into operator-facing incidents",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Protocol",
        "from app.services.ops_domain_models import ("
      ],
      "classes": [
        "ErrorStoreProtocol",
        "IncidentAggregationConfig",
        "OpsIncidentService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/ops/schemas/ops_domain_models.py",
      "relative_path": "app/houseofcards/founder/ops/schemas/ops_domain_models.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Ops domain models for operator intelligence views",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "OpsSeverity",
        "OpsIncidentCategory",
        "OpsHealthStatus",
        "OpsRiskLevel",
        "OpsIncident",
        "OpsHealthSignal",
        "OpsRiskFinding",
        "OpsTrendMetric",
        "OpsDecisionOutcome",
        "OpsCorrelatedEvent"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/agent/drivers/founder_action_write_service.py",
      "relative_path": "app/houseofcards/founder/agent/drivers/founder_action_write_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for Founder Actions API (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import Optional",
        "from sqlalchemy import text",
        "from sqlmodel import Session",
        "from app.models.tenant import FounderAction"
      ],
      "classes": [
        "FounderActionWriteService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/agent/drivers/ops_write_service.py",
      "relative_path": "app/houseofcards/founder/agent/drivers/ops_write_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for Ops API (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from sqlalchemy import text",
        "from sqlmodel import Session"
      ],
      "classes": [
        "OpsWriteService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/founder/incidents/engines/ops_incident_service.py",
      "relative_path": "app/houseofcards/founder/incidents/engines/ops_incident_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Translate infra errors into operator-facing incidents",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Protocol",
        "from app.services.ops_domain_models import ("
      ],
      "classes": [
        "ErrorStoreProtocol",
        "IncidentAggregationConfig",
        "OpsIncidentService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/infrastructure/tenant.py",
      "relative_path": "app/houseofcards/api/infrastructure/tenant.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Tenant isolation enforcement middleware",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import uuid",
        "from contextvars import ContextVar",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, Optional",
        "from fastapi import HTTPException, Request",
        "from starlette.middleware.base import BaseHTTPMiddleware"
      ],
      "classes": [
        "TenantContext",
        "TenantMiddleware"
      ],
      "functions": [
        "get_tenant_context",
        "set_tenant_context",
        "clear_tenant_context",
        "require_tenant_context",
        "get_tenant_id",
        "tenant_scoped_query",
        "ensure_tenant_access",
        "require_tenant"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/infrastructure/rate_limit.py",
      "relative_path": "app/houseofcards/api/infrastructure/rate_limit.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Rate limiting middleware",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from typing import Optional",
        "from fastapi import HTTPException, Request",
        "from app.utils.metrics_helpers import get_or_create_counter, get_or_create_gauge"
      ],
      "classes": [
        "RateLimitMiddleware"
      ],
      "functions": [
        "get_redis",
        "get_tier_limits",
        "extract_tier_from_user",
        "check_rate_limit",
        "rate_limit_dependency"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/infrastructure/slow_requests.py",
      "relative_path": "app/houseofcards/api/infrastructure/slow_requests.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Diagnostic middleware for slow request detection",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs (Middleware)"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import time",
        "from starlette.middleware.base import BaseHTTPMiddleware",
        "from starlette.requests import Request"
      ],
      "classes": [
        "SlowRequestMiddleware"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/infrastructure/tenancy.py",
      "relative_path": "app/houseofcards/api/infrastructure/tenancy.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Tenant context injection middleware",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Callable",
        "from fastapi import HTTPException, Request",
        "from starlette.middleware.base import BaseHTTPMiddleware"
      ],
      "classes": [
        "TenancyMiddleware"
      ],
      "functions": [
        "_get_tenant_bypass_paths",
        "get_tenant_id"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/founder/ops/founder_actions.py",
      "relative_path": "app/houseofcards/api/founder/ops/founder_actions.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from fastapi import APIRouter, Depends, HTTPException",
        "from sqlalchemy import text",
        "from sqlmodel import Session",
        "from app.auth.console_auth import FounderToken, verify_fops_token",
        "from app.contracts.ops import (",
        "from app.db import get_session",
        "from app.services.founder_action_write_service import FounderActionWriteService"
      ],
      "classes": [],
      "functions": [
        "check_rate_limit",
        "check_duplicate_action",
        "check_mutual_exclusion",
        "get_target_name",
        "validate_target_exists",
        "apply_action_effect",
        "execute_action",
        "freeze_tenant",
        "throttle_tenant",
        "freeze_api_key",
        "override_incident",
        "execute_reversal",
        "unfreeze_tenant",
        "unthrottle_tenant",
        "unfreeze_api_key",
        "get_audit_trail",
        "get_audit_record"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/founder/agent/founder_contract_review.py",
      "relative_path": "app/houseofcards/api/founder/agent/founder_contract_review.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "INTERNAL",
        "role": "Founder Review API - contract approval/rejection gate",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "from fastapi import APIRouter, Depends, HTTPException",
        "from pydantic import BaseModel, Field",
        "from app.adapters.founder_contract_review_adapter import (",
        "from app.auth.console_auth import FounderToken, verify_fops_token",
        "from app.models.contract import (",
        "from app.services.governance.contract_service import ("
      ],
      "classes": [
        "ReviewDecisionRequest"
      ],
      "functions": [
        "get_contract_service",
        "get_adapter",
        "get_contract_by_id",
        "save_contract",
        "get_eligible_contracts",
        "get_review_queue",
        "get_contract_detail",
        "submit_review",
        "_dataclass_to_dict",
        "_inject_test_contract",
        "_clear_test_contracts",
        "_get_all_test_contracts"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/founder/account/founder_explorer.py",
      "relative_path": "app/houseofcards/api/founder/account/founder_explorer.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "H3 Founder Exploratory Mode - Cross-tenant insights (READ-ONLY)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import text",
        "from sqlmodel import Session",
        "from ..auth.console_auth import FounderToken, verify_fops_token",
        "from ..db import get_session",
        "from ..schemas.response import wrap_dict, wrap_list"
      ],
      "classes": [
        "TenantSummary",
        "SystemSummary",
        "TenantDiagnostics",
        "SystemHealthResponse",
        "UsagePattern",
        "PatternsResponse"
      ],
      "functions": [
        "get_system_summary",
        "list_tenants",
        "get_tenant_diagnostics",
        "get_system_health",
        "get_usage_patterns",
        "get_explorer_info"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/founder/account/founder_lifecycle.py",
      "relative_path": "app/houseofcards/api/founder/account/founder_lifecycle.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Phase-9 Founder Lifecycle Endpoints",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from fastapi import APIRouter, HTTPException, Depends, Request",
        "from pydantic import BaseModel",
        "from app.auth.tenant_lifecycle import (",
        "from app.auth.lifecycle_provider import ("
      ],
      "classes": [
        "LifecycleTransitionRequest",
        "LifecycleStateResponse",
        "LifecycleTransitionResponse",
        "LifecycleHistoryItem",
        "LifecycleHistoryResponse"
      ],
      "functions": [
        "get_founder_actor",
        "result_to_response",
        "get_lifecycle_state",
        "get_lifecycle_history",
        "suspend_tenant",
        "resume_tenant",
        "terminate_tenant",
        "archive_tenant"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/founder/logs/founder_timeline.py",
      "relative_path": "app/houseofcards/api/founder/logs/founder_timeline.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import SQLAlchemyError",
        "from ..auth.console_auth import verify_fops_token",
        "from ..schemas.response import wrap_dict"
      ],
      "classes": [
        "DecisionRecordView",
        "TimelineEntry",
        "RunTimeline"
      ],
      "functions": [
        "get_db_url",
        "fetch_run_data",
        "fetch_decision_records",
        "fetch_all_decision_records",
        "get_run_timeline",
        "list_decision_records",
        "get_decision_record",
        "count_decision_records"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/founder/logs/founder_review.py",
      "relative_path": "app/houseofcards/api/founder/logs/founder_review.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Founder AUTO_EXECUTE Review Endpoints (Evidence-Only)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from sqlalchemy import text",
        "from sqlmodel import Session",
        "from app.auth.console_auth import FounderToken, verify_fops_token",
        "from app.contracts.ops import (",
        "from app.db import get_session"
      ],
      "classes": [],
      "functions": [
        "emit_review_audit_event",
        "list_auto_execute_decisions",
        "get_auto_execute_stats",
        "get_auto_execute_decision"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/founder/incidents/founder_onboarding.py",
      "relative_path": "app/houseofcards/api/founder/incidents/founder_onboarding.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Founder-only onboarding recovery actions",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from fastapi import APIRouter, Depends, HTTPException, Request, status",
        "from pydantic import BaseModel, Field",
        "from ..auth.console_auth import FounderToken, verify_fops_token",
        "from ..auth.onboarding_state import OnboardingState",
        "from ..auth.onboarding_transitions import get_onboarding_service",
        "from ..schemas.response import wrap_dict"
      ],
      "classes": [
        "ForceCompleteRequest",
        "ForceCompleteResponse",
        "OnboardingRecoveryAuditRecord"
      ],
      "functions": [
        "emit_recovery_audit",
        "force_complete_onboarding",
        "get_stalled_tenants"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/founder/incidents/ops.py",
      "relative_path": "app/houseofcards/api/founder/incidents/ops.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "INTERNAL",
        "role": "Ops Console API - Founder Intelligence System for behavioral insights",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Literal, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import text",
        "from sqlmodel import Session",
        "from app.auth.console_auth import FounderToken, verify_fops_token",
        "from app.contracts.ops import (",
        "from app.db import get_session",
        "from app.schemas.response import wrap_dict",
        "from app.models.killswitch import Incident, IncidentEvent"
      ],
      "classes": [
        "SystemPulse",
        "CustomerSegment",
        "StickinessByFeature",
        "IncidentPattern",
        "EstimationBasis",
        "RevenueRisk",
        "FounderIntervention",
        "CustomerAtRisk",
        "InfraLimits",
        "OpsEvent",
        "OpsEventListResponse",
        "OpsJobResult",
        "PlaybookAction",
        "PlaybookDetail"
      ],
      "functions": [
        "cache_get",
        "cache_set",
        "utc_now",
        "get_window",
        "exec_sql",
        "get_system_pulse",
        "get_customer_segments",
        "generate_interventions",
        "get_customers_at_risk",
        "get_customer_detail",
        "get_founder_playbooks",
        "get_playbook_detail",
        "get_incident_patterns",
        "get_infra_incident_summary",
        "get_founder_incident_detail",
        "get_founder_incidents",
        "get_stickiness_by_feature",
        "get_revenue_risk",
        "get_infra_limits",
        "get_event_stream"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/ops/cost_ops.py",
      "relative_path": "app/houseofcards/api/customer/ops/cost_ops.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime, timedelta, timezone",
        "from typing import List, Optional",
        "from fastapi import APIRouter, Depends, Query",
        "from sqlalchemy import text",
        "from sqlmodel import Session",
        "from app.auth.console_auth import FounderToken, verify_fops_token",
        "from app.contracts.ops import (",
        "from app.db import get_session"
      ],
      "classes": [],
      "functions": [
        "_compute_snapshot_status",
        "_compute_trend",
        "get_cost_overview",
        "get_cost_anomalies",
        "get_cost_tenants",
        "get_customer_cost_drilldown"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/recovery/recovery.py",
      "relative_path": "app/houseofcards/api/customer/recovery/recovery.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "INTERNAL",
        "role": "M10 Recovery Suggestion Engine - failure recovery suggestions for founders",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Path, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.console_auth import verify_fops_token",
        "from app.middleware.rate_limit import rate_limit_dependency",
        "from app.schemas.response import wrap_dict",
        "from app.services.recovery_matcher import RecoveryMatcher",
        "from app.services.recovery_write_service import RecoveryWriteService"
      ],
      "classes": [
        "SuggestRequest",
        "SuggestResponse",
        "ApproveRequest",
        "CandidateResponse",
        "CandidateListResponse",
        "CandidateUpdateRequest",
        "EvaluateRequest",
        "EvaluateResponse",
        "ActionResponse",
        "ActionListResponse",
        "CandidateDetailResponse",
        "ScopeTestRequest",
        "ScopeTestResponse",
        "CreateScopeRequest",
        "CreateScopeResponse",
        "ExecuteRequest",
        "ExecuteResponse",
        "ScopeListResponse"
      ],
      "functions": [
        "get_matcher",
        "suggest_recovery",
        "list_candidates",
        "approve_candidate",
        "delete_candidate",
        "get_recovery_stats",
        "get_candidate_detail",
        "update_candidate",
        "list_actions",
        "evaluate_rules",
        "test_recovery_scope",
        "create_scope",
        "execute_recovery",
        "list_scopes",
        "revoke_scope"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/recovery/recovery_ingest.py",
      "relative_path": "app/houseofcards/api/customer/recovery/recovery_ingest.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import time",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, status",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy.exc import IntegrityError",
        "from sqlmodel import Session, create_engine",
        "from app.metrics import (",
        "from app.middleware.rate_limit import rate_limit_dependency",
        "from app.services.recovery_write_service import RecoveryWriteService"
      ],
      "classes": [
        "IngestRequest",
        "IngestResponse"
      ],
      "functions": [
        "get_db_session",
        "ingest_failure",
        "_generate_default_suggestion",
        "_enqueue_evaluation_async",
        "_enqueue_evaluation"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/cus_enforcement.py",
      "relative_path": "app/houseofcards/api/customer/policies/cus_enforcement.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Enforcement policy API for customer LLM integrations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import List",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel, Field",
        "from app.schemas.response import wrap_dict, wrap_list",
        "from app.services.cus_enforcement_service import CusEnforcementService"
      ],
      "classes": [
        "EnforcementCheckRequest",
        "EnforcementBatchRequest"
      ],
      "functions": [
        "get_enforcement_service",
        "get_tenant_id",
        "check_enforcement",
        "get_enforcement_status",
        "batch_enforcement_check"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/governance.py",
      "relative_path": "app/houseofcards/api/customer/policies/governance.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified GOVERNANCE facade - L2 API for governance control operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.governance.facade import ("
      ],
      "classes": [
        "KillSwitchRequest",
        "ModeRequest",
        "ConflictResolutionRequest",
        "GovernanceStateResponse",
        "KillSwitchResponse",
        "BootStatusResponse"
      ],
      "functions": [
        "get_facade",
        "get_governance_state",
        "toggle_kill_switch",
        "set_governance_mode",
        "resolve_conflict",
        "list_conflicts",
        "get_boot_status"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/detection.py",
      "relative_path": "app/houseofcards/api/customer/policies/detection.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified DETECTION facade - L2 API for anomaly detection operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.detection.facade import ("
      ],
      "classes": [
        "RunDetectionRequest",
        "ResolveAnomalyRequest"
      ],
      "functions": [
        "get_facade",
        "run_detection",
        "list_anomalies",
        "get_anomaly",
        "resolve_anomaly",
        "acknowledge_anomaly",
        "get_detection_status"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/rate_limits.py",
      "relative_path": "app/houseofcards/api/customer/policies/rate_limits.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Unified RATE_LIMITS facade - L2 API for rate limits and quotas",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.limits.facade import ("
      ],
      "classes": [
        "UpdateLimitRequest",
        "CheckLimitRequest"
      ],
      "functions": [
        "get_facade",
        "list_limits",
        "get_usage",
        "check_limit",
        "get_limit",
        "update_limit",
        "reset_limit"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/policy_rules_crud.py",
      "relative_path": "app/houseofcards/api/customer/policies/policy_rules_crud.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Policy rules mutating operations (PIN-LIM-02)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import Any, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Request",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.schemas.limits.policy_rules import (",
        "from app.services.limits.policy_rules_service import ("
      ],
      "classes": [
        "CreateRuleRequest",
        "UpdateRuleRequest",
        "RuleDetail"
      ],
      "functions": [
        "create_rule",
        "update_rule",
        "_to_detail"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/simulate.py",
      "relative_path": "app/houseofcards/api/customer/policies/simulate.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Limit simulation endpoint (PIN-LIM-04)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from fastapi import APIRouter, Depends, HTTPException, Request",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.schemas.limits.simulation import (",
        "from app.services.limits.simulation_service import ("
      ],
      "classes": [
        "SimulateRequest",
        "SimulateResponse"
      ],
      "functions": [
        "simulate_execution"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/logs.py",
      "relative_path": "app/houseofcards/api/customer/policies/logs.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified LOGS domain facade - LOGS Domain V2 Implementation",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timedelta",
        "from typing import Annotated, Any, List, Literal, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.services.logs_facade import get_logs_facade"
      ],
      "classes": [
        "EvidenceMetadata",
        "LLMRunEnvelope",
        "TraceStep",
        "LLMRunTrace",
        "GovernanceEvent",
        "LLMRunGovernance",
        "ReplayEvent",
        "LLMRunReplay",
        "LLMRunExport",
        "LLMRunRecordItem",
        "LLMRunRecordsResponse",
        "SystemSnapshot",
        "TelemetryStub",
        "SystemEvent",
        "SystemEvents",
        "SystemReplay",
        "SystemAudit",
        "SystemRecordItem",
        "SystemRecordsResponse",
        "AuditLedgerItem",
        "AuditLedgerDetailItem",
        "AuditLedgerResponse",
        "IdentityEvent",
        "AuditIdentity",
        "AuthorizationDecision",
        "AuditAuthorization",
        "AccessEvent",
        "AuditAccess",
        "IntegrityCheck",
        "AuditIntegrity",
        "ExportRecord",
        "AuditExports"
      ],
      "functions": [
        "get_tenant_id_from_auth",
        "list_llm_run_records",
        "get_llm_run_envelope",
        "get_llm_run_trace",
        "get_llm_run_governance",
        "get_llm_run_replay",
        "get_llm_run_export",
        "list_system_records",
        "get_system_snapshot",
        "get_system_telemetry",
        "get_system_events",
        "get_system_replay",
        "get_system_audit",
        "list_audit_entries",
        "get_audit_entry",
        "get_audit_identity",
        "get_audit_authorization",
        "get_audit_access",
        "get_audit_integrity",
        "get_audit_exports"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/customer_visibility.py",
      "relative_path": "app/houseofcards/api/customer/policies/customer_visibility.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L2a \u2014 Product API (Console-scoped)"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Request",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import SQLAlchemyError",
        "from app.auth import verify_api_key",
        "from app.middleware.tenancy import get_tenant_id",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [
        "StageDeclaration",
        "CostDeclaration",
        "BudgetDeclaration",
        "PolicyDeclaration",
        "MemoryDeclaration",
        "EstimationMethodology",
        "PreRunDeclaration",
        "AcknowledgementRequest",
        "AcknowledgementResponse",
        "OutcomeItem",
        "OutcomeReconciliation"
      ],
      "functions": [
        "get_db_url",
        "get_budget_mode",
        "get_policy_posture",
        "get_memory_mode",
        "estimate_stages",
        "estimate_cost",
        "fetch_run_outcome",
        "fetch_decision_summary",
        "get_pre_run_declaration",
        "acknowledge_declaration",
        "get_outcome_reconciliation",
        "get_declaration"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/aos_accounts.py",
      "relative_path": "app/houseofcards/api/customer/policies/aos_accounts.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Unified ACCOUNTS facade - customer-only production API",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timedelta",
        "from typing import Annotated, Any, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import func, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.services.accounts_facade import get_accounts_facade",
        "from app.models.tenant import ("
      ],
      "classes": [
        "ProjectSummary",
        "ProjectsListResponse",
        "ProjectDetailResponse",
        "UserSummary",
        "UsersListResponse",
        "UserDetailResponse",
        "ProfileResponse",
        "BillingSummaryResponse",
        "ProfileUpdateRequest",
        "ProfileUpdateResponse",
        "InvoiceSummary",
        "InvoiceListResponse",
        "SupportTicketCreate",
        "SupportTicketResponse",
        "SupportTicketListResponse",
        "SupportContactResponse",
        "InviteUserRequest",
        "InvitationResponse",
        "InvitationListResponse",
        "AcceptInvitationRequest",
        "UpdateUserRoleRequest",
        "TenantUserResponse",
        "TenantUserListResponse"
      ],
      "functions": [
        "get_tenant_id_from_auth",
        "get_user_id_from_auth",
        "list_projects",
        "get_project_detail",
        "list_users",
        "get_user_detail",
        "get_profile",
        "get_billing_summary",
        "update_profile",
        "get_billing_invoices",
        "get_support_contact",
        "create_support_ticket",
        "list_support_tickets",
        "invite_user",
        "list_invitations",
        "accept_invitation",
        "list_tenant_users",
        "update_user_role",
        "remove_user"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/guard.py",
      "relative_path": "app/houseofcards/api/customer/policies/guard.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L2a \u2014 Product API (Console-scoped)"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import uuid",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional, cast",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel",
        "from sqlalchemy import and_, desc, func, select",
        "from sqlmodel import Session",
        "from app.adapters.customer_incidents_adapter import (",
        "from app.adapters.customer_keys_adapter import (",
        "from app.adapters.customer_killswitch_adapter import (",
        "from app.auth.authority import AuthorityResult, emit_authority_audit, require_replay_execute",
        "from app.auth.console_auth import CustomerToken, verify_console_token",
        "from app.schemas.response import wrap_dict",
        "from app.contracts.guard import (",
        "from app.db import get_session",
        "from app.models.killswitch import (",
        "from app.models.tenant import Tenant",
        "from app.services.certificate import (",
        "from app.services.guard_write_service import GuardWriteService",
        "from app.services.replay_determinism import (",
        "from app.services.replay_determinism import (",
        "from app.utils.guard_cache import get_guard_cache",
        "import json",
        "from decimal import Decimal"
      ],
      "classes": [
        "GuardStatus",
        "TodaySnapshot",
        "IncidentSummary",
        "IncidentEventResponse",
        "IncidentDetailResponse",
        "ApiKeyResponse",
        "PaginatedResponse",
        "GuardrailConfig",
        "TenantSettings",
        "PolicyDecision",
        "ReplayCallSnapshot",
        "ReplayCertificate",
        "ReplayResult",
        "IncidentSearchRequest",
        "IncidentSearchResult",
        "IncidentSearchResponse",
        "TimelineEvent",
        "PolicyEvaluation",
        "CARERoutingInfo",
        "FailureCatalogMatch",
        "DecisionTimelineResponse",
        "EvidenceExportRequest",
        "OnboardingVerifyRequest",
        "OnboardingVerifyResponse"
      ],
      "functions": [
        "utc_now",
        "get_tenant_from_auth",
        "get_guard_status",
        "get_today_snapshot",
        "activate_killswitch",
        "deactivate_killswitch",
        "list_incidents",
        "get_incident_detail",
        "acknowledge_incident",
        "resolve_incident",
        "get_customer_incident_narrative",
        "_generate_plain_title",
        "_generate_calm_summary",
        "_build_customer_impact",
        "_build_customer_resolution",
        "_build_customer_actions",
        "replay_call",
        "list_api_keys",
        "freeze_api_key",
        "unfreeze_api_key",
        "get_settings",
        "search_incidents",
        "get_decision_timeline",
        "export_incident_evidence",
        "onboarding_verify"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/policies.py",
      "relative_path": "app/houseofcards/api/customer/policies/policies.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified POLICIES domain facade - customer-only production API",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime",
        "from decimal import Decimal",
        "from typing import Annotated, Any, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.schemas.response import wrap_dict",
        "from app.services.policies_facade import get_policies_facade"
      ],
      "classes": [
        "PolicyRuleSummary",
        "RulesListResponse",
        "PolicyRuleDetailResponse",
        "LimitSummary",
        "LimitsListResponse",
        "LimitDetailResponse",
        "LessonSummaryResponse",
        "LessonsListResponse",
        "LessonDetailResponse",
        "LessonStatsResponse",
        "PolicyStateResponse",
        "PolicyMetricsResponse",
        "PolicyConflictResponse",
        "ConflictsListResponse",
        "PolicyDependencyRelation",
        "PolicyNodeResponse",
        "PolicyDependencyEdge",
        "DependencyGraphResponse",
        "PolicyViolationSummary",
        "ViolationsListResponse",
        "BudgetDefinitionSummary",
        "BudgetsListResponse",
        "PolicyRequestSummary",
        "PolicyRequestsListResponse"
      ],
      "functions": [
        "require_preflight",
        "get_tenant_id_from_auth",
        "list_policy_rules",
        "get_policy_rule_detail",
        "list_limits",
        "get_limit_detail",
        "get_rule_evidence",
        "get_limit_evidence",
        "list_lessons",
        "get_lesson_stats",
        "get_lesson_detail",
        "get_policy_state",
        "get_policy_metrics",
        "list_policy_conflicts",
        "get_policy_dependencies",
        "list_policy_violations",
        "list_budget_definitions",
        "list_policy_requests"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/retrieval.py",
      "relative_path": "app/houseofcards/api/customer/policies/retrieval.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified RETRIEVAL facade - L2 API for mediated data access",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.retrieval.facade import ("
      ],
      "classes": [
        "AccessDataRequest",
        "RegisterPlaneRequest"
      ],
      "functions": [
        "get_facade",
        "access_data",
        "list_planes",
        "register_plane",
        "get_plane",
        "list_evidence",
        "get_evidence"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/M25_integrations.py",
      "relative_path": "app/houseofcards/api/customer/policies/M25_integrations.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "INTERNAL",
        "role": "M25 Integration System - Loop status, checkpoints, graduation, prevention timeline",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import uuid",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from fastapi.responses import StreamingResponse",
        "from pydantic import BaseModel, Field",
        "from ..auth.console_auth import FounderToken, verify_fops_token",
        "from ..schemas.response import wrap_dict",
        "from app.integrations.events import ("
      ],
      "classes": [
        "LoopStatusResponse",
        "StageDetail",
        "CheckpointResponse",
        "ResolveCheckpointRequest",
        "IntegrationStatsResponse",
        "RetryStageRequest",
        "RevertLoopRequest",
        "GateEvidenceResponse",
        "CapabilityStatus",
        "SimulationStatus",
        "HardenedGraduationResponse",
        "SimulatePreventionRequest",
        "SimulateRegretRequest",
        "TimelineEventResponse",
        "PreventionTimelineResponse"
      ],
      "functions": [
        "get_tenant_id_from_token",
        "get_current_user_from_token",
        "get_tenant_id",
        "get_current_user",
        "get_loop_status",
        "get_loop_stages",
        "stream_loop_status",
        "retry_loop_stage",
        "revert_loop",
        "list_pending_checkpoints",
        "get_checkpoint",
        "resolve_checkpoint",
        "get_integration_stats",
        "get_loop_narrative",
        "get_graduation_status",
        "simulate_prevention",
        "simulate_regret",
        "simulate_timeline_view",
        "record_timeline_view",
        "trigger_graduation_re_evaluation",
        "get_prevention_timeline"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/status_history.py",
      "relative_path": "app/houseofcards/api/customer/policies/status_history.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import csv",
        "import hashlib",
        "import hmac",
        "import json",
        "import os",
        "import time",
        "import uuid",
        "from datetime import datetime, timedelta, timezone",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional, cast",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Response",
        "from pydantic import BaseModel, Field",
        "from sqlmodel import Session, func, select",
        "from app.db import StatusHistory, get_session"
      ],
      "classes": [
        "StatusHistoryQuery",
        "StatusHistoryResponse",
        "StatusHistoryListResponse",
        "ExportRequest",
        "ExportResponse",
        "StatsResponse"
      ],
      "functions": [
        "generate_signed_url",
        "verify_signed_url",
        "query_status_history",
        "get_entity_history",
        "create_export",
        "download_export",
        "get_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/scheduler.py",
      "relative_path": "app/houseofcards/api/customer/policies/scheduler.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified SCHEDULER facade - L2 API for scheduled job operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.scheduler.facade import ("
      ],
      "classes": [
        "CreateJobRequest",
        "UpdateJobRequest"
      ],
      "functions": [
        "get_facade",
        "create_job",
        "list_jobs",
        "get_job",
        "update_job",
        "delete_job",
        "trigger_job",
        "pause_job",
        "resume_job",
        "list_job_runs",
        "get_run"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/compliance.py",
      "relative_path": "app/houseofcards/api/customer/policies/compliance.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified COMPLIANCE facade - L2 API for compliance verification",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.compliance.facade import ("
      ],
      "classes": [
        "VerifyComplianceRequest"
      ],
      "functions": [
        "get_facade",
        "verify_compliance",
        "list_reports",
        "get_report",
        "list_rules",
        "get_rule",
        "get_compliance_status"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/datasources.py",
      "relative_path": "app/houseofcards/api/customer/policies/datasources.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified DATASOURCES facade - L2 API for data source operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.datasources.facade import ("
      ],
      "classes": [
        "CreateSourceRequest",
        "UpdateSourceRequest"
      ],
      "functions": [
        "get_facade",
        "create_source",
        "list_sources",
        "get_statistics",
        "get_source",
        "update_source",
        "delete_source",
        "test_connection",
        "activate_source",
        "deactivate_source"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/analytics.py",
      "relative_path": "app/houseofcards/api/customer/policies/analytics.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified ANALYTICS domain facade - customer-only production API",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import csv",
        "import io",
        "import logging",
        "from datetime import datetime, timedelta",
        "from enum import Enum",
        "from typing import Annotated, Dict, List",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from fastapi.responses import Response",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.services.analytics_facade import get_analytics_facade"
      ],
      "classes": [
        "ResolutionType",
        "ScopeType",
        "TimeWindow",
        "UsageWindow",
        "UsageTotals",
        "UsageDataPoint",
        "UsageSignals",
        "UsageStatisticsResponse",
        "CostTotals",
        "CostDataPoint",
        "CostByModel",
        "CostByFeature",
        "CostSignals",
        "CostStatisticsResponse",
        "TopicStatus",
        "AnalyticsStatusResponse"
      ],
      "functions": [
        "get_usage_statistics",
        "get_analytics_status",
        "get_cost_statistics",
        "analytics_health",
        "_get_usage_data",
        "export_usage_csv",
        "export_usage_json",
        "_get_cost_data",
        "export_cost_csv",
        "export_cost_json"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/policy_layer.py",
      "relative_path": "app/houseofcards/api/customer/policies/policy_layer.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Policy Layer API - Constitutional governance for multi-agent systems",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db_async import get_async_session",
        "from app.schemas.response import wrap_dict",
        "from app.policy import (",
        "from app.services.policy.facade import get_policy_facade"
      ],
      "classes": [
        "EvaluateRequest",
        "SimulateRequest",
        "ViolationQuery",
        "RiskCeilingUpdate",
        "SafetyRuleUpdate",
        "CooldownInfo",
        "PolicyMetrics",
        "CreateVersionRequest",
        "RollbackRequest",
        "ResolveConflictRequest",
        "TemporalPolicyCreate",
        "ContextAwareEvaluateRequest",
        "AddDependencyRequest",
        "PruneTemporalMetricsRequest",
        "ActivateVersionRequest",
        "LessonConvertRequest",
        "LessonDeferRequest",
        "LessonDismissRequest"
      ],
      "functions": [
        "evaluate_action",
        "simulate_evaluation",
        "get_policy_state",
        "reload_policies",
        "list_violations",
        "get_violation",
        "acknowledge_violation",
        "list_risk_ceilings",
        "get_risk_ceiling",
        "update_risk_ceiling",
        "reset_risk_ceiling",
        "list_safety_rules",
        "update_safety_rule",
        "list_ethical_constraints",
        "list_active_cooldowns",
        "clear_cooldowns",
        "get_policy_metrics",
        "evaluate_batch",
        "list_policy_versions",
        "get_current_version",
        "create_policy_version",
        "rollback_to_version",
        "get_version_provenance",
        "get_dependency_graph",
        "list_conflicts",
        "resolve_conflict",
        "list_temporal_policies",
        "create_temporal_policy",
        "get_temporal_utilization",
        "evaluate_with_context",
        "validate_dependency_dag",
        "add_dependency_with_dag_check",
        "get_evaluation_order",
        "prune_temporal_metrics",
        "get_temporal_storage_stats",
        "activate_policy_version",
        "check_version_integrity",
        "list_lessons",
        "get_lesson_stats",
        "get_lesson",
        "convert_lesson_to_draft",
        "defer_lesson",
        "dismiss_lesson"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/runtime.py",
      "relative_path": "app/houseofcards/api/customer/policies/runtime.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Runtime API endpoints for machine-native primitives",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel, Field",
        "from app.auth.authority import AuthorityResult, require_replay_execute",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.middleware.rate_limit import rate_limit_dependency",
        "from app.schemas.response import wrap_dict",
        "from app.commands.runtime_command import DEFAULT_SKILL_METADATA"
      ],
      "classes": [
        "PlanStep",
        "SimulateRequest",
        "SimulateResponse",
        "QueryRequest",
        "QueryResponse",
        "SkillDescriptorResponse",
        "SkillListResponse",
        "CapabilitiesResponse",
        "ReplayRequest",
        "ReplayResponse"
      ],
      "functions": [
        "_get_cost_simulator",
        "_get_runtime_adapter",
        "_get_skill_registry",
        "simulate_plan",
        "query_runtime",
        "list_available_skills",
        "describe_skill",
        "get_capabilities",
        "get_resource_contract",
        "replay_run",
        "list_traces",
        "get_trace"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/aos_cus_integrations.py",
      "relative_path": "app/houseofcards/api/customer/policies/aos_cus_integrations.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Customer LLM Integration Management - BYOK (Bring Your Own Key) API",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Optional",
        "from uuid import UUID",
        "from fastapi import APIRouter, HTTPException, Query, Request",
        "from app.auth.tenant_resolver import resolve_tenant_id",
        "from app.schemas.cus_schemas import (",
        "from app.schemas.response import wrap_dict, wrap_list",
        "from app.services.integrations_facade import get_integrations_facade"
      ],
      "classes": [],
      "functions": [
        "get_user_id",
        "list_integrations",
        "get_integration",
        "create_integration",
        "update_integration",
        "delete_integration",
        "enable_integration",
        "disable_integration",
        "get_integration_health",
        "test_integration_credentials",
        "get_integration_limits"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/policy_proposals.py",
      "relative_path": "app/houseofcards/api/customer/policies/policy_proposals.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Optional",
        "from uuid import UUID",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel",
        "from sqlalchemy import func, select",
        "from ..auth.gateway_middleware import get_auth_context",
        "from ..auth.role_guard import require_role",
        "from ..auth.tenant_roles import TenantRole",
        "from ..db import get_async_session",
        "from ..models.policy import PolicyApprovalRequest, PolicyProposal, PolicyVersion",
        "from ..schemas.response import wrap_dict",
        "from ..services.policy_proposal import review_policy_proposal"
      ],
      "classes": [
        "ProposalSummaryResponse",
        "ProposalListResponse",
        "ProposalDetailResponse",
        "VersionResponse",
        "ApproveRejectRequest",
        "ApprovalResponse"
      ],
      "functions": [
        "list_proposals",
        "get_proposal_stats",
        "get_proposal",
        "list_proposal_versions",
        "approve_proposal",
        "reject_proposal"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/monitors.py",
      "relative_path": "app/houseofcards/api/customer/policies/monitors.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Unified MONITORS facade - L2 API for monitoring operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.monitors.facade import ("
      ],
      "classes": [
        "CreateMonitorRequest",
        "UpdateMonitorRequest"
      ],
      "functions": [
        "get_facade",
        "create_monitor",
        "list_monitors",
        "get_status",
        "get_monitor",
        "update_monitor",
        "delete_monitor",
        "run_check",
        "get_history"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/billing_dependencies.py",
      "relative_path": "app/houseofcards/api/customer/policies/billing_dependencies.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Phase-6 Billing FastAPI dependencies",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from fastapi import Request, HTTPException",
        "from app.billing.state import BillingState",
        "from app.billing.plan import Plan, DEFAULT_PLAN",
        "from app.billing.limits import Limits, DEFAULT_LIMITS",
        "from app.billing.provider import get_billing_provider",
        "from app.auth.onboarding_state import OnboardingState",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [
        "BillingContext"
      ],
      "functions": [
        "get_billing_context",
        "require_billing_active",
        "check_limit"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/policy.py",
      "relative_path": "app/houseofcards/api/customer/policies/policy.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Policy sandbox evaluation and approval workflow management",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "BackgroundTasks",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import hashlib",
        "import hmac",
        "import json",
        "import logging",
        "import os",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, cast",
        "from uuid import uuid4",
        "import httpx",
        "from fastapi import APIRouter, BackgroundTasks, Depends, HTTPException",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import TenantTier, requires_feature, requires_tier",
        "from app.db_async import get_async_session",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [
        "PolicyType",
        "ApprovalStatus",
        "PolicyEvalRequest",
        "PolicyEvalResponse",
        "ApprovalRequestCreate",
        "ApprovalRequestResponse",
        "ApprovalAction",
        "ApprovalStatusResponse",
        "PolicyMetadata",
        "PolicyContextSummary",
        "ActivePoliciesResponse",
        "PolicyLibrarySummary",
        "PolicyLibraryResponse",
        "PolicyLessonSummary",
        "LessonsResponse",
        "ThresholdSummary",
        "ThresholdsResponse",
        "ViolationSummary",
        "ViolationsResponse"
      ],
      "functions": [
        "_get_policy_adapter",
        "_record_policy_decision",
        "_record_capability_violation",
        "_record_budget_rejection",
        "_record_approval_request_created",
        "_record_approval_action",
        "_record_approval_escalation",
        "_record_webhook_fallback",
        "_check_rate_limit",
        "_get_policy_version",
        "_hash_webhook_secret",
        "_get_approval_level_config",
        "_config_to_dict",
        "_simulate_cost",
        "_check_policy_violations",
        "_compute_webhook_signature",
        "_send_webhook",
        "verify_webhook_signature",
        "evaluate_policy",
        "create_approval_request",
        "get_approval_request",
        "_check_approver_authorization",
        "approve_request",
        "reject_request",
        "list_approval_requests",
        "run_escalation_check",
        "run_escalation_task",
        "_build_policy_metadata_from_rule",
        "_build_policy_metadata_from_limit",
        "_build_policy_metadata_from_violation",
        "_build_policy_metadata_from_lesson",
        "get_active_policies",
        "get_active_policy_detail",
        "get_policy_library",
        "get_policy_lessons",
        "get_policy_lesson_detail",
        "get_policy_thresholds",
        "get_policy_threshold_detail",
        "get_policy_violations_v2",
        "get_policy_violation_detail"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/lifecycle.py",
      "relative_path": "app/houseofcards/api/customer/policies/lifecycle.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Unified LIFECYCLE facade - L2 API for lifecycle operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.lifecycle.facade import ("
      ],
      "classes": [
        "CreateAgentRequest",
        "CreateRunRequest"
      ],
      "functions": [
        "get_facade",
        "create_agent",
        "list_agents",
        "get_agent",
        "start_agent",
        "stop_agent",
        "terminate_agent",
        "create_run",
        "list_runs",
        "get_run",
        "pause_run",
        "resume_run",
        "cancel_run",
        "get_summary"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/controls.py",
      "relative_path": "app/houseofcards/api/customer/policies/controls.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Unified CONTROLS facade - L2 API for control operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.controls.facade import ("
      ],
      "classes": [
        "UpdateControlRequest"
      ],
      "functions": [
        "get_facade",
        "list_controls",
        "get_status",
        "get_control",
        "update_control",
        "enable_control",
        "disable_control"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/alerts.py",
      "relative_path": "app/houseofcards/api/customer/policies/alerts.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified ALERTS facade - L2 API for alert operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.alerts.facade import ("
      ],
      "classes": [
        "CreateRuleRequest",
        "UpdateRuleRequest",
        "CreateRouteRequest"
      ],
      "functions": [
        "get_facade",
        "create_rule",
        "list_rules",
        "get_rule",
        "update_rule",
        "delete_rule",
        "list_history",
        "get_event",
        "acknowledge_event",
        "resolve_event",
        "create_route",
        "list_routes",
        "get_route",
        "delete_route"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/replay.py",
      "relative_path": "app/houseofcards/api/customer/policies/replay.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Replay UX API - READ-ONLY slice and timeline endpoints",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime, timedelta",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import and_, select",
        "from sqlmodel import Session",
        "from ..auth.authority import AuthorityResult, require_replay_read, verify_tenant_access",
        "from ..db import get_session as get_db_session",
        "from ..schemas.response import wrap_dict",
        "from ..models.killswitch import Incident, IncidentEvent, ProxyCall"
      ],
      "classes": [
        "ReplayCategory",
        "ReplayItem",
        "ReplaySliceResponse",
        "IncidentSummaryResponse"
      ],
      "functions": [
        "_categorize_proxy_call",
        "_proxy_call_to_replay_item",
        "_incident_event_to_replay_item",
        "get_replay_slice",
        "get_incident_summary",
        "get_replay_timeline",
        "explain_replay_item"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/workers.py",
      "relative_path": "app/houseofcards/api/customer/policies/workers.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Business Builder Worker API endpoints",
        "raw_layer_line": "# Layer: L2 \u2014 Product API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "BackgroundTasks",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import json",
        "import logging",
        "import os",
        "import uuid",
        "from collections import defaultdict",
        "from datetime import datetime, timezone",
        "from typing import Any, AsyncGenerator, Dict, List, Optional",
        "from fastapi import APIRouter, BackgroundTasks, Depends, HTTPException, Request",
        "from fastapi.responses import StreamingResponse",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import select",
        "from app.auth import verify_api_key",
        "from app.auth.authority import AuthorityResult, emit_authority_audit, require_replay_execute",
        "from app.contracts.decisions import emit_policy_precheck_decision",
        "from app.db import CostBudget, get_async_session",
        "from app.core.execution_context import ExecutionContext, EvidenceSource",
        "from app.evidence.capture import capture_environment_evidence",
        "from app.models.tenant import WorkerRun",
        "from app.policy.engine import PolicyEngine",
        "from app.schemas.response import wrap_dict",
        "from app.services.worker_write_service_async import WorkerWriteServiceAsync"
      ],
      "classes": [
        "ToneRuleRequest",
        "ForbiddenClaimRequest",
        "VisualIdentityRequest",
        "BrandRequest",
        "WorkerRunRequest",
        "PolicyStatusModel",
        "WorkerRunResponse",
        "ReplayRequest",
        "BrandValidationResponse",
        "RunListItem",
        "RunListResponse",
        "RunRetryResponse",
        "WorkerEventBus",
        "EventType"
      ],
      "functions": [
        "_get_workers_adapter",
        "_calculate_cost_cents",
        "_store_run",
        "_insert_cost_record",
        "_check_and_emit_cost_advisory",
        "_verify_advisory_invariant",
        "_get_run",
        "_list_runs",
        "get_event_bus",
        "_brand_request_to_schema",
        "_execute_worker_async",
        "run_worker",
        "replay_execution_endpoint",
        "get_run",
        "list_runs",
        "retry_run",
        "validate_brand",
        "worker_health",
        "delete_run",
        "get_brand_schema",
        "get_run_schema",
        "_sse_event_generator",
        "stream_run_events",
        "get_run_events",
        "_execute_worker_with_events",
        "run_worker_streaming"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/aos_api_key.py",
      "relative_path": "app/houseofcards/api/customer/policies/aos_api_key.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Unified API KEYS facade - Customer Console Connectivity Domain (API Keys)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import Annotated, Any, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.services.api_keys_facade import get_api_keys_facade"
      ],
      "classes": [
        "APIKeySummary",
        "APIKeysListResponse",
        "APIKeyDetailResponse"
      ],
      "functions": [
        "get_tenant_id_from_auth",
        "list_api_keys",
        "get_api_key_detail"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/connectors.py",
      "relative_path": "app/houseofcards/api/customer/policies/connectors.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified CONNECTORS facade - L2 API for connector operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.connectors.facade import ("
      ],
      "classes": [
        "RegisterConnectorRequest",
        "UpdateConnectorRequest"
      ],
      "functions": [
        "get_facade",
        "list_connectors",
        "register_connector",
        "get_connector",
        "update_connector",
        "delete_connector",
        "test_connector"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/evidence.py",
      "relative_path": "app/houseofcards/api/customer/policies/evidence.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified EVIDENCE facade - L2 API for evidence chain and export",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.evidence.facade import ("
      ],
      "classes": [
        "CreateChainRequest",
        "AddEvidenceRequest",
        "CreateExportRequest"
      ],
      "functions": [
        "get_facade",
        "list_chains",
        "create_chain",
        "get_chain",
        "add_evidence",
        "verify_chain",
        "create_export",
        "list_exports",
        "get_export"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/guard_policies.py",
      "relative_path": "app/houseofcards/api/customer/policies/guard_policies.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L2a \u2014 Product API (Console-scoped)"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from app.adapters.customer_policies_adapter import (",
        "from app.auth.console_auth import verify_console_token",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [],
      "functions": [
        "get_policy_constraints",
        "get_guardrail_detail"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/policy_limits_crud.py",
      "relative_path": "app/houseofcards/api/customer/policies/policy_limits_crud.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Policy limits mutating operations (PIN-LIM-01)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from decimal import Decimal",
        "from typing import Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Request",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.schemas.limits.policy_limits import (",
        "from app.services.limits.policy_limits_service import ("
      ],
      "classes": [
        "CreateLimitRequest",
        "UpdateLimitRequest",
        "ThresholdParamsRequest",
        "ThresholdParamsResponse",
        "LimitDetail"
      ],
      "functions": [
        "create_limit",
        "update_limit",
        "delete_limit",
        "get_threshold_params",
        "set_threshold_params",
        "_to_detail"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/notifications.py",
      "relative_path": "app/houseofcards/api/customer/policies/notifications.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified NOTIFICATIONS facade - L2 API for notification operations",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.auth.tenant_auth import TenantContext, get_tenant_context",
        "from app.auth.tier_gating import requires_feature",
        "from app.schemas.response import wrap_dict",
        "from app.services.notifications.facade import ("
      ],
      "classes": [
        "SendNotificationRequest",
        "UpdatePreferencesRequest"
      ],
      "functions": [
        "get_facade",
        "send_notification",
        "list_notifications",
        "list_channels",
        "get_preferences",
        "update_preferences",
        "get_notification",
        "mark_as_read"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/rbac_api.py",
      "relative_path": "app/houseofcards/api/customer/policies/rbac_api.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel",
        "from sqlalchemy import text",
        "from ..auth.authorization_choke import check_permission_request",
        "from ..auth.rbac_engine import get_rbac_engine",
        "from ..db import get_session as get_db_session",
        "from ..schemas.response import wrap_dict"
      ],
      "classes": [
        "PolicyInfoResponse",
        "ReloadResponse",
        "AuditEntry",
        "AuditResponse"
      ],
      "functions": [
        "get_policy_info",
        "reload_policies",
        "get_permission_matrix",
        "query_audit_logs",
        "cleanup_audit_logs"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/policies/override.py",
      "relative_path": "app/houseofcards/api/customer/policies/override.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Limit override endpoint (PIN-LIM-05)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from decimal import Decimal",
        "from typing import Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.schemas.limits.overrides import (",
        "from app.services.limits.override_service import ("
      ],
      "classes": [
        "CreateOverrideRequest",
        "OverrideListItem",
        "OverrideDetail",
        "OverrideListResponse"
      ],
      "functions": [
        "create_override",
        "list_overrides",
        "get_override",
        "cancel_override",
        "_to_detail",
        "_to_list_item"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/agent/authz_status.py",
      "relative_path": "app/houseofcards/api/customer/agent/authz_status.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Authorization status endpoint for ops visibility",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import Any, Dict",
        "from fastapi import APIRouter",
        "from app.auth.authorization_choke import (",
        "from app.auth.authorization_metrics import (",
        "from app.auth.mappings import get_all_mappings",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [],
      "functions": [
        "get_authz_status",
        "get_authz_mappings",
        "get_phase_info",
        "get_metrics_info",
        "get_alert_rules_endpoint",
        "_get_phase_description",
        "_calculate_coverage"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/agent/onboarding.py",
      "relative_path": "app/houseofcards/api/customer/agent/onboarding.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Onboarding status and progression endpoints",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from fastapi import APIRouter, HTTPException, Request, status",
        "from pydantic import BaseModel, Field",
        "from ..auth.gateway_middleware import get_auth_context",
        "from ..auth.onboarding_state import OnboardingState",
        "from ..schemas.response import wrap_dict"
      ],
      "classes": [
        "NextAction",
        "OnboardingStatusResponse",
        "OnboardingVerifyResponse"
      ],
      "functions": [
        "get_onboarding_status",
        "verify_identity",
        "advance_api_key_created"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/agent/platform.py",
      "relative_path": "app/houseofcards/api/customer/agent/platform.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Platform health and eligibility endpoints (Founder-only)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Any, Dict",
        "from fastapi import APIRouter, Depends, HTTPException",
        "from sqlmodel import Session",
        "from app.db import get_session",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [],
      "functions": [
        "get_platform_health",
        "get_capabilities_eligibility",
        "get_domain_health",
        "get_capability_health",
        "check_capability_eligibility"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/agent/discovery.py",
      "relative_path": "app/houseofcards/api/customer/agent/discovery.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Optional",
        "from fastapi import APIRouter, Query",
        "from app.discovery.ledger import get_signals",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [],
      "functions": [
        "list_signals",
        "signal_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/activity/activity.py",
      "relative_path": "app/houseofcards/api/customer/activity/activity.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified ACTIVITY domain facade - customer-only production API",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "from datetime import datetime, timedelta",
        "from enum import Enum",
        "from typing import Annotated, Any",
        "from fastapi import APIRouter, Depends, HTTPException, Path, Query, Request",
        "from pydantic import BaseModel",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.services.activity_facade import get_activity_facade",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [
        "RunState",
        "RunStatus",
        "RiskLevel",
        "LatencyBucket",
        "EvidenceHealth",
        "IntegrityStatus",
        "RunSource",
        "ProviderType",
        "SortField",
        "SortOrder",
        "EvaluationOutcome",
        "PolicyScope",
        "RiskType",
        "PolicyContext",
        "RunSummaryV2",
        "Pagination",
        "LiveRunsResponse",
        "CompletedRunsResponse",
        "SignalFeedbackModel",
        "SignalProjection",
        "SignalsResponse",
        "MetricsResponse",
        "ThresholdSignal",
        "ThresholdSignalsResponse",
        "SignalAckRequest",
        "SignalAckResponse",
        "SignalSuppressRequest",
        "SignalSuppressResponse",
        "RunSummary",
        "RunListResponse",
        "RunDetailResponse",
        "StatusBucket",
        "StatusSummaryResponse",
        "DimensionValue",
        "DimensionGroup",
        "DimensionBreakdownResponse",
        "PatternMatchResponse",
        "PatternDetectionResponse",
        "AgentCostResponse",
        "CostAnalysisResponse",
        "AttentionItemResponse",
        "AttentionQueueResponse",
        "RiskSignalsResponse"
      ],
      "functions": [
        "require_preflight",
        "get_tenant_id_from_auth",
        "list_runs",
        "get_run_detail",
        "get_run_evidence",
        "get_run_proof",
        "get_summary_by_status",
        "_get_runs_by_dimension_internal",
        "get_live_runs_by_dimension",
        "get_completed_runs_by_dimension",
        "get_runs_by_dimension",
        "get_patterns",
        "get_cost_analysis",
        "get_attention_queue",
        "get_risk_signals",
        "_extract_policy_context",
        "_row_to_run_summary_v2",
        "list_live_runs",
        "list_completed_runs",
        "list_signals",
        "get_activity_metrics",
        "get_threshold_signals",
        "acknowledge_signal",
        "suppress_signal",
        "get_actor_id_from_auth"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/account/memory_pins.py",
      "relative_path": "app/houseofcards/api/customer/account/memory_pins.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel, Field, field_validator",
        "from sqlalchemy import text",
        "from sqlalchemy.exc import IntegrityError",
        "from ..db import get_session as get_db_session",
        "from ..schemas.response import wrap_dict",
        "from ..utils.metrics_helpers import get_or_create_counter, get_or_create_histogram"
      ],
      "classes": [
        "MemoryPinCreate",
        "MemoryPinResponse",
        "MemoryPinListResponse",
        "MemoryPinDeleteResponse"
      ],
      "functions": [
        "check_feature_enabled",
        "extract_tenant_from_request",
        "write_memory_audit",
        "create_or_upsert_pin",
        "get_pin",
        "list_pins",
        "delete_pin",
        "cleanup_expired_pins"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/analytics/predictions.py",
      "relative_path": "app/houseofcards/api/customer/analytics/predictions.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime",
        "from typing import Optional",
        "from uuid import UUID",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel",
        "from sqlalchemy import func, select",
        "from ..auth.authority import AuthorityResult, emit_authority_audit, require_predictions_read",
        "from ..db import get_async_session",
        "from ..models.prediction import PredictionEvent",
        "from ..schemas.response import wrap_dict"
      ],
      "classes": [
        "PredictionSummaryResponse",
        "PredictionListResponse",
        "PredictionDetailResponse"
      ],
      "functions": [
        "list_predictions",
        "get_prediction",
        "get_predictions_for_subject",
        "get_prediction_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/analytics/costsim.py",
      "relative_path": "app/houseofcards/api/customer/analytics/costsim.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from app.costsim import (",
        "from app.costsim.config import get_config",
        "from app.costsim.divergence import generate_divergence_report",
        "from app.schemas.response import wrap_dict",
        "from app.costsim.datasets import get_dataset_validator, validate_all_datasets",
        "from app.costsim.datasets import validate_dataset as validate_ds"
      ],
      "classes": [
        "SimulationStep",
        "SimulateRequest",
        "SimulationStepResult",
        "V2SimulationResponse",
        "ComparisonResponse",
        "SideEffectDisclosure",
        "SandboxSimulateResponse",
        "SandboxStatusResponse",
        "DivergenceReportResponse",
        "CanaryRunResponse",
        "DatasetInfo",
        "ValidationResultResponse"
      ],
      "functions": [
        "get_memory_context",
        "apply_post_execution_updates",
        "detect_simulation_drift",
        "get_sandbox_status",
        "simulate_v2",
        "reset_circuit_breaker",
        "get_incidents",
        "get_divergence_report",
        "trigger_canary_run",
        "get_canary_reports",
        "list_datasets",
        "get_dataset_info",
        "validate_against_dataset",
        "validate_all"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/analytics/feedback.py",
      "relative_path": "app/houseofcards/api/customer/analytics/feedback.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Optional",
        "from uuid import UUID",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel",
        "from sqlalchemy import func, select",
        "from ..auth import verify_api_key",
        "from ..db import get_async_session",
        "from ..models.feedback import PatternFeedback",
        "from ..schemas.response import wrap_dict"
      ],
      "classes": [
        "FeedbackSummaryResponse",
        "FeedbackListResponse",
        "FeedbackDetailResponse"
      ],
      "functions": [
        "list_feedback",
        "get_feedback",
        "get_feedback_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/analytics/scenarios.py",
      "relative_path": "app/houseofcards/api/customer/analytics/scenarios.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "H2 Scenario-based cost simulation API (advisory only)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import uuid",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from ..auth.console_auth import verify_fops_token",
        "from ..schemas.response import wrap_dict"
      ],
      "classes": [
        "SimulationStepInput",
        "ScenarioCreate",
        "ScenarioModel",
        "ScenarioResponse",
        "StepEstimate",
        "SimulationResult",
        "AdhocSimulationRequest"
      ],
      "functions": [
        "_init_default_scenarios",
        "_simulate_plan",
        "list_scenarios",
        "create_scenario",
        "get_scenario",
        "delete_scenario",
        "simulate_scenario",
        "simulate_adhoc",
        "get_immutability_info"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/api_keys/auth_helpers.py",
      "relative_path": "app/houseofcards/api/customer/api_keys/auth_helpers.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import os",
        "from typing import Optional",
        "from fastapi import Header, HTTPException, status"
      ],
      "classes": [],
      "functions": [
        "verify_console_api_key"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/api_keys/embedding.py",
      "relative_path": "app/houseofcards/api/customer/api_keys/embedding.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Depends",
        "from pydantic import BaseModel",
        "from ..auth import verify_api_key",
        "from ..schemas.response import wrap_dict",
        "from ..memory.embedding_metrics import ("
      ],
      "classes": [
        "EmbeddingQuotaResponse",
        "EmbeddingConfigResponse",
        "IAECComposeRequest",
        "TemporalSignatureResponse",
        "PolicyEncodingResponse",
        "IAECComposeResponse",
        "IAECDecomposeRequest",
        "IAECDecomposeResponse",
        "IAECVerifyRequest",
        "IAECVerifyResponse"
      ],
      "functions": [
        "get_embedding_quota",
        "get_embedding_config",
        "embedding_health",
        "embedding_cache_stats",
        "clear_embedding_cache",
        "compose_embedding",
        "decompose_embedding",
        "get_iaec_instructions",
        "get_iaec_segment_info",
        "check_mismatch"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/general/health.py",
      "relative_path": "app/houseofcards/api/customer/general/health.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "INTERNAL",
        "role": "Health and determinism status endpoints - operational visibility",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Any, Dict",
        "from fastapi import APIRouter"
      ],
      "classes": [],
      "functions": [
        "update_replay_hash",
        "report_drift",
        "health_check",
        "readiness_check",
        "determinism_status",
        "adapter_status",
        "skills_status"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/general/sdk.py",
      "relative_path": "app/houseofcards/api/customer/general/sdk.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "SDK connection and registration endpoints",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Request, status",
        "from pydantic import BaseModel, Field",
        "from ..auth.gateway_middleware import get_auth_context",
        "from aos_sdk import AOS"
      ],
      "classes": [
        "HandshakeRequest",
        "HandshakeResponse",
        "InstructionsResponse"
      ],
      "functions": [
        "_maybe_advance_to_sdk_connected",
        "sdk_handshake",
        "get_sdk_instructions"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/general/debug_auth.py",
      "relative_path": "app/houseofcards/api/customer/general/debug_auth.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Debug endpoint for auth context visibility",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional",
        "from fastapi import APIRouter, Request",
        "from pydantic import BaseModel",
        "from app.schemas.response import wrap_dict",
        "from app.auth.contexts import ("
      ],
      "classes": [
        "AuthContextDebugResponse"
      ],
      "functions": [
        "_mask_value",
        "_get_tenant_state",
        "get_auth_context",
        "get_auth_planes",
        "get_tenant_states"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/general/agents.py",
      "relative_path": "app/houseofcards/api/customer/general/agents.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "INTERNAL",
        "role": "Multi-agent job execution API - worker coordination, SBA management",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "from fastapi import APIRouter, Header, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from ..agents.services.blackboard_service import get_blackboard_service",
        "from ..schemas.response import wrap_dict",
        "from ..agents.services.credit_service import CREDIT_COSTS, get_credit_service",
        "from ..agents.services.job_service import JobConfig, get_job_service",
        "from ..agents.services.message_service import get_message_service",
        "from ..agents.services.registry_service import get_registry_service",
        "from ..agents.services.worker_service import get_worker_service",
        "from ..agents.skills.agent_invoke import AgentInvokeSkill"
      ],
      "classes": [
        "CreateJobRequest",
        "JobResponse",
        "ClaimItemResponse",
        "CompleteItemRequest",
        "FailItemRequest",
        "BlackboardWriteRequest",
        "BlackboardIncrementRequest",
        "LockRequest",
        "RegisterAgentRequest",
        "SendMessageRequest",
        "InvokeResponseRequest",
        "SimulateJobRequest",
        "SimulateJobResponse",
        "SBAValidateRequest",
        "SBARegisterRequest",
        "SBAGenerateRequest",
        "WorkerCostMetrics",
        "ActivityCostsResponse",
        "SpendingDataResponse",
        "RetryEntryResponse",
        "ActivityRetriesResponse",
        "BlockerEntry",
        "ActivityBlockersResponse",
        "HealthCheckItem",
        "HealthCheckResponse",
        "CascadeEvaluateRequest",
        "RoutingDispatchRequest",
        "RoutingConfigUpdate",
        "ExplainRoutingResponse",
        "EvolutionReportResponse",
        "SystemStabilityResponse"
      ],
      "functions": [
        "simulate_job",
        "create_job",
        "get_job",
        "cancel_job",
        "claim_item",
        "complete_item",
        "fail_item",
        "get_blackboard",
        "put_blackboard",
        "increment_blackboard",
        "lock_blackboard",
        "register_agent",
        "agent_heartbeat",
        "deregister_agent",
        "get_agent",
        "list_agents",
        "send_message",
        "get_messages",
        "mark_message_read",
        "respond_to_invocation",
        "validate_sba_endpoint",
        "register_agent_with_sba",
        "generate_sba_for_agent",
        "get_sba_version_info",
        "negotiate_sba_version",
        "get_sba_health",
        "get_agent_sba",
        "list_agents_sba",
        "check_spawn_allowed",
        "get_fulfillment_aggregated",
        "get_agent_activity_costs",
        "get_agent_activity_spending",
        "get_agent_activity_retries",
        "get_agent_activity_blockers",
        "check_agent_health",
        "cascade_evaluate",
        "routing_dispatch",
        "get_agent_strategy",
        "update_agent_strategy",
        "get_routing_stats",
        "explain_routing_decision",
        "get_agent_evolution",
        "get_system_stability",
        "freeze_system",
        "unfreeze_system",
        "trigger_batch_learning",
        "get_agent_reputation",
        "get_agent_sla",
        "get_agent_successors"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/overview/overview.py",
      "relative_path": "app/houseofcards/api/customer/overview/overview.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Unified OVERVIEW domain facade - customer-only production API",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime",
        "from typing import Annotated, Any, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.services.overview_facade import get_overview_facade"
      ],
      "classes": [
        "DomainCount",
        "SystemPulse",
        "HighlightsResponse",
        "DecisionItem",
        "Pagination",
        "DecisionsResponse",
        "CostPeriod",
        "CostActuals",
        "LimitCostItem",
        "CostViolations",
        "CostsResponse",
        "DecisionsCountResponse",
        "RecoveryStatsResponse"
      ],
      "functions": [
        "require_preflight",
        "get_tenant_id_from_auth",
        "get_highlights",
        "get_decisions",
        "get_costs",
        "get_decisions_count",
        "get_recovery_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/logs/guard_logs.py",
      "relative_path": "app/houseofcards/api/customer/logs/guard_logs.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L2a \u2014 Boundary Adapter (Console-scoped, DEPRECATED)"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from fastapi.responses import StreamingResponse",
        "from app.adapters.customer_logs_adapter import (",
        "from app.auth.console_auth import verify_console_token",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [],
      "functions": [
        "list_logs",
        "export_logs",
        "get_log"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/logs/tenants.py",
      "relative_path": "app/houseofcards/api/customer/logs/tenants.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime",
        "from typing import List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, status",
        "from pydantic import BaseModel, Field",
        "from sqlmodel import Session",
        "from ..auth.tenant_auth import TenantContext, get_tenant_context",
        "from ..db import utc_now",
        "from ..services.tenant_service import (",
        "from ..schemas.response import wrap_dict, wrap_list",
        "from ..services.worker_registry_service import ("
      ],
      "classes": [
        "TenantResponse",
        "APIKeyCreateRequest",
        "APIKeyResponse",
        "APIKeyCreatedResponse",
        "AnalyticsProvenance",
        "UsageSummaryResponse",
        "WorkerSummaryResponse",
        "WorkerDetailResponse",
        "WorkerConfigRequest",
        "WorkerConfigResponse",
        "RunHistoryItem",
        "QuotaCheckResponse"
      ],
      "functions": [
        "get_db",
        "get_services",
        "_maybe_advance_to_api_key_created",
        "get_current_tenant",
        "get_tenant_usage",
        "check_run_quota",
        "check_token_quota",
        "list_api_keys",
        "create_api_key",
        "revoke_api_key",
        "list_workers",
        "list_available_workers_for_tenant",
        "get_worker_details",
        "get_worker_config",
        "set_worker_config",
        "list_runs",
        "tenant_health"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/logs/traces.py",
      "relative_path": "app/houseofcards/api/customer/logs/traces.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Trace storage, indexing, query, and determinism validation",
        "raw_layer_line": "# Layer: L2a \u2014 Internal/SDK API (NOT domain authority)"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request, Response, status",
        "from pydantic import BaseModel, Field",
        "from ..auth.jwt_auth import JWTAuthDependency, JWTConfig, TokenPayload",
        "from ..schemas.response import wrap_dict",
        "from ..traces.redact import redact_trace_data"
      ],
      "classes": [
        "User",
        "TraceSummaryResponse",
        "TraceStepResponse",
        "TraceDetailResponse",
        "TraceListResponse",
        "TraceCompareResponse",
        "StoreTraceRequest",
        "MismatchReport",
        "MismatchResponse"
      ],
      "functions": [
        "get_current_user",
        "require_role",
        "get_trace_store",
        "list_traces",
        "store_trace",
        "list_all_mismatches",
        "get_trace",
        "get_trace_by_hash",
        "compare_traces",
        "delete_trace",
        "cleanup_old_traces",
        "check_idempotency",
        "bulk_report_mismatches",
        "report_mismatch",
        "list_trace_mismatches",
        "resolve_mismatch"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/logs/cost_intelligence.py",
      "relative_path": "app/houseofcards/api/customer/logs/cost_intelligence.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from datetime import datetime, timedelta",
        "from typing import Any, List, Optional, cast",
        "from fastapi import APIRouter, Depends, HTTPException, Query",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import text",
        "from sqlmodel import Session, select",
        "from app.db import (",
        "from app.schemas.response import wrap_dict",
        "from app.services.cost_write_service import CostWriteService"
      ],
      "classes": [
        "FeatureTagCreate",
        "FeatureTagResponse",
        "FeatureTagUpdate",
        "CostRecordCreate",
        "CostProvenance",
        "CostSummary",
        "CostByFeature",
        "CostByUser",
        "CostByModel",
        "CostProjection",
        "CostAnomalyResponse",
        "AnalyticsProvenance",
        "CostByUserEnvelope",
        "CostByModelEnvelope",
        "CostByFeatureEnvelope",
        "CostAnomaliesEnvelope",
        "CostDashboard",
        "BudgetCreate",
        "BudgetResponse",
        "AnomalyDetectionRequest",
        "AnomalyDetectionResponse"
      ],
      "functions": [
        "get_tenant_id",
        "create_feature_tag",
        "list_feature_tags",
        "update_feature_tag",
        "record_cost",
        "get_cost_dashboard",
        "get_cost_summary",
        "get_costs_by_feature",
        "get_costs_by_user",
        "get_costs_by_model",
        "get_anomalies",
        "get_projection",
        "create_or_update_budget",
        "list_budgets",
        "_get_cost_summary",
        "_get_costs_by_feature",
        "_get_costs_by_user",
        "_get_costs_by_model",
        "_get_recent_anomalies",
        "_get_cost_projection",
        "_get_current_spend",
        "trigger_anomaly_detection"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/integrations/cus_telemetry.py",
      "relative_path": "app/houseofcards/api/customer/integrations/cus_telemetry.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Telemetry ingestion API for customer LLM usage",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import date, timedelta",
        "from typing import Optional",
        "from fastapi import APIRouter, Depends, Header, HTTPException, Query, Request",
        "from app.schemas.cus_schemas import (",
        "from app.schemas.response import wrap_dict, wrap_error, wrap_list",
        "from app.services.cus_telemetry_service import CusTelemetryService"
      ],
      "classes": [],
      "functions": [
        "get_telemetry_service",
        "get_integration_context",
        "ingest_llm_usage",
        "ingest_llm_usage_batch",
        "get_usage_summary",
        "get_usage_history",
        "get_daily_aggregates"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/integrations/protection_dependencies.py",
      "relative_path": "app/houseofcards/api/customer/integrations/protection_dependencies.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Phase-7 Protection FastAPI dependencies",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from fastapi import Request, HTTPException",
        "import logging",
        "from app.protection.decisions import (",
        "from app.protection.provider import get_protection_provider",
        "from app.auth.onboarding_state import OnboardingState"
      ],
      "classes": [
        "ProtectionContext"
      ],
      "functions": [
        "is_exempt_endpoint",
        "check_protection",
        "require_protection_allow",
        "emit_protection_event"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/integrations/session_context.py",
      "relative_path": "app/houseofcards/api/customer/integrations/session_context.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Session context endpoint for frontend auth state",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Optional",
        "from fastapi import APIRouter, Request, HTTPException",
        "from app.auth.contexts import (",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.auth.lifecycle_provider import get_lifecycle_provider",
        "from app.auth.onboarding_state import OnboardingState",
        "from app.schemas.response import wrap_dict"
      ],
      "classes": [],
      "functions": [
        "get_session_context",
        "_get_onboarding_state"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/incidents/cost_guard.py",
      "relative_path": "app/houseofcards/api/customer/incidents/cost_guard.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime, timedelta, timezone",
        "from typing import List, Literal, Optional",
        "from fastapi import APIRouter, Depends, Query",
        "from sqlalchemy import text",
        "from sqlmodel import Session",
        "from app.auth.console_auth import CustomerToken, verify_console_token",
        "from app.contracts.guard import (",
        "from app.db import get_session"
      ],
      "classes": [],
      "functions": [
        "_map_trend",
        "_map_severity_to_status",
        "_generate_summary",
        "get_cost_summary",
        "get_cost_explained",
        "get_cost_incidents"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/customer/incidents/incidents.py",
      "relative_path": "app/houseofcards/api/customer/incidents/incidents.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Unified INCIDENTS domain facade - customer-only production API",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Annotated, Any, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel",
        "from sqlalchemy import func, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.models.killswitch import Incident",
        "from app.schemas.response import wrap_dict",
        "from app.services.incidents_facade import get_incidents_facade"
      ],
      "classes": [
        "LifecycleState",
        "Severity",
        "CauseType",
        "Topic",
        "SortField",
        "SortOrder",
        "IncidentSummary",
        "Pagination",
        "IncidentListResponse",
        "IncidentDetailResponse",
        "IncidentsByRunResponse",
        "PatternMatchResponse",
        "PatternDetectionResponse",
        "RecurrenceGroupResponse",
        "RecurrenceAnalysisResponse",
        "CostImpactSummary",
        "CostImpactResponse",
        "IncidentMetricsResponse",
        "HistoricalTrendDataPoint",
        "HistoricalTrendResponse",
        "HistoricalDistributionEntry",
        "HistoricalDistributionResponse",
        "CostTrendDataPoint",
        "CostTrendResponse",
        "LearningInsightResponse",
        "ResolutionSummaryResponse",
        "LearningsResponse",
        "ExportFormat",
        "ExportRequest"
      ],
      "functions": [
        "require_preflight",
        "get_tenant_id_from_auth",
        "list_incidents",
        "get_incidents_for_run",
        "detect_patterns",
        "analyze_recurrence",
        "analyze_cost_impact",
        "list_active_incidents",
        "list_resolved_incidents",
        "list_historical_incidents",
        "get_incident_metrics",
        "get_historical_trend",
        "get_historical_distribution",
        "get_historical_cost_trend",
        "get_incident_detail",
        "get_incident_evidence",
        "get_incident_proof",
        "get_incident_learnings",
        "export_evidence",
        "export_soc2",
        "export_executive_debrief"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/internal/policies/billing_gate.py",
      "relative_path": "app/houseofcards/api/internal/policies/billing_gate.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Billing enforcement gate",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from fastapi import Request, HTTPException",
        "import logging",
        "from app.billing.state import BillingState",
        "from app.billing.plan import Plan",
        "from app.billing.limits import Limits",
        "from app.billing.provider import get_billing_provider",
        "from app.auth.onboarding_state import OnboardingState"
      ],
      "classes": [
        "BillingContext",
        "BillingGate"
      ],
      "functions": [
        "is_exempt_path",
        "check_billing",
        "require_billing_active",
        "check_billing_limit"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/internal/agent/main.py",
      "relative_path": "app/houseofcards/api/internal/agent/main.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "FastAPI application entry point, route registration, middleware setup",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "BackgroundTasks",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "return JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import json",
        "import os",
        "import uuid",
        "from contextlib import asynccontextmanager",
        "from datetime import datetime, timezone",
        "from typing import List, Optional",
        "from fastapi import BackgroundTasks, Depends, FastAPI, HTTPException, Request",
        "from fastapi.middleware.cors import CORSMiddleware",
        "from fastapi.responses import JSONResponse, PlainTextResponse",
        "from pydantic import BaseModel, Field",
        "from sqlmodel import Session, select",
        "from .auth import verify_api_key",
        "from .auth.rbac_middleware import RBACMiddleware",
        "from .contracts.decisions import backfill_run_id_for_request",
        "from .db import Agent, Memory, Provenance, Run, engine, init_db",
        "from .logging_config import log_provenance, log_request, setup_logging",
        "from .metrics import (",
        "from .middleware.tenant import TenantMiddleware",
        "from .models.logs_records import (",
        "from .planners import PlannerProtocol, get_planner",
        "from .skills import get_skill, get_skill_manifest, list_skills",
        "from .utils.budget_tracker import BudgetTracker, enforce_budget",
        "from .utils.concurrent_runs import ConcurrentRunsLimiter",
        "from .utils.idempotency import check_idempotency",
        "from .utils.input_sanitizer import sanitize_goal",
        "from .utils.rate_limiter import RateLimiter",
        "import time as _openapi_time",
        "from fastapi.openapi.utils import get_openapi as _fastapi_get_openapi",
        "from .api.aos_accounts import router as accounts_router  # ACCOUNTS: Unified facade (/api/v1/accounts/*)",
        "from .api.activity import router as activity_router  # ACTIVITY Domain: Unified facade (/api/v1/activity/*)",
        "from .api.analytics import router as analytics_router  # ANALYTICS Domain: Unified facade (/api/v1/analytics/*)",
        "from .api.agents import router as agents_router  # M12 Multi-Agent System",
        "from .api.authz_status import router as authz_status_router  # T5: Internal authz status",
        "from .api.aos_cus_integrations import router as aos_cus_integrations_router  # CONNECTIVITY: Customer LLM Integrations BYOK (/api/v1/integrations/*)",
        "from .api.aos_api_key import router as aos_api_key_router  # CONNECTIVITY: API Keys facade (/api/v1/api-keys/*)",
        "from .api.cus_telemetry import router as cus_telemetry_router  # Customer LLM telemetry ingestion",
        "from .api.cus_enforcement import router as cus_enforcement_router  # Customer LLM enforcement checks",
        "from .api.cost_guard import router as cost_guard_router  # /guard/costs/* - Customer cost visibility",
        "from .api.cost_intelligence import router as cost_intelligence_router",
        "from .api.cost_ops import router as cost_ops_router  # /ops/cost/* - Founder cost visibility",
        "from .api.costsim import router as costsim_router",
        "from .api.customer_visibility import router as customer_visibility_router  # Phase 4C-2 Customer Visibility",
        "from .api.embedding import router as embedding_router  # PIN-047 Embedding Quota API",
        "from .api.founder_actions import router as founder_actions_router  # /ops/actions/* - Founder actions",
        "from .api.founder_contract_review import (",
        "from .api.founder_explorer import router as explorer_router  # H3 Founder Explorer (cross-tenant READ-ONLY)",
        "from .api.founder_onboarding import router as founder_onboarding_router",
        "from .api.founder_review import router as founder_review_router  # /founder/review/* - Evidence review",
        "from .api.founder_timeline import router as founder_timeline_router  # Phase 4C-1 Founder Timeline",
        "from .api.guard import router as guard_router  # Customer Console (/guard/*)",
        "from .api.guard_logs import router as guard_logs_router  # PIN-281: Customer Logs (/guard/logs/*)",
        "from .api.guard_policies import router as guard_policies_router  # PIN-281: Customer Policies (/guard/policies/*)",
        "from .api.health import router as health_router",
        "from .api.incidents import router as incidents_router  # INCIDENTS Domain: Unified facade (/api/v1/incidents/*)",
        "from .api.M25_integrations import router as m25_integration_router  # M25 Pillar Integration Loop (INTERNAL)",
        "from .api.legacy_routes import router as legacy_routes_router  # 410 Gone for deprecated paths",
        "from .api.logs import router as logs_router  # LOGS Domain: Unified facade (/api/v1/logs/*)",
        "from .api.memory_pins import router as memory_pins_router",
        "from .api.onboarding import router as onboarding_router  # M24 Customer Onboarding",
        "from .api.ops import router as ops_router  # M24 Ops Console (founder intelligence)",
        "from .api.overview import router as overview_router  # OVERVIEW Domain: Unified facade (/api/v1/overview/*)",
        "from .api.platform import router as platform_router  # PIN-284 Platform Health (founder-only)",
        "from .api.policies import router as policies_router  # POLICIES Domain: Unified facade (/api/v1/policies/*)",
        "from .api.policy import router as policy_router",
        "from .api.policy_layer import router as policy_layer_router  # M19 Policy Layer",
        "from .api.policy_limits_crud import router as policy_limits_crud_router  # PIN-LIM-01: Policy limits CRUD",
        "from .api.policy_rules_crud import router as policy_rules_crud_router  # PIN-LIM-02: Policy rules CRUD",
        "from .api.limits.simulate import router as limits_simulate_router  # PIN-LIM-04: Limit simulation",
        "from .api.limits.override import router as limits_override_router  # PIN-LIM-05: Limit overrides",
        "from .api.rbac_api import router as rbac_router",
        "from .api.recovery import router as recovery_router",
        "from .api.recovery_ingest import router as recovery_ingest_router",
        "from .api.replay import router as replay_router  # H1 Replay UX (READ-ONLY slice/timeline)",
        "from .api.runtime import router as runtime_router",
        "from .api.scenarios import router as scenarios_router  # H2 Scenario-based Cost Simulation (advisory)",
        "from .api.sdk import router as sdk_router",
        "from .api.session_context import router as session_context_router",
        "from .api.debug_auth import router as debug_auth_router",
        "from .api.status_history import router as status_history_router",
        "from .api.tenants import router as tenants_router  # M21 - RE-ENABLED: PIN-399 Onboarding State Machine",
        "from .api.traces import router as traces_router",
        "from .api.v1_killswitch import router as v1_killswitch_router  # Kill switch, incidents, replay",
        "from .api.v1_proxy import router as v1_proxy_router  # Drop-in OpenAI replacement",
        "from .api.workers import router as workers_router  # Business Builder Worker v0.2",
        "from .predictions.api import router as c2_predictions_router  # C2 Predictions (advisory only)",
        "from .api.retrieval import router as retrieval_router  # RETRIEVAL: /api/v1/retrieval/* (GAP-094)",
        "from .api.detection import router as detection_router  # DETECTION: /api/v1/detection/* (GAP-102)",
        "from .api.compliance import router as compliance_router  # COMPLIANCE: /api/v1/compliance/* (GAP-103)",
        "from .api.evidence import router as evidence_router  # EVIDENCE: /api/v1/evidence/* (GAP-104, GAP-105)",
        "from .api.notifications import router as notifications_router  # NOTIFICATIONS: /api/v1/notifications/* (GAP-109)",
        "from .api.alerts import router as alerts_router  # ALERTS: /api/v1/alerts/* (GAP-110, GAP-111, GAP-124)",
        "from .api.scheduler import router as scheduler_router  # SCHEDULER: /api/v1/scheduler/* (GAP-112)",
        "from .api.datasources import router as datasources_router  # DATASOURCES: /api/v1/datasources/* (GAP-113)",
        "from .api.monitors import router as monitors_router  # MONITORS: /api/v1/monitors/* (GAP-120, GAP-121)",
        "from .api.rate_limits import router as rate_limits_router  # RATE_LIMITS: /api/v1/rate-limits/* (GAP-122)",
        "from .api.controls import router as controls_router  # CONTROLS: /api/v1/controls/* (GAP-123)",
        "from .api.lifecycle import router as lifecycle_router  # LIFECYCLE: /api/v1/lifecycle/* (GAP-131-136)",
        "from .api.feedback import router as feedback_router  # PB-S3 pattern_feedback",
        "from .api.policy_proposals import router as policy_proposals_router  # PB-S4 policy_proposals",
        "from .api.predictions import router as predictions_router  # PB-S5 prediction_events",
        "from .api.discovery import router as discovery_router",
        "from .auth.gateway_config import AUTH_GATEWAY_ENABLED, setup_auth_middleware",
        "from .auth.onboarding_gate import OnboardingGateMiddleware"
      ],
      "classes": [
        "CreateAgentRequest",
        "CreateAgentResponse",
        "GoalRequest",
        "GoalResponse",
        "RunResponse",
        "MemoryResponse",
        "ProvenanceResponse",
        "RetryRequest",
        "RetryResponse",
        "RerunRequest",
        "RerunResponse"
      ],
      "functions": [
        "_create_system_record",
        "update_queue_depth",
        "reactivate_deferred_lessons",
        "run_panel_invariant_checks",
        "validate_route_order",
        "lifespan",
        "custom_openapi",
        "openapi_nocache",
        "openapi_inspect",
        "add_request_id",
        "execute_run",
        "_execute_run_inner",
        "health_check",
        "version",
        "healthz",
        "download_openapi",
        "worker_pool_health",
        "metrics",
        "get_skills",
        "create_agent",
        "get_agent",
        "post_goal",
        "get_run",
        "list_runs",
        "recall_memory",
        "get_provenance",
        "get_provenance_by_id",
        "retry_failed_run",
        "rerun_failed_run",
        "list_failed_runs"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/internal/account/aos_cli.py",
      "relative_path": "app/houseofcards/api/internal/account/aos_cli.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L7",
        "audience": null,
        "role": "Backend CLI utilities",
        "raw_layer_line": "# Layer: L7 \u2014 Ops & Deployment"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "time\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import argparse",
        "import asyncio",
        "import json",
        "import sys",
        "import time",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from app.observability.cost_tracker import get_cost_tracker",
        "from app.skills import list_skills, load_all_skills"
      ],
      "classes": [],
      "functions": [
        "_get_db_imports",
        "_get_logger",
        "create_agent",
        "list_agents",
        "get_run",
        "create_run",
        "execute_run_sync",
        "run_goal",
        "show_skills",
        "run_demo",
        "main"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/internal/general/founder_auth.py",
      "relative_path": "app/houseofcards/api/internal/general/founder_auth.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Founder (FOPS) authentication dependency",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from fastapi import Depends, HTTPException, Request, status",
        "from app.auth.contexts import FounderAuthContext",
        "from app.auth.gateway_middleware import get_auth_context"
      ],
      "classes": [],
      "functions": [
        "verify_fops_token"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/api/internal/general/protection_gate.py",
      "relative_path": "app/houseofcards/api/internal/general/protection_gate.py",
      "folder_layer": "L2",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Protection enforcement gate",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from fastapi import Request, HTTPException",
        "import logging",
        "from app.protection.decisions import Decision, ProtectionResult, AnomalySignal",
        "from app.protection.provider import get_protection_provider"
      ],
      "classes": [
        "ProtectionContext",
        "ProtectionGate"
      ],
      "functions": [
        "is_exempt_path",
        "check_protection",
        "require_protection_allow"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/platform/drivers/external_response_service.py",
      "relative_path": "app/houseofcards/customer/platform/drivers/external_response_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "External response persistence and interpretation service",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from uuid import UUID",
        "from sqlalchemy import and_, select, update",
        "from sqlalchemy.orm import Session",
        "from app.models.external_response import ("
      ],
      "classes": [
        "ExternalResponseService"
      ],
      "functions": [
        "record_external_response",
        "interpret_response",
        "get_interpreted_response"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/platform/drivers/sandbox_executor.py",
      "relative_path": "app/houseofcards/customer/platform/drivers/sandbox_executor.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Low-level sandbox execution with process isolation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "import os",
        "import resource",
        "import shutil",
        "import tempfile",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "IsolationLevel",
        "SandboxStatus",
        "NetworkPolicy",
        "ResourceLimits",
        "ExecutionResult",
        "SandboxExecutor",
        "ProcessSandboxExecutor",
        "ContainerSandboxExecutor"
      ],
      "functions": [
        "create_sandbox_executor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/platform/drivers/job_scheduler.py",
      "relative_path": "app/houseofcards/customer/platform/drivers/job_scheduler.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Optional",
        "import hashlib",
        "import re",
        "import uuid"
      ],
      "classes": [
        "JobScheduleType",
        "JobStatus",
        "JobPriority",
        "JobSchedule",
        "ScheduledJob",
        "SchedulerStats",
        "JobSchedulerError",
        "JobScheduler"
      ],
      "functions": [
        "get_job_scheduler",
        "_reset_scheduler",
        "schedule_job",
        "get_job",
        "list_jobs",
        "cancel_job",
        "get_scheduler_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/platform/drivers/executor.py",
      "relative_path": "app/houseofcards/customer/platform/drivers/executor.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Bind JobScheduler to APScheduler for actual execution",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Callable, Dict, List, Optional"
      ],
      "classes": [
        "ExecutorConfig",
        "APSchedulerExecutor"
      ],
      "functions": [
        "get_scheduler_executor",
        "configure_scheduler_executor",
        "reset_scheduler_executor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/platform/facades/platform_eligibility_adapter.py",
      "relative_path": "app/houseofcards/customer/platform/facades/platform_eligibility_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Translate L4 PlatformHealthService outputs to API-friendly views",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from typing import Dict, List, Optional",
        "from app.services.platform.platform_health_service import ("
      ],
      "classes": [
        "HealthReasonView",
        "CapabilityHealthView",
        "DomainHealthView",
        "SystemHealthView",
        "CapabilityEligibilityView",
        "PlatformEligibilityResponse",
        "PlatformEligibilityAdapter"
      ],
      "functions": [
        "get_platform_eligibility_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/platform/engines/pool_manager.py",
      "relative_path": "app/houseofcards/customer/platform/engines/pool_manager.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Unified connection pool manager with health checking",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, Optional"
      ],
      "classes": [
        "PoolType",
        "PoolStatus",
        "PoolConfig",
        "PoolStats",
        "PoolHandle",
        "ConnectionPoolManager"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/platform/engines/platform_health_service.py",
      "relative_path": "app/houseofcards/customer/platform/engines/platform_health_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Platform Health Authority - THE source of truth for platform state",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Optional",
        "from sqlalchemy import and_, func, or_, select",
        "from sqlmodel import Session",
        "from app.models.governance import GovernanceSignal",
        "from app.models.killswitch import Incident"
      ],
      "classes": [
        "HealthState",
        "SignalType",
        "HealthReason",
        "CapabilityHealth",
        "DomainHealth",
        "SystemHealth",
        "PlatformHealthService"
      ],
      "functions": [
        "get_platform_health_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/ops/schemas/ops.py",
      "relative_path": "app/houseofcards/customer/ops/schemas/ops.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Ops contract definitions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Literal, Optional",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "SystemPulseDTO",
        "CustomerSegmentDTO",
        "CustomerAtRiskDTO",
        "CustomerListDTO",
        "IncidentPatternDTO",
        "FounderIncidentHeaderDTO",
        "FounderDecisionTimelineEventDTO",
        "FounderRootCauseDTO",
        "FounderBlastRadiusDTO",
        "FounderRecurrenceRiskDTO",
        "FounderIncidentDetailDTO",
        "FounderIncidentListItemDTO",
        "FounderIncidentListDTO",
        "StickinessByFeatureDTO",
        "RevenueRiskDTO",
        "InfraLimitsDTO",
        "PlaybookActionDTO",
        "PlaybookDTO",
        "OpsEventDTO",
        "OpsEventListDTO",
        "OpsJobResultDTO",
        "FounderCostOverviewDTO",
        "FounderCostAnomalyDTO",
        "FounderCostAnomalyListDTO",
        "FounderCostTenantDTO",
        "FounderCostTenantListDTO",
        "CostDailyBreakdownDTO",
        "CostByFeatureDTO",
        "CostByUserDTO",
        "CostByModelDTO",
        "CustomerAnomalyHistoryDTO",
        "FounderCustomerCostDrilldownDTO",
        "FounderActionTargetDTO",
        "FounderActionReasonDTO",
        "FounderActionRequestDTO",
        "FounderActionResponseDTO",
        "FounderAuditRecordDTO",
        "FounderReversalRequestDTO",
        "FounderActionSummaryDTO",
        "FounderActionListDTO",
        "AutoExecuteReviewItemDTO",
        "AutoExecuteReviewListDTO",
        "AutoExecuteReviewFilterDTO",
        "AutoExecuteReviewStatsDTO"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/ir_compiler.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/ir_compiler.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy DSL IR Compiler (AST \u2192 bytecode)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any",
        "from app.dsl.ast import ("
      ],
      "classes": [
        "OpCode",
        "Instruction",
        "CompiledClause",
        "PolicyIR",
        "IRCompiler",
        "OptimizingIRCompiler"
      ],
      "functions": [
        "compile_policy",
        "ir_hash"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/governance_signal_service.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/governance_signal_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Governance signal persistence service",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlalchemy import and_, or_, select, update",
        "from sqlalchemy.orm import Session",
        "from app.models.governance import ("
      ],
      "classes": [
        "GovernanceSignalService"
      ],
      "functions": [
        "check_governance_status",
        "is_governance_blocked",
        "record_governance_signal"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/alert_emitter.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/alert_emitter.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Emit alerts for near-threshold and breach events",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "import httpx",
        "from sqlmodel import Session, select",
        "from app.db import engine",
        "from app.models.alert_config import AlertChannel, AlertConfig",
        "from app.models.threshold_signal import SignalType, ThresholdSignal"
      ],
      "classes": [
        "AlertEmitter"
      ],
      "functions": [
        "get_alert_emitter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/arbitrator.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/arbitrator.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Resolve conflicts between multiple applicable policies",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlmodel import Session, select",
        "from app.db import engine",
        "from app.models.policy_precedence import ("
      ],
      "classes": [
        "PolicyLimit",
        "PolicyAction",
        "ArbitrationInput",
        "PolicyArbitrator"
      ],
      "functions": [
        "get_policy_arbitrator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/llm_threshold_service.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/llm_threshold_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "LLM run threshold resolution and evaluation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Optional",
        "from pydantic import BaseModel, Field, field_validator",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from sqlmodel import select",
        "from app.models.policy_control_plane import Limit, LimitCategory, LimitStatus"
      ],
      "classes": [
        "ThresholdParams",
        "ThresholdParamsUpdate",
        "ThresholdSignal",
        "ThresholdEvaluationResult",
        "LLMRunThresholdResolver",
        "LLMRunEvaluator",
        "LLMRunThresholdResolverSync",
        "LLMRunEvaluatorSync",
        "ThresholdSignalRecord"
      ],
      "functions": [
        "create_threshold_signal_record",
        "collect_signals_from_evaluation",
        "emit_threshold_signal_sync",
        "emit_and_persist_threshold_signal"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/grammar.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/grammar.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy language grammar definitions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from enum import Enum, auto",
        "from typing import Dict, List, Set"
      ],
      "classes": [
        "GrammarNodeType",
        "PolicyCategory",
        "ActionType",
        "GrammarProduction",
        "PLangGrammar"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/fatigue_controller.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/fatigue_controller.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "import hashlib",
        "import json"
      ],
      "classes": [
        "AlertFatigueMode",
        "AlertFatigueAction",
        "AlertFatigueConfig",
        "AlertFatigueState",
        "AlertFatigueStats",
        "AlertFatigueError",
        "FatigueCheckResult",
        "AlertFatigueController"
      ],
      "functions": [
        "get_alert_fatigue_controller",
        "_reset_controller",
        "check_alert_fatigue",
        "suppress_alert",
        "get_fatigue_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/snapshot_service.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/snapshot_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, List, Optional",
        "import hashlib",
        "import json",
        "import uuid"
      ],
      "classes": [
        "SnapshotStatus",
        "ImmutabilityViolation",
        "PolicySnapshotData",
        "PolicySnapshotError",
        "SnapshotRegistryStats",
        "PolicySnapshotRegistry"
      ],
      "functions": [
        "get_snapshot_registry",
        "_reset_snapshot_registry",
        "create_policy_snapshot",
        "get_policy_snapshot",
        "get_active_snapshot",
        "get_snapshot_history",
        "verify_snapshot"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/plan.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/plan.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Phase-6 Plan model (abstract, no DB persistence)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Optional"
      ],
      "classes": [
        "PlanTier",
        "Plan"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/profile.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/profile.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Governance Profile configuration and validation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Dict, FrozenSet, List, Optional, Tuple"
      ],
      "classes": [
        "GovernanceProfile",
        "GovernanceConfig",
        "GovernanceConfigError"
      ],
      "functions": [
        "_get_bool_env",
        "get_governance_profile",
        "load_governance_config",
        "validate_governance_config",
        "get_governance_config",
        "reset_governance_config",
        "validate_governance_at_startup"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/logs_read_service.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/logs_read_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Logs/Traces domain read operations (L4)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from typing import List, Optional",
        "from app.traces.models import TraceRecord, TraceSummary",
        "from app.traces.pg_store import PostgresTraceStore, get_postgres_trace_store"
      ],
      "classes": [
        "LogsReadService"
      ],
      "functions": [
        "get_logs_read_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/recovery_matcher.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/recovery_matcher.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import hashlib",
        "import logging",
        "import math",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from app.security.sanitize import sanitize_error_message"
      ],
      "classes": [
        "MatchResult",
        "RecoveryMatcher"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/cross_domain.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/cross_domain.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Cross-Domain Governance - Mandatory data integrity functions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import uuid",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import Optional, Union",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from sqlmodel import Session",
        "from app.errors.governance import GovernanceError",
        "from app.metrics import (",
        "from app.models.killswitch import Incident",
        "from app.models.policy_control_plane import LimitBreach"
      ],
      "classes": [],
      "functions": [
        "utc_now",
        "generate_uuid",
        "create_incident_from_cost_anomaly",
        "record_limit_breach",
        "table_exists",
        "create_incident_from_cost_anomaly_sync",
        "record_limit_breach_sync"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/orphan_recovery.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/orphan_recovery.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Orphan detection logic, PB-S2 truth guarantee",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import logging",
        "import os",
        "from datetime import datetime, timedelta",
        "from typing import Optional",
        "from sqlalchemy import select, update",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import get_async_session",
        "from app.models.tenant import WorkerRun"
      ],
      "classes": [],
      "functions": [
        "detect_orphaned_runs",
        "mark_run_as_crashed",
        "recover_orphaned_runs",
        "get_crash_recovery_summary"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/transaction_coordinator.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/transaction_coordinator.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Transaction Coordinator for atomic cross-domain writes",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional",
        "from uuid import UUID",
        "from sqlmodel import Session",
        "from app.db import engine",
        "from app.events import get_publisher",
        "from app.services.audit import ("
      ],
      "classes": [
        "TransactionPhase",
        "TransactionFailed",
        "DomainResult",
        "TransactionResult",
        "RollbackAction",
        "RunCompletionTransaction"
      ],
      "functions": [
        "get_transaction_coordinator",
        "create_transaction_coordinator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/tokenizer.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/tokenizer.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy language tokenizer",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum, auto",
        "from typing import Iterator, List, Optional"
      ],
      "classes": [
        "TokenType",
        "Token",
        "TokenizerError",
        "Tokenizer"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/ir_nodes.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/ir_nodes.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy IR node definitions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from enum import Enum, auto",
        "from typing import Any, Dict, List, Optional",
        "from app.policy.compiler.grammar import ActionType, PolicyCategory"
      ],
      "classes": [
        "IRType",
        "IRGovernance",
        "IRNode",
        "IRInstruction",
        "IRLoadConst",
        "IRLoadVar",
        "IRStoreVar",
        "IRBinaryOp",
        "IRUnaryOp",
        "IRCompare",
        "IRJump",
        "IRJumpIf",
        "IRCall",
        "IRReturn",
        "IRAction",
        "IRCheckPolicy",
        "IREmitIntent",
        "IRBlock",
        "IRFunction",
        "IRModule"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/capture.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/capture.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Taxonomy evidence capture service (ctx-aware)",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from uuid import uuid4",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import SQLAlchemyError",
        "from app.core.execution_context import ExecutionContext"
      ],
      "classes": [
        "EvidenceContextError",
        "CaptureFailureReason",
        "FailureResolution"
      ],
      "functions": [
        "_assert_context_exists",
        "_record_capture_failure",
        "_get_connection",
        "_hash_content",
        "capture_environment_evidence",
        "capture_activity_evidence",
        "capture_provider_evidence",
        "capture_policy_decision_evidence",
        "compute_integrity",
        "capture_integrity_evidence",
        "hash_prompt"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/limits.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/limits.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Phase-6 Limits derivation (code only, not stored)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Optional"
      ],
      "classes": [
        "Limits"
      ],
      "functions": [
        "derive_limits"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/dag_executor.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/dag_executor.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "DAG-based parallel policy executor",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional",
        "from app.policy.compiler.grammar import ActionType",
        "from app.policy.ir.ir_nodes import IRModule",
        "from app.policy.optimizer.dag_sorter import DAGSorter, ExecutionPlan",
        "from app.policy.runtime.deterministic_engine import (",
        "from app.policy.runtime.intent import Intent"
      ],
      "classes": [
        "StageResult",
        "ExecutionTrace",
        "DAGExecutor"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/nodes.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/nodes.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy AST node definitions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from typing import Any, List, Optional",
        "from app.policy.compiler.grammar import ActionType, PolicyCategory"
      ],
      "classes": [
        "GovernanceMetadata",
        "ASTNode",
        "ExprNode",
        "ProgramNode",
        "PolicyDeclNode",
        "RuleDeclNode",
        "ImportNode",
        "RuleRefNode",
        "PriorityNode",
        "ConditionBlockNode",
        "ActionBlockNode",
        "RouteTargetNode",
        "BinaryOpNode",
        "UnaryOpNode",
        "ValueNode",
        "IdentNode",
        "LiteralNode",
        "FuncCallNode",
        "AttrAccessNode",
        "ASTVisitor"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/authority_checker.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/authority_checker.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Check override authority before policy enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "OverrideStatus",
        "OverrideCheckResult",
        "OverrideAuthorityChecker"
      ],
      "functions": [
        "should_skip_enforcement"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/folds.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/folds.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy constant folding optimizations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional, Set",
        "from app.policy.ir.ir_nodes import ("
      ],
      "classes": [
        "FoldResult",
        "ConstantFolder",
        "DeadCodeEliminator",
        "PolicySimplifier"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/audit_evidence.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/audit_evidence.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Emit compliance-grade audit for MCP tool calls",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "MCPAuditEventType",
        "MCPAuditEvent",
        "MCPAuditEmitter"
      ],
      "functions": [
        "_hash_value",
        "_contains_sensitive",
        "_redact_sensitive",
        "get_mcp_audit_emitter",
        "configure_mcp_audit_emitter",
        "reset_mcp_audit_emitter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/policy_read_driver.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/policy_read_driver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Data access for customer policy read operations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import List, Optional",
        "from pydantic import BaseModel",
        "from sqlalchemy import and_, func, select",
        "from sqlmodel import Session",
        "from app.models.killswitch import DefaultGuardrail, ProxyCall",
        "from app.models.tenant import Tenant"
      ],
      "classes": [
        "TenantBudgetDataDTO",
        "UsageSumDTO",
        "GuardrailDTO",
        "PolicyReadDriver"
      ],
      "functions": [
        "get_policy_read_driver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/hallucination_detector.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/hallucination_detector.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Detect potential hallucinations in LLM outputs (non-blocking)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import re",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "HallucinationType",
        "HallucinationSeverity",
        "HallucinationIndicator",
        "HallucinationResult",
        "HallucinationConfig",
        "HallucinationDetector"
      ],
      "functions": [
        "create_detector_for_tenant"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/recovery_write_service.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/recovery_write_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for Recovery APIs (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "from typing import Any, Dict, Optional, Tuple",
        "from sqlalchemy import text",
        "from sqlmodel import Session"
      ],
      "classes": [
        "RecoveryWriteService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/kill_switch.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/kill_switch.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Runtime kill switch for governance bypass",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from threading import Lock",
        "from typing import Optional"
      ],
      "classes": [
        "KillSwitchStatus",
        "KillSwitchActivation",
        "KillSwitchDeactivation"
      ],
      "functions": [
        "activate_kill_switch",
        "deactivate_kill_switch",
        "is_kill_switch_active",
        "should_bypass_governance"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/llm_policy_engine.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/llm_policy_engine.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "LLM policy and safety limits enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import threading",
        "import time",
        "from collections import deque",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "SafetyCheckResult",
        "LLMRateLimiter"
      ],
      "functions": [
        "estimate_tokens",
        "estimate_cost_cents",
        "check_safety_limits",
        "is_model_allowed",
        "is_expensive_model",
        "get_model_for_task",
        "get_effective_model"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/content_accuracy.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/content_accuracy.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy content accuracy validation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import re",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "AssertionType",
        "ValidationResult",
        "AssertionCheck",
        "ContentAccuracyResult",
        "ContentAccuracyValidator"
      ],
      "functions": [
        "validate_content_accuracy"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/symbol_table.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/symbol_table.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy symbol table management",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from enum import Enum, auto",
        "from typing import Any, Dict, List, Optional",
        "from app.policy.compiler.grammar import PolicyCategory"
      ],
      "classes": [
        "SymbolType",
        "Symbol",
        "Scope",
        "SymbolTable"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/optimizer_conflict_resolver.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/optimizer_conflict_resolver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy conflict resolution",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum, auto",
        "from typing import Dict, List, Optional, Set, Tuple",
        "from app.policy.compiler.grammar import PLANG_GRAMMAR, ActionType, PolicyCategory",
        "from app.policy.ir.ir_nodes import ("
      ],
      "classes": [
        "ConflictType",
        "PolicyConflict",
        "ConflictResolver"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/policy_driver.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/policy_driver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": "INTERNAL",
        "role": "Policy Domain Driver - Internal orchestration for policy operations",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "PolicyDriver"
      ],
      "functions": [
        "get_policy_driver",
        "reset_policy_driver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/degraded_mode.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/degraded_mode.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Degraded mode for governance system",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from threading import Lock",
        "from typing import Optional"
      ],
      "classes": [
        "DegradedModeStatus",
        "DegradedModeTransition"
      ],
      "functions": [
        "enter_degraded_mode",
        "exit_degraded_mode",
        "is_degraded_mode_active",
        "get_degraded_mode_status",
        "should_allow_new_run",
        "get_existing_run_action"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/validator.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/validator.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy DSL semantic validator",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Callable",
        "from app.dsl.ast import ("
      ],
      "classes": [
        "Severity",
        "ValidationIssue",
        "ValidationResult",
        "PolicyValidator"
      ],
      "functions": [
        "validate",
        "is_valid"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/interpreter.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/interpreter.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy DSL Interpreter (pure IR evaluation)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from dataclasses import dataclass, field",
        "from typing import Any",
        "from app.dsl.ir_compiler import ("
      ],
      "classes": [
        "EvaluationError",
        "TypeMismatchError",
        "MissingMetricError",
        "ActionResult",
        "ClauseResult",
        "EvaluationResult",
        "Interpreter",
        "_LenientInterpreter",
        "_MissingSentinel"
      ],
      "functions": [
        "evaluate",
        "evaluate_policy"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/dag_sorter.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/dag_sorter.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy DAG topological sorting",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from enum import Enum, auto",
        "from typing import Any, Dict, List, Optional, Set, Tuple",
        "from app.policy.compiler.grammar import PolicyCategory",
        "from app.policy.ir.ir_nodes import IRFunction, IRGovernance, IRModule"
      ],
      "classes": [
        "ExecutionPhase",
        "ExecutionNode",
        "ExecutionDAG",
        "ExecutionPlan",
        "DAGSorter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/policy_conflict_resolver.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/policy_conflict_resolver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Resolve conflicts when multiple policies trigger different actions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from enum import Enum, IntEnum",
        "from dataclasses import dataclass",
        "from typing import List, Optional",
        "from datetime import datetime, timezone",
        "import logging"
      ],
      "classes": [
        "ActionSeverity",
        "ConflictResolutionStrategy",
        "PolicyAction",
        "ResolvedAction",
        "PolicyConflictLog"
      ],
      "functions": [
        "resolve_policy_conflict",
        "create_conflict_log",
        "get_action_severity",
        "is_more_restrictive"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/scope_resolver.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/scope_resolver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Resolve which policies apply to a given run context",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from sqlmodel import Session, select",
        "from app.db import engine",
        "from app.models.policy_scope import PolicyScope, ScopeType"
      ],
      "classes": [
        "RunContext",
        "ScopeResolutionResult",
        "ScopeResolver"
      ],
      "functions": [
        "get_scope_resolver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/ast.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/ast.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy DSL AST node definitions (immutable, typed)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Literal, Union"
      ],
      "classes": [
        "Scope",
        "Mode",
        "Comparator",
        "LogicalOperator",
        "WarnAction",
        "BlockAction",
        "RequireApprovalAction",
        "Predicate",
        "ExistsPredicate",
        "LogicalCondition",
        "Clause",
        "PolicyMetadata",
        "PolicyAST"
      ],
      "functions": [
        "is_predicate",
        "is_exists_predicate",
        "is_logical_condition",
        "is_warn_action",
        "is_block_action",
        "is_require_approval_action"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/dsl_parser.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/dsl_parser.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy DSL text parser (DSL \u2192 AST)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import re",
        "from dataclasses import dataclass",
        "from typing import Any",
        "from app.dsl.ast import ("
      ],
      "classes": [
        "ParseLocation",
        "ParseError",
        "Token",
        "Lexer",
        "Parser"
      ],
      "functions": [
        "parse",
        "parse_condition"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/state.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/state.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Phase-6 Billing State enum",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from enum import Enum"
      ],
      "classes": [
        "BillingState"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/drivers/runtime_command.py",
      "relative_path": "app/houseofcards/customer/policies/drivers/runtime_command.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Runtime domain commands and query logic",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "QueryResult",
        "SkillInfo",
        "ResourceContractInfo",
        "CapabilitiesInfo"
      ],
      "functions": [
        "get_supported_query_types",
        "query_remaining_budget",
        "query_execution_history",
        "query_allowed_skills",
        "query_last_step_outcome",
        "query_skills_for_goal",
        "execute_query",
        "get_skill_info",
        "list_skills",
        "get_all_skill_descriptors",
        "get_resource_contract",
        "get_capabilities"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/facades/run_governance_facade.py",
      "relative_path": "app/houseofcards/customer/policies/facades/run_governance_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": "CUSTOMER",
        "role": "Run Governance Facade - Centralized access to governance operations for runs",
        "raw_layer_line": "# Layer: L3 \u2014 Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "RunGovernanceFacade"
      ],
      "functions": [
        "get_run_governance_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/facades/governance_facade.py",
      "relative_path": "app/houseofcards/customer/policies/facades/governance_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Governance Facade - Centralized access to governance control operations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "GovernanceMode",
        "GovernanceStateResult",
        "KillSwitchResult",
        "ConflictResolutionResult",
        "BootStatusResult",
        "GovernanceFacade"
      ],
      "functions": [
        "get_governance_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/facades/policies_facade.py",
      "relative_path": "app/houseofcards/customer/policies/facades/policies_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Policies domain facade - unified entry point for policy management operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta",
        "from decimal import Decimal",
        "from typing import Any, Optional",
        "from sqlalchemy import and_, func, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.houseofcards.customer.general.utils.time import utc_now",
        "from app.models.policy_control_plane import ("
      ],
      "classes": [
        "PolicyRuleSummaryResult",
        "PolicyRulesListResult",
        "PolicyRuleDetailResult",
        "LimitSummaryResult",
        "LimitsListResult",
        "LimitDetailResult",
        "PolicyStateResult",
        "PolicyMetricsResult",
        "PolicyConflictResult",
        "ConflictsListResult",
        "PolicyDependencyRelation",
        "PolicyNodeResult",
        "PolicyDependencyEdge",
        "DependencyGraphResult",
        "PolicyViolationResult",
        "ViolationsListResult",
        "BudgetDefinitionResult",
        "BudgetsListResult",
        "PolicyRequestResult",
        "PolicyRequestsListResult",
        "LessonSummaryResult",
        "LessonsListResult",
        "LessonDetailResult",
        "LessonStatsResult",
        "PoliciesFacade"
      ],
      "functions": [
        "get_policies_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/facades/limits_facade.py",
      "relative_path": "app/houseofcards/customer/policies/facades/limits_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Limits Facade - Centralized access to rate limits and quotas",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "LimitType",
        "LimitPeriod",
        "LimitConfig",
        "LimitCheckResult",
        "UsageSummary",
        "LimitsFacade"
      ],
      "functions": [
        "get_limits_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/facades/controls_facade.py",
      "relative_path": "app/houseofcards/customer/policies/facades/controls_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Controls Facade - Centralized access to control operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "ControlType",
        "ControlState",
        "ControlConfig",
        "ControlStatusSummary",
        "ControlsFacade"
      ],
      "functions": [
        "get_controls_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/policy_violation_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/policy_violation_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "S3 violation truth model, fact persistence, evidence linking",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import Any, Dict, Optional",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.utils.runtime import generate_uuid"
      ],
      "classes": [
        "ViolationFact",
        "ViolationIncident",
        "PolicyViolationService",
        "PolicyEvaluationResult"
      ],
      "functions": [
        "create_policy_evaluation_record",
        "handle_policy_evaluation_for_run",
        "handle_policy_violation",
        "create_policy_evaluation_sync"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/prevention_engine.py",
      "relative_path": "app/houseofcards/customer/policies/engines/prevention_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy prevention engine for runtime enforcement",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "PreventionAction",
        "ViolationType",
        "PreventionContext",
        "PreventionResult",
        "PolicyViolationError",
        "PreventionEngine"
      ],
      "functions": [
        "create_policy_snapshot_for_run"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/kernel.py",
      "relative_path": "app/houseofcards/customer/policies/engines/kernel.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Mandatory execution kernel - single choke point for all EXECUTE power",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Optional, TypeVar"
      ],
      "classes": [
        "EnforcementMode",
        "InvocationContext",
        "ExecutionResult",
        "ExecutionKernel"
      ],
      "functions": [
        "get_enforcement_mode",
        "set_enforcement_mode"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/keys_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/keys_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "API Keys domain operations (L4)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import List, Optional, Tuple",
        "from sqlalchemy import and_, desc, func, select",
        "from sqlmodel import Session",
        "from app.models.killswitch import ProxyCall",
        "from app.models.tenant import APIKey"
      ],
      "classes": [
        "KeysReadService",
        "KeysWriteService"
      ],
      "functions": [
        "get_keys_read_service",
        "get_keys_write_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/binding_moment_enforcer.py",
      "relative_path": "app/houseofcards/customer/policies/engines/binding_moment_enforcer.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Enforce binding moments - when policies are evaluated",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Optional, Any, Dict, Set",
        "from datetime import datetime, timezone",
        "import logging"
      ],
      "classes": [
        "BindingMoment",
        "EvaluationPoint",
        "BindingDecision"
      ],
      "functions": [
        "should_evaluate_policy",
        "get_binding_moment",
        "clear_run_cache",
        "_mark_evaluated",
        "_was_evaluated",
        "_check_fields_changed"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/eligibility_engine.py",
      "relative_path": "app/houseofcards/customer/policies/engines/eligibility_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Eligibility Engine - pure rules, deterministic gating",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Any, Optional, Protocol",
        "from uuid import UUID",
        "from app.services.governance.validator_service import ("
      ],
      "classes": [
        "EligibilityDecision",
        "SystemHealthStatus",
        "EligibilityConfig",
        "CapabilityLookup",
        "GovernanceSignalLookup",
        "SystemHealthLookup",
        "ContractLookup",
        "PreApprovalLookup",
        "DefaultCapabilityLookup",
        "DefaultGovernanceSignalLookup",
        "DefaultSystemHealthLookup",
        "DefaultContractLookup",
        "DefaultPreApprovalLookup",
        "EligibilityInput",
        "RuleResult",
        "EligibilityVerdict",
        "EligibilityEngine"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/visitors.py",
      "relative_path": "app/houseofcards/customer/policies/engines/visitors.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy AST visitor pattern implementations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from typing import Any, Dict, List",
        "from app.policy.ast.nodes import (",
        "from app.policy.compiler.grammar import PolicyCategory"
      ],
      "classes": [
        "BaseVisitor",
        "PrintVisitor",
        "CategoryCollector",
        "RuleExtractor"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/certificate.py",
      "relative_path": "app/houseofcards/customer/policies/engines/certificate.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter (Console \u2192 Platform)"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import hmac",
        "import json",
        "import os",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from app.services.replay_determinism import ("
      ],
      "classes": [
        "CertificateType",
        "CertificatePayload",
        "Certificate",
        "CertificateService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/rollout_projection.py",
      "relative_path": "app/houseofcards/customer/policies/engines/rollout_projection.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Rollout Projection - read-only projection of audited truth",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (Projection)"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "RolloutStage",
        "BlastRadius",
        "StabilizationWindow",
        "ContractSummary",
        "ExecutionSummary",
        "AuditSummary",
        "RolloutPlan",
        "FounderRolloutView",
        "GovernanceCompletionReport",
        "CustomerRolloutView",
        "RolloutProjectionService"
      ],
      "functions": [
        "founder_view_to_dict",
        "completion_report_to_dict"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/compiler_parser.py",
      "relative_path": "app/houseofcards/customer/policies/engines/compiler_parser.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy language parser",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from typing import List, Optional",
        "from app.policy.ast.nodes import (",
        "from app.policy.compiler.grammar import ActionType, PolicyCategory",
        "from app.policy.compiler.tokenizer import Token, Tokenizer, TokenType"
      ],
      "classes": [
        "ParseError",
        "Parser"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/replay_determinism.py",
      "relative_path": "app/houseofcards/customer/policies/engines/replay_determinism.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "DeterminismLevel",
        "ModelVersion",
        "PolicyDecision",
        "ReplayMatch",
        "ReplayResult",
        "CallRecord",
        "ReplayValidator",
        "ReplayContextBuilder"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/ir_builder.py",
      "relative_path": "app/houseofcards/customer/policies/engines/ir_builder.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy intermediate representation builder",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from typing import Any, Optional",
        "from app.policy.ast.nodes import (",
        "from app.policy.ast.visitors import BaseVisitor",
        "from app.policy.compiler.grammar import ActionType",
        "from app.policy.ir.ir_nodes import (",
        "from app.policy.ir.symbol_table import ("
      ],
      "classes": [
        "IRBuilder"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/policy_command.py",
      "relative_path": "app/houseofcards/customer/policies/engines/policy_command.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy evaluation and decision authority",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (Command Facade)"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "PolicyViolation",
        "PolicyEvaluationResult",
        "ApprovalConfig"
      ],
      "functions": [
        "simulate_cost",
        "check_policy_violations",
        "evaluate_policy",
        "_record_policy_decision",
        "_record_capability_violation",
        "_record_budget_rejection",
        "_record_approval_request_created",
        "_record_approval_action",
        "_record_approval_escalation",
        "_record_webhook_fallback",
        "record_approval_created",
        "record_approval_outcome",
        "record_escalation",
        "record_webhook_used"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/policy_models.py",
      "relative_path": "app/houseofcards/customer/policies/engines/policy_models.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy domain models and types",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from uuid import uuid4",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "PolicyCategory",
        "PolicyDecision",
        "ActionType",
        "ViolationType",
        "ViolationSeverity",
        "RecoverabilityType",
        "SafetyRuleType",
        "EthicalConstraintType",
        "BusinessRuleType",
        "PolicyEvaluationRequest",
        "PolicyModification",
        "PolicyEvaluationResult",
        "PolicyViolation",
        "PolicyRule",
        "Policy",
        "RiskCeiling",
        "SafetyRule",
        "EthicalConstraint",
        "BusinessRule",
        "PolicyState",
        "PolicyLoadResult",
        "PolicyVersion",
        "PolicyProvenance",
        "PolicyDependency",
        "PolicyConflict",
        "DependencyGraph",
        "TemporalPolicyType",
        "TemporalPolicy",
        "TemporalMetricWindow",
        "PolicyContext",
        "EnhancedPolicyEvaluationRequest",
        "EnhancedPolicyViolation",
        "EnhancedPolicyEvaluationResult"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/budget_enforcement_engine.py",
      "relative_path": "app/houseofcards/customer/policies/engines/budget_enforcement_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Budget enforcement decision-making (domain logic)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def process_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Optional",
        "from sqlalchemy import create_engine, text",
        "from app.contracts.decisions import emit_budget_enforcement_decision"
      ],
      "classes": [
        "BudgetEnforcementEngine"
      ],
      "functions": [
        "emit_budget_halt_decision",
        "process_pending_budget_decisions"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/validator_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/validator_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Issue Validator - pure analysis, advisory verdicts",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import re",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Any, Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "IssueType",
        "Severity",
        "RecommendedAction",
        "IssueSource",
        "ValidatorInput",
        "ValidatorVerdict",
        "ValidatorErrorType",
        "ValidatorError",
        "ValidatorService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/policy_mapper.py",
      "relative_path": "app/houseofcards/customer/policies/engines/policy_mapper.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Map MCP tool invocations to policy gates",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "MCPPolicyDecisionType",
        "MCPDenyReason",
        "MCPPolicyDecision",
        "MCPToolPolicy",
        "MCPPolicyMapper"
      ],
      "functions": [
        "get_mcp_policy_mapper",
        "configure_mcp_policy_mapper",
        "reset_mcp_policy_mapper"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/contract_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/contract_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Contract Service - stateful contract state machine",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from decimal import Decimal",
        "from typing import Any, Optional",
        "from uuid import UUID, uuid4",
        "from app.models.contract import (",
        "from app.services.governance.eligibility_engine import (",
        "from app.services.governance.validator_service import ValidatorVerdict"
      ],
      "classes": [
        "ContractState",
        "ContractStateMachine",
        "ContractService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/cus_enforcement_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/cus_enforcement_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Enforcement policy evaluation for customer LLM integrations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import date, datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from sqlmodel import Session, func, select",
        "from app.db import get_engine",
        "from app.models.cus_models import ("
      ],
      "classes": [
        "EnforcementResult",
        "EnforcementReason",
        "EnforcementDecision",
        "CusEnforcementService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/sandbox_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/sandbox_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "INTERNAL",
        "role": "High-level sandbox service with policy enforcement",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Set",
        "from .sandbox_executor import ("
      ],
      "classes": [
        "SandboxPolicy",
        "ExecutionRequest",
        "ExecutionRecord",
        "SandboxService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/policy_graph_engine.py",
      "relative_path": "app/houseofcards/customer/policies/engines/policy_graph_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy conflict detection and dependency graph computation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def compute_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession"
      ],
      "classes": [
        "ConflictType",
        "ConflictSeverity",
        "DependencyType",
        "PolicyConflict",
        "PolicyDependency",
        "PolicyNode",
        "DependencyGraphResult",
        "ConflictDetectionResult",
        "PolicyConflictEngine",
        "PolicyDependencyEngine"
      ],
      "functions": [
        "get_conflict_engine",
        "get_dependency_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/mcp_connector.py",
      "relative_path": "app/houseofcards/customer/policies/engines/mcp_connector.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Model Context Protocol (MCP) tool invocation with governance",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional, Protocol, runtime_checkable",
        "from datetime import datetime, timezone",
        "import logging"
      ],
      "classes": [
        "McpToolDefinition",
        "McpConnectorConfig",
        "Credential",
        "CredentialService",
        "McpConnectorError",
        "McpApprovalRequiredError",
        "McpRateLimitExceededError",
        "McpSchemaValidationError",
        "McpConnectorService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/claim_decision_engine.py",
      "relative_path": "app/houseofcards/customer/policies/engines/claim_decision_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import os",
        "from typing import Any, Dict, Optional"
      ],
      "classes": [],
      "functions": [
        "is_candidate_claimable",
        "determine_claim_status",
        "get_result_confidence"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/policy_proposal.py",
      "relative_path": "app/houseofcards/customer/policies/engines/policy_proposal.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter (Console \u2192 Platform)"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "from typing import Optional",
        "from uuid import UUID",
        "from sqlalchemy import func, select, text",
        "from app.houseofcards.customer.general.utils.time import utc_now",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import get_async_session",
        "from app.models.audit_ledger import ActorType",
        "from app.models.feedback import PatternFeedback",
        "from app.models.policy import (",
        "from app.services.logs.audit_ledger_service_async import AuditLedgerServiceAsync",
        "from app.services.policy_graph_engine import ("
      ],
      "classes": [
        "PolicyActivationBlockedError",
        "PolicyDeletionBlockedError"
      ],
      "functions": [
        "check_proposal_eligibility",
        "create_policy_proposal",
        "_create_policy_rule_from_proposal",
        "review_policy_proposal",
        "generate_proposals_from_feedback",
        "delete_policy_rule",
        "generate_default_rule",
        "get_proposal_summary"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/protection_provider.py",
      "relative_path": "app/houseofcards/customer/policies/engines/protection_provider.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-7 AbuseProtectionProvider protocol and MockAbuseProtectionProvider",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Protocol, Optional",
        "import logging",
        "import time",
        "from app.protection.decisions import (",
        "from app.billing import get_billing_provider, Limits"
      ],
      "classes": [
        "AbuseProtectionProvider",
        "MockAbuseProtectionProvider"
      ],
      "functions": [
        "get_protection_provider",
        "set_protection_provider"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/customer_policy_read_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/customer_policy_read_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Customer policy domain read operations with business logic (L4)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from typing import TYPE_CHECKING, List, Optional",
        "from app.houseofcards.customer.policies.drivers.policy_read_driver import ("
      ],
      "classes": [
        "BudgetConstraint",
        "RateLimit",
        "GuardrailSummary",
        "PolicyConstraints",
        "CustomerPolicyReadService"
      ],
      "functions": [
        "get_customer_policy_read_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/policy_rules_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/policy_rules_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy rules CRUD service (PIN-LIM-02)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import uuid",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import Any, Optional",
        "from sqlalchemy import select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.models.policy_control_plane import (",
        "from app.models.audit_ledger import ActorType",
        "from app.schemas.limits.policy_rules import (",
        "from app.services.logs.audit_ledger_service_async import AuditLedgerServiceAsync"
      ],
      "classes": [
        "PolicyRulesServiceError",
        "RuleNotFoundError",
        "RuleValidationError",
        "PolicyRulesService"
      ],
      "functions": [
        "utc_now",
        "generate_uuid"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/phase_status_invariants.py",
      "relative_path": "app/houseofcards/customer/policies/engines/phase_status_invariants.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-status invariant enforcement from GovernanceConfig",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, FrozenSet, Optional"
      ],
      "classes": [
        "InvariantCheckResult",
        "PhaseStatusInvariantEnforcementError",
        "InvariantCheckResponse",
        "PhaseStatusInvariantChecker"
      ],
      "functions": [
        "check_phase_status_invariant",
        "ensure_phase_status_invariant"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/decorator.py",
      "relative_path": "app/houseofcards/customer/policies/engines/decorator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Optional ergonomic decorator over ExecutionKernel",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import functools",
        "import inspect",
        "import logging",
        "from typing import Any, Callable, Optional, TypeVar",
        "from app.governance.kernel import ("
      ],
      "classes": [],
      "functions": [
        "governed",
        "_extract_tenant_id",
        "_extract_subject"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/billing_provider.py",
      "relative_path": "app/houseofcards/customer/policies/engines/billing_provider.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-6 BillingProvider protocol and MockBillingProvider",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from typing import Protocol, Optional",
        "import logging",
        "from app.billing.state import BillingState",
        "from app.billing.plan import Plan, DEFAULT_PLAN, PLAN_FREE, PLAN_PRO, PLAN_ENTERPRISE",
        "from app.billing.limits import Limits, derive_limits"
      ],
      "classes": [
        "BillingProvider",
        "MockBillingProvider"
      ],
      "functions": [
        "get_billing_provider",
        "set_billing_provider"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/policy_limits_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/policy_limits_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy limits CRUD service (PIN-LIM-01)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import uuid",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import Optional",
        "from sqlalchemy import select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.models.policy_control_plane import (",
        "from app.models.audit_ledger import ActorType",
        "from app.schemas.limits.policy_limits import (",
        "from app.services.logs.audit_ledger_service_async import AuditLedgerServiceAsync"
      ],
      "classes": [
        "PolicyLimitsServiceError",
        "LimitNotFoundError",
        "LimitValidationError",
        "ImmutableFieldError",
        "PolicyLimitsService"
      ],
      "functions": [
        "utc_now",
        "generate_uuid"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/decisions.py",
      "relative_path": "app/houseofcards/customer/policies/engines/decisions.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-7 Decision enum and result types",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Optional"
      ],
      "classes": [
        "Decision",
        "ProtectionResult",
        "AnomalySignal"
      ],
      "functions": [
        "allow",
        "reject_rate_limit",
        "reject_cost_limit",
        "throttle",
        "warn"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/lessons_engine.py",
      "relative_path": "app/houseofcards/customer/policies/engines/lessons_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Lessons learned creation and management (domain logic)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Any, Optional",
        "from uuid import UUID, uuid4",
        "from prometheus_client import Counter",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import IntegrityError"
      ],
      "classes": [
        "LessonsLearnedEngine"
      ],
      "functions": [
        "utc_now",
        "is_valid_transition",
        "get_threshold_band",
        "get_lessons_learned_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/mapper.py",
      "relative_path": "app/houseofcards/customer/policies/engines/mapper.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Map incidents to relevant SOC2 controls",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Any, Optional",
        "from app.services.soc2.control_registry import ("
      ],
      "classes": [
        "SOC2ControlMapper"
      ],
      "functions": [
        "utc_now",
        "get_control_mappings_for_incident"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/simulation_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/simulation_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Limits simulation service (PIN-LIM-04)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from decimal import Decimal",
        "from typing import Optional",
        "from sqlalchemy import and_, func, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.models.policy_control_plane import Limit, LimitStatus",
        "from app.models.tenant import Tenant",
        "from app.runtime.limits.evaluator import (",
        "from app.runtime.limits.override_resolver import OverrideRecord, OverrideResolver",
        "from app.schemas.limits.simulation import ("
      ],
      "classes": [
        "LimitsSimulationServiceError",
        "TenantNotFoundError",
        "LimitsSimulationService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/engine.py",
      "relative_path": "app/houseofcards/customer/policies/engines/engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy rule evaluation engine",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import json",
        "import logging",
        "import os",
        "import re",
        "import time",
        "from datetime import datetime, timedelta, timezone",
        "from typing import TYPE_CHECKING, Any, Dict, List, Optional, Tuple",
        "from uuid import uuid4",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import SQLAlchemyError",
        "from app.policy.models import (",
        "from app.contracts.decisions import emit_policy_decision"
      ],
      "classes": [
        "PolicyEngine"
      ],
      "functions": [
        "get_policy_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/deterministic_engine.py",
      "relative_path": "app/houseofcards/customer/policies/engines/deterministic_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Deterministic policy execution engine",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "from dataclasses import dataclass, field",
        "from enum import Enum, auto",
        "from typing import Any, Callable, Dict, List, Optional",
        "from app.policy.compiler.grammar import ActionType, PolicyCategory",
        "from app.policy.ir.ir_nodes import (",
        "from app.policy.runtime.intent import Intent, IntentEmitter, IntentPayload, IntentType"
      ],
      "classes": [
        "ExecutionStatus",
        "ExecutionContext",
        "ExecutionResult",
        "DeterministicEngine"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/worker_execution_command.py",
      "relative_path": "app/houseofcards/customer/policies/engines/worker_execution_command.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Worker execution authorization and delegation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (Command Facade)"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "WorkerExecutionResult",
        "ReplayResult"
      ],
      "functions": [
        "calculate_cost_cents",
        "get_brand_schema_types",
        "convert_brand_request",
        "execute_worker",
        "replay_execution"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/job_executor.py",
      "relative_path": "app/houseofcards/customer/policies/engines/job_executor.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Job Executor - executes job steps and emits evidence",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Handler\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Optional, Protocol",
        "from uuid import UUID",
        "from app.models.governance_job import ("
      ],
      "classes": [
        "HealthObserver",
        "StepHandler",
        "StepOutput",
        "ExecutionContext",
        "ExecutionResult",
        "JobExecutor",
        "NoOpHandler",
        "FailingHandler"
      ],
      "functions": [
        "create_default_executor",
        "execution_result_to_evidence"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/plan_generation_engine.py",
      "relative_path": "app/houseofcards/customer/policies/engines/plan_generation_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Plan generation (domain logic)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from app.memory import get_retriever",
        "from app.planners import get_planner",
        "from app.skills import get_skill_manifest",
        "from app.utils.budget_tracker import get_budget_tracker",
        "from app.utils.plan_inspector import validate_plan"
      ],
      "classes": [
        "PlanGenerationContext",
        "PlanGenerationResult",
        "PlanGenerationEngine"
      ],
      "functions": [
        "generate_plan_for_run"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/override_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/override_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Limit override service (PIN-LIM-05)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import uuid",
        "from datetime import datetime, timedelta, timezone",
        "from decimal import Decimal",
        "from typing import Optional",
        "from sqlalchemy import and_, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.models.policy_control_plane import Limit",
        "from app.schemas.limits.overrides import ("
      ],
      "classes": [
        "LimitOverrideServiceError",
        "LimitNotFoundError",
        "OverrideNotFoundError",
        "OverrideValidationError",
        "StackingAbuseError",
        "LimitOverrideService"
      ],
      "functions": [
        "utc_now",
        "generate_uuid"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/audit_service.py",
      "relative_path": "app/houseofcards/customer/policies/engines/audit_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L8",
        "audience": null,
        "role": "Audit Service - verifies job execution against contract intent",
        "raw_layer_line": "# Layer: L8 \u2014 Catalyst / Verification"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "from uuid import UUID, uuid4",
        "from app.models.contract import AuditVerdict"
      ],
      "classes": [
        "CheckResult",
        "AuditCheck",
        "AuditInput",
        "AuditResult",
        "AuditChecks",
        "AuditService",
        "RolloutGate"
      ],
      "functions": [
        "audit_result_to_record",
        "create_audit_input_from_evidence"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/constraint_checker.py",
      "relative_path": "app/houseofcards/customer/policies/engines/constraint_checker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Enforce MonitorConfig inspection constraints before logging",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "InspectionOperation",
        "InspectionConstraintViolation",
        "InspectionConstraintChecker"
      ],
      "functions": [
        "check_inspection_allowed",
        "get_constraint_violations"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/governance_orchestrator.py",
      "relative_path": "app/houseofcards/customer/policies/engines/governance_orchestrator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Governance Orchestrator - orchestrates contract execution",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Optional, Protocol",
        "from uuid import UUID, uuid4",
        "from app.models.contract import (",
        "from app.models.governance_job import (",
        "from app.services.governance.contract_service import ContractService, ContractState"
      ],
      "classes": [
        "HealthLookup",
        "JobState",
        "JobStateMachine",
        "ExecutionOrchestrator",
        "JobStateTracker",
        "AuditEvidence",
        "AuditTrigger",
        "ContractActivationError",
        "ContractActivationService",
        "GovernanceOrchestrator"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/control_registry.py",
      "relative_path": "app/houseofcards/customer/policies/engines/control_registry.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "SOC2 Trust Service Criteria control registry",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "SOC2Category",
        "SOC2ComplianceStatus",
        "SOC2Control",
        "SOC2ControlMapping",
        "SOC2ControlRegistry"
      ],
      "functions": [
        "get_control_registry"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/intent.py",
      "relative_path": "app/houseofcards/customer/policies/engines/intent.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Policy intent model and declaration",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum, auto",
        "from typing import Any, Callable, Dict, List, Optional"
      ],
      "classes": [
        "IntentType",
        "IntentPayload",
        "Intent",
        "IntentEmitter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/engines/prevention_hook.py",
      "relative_path": "app/houseofcards/customer/policies/engines/prevention_hook.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Prevention hook for policy enforcement",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, Optional",
        "from uuid import uuid4",
        "from app.policy.validators.content_accuracy import ("
      ],
      "classes": [
        "PreventionAction",
        "PreventionContext",
        "PreventionResult",
        "PreventionHook"
      ],
      "functions": [
        "create_prevention_hook",
        "get_prevention_hook",
        "evaluate_response"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/schemas/retry.py",
      "relative_path": "app/houseofcards/customer/policies/schemas/retry.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Retry API schemas",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from enum import Enum",
        "from typing import Optional",
        "from pydantic import BaseModel, ConfigDict, Field"
      ],
      "classes": [
        "BackoffStrategy",
        "RetryPolicy"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/schemas/overrides.py",
      "relative_path": "app/houseofcards/customer/policies/schemas/overrides.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Limit override request/response schemas",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Optional",
        "from pydantic import BaseModel, Field, field_validator"
      ],
      "classes": [
        "OverrideStatus",
        "LimitOverrideRequest",
        "LimitOverrideResponse",
        "OverrideApprovalRequest",
        "OverrideListResponse"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/schemas/simulation.py",
      "relative_path": "app/houseofcards/customer/policies/schemas/simulation.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Limit simulation request/response schemas",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Optional",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "SimulationDecision",
        "MessageCode",
        "LimitSimulationRequest",
        "LimitCheckResult",
        "HeadroomInfo",
        "LimitWarning",
        "LimitSimulationResponse"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/schemas/policy_rules.py",
      "relative_path": "app/houseofcards/customer/policies/schemas/policy_rules.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy rules request/response schemas",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import Any, Optional",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "EnforcementModeEnum",
        "PolicyScopeEnum",
        "PolicySourceEnum",
        "CreatePolicyRuleRequest",
        "UpdatePolicyRuleRequest",
        "PolicyRuleResponse"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/schemas/policy_limits.py",
      "relative_path": "app/houseofcards/customer/policies/schemas/policy_limits.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Policy limits request/response schemas",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Optional",
        "from pydantic import BaseModel, Field, field_validator"
      ],
      "classes": [
        "LimitCategoryEnum",
        "LimitScopeEnum",
        "LimitEnforcementEnum",
        "ResetPeriodEnum",
        "CreatePolicyLimitRequest",
        "UpdatePolicyLimitRequest",
        "PolicyLimitResponse"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/controls/drivers/killswitch_read_driver.py",
      "relative_path": "app/houseofcards/customer/policies/controls/drivers/killswitch_read_driver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Data access for killswitch read operations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timedelta, timezone",
        "from typing import List, Optional",
        "from pydantic import BaseModel",
        "from sqlalchemy import and_, desc, func, select",
        "from sqlmodel import Session",
        "from app.db import get_session",
        "from app.models.killswitch import ("
      ],
      "classes": [
        "KillswitchStateDTO",
        "GuardrailInfoDTO",
        "IncidentStatsDTO",
        "KillswitchStatusDTO",
        "KillswitchReadDriver"
      ],
      "functions": [
        "get_killswitch_read_driver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/controls/drivers/runtime_switch.py",
      "relative_path": "app/houseofcards/customer/policies/controls/drivers/runtime_switch.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Runtime toggle for governance enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import threading",
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Optional",
        "from app.houseofcards.customer.general.utils.time import utc_now"
      ],
      "classes": [
        "GovernanceState"
      ],
      "functions": [
        "is_governance_active",
        "is_degraded_mode",
        "disable_governance_runtime",
        "enable_governance_runtime",
        "enter_degraded_mode",
        "exit_degraded_mode",
        "get_governance_state",
        "reset_governance_state",
        "_emit_governance_event"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/controls/engines/customer_killswitch_read_service.py",
      "relative_path": "app/houseofcards/customer/policies/controls/engines/customer_killswitch_read_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Customer killswitch read operations (L4 facade over L6 driver)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import TYPE_CHECKING, List, Optional",
        "from pydantic import BaseModel",
        "from app.houseofcards.customer.policies.controls.drivers.killswitch_read_driver import ("
      ],
      "classes": [
        "KillswitchState",
        "GuardrailInfo",
        "IncidentStats",
        "KillswitchStatusInfo",
        "CustomerKillswitchReadService"
      ],
      "functions": [
        "get_customer_killswitch_read_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/policies/controls/engines/degraded_mode_checker.py",
      "relative_path": "app/houseofcards/customer/policies/controls/engines/degraded_mode_checker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Governance degraded mode checker with incident response",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from threading import Lock",
        "from typing import Any, Dict, FrozenSet, Optional",
        "import logging"
      ],
      "classes": [
        "DegradedModeCheckResult",
        "DegradedModeState",
        "GovernanceDegradedModeError",
        "DegradedModeStatus",
        "DegradedModeCheckResponse",
        "DegradedModeIncident",
        "DegradedModeIncidentCreator",
        "GovernanceDegradedModeChecker"
      ],
      "functions": [
        "check_degraded_mode",
        "ensure_not_degraded",
        "enter_degraded_with_incident",
        "_reset_degraded_mode_state"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/drivers/panel_capability_resolver.py",
      "relative_path": "app/houseofcards/customer/agent/drivers/panel_capability_resolver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Resolve capability IDs to endpoints via AURORA registry",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional",
        "import yaml"
      ],
      "classes": [
        "CapabilityStatus",
        "ResolvedCapability",
        "CapabilityRegistryEntry",
        "PanelCapabilityResolver"
      ],
      "functions": [
        "get_capability_resolver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/drivers/panel_types.py",
      "relative_path": "app/houseofcards/customer/agent/drivers/panel_types.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Shared type primitives for Panel Adapter",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "TruthClass",
        "TruthLens",
        "SlotState",
        "Authority",
        "NegativeAuthorityValue",
        "PanelSlotContext",
        "VerificationSignals",
        "TruthMetadata",
        "TimeSemantics",
        "SlotProvenance",
        "PanelSlotResult",
        "PanelResult",
        "InputSignalSpec",
        "OutputSignalSpec",
        "APISpec",
        "ConsumedCapabilitySpec",
        "InputSignalsSpec",
        "SlotSpec",
        "PanelSpec",
        "DependencySpec",
        "DeterminismRule"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/drivers/event_emitter.py",
      "relative_path": "app/houseofcards/customer/agent/drivers/event_emitter.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json as json_lib",
        "import logging",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from sqlmodel import Session"
      ],
      "classes": [
        "EventType",
        "EntityType",
        "OpsEvent",
        "EventEmitterError",
        "EventEmitter"
      ],
      "functions": [
        "utc_now",
        "get_event_emitter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/drivers/semantic_types.py",
      "relative_path": "app/houseofcards/customer/agent/drivers/semantic_types.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Type definitions for semantic validation",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "ViolationClass",
        "SemanticSeverity",
        "IntentFailureCode",
        "SemanticFailureCode",
        "SemanticContext",
        "SemanticViolation",
        "SemanticReport",
        "SemanticBinding"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/engines/semantic_validator.py",
      "relative_path": "app/houseofcards/customer/agent/engines/semantic_validator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Semantic validation gate \u2014 enforce semantic authority",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Set, Tuple",
        "from .panel_capability_resolver import (",
        "from .panel_signal_translator import (",
        "from .panel_spec_loader import PanelSpecLoader, get_panel_spec_loader",
        "from .panel_types import SlotSpec",
        "from .semantic_failures import get_fix_action, get_fix_owner",
        "from .semantic_types import ("
      ],
      "classes": [
        "SemanticValidator"
      ],
      "functions": [
        "check_signal_has_translation",
        "check_capability_is_observed",
        "check_api_field_present",
        "check_signal_type",
        "get_semantic_validator",
        "create_semantic_validator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/engines/intent_guardrails.py",
      "relative_path": "app/houseofcards/customer/agent/engines/intent_guardrails.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Phase A Intent Guardrails (design-time validation)",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional, Set",
        "from .semantic_types import ("
      ],
      "classes": [],
      "functions": [
        "_get_int_fix_owner",
        "_get_int_fix_action",
        "_create_violation",
        "check_int_001_signal_provable",
        "check_int_002_capability_cardinality",
        "check_int_003_semantic_duplication",
        "check_int_004_contradictory_intents",
        "check_int_005_missing_evolution_path",
        "check_int_006_unbounded_intent_scope",
        "check_int_007_missing_semantic_contract",
        "check_int_008_invalid_capability_reference",
        "run_intent_guardrails"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/engines/panel_spec_loader.py",
      "relative_path": "app/houseofcards/customer/agent/engines/panel_spec_loader.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Load and parse L2.1 Panel Adapter YAML spec",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import csv",
        "import logging",
        "from datetime import datetime",
        "from pathlib import Path",
        "from typing import Dict, List, Optional",
        "import yaml",
        "from .panel_types import ("
      ],
      "classes": [
        "PanelSpecLoader"
      ],
      "functions": [
        "get_panel_spec_loader"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/engines/panel_metrics_emitter.py",
      "relative_path": "app/houseofcards/customer/agent/engines/panel_metrics_emitter.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Emit Prometheus metrics for panel evaluation",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import time",
        "from contextlib import contextmanager",
        "from typing import Any, Dict, List, Optional",
        "from .panel_consistency_checker import ConsistencyCheckResult",
        "from .panel_types import Authority, PanelSlotResult, SlotState"
      ],
      "classes": [
        "PanelMetricsEmitter"
      ],
      "functions": [
        "get_panel_metrics_emitter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/engines/validator_engine.py",
      "relative_path": "app/houseofcards/customer/agent/engines/validator_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Two-phase semantic validation orchestrator",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Set",
        "from .intent_guardrails import run_intent_guardrails",
        "from .semantic_types import ("
      ],
      "classes": [
        "TwoPhaseValidator"
      ],
      "functions": [
        "validate_intent",
        "validate_panel",
        "validate_full"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/engines/panel_signal_translator.py",
      "relative_path": "app/houseofcards/customer/agent/engines/panel_signal_translator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Translate spec signals to API field names",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from typing import Callable as CallableType"
      ],
      "classes": [
        "TranslationOutcome",
        "TranslatedSignal",
        "PanelSignalTranslator"
      ],
      "functions": [
        "_compute_system_state",
        "_compute_attention_required",
        "_compute_has_near_threshold_runs",
        "_compute_guardrails_holding",
        "get_signal_translator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/engines/panel_signal_collector.py",
      "relative_path": "app/houseofcards/customer/agent/engines/panel_signal_collector.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Collect raw signals from backend APIs via capability resolution",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional, Set",
        "import httpx",
        "from .panel_capability_resolver import (",
        "from .panel_signal_translator import (",
        "from .panel_types import SlotSpec",
        "from .semantic_validator import SemanticValidator, get_semantic_validator",
        "from .semantic_types import SemanticReport"
      ],
      "classes": [
        "CapabilityResolutionTrace",
        "CollectedSignal",
        "CollectedSignals",
        "PanelSignalCollector"
      ],
      "functions": [
        "create_signal_collector"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/agent/engines/panel_dependency_resolver.py",
      "relative_path": "app/houseofcards/customer/agent/engines/panel_dependency_resolver.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Resolve panel dependencies and evaluation order",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "from typing import Dict, List, Optional, Set",
        "from .panel_types import DependencySpec"
      ],
      "classes": [
        "PanelDependencyResolver"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/activity/drivers/llm_threshold_service.py",
      "relative_path": "app/houseofcards/customer/activity/drivers/llm_threshold_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "LLM run threshold resolution and evaluation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Optional",
        "from pydantic import BaseModel, Field, field_validator",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from sqlmodel import select",
        "from app.models.policy_control_plane import Limit, LimitCategory, LimitStatus"
      ],
      "classes": [
        "ThresholdParams",
        "ThresholdParamsUpdate",
        "ThresholdSignal",
        "ThresholdEvaluationResult",
        "LLMRunThresholdResolver",
        "LLMRunEvaluator",
        "LLMRunThresholdResolverSync",
        "LLMRunEvaluatorSync",
        "ThresholdSignalRecord"
      ],
      "functions": [
        "create_threshold_signal_record",
        "collect_signals_from_evaluation",
        "emit_threshold_signal_sync",
        "emit_and_persist_threshold_signal"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/activity/drivers/activity_enums.py",
      "relative_path": "app/houseofcards/customer/activity/drivers/activity_enums.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Canonical enums for activity domain - owned by engines",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from enum import Enum"
      ],
      "classes": [
        "SignalType",
        "SeverityLevel",
        "RunState",
        "RiskType",
        "EvidenceHealth"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/activity/facades/run_governance_facade.py",
      "relative_path": "app/houseofcards/customer/activity/facades/run_governance_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": "CUSTOMER",
        "role": "Run Governance Facade - Centralized access to governance operations for runs",
        "raw_layer_line": "# Layer: L3 \u2014 Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "RunGovernanceFacade"
      ],
      "functions": [
        "get_run_governance_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/activity/facades/activity_facade.py",
      "relative_path": "app/houseofcards/customer/activity/facades/activity_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Activity Facade - Centralized access to activity domain operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.services.activity.attention_ranking_service import AttentionRankingService",
        "from app.services.activity.cost_analysis_service import CostAnalysisService",
        "from app.services.activity.pattern_detection_service import PatternDetectionService",
        "from app.services.activity.signal_feedback_service import (",
        "from app.services.activity.signal_identity import compute_signal_fingerprint_from_row",
        "from app.houseofcards.customer.activity.engines.activity_enums import (",
        "from app.services.activity.pattern_detection_service import (",
        "from app.services.activity.cost_analysis_service import (",
        "from app.services.activity.attention_ranking_service import ("
      ],
      "classes": [
        "PolicyContextResult",
        "RunSummaryResult",
        "RunSummaryV2Result",
        "RunListResult",
        "RunsResult",
        "RunDetailResult",
        "RunEvidenceResult",
        "RunProofResult",
        "StatusCount",
        "StatusSummaryResult",
        "SignalProjectionResult",
        "SignalsResult",
        "MetricsResult",
        "ThresholdSignalResult",
        "ThresholdSignalsResult",
        "RiskSignalsResult",
        "ActivityFacade"
      ],
      "functions": [
        "get_activity_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/activity/engines/signal_feedback_service.py",
      "relative_path": "app/houseofcards/customer/activity/engines/signal_feedback_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Signal feedback service for acknowledging/suppressing signals",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Optional",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.houseofcards.customer.general.utils.time import utc_now"
      ],
      "classes": [
        "AcknowledgeResult",
        "SuppressResult",
        "SignalFeedbackStatus",
        "SignalFeedbackService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/activity/engines/pattern_detection_service.py",
      "relative_path": "app/houseofcards/customer/activity/engines/pattern_detection_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Pattern detection service for activity signals",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Optional",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.houseofcards.customer.general.utils.time import utc_now"
      ],
      "classes": [
        "DetectedPattern",
        "PatternDetectionResult",
        "PatternDetectionService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/activity/engines/cost_analysis_service.py",
      "relative_path": "app/houseofcards/customer/activity/engines/cost_analysis_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Cost analysis service for activity signals",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Optional",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.houseofcards.customer.general.utils.time import utc_now"
      ],
      "classes": [
        "CostAnomaly",
        "CostAnalysisResult",
        "CostAnalysisService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/activity/engines/attention_ranking_service.py",
      "relative_path": "app/houseofcards/customer/activity/engines/attention_ranking_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Attention ranking service for activity signals",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def compute_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Any, Optional",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.houseofcards.customer.general.utils.time import utc_now"
      ],
      "classes": [
        "AttentionSignal",
        "AttentionQueueResult",
        "AttentionRankingService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/activity/engines/signal_identity.py",
      "relative_path": "app/houseofcards/customer/activity/engines/signal_identity.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Signal identity computation for deduplication",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "import hashlib",
        "import json",
        "from typing import Any"
      ],
      "classes": [],
      "functions": [
        "compute_signal_fingerprint_from_row",
        "compute_signal_fingerprint"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/drivers/profile.py",
      "relative_path": "app/houseofcards/customer/account/drivers/profile.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Governance Profile configuration and validation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Dict, FrozenSet, List, Optional, Tuple"
      ],
      "classes": [
        "GovernanceProfile",
        "GovernanceConfig",
        "GovernanceConfigError"
      ],
      "functions": [
        "_get_bool_env",
        "get_governance_profile",
        "load_governance_config",
        "validate_governance_config",
        "get_governance_config",
        "reset_governance_config",
        "validate_governance_at_startup"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/drivers/identity_resolver.py",
      "relative_path": "app/houseofcards/customer/account/drivers/identity_resolver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Identity resolution from various providers",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from app.houseofcards.internal.platform.iam.engines.iam_service import ("
      ],
      "classes": [
        "IdentityResolver",
        "ClerkIdentityResolver",
        "APIKeyIdentityResolver",
        "SystemIdentityResolver",
        "IdentityChain"
      ],
      "functions": [
        "create_default_identity_chain"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/drivers/tenant_service.py",
      "relative_path": "app/houseofcards/customer/account/drivers/tenant_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Tenant CRUD, API key management, quota enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "from datetime import datetime, timedelta",
        "from typing import Any, List, Optional, Tuple, cast",
        "from sqlmodel import Session, func, select",
        "from app.houseofcards.customer.general.utils.time import utc_now",
        "from ..models.tenant import ("
      ],
      "classes": [
        "TenantServiceError",
        "QuotaExceededError",
        "TenantService"
      ],
      "functions": [
        "get_tenant_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/drivers/worker_registry_service.py",
      "relative_path": "app/houseofcards/customer/account/drivers/worker_registry_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Worker discovery, status queries, capability registry",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "from typing import Any, Dict, List, Optional",
        "from sqlmodel import Session, select",
        "from ..models.tenant import WorkerConfig, WorkerRegistry"
      ],
      "classes": [
        "WorkerRegistryError",
        "WorkerNotFoundError",
        "WorkerUnavailableError",
        "WorkerRegistryService"
      ],
      "functions": [
        "get_worker_registry_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/facades/accounts_facade.py",
      "relative_path": "app/houseofcards/customer/account/facades/accounts_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Accounts domain facade - unified entry point for account management",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import secrets",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Optional",
        "from sqlalchemy import func, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.models.tenant import ("
      ],
      "classes": [
        "ProjectSummaryResult",
        "ProjectsListResult",
        "ProjectDetailResult",
        "UserSummaryResult",
        "UsersListResult",
        "UserDetailResult",
        "TenantUserResult",
        "TenantUsersListResult",
        "ProfileResult",
        "ProfileUpdateResult",
        "BillingSummaryResult",
        "InvoiceSummaryResult",
        "InvoiceListResult",
        "SupportContactResult",
        "SupportTicketResult",
        "SupportTicketListResult",
        "InvitationResult",
        "InvitationListResult",
        "AcceptInvitationResult",
        "AccountsErrorResult",
        "AccountsFacade"
      ],
      "functions": [
        "get_accounts_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/facades/notifications_facade.py",
      "relative_path": "app/houseofcards/customer/account/facades/notifications_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Notifications Facade - Centralized access to notification operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "NotificationChannel",
        "NotificationPriority",
        "NotificationStatus",
        "NotificationInfo",
        "ChannelInfo",
        "NotificationPreferences",
        "NotificationsFacade"
      ],
      "functions": [
        "get_notifications_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/engines/user_write_service.py",
      "relative_path": "app/houseofcards/customer/account/engines/user_write_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for User management (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Dict, Optional",
        "from sqlmodel import Session",
        "from app.houseofcards.customer.general.utils.time import utc_now",
        "from app.models.tenant import User"
      ],
      "classes": [
        "UserWriteService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/engines/email_verification.py",
      "relative_path": "app/houseofcards/customer/account/engines/email_verification.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter (Console \u2192 Platform)"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import os",
        "import secrets",
        "from dataclasses import dataclass",
        "from typing import Optional",
        "import httpx",
        "from redis import Redis"
      ],
      "classes": [
        "VerificationResult",
        "EmailVerificationError",
        "EmailVerificationService"
      ],
      "functions": [
        "get_email_verification_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/notifications/engines/channel_service.py",
      "relative_path": "app/houseofcards/customer/account/notifications/engines/channel_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Configurable notification channel management",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Protocol, Set"
      ],
      "classes": [
        "NotifyChannel",
        "NotifyEventType",
        "NotifyChannelStatus",
        "NotifyChannelError",
        "NotifyDeliveryResult",
        "NotifyChannelConfig",
        "NotifyChannelConfigResponse",
        "NotificationSender",
        "NotifyChannelService"
      ],
      "functions": [
        "get_notify_service",
        "_reset_notify_service",
        "get_channel_config",
        "send_notification",
        "check_channel_health"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/support/CRM/engines/validator_service.py",
      "relative_path": "app/houseofcards/customer/account/support/CRM/engines/validator_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Issue Validator - pure analysis, advisory verdicts",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import re",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Any, Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "IssueType",
        "Severity",
        "RecommendedAction",
        "IssueSource",
        "ValidatorInput",
        "ValidatorVerdict",
        "ValidatorErrorType",
        "ValidatorError",
        "ValidatorService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/support/CRM/engines/job_executor.py",
      "relative_path": "app/houseofcards/customer/account/support/CRM/engines/job_executor.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Job Executor - executes job steps and emits evidence",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Handler\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Optional, Protocol",
        "from uuid import UUID",
        "from app.models.governance_job import ("
      ],
      "classes": [
        "HealthObserver",
        "StepHandler",
        "StepOutput",
        "ExecutionContext",
        "ExecutionResult",
        "JobExecutor",
        "NoOpHandler",
        "FailingHandler"
      ],
      "functions": [
        "create_default_executor",
        "execution_result_to_evidence"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/account/support/CRM/engines/audit_service.py",
      "relative_path": "app/houseofcards/customer/account/support/CRM/engines/audit_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L8",
        "audience": null,
        "role": "Audit Service - verifies job execution against contract intent",
        "raw_layer_line": "# Layer: L8 \u2014 Catalyst / Verification"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "from uuid import UUID, uuid4",
        "from app.models.contract import AuditVerdict"
      ],
      "classes": [
        "CheckResult",
        "AuditCheck",
        "AuditInput",
        "AuditResult",
        "AuditChecks",
        "AuditService",
        "RolloutGate"
      ],
      "functions": [
        "audit_result_to_record",
        "create_audit_input_from_evidence"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/drivers/leader.py",
      "relative_path": "app/houseofcards/customer/analytics/drivers/leader.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import logging",
        "from contextlib import asynccontextmanager",
        "from typing import AsyncGenerator, Optional",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db_async import AsyncSessionLocal"
      ],
      "classes": [
        "LeaderContext"
      ],
      "functions": [
        "try_acquire_leader_lock",
        "release_leader_lock",
        "is_lock_held",
        "leader_election",
        "with_leader_lock",
        "with_canary_lock",
        "with_alert_worker_lock",
        "with_archiver_lock"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/drivers/killswitch.py",
      "relative_path": "app/houseofcards/customer/analytics/drivers/killswitch.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Optimization killswitch for emergency stops",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import threading",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Callable, List, Optional"
      ],
      "classes": [
        "KillSwitchState",
        "KillSwitchTrigger",
        "RollbackStatus",
        "KillSwitchEvent",
        "KillSwitch"
      ],
      "functions": [
        "get_killswitch",
        "reset_killswitch_for_testing"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/drivers/manager.py",
      "relative_path": "app/houseofcards/customer/analytics/drivers/manager.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Optimization envelope lifecycle management",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import threading",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Callable, Dict, List, Optional",
        "from app.optimization.envelope import (",
        "from app.optimization.killswitch import ("
      ],
      "classes": [
        "EnvelopeApplication",
        "EnvelopeManager"
      ],
      "functions": [
        "get_envelope_manager",
        "reset_manager_for_testing"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/drivers/provenance_async.py",
      "relative_path": "app/houseofcards/customer/analytics/drivers/provenance_async.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "import logging",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from sqlalchemy import and_, func, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db_async import AsyncSessionLocal, async_session_context",
        "from app.models.costsim_cb import CostSimProvenanceModel"
      ],
      "classes": [],
      "functions": [
        "write_provenance",
        "write_provenance_batch",
        "query_provenance",
        "count_provenance",
        "get_drift_stats",
        "check_duplicate",
        "compute_input_hash",
        "backfill_v1_baseline"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/drivers/circuit_breaker_async.py",
      "relative_path": "app/houseofcards/customer/analytics/drivers/circuit_breaker_async.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from app.infra import FeatureIntent, RetryPolicy",
        "import json",
        "import logging",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from sqlalchemy import select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.costsim.config import get_config",
        "from app.costsim.metrics import get_metrics",
        "from app.db_async import AsyncSessionLocal, async_session_context",
        "from app.models.costsim_cb import ("
      ],
      "classes": [
        "CircuitBreakerState",
        "Incident",
        "AsyncCircuitBreaker"
      ],
      "functions": [
        "_get_or_create_state",
        "is_v2_disabled",
        "_try_auto_recover",
        "_auto_recover",
        "get_state",
        "report_drift",
        "report_schema_error",
        "disable_v2",
        "enable_v2",
        "_trip",
        "_resolve_incident",
        "get_incidents",
        "_enqueue_alert",
        "_build_disable_alert_payload",
        "_build_enable_alert_payload",
        "get_async_circuit_breaker"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/drivers/audit_persistence.py",
      "relative_path": "app/houseofcards/customer/analytics/drivers/audit_persistence.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Optimization audit trail persistence",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from uuid import UUID",
        "from sqlmodel import Field, Session, SQLModel"
      ],
      "classes": [
        "CoordinationAuditRecordDB"
      ],
      "functions": [
        "_now_utc",
        "persist_audit_record"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/drivers/circuit_breaker.py",
      "relative_path": "app/houseofcards/customer/analytics/drivers/circuit_breaker.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from app.infra import FeatureIntent, RetryPolicy",
        "import asyncio",
        "import json",
        "import logging",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional, Tuple, cast",
        "import httpx",
        "from sqlmodel import Session, select",
        "from app.costsim.config import get_config",
        "from app.db import ("
      ],
      "classes": [
        "CircuitBreakerState",
        "Incident",
        "CircuitBreaker"
      ],
      "functions": [
        "get_circuit_breaker",
        "is_v2_disabled",
        "disable_v2",
        "enable_v2"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/facades/analytics_facade.py",
      "relative_path": "app/houseofcards/customer/analytics/facades/analytics_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Analytics Facade - Centralized access to analytics domain operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone, timedelta",
        "from enum import Enum",
        "from typing import Any",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession"
      ],
      "classes": [
        "ResolutionType",
        "ScopeType",
        "TimeWindowResult",
        "UsageTotalsResult",
        "UsageDataPointResult",
        "SignalSourceResult",
        "UsageStatisticsResult",
        "CostTotalsResult",
        "CostDataPointResult",
        "CostByModelResult",
        "CostByFeatureResult",
        "CostStatisticsResult",
        "TopicStatusResult",
        "AnalyticsStatusResult",
        "SignalAdapter",
        "AnalyticsFacade"
      ],
      "functions": [
        "get_analytics_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/facades/detection_facade.py",
      "relative_path": "app/houseofcards/customer/analytics/facades/detection_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Detection Facade - Centralized access to anomaly detection operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid",
        "from app.houseofcards.customer.analytics.engines.cost_anomaly_detector import ("
      ],
      "classes": [
        "DetectionType",
        "AnomalyStatus",
        "DetectionResult",
        "AnomalyInfo",
        "DetectionStatusInfo",
        "DetectionFacade"
      ],
      "functions": [
        "get_detection_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/facades/v2_adapter.py",
      "relative_path": "app/houseofcards/customer/analytics/facades/v2_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Cost simulation adapter (translation only)",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import time",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from app.costsim.config import get_commit_sha, get_config",
        "from app.costsim.models import (",
        "from app.costsim.provenance import get_provenance_logger",
        "from app.worker.simulate import CostSimulator, SimulationResult"
      ],
      "classes": [
        "V2StepEstimate",
        "CostSimV2Adapter"
      ],
      "functions": [
        "simulate_v2",
        "simulate_v2_with_comparison"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/config.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/config.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from typing import Optional"
      ],
      "classes": [
        "CostSimConfig"
      ],
      "functions": [
        "get_config",
        "is_v2_sandbox_enabled",
        "is_v2_disabled_by_drift",
        "get_commit_sha"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/cost_anomaly_detector.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/cost_anomaly_detector.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import date, datetime, timedelta",
        "from enum import Enum",
        "from typing import List, Optional",
        "from sqlalchemy import text",
        "from sqlmodel import Session, select",
        "from app.db import (",
        "from app.services.governance.cross_domain import create_incident_from_cost_anomaly_sync"
      ],
      "classes": [
        "AnomalyType",
        "AnomalySeverity",
        "DerivedCause",
        "DetectedAnomaly",
        "CostAnomalyDetector"
      ],
      "functions": [
        "classify_severity",
        "run_anomaly_detection",
        "run_anomaly_detection_with_governance"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/coordinator.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/coordinator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Optimization envelope coordination",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import logging",
        "import uuid",
        "from datetime import datetime, timezone",
        "from typing import Dict, List, Optional, Tuple",
        "from sqlmodel import Session",
        "from app.optimization.audit_persistence import persist_audit_record",
        "from app.optimization.envelope import ("
      ],
      "classes": [
        "CoordinationError",
        "CoordinationManager"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/divergence.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/divergence.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import math",
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional",
        "from app.costsim.config import get_config",
        "from app.costsim.models import DivergenceReport",
        "from app.costsim.provenance import ProvenanceLog, get_provenance_logger"
      ],
      "classes": [
        "DivergenceSample",
        "DivergenceAnalyzer"
      ],
      "functions": [
        "generate_divergence_report"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/alert_worker.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/alert_worker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Worker\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def process_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from app.infra import FeatureIntent, RetryPolicy",
        "import asyncio",
        "import logging",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional",
        "import httpx",
        "from sqlalchemy import and_, select, update",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.costsim.config import get_config",
        "from app.costsim.leader import (",
        "from app.costsim.metrics import get_metrics",
        "from app.db_async import AsyncSessionLocal, async_session_context",
        "from app.models.costsim_cb import CostSimAlertQueueModel, CostSimCBIncidentModel"
      ],
      "classes": [
        "AlertWorker"
      ],
      "functions": [
        "enqueue_alert",
        "retry_failed_alerts",
        "purge_old_alerts",
        "run_alert_worker"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/costsim_models.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/costsim_models.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "V2SimulationStatus",
        "ComparisonVerdict",
        "V2SimulationResult",
        "ComparisonResult",
        "DiffResult",
        "CanaryReport",
        "DivergenceReport",
        "ValidationResult"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/sandbox.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/sandbox.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from app.costsim.circuit_breaker_async import (",
        "from app.costsim.config import is_v2_sandbox_enabled",
        "from app.costsim.models import (",
        "from app.costsim.v2_adapter import CostSimV2Adapter",
        "from app.worker.simulate import CostSimulator, SimulationResult"
      ],
      "classes": [
        "SandboxResult",
        "CostSimSandbox"
      ],
      "functions": [
        "simulate_with_sandbox",
        "get_sandbox"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/datasets.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/datasets.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import math",
        "import random",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional",
        "from app.costsim.models import ValidationResult",
        "from app.costsim.v2_adapter import CostSimV2Adapter"
      ],
      "classes": [
        "DatasetSample",
        "ReferenceDataset",
        "DatasetValidator"
      ],
      "functions": [
        "get_dataset_validator",
        "validate_dataset",
        "validate_all_datasets"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/s1_retry_backoff.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/s1_retry_backoff.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "S1 Retry backoff envelope implementation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from app.optimization.envelope import ("
      ],
      "classes": [],
      "functions": [
        "create_s1_envelope"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/cost_write_service.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/cost_write_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for Cost Intelligence API (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlmodel import Session",
        "from app.db import CostBudget, CostRecord, FeatureTag"
      ],
      "classes": [
        "CostWriteService"
      ],
      "functions": [
        "utc_now"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/canary.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/canary.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import json",
        "import logging",
        "import math",
        "import uuid",
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from app.costsim.circuit_breaker import get_circuit_breaker",
        "from app.costsim.circuit_breaker_async import (",
        "from app.costsim.config import get_config",
        "from app.costsim.leader import (",
        "from app.costsim.models import (",
        "from app.costsim.provenance import get_provenance_logger",
        "from app.costsim.v2_adapter import CostSimV2Adapter",
        "from app.worker.simulate import CostSimulator"
      ],
      "classes": [
        "CanarySample",
        "CanaryRunConfig",
        "CanaryRunner"
      ],
      "functions": [
        "run_canary"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/cost_model_engine.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/cost_model_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Cost modeling and risk estimation domain authority",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "DriftVerdict",
        "StepCostEstimate",
        "FeasibilityResult",
        "DriftAnalysis"
      ],
      "functions": [
        "get_skill_coefficients",
        "estimate_step_cost",
        "calculate_cumulative_risk",
        "check_feasibility",
        "classify_drift",
        "is_significant_risk"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/pattern_detection.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/pattern_detection.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import os",
        "from datetime import timedelta",
        "from typing import Optional",
        "from uuid import UUID",
        "from sqlalchemy import select",
        "from app.houseofcards.customer.general.utils.time import utc_now",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import get_async_session",
        "from app.models.feedback import PatternFeedback, PatternFeedbackCreate",
        "from app.models.tenant import WorkerRun"
      ],
      "classes": [],
      "functions": [
        "compute_error_signature",
        "detect_failure_patterns",
        "detect_cost_spikes",
        "emit_feedback",
        "run_pattern_detection",
        "get_feedback_summary"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/envelope.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/envelope.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Base optimization envelope definition",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Dict, List, Optional"
      ],
      "classes": [
        "DeltaType",
        "EnvelopeClass",
        "BaselineSource",
        "EnvelopeLifecycle",
        "RevertReason",
        "EnvelopeTrigger",
        "EnvelopeScope",
        "EnvelopeBounds",
        "EnvelopeTimebox",
        "EnvelopeBaseline",
        "EnvelopeAuditRecord",
        "CoordinationDecisionType",
        "CoordinationAuditRecord",
        "CoordinationDecision",
        "Envelope",
        "EnvelopeValidationError"
      ],
      "functions": [
        "get_envelope_priority",
        "has_higher_priority",
        "validate_envelope",
        "calculate_bounded_value",
        "create_audit_record"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/prediction.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/prediction.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (Advisory)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import timedelta",
        "from typing import Optional",
        "from uuid import UUID",
        "from sqlalchemy import func, select",
        "from app.houseofcards.customer.general.utils.time import utc_now",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import get_async_session",
        "from app.models.feedback import PatternFeedback",
        "from app.models.prediction import PredictionEvent, PredictionEventCreate",
        "from app.models.tenant import WorkerRun"
      ],
      "classes": [],
      "functions": [
        "predict_failure_likelihood",
        "predict_cost_overrun",
        "emit_prediction",
        "run_prediction_cycle",
        "get_prediction_summary"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/provenance.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/provenance.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import base64",
        "import gzip",
        "import hashlib",
        "import json",
        "import logging",
        "import uuid",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional",
        "from app.costsim.config import get_commit_sha, get_config"
      ],
      "classes": [
        "ProvenanceLog",
        "ProvenanceLogger"
      ],
      "functions": [
        "compute_hash",
        "compress_json",
        "get_provenance_logger"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/cb_sync_wrapper.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/cb_sync_wrapper.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import concurrent.futures",
        "import logging",
        "from typing import Optional"
      ],
      "classes": [],
      "functions": [
        "_get_executor",
        "_run_async_in_thread",
        "is_v2_disabled_sync",
        "get_state_sync",
        "shutdown_executor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/metrics.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/metrics.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from typing import Optional",
        "from app.costsim.config import get_config"
      ],
      "classes": [
        "CostSimMetrics"
      ],
      "functions": [
        "get_metrics",
        "get_alert_rules"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/s2_cost_smoothing.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/s2_cost_smoothing.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "S2 Cost smoothing envelope implementation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from app.optimization.envelope import ("
      ],
      "classes": [],
      "functions": [
        "create_s2_envelope",
        "validate_s2_envelope",
        "calculate_s2_bounded_value"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/analytics/engines/ai_console_panel_engine.py",
      "relative_path": "app/houseofcards/customer/analytics/engines/ai_console_panel_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Main orchestration engine for panel evaluation",
        "raw_layer_line": "# Layer: L4 \u2014 Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import time",
        "from typing import Any, Dict, List, Optional",
        "from .panel_consistency_checker import PanelConsistencyChecker, create_consistency_checker",
        "from .panel_dependency_resolver import PanelDependencyResolver",
        "from .panel_metrics_emitter import PanelMetricsEmitter, get_panel_metrics_emitter",
        "from .panel_response_assembler import PanelResponseAssembler, create_response_assembler",
        "from .panel_signal_collector import PanelSignalCollector, create_signal_collector",
        "from .panel_slot_evaluator import PanelSlotEvaluator",
        "from .panel_spec_loader import PanelSpecLoader, get_panel_spec_loader",
        "from .panel_types import PanelSlotResult, SlotState, VerificationSignals",
        "from .panel_verification_engine import PanelVerificationEngine"
      ],
      "classes": [
        "AIConsolePanelEngine"
      ],
      "functions": [
        "create_panel_engine",
        "get_panel_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/api_keys/facades/api_keys_facade.py",
      "relative_path": "app/houseofcards/customer/api_keys/facades/api_keys_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "API Keys domain facade - unified entry point for API key operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from typing import Any, Optional",
        "from sqlalchemy import func, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.models.tenant import APIKey"
      ],
      "classes": [
        "APIKeySummaryResult",
        "APIKeysListResult",
        "APIKeyDetailResult",
        "APIKeysFacade"
      ],
      "functions": [
        "get_api_keys_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/api_keys/engines/keys_service.py",
      "relative_path": "app/houseofcards/customer/api_keys/engines/keys_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "API Keys domain operations (L4)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import List, Optional, Tuple",
        "from sqlalchemy import and_, desc, func, select",
        "from sqlmodel import Session",
        "from app.models.killswitch import ProxyCall",
        "from app.models.tenant import APIKey"
      ],
      "classes": [
        "KeysReadService",
        "KeysWriteService"
      ],
      "functions": [
        "get_keys_read_service",
        "get_keys_write_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/api_keys/engines/email_verification.py",
      "relative_path": "app/houseofcards/customer/api_keys/engines/email_verification.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter (Console \u2192 Platform)"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import os",
        "import secrets",
        "from dataclasses import dataclass",
        "from typing import Optional",
        "import httpx",
        "from redis import Redis"
      ],
      "classes": [
        "VerificationResult",
        "EmailVerificationError",
        "EmailVerificationService"
      ],
      "functions": [
        "get_email_verification_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/alert_emitter.py",
      "relative_path": "app/houseofcards/customer/general/drivers/alert_emitter.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Emit alerts for near-threshold and breach events",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "import httpx",
        "from sqlmodel import Session, select",
        "from app.db import engine",
        "from app.models.alert_config import AlertChannel, AlertConfig",
        "from app.models.threshold_signal import SignalType, ThresholdSignal"
      ],
      "classes": [
        "AlertEmitter"
      ],
      "functions": [
        "get_alert_emitter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/db_helpers.py",
      "relative_path": "app/houseofcards/customer/general/drivers/db_helpers.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Additional database utilities",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, List, Optional, TypeVar"
      ],
      "classes": [],
      "functions": [
        "scalar_or_default",
        "scalar_or_none",
        "extract_model",
        "extract_models",
        "count_or_zero",
        "sum_or_zero",
        "query_one",
        "query_all",
        "model_to_dict",
        "models_to_dicts",
        "safe_get",
        "get_or_create"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/fatigue_controller.py",
      "relative_path": "app/houseofcards/customer/general/drivers/fatigue_controller.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "import hashlib",
        "import json"
      ],
      "classes": [
        "AlertFatigueMode",
        "AlertFatigueAction",
        "AlertFatigueConfig",
        "AlertFatigueState",
        "AlertFatigueStats",
        "AlertFatigueError",
        "FatigueCheckResult",
        "AlertFatigueController"
      ],
      "functions": [
        "get_alert_fatigue_controller",
        "_reset_controller",
        "check_alert_fatigue",
        "suppress_alert",
        "get_fatigue_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/canonical_json.py",
      "relative_path": "app/houseofcards/customer/general/drivers/canonical_json.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Canonical JSON serialization for hashing",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "from datetime import date, datetime",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Set",
        "from uuid import UUID"
      ],
      "classes": [],
      "functions": [
        "canonical_json",
        "canonical_json_bytes",
        "content_hash",
        "content_hash_full",
        "deterministic_hash",
        "_json_serializer",
        "_filter_fields",
        "is_canonical",
        "canonicalize_file",
        "assert_canonical",
        "compare_deterministic",
        "_get_nested"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/deterministic.py",
      "relative_path": "app/houseofcards/customer/general/drivers/deterministic.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Deterministic execution utilities",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import hashlib",
        "import hmac",
        "import struct",
        "import time",
        "from typing import Optional"
      ],
      "classes": [],
      "functions": [
        "seeded_jitter",
        "deterministic_backoff_ms",
        "deterministic_timestamp",
        "generate_idempotency_key",
        "hash_params"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/panel_invariant_monitor.py",
      "relative_path": "app/houseofcards/customer/general/drivers/panel_invariant_monitor.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Monitor panel invariants and detect silent governance failures",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from pathlib import Path",
        "from typing import Any, Optional",
        "import yaml"
      ],
      "classes": [
        "AlertType",
        "AlertSeverity",
        "PanelInvariant",
        "PanelStatus",
        "PanelAlert",
        "PanelInvariantRegistry",
        "PanelInvariantMonitor"
      ],
      "functions": [
        "get_panel_monitor",
        "reset_panel_monitor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/budget_tracker.py",
      "relative_path": "app/houseofcards/customer/general/drivers/budget_tracker.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Budget tracking utility",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import uuid",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Dict, Optional",
        "from sqlmodel import Session, text",
        "from ..db import Agent, engine",
        "from app.contracts.decisions import emit_budget_decision"
      ],
      "classes": [
        "BudgetStatus",
        "BudgetCheckResult",
        "BudgetTracker"
      ],
      "functions": [
        "get_budget_tracker",
        "check_budget",
        "deduct_budget",
        "record_cost",
        "enforce_budget"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/ledger.py",
      "relative_path": "app/houseofcards/customer/general/drivers/ledger.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Discovery ledger for artifact tracking",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from decimal import Decimal",
        "from typing import Any, Optional",
        "from uuid import UUID",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import text",
        "from sqlalchemy.exc import SQLAlchemyError"
      ],
      "classes": [
        "DiscoverySignal"
      ],
      "functions": [
        "emit_signal",
        "get_signals"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/idempotency.py",
      "relative_path": "app/houseofcards/customer/general/drivers/idempotency.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Idempotency key utilities",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlmodel import Session, select",
        "from ..db import Run, engine"
      ],
      "classes": [
        "IdempotencyResult"
      ],
      "functions": [
        "get_existing_run",
        "check_idempotency",
        "should_return_cached"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/rate_limiter.py",
      "relative_path": "app/houseofcards/customer/general/drivers/rate_limiter.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Rate limiting utilities",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from typing import Optional"
      ],
      "classes": [
        "RateLimiter"
      ],
      "functions": [
        "get_rate_limiter",
        "allow_request"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/guard.py",
      "relative_path": "app/houseofcards/customer/general/drivers/guard.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Guard contract for access control",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Literal, Optional",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "GuardStatusDTO",
        "TodaySnapshotDTO",
        "IncidentSummaryDTO",
        "IncidentEventDTO",
        "IncidentDetailDTO",
        "IncidentListDTO",
        "CustomerIncidentImpactDTO",
        "CustomerIncidentResolutionDTO",
        "CustomerIncidentActionDTO",
        "CustomerIncidentNarrativeDTO",
        "ApiKeyDTO",
        "ApiKeyListDTO",
        "GuardrailConfigDTO",
        "TenantSettingsDTO",
        "ReplayCallSnapshotDTO",
        "ReplayCertificateDTO",
        "ReplayResultDTO",
        "KillSwitchActionDTO",
        "OnboardingVerifyResponseDTO",
        "CustomerCostSummaryDTO",
        "CostBreakdownItemDTO",
        "CustomerCostExplainedDTO",
        "CustomerCostIncidentDTO",
        "CustomerCostIncidentListDTO"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/webhook_verify.py",
      "relative_path": "app/houseofcards/customer/general/drivers/webhook_verify.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Webhook signature verification",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import hmac",
        "import logging",
        "import os",
        "from typing import Callable, Dict, List, Optional, Union"
      ],
      "classes": [
        "WebhookVerifier"
      ],
      "functions": [
        "create_file_key_loader",
        "create_vault_key_loader",
        "verify_webhook"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/guard_cache.py",
      "relative_path": "app/houseofcards/customer/general/drivers/guard_cache.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Guard decision caching",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from typing import Dict, Optional",
        "from .metrics_helpers import get_or_create_counter, get_or_create_histogram"
      ],
      "classes": [
        "GuardCache"
      ],
      "functions": [
        "get_guard_cache"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/concurrent_runs.py",
      "relative_path": "app/houseofcards/customer/general/drivers/concurrent_runs.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Concurrent run limit enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import os",
        "import uuid",
        "from contextlib import contextmanager",
        "from typing import Optional"
      ],
      "classes": [
        "ConcurrentRunsLimiter"
      ],
      "functions": [
        "get_concurrent_limiter",
        "acquire_slot"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/input_sanitizer.py",
      "relative_path": "app/houseofcards/customer/general/drivers/input_sanitizer.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Input sanitization for security",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import re",
        "from dataclasses import dataclass",
        "from typing import List, Optional, Set",
        "from urllib.parse import urlparse"
      ],
      "classes": [
        "SanitizationResult"
      ],
      "functions": [
        "detect_injection_patterns",
        "extract_urls",
        "is_url_safe",
        "sanitize_goal",
        "validate_goal"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/runtime.py",
      "relative_path": "app/houseofcards/customer/general/drivers/runtime.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Runtime utilities",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "from datetime import datetime, timezone",
        "from uuid import uuid4"
      ],
      "classes": [],
      "functions": [
        "generate_uuid",
        "utc_now",
        "utc_now_naive"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/worker_write_service_async.py",
      "relative_path": "app/houseofcards/customer/general/drivers/worker_write_service_async.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "DB write delegation for Worker API (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "from datetime import datetime",
        "from typing import Any, Dict, Optional",
        "from sqlalchemy import select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import CostAnomaly, CostRecord",
        "from app.models.tenant import WorkerRun"
      ],
      "classes": [
        "WorkerWriteServiceAsync"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/metrics_helpers.py",
      "relative_path": "app/houseofcards/customer/general/drivers/metrics_helpers.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Metrics helper functions",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "from typing import List, Optional",
        "from prometheus_client import REGISTRY, Counter, Gauge, Histogram"
      ],
      "classes": [],
      "functions": [
        "_find_existing_metric",
        "get_or_create_counter",
        "get_or_create_gauge",
        "get_or_create_histogram",
        "validate_metric_name",
        "reset_metrics_registry"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/decisions.py",
      "relative_path": "app/houseofcards/customer/general/drivers/decisions.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Decision contract enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import uuid",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, Optional",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import SQLAlchemyError"
      ],
      "classes": [
        "DecisionType",
        "DecisionSource",
        "DecisionTrigger",
        "DecisionOutcome",
        "CausalRole",
        "DecisionRecord",
        "DecisionRecordService",
        "CARESignalAccessError"
      ],
      "functions": [
        "get_decision_service",
        "emit_routing_decision",
        "emit_recovery_decision",
        "emit_memory_decision",
        "emit_policy_decision",
        "emit_budget_decision",
        "_check_budget_enforcement_exists",
        "emit_budget_enforcement_decision",
        "_check_policy_precheck_exists",
        "emit_policy_precheck_decision",
        "_check_recovery_evaluation_exists",
        "emit_recovery_evaluation_decision",
        "backfill_run_id_for_request",
        "check_signal_access",
        "activate_care_kill_switch",
        "deactivate_care_kill_switch",
        "is_care_kill_switch_active",
        "_check_care_optimization_exists",
        "emit_care_optimization_decision"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/schema_parity.py",
      "relative_path": "app/houseofcards/customer/general/drivers/schema_parity.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Schema parity checking utilities",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import List, Optional, Tuple",
        "from sqlalchemy import inspect",
        "from sqlalchemy.engine import Engine",
        "from sqlmodel import SQLModel"
      ],
      "classes": [
        "SchemaParityError"
      ],
      "functions": [
        "check_schema_parity",
        "check_m26_cost_tables",
        "run_startup_parity_check"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/drivers/plan_inspector.py",
      "relative_path": "app/houseofcards/customer/general/drivers/plan_inspector.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Plan structure inspection",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional, Set",
        "from urllib.parse import urlparse"
      ],
      "classes": [
        "PlanValidationError",
        "PlanValidationResult"
      ],
      "functions": [
        "extract_urls_from_params",
        "is_domain_forbidden",
        "validate_step",
        "validate_plan",
        "inspect_plan"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/facades/monitors_facade.py",
      "relative_path": "app/houseofcards/customer/general/facades/monitors_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Monitors Facade - Centralized access to monitoring operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "MonitorType",
        "MonitorStatus",
        "CheckStatus",
        "MonitorConfig",
        "HealthCheckResult",
        "MonitorStatusSummary",
        "MonitorsFacade"
      ],
      "functions": [
        "get_monitors_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/facades/alerts_facade.py",
      "relative_path": "app/houseofcards/customer/general/facades/alerts_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Alerts Facade - Centralized access to alert operations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "AlertSeverity",
        "AlertStatus",
        "AlertRule",
        "AlertEvent",
        "AlertRoute",
        "AlertsFacade"
      ],
      "functions": [
        "get_alerts_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/facades/scheduler_facade.py",
      "relative_path": "app/houseofcards/customer/general/facades/scheduler_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Scheduler Facade - Centralized access to job scheduling operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "JobStatus",
        "JobRunStatus",
        "ScheduledJob",
        "JobRun",
        "SchedulerFacade"
      ],
      "functions": [
        "get_scheduler_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/facades/compliance_facade.py",
      "relative_path": "app/houseofcards/customer/general/facades/compliance_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Compliance Facade - Centralized access to compliance operations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "ComplianceScope",
        "ComplianceStatus",
        "ComplianceRule",
        "ComplianceViolation",
        "ComplianceReport",
        "ComplianceStatusInfo",
        "ComplianceFacade"
      ],
      "functions": [
        "get_compliance_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/facades/lifecycle_facade.py",
      "relative_path": "app/houseofcards/customer/general/facades/lifecycle_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Lifecycle Facade - Centralized access to lifecycle operations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "AgentState",
        "RunState",
        "AgentLifecycle",
        "RunLifecycle",
        "LifecycleSummary",
        "LifecycleFacade"
      ],
      "functions": [
        "get_lifecycle_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/engines/cus_health_service.py",
      "relative_path": "app/houseofcards/customer/general/engines/cus_health_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Health checking for customer LLM integrations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "import httpx",
        "from sqlmodel import Session, select",
        "from app.db import get_engine",
        "from app.models.cus_models import CusHealthState, CusIntegration",
        "from app.services.cus_credential_service import CusCredentialService"
      ],
      "classes": [
        "CusHealthService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/engines/cus_telemetry_service.py",
      "relative_path": "app/houseofcards/customer/general/engines/cus_telemetry_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Business logic for customer LLM telemetry ingestion and querying",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def compute_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import date, datetime, timezone",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from uuid import uuid4",
        "from sqlalchemy import func, select, and_",
        "from sqlalchemy.dialects.postgresql import insert as pg_insert",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import get_async_session",
        "from app.models.cus_models import (",
        "from app.schemas.cus_schemas import ("
      ],
      "classes": [
        "CusTelemetryService"
      ],
      "functions": [
        "utc_now"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/engines/knowledge_lifecycle_manager.py",
      "relative_path": "app/houseofcards/customer/general/engines/knowledge_lifecycle_manager.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "GAP-086 Knowledge Lifecycle Manager (THE ORCHESTRATOR)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional",
        "from uuid import uuid4",
        "from app.models.knowledge_lifecycle import ("
      ],
      "classes": [
        "GateDecision",
        "GateResult",
        "LifecycleAuditEventType",
        "LifecycleAuditEvent",
        "KnowledgePlaneLifecycle",
        "TransitionRequest",
        "TransitionResponse",
        "KnowledgeLifecycleManager"
      ],
      "functions": [
        "utc_now",
        "generate_id",
        "get_knowledge_lifecycle_manager",
        "reset_manager"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/engines/cus_enforcement_service.py",
      "relative_path": "app/houseofcards/customer/general/engines/cus_enforcement_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Enforcement policy evaluation for customer LLM integrations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import date, datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from sqlmodel import Session, func, select",
        "from app.db import get_engine",
        "from app.models.cus_models import ("
      ],
      "classes": [
        "EnforcementResult",
        "EnforcementReason",
        "EnforcementDecision",
        "CusEnforcementService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/engines/knowledge_sdk.py",
      "relative_path": "app/houseofcards/customer/general/engines/knowledge_sdk.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "GAP-083-085 Knowledge SDK Fa\u00e7ade",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "time\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import time",
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from app.models.knowledge_lifecycle import (",
        "from app.services.knowledge_lifecycle_manager import ("
      ],
      "classes": [
        "KnowledgePlaneConfig",
        "WaitOptions",
        "SDKResult",
        "PlaneInfo",
        "KnowledgeSDK"
      ],
      "functions": [
        "create_knowledge_sdk"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/engines/alert_log_linker.py",
      "relative_path": "app/houseofcards/customer/general/engines/alert_log_linker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Link alerts to log records for explicit correlation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Set"
      ],
      "classes": [
        "AlertLogLinkType",
        "AlertLogLinkStatus",
        "AlertLogLinkError",
        "AlertLogLink",
        "AlertLogLinkResponse",
        "AlertLogLinker"
      ],
      "functions": [
        "get_alert_log_linker",
        "_reset_alert_log_linker",
        "create_alert_log_link",
        "get_alerts_for_run",
        "get_logs_for_alert"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/engines/control_registry.py",
      "relative_path": "app/houseofcards/customer/general/engines/control_registry.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "SOC2 Trust Service Criteria control registry",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "SOC2Category",
        "SOC2ComplianceStatus",
        "SOC2Control",
        "SOC2ControlMapping",
        "SOC2ControlRegistry"
      ],
      "functions": [
        "get_control_registry"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/engines/lifecycle_stages_base.py",
      "relative_path": "app/houseofcards/customer/general/engines/lifecycle_stages_base.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Stage Handler Protocol and Base Types",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Handler\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Any, Dict, Optional, Protocol, Type, runtime_checkable",
        "from app.models.knowledge_lifecycle import KnowledgePlaneLifecycleState"
      ],
      "classes": [
        "StageStatus",
        "StageContext",
        "StageResult",
        "StageHandler",
        "BaseStageHandler",
        "StageRegistry"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/schemas/plan.py",
      "relative_path": "app/houseofcards/customer/general/schemas/plan.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Plan API schemas",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, ConfigDict, Field, field_validator",
        "from .retry import RetryPolicy"
      ],
      "classes": [
        "OnErrorPolicy",
        "StepStatus",
        "ConditionOperator",
        "StepCondition",
        "PlanStep",
        "PlanMetadata",
        "Plan"
      ],
      "functions": [
        "_utc_now"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/schemas/response.py",
      "relative_path": "app/houseofcards/customer/general/schemas/response.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Standard API response envelope for consistent client experience",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import uuid",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Generic, List, Optional, TypeVar",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "ResponseMeta",
        "ResponseEnvelope",
        "ErrorDetail"
      ],
      "functions": [
        "ok",
        "error",
        "paginated",
        "wrap_dict",
        "wrap_list",
        "wrap_error"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/schemas/artifact.py",
      "relative_path": "app/houseofcards/customer/general/schemas/artifact.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Artifact API schemas",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, Optional",
        "from pydantic import BaseModel, ConfigDict, Field"
      ],
      "classes": [
        "ArtifactType",
        "StorageBackend",
        "Artifact",
        "ArtifactReference"
      ],
      "functions": [
        "_utc_now"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/schemas/skill.py",
      "relative_path": "app/houseofcards/customer/general/schemas/skill.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Skill API schemas",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Union",
        "from pydantic import BaseModel, ConfigDict, Field, field_validator"
      ],
      "classes": [
        "SkillStatus",
        "SkillInputBase",
        "SkillOutputBase",
        "HttpMethod",
        "HttpCallInput",
        "HttpCallOutput",
        "LLMProvider",
        "LLMMessage",
        "LLMInvokeInput",
        "LLMInvokeOutput",
        "FileReadInput",
        "FileReadOutput",
        "FileWriteInput",
        "FileWriteOutput",
        "PostgresQueryInput",
        "PostgresQueryOutput",
        "JsonTransformInput",
        "JsonTransformOutput",
        "EmailSendInput",
        "EmailSendOutput",
        "KVOperation",
        "KVStoreInput",
        "KVStoreOutput",
        "SlackSendInput",
        "SlackSendOutput",
        "WebhookSendInput",
        "WebhookSendOutput",
        "VoyageModel",
        "VoyageInputType",
        "VoyageEmbedInput",
        "VoyageEmbedOutput",
        "SkillMetadata"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/schemas/agent.py",
      "relative_path": "app/houseofcards/customer/general/schemas/agent.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Agent API request/response schemas",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, ConfigDict, Field",
        "from .retry import RetryPolicy"
      ],
      "classes": [
        "AgentStatus",
        "PlannerType",
        "PlannerConfig",
        "RateLimitConfig",
        "BudgetConfig",
        "AgentCapabilities",
        "AgentConfig"
      ],
      "functions": [
        "_utc_now"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/schemas/common.py",
      "relative_path": "app/houseofcards/customer/general/schemas/common.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Common contract definitions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "HealthDTO",
        "HealthDetailDTO",
        "ErrorDTO",
        "ValidationErrorDTO",
        "PaginationMetaDTO",
        "CursorPaginationMetaDTO",
        "ActionResultDTO",
        "ContractVersionDTO"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/ui/engines/rollout_projection.py",
      "relative_path": "app/houseofcards/customer/general/ui/engines/rollout_projection.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Rollout Projection - read-only projection of audited truth",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (Projection)"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "RolloutStage",
        "BlastRadius",
        "StabilizationWindow",
        "ContractSummary",
        "ExecutionSummary",
        "AuditSummary",
        "RolloutPlan",
        "FounderRolloutView",
        "GovernanceCompletionReport",
        "CustomerRolloutView",
        "RolloutProjectionService"
      ],
      "functions": [
        "founder_view_to_dict",
        "completion_report_to_dict"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/workflow/contracts/engines/contract_service.py",
      "relative_path": "app/houseofcards/customer/general/workflow/contracts/engines/contract_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Contract Service - stateful contract state machine",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from decimal import Decimal",
        "from typing import Any, Optional",
        "from uuid import UUID, uuid4",
        "from app.models.contract import (",
        "from app.services.governance.eligibility_engine import (",
        "from app.services.governance.validator_service import ValidatorVerdict"
      ],
      "classes": [
        "ContractState",
        "ContractStateMachine",
        "ContractService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/lifecycle/drivers/knowledge_plane.py",
      "relative_path": "app/houseofcards/customer/general/lifecycle/drivers/knowledge_plane.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "import uuid"
      ],
      "classes": [
        "KnowledgePlaneStatus",
        "KnowledgeNodeType",
        "KnowledgeNode",
        "KnowledgePlane",
        "KnowledgePlaneError",
        "KnowledgePlaneStats",
        "KnowledgePlaneRegistry"
      ],
      "functions": [
        "get_knowledge_plane_registry",
        "_reset_registry",
        "create_knowledge_plane",
        "get_knowledge_plane",
        "list_knowledge_planes"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/lifecycle/drivers/execution.py",
      "relative_path": "app/houseofcards/customer/general/lifecycle/drivers/execution.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Real execution implementations for lifecycle stage handlers",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import hashlib",
        "import logging",
        "import re",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, Iterator, List, Optional, Tuple"
      ],
      "classes": [
        "IngestionSourceType",
        "IngestionBatch",
        "IngestionResult",
        "DataIngestionExecutor",
        "IndexingResult",
        "IndexingExecutor",
        "SensitivityLevel",
        "PIIType",
        "PIIDetection",
        "ClassificationResult",
        "ClassificationExecutor"
      ],
      "functions": [
        "get_ingestion_executor",
        "get_indexing_executor",
        "get_classification_executor",
        "reset_executors"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/lifecycle/engines/onboarding.py",
      "relative_path": "app/houseofcards/customer/general/lifecycle/engines/onboarding.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Onboarding Stage Handlers (GAP-071 to GAP-077)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Handler\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import hashlib",
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional",
        "from app.models.knowledge_lifecycle import KnowledgePlaneLifecycleState",
        "from .base import BaseStageHandler, StageContext, StageResult, StageStatus"
      ],
      "classes": [
        "RegisterHandler",
        "VerifyHandler",
        "IngestHandler",
        "IndexHandler",
        "ClassifyHandler",
        "ActivateHandler",
        "GovernHandler"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/lifecycle/engines/offboarding.py",
      "relative_path": "app/houseofcards/customer/general/lifecycle/engines/offboarding.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Offboarding Stage Handlers (GAP-078 to GAP-082)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Handler\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import hashlib",
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from app.models.knowledge_lifecycle import KnowledgePlaneLifecycleState",
        "from .base import BaseStageHandler, StageContext, StageResult"
      ],
      "classes": [
        "DeregisterHandler",
        "VerifyDeactivateHandler",
        "DeactivateHandler",
        "ArchiveHandler",
        "PurgeHandler"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/lifecycle/engines/pool_manager.py",
      "relative_path": "app/houseofcards/customer/general/lifecycle/engines/pool_manager.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Unified connection pool manager with health checking",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, Optional"
      ],
      "classes": [
        "PoolType",
        "PoolStatus",
        "PoolConfig",
        "PoolStats",
        "PoolHandle",
        "ConnectionPoolManager"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/lifecycle/engines/base.py",
      "relative_path": "app/houseofcards/customer/general/lifecycle/engines/base.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Stage Handler Protocol and Base Types",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Handler\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Any, Dict, Optional, Protocol, Type, runtime_checkable",
        "from app.models.knowledge_lifecycle import KnowledgePlaneLifecycleState"
      ],
      "classes": [
        "StageStatus",
        "StageContext",
        "StageResult",
        "StageHandler",
        "BaseStageHandler",
        "StageRegistry"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/controls/engines/guard_write_service.py",
      "relative_path": "app/houseofcards/customer/general/controls/engines/guard_write_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for Guard API (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import uuid",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import List, Optional, Tuple",
        "from sqlalchemy import and_, select",
        "from sqlmodel import Session",
        "from app.models.killswitch import ("
      ],
      "classes": [
        "GuardWriteService"
      ],
      "functions": [
        "utc_now"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/runtime/drivers/transaction_coordinator.py",
      "relative_path": "app/houseofcards/customer/general/runtime/drivers/transaction_coordinator.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Transaction Coordinator for atomic cross-domain writes",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional",
        "from uuid import UUID",
        "from sqlmodel import Session",
        "from app.db import engine",
        "from app.events import get_publisher",
        "from app.services.audit import ("
      ],
      "classes": [
        "TransactionPhase",
        "TransactionFailed",
        "DomainResult",
        "TransactionResult",
        "RollbackAction",
        "RunCompletionTransaction"
      ],
      "functions": [
        "get_transaction_coordinator",
        "create_transaction_coordinator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/runtime/facades/run_governance_facade.py",
      "relative_path": "app/houseofcards/customer/general/runtime/facades/run_governance_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Run Governance Facade - Centralized access to governance operations for runs",
        "raw_layer_line": "# Layer: L3 \u2014 Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "RunGovernanceFacade"
      ],
      "functions": [
        "get_run_governance_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/runtime/engines/phase_status_invariants.py",
      "relative_path": "app/houseofcards/customer/general/runtime/engines/phase_status_invariants.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-status invariant enforcement from GovernanceConfig",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, FrozenSet, Optional"
      ],
      "classes": [
        "InvariantCheckResult",
        "PhaseStatusInvariantEnforcementError",
        "InvariantCheckResponse",
        "PhaseStatusInvariantChecker"
      ],
      "functions": [
        "check_phase_status_invariant",
        "ensure_phase_status_invariant"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/runtime/engines/plan_generation_engine.py",
      "relative_path": "app/houseofcards/customer/general/runtime/engines/plan_generation_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Plan generation (domain logic)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from app.memory import get_retriever",
        "from app.planners import get_planner",
        "from app.skills import get_skill_manifest",
        "from app.utils.budget_tracker import get_budget_tracker",
        "from app.utils.plan_inspector import validate_plan"
      ],
      "classes": [
        "PlanGenerationContext",
        "PlanGenerationResult",
        "PlanGenerationEngine"
      ],
      "functions": [
        "generate_plan_for_run"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/runtime/engines/constraint_checker.py",
      "relative_path": "app/houseofcards/customer/general/runtime/engines/constraint_checker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Enforce MonitorConfig inspection constraints before logging",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "InspectionOperation",
        "InspectionConstraintViolation",
        "InspectionConstraintChecker"
      ],
      "functions": [
        "check_inspection_allowed",
        "get_constraint_violations"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/runtime/engines/governance_orchestrator.py",
      "relative_path": "app/houseofcards/customer/general/runtime/engines/governance_orchestrator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Governance Orchestrator - orchestrates contract execution",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Optional, Protocol",
        "from uuid import UUID, uuid4",
        "from app.models.contract import (",
        "from app.models.governance_job import (",
        "from app.services.governance.contract_service import ContractService, ContractState"
      ],
      "classes": [
        "HealthLookup",
        "JobState",
        "JobStateMachine",
        "ExecutionOrchestrator",
        "JobStateTracker",
        "AuditEvidence",
        "AuditTrigger",
        "ContractActivationError",
        "ContractActivationService",
        "GovernanceOrchestrator"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/general/cross-domain/drivers/cross_domain.py",
      "relative_path": "app/houseofcards/customer/general/cross-domain/drivers/cross_domain.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Cross-Domain Governance - Mandatory data integrity functions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import uuid",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import Optional, Union",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from sqlmodel import Session",
        "from app.errors.governance import GovernanceError",
        "from app.metrics import (",
        "from app.models.killswitch import Incident",
        "from app.models.policy_control_plane import LimitBreach"
      ],
      "classes": [],
      "functions": [
        "utc_now",
        "generate_uuid",
        "create_incident_from_cost_anomaly",
        "record_limit_breach",
        "table_exists",
        "create_incident_from_cost_anomaly_sync",
        "record_limit_breach_sync"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/overview/facades/overview_facade.py",
      "relative_path": "app/houseofcards/customer/overview/facades/overview_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Overview Facade - Centralized access to overview domain operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Services"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta",
        "from typing import Any, Dict, List, Optional",
        "from sqlalchemy import and_, case, func, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.houseofcards.customer.general.utils.time import utc_now",
        "from app.models.audit_ledger import AuditLedger",
        "from app.models.killswitch import Incident, IncidentLifecycleState",
        "from app.models.policy import PolicyProposal",
        "from app.models.policy_control_plane import Limit, LimitBreach, LimitCategory",
        "from app.models.tenant import WorkerRun"
      ],
      "classes": [
        "SystemPulse",
        "DomainCount",
        "HighlightsResult",
        "DecisionItem",
        "DecisionsResult",
        "CostPeriod",
        "LimitCostItem",
        "CostsResult",
        "DecisionsCountResult",
        "RecoveryStatsResult",
        "OverviewFacade"
      ],
      "functions": [
        "get_overview_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/traces_metrics.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/traces_metrics.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Trace metrics collection",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import functools",
        "import logging",
        "import time",
        "from contextlib import contextmanager",
        "from typing import Callable, Optional"
      ],
      "classes": [
        "TracesMetrics"
      ],
      "functions": [
        "get_traces_metrics",
        "instrument_trace_request",
        "instrument_replay_check",
        "instrument_parity_check"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/job_execution.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/job_execution.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Job execution support services (retry, progress, audit)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import random",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional"
      ],
      "classes": [
        "RetryStrategy",
        "RetryConfig",
        "RetryAttempt",
        "JobRetryManager",
        "ProgressStage",
        "ProgressUpdate",
        "JobProgressTracker",
        "JobAuditEventType",
        "JobAuditEvent",
        "JobAuditEmitter"
      ],
      "functions": [
        "_hash_value",
        "get_job_retry_manager",
        "get_job_progress_tracker",
        "get_job_audit_emitter",
        "reset_job_execution_services"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/pdf_renderer.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/pdf_renderer.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Render export bundles to PDF format",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import io",
        "import logging",
        "from datetime import datetime",
        "from typing import Optional",
        "from reportlab.lib import colors",
        "from reportlab.lib.enums import TA_CENTER, TA_LEFT",
        "from reportlab.lib.pagesizes import letter",
        "from reportlab.lib.styles import ParagraphStyle, getSampleStyleSheet",
        "from reportlab.lib.units import inch",
        "from reportlab.platypus import (",
        "from app.models.export_bundles import ("
      ],
      "classes": [
        "PDFRenderer"
      ],
      "functions": [
        "get_pdf_renderer"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/redact.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/redact.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Trace data redaction for security",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import copy",
        "import re",
        "from typing import Any"
      ],
      "classes": [],
      "functions": [
        "redact_json_string",
        "redact_dict",
        "redact_list",
        "redact_string_value",
        "redact_trace_data",
        "is_sensitive_field",
        "add_sensitive_field",
        "add_redaction_pattern"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/idempotency.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/idempotency.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Trace idempotency enforcement (Redis + Lua scripts)",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from pathlib import Path",
        "from typing import Any, Dict, Optional"
      ],
      "classes": [
        "IdempotencyResult",
        "IdempotencyResponse",
        "RedisIdempotencyStore",
        "InMemoryIdempotencyStore"
      ],
      "functions": [
        "_load_lua_script",
        "canonical_json",
        "hash_request",
        "get_idempotency_store"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/panel_consistency_checker.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/panel_consistency_checker.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Cross-slot consistency enforcement",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional",
        "from .panel_types import PanelSlotResult"
      ],
      "classes": [
        "ConsistencyViolation",
        "ConsistencyCheckResult",
        "PanelConsistencyChecker"
      ],
      "functions": [
        "create_consistency_checker"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/pg_store.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/pg_store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "PostgreSQL trace storage",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import json",
        "import os",
        "import uuid",
        "from datetime import datetime, timezone",
        "from typing import Any",
        "from .models import TraceRecord, TraceStatus, TraceStep, TraceSummary",
        "from .redact import redact_trace_data"
      ],
      "classes": [
        "PostgresTraceStore"
      ],
      "functions": [
        "_status_to_level",
        "get_postgres_trace_store"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/alert_fatigue.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/alert_fatigue.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Alert deduplication and fatigue control",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from threading import Lock",
        "from typing import Any, Dict, FrozenSet, List, Optional"
      ],
      "classes": [
        "AlertSuppressReason",
        "AlertRecord",
        "TenantFatigueSettings",
        "AlertCheckResult",
        "AlertFatigueController"
      ],
      "functions": [
        "get_alert_fatigue_controller",
        "reset_alert_fatigue_controller"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/store.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Storage for audit expectations and acknowledgments",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from threading import Lock",
        "from typing import Dict, List, Optional",
        "from uuid import UUID",
        "from app.services.audit.models import ("
      ],
      "classes": [
        "StoreDurabilityMode",
        "RACDurabilityError",
        "AuditStore"
      ],
      "functions": [
        "_determine_durability_mode",
        "get_audit_store"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/integrity.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/integrity.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Integrity computation with separated concerns",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import json",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import SQLAlchemyError",
        "import os"
      ],
      "classes": [
        "IntegrityState",
        "IntegrityGrade",
        "EvidenceClass",
        "FailureResolution",
        "CaptureFailure",
        "IntegrityFacts",
        "IntegrityAssembler",
        "IntegrityEvaluation",
        "IntegrityEvaluator"
      ],
      "functions": [
        "compute_integrity_v2"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/audit_evidence.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/audit_evidence.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Emit compliance-grade audit for MCP tool calls",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "MCPAuditEventType",
        "MCPAuditEvent",
        "MCPAuditEmitter"
      ],
      "functions": [
        "_hash_value",
        "_contains_sensitive",
        "_redact_sensitive",
        "get_mcp_audit_emitter",
        "configure_mcp_audit_emitter",
        "reset_mcp_audit_emitter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/traces_store.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/traces_store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Trace store abstraction",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import json",
        "import sqlite3",
        "import uuid",
        "from abc import ABC, abstractmethod",
        "from datetime import datetime, timezone",
        "from pathlib import Path",
        "from typing import Any",
        "from .models import TraceRecord, TraceStatus, TraceStep, TraceSummary"
      ],
      "classes": [
        "TraceStore",
        "SQLiteTraceStore",
        "InMemoryTraceStore"
      ],
      "functions": [
        "generate_correlation_id",
        "generate_run_id"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/traces_models.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/traces_models.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Trace data models",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, ClassVar"
      ],
      "classes": [
        "TraceStatus",
        "TraceStep",
        "TraceSummary",
        "TraceRecord",
        "ParityResult"
      ],
      "functions": [
        "_normalize_for_determinism",
        "compare_traces"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/audit_store.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/audit_store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Storage for audit expectations and acknowledgments",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from threading import Lock",
        "from typing import Dict, List, Optional",
        "from uuid import UUID",
        "from app.services.audit.models import ("
      ],
      "classes": [
        "StoreDurabilityMode",
        "RACDurabilityError",
        "AuditStore"
      ],
      "functions": [
        "_determine_durability_mode",
        "get_audit_store"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/drivers/replay.py",
      "relative_path": "app/houseofcards/customer/logs/drivers/replay.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Trace replay execution",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, Awaitable, Callable, Optional"
      ],
      "classes": [
        "ReplayBehavior",
        "ReplayMismatchError",
        "IdempotencyViolationError",
        "ReplayResult",
        "ReplayEnforcer",
        "IdempotencyStore",
        "InMemoryIdempotencyStore",
        "RedisIdempotencyStore"
      ],
      "functions": [
        "hash_output",
        "get_replay_enforcer"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/facades/trace_facade.py",
      "relative_path": "app/houseofcards/customer/logs/facades/trace_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": "CUSTOMER",
        "role": "Trace Domain Facade - Centralized access to trace operations with RAC acks",
        "raw_layer_line": "# Layer: L3 \u2014 Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "TraceFacade"
      ],
      "functions": [
        "get_trace_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/facades/evidence_facade.py",
      "relative_path": "app/houseofcards/customer/logs/facades/evidence_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Evidence Facade - Centralized access to evidence and export operations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid",
        "import hashlib",
        "import json"
      ],
      "classes": [
        "EvidenceType",
        "ExportFormat",
        "ExportStatus",
        "EvidenceLink",
        "EvidenceChain",
        "VerificationResult",
        "EvidenceExport",
        "EvidenceFacade"
      ],
      "functions": [
        "get_evidence_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/facades/logs_facade.py",
      "relative_path": "app/houseofcards/customer/logs/facades/logs_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Logs domain facade - unified entry point for all logs operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Literal, Optional",
        "from sqlalchemy import func, select, text",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.models.audit_ledger import AuditLedger",
        "from app.models.log_exports import LogExport",
        "from app.models.logs_records import LLMRunRecord, SystemRecord"
      ],
      "classes": [
        "SourceDomain",
        "Origin",
        "EvidenceMetadataResult",
        "LLMRunRecordResult",
        "LLMRunRecordsResult",
        "TraceStepResult",
        "LLMRunEnvelopeResult",
        "LLMRunTraceResult",
        "GovernanceEventResult",
        "LLMRunGovernanceResult",
        "ReplayEventResult",
        "LLMRunReplayResult",
        "LLMRunExportResult",
        "SystemRecordResult",
        "SystemRecordsResult",
        "SystemSnapshotResult",
        "TelemetryStubResult",
        "SystemEventResult",
        "SystemEventsResult",
        "SystemReplayResult",
        "SystemAuditResult",
        "AuditLedgerItemResult",
        "AuditLedgerDetailResult",
        "AuditLedgerListResult",
        "IdentityEventResult",
        "AuditIdentityResult",
        "AuthorizationDecisionResult",
        "AuditAuthorizationResult",
        "AccessEventResult",
        "AuditAccessResult",
        "IntegrityCheckResult",
        "AuditIntegrityResult",
        "ExportRecordResult",
        "AuditExportsResult",
        "LogsFacade"
      ],
      "functions": [
        "get_logs_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/reconciler.py",
      "relative_path": "app/houseofcards/customer/logs/engines/reconciler.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Reconcile audit expectations against acknowledgments",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import List, Optional, Set, Tuple",
        "from uuid import UUID",
        "from prometheus_client import Counter, Histogram",
        "from app.services.audit.models import (",
        "from app.services.audit.store import AuditStore, get_audit_store"
      ],
      "classes": [
        "AuditReconciler"
      ],
      "functions": [
        "get_audit_reconciler"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/cost_anomaly_detector.py",
      "relative_path": "app/houseofcards/customer/logs/engines/cost_anomaly_detector.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import date, datetime, timedelta",
        "from enum import Enum",
        "from typing import List, Optional",
        "from sqlalchemy import text",
        "from sqlmodel import Session, select",
        "from app.db import (",
        "from app.services.governance.cross_domain import create_incident_from_cost_anomaly_sync"
      ],
      "classes": [
        "AnomalyType",
        "AnomalySeverity",
        "DerivedCause",
        "DetectedAnomaly",
        "CostAnomalyDetector"
      ],
      "functions": [
        "classify_severity",
        "run_anomaly_detection",
        "run_anomaly_detection_with_governance"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/export_bundle_service.py",
      "relative_path": "app/houseofcards/customer/logs/engines/export_bundle_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Generate structured export bundles from incidents and traces",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter (Console \u2192 Platform)"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlmodel import Session, select",
        "from app.db import Incident, Run, engine",
        "from app.models.export_bundles import (",
        "from app.traces.store import TraceStore"
      ],
      "classes": [
        "ExportBundleService"
      ],
      "functions": [
        "get_export_bundle_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/monitors_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/monitors_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Monitors Facade - Centralized access to monitoring operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "MonitorType",
        "MonitorStatus",
        "CheckStatus",
        "MonitorConfig",
        "HealthCheckResult",
        "MonitorStatusSummary",
        "MonitorsFacade"
      ],
      "functions": [
        "get_monitors_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/evidence_report.py",
      "relative_path": "app/houseofcards/customer/logs/engines/evidence_report.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "See file: evidence_report.py",
        "raw_layer_line": "# Layer: L4 \u2014 Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import io",
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from reportlab.lib import colors",
        "from reportlab.lib.enums import TA_CENTER",
        "from reportlab.lib.pagesizes import letter",
        "from reportlab.lib.styles import ParagraphStyle, getSampleStyleSheet",
        "from reportlab.lib.units import inch",
        "from reportlab.platypus import ("
      ],
      "classes": [
        "CertificateEvidence",
        "IncidentEvidence",
        "EvidenceReportGenerator"
      ],
      "functions": [
        "generate_evidence_report"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/notifications_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/notifications_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Notifications Facade - Centralized access to notification operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "NotificationChannel",
        "NotificationPriority",
        "NotificationStatus",
        "NotificationInfo",
        "ChannelInfo",
        "NotificationPreferences",
        "NotificationsFacade"
      ],
      "functions": [
        "get_notifications_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/logs_read_service.py",
      "relative_path": "app/houseofcards/customer/logs/engines/logs_read_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Logs/Traces domain read operations (L4)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import List, Optional",
        "from app.traces.models import TraceRecord, TraceSummary",
        "from app.traces.pg_store import PostgresTraceStore, get_postgres_trace_store"
      ],
      "classes": [
        "LogsReadService"
      ],
      "functions": [
        "get_logs_read_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/certificate.py",
      "relative_path": "app/houseofcards/customer/logs/engines/certificate.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter (Console \u2192 Platform)"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import hmac",
        "import json",
        "import os",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from app.services.replay_determinism import ("
      ],
      "classes": [
        "CertificateType",
        "CertificatePayload",
        "Certificate",
        "CertificateService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/alerts_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/alerts_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Alerts Facade - Centralized access to alert operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "AlertSeverity",
        "AlertStatus",
        "AlertRule",
        "AlertEvent",
        "AlertRoute",
        "AlertsFacade"
      ],
      "functions": [
        "get_alerts_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/cus_telemetry_service.py",
      "relative_path": "app/houseofcards/customer/logs/engines/cus_telemetry_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Business logic for customer LLM telemetry ingestion and querying",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def compute_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import date, datetime, timezone",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from uuid import uuid4",
        "from sqlalchemy import func, select, and_",
        "from sqlalchemy.dialects.postgresql import insert as pg_insert",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import get_async_session",
        "from app.models.cus_models import (",
        "from app.schemas.cus_schemas import ("
      ],
      "classes": [
        "CusTelemetryService"
      ],
      "functions": [
        "utc_now"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/replay_determinism.py",
      "relative_path": "app/houseofcards/customer/logs/engines/replay_determinism.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Replay determinism validation for LLM calls \u2014 CANONICAL DEFINITIONS",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "DeterminismLevel",
        "ModelVersion",
        "PolicyDecision",
        "ReplayMatch",
        "ReplayResult",
        "CallRecord",
        "ReplayValidator",
        "ReplayContextBuilder"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/retrieval_mediator.py",
      "relative_path": "app/houseofcards/customer/logs/engines/retrieval_mediator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Unified mediation layer for all external data access",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional, Protocol, runtime_checkable",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "import hashlib",
        "import json",
        "import logging"
      ],
      "classes": [
        "MediationAction",
        "MediatedResult",
        "PolicyCheckResult",
        "EvidenceRecord",
        "MediationDeniedError",
        "Connector",
        "ConnectorRegistry",
        "PolicyChecker",
        "EvidenceService",
        "RetrievalMediator"
      ],
      "functions": [
        "get_retrieval_mediator",
        "configure_retrieval_mediator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/scheduler_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/scheduler_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Scheduler Facade - Centralized access to job scheduling operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "JobStatus",
        "JobRunStatus",
        "ScheduledJob",
        "JobRun",
        "SchedulerFacade"
      ],
      "functions": [
        "get_scheduler_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/detection_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/detection_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Detection Facade - Centralized access to anomaly detection operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "DetectionType",
        "AnomalySeverity",
        "AnomalyStatus",
        "DetectionResult",
        "AnomalyInfo",
        "DetectionStatusInfo",
        "DetectionFacade"
      ],
      "functions": [
        "get_detection_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/compliance_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/compliance_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Compliance Facade - Centralized access to compliance operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "ComplianceScope",
        "ComplianceStatus",
        "ComplianceRule",
        "ComplianceViolation",
        "ComplianceReport",
        "ComplianceStatusInfo",
        "ComplianceFacade"
      ],
      "functions": [
        "get_compliance_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/service.py",
      "relative_path": "app/houseofcards/customer/logs/engines/service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "High-level credential service with validation and auditing",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from .vault import ("
      ],
      "classes": [
        "CredentialAccessRecord",
        "CredentialService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/pattern_detection.py",
      "relative_path": "app/houseofcards/customer/logs/engines/pattern_detection.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import os",
        "from datetime import datetime, timedelta",
        "from typing import Optional",
        "from uuid import UUID",
        "from sqlalchemy import select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import get_async_session",
        "from app.models.feedback import PatternFeedback, PatternFeedbackCreate",
        "from app.models.tenant import WorkerRun"
      ],
      "classes": [],
      "functions": [
        "compute_error_signature",
        "detect_failure_patterns",
        "detect_cost_spikes",
        "emit_feedback",
        "run_pattern_detection",
        "get_feedback_summary"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/datasources_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/datasources_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DataSources Facade - Centralized access to data source operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from app.services.datasources.datasource_model import ("
      ],
      "classes": [
        "TestConnectionResult",
        "DataSourcesFacade"
      ],
      "functions": [
        "get_datasources_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/export_completeness_checker.py",
      "relative_path": "app/houseofcards/customer/logs/engines/export_completeness_checker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Evidence PDF completeness validation for SOC2 compliance",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Dict, FrozenSet, List, Optional, Set"
      ],
      "classes": [
        "CompletenessCheckResult",
        "EvidenceCompletenessError",
        "CompletenessCheckResponse",
        "EvidenceCompletenessChecker"
      ],
      "functions": [
        "check_evidence_completeness",
        "ensure_evidence_completeness"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/cus_integration_service.py",
      "relative_path": "app/houseofcards/customer/logs/engines/cus_integration_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Business logic for Customer Integration domain (LLM BYOK, SDK, RAG)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import date, datetime, timezone",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from uuid import UUID, uuid4",
        "from sqlmodel import Session, col, func, select",
        "from app.db import get_engine",
        "from app.models.cus_models import (",
        "from app.schemas.cus_schemas import CusLimitsStatus"
      ],
      "classes": [
        "CusIntegrationService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/retrieval_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/retrieval_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Retrieval Facade - Centralized access to mediated data retrieval",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "AccessResult",
        "PlaneInfo",
        "EvidenceInfo",
        "RetrievalFacade"
      ],
      "functions": [
        "get_retrieval_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/panel_slot_evaluator.py",
      "relative_path": "app/houseofcards/customer/logs/engines/panel_slot_evaluator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Evaluate individual panel slots",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Any, Callable, Dict, Optional",
        "from .panel_types import ("
      ],
      "classes": [
        "PanelSlotEvaluator"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/connectors_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/connectors_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Connectors Facade - Centralized access to connector operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "ConnectorInfo",
        "TestResult",
        "ConnectorsFacade"
      ],
      "functions": [
        "get_connectors_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/lifecycle_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/lifecycle_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Lifecycle Facade - Centralized access to lifecycle operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "AgentState",
        "RunState",
        "AgentLifecycle",
        "RunLifecycle",
        "LifecycleSummary",
        "LifecycleFacade"
      ],
      "functions": [
        "get_lifecycle_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/audit_reconciler.py",
      "relative_path": "app/houseofcards/customer/logs/engines/audit_reconciler.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Reconcile audit expectations against acknowledgments",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import List, Optional, Set, Tuple",
        "from uuid import UUID",
        "from prometheus_client import Counter, Histogram",
        "from app.services.audit.models import (",
        "from app.services.audit.store import AuditStore, get_audit_store"
      ],
      "classes": [
        "AuditReconciler"
      ],
      "functions": [
        "get_audit_reconciler"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/audit_durability.py",
      "relative_path": "app/houseofcards/customer/logs/engines/audit_durability.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "RAC durability enforcement before acknowledgment",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "DurabilityCheckResult",
        "RACDurabilityEnforcementError",
        "DurabilityCheckResponse",
        "RACDurabilityChecker"
      ],
      "functions": [
        "check_rac_durability",
        "ensure_rac_durability"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/panel_response_assembler.py",
      "relative_path": "app/houseofcards/customer/logs/engines/panel_response_assembler.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Assemble final panel response envelope",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import asdict",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from .panel_consistency_checker import ConsistencyCheckResult",
        "from .panel_types import ("
      ],
      "classes": [
        "PanelResponseAssembler"
      ],
      "functions": [
        "create_response_assembler"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/api.py",
      "relative_path": "app/houseofcards/customer/logs/engines/api.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Prediction service API logic",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timedelta, timezone",
        "from typing import List",
        "from uuid import uuid4",
        "from fastapi import APIRouter, Depends, Query",
        "from sqlmodel import Session",
        "from app.db import get_session",
        "from app.models.prediction import PredictionEvent"
      ],
      "classes": [],
      "functions": [
        "get_db",
        "create_incident_risk_prediction",
        "list_predictions",
        "create_spend_spike_prediction",
        "create_policy_drift_prediction"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/M17_internal_worker.py",
      "relative_path": "app/houseofcards/customer/logs/engines/M17_internal_worker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "INTERNAL",
        "role": "M17 Internal Worker Registry - WorkerRegistry/WorkerConfig catalog (DEPRECATED)",
        "raw_layer_line": "# Layer: L2 \u2014 Product APIs"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import Annotated, Any, List, Optional",
        "from fastapi import APIRouter, Depends, HTTPException, Query, Request",
        "from pydantic import BaseModel",
        "from sqlalchemy import func, select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.auth.gateway_middleware import get_auth_context",
        "from app.db import get_async_session_dep",
        "from app.models.tenant import WorkerConfig, WorkerRegistry"
      ],
      "classes": [
        "IntegrationSummary",
        "IntegrationsListResponse",
        "IntegrationDetailResponse"
      ],
      "functions": [
        "get_tenant_id_from_auth",
        "list_integrations",
        "get_integration_detail"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/completeness_checker.py",
      "relative_path": "app/houseofcards/customer/logs/engines/completeness_checker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Evidence PDF completeness validation for SOC2 compliance",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Dict, FrozenSet, List, Optional, Set"
      ],
      "classes": [
        "CompletenessCheckResult",
        "EvidenceCompletenessError",
        "CompletenessCheckResponse",
        "EvidenceCompletenessChecker"
      ],
      "functions": [
        "check_evidence_completeness",
        "ensure_evidence_completeness"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/durability.py",
      "relative_path": "app/houseofcards/customer/logs/engines/durability.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "RAC durability enforcement before acknowledgment",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "DurabilityCheckResult",
        "RACDurabilityEnforcementError",
        "DurabilityCheckResponse",
        "RACDurabilityChecker"
      ],
      "functions": [
        "check_rac_durability",
        "ensure_rac_durability"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/engines/controls_facade.py",
      "relative_path": "app/houseofcards/customer/logs/engines/controls_facade.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Controls Facade - Centralized access to control operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "ControlType",
        "ControlState",
        "ControlConfig",
        "ControlStatusSummary",
        "ControlsFacade"
      ],
      "functions": [
        "get_controls_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/schemas/audit_models.py",
      "relative_path": "app/houseofcards/customer/logs/schemas/audit_models.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Runtime Audit Contract models",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from uuid import UUID, uuid4"
      ],
      "classes": [
        "AuditStatus",
        "AuditDomain",
        "AuditAction",
        "AuditExpectation",
        "AckStatus",
        "DomainAck",
        "ReconciliationResult"
      ],
      "functions": [
        "create_run_expectations",
        "create_domain_ack"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/logs/schemas/models.py",
      "relative_path": "app/houseofcards/customer/logs/schemas/models.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Runtime Audit Contract models",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from uuid import UUID, uuid4"
      ],
      "classes": [
        "AuditStatus",
        "AuditDomain",
        "AuditAction",
        "AuditExpectation",
        "AckStatus",
        "DomainAck",
        "ReconciliationResult"
      ],
      "functions": [
        "create_run_expectations",
        "create_domain_ack"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/bridges.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/bridges.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Integration bridge abstractions",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "import logging",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import TYPE_CHECKING, Optional",
        "from .events import ("
      ],
      "classes": [
        "PolicyActivationAudit",
        "BaseBridge",
        "IncidentToCatalogBridge",
        "PatternToRecoveryBridge",
        "RecoveryToPolicyBridge",
        "PolicyToRoutingBridge",
        "LoopStatusBridge"
      ],
      "functions": [
        "_check_frozen",
        "record_policy_activation",
        "create_bridges",
        "register_all_bridges"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/prevention_contract.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/prevention_contract.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Prevention contract enforcement",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any"
      ],
      "classes": [
        "PreventionContractViolation",
        "PreventionCandidate"
      ],
      "functions": [
        "validate_prevention_candidate",
        "assert_prevention_immutable",
        "assert_no_deletion",
        "validate_prevention_for_graduation"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/cost_safety_rails.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/cost_safety_rails.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Cost safety rail enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def process_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any"
      ],
      "classes": [
        "SafetyConfig",
        "CostSafetyRails",
        "SafeCostLoopOrchestrator"
      ],
      "functions": [
        "get_safety_rails"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/server_registry.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/server_registry.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "INTERNAL",
        "role": "Registry for external MCP servers",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "MCPServerStatus",
        "MCPCapability",
        "MCPTool",
        "MCPServer",
        "MCPRegistrationResult",
        "MCPServerRegistry"
      ],
      "functions": [
        "get_mcp_registry",
        "configure_mcp_registry",
        "reset_mcp_registry"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/identity_resolver.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/identity_resolver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Identity resolution from various providers",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from .iam_service import ActorType, Identity, IdentityProvider"
      ],
      "classes": [
        "IdentityResolver",
        "ClerkIdentityResolver",
        "APIKeyIdentityResolver",
        "SystemIdentityResolver",
        "IdentityChain"
      ],
      "functions": [
        "create_default_identity_chain"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/knowledge_plane.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/knowledge_plane.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "import uuid"
      ],
      "classes": [
        "KnowledgePlaneStatus",
        "KnowledgeNodeType",
        "KnowledgeNode",
        "KnowledgePlane",
        "KnowledgePlaneError",
        "KnowledgePlaneStats",
        "KnowledgePlaneRegistry"
      ],
      "functions": [
        "get_knowledge_plane_registry",
        "_reset_registry",
        "create_knowledge_plane",
        "get_knowledge_plane",
        "list_knowledge_planes"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/dispatcher.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/dispatcher.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Integration event dispatcher",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import json",
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Callable, Coroutine, Optional",
        "from uuid import uuid4",
        "from .events import (",
        "from .events import PolicyMode"
      ],
      "classes": [
        "DispatcherConfig",
        "IntegrationDispatcher"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/external_response_service.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/external_response_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "External response persistence and interpretation service",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from uuid import UUID",
        "from sqlalchemy import and_, select, update",
        "from sqlalchemy.orm import Session",
        "from app.models.external_response import ("
      ],
      "classes": [
        "ExternalResponseService"
      ],
      "functions": [
        "record_external_response",
        "interpret_response",
        "get_interpreted_response"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/connector_registry.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/connector_registry.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "import uuid"
      ],
      "classes": [
        "ConnectorType",
        "ConnectorStatus",
        "ConnectorCapability",
        "ConnectorConfig",
        "ConnectorError",
        "BaseConnector",
        "VectorConnector",
        "FileConnector",
        "ServerlessConnector",
        "ConnectorStats",
        "ConnectorRegistry"
      ],
      "functions": [
        "get_connector_registry",
        "_reset_registry",
        "register_connector",
        "get_connector",
        "list_connectors"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/cost_bridges.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/cost_bridges.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Cost-related integration bridges",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def process_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "from app.integrations.events import (",
        "from app.services.governance.cross_domain import create_incident_from_cost_anomaly_sync"
      ],
      "classes": [
        "AnomalyType",
        "AnomalySeverity",
        "CostAnomaly",
        "CostLoopBridge",
        "CostPatternMatcher",
        "CostRecoveryGenerator",
        "CostPolicyGenerator",
        "CostRoutingAdjuster",
        "CostEstimationProbe",
        "CostLoopOrchestrator"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/learning_proof.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/learning_proof.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Learning proof generation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import uuid",
        "from collections import defaultdict",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Optional"
      ],
      "classes": [
        "PreventionOutcome",
        "PreventionRecord",
        "PreventionTracker",
        "RegretType",
        "RegretEvent",
        "PolicyRegretTracker",
        "GlobalRegretTracker",
        "PatternCalibration",
        "AdaptiveConfidenceSystem",
        "CheckpointPriority",
        "CheckpointConfig",
        "PrioritizedCheckpoint",
        "M25GraduationStatus",
        "PreventionTimeline"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/cost_snapshots.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/cost_snapshots.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Cost snapshot management",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def compute_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any",
        "from sqlalchemy.ext.asyncio import AsyncSession"
      ],
      "classes": [
        "SnapshotType",
        "SnapshotStatus",
        "EntityType",
        "CostSnapshot",
        "SnapshotAggregate",
        "SnapshotBaseline",
        "AnomalyEvaluation",
        "SnapshotComputer",
        "BaselineComputer",
        "SnapshotAnomalyDetector"
      ],
      "functions": [
        "run_hourly_snapshot_job",
        "run_daily_snapshot_and_baseline_job"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/events.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/events.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Integration event definitions",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Literal, Optional"
      ],
      "classes": [
        "ConfidenceCalculator",
        "ConfidenceBand",
        "LoopStage",
        "LoopFailureState",
        "PolicyMode",
        "HumanCheckpointType",
        "LoopEvent",
        "PatternMatchResult",
        "RecoverySuggestion",
        "PolicyRule",
        "RoutingAdjustment",
        "HumanCheckpoint",
        "LoopStatus"
      ],
      "functions": [
        "ensure_json_serializable"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/execution.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/execution.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Real execution implementations for lifecycle stage handlers",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import hashlib",
        "import logging",
        "import re",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, Iterator, List, Optional, Tuple"
      ],
      "classes": [
        "IngestionSourceType",
        "IngestionBatch",
        "IngestionResult",
        "DataIngestionExecutor",
        "IndexingResult",
        "IndexingExecutor",
        "SensitivityLevel",
        "PIIType",
        "PIIDetection",
        "ClassificationResult",
        "ClassificationExecutor"
      ],
      "functions": [
        "get_ingestion_executor",
        "get_indexing_executor",
        "get_classification_executor",
        "reset_executors"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/customer_incidents_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/customer_incidents_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Customer incidents boundary adapter (L2 \u2192 L3 \u2192 L4)",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import List, Optional",
        "from pydantic import BaseModel",
        "from sqlmodel import Session",
        "from app.services.incident_read_service import get_incident_read_service",
        "from app.services.incident_write_service import get_incident_write_service"
      ],
      "classes": [
        "CustomerIncidentSummary",
        "CustomerIncidentEvent",
        "CustomerIncidentDetail",
        "CustomerIncidentListResponse",
        "CustomerIncidentsAdapter"
      ],
      "functions": [
        "_translate_severity",
        "_translate_status",
        "get_customer_incidents_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/vector_stores_base.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/vector_stores_base.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Base class for vector store adapters",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "VectorRecord",
        "QueryResult",
        "UpsertResult",
        "DeleteResult",
        "IndexStats",
        "VectorStoreAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/integrations_facade.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/integrations_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Integrations domain facade - unified entry point for integration management",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Any, Optional",
        "from uuid import UUID",
        "from app.services.cus_integration_service import CusIntegrationService"
      ],
      "classes": [
        "IntegrationSummaryResult",
        "IntegrationListResult",
        "IntegrationDetailResult",
        "IntegrationLifecycleResult",
        "IntegrationDeleteResult",
        "HealthCheckResult",
        "HealthStatusResult",
        "LimitsStatusResult",
        "IntegrationsFacade"
      ],
      "functions": [
        "get_integrations_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/founder_ops_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/founder_ops_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Translate OpsIncident domain models to Founder-facing views",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import List",
        "from app.services.ops_domain_models import OpsIncident"
      ],
      "classes": [
        "FounderIncidentSummaryView",
        "FounderIncidentsSummaryResponse",
        "FounderOpsAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/customer_killswitch_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/customer_killswitch_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Customer killswitch boundary adapter (L2 \u2192 L3 \u2192 L4)",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import List, Optional",
        "from pydantic import BaseModel",
        "from sqlmodel import Session",
        "from app.models.killswitch import TriggerType",
        "from app.services.guard_write_service import GuardWriteService",
        "from app.services.killswitch.customer_killswitch_read_service import ("
      ],
      "classes": [
        "CustomerKillswitchStatus",
        "CustomerKillswitchAction",
        "CustomerKillswitchAdapter"
      ],
      "functions": [
        "get_customer_killswitch_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/smtp_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/smtp_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "SMTP email notification adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "import os",
        "from email.mime.multipart import MIMEMultipart",
        "from email.mime.text import MIMEText",
        "from email.mime.base import MIMEBase",
        "from email import encoders",
        "from typing import Dict, List, Optional",
        "import uuid",
        "from .base import ("
      ],
      "classes": [
        "SMTPAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/lambda_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/lambda_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": "INTERNAL",
        "role": "AWS Lambda serverless adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import base64",
        "import json",
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "from .base import ("
      ],
      "classes": [
        "LambdaAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/slack_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/slack_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Slack notification adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "import uuid",
        "from .base import ("
      ],
      "classes": [
        "SlackAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/notifications_base.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/notifications_base.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Base class for notification adapters",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "NotificationPriority",
        "NotificationStatus",
        "NotificationRecipient",
        "NotificationMessage",
        "NotificationResult",
        "RetryConfig",
        "NotificationAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/pinecone_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/pinecone_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": "INTERNAL",
        "role": "Pinecone vector store adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "from .base import ("
      ],
      "classes": [
        "PineconeAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/pgvector_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/pgvector_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "PGVector production adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "from .base import ("
      ],
      "classes": [
        "PGVectorAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/s3_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/s3_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": "INTERNAL",
        "role": "AWS S3 file storage adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, AsyncIterator, BinaryIO, Dict, List, Optional",
        "from .base import ("
      ],
      "classes": [
        "S3Adapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/serverless_base.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/serverless_base.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Base class for serverless adapters",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "InvocationType",
        "InvocationRequest",
        "InvocationResult",
        "FunctionInfo",
        "ServerlessAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/workers_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/workers_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Worker execution boundary adapter (L2 \u2192 L3 \u2192 L4)",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Optional",
        "from app.commands.worker_execution_command import ("
      ],
      "classes": [
        "WorkersAdapter"
      ],
      "functions": [
        "get_workers_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/gcs_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/gcs_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Google Cloud Storage file storage adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, AsyncIterator, BinaryIO, Dict, List, Optional",
        "from .base import ("
      ],
      "classes": [
        "GCSAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/datasources_facade.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/datasources_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DataSources Facade - Centralized access to data source operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from app.services.datasources.datasource_model import ("
      ],
      "classes": [
        "TestConnectionResult",
        "DataSourcesFacade"
      ],
      "functions": [
        "get_datasources_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/retrieval_facade.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/retrieval_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Retrieval Facade - Centralized access to mediated data retrieval",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "AccessResult",
        "PlaneInfo",
        "EvidenceInfo",
        "RetrievalFacade"
      ],
      "functions": [
        "get_retrieval_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/policy_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/policy_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Policy evaluation boundary adapter (L2 \u2192 L3 \u2192 L4)",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, List, Optional",
        "from app.commands.policy_command import ("
      ],
      "classes": [
        "PolicyAdapter"
      ],
      "functions": [
        "get_policy_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/connectors_facade.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/connectors_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Connectors Facade - Centralized access to connector operations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "import uuid"
      ],
      "classes": [
        "ConnectorInfo",
        "TestResult",
        "ConnectorsFacade"
      ],
      "functions": [
        "get_connectors_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/webhook_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/webhook_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Webhook notification adapter with retry logic",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import hashlib",
        "import hmac",
        "import json",
        "import logging",
        "import os",
        "import time",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional",
        "import uuid",
        "from .base import ("
      ],
      "classes": [
        "CircuitState",
        "CircuitBreakerConfig",
        "CircuitBreaker",
        "WebhookDeliveryAttempt",
        "WebhookDelivery",
        "WebhookAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/file_storage_base.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/file_storage_base.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Base class for file storage adapters",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from typing import Any, AsyncIterator, BinaryIO, Dict, List, Optional"
      ],
      "classes": [
        "FileMetadata",
        "UploadResult",
        "DownloadResult",
        "ListResult",
        "FileStorageAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/customer_policies_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/customer_policies_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Customer policies boundary adapter (L2 \u2192 L3 \u2192 L4)",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import List, Optional",
        "from pydantic import BaseModel",
        "from app.services.policy.customer_policy_read_service import ("
      ],
      "classes": [
        "CustomerBudgetConstraint",
        "CustomerRateLimit",
        "CustomerGuardrail",
        "CustomerPolicyConstraints",
        "CustomerPoliciesAdapter"
      ],
      "functions": [
        "get_customer_policies_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/weaviate_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/weaviate_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Weaviate vector store adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "from .base import ("
      ],
      "classes": [
        "WeaviateAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/customer_activity_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/customer_activity_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Customer activity boundary adapter (L2 \u2192 L3 \u2192 L4)",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import List, Optional",
        "from pydantic import BaseModel, Field",
        "from app.services.activity.customer_activity_read_service import ("
      ],
      "classes": [
        "CustomerActivitySummary",
        "CustomerActivityDetail",
        "CustomerActivityListResponse",
        "CustomerActivityAdapter"
      ],
      "functions": [
        "get_customer_activity_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/customer_keys_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/customer_keys_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Customer API keys boundary adapter (L2 \u2192 L3 \u2192 L4)",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import List, Optional",
        "from pydantic import BaseModel",
        "from sqlmodel import Session",
        "from app.services.keys_service import ("
      ],
      "classes": [
        "CustomerKeyInfo",
        "CustomerKeyListResponse",
        "CustomerKeyAction",
        "CustomerKeysAdapter"
      ],
      "functions": [
        "get_customer_keys_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/cloud_functions_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/cloud_functions_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Google Cloud Functions serverless adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapters"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import json",
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "from .base import ("
      ],
      "classes": [
        "CloudFunctionsAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/customer_logs_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/customer_logs_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Customer logs boundary adapter (L2 \u2192 L3 \u2192 L4)",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel"
      ],
      "classes": [
        "CustomerLogSummary",
        "CustomerLogStep",
        "CustomerLogDetail",
        "CustomerLogListResponse",
        "CustomerLogsAdapter"
      ],
      "functions": [
        "get_customer_logs_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/runtime_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/runtime_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Translate API requests into runtime domain commands",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter (Translation)"
      },
      "signals": [
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional",
        "from app.commands.runtime_command import ("
      ],
      "classes": [
        "RuntimeAdapter"
      ],
      "functions": [
        "get_runtime_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/facades/founder_contract_review_adapter.py",
      "relative_path": "app/houseofcards/customer/integrations/facades/founder_contract_review_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Translate Contract domain models to Founder Review views",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Any, List, Optional",
        "from app.services.governance.contract_service import ContractState"
      ],
      "classes": [
        "FounderContractSummaryView",
        "FounderContractDetailView",
        "FounderReviewQueueResponse",
        "FounderReviewDecision",
        "FounderReviewResult",
        "FounderReviewAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/engines/http_connector.py",
      "relative_path": "app/houseofcards/customer/integrations/engines/http_connector.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Machine-controlled HTTP connector (NOT LLM-controlled)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "import logging",
        "from app.houseofcards.customer.integrations.engines.credentials import ("
      ],
      "classes": [
        "HttpMethod",
        "EndpointConfig",
        "HttpConnectorConfig",
        "HttpConnectorError",
        "RateLimitExceededError",
        "HttpConnectorService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/engines/cus_health_service.py",
      "relative_path": "app/houseofcards/customer/integrations/engines/cus_health_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Health checking for customer LLM integrations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "import httpx",
        "from sqlmodel import Session, select",
        "from app.db import get_engine",
        "from app.models.cus_models import CusHealthState, CusIntegration",
        "from app.services.cus_credential_service import CusCredentialService"
      ],
      "classes": [
        "CusHealthService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/engines/retrieval_mediator.py",
      "relative_path": "app/houseofcards/customer/integrations/engines/retrieval_mediator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Unified mediation layer for all external data access",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional, Protocol, runtime_checkable",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "import hashlib",
        "import json",
        "import logging"
      ],
      "classes": [
        "MediationAction",
        "MediatedResult",
        "PolicyCheckResult",
        "EvidenceRecord",
        "MediationDeniedError",
        "Connector",
        "ConnectorRegistry",
        "PolicyChecker",
        "EvidenceService",
        "RetrievalMediator"
      ],
      "functions": [
        "get_retrieval_mediator",
        "configure_retrieval_mediator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/engines/mcp_connector.py",
      "relative_path": "app/houseofcards/customer/integrations/engines/mcp_connector.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Model Context Protocol (MCP) tool invocation with governance",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from datetime import datetime, timezone",
        "import logging",
        "from app.houseofcards.customer.integrations.engines.credentials import ("
      ],
      "classes": [
        "McpToolDefinition",
        "McpConnectorConfig",
        "McpConnectorError",
        "McpApprovalRequiredError",
        "McpRateLimitExceededError",
        "McpSchemaValidationError",
        "McpConnectorService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/engines/sql_gateway.py",
      "relative_path": "app/houseofcards/customer/integrations/engines/sql_gateway.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Template-based SQL queries (NO raw SQL from LLM)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from datetime import datetime",
        "from enum import Enum",
        "import logging",
        "from app.houseofcards.customer.integrations.engines.credentials import (",
        "import asyncio"
      ],
      "classes": [
        "ParameterType",
        "ParameterSpec",
        "QueryTemplate",
        "SqlGatewayConfig",
        "SqlGatewayError",
        "SqlInjectionAttemptError",
        "SqlGatewayService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/engines/cus_integration_service.py",
      "relative_path": "app/houseofcards/customer/integrations/engines/cus_integration_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Business logic for Customer Integration domain (LLM BYOK, SDK, RAG)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import date, datetime, timezone",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from uuid import UUID, uuid4",
        "from sqlmodel import Session, col, func, select",
        "from app.db import get_engine",
        "from app.models.cus_models import (",
        "from app.schemas.cus_schemas import CusLimitsStatus"
      ],
      "classes": [
        "CusIntegrationService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/engines/iam_service.py",
      "relative_path": "app/houseofcards/customer/integrations/engines/iam_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "INTERNAL",
        "role": "IAM service for identity and access management",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Set"
      ],
      "classes": [
        "IdentityProvider",
        "ActorType",
        "Identity",
        "AccessDecision",
        "IAMService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/engines/graduation_engine.py",
      "relative_path": "app/houseofcards/customer/integrations/engines/graduation_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Agent graduation evaluation domain logic (pure computation)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import NamedTuple, Optional"
      ],
      "classes": [
        "GraduationThresholds",
        "GateEvidence",
        "GraduationEvidence",
        "GraduationLevel",
        "ComputedGraduationStatus",
        "GraduationEngine",
        "CapabilityGates",
        "SimulationState"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/schemas/cus_schemas.py",
      "relative_path": "app/houseofcards/customer/integrations/schemas/cus_schemas.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Pydantic schemas for Customer Integration domain (LLM BYOK, SDK, RAG)",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate (Schemas)"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import date, datetime",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, Field, field_validator",
        "from app.models.cus_models import ("
      ],
      "classes": [
        "CusIntegrationCreate",
        "CusIntegrationUpdate",
        "CusLLMUsageIngest",
        "CusLLMUsageBatchIngest",
        "CusIntegrationResponse",
        "CusIntegrationSummary",
        "CusLimitsStatus",
        "CusUsageSummary",
        "CusIntegrationUsage",
        "CusLLMUsageResponse",
        "CusHealthCheckResponse"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/schemas/datasource_model.py",
      "relative_path": "app/houseofcards/customer/integrations/schemas/datasource_model.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional",
        "import uuid"
      ],
      "classes": [
        "DataSourceType",
        "DataSourceStatus",
        "DataSourceConfig",
        "CustomerDataSource",
        "DataSourceError",
        "DataSourceStats",
        "DataSourceRegistry"
      ],
      "functions": [
        "get_datasource_registry",
        "_reset_registry",
        "create_datasource",
        "get_datasource",
        "list_datasources"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/drivers/credentials/types.py",
      "relative_path": "app/houseofcards/customer/integrations/drivers/credentials/types.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "INTERNAL",
        "role": "Canonical Credential dataclass for connector services",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Optional"
      ],
      "classes": [
        "Credential"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/engines/credentials/protocol.py",
      "relative_path": "app/houseofcards/customer/integrations/engines/credentials/protocol.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "INTERNAL",
        "role": "Canonical CredentialService protocol for connector services",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Protocol, runtime_checkable",
        "from .types import Credential"
      ],
      "classes": [
        "CredentialService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/vault/drivers/vault.py",
      "relative_path": "app/houseofcards/customer/integrations/vault/drivers/vault.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "INTERNAL",
        "role": "Credential vault abstraction with multiple provider support",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, Optional"
      ],
      "classes": [
        "VaultProvider",
        "CredentialType",
        "CredentialMetadata",
        "CredentialData",
        "CredentialVault",
        "HashiCorpVault",
        "EnvCredentialVault"
      ],
      "functions": [
        "create_credential_vault"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/vault/engines/cus_credential_service.py",
      "relative_path": "app/houseofcards/customer/integrations/vault/engines/cus_credential_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Credential encryption and vault integration for customer LLM integrations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import base64",
        "import hashlib",
        "import hmac",
        "import logging",
        "import os",
        "import secrets",
        "from typing import Dict, Optional, Tuple",
        "from cryptography.hazmat.primitives.ciphers.aead import AESGCM"
      ],
      "classes": [
        "CusCredentialService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/integrations/vault/engines/service.py",
      "relative_path": "app/houseofcards/customer/integrations/vault/engines/service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "High-level credential service with validation and auditing",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from .vault import ("
      ],
      "classes": [
        "CredentialAccessRecord",
        "CredentialService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/incident_driver.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/incident_driver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": "INTERNAL",
        "role": "Incident Domain Driver - Internal orchestration for incident operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Driver"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "IncidentDriver"
      ],
      "functions": [
        "get_incident_driver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/export_bundle_service.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/export_bundle_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Generate structured export bundles from incidents and traces",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlmodel import Session, select",
        "from app.db import Incident, Run, engine",
        "from app.models.export_bundles import (",
        "from app.traces.store import TraceStore"
      ],
      "classes": [
        "ExportBundleService"
      ],
      "functions": [
        "get_export_bundle_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/scoped_execution.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/scoped_execution.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Pre-execution gate, scope enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import logging",
        "import secrets",
        "import threading",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from functools import wraps",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "RiskClass",
        "ExecutionScope",
        "ScopedExecutionResult",
        "RecoveryAction",
        "ScopedExecutionContext",
        "ScopedExecutionRequired",
        "ScopeNotFound",
        "ScopeExhausted",
        "ScopeExpired",
        "ScopeActionMismatch",
        "ScopeIncidentMismatch",
        "BoundExecutionScope",
        "ScopeStore"
      ],
      "functions": [
        "get_scope_store",
        "create_recovery_scope",
        "execute_with_scope",
        "validate_scope_required",
        "requires_scoped_execution",
        "test_recovery_scope"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/panel_invariant_monitor.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/panel_invariant_monitor.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Monitor panel invariants and detect silent governance failures",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from pathlib import Path",
        "from typing import Any, Optional",
        "import yaml"
      ],
      "classes": [
        "AlertType",
        "AlertSeverity",
        "PanelInvariant",
        "PanelStatus",
        "PanelAlert",
        "PanelInvariantRegistry",
        "PanelInvariantMonitor"
      ],
      "functions": [
        "get_panel_monitor",
        "reset_panel_monitor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/pdf_renderer.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/pdf_renderer.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Render export bundles to PDF format",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import io",
        "import logging",
        "from datetime import datetime",
        "from typing import Optional",
        "from reportlab.lib import colors",
        "from reportlab.lib.enums import TA_CENTER, TA_LEFT",
        "from reportlab.lib.pagesizes import letter",
        "from reportlab.lib.styles import ParagraphStyle, getSampleStyleSheet",
        "from reportlab.lib.units import inch",
        "from reportlab.platypus import (",
        "from app.models.export_bundles import ("
      ],
      "classes": [
        "PDFRenderer"
      ],
      "functions": [
        "get_pdf_renderer"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/incident_read_driver.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/incident_read_driver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Data access for incident read operations",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import List, Optional, Tuple",
        "from sqlalchemy import and_, desc, func, select",
        "from sqlmodel import Session",
        "from app.models.killswitch import Incident, IncidentEvent"
      ],
      "classes": [
        "IncidentReadDriver"
      ],
      "functions": [
        "get_incident_read_driver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/runtime_switch.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/runtime_switch.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Runtime toggle for governance enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import threading",
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Optional"
      ],
      "classes": [
        "GovernanceState"
      ],
      "functions": [
        "is_governance_active",
        "is_degraded_mode",
        "disable_governance_runtime",
        "enable_governance_runtime",
        "enter_degraded_mode",
        "exit_degraded_mode",
        "get_governance_state",
        "reset_governance_state",
        "_emit_governance_event"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/incident_aggregator.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/incident_aggregator.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Incident grouping rules, escalation logic",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from decimal import Decimal",
        "from typing import Any, Callable, Dict, Optional, Tuple, cast",
        "from sqlmodel import Session, and_, select",
        "from app.models.killswitch import Incident, IncidentEvent, IncidentSeverity, IncidentStatus",
        "from app.utils.runtime import generate_uuid, utc_now"
      ],
      "classes": [
        "IncidentAggregatorConfig",
        "IncidentKey",
        "IncidentAggregator"
      ],
      "functions": [
        "create_incident_aggregator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/hallucination_detector.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/hallucination_detector.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Detect potential hallucinations in LLM outputs (non-blocking)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import re",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Optional"
      ],
      "classes": [
        "HallucinationType",
        "HallucinationSeverity",
        "HallucinationIndicator",
        "HallucinationResult",
        "HallucinationConfig",
        "HallucinationDetector"
      ],
      "functions": [
        "create_detector_for_tenant"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/drivers/guard_write_service.py",
      "relative_path": "app/houseofcards/customer/incidents/drivers/guard_write_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for Guard API (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import uuid",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import List, Optional, Tuple",
        "from sqlalchemy import and_, select",
        "from sqlmodel import Session",
        "from app.models.killswitch import ("
      ],
      "classes": [
        "GuardWriteService"
      ],
      "functions": [
        "utc_now"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/facades/incidents_facade.py",
      "relative_path": "app/houseofcards/customer/incidents/facades/incidents_facade.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Incidents domain facade - unified entry point for incident management operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Facade\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Optional",
        "from sqlalchemy import func, select, text",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.models.killswitch import Incident"
      ],
      "classes": [
        "IncidentSummaryResult",
        "PaginationResult",
        "IncidentListResult",
        "IncidentDetailResult",
        "IncidentsByRunResult",
        "PatternMatchResult",
        "PatternDetectionResult",
        "RecurrenceGroupResult",
        "RecurrenceAnalysisResult",
        "CostImpactSummaryResult",
        "CostImpactResult",
        "IncidentMetricsResult",
        "HistoricalTrendDataPointResult",
        "HistoricalTrendResult",
        "HistoricalDistributionEntryResult",
        "HistoricalDistributionResult",
        "CostTrendDataPointResult",
        "CostTrendResult",
        "LearningInsightResult",
        "ResolutionSummaryResult",
        "LearningsResult",
        "IncidentsFacade"
      ],
      "functions": [
        "get_incidents_facade"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/policy_violation_service.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/policy_violation_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "S3 violation truth model, fact persistence, evidence linking",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import Any, Dict, Optional",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.utils.runtime import generate_uuid"
      ],
      "classes": [
        "ViolationFact",
        "ViolationIncident",
        "PolicyViolationService",
        "PolicyEvaluationResult"
      ],
      "functions": [
        "create_policy_evaluation_record",
        "handle_policy_evaluation_for_run",
        "handle_policy_violation",
        "create_policy_evaluation_sync"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/incident_engine.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/incident_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Incident creation decision-making (domain logic)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlalchemy import create_engine, text"
      ],
      "classes": [
        "IncidentEngine"
      ],
      "functions": [
        "_get_lessons_learned_engine",
        "utc_now",
        "get_incident_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/prevention_engine.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/prevention_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Prevention-based policy validation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import re",
        "import time",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Set",
        "from uuid import uuid4"
      ],
      "classes": [
        "PolicyType",
        "Severity",
        "PreventionAction",
        "PolicyViolation",
        "PreventionContext",
        "PreventionResult",
        "BaseValidator",
        "ContentAccuracyValidatorV2",
        "PIIValidator",
        "SafetyValidator",
        "HallucinationValidator",
        "BudgetValidator",
        "PreventionEngine"
      ],
      "functions": [
        "get_prevention_engine",
        "evaluate_prevention",
        "create_incident_from_violation",
        "_create_incident_with_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/panel_verification_engine.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/panel_verification_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Determinism verification and input validation",
        "raw_layer_line": "# Layer: L4 \u2014 Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from .panel_types import ("
      ],
      "classes": [
        "PanelVerificationEngine"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/evidence_report.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/evidence_report.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "See file: evidence_report.py",
        "raw_layer_line": "# Layer: L4 \u2014 Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Verdict",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import io",
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from reportlab.lib import colors",
        "from reportlab.lib.enums import TA_CENTER",
        "from reportlab.lib.pagesizes import letter",
        "from reportlab.lib.styles import ParagraphStyle, getSampleStyleSheet",
        "from reportlab.lib.units import inch",
        "from reportlab.platypus import ("
      ],
      "classes": [
        "CertificateEvidence",
        "IncidentEvidence",
        "EvidenceReportGenerator"
      ],
      "functions": [
        "generate_evidence_report"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/recovery_rule_engine.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/recovery_rule_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "RuleContext",
        "RuleResult",
        "EvaluationResult",
        "Rule",
        "ErrorCodeRule",
        "HistoricalPatternRule",
        "SkillSpecificRule",
        "OccurrenceThresholdRule",
        "CompositeRule",
        "RecoveryRuleEngine"
      ],
      "functions": [
        "combine_confidences",
        "should_select_action",
        "should_auto_execute",
        "classify_error_category",
        "suggest_recovery_mode",
        "evaluate_rules"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/postmortem_service.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/postmortem_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Extract learnings and post-mortem insights from resolved incidents",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession"
      ],
      "classes": [
        "ResolutionSummary",
        "LearningInsight",
        "PostMortemResult",
        "CategoryLearnings",
        "PostMortemService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/degraded_mode_checker.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/degraded_mode_checker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Governance degraded mode checker with incident response",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from threading import Lock",
        "from typing import Any, Dict, FrozenSet, Optional",
        "import logging"
      ],
      "classes": [
        "DegradedModeCheckResult",
        "DegradedModeState",
        "GovernanceDegradedModeError",
        "DegradedModeStatus",
        "DegradedModeCheckResponse",
        "DegradedModeIncident",
        "DegradedModeIncidentCreator",
        "GovernanceDegradedModeChecker"
      ],
      "functions": [
        "check_degraded_mode",
        "ensure_not_degraded",
        "enter_degraded_with_incident",
        "_reset_degraded_mode_state"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/incident_write_service.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/incident_write_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Incident domain write operations (L4)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlmodel import Session",
        "from app.models.killswitch import Incident, IncidentEvent, IncidentStatus",
        "from app.models.audit_ledger import ActorType",
        "from app.services.logs.audit_ledger_service import AuditLedgerService"
      ],
      "classes": [
        "IncidentWriteService"
      ],
      "functions": [
        "get_incident_write_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/incidents_types.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/incidents_types.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Shared type aliases for incidents domain engines",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from datetime import datetime",
        "from typing import Callable"
      ],
      "classes": [],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/incident_read_service.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/incident_read_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Incident domain read operations (L4 facade over L6 driver)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime",
        "from typing import TYPE_CHECKING, List, Optional, Tuple",
        "from app.houseofcards.customer.incidents.drivers.incident_read_driver import ("
      ],
      "classes": [
        "IncidentReadService"
      ],
      "functions": [
        "get_incident_read_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/channel_service.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/channel_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Configurable notification channel management",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Protocol, Set"
      ],
      "classes": [
        "NotifyChannel",
        "NotifyEventType",
        "NotifyChannelStatus",
        "NotifyChannelError",
        "NotifyDeliveryResult",
        "NotifyChannelConfig",
        "NotifyChannelConfigResponse",
        "NotificationSender",
        "NotifyChannelService"
      ],
      "functions": [
        "get_notify_service",
        "_reset_notify_service",
        "get_channel_config",
        "send_notification",
        "check_channel_health"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/alert_log_linker.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/alert_log_linker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Link alerts to log records for explicit correlation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Set"
      ],
      "classes": [
        "AlertLogLinkType",
        "AlertLogLinkStatus",
        "AlertLogLinkError",
        "AlertLogLink",
        "AlertLogLinkResponse",
        "AlertLogLinker"
      ],
      "functions": [
        "get_alert_log_linker",
        "_reset_alert_log_linker",
        "create_alert_log_link",
        "get_alerts_for_run",
        "get_logs_for_alert"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/semantic_failures.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/semantic_failures.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Semantic failure taxonomy and fix guidance",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "from typing import Any, Dict, Union",
        "from .semantic_types import ("
      ],
      "classes": [],
      "functions": [
        "get_failure_info",
        "get_fix_owner",
        "get_fix_action",
        "get_violation_class",
        "format_violation_message"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/llm_failure_service.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/llm_failure_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "S4 failure truth model, fact persistence",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from typing import Any, Callable, Dict, Optional",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession"
      ],
      "classes": [
        "LLMFailureFact",
        "LLMFailureResult",
        "LLMFailureService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/failure_mode_handler.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/failure_mode_handler.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Handle failure modes - default to fail-closed",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Optional, Any, Dict",
        "from datetime import datetime, timezone",
        "import logging"
      ],
      "classes": [
        "FailureMode",
        "FailureType",
        "FailureDecision"
      ],
      "functions": [
        "get_failure_mode",
        "handle_policy_failure",
        "handle_missing_policy",
        "handle_evaluation_error",
        "handle_timeout"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/lessons_engine.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/lessons_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Lessons learned creation and management (domain logic)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Any, Optional",
        "from uuid import UUID, uuid4",
        "from prometheus_client import Counter",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import IntegrityError"
      ],
      "classes": [
        "LessonsLearnedEngine"
      ],
      "functions": [
        "utc_now",
        "is_valid_transition",
        "get_threshold_band",
        "get_lessons_learned_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/mapper.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/mapper.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Map incidents to relevant SOC2 controls",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Any, Optional",
        "from app.services.soc2.control_registry import ("
      ],
      "classes": [
        "SOC2ControlMapper"
      ],
      "functions": [
        "utc_now",
        "get_control_mappings_for_incident"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/recurrence_analysis_service.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/recurrence_analysis_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Analyze recurring incident patterns",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta",
        "from typing import Optional",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.houseofcards.customer.general.utils.time import utc_now"
      ],
      "classes": [
        "RecurrenceGroup",
        "RecurrenceResult",
        "RecurrenceAnalysisService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/recovery_evaluation_engine.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/recovery_evaluation_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Recovery evaluation decision-making (domain logic)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine (System Truth)"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional",
        "from app.contracts.decisions import emit_recovery_decision",
        "from app.services.recovery_matcher import RecoveryMatcher",
        "from app.services.recovery_rule_engine import ("
      ],
      "classes": [
        "FailureContext",
        "RecoveryDecision",
        "RecoveryEvaluationEngine"
      ],
      "functions": [
        "evaluate_recovery",
        "evaluate_and_execute"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/customer/incidents/engines/incident_pattern_service.py",
      "relative_path": "app/houseofcards/customer/incidents/engines/incident_pattern_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Detect structural patterns across incidents",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta",
        "from typing import Optional",
        "from sqlalchemy import text",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.houseofcards.customer.general.utils.time import utc_now"
      ],
      "classes": [
        "PatternMatch",
        "PatternResult",
        "IncidentPatternService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/governance.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/governance.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "GovernanceError for mandatory cross-domain governance",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Optional",
        "from app.metrics import governance_invariant_violations_total"
      ],
      "classes": [
        "GovernanceError"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/logging_context.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/logging_context.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Workflow logging context management",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import contextvars",
        "import logging",
        "import uuid",
        "from contextlib import contextmanager",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional"
      ],
      "classes": [
        "ContextualLoggerAdapter",
        "StructuredFormatter"
      ],
      "functions": [
        "get_run_id",
        "get_workflow_id",
        "get_agent_id",
        "get_step_id",
        "get_step_index",
        "get_correlation_id",
        "get_tenant_id",
        "set_run_id",
        "set_workflow_id",
        "set_agent_id",
        "set_step_context",
        "set_correlation_id",
        "set_tenant_id",
        "get_logging_context",
        "clear_context",
        "workflow_context",
        "step_context",
        "configure_structured_logging",
        "get_contextual_logger"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/update_rules.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/update_rules.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import re",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Callable, Dict, List, Optional, Pattern",
        "from prometheus_client import Counter"
      ],
      "classes": [
        "UpdateRule",
        "RuleResult",
        "UpdateRulesEngine"
      ],
      "functions": [
        "sanitize_strings",
        "sanitize_nulls",
        "sanitize_timestamps",
        "deep_merge",
        "append_lists",
        "increment_numbers",
        "create_default_engine",
        "get_update_rules_engine",
        "init_update_rules_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/job_execution.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/job_execution.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Job execution support services (retry, progress, audit)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import random",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional"
      ],
      "classes": [
        "RetryStrategy",
        "RetryConfig",
        "RetryAttempt",
        "JobRetryManager",
        "ProgressStage",
        "ProgressUpdate",
        "JobProgressTracker",
        "JobAuditEventType",
        "JobAuditEvent",
        "JobAuditEmitter"
      ],
      "functions": [
        "_hash_value",
        "get_job_retry_manager",
        "get_job_progress_tracker",
        "get_job_audit_emitter",
        "reset_job_execution_services"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/flag_sync.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/flag_sync.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Feature flag synchronization",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import argparse",
        "import json",
        "import logging",
        "import os",
        "import sys",
        "from datetime import datetime, timezone",
        "from pathlib import Path",
        "from typing import Dict, List, Tuple",
        "from sqlalchemy import text",
        "from sqlmodel import Session, select"
      ],
      "classes": [],
      "functions": [
        "get_db_session",
        "read_file_flags",
        "write_file_flags",
        "acquire_advisory_lock",
        "release_advisory_lock",
        "sync_file_to_db",
        "sync_db_to_file",
        "check_consistency",
        "main"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/emitters.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/emitters.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-8 Event Emitters (helper functions)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from typing import Optional",
        "from app.observability.events import (",
        "from app.observability.provider import get_observability_provider"
      ],
      "classes": [],
      "functions": [
        "emit_event",
        "emit_onboarding_state_transition",
        "emit_onboarding_force_complete",
        "emit_billing_state_changed",
        "emit_billing_limit_evaluated",
        "emit_protection_decision",
        "emit_protection_anomaly_detected",
        "emit_role_violation",
        "emit_unauthorized_access"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/retriever.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/retriever.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional",
        "from .store import PostgresMemoryStore, get_memory_store"
      ],
      "classes": [
        "MemoryRetriever"
      ],
      "functions": [
        "get_retriever"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/override_resolver.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/override_resolver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Override resolution for limits evaluation (PIN-LIM-05)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import Optional"
      ],
      "classes": [
        "OverrideRecord",
        "ResolvedOverride",
        "OverrideResolver"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/checkpoint.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/checkpoint.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Workflow checkpoint persistence and recovery",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional",
        "from sqlalchemy import DateTime",
        "from sqlalchemy import create_engine as create_sync_engine",
        "from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine",
        "from sqlalchemy.orm import sessionmaker",
        "from sqlmodel import Field, SQLModel, select, text"
      ],
      "classes": [
        "CheckpointVersionConflictError",
        "WorkflowCheckpoint",
        "CheckpointData",
        "CheckpointStore",
        "InMemoryCheckpointStore"
      ],
      "functions": [
        "_convert_to_async_url"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/stub_planner.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/stub_planner.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Stub planner for testing",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import sys",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional, Union",
        "from planner.interface import ("
      ],
      "classes": [
        "PlanRule",
        "StubPlanner",
        "LegacyStubPlanner"
      ],
      "functions": [
        "example_stub_planner_usage"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/embedding_cache.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/embedding_cache.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "from typing import List, Optional",
        "from app.utils.metrics_helpers import get_or_create_counter, get_or_create_histogram"
      ],
      "classes": [
        "EmbeddingCache"
      ],
      "functions": [
        "compute_cache_key",
        "get_embedding_cache"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/cost_tracker.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/cost_tracker.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Cost tracking and metrics",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import threading",
        "from collections import defaultdict",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Optional"
      ],
      "classes": [
        "CostEnforcementResult",
        "CostQuota",
        "CostRecord",
        "CostAlert",
        "CostTracker"
      ],
      "functions": [
        "get_cost_tracker",
        "configure_cost_quota"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/iaec.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/iaec.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Literal, Optional, Tuple, Union",
        "import numpy as np",
        "from prometheus_client import Counter, Histogram"
      ],
      "classes": [
        "InstructionType",
        "TemporalSignature",
        "TemporalMediator",
        "PolicyEncoding",
        "SlotBasis",
        "CompositeEmbedding",
        "DecomposedEmbedding",
        "MismatchWarning",
        "CorrectiveAction",
        "CorrectionCooldown",
        "IntegrityCheckResult",
        "InstructionAwareEmbeddingComposer"
      ],
      "functions": [
        "get_correction_cooldown",
        "get_iaec",
        "compose_embedding",
        "compose_for_routing",
        "compose_for_search",
        "decompose_embedding",
        "check_instruction_query_match",
        "verify_embedding_integrity"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/policies.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/policies.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Workflow policy enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, Optional, Protocol",
        "from .engine import StepContext, StepDescriptor"
      ],
      "classes": [
        "BudgetStore",
        "InMemoryBudgetStore",
        "RedisBudgetStore",
        "BudgetExceededError",
        "PolicyViolationError",
        "PolicyCheckResult",
        "PolicyEnforcer"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/interface.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/interface.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Planner interface definition (contract)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Union"
      ],
      "classes": [
        "DeterminismMode",
        "PlanStep",
        "PlanMetadata",
        "PlannerOutput",
        "PlannerError",
        "PlannerErrorCode",
        "PlannerInterface",
        "PlannerRegistry"
      ],
      "functions": [
        "_canonical_json",
        "_content_hash",
        "normalize_goal",
        "normalize_context",
        "compute_plan_input_hash"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/feedback.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/feedback.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "CARE-L feedback loop processing",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def compute_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Dict, List, Optional",
        "from uuid import uuid4",
        "import redis.asyncio as redis_async",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "TaskPriority",
        "TaskComplexity",
        "FeedbackDirection",
        "RoutingOutcomeSignal",
        "StrategyAdjustmentSignal",
        "SLAScore",
        "BatchLearningResult",
        "FeedbackLoop"
      ],
      "functions": [
        "get_feedback_loop"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/observability_provider.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/observability_provider.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-8 Observability Provider (protocol + mock)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from datetime import datetime",
        "from typing import Protocol, Optional, runtime_checkable",
        "import logging",
        "import threading",
        "from app.observability.events import UnifiedEvent"
      ],
      "classes": [
        "ObservabilityProvider",
        "MockObservabilityProvider"
      ],
      "functions": [
        "get_observability_provider",
        "set_observability_provider"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/sandbox_executor.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/sandbox_executor.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Low-level sandbox execution with process isolation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "import os",
        "import resource",
        "import shutil",
        "import tempfile",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "IsolationLevel",
        "SandboxStatus",
        "NetworkPolicy",
        "ResourceLimits",
        "ExecutionResult",
        "SandboxExecutor",
        "ProcessSandboxExecutor",
        "ContainerSandboxExecutor"
      ],
      "functions": [
        "create_sandbox_executor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/secrets.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/secrets.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Secret loading and configuration",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import os",
        "from pathlib import Path",
        "from typing import List, Optional, Tuple"
      ],
      "classes": [
        "SecretMissingError",
        "SecretValidationError",
        "Secrets"
      ],
      "functions": [
        "_load_dotenv_if_exists",
        "validate_required_secrets",
        "get_secret_status"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/memory_service.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/memory_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "import time",
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Any, Callable, Dict, List, Optional",
        "from prometheus_client import Counter, Gauge, Histogram",
        "from app.contracts.decisions import emit_memory_decision"
      ],
      "classes": [
        "MemoryEntry",
        "MemoryResult",
        "MemoryService"
      ],
      "functions": [
        "get_memory_service",
        "init_memory_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/job_scheduler.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/job_scheduler.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Optional",
        "import hashlib",
        "import re",
        "import uuid"
      ],
      "classes": [
        "JobScheduleType",
        "JobStatus",
        "JobPriority",
        "JobSchedule",
        "ScheduledJob",
        "SchedulerStats",
        "JobSchedulerError",
        "JobScheduler"
      ],
      "functions": [
        "get_job_scheduler",
        "_reset_scheduler",
        "schedule_job",
        "get_job",
        "list_jobs",
        "cancel_job",
        "get_scheduler_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/suggestions.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/suggestions.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Learning-based suggestion generation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Literal, Optional"
      ],
      "classes": [
        "SuggestionConfidence",
        "SuggestionStatus",
        "ObservationWindow",
        "RollbackObservation",
        "LearningSuggestion"
      ],
      "functions": [
        "validate_suggestion_text"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/golden.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/golden.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Golden file validation for replay fidelity",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import hmac",
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from .canonicalize import canonicalize_for_golden",
        "from .engine import StepDescriptor, StepResult, WorkflowSpec"
      ],
      "classes": [
        "GoldenEvent",
        "GoldenRecorder",
        "InMemoryGoldenRecorder"
      ],
      "functions": [
        "_canonical_json"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/routing_models.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/routing_models.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "CARE-L routing models and types",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "SuccessMetric",
        "OrchestratorMode",
        "RoutingStage",
        "RiskPolicy",
        "DifficultyLevel",
        "ProbeType",
        "CapabilityHardness",
        "CapabilityProbeResult",
        "CapabilityCheckResult",
        "StageResult",
        "RouteEvaluationResult",
        "RoutingRequest",
        "RoutingDecision",
        "AgentPerformanceVector",
        "RoutingOutcome",
        "RoutingConfig"
      ],
      "functions": [
        "infer_success_metric",
        "infer_orchestrator_mode"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/embedding_metrics.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/embedding_metrics.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [],
      "imports": [
        "import os",
        "from app.utils.metrics_helpers import get_or_create_counter, get_or_create_gauge, get_or_create_histogram"
      ],
      "classes": [],
      "functions": [
        "update_index_stats",
        "update_backfill_progress",
        "check_embedding_quota",
        "increment_embedding_count",
        "get_embedding_quota_status"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/care.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/care.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "CARE-L routing algorithm core",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import time",
        "import uuid",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "import redis.asyncio as redis_async",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import SQLAlchemyError",
        "from app.contracts.decisions import emit_routing_decision",
        "from .models import (",
        "from .probes import get_capability_prober"
      ],
      "classes": [
        "RateLimiter",
        "FairnessTracker",
        "PerformanceStore",
        "CAREEngine"
      ],
      "functions": [
        "get_rate_limiter",
        "get_fairness_tracker",
        "get_performance_store",
        "get_care_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/error_store.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/error_store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Append-only error persistence for forensic diagnostics",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from sqlalchemy import text",
        "from sqlmodel import Session",
        "from app.infra.error_envelope import ErrorClass, ErrorEnvelope"
      ],
      "classes": [],
      "functions": [
        "persist_error",
        "persist_errors_batch",
        "get_errors_by_correlation",
        "get_errors_by_component",
        "get_errors_by_class",
        "get_error_counts_by_class",
        "get_error_counts_by_component",
        "get_error_timeline",
        "cleanup_old_errors"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/drift_detector.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/drift_detector.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional, Set",
        "from prometheus_client import REGISTRY, Counter, Gauge, Histogram"
      ],
      "classes": [
        "TraceStep",
        "ExecutionTrace",
        "DriftPoint",
        "DriftResult",
        "DriftDetector"
      ],
      "functions": [
        "_find_existing_metric",
        "_get_or_create_counter",
        "_get_or_create_gauge",
        "_get_or_create_histogram",
        "get_drift_detector",
        "init_drift_detector"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/learning.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/learning.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "CARE-L learning from routing decisions",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Tuple",
        "import redis.asyncio as redis_async",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "QuarantineState",
        "AgentReputation",
        "LearningParameters",
        "HysteresisManager",
        "ReputationStore"
      ],
      "functions": [
        "get_reputation_store",
        "get_hysteresis_manager",
        "get_learning_parameters"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/planner_sandbox.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/planner_sandbox.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Sandboxed planner execution for safety",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import re",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional, Set"
      ],
      "classes": [
        "SandboxReport",
        "PlannerSandbox"
      ],
      "functions": [
        "validate_step_structure",
        "validate_workflow_structure"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/canonicalize.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/canonicalize.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Workflow input/output canonicalization",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import copy",
        "import hashlib",
        "import json",
        "from datetime import datetime",
        "from decimal import Decimal",
        "from typing import Any, Dict, List, Optional, Set"
      ],
      "classes": [],
      "functions": [
        "_normalize_key",
        "_resolve_key_collisions",
        "canonicalize_for_golden",
        "_canonicalize_value",
        "_is_sensitive_key",
        "canonical_json",
        "canonical_hash",
        "redact_sensitive_fields",
        "_redact_recursive",
        "compare_canonical",
        "_find_diffs",
        "strip_volatile_from_events"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/platform_health_service.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/platform_health_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Platform Health Authority - THE source of truth for platform state",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Optional",
        "from sqlalchemy import and_, func, or_, select",
        "from sqlmodel import Session",
        "from app.models.governance import GovernanceSignal",
        "from app.models.killswitch import Incident"
      ],
      "classes": [
        "HealthState",
        "SignalType",
        "HealthReason",
        "CapabilityHealth",
        "DomainHealth",
        "SystemHealth",
        "PlatformHealthService"
      ],
      "functions": [
        "get_platform_health_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/vector_store.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/vector_store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import os",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "import httpx",
        "from sqlalchemy import text as sql_text",
        "from app.db_async import async_session_context",
        "from app.memory.embedding_metrics import (",
        "from app.security.sanitize import sanitize_for_embedding"
      ],
      "classes": [
        "EmbeddingError",
        "VectorMemoryStore"
      ],
      "functions": [
        "get_embedding_openai",
        "get_embedding_voyage",
        "get_embedding",
        "compute_text_hash",
        "get_vector_memory_store"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/governor.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/governor.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "CARE-L routing governor/throttling",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Dict, List, Optional, Tuple",
        "from uuid import uuid4",
        "import redis.asyncio as redis_async",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "GovernorState",
        "RollbackReason",
        "AdjustmentRecord",
        "StabilityMetrics",
        "RollbackResult",
        "Governor"
      ],
      "functions": [
        "get_governor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/memory_store.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/memory_store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional, Protocol, cast",
        "from sqlmodel import Session, desc, select",
        "from ..db import Memory, engine"
      ],
      "classes": [
        "MemoryStore",
        "PostgresMemoryStore"
      ],
      "functions": [
        "get_memory_store"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/probes.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/probes.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "CARE-L health probes for routing",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import json",
        "import logging",
        "import os",
        "import socket",
        "import time",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "import redis.asyncio as redis",
        "from .models import ("
      ],
      "classes": [
        "CapabilityProber"
      ],
      "functions": [
        "get_capability_prober"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/console_modes.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/console_modes.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Runtime safety switches for console deployment",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from enum import Enum",
        "from typing import Any"
      ],
      "classes": [
        "ConsoleMode",
        "DataMode",
        "ActionMode"
      ],
      "functions": [
        "get_console_mode",
        "get_data_mode",
        "get_action_mode",
        "is_draft_mode",
        "is_live_mode",
        "is_maintenance_mode",
        "is_synthetic_data",
        "is_real_data",
        "is_action_noop",
        "is_action_live",
        "should_execute_action",
        "log_noop_action",
        "get_noop_actions",
        "clear_noop_actions",
        "get_console_status",
        "log_console_status"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/failure_catalog.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/failure_catalog.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import json",
        "import logging",
        "import time",
        "from concurrent.futures import ThreadPoolExecutor",
        "from concurrent.futures import TimeoutError as FutureTimeoutError",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from pathlib import Path",
        "from threading import Lock",
        "from typing import Any, Dict, List, Optional, Union"
      ],
      "classes": [
        "MatchType",
        "RecoveryStrategy",
        "CatalogEntry",
        "MatchResult",
        "FailureCatalog"
      ],
      "functions": [
        "_get_persist_executor",
        "_check_circuit_breaker",
        "_record_circuit_failure",
        "_record_circuit_success",
        "_init_metrics",
        "get_catalog",
        "match_failure",
        "persist_failure_match",
        "persist_failure_match_async",
        "persist_failure_match_nonblocking",
        "update_recovery_status",
        "match_and_persist"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/error_envelope.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/error_envelope.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Unified error envelope for forensic diagnostics",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import uuid",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "ErrorSeverity",
        "ErrorClass",
        "ErrorEnvelope"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/executor.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/executor.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Bind JobScheduler to APScheduler for actual execution",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Callable, Dict, List, Optional"
      ],
      "classes": [
        "ExecutorConfig",
        "APSchedulerExecutor"
      ],
      "functions": [
        "get_scheduler_executor",
        "configure_scheduler_executor",
        "reset_scheduler_executor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/drivers/events.py",
      "relative_path": "app/houseofcards/internal/platform/drivers/events.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-8 Unified Event model",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Optional",
        "import uuid"
      ],
      "classes": [
        "Severity",
        "ActorType",
        "EventSource",
        "Actor",
        "EventContext",
        "UnifiedEvent"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/facades/stub_adapter.py",
      "relative_path": "app/houseofcards/internal/platform/facades/stub_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Stub LLM adapter for testing",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "StubPlanner"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/facades/anthropic_adapter.py",
      "relative_path": "app/houseofcards/internal/platform/facades/anthropic_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Anthropic Claude LLM adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import time",
        "import uuid",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "AnthropicPlanner"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/state_resolver.py",
      "relative_path": "app/houseofcards/internal/platform/engines/state_resolver.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Tenant state derivation (authoritative)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from enum import IntEnum",
        "from typing import Optional",
        "from fastapi import HTTPException",
        "from sqlalchemy import select, func",
        "from sqlalchemy.ext.asyncio import AsyncSession"
      ],
      "classes": [
        "TenantState",
        "TenantStateResolver",
        "TenantNotFoundError",
        "TenantNotReadyError"
      ],
      "functions": [
        "require_tenant_ready",
        "require_tenant_active"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/config.py",
      "relative_path": "app/houseofcards/internal/platform/engines/config.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Learning system configuration",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import os",
        "from functools import wraps",
        "from typing import Any, Callable, Optional, TypeVar"
      ],
      "classes": [],
      "functions": [
        "learning_enabled",
        "set_learning_enabled",
        "require_learning_enabled"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/failure_intelligence.py",
      "relative_path": "app/houseofcards/internal/platform/engines/failure_intelligence.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Canonical export surface for failure intelligence domain concepts",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [],
      "imports": [
        "from app.jobs.failure_classification_engine import (",
        "from app.services.recovery_rule_engine import (",
        "from app.services.recovery_rule_engine import ("
      ],
      "classes": [],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/tables.py",
      "relative_path": "app/houseofcards/internal/platform/engines/tables.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Learning system database tables",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [],
      "classes": [
        "LearningBoundaryViolation"
      ],
      "functions": [
        "validate_table_access"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/m10_metrics_collector.py",
      "relative_path": "app/houseofcards/internal/platform/engines/m10_metrics_collector.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "M10 metrics collection task",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent",
        "import asyncio",
        "import logging",
        "import os",
        "import time",
        "from typing import Optional",
        "from sqlalchemy import text",
        "from app.metrics import ("
      ],
      "classes": [],
      "functions": [
        "collect_redis_stream_metrics",
        "collect_db_queue_metrics",
        "collect_matview_freshness",
        "collect_candidate_stats",
        "collect_m10_metrics",
        "run_metrics_collector",
        "main",
        "daemon_main"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/errors.py",
      "relative_path": "app/houseofcards/internal/platform/engines/errors.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Workflow error types and classification",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, Dict, Optional"
      ],
      "classes": [
        "ErrorCategory",
        "WorkflowErrorCode",
        "WorkflowError"
      ],
      "functions": [
        "classify_exception",
        "get_error_metadata"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/health.py",
      "relative_path": "app/houseofcards/internal/platform/engines/health.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Workflow health checks and status",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "APIRouter",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "return JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional"
      ],
      "classes": [],
      "functions": [
        "configure_health",
        "record_checkpoint_activity",
        "healthz",
        "readyz",
        "workflow_status",
        "workflow_config"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/sandbox_service.py",
      "relative_path": "app/houseofcards/internal/platform/engines/sandbox_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "INTERNAL",
        "role": "High-level sandbox service with policy enforcement",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Set",
        "from .sandbox_executor import ("
      ],
      "classes": [
        "SandboxPolicy",
        "ExecutionRequest",
        "ExecutionRecord",
        "SandboxService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/s1_rollback.py",
      "relative_path": "app/houseofcards/internal/platform/engines/s1_rollback.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "S1 rollback learning and suggestions",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from collections import defaultdict",
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Dict, List, Optional",
        "from app.learning.config import learning_enabled, require_learning_enabled",
        "from app.learning.suggestions import (",
        "from app.optimization.envelope import ("
      ],
      "classes": [
        "RollbackStats",
        "RollbackObserver"
      ],
      "functions": [
        "get_rollback_observer",
        "observe_rollback_frequency"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/external_guard.py",
      "relative_path": "app/houseofcards/internal/platform/engines/external_guard.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "External call guards for workflow safety",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "import socket",
        "from contextlib import contextmanager",
        "from typing import Any, Callable, List, Optional, Set, Tuple",
        "from unittest.mock import patch"
      ],
      "classes": [
        "ExternalCallBlockedError",
        "_BlockedSocket",
        "ExternalCallsGuard"
      ],
      "functions": [
        "is_external_calls_disabled",
        "get_blocked_calls",
        "clear_blocked_calls",
        "check_external_call_allowed",
        "_create_blocking_socket_factory",
        "block_external_calls",
        "require_no_external_calls",
        "assert_no_external_calls_made"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/evaluator.py",
      "relative_path": "app/houseofcards/internal/platform/engines/evaluator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Core limits evaluation engine (PIN-LIM-03)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from decimal import Decimal",
        "from enum import Enum",
        "from typing import Optional",
        "from app.schemas.limits.simulation import ("
      ],
      "classes": [
        "LimitGroup",
        "ExecutionIntent",
        "TenantQuotas",
        "CostBudget",
        "PolicyLimit",
        "WorkerLimit",
        "ActiveOverride",
        "EvaluationContext",
        "EvaluationResult",
        "LimitsEvaluator"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/engine.py",
      "relative_path": "app/houseofcards/internal/platform/engines/engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Deterministic workflow execution engine",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import hashlib",
        "import json",
        "import logging",
        "import random",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Protocol",
        "from .errors import (",
        "from .metrics import (",
        "from .checkpoint import CheckpointStore",
        "from .golden import GoldenRecorder",
        "from .planner_sandbox import PlannerSandbox",
        "from .policies import PolicyEnforcer"
      ],
      "classes": [
        "StepDescriptor",
        "WorkflowSpec",
        "StepContext",
        "StepResult",
        "WorkflowResult",
        "SkillRegistry",
        "WorkflowEngine"
      ],
      "functions": [
        "_derive_seed",
        "_deterministic_jitter",
        "_compute_backoff_ms",
        "_canonical_json",
        "_content_hash"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/metrics.py",
      "relative_path": "app/houseofcards/internal/platform/engines/metrics.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Workflow Prometheus metrics instrumentation",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import logging",
        "from typing import Optional"
      ],
      "classes": [],
      "functions": [
        "_hash_tenant",
        "record_workflow_failure",
        "record_step_failure",
        "record_checkpoint_operation",
        "record_replay_verification",
        "record_step_duration",
        "record_workflow_start",
        "record_workflow_end",
        "record_capability_violation",
        "record_policy_decision",
        "record_budget_rejection",
        "record_fallback_activation",
        "record_auto_recovery",
        "record_cost_simulation_drift",
        "set_emergency_stop",
        "record_budget_breach",
        "set_approval_requests_pending",
        "record_approval_request_created",
        "record_approval_escalation",
        "record_approval_action",
        "record_webhook_fallback",
        "set_feature_flag_drift",
        "set_feature_flag",
        "set_m5_signoff_present",
        "check_m5_signoff"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/customer_sandbox.py",
      "relative_path": "app/houseofcards/internal/platform/engines/customer_sandbox.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Customer Sandbox Authentication for local development and CI",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from typing import FrozenSet, Optional",
        "import hashlib"
      ],
      "classes": [
        "SandboxSafetyViolation",
        "SandboxCustomerPrincipal",
        "SandboxAuthResult"
      ],
      "functions": [
        "_is_prod_database",
        "_check_environment_safety",
        "is_sandbox_allowed",
        "_compute_sandbox_fingerprint",
        "resolve_sandbox_auth",
        "extract_sandbox_key",
        "has_conflicting_auth_headers",
        "try_sandbox_auth_with_error",
        "try_sandbox_auth",
        "get_sandbox_capabilities",
        "is_sandbox_principal"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/kill_switch_guard.py",
      "relative_path": "app/houseofcards/internal/platform/engines/kill_switch_guard.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Guard that enforces RuntimeSwitch checks during job execution",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import time",
        "from typing import Optional, Callable, Awaitable",
        "from app.services.governance.runtime_switch import ("
      ],
      "classes": [
        "JobKilledException",
        "KillSwitchGuard"
      ],
      "functions": [
        "get_kill_switch_guard"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/engines/replay.py",
      "relative_path": "app/houseofcards/internal/platform/engines/replay.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import os",
        "from dataclasses import dataclass",
        "from typing import Any",
        "from app.traces.models import (",
        "from app.traces.store import ("
      ],
      "classes": [
        "ReplayResult",
        "ReplayEngine"
      ],
      "functions": [
        "get_trace_store",
        "replay_run",
        "validate_determinism"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/policy/engines/policy_driver.py",
      "relative_path": "app/houseofcards/internal/platform/policy/engines/policy_driver.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "INTERNAL",
        "role": "Policy Domain Driver - Internal orchestration for policy operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Driver"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "PolicyDriver"
      ],
      "functions": [
        "get_policy_driver",
        "reset_policy_driver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/governance/drivers/governance_signal_service.py",
      "relative_path": "app/houseofcards/internal/platform/governance/drivers/governance_signal_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Governance signal persistence service",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.flush\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from sqlalchemy import and_, or_, select, update",
        "from sqlalchemy.orm import Session",
        "from app.models.governance import ("
      ],
      "classes": [
        "GovernanceSignalService"
      ],
      "functions": [
        "check_governance_status",
        "is_governance_blocked",
        "record_governance_signal"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/platform/iam/engines/iam_service.py",
      "relative_path": "app/houseofcards/internal/platform/iam/engines/iam_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "INTERNAL",
        "role": "IAM service for identity and access management",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Set"
      ],
      "classes": [
        "IdentityProvider",
        "ActorType",
        "Identity",
        "AccessDecision",
        "IAMService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/recovery/drivers/scoped_execution.py",
      "relative_path": "app/houseofcards/internal/recovery/drivers/scoped_execution.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Pre-execution gate, scope enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import logging",
        "import secrets",
        "import threading",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from functools import wraps",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "RiskClass",
        "ExecutionScope",
        "ScopedExecutionResult",
        "RecoveryAction",
        "ScopedExecutionContext",
        "ScopedExecutionRequired",
        "ScopeNotFound",
        "ScopeExhausted",
        "ScopeExpired",
        "ScopeActionMismatch",
        "ScopeIncidentMismatch",
        "BoundExecutionScope",
        "ScopeStore"
      ],
      "functions": [
        "get_scope_store",
        "create_recovery_scope",
        "execute_with_scope",
        "validate_scope_required",
        "requires_scoped_execution",
        "test_recovery_scope"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/recovery/drivers/recovery_matcher.py",
      "relative_path": "app/houseofcards/internal/recovery/drivers/recovery_matcher.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import hashlib",
        "import logging",
        "import math",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from app.security.sanitize import sanitize_error_message"
      ],
      "classes": [
        "MatchResult",
        "RecoveryMatcher"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/recovery/drivers/orphan_recovery.py",
      "relative_path": "app/houseofcards/internal/recovery/drivers/orphan_recovery.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Orphan detection logic, PB-S2 truth guarantee",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import logging",
        "import os",
        "from datetime import datetime, timedelta",
        "from typing import Optional",
        "from sqlalchemy import select, update",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import get_async_session",
        "from app.models.tenant import WorkerRun"
      ],
      "classes": [],
      "functions": [
        "detect_orphaned_runs",
        "mark_run_as_crashed",
        "recover_orphaned_runs",
        "get_crash_recovery_summary"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/recovery/drivers/sanitize.py",
      "relative_path": "app/houseofcards/internal/recovery/drivers/sanitize.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Sanitize text before embedding to prevent secret leakage",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import re",
        "from typing import List, Tuple"
      ],
      "classes": [],
      "functions": [
        "sanitize_for_embedding",
        "sanitize_error_message",
        "is_safe_for_embedding"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/recovery/drivers/recovery_write_service.py",
      "relative_path": "app/houseofcards/internal/recovery/drivers/recovery_write_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "DB write delegation for Recovery APIs (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "from typing import Any, Dict, Optional, Tuple",
        "from sqlalchemy import text",
        "from sqlmodel import Session"
      ],
      "classes": [
        "RecoveryWriteService"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/recovery/engines/incident_driver.py",
      "relative_path": "app/houseofcards/internal/recovery/engines/incident_driver.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "INTERNAL",
        "role": "Incident Domain Driver - Internal orchestration for incident operations",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Driver"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID"
      ],
      "classes": [
        "IncidentDriver"
      ],
      "functions": [
        "get_incident_driver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/recovery/engines/recovery_queue.py",
      "relative_path": "app/houseofcards/internal/recovery/engines/recovery_queue.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Recovery queue processing",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional"
      ],
      "classes": [],
      "functions": [
        "get_redis",
        "enqueue_evaluation",
        "dequeue_evaluation",
        "complete_evaluation",
        "requeue_failed",
        "get_queue_stats",
        "close"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/drivers/brand.py",
      "relative_path": "app/houseofcards/internal/policies/drivers/brand.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Brand schema definitions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, Field, field_validator"
      ],
      "classes": [
        "ToneLevel",
        "AudienceSegment",
        "ToneRule",
        "ForbiddenClaim",
        "VisualIdentity",
        "CompetitorContext",
        "BrandSchema"
      ],
      "functions": [
        "create_minimal_brand"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/drivers/boot_guard.py",
      "relative_path": "app/houseofcards/internal/policies/drivers/boot_guard.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Enforce boot-fail policy for SPINE components",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import List, Optional",
        "import logging"
      ],
      "classes": [
        "SpineValidationResult",
        "SpineValidationError"
      ],
      "functions": [
        "validate_spine_components",
        "get_boot_status",
        "reset_boot_status"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/drivers/storage.py",
      "relative_path": "app/houseofcards/internal/policies/drivers/storage.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Storage maintenance jobs",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@retry",
          "layer": "RETRY_PATTERN",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        },
        {
          "pattern": "tenacity",
          "layer": "RETRY_PATTERN",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "import time",
        "from typing import Any, Dict, Optional",
        "import boto3",
        "from botocore.config import Config",
        "from botocore.exceptions import ClientError",
        "from tenacity import (",
        "from app.utils.metrics_helpers import get_or_create_counter, get_or_create_histogram"
      ],
      "classes": [],
      "functions": [
        "_load_r2_secrets_from_vault",
        "make_s3_client",
        "is_r2_configured",
        "sha256_bytes",
        "generate_object_key",
        "upload_to_r2_bytes",
        "write_local_fallback",
        "write_candidate_json_and_upload",
        "retry_local_fallback",
        "_record_export_to_db",
        "_update_export_status",
        "verify_r2_object",
        "list_r2_objects"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/drivers/publisher.py",
      "relative_path": "app/houseofcards/internal/policies/drivers/publisher.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Event publishing abstraction",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, Optional"
      ],
      "classes": [
        "BasePublisher",
        "LoggingPublisher"
      ],
      "functions": [
        "get_publisher",
        "reset_publisher"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/drivers/execution_plan.py",
      "relative_path": "app/houseofcards/internal/policies/drivers/execution_plan.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Business builder execution planning",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum, auto",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "StageStatus",
        "StageCategory",
        "StageResult",
        "ExecutionStage",
        "ExecutionPlan"
      ],
      "functions": [
        "create_business_builder_plan"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/drivers/execution_context.py",
      "relative_path": "app/houseofcards/internal/policies/drivers/execution_context.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "INTERNAL",
        "role": "ExecutionContext - authoritative execution identity and causality carrier",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from dataclasses import dataclass, field, replace",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Optional"
      ],
      "classes": [
        "ExecutionPhase",
        "EvidenceSource",
        "ExecutionContext",
        "ExecutionCursor"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/drivers/strategy.py",
      "relative_path": "app/houseofcards/internal/policies/drivers/strategy.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Strategy generation stage",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List"
      ],
      "classes": [
        "StrategyOutput",
        "StrategyStage"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/drivers/step_enforcement_hook.py",
      "relative_path": "app/houseofcards/internal/policies/drivers/step_enforcement_hook.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Wire StepEnforcement to event bus for policy evaluation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional",
        "from app.core.execution_context import ExecutionContext"
      ],
      "classes": [
        "StepEnforcementEvent",
        "StepEnforcementHook"
      ],
      "functions": [
        "get_step_enforcement_hook",
        "configure_step_enforcement_hook",
        "reset_step_enforcement_hook"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/drivers/query_authority.py",
      "relative_path": "app/houseofcards/internal/policies/drivers/query_authority.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Query authority enforcement for data access",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Any",
        "from .rbac_rules_loader import AggregationLevel, QueryAuthority"
      ],
      "classes": [
        "QueryAuthorityViolation",
        "QueryConstraints"
      ],
      "functions": [
        "enforce_query_authority",
        "_aggregation_permitted",
        "calculate_time_range_days",
        "extract_query_constraints",
        "_parse_bool",
        "validate_promotion_safety"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/engines/policy_checker.py",
      "relative_path": "app/houseofcards/internal/policies/engines/policy_checker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Mid-execution policy checking for reactive enforcement",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, FrozenSet, List, Optional",
        "from uuid import UUID",
        "from sqlmodel import Session, select"
      ],
      "classes": [
        "PolicyDecision",
        "PolicyViolationType",
        "PolicyViolation",
        "PauseReason",
        "PauseResumeAuthority",
        "PauseTimeoutBehavior",
        "PausedRunState",
        "PauseManager",
        "PolicyCheckResult",
        "PolicyTermination",
        "PolicyPause",
        "MidExecutionPolicyChecker",
        "_dummy_context"
      ],
      "functions": [
        "get_pause_manager",
        "get_policy_checker",
        "reset_policy_checker"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/engines/rbac_middleware.py",
      "relative_path": "app/houseofcards/internal/policies/engines/rbac_middleware.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "FastAPI RBAC middleware for request auth",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "return JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional",
        "import jwt",
        "from fastapi import Request",
        "from fastapi.responses import JSONResponse",
        "from starlette.middleware.base import BaseHTTPMiddleware",
        "from starlette.types import ASGIApp",
        "from ..utils.metrics_helpers import get_or_create_counter, get_or_create_histogram",
        "from .contexts import (",
        "from .customer_sandbox import SandboxCustomerPrincipal, get_sandbox_capabilities",
        "from .gateway_middleware import get_auth_context",
        "from .oidc_provider import (",
        "from .rbac_rules_loader import get_public_paths",
        "from .shadow_audit import ("
      ],
      "classes": [
        "PolicyObject",
        "Decision",
        "RBACMiddleware"
      ],
      "functions": [
        "get_policy_for_path",
        "derive_capabilities_from_context",
        "has_capability",
        "extract_roles_from_request",
        "enforce",
        "check_permission",
        "require_permission"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/engines/graduation_evaluator.py",
      "relative_path": "app/houseofcards/internal/policies/engines/graduation_evaluator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Agent graduation evaluation job (orchestration only)",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import asyncio",
        "import json",
        "import logging",
        "from datetime import datetime, timedelta, timezone"
      ],
      "classes": [],
      "functions": [
        "fetch_graduation_evidence",
        "_get_total_policy_evaluations",
        "evaluate_graduation_status",
        "run_periodic_evaluation",
        "main"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/engines/recovery_claim_worker.py",
      "relative_path": "app/houseofcards/internal/policies/engines/recovery_claim_worker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Recovery claim processing orchestration (L5 execution wrapper)",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Worker\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def process_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import argparse",
        "import asyncio",
        "import json",
        "import logging",
        "import os",
        "import signal",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from sqlalchemy import text",
        "from sqlmodel import Session, create_engine"
      ],
      "classes": [
        "RecoveryClaimWorker"
      ],
      "functions": [
        "record_worker_invocation",
        "signal_handler",
        "main_async",
        "main"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/engines/rbac_engine.py",
      "relative_path": "app/houseofcards/internal/policies/engines/rbac_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "RBAC authorization engine with policy evaluation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "return JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "import threading",
        "import time",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from pathlib import Path",
        "from typing import Any, Callable, Dict, List, Optional, Tuple",
        "import jwt",
        "from fastapi import Request",
        "from ..utils.metrics_helpers import get_or_create_counter, get_or_create_gauge, get_or_create_histogram"
      ],
      "classes": [
        "PolicyObject",
        "Decision",
        "PolicyConfig",
        "RBACEngine"
      ],
      "functions": [
        "get_role_approval_level",
        "get_max_approval_level",
        "map_external_role_to_aos",
        "map_external_roles_to_aos",
        "get_policy_for_path",
        "get_rbac_engine",
        "init_rbac_engine",
        "check_permission",
        "require_permission"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/engines/job_queue_worker.py",
      "relative_path": "app/houseofcards/internal/policies/engines/job_queue_worker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Background worker that processes job queue",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Worker\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import json",
        "import logging",
        "import signal",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Callable, Dict, List, Optional"
      ],
      "classes": [
        "WorkerConfig",
        "JobMessage",
        "WorkerStats",
        "JobQueueWorker"
      ],
      "functions": [
        "get_job_queue_worker",
        "configure_job_queue_worker",
        "reset_job_queue_worker"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/engines/recovery_queue_stream.py",
      "relative_path": "app/houseofcards/internal/policies/engines/recovery_queue_stream.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Recovery queue stream processing",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def process_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import json",
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Any, AsyncIterator, Dict, List, Optional, Tuple"
      ],
      "classes": [],
      "functions": [
        "get_redis",
        "ensure_consumer_group",
        "enqueue_stream",
        "consume_batch",
        "consume_stream",
        "ack_message",
        "ack_and_delete",
        "claim_stalled_messages",
        "get_stream_info",
        "close",
        "move_to_dead_letter",
        "process_stalled_with_dead_letter",
        "get_dead_letter_count",
        "archive_dead_letter_to_db",
        "archive_and_trim_dead_letter",
        "get_reclaim_attempts",
        "increment_reclaim_attempts",
        "clear_reclaim_attempts",
        "gc_reclaim_attempts",
        "calculate_backoff_ms",
        "replay_dead_letter",
        "_record_replay_to_db",
        "replay_all_dead_letters"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/engines/limit_hook.py",
      "relative_path": "app/houseofcards/internal/policies/engines/limit_hook.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L6",
        "audience": "INTERNAL",
        "role": "Enforce usage limits and monitor health in runner",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, Optional",
        "from app.core.execution_context import ExecutionContext"
      ],
      "classes": [
        "LimitDecision",
        "LimitType",
        "LimitCheckResult",
        "UsageRecord",
        "LimitHook"
      ],
      "functions": [
        "get_limit_hook",
        "configure_limit_hook",
        "reset_limit_hook"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/policies/engines/rbac.py",
      "relative_path": "app/houseofcards/internal/policies/engines/rbac.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "RBAC core logic and permission checks",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from enum import IntEnum",
        "from typing import Optional",
        "import httpx"
      ],
      "classes": [
        "ApprovalLevel",
        "RBACResult",
        "RBACError"
      ],
      "functions": [
        "_get_user_roles_async",
        "_get_user_roles",
        "_role_to_level",
        "check_approver_permission",
        "require_approval_level"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/blackboard_ops.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/blackboard_ops.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Blackboard read/write operations skill",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, Field",
        "from ..services.blackboard_service import BlackboardService, get_blackboard_service",
        "from ..services.credit_service import CREDIT_COSTS, CreditService, get_credit_service"
      ],
      "classes": [
        "BlackboardReadInput",
        "BlackboardReadOutput",
        "BlackboardReadSkill",
        "BlackboardWriteInput",
        "BlackboardWriteOutput",
        "BlackboardWriteSkill",
        "BlackboardLockInput",
        "BlackboardLockOutput",
        "BlackboardLockSkill"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/panel_capability_resolver.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/panel_capability_resolver.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Resolve capability IDs to endpoints via AURORA registry",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional",
        "import yaml"
      ],
      "classes": [
        "CapabilityStatus",
        "ResolvedCapability",
        "CapabilityRegistryEntry",
        "PanelCapabilityResolver"
      ],
      "functions": [
        "get_capability_resolver"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/transaction.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/transaction.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Single-connection transaction primitives for lock-safe operations",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import functools",
        "import inspect",
        "import logging",
        "from contextlib import contextmanager",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Generator, Optional, Type, TypeVar",
        "from sqlalchemy import create_engine",
        "from sqlalchemy.pool import StaticPool",
        "from sqlmodel import Session, select"
      ],
      "classes": [
        "TransactionIntent",
        "IntentViolationError",
        "SingleConnectionTxn"
      ],
      "functions": [
        "get_intent_registry",
        "transactional",
        "require_intent",
        "single_connection_transaction",
        "single_connection_transaction_with_engine",
        "get_or_create_locked"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/tenant_config.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/tenant_config.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Tenant LLM configuration adapter",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from typing import Dict, List, Optional"
      ],
      "classes": [
        "TenantLLMConfig"
      ],
      "functions": [
        "_load_config_from_env",
        "_load_config_from_vault",
        "get_default_config",
        "get_tenant_config",
        "reset_config_cache",
        "get_model_for_tenant"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/panel_consistency_checker.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/panel_consistency_checker.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Cross-slot consistency enforcement",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional",
        "from .panel_types import PanelSlotResult"
      ],
      "classes": [
        "ConsistencyViolation",
        "ConsistencyCheckResult",
        "PanelConsistencyChecker"
      ],
      "functions": [
        "create_consistency_checker"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/research.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/research.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Research stage",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "ResearchOutput",
        "ResearchStage"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/panel_types.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/panel_types.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Shared type primitives for Panel Adapter",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "TruthClass",
        "TruthLens",
        "SlotState",
        "Authority",
        "NegativeAuthorityValue",
        "PanelSlotContext",
        "VerificationSignals",
        "TruthMetadata",
        "TimeSemantics",
        "SlotProvenance",
        "PanelSlotResult",
        "PanelResult",
        "InputSignalSpec",
        "OutputSignalSpec",
        "APISpec",
        "ConsumedCapabilitySpec",
        "InputSignalsSpec",
        "SlotSpec",
        "PanelSpec",
        "DependencySpec",
        "DeterminismRule"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/copy.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/copy.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Copy generation stage",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List"
      ],
      "classes": [
        "CopyOutput",
        "CopyStage"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/kv_store.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/kv_store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import time",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional, Type",
        "import redis.asyncio as redis",
        "from pydantic import BaseModel",
        "from ..schemas.skill import KVStoreInput, KVStoreOutput",
        "from .registry import skill"
      ],
      "classes": [
        "KVStoreConfig",
        "KVStoreSkill"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/sdsr_fail_trigger.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/sdsr_fail_trigger.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "SDSR failure trigger skill for controlled test failures",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "time\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import logging",
        "import time",
        "from typing import Any, Dict, Optional",
        "from pydantic import BaseModel, Field",
        "from .executor import BudgetExceededError, SkillExecutionError",
        "from .registry import skill"
      ],
      "classes": [
        "SDSRFailTriggerInput",
        "SDSRFailTriggerOutput",
        "SDSRFailError",
        "SDSRFailTriggerSkill"
      ],
      "functions": [
        "verify_sdsr_skill_registered"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/generator.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/generator.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "SBA agent generation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import inspect",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional, Type",
        "from .schema import ("
      ],
      "classes": [
        "GenerationQuality",
        "GenerationReport",
        "SBAGenerator"
      ],
      "functions": [
        "generate_sba_from_agent",
        "generate_sba_from_spawn_input",
        "retrofit_existing_agents"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/feature_intent.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/feature_intent.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Feature-level intent declarations for self-defending architecture",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import functools",
        "import logging",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional, Set, Tuple"
      ],
      "classes": [
        "FeatureIntent",
        "RetryPolicy",
        "IntentConsistencyError",
        "RetryPolicyError",
        "FeatureDeclaration"
      ],
      "functions": [
        "validate_intent_consistency",
        "validate_retry_policy",
        "get_feature_registry",
        "register_feature",
        "feature",
        "validate_module_intent"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/json_transform_stub.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/json_transform_stub.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "import re",
        "import sys",
        "from dataclasses import dataclass, field",
        "from pathlib import Path",
        "from typing import Any, Dict, List",
        "from core import SkillDescriptor"
      ],
      "classes": [
        "JsonTransformStub"
      ],
      "functions": [
        "json_transform_stub_handler",
        "get_json_transform_stub",
        "configure_json_transform_stub"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/worker_write_service_async.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/worker_write_service_async.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "DB write delegation for Worker API (Phase 2B extraction)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "from datetime import datetime",
        "from typing import Any, Dict, Optional",
        "from sqlalchemy import select",
        "from sqlalchemy.ext.asyncio import AsyncSession",
        "from app.db import CostAnomaly, CostRecord",
        "from app.models.tenant import WorkerRun"
      ],
      "classes": [
        "WorkerWriteServiceAsync"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/db.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/db.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Database connection, SQLModel definitions, session management",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import os",
        "import uuid",
        "from contextlib import asynccontextmanager",
        "from datetime import date, datetime, timezone",
        "from typing import AsyncGenerator, Optional",
        "from sqlalchemy import JSON, Column",
        "from sqlalchemy.ext.asyncio import AsyncSession, async_sessionmaker, create_async_engine",
        "from sqlalchemy.orm import sessionmaker",
        "from sqlmodel import Field, Session, SQLModel, create_engine"
      ],
      "classes": [
        "_LazyEngine",
        "Agent",
        "Memory",
        "Run",
        "Provenance",
        "FeatureFlag",
        "PolicyApprovalLevel",
        "ApprovalRequest",
        "CostSimCBState",
        "CostSimCBIncident",
        "StatusHistory",
        "FailureMatch",
        "FeatureTag",
        "CostRecord",
        "CostAnomaly",
        "CostBreachHistory",
        "CostDriftTracking",
        "CostBudget",
        "CostDailyAggregate",
        "SDSRIncident"
      ],
      "functions": [
        "utc_now",
        "get_database_url",
        "get_engine",
        "get_async_database_url",
        "get_async_engine",
        "get_async_session_factory",
        "get_async_session",
        "get_async_session_dep",
        "init_db",
        "get_session",
        "log_status_change"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/validator.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/validator.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "SBA agent validation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional, Set",
        "from pydantic import ValidationError",
        "from .schema import ("
      ],
      "classes": [
        "SBAValidationErrorCode",
        "SBAValidationError",
        "SBAValidationResult",
        "SBAValidator"
      ],
      "functions": [
        "validate_sba",
        "validate_at_spawn"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/ux.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/ux.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "UX generation stage",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Any, Dict"
      ],
      "classes": [
        "UXOutput",
        "UXStage"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/skill_registry_filter.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/skill_registry_filter.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Filter skill registry based on governance profile",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, Set, Optional, List",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "import logging"
      ],
      "classes": [
        "GovernanceProfile",
        "FilterResult"
      ],
      "functions": [
        "filter_skills_for_governance",
        "validate_skill_governance",
        "get_governed_replacement",
        "is_approval_required",
        "get_skill_governance_info"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/agent_spawn.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/agent_spawn.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Parallel worker agent spawn skill",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, Field",
        "from ..services.credit_service import CREDIT_COSTS, CreditService, get_credit_service",
        "from ..services.job_service import JobConfig, JobService, get_job_service",
        "from ..services.registry_service import RegistryService, get_registry_service"
      ],
      "classes": [
        "AgentSpawnInput",
        "AgentSpawnOutput",
        "AgentSpawnSkill"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/semantic_types.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/semantic_types.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Type definitions for semantic validation",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "ViolationClass",
        "SemanticSeverity",
        "IntentFailureCode",
        "SemanticFailureCode",
        "SemanticContext",
        "SemanticViolation",
        "SemanticReport",
        "SemanticBinding"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/registry_v2.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/registry_v2.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": null,
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import json",
        "import logging",
        "import sqlite3",
        "import sys",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from pathlib import Path",
        "from typing import (",
        "from core import SkillDescriptor"
      ],
      "classes": [
        "SkillVersion",
        "SkillRegistration",
        "SkillRegistry",
        "ContractDiff"
      ],
      "functions": [
        "get_global_registry",
        "set_global_registry",
        "register_skill",
        "get_skill_handler",
        "get_skill_descriptor",
        "compare_versions",
        "diff_contracts",
        "is_version_compatible",
        "resolve_skill_with_version"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/worker_registry_service.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/worker_registry_service.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Worker discovery, status queries, capability registry",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.refresh\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "from typing import Any, Dict, List, Optional",
        "from sqlmodel import Session, select",
        "from ..models.tenant import WorkerConfig, WorkerRegistry"
      ],
      "classes": [
        "WorkerRegistryError",
        "WorkerNotFoundError",
        "WorkerUnavailableError",
        "WorkerRegistryService"
      ],
      "functions": [
        "get_worker_registry_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/drivers/llm_invoke_governed.py",
      "relative_path": "app/houseofcards/internal/agent/drivers/llm_invoke_governed.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Governed LLM invocation skill with budget enforcement",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import sys",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "from pydantic import BaseModel, Field"
      ],
      "classes": [
        "LLMMessage",
        "LLMInvokeGovernedInput",
        "LLMInvokeGovernedOutput",
        "GovernanceConfig",
        "GovernedLLMClient",
        "LLMInvokeGovernedSkill"
      ],
      "functions": [
        "get_default_governance_config",
        "get_governed_llm_skill",
        "governed_llm_invoke"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/facades/openai_adapter.py",
      "relative_path": "app/houseofcards/internal/agent/facades/openai_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "OpenAI API translation adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import os",
        "import time",
        "from typing import Any, Dict, List, Optional, Tuple, Union"
      ],
      "classes": [
        "OpenAIAdapter",
        "OpenAIAdapterStub"
      ],
      "functions": [
        "_get_base_types",
        "register_openai_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/facades/claude_adapter.py",
      "relative_path": "app/houseofcards/internal/agent/facades/claude_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import os",
        "import time",
        "from typing import Any, Dict, List, Optional, Tuple, Union"
      ],
      "classes": [
        "ClaudeAdapter",
        "ClaudeAdapterStub"
      ],
      "functions": [
        "_get_base_types",
        "register_claude_adapter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/llm_invoke_v2.py",
      "relative_path": "app/houseofcards/internal/agent/engines/llm_invoke_v2.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import sys",
        "from abc import ABC, abstractmethod",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional, Tuple, Union",
        "from app.worker.runtime.core import SkillDescriptor, StructuredOutcome"
      ],
      "classes": [
        "ErrorCategory",
        "ErrorMapping",
        "Message",
        "LLMConfig",
        "LLMResponse",
        "LLMAdapter",
        "StubAdapter"
      ],
      "functions": [
        "estimate_cost",
        "_canonical_json",
        "_content_hash",
        "_generate_call_id",
        "register_adapter",
        "get_adapter",
        "list_adapters",
        "llm_invoke_execute",
        "llm_invoke_handler",
        "register_llm_invoke"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/json_transform.py",
      "relative_path": "app/houseofcards/internal/agent/engines/json_transform.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, Field",
        "from .registry import skill"
      ],
      "classes": [
        "TransformMapping",
        "JsonTransformInput",
        "JsonTransformOutput",
        "JsonTransformSkill"
      ],
      "functions": [
        "_get_path",
        "transform_json"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/registry_service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/registry_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID, uuid4",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker"
      ],
      "classes": [
        "AgentInstance",
        "RegistrationResult",
        "RegistryService"
      ],
      "functions": [
        "get_registry_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/llm_invoke.py",
      "relative_path": "app/houseofcards/internal/agent/engines/llm_invoke.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "import threading",
        "import time",
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, Optional",
        "from ..metrics import (",
        "from ..schemas.skill import (",
        "from ..utils.metrics_helpers import get_or_create_counter, get_or_create_gauge",
        "from .registry import skill"
      ],
      "classes": [
        "CacheEntry",
        "PromptCache",
        "LLMInvokeConfig",
        "LLMInvokeSkill"
      ],
      "functions": [
        "get_prompt_cache",
        "configure_prompt_cache"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/panel_verification_engine.py",
      "relative_path": "app/houseofcards/internal/agent/engines/panel_verification_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Determinism verification and input validation",
        "raw_layer_line": "# Layer: L4 \u2014 Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from .panel_types import ("
      ],
      "classes": [
        "PanelVerificationEngine"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/postgres_query.py",
      "relative_path": "app/houseofcards/internal/agent/engines/postgres_query.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import re",
        "from typing import Any, Dict, List, Optional",
        "from pydantic import BaseModel, Field, field_validator",
        "from .registry import skill"
      ],
      "classes": [
        "PostgresQueryInput",
        "PostgresQueryOutput",
        "PostgresQuerySkill"
      ],
      "functions": [
        "is_read_only_query"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/semantic_validator.py",
      "relative_path": "app/houseofcards/internal/agent/engines/semantic_validator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Semantic validation gate \u2014 enforce semantic authority",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Set, Tuple",
        "from .panel_capability_resolver import (",
        "from .panel_signal_translator import (",
        "from .panel_spec_loader import PanelSpecLoader, get_panel_spec_loader",
        "from .panel_types import SlotSpec",
        "from .semantic_failures import get_fix_action, get_fix_owner",
        "from .semantic_types import ("
      ],
      "classes": [
        "SemanticValidator"
      ],
      "functions": [
        "check_signal_has_translation",
        "check_capability_is_observed",
        "check_api_field_present",
        "check_signal_type",
        "get_semantic_validator",
        "create_semantic_validator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/intent_guardrails.py",
      "relative_path": "app/houseofcards/internal/agent/engines/intent_guardrails.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Phase A Intent Guardrails (design-time validation)",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from typing import Any, Dict, List, Optional, Set",
        "from .semantic_types import ("
      ],
      "classes": [],
      "functions": [
        "_get_int_fix_owner",
        "_get_int_fix_action",
        "_create_violation",
        "check_int_001_signal_provable",
        "check_int_002_capability_cardinality",
        "check_int_003_semantic_duplication",
        "check_int_004_contradictory_intents",
        "check_int_005_missing_evolution_path",
        "check_int_006_unbounded_intent_scope",
        "check_int_007_missing_semantic_contract",
        "check_int_008_invalid_capability_reference",
        "run_intent_guardrails"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/voyage_embed.py",
      "relative_path": "app/houseofcards/internal/agent/engines/voyage_embed.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional, Type",
        "import httpx",
        "from pydantic import BaseModel",
        "from ..schemas.skill import VoyageEmbedInput, VoyageEmbedOutput",
        "from .registry import skill"
      ],
      "classes": [
        "VoyageEmbedConfig",
        "VoyageEmbedSkill"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/registry.py",
      "relative_path": "app/houseofcards/internal/agent/engines/registry.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [],
      "imports": [
        "import logging",
        "from typing import (",
        "from pydantic import BaseModel"
      ],
      "classes": [
        "SkillInterface",
        "SkillEntry"
      ],
      "functions": [
        "skill",
        "register_skill",
        "get_skill",
        "get_skill_entry",
        "create_skill_instance",
        "list_skills",
        "get_skill_manifest",
        "get_skills_by_tag",
        "skill_exists",
        "set_skill_config",
        "get_skill_config",
        "create_skill_with_config"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/job_service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/job_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import uuid",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from decimal import Decimal",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker",
        "from .credit_service import CreditService, get_credit_service"
      ],
      "classes": [
        "JobConfig",
        "JobProgress",
        "JobCredits",
        "Job",
        "JobItem",
        "JobService"
      ],
      "functions": [
        "get_job_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/calendar_write.py",
      "relative_path": "app/houseofcards/internal/agent/engines/calendar_write.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import logging",
        "import time",
        "import uuid",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional",
        "from .registry import register_skill"
      ],
      "classes": [
        "CalendarWriteSkill"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/panel_spec_loader.py",
      "relative_path": "app/houseofcards/internal/agent/engines/panel_spec_loader.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Load and parse L2.1 Panel Adapter YAML spec",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import csv",
        "import logging",
        "from datetime import datetime",
        "from pathlib import Path",
        "from typing import Dict, List, Optional",
        "import yaml",
        "from .panel_types import ("
      ],
      "classes": [
        "PanelSpecLoader"
      ],
      "functions": [
        "get_panel_spec_loader"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/worker_service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/worker_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, Optional",
        "from uuid import UUID",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker",
        "from .credit_service import CreditService, get_credit_service",
        "from .governance_service import GovernanceService, get_governance_service"
      ],
      "classes": [
        "ClaimedItem",
        "WorkerStats",
        "WorkerService"
      ],
      "functions": [
        "get_worker_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/panel_metrics_emitter.py",
      "relative_path": "app/houseofcards/internal/agent/engines/panel_metrics_emitter.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Emit Prometheus metrics for panel evaluation",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import time",
        "from contextlib import contextmanager",
        "from typing import Any, Dict, List, Optional",
        "from .panel_consistency_checker import ConsistencyCheckResult",
        "from .panel_types import Authority, PanelSlotResult, SlotState"
      ],
      "classes": [
        "PanelMetricsEmitter"
      ],
      "functions": [
        "get_panel_metrics_emitter"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/evolution.py",
      "relative_path": "app/houseofcards/internal/agent/engines/evolution.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "SBA agent evolution logic",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional",
        "from uuid import uuid4",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.exc import SQLAlchemyError"
      ],
      "classes": [
        "DriftType",
        "ViolationType",
        "AdjustmentType",
        "BoundaryViolation",
        "DriftSignal",
        "StrategyAdjustment",
        "SBAEvolutionEngine"
      ],
      "functions": [
        "get_evolution_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "SBA service orchestration",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker",
        "from .generator import generate_sba_from_agent",
        "from .schema import SBASchema",
        "from .validator import SBAValidationResult, validate_at_spawn"
      ],
      "classes": [
        "AgentDefinition",
        "SBAService"
      ],
      "functions": [
        "get_sba_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/validator_engine.py",
      "relative_path": "app/houseofcards/internal/agent/engines/validator_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Two-phase semantic validation orchestrator",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Set",
        "from .intent_guardrails import run_intent_guardrails",
        "from .semantic_types import ("
      ],
      "classes": [
        "TwoPhaseValidator"
      ],
      "functions": [
        "validate_intent",
        "validate_panel",
        "validate_full"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/json_transform_v2.py",
      "relative_path": "app/houseofcards/internal/agent/engines/json_transform_v2.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import re",
        "import sys",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional, Union",
        "from app.worker.runtime.core import SkillDescriptor, StructuredOutcome"
      ],
      "classes": [],
      "functions": [
        "_canonical_json",
        "_content_hash",
        "_measure_depth",
        "_parse_jsonpath",
        "_get_at_path",
        "_op_extract",
        "_op_pick",
        "_op_omit",
        "_op_filter",
        "_op_merge",
        "_op_flatten",
        "_op_sort",
        "_op_map",
        "_generate_call_id",
        "json_transform_execute",
        "json_transform_handler",
        "register_json_transform"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/http_call_stub.py",
      "relative_path": "app/houseofcards/internal/agent/engines/http_call_stub.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "import sys",
        "from dataclasses import dataclass, field",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional, Union",
        "from core import SkillDescriptor"
      ],
      "classes": [
        "MockResponse",
        "HttpCallStub"
      ],
      "functions": [
        "http_call_stub_handler",
        "get_http_call_stub",
        "configure_http_call_stub"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/panel_signal_translator.py",
      "relative_path": "app/houseofcards/internal/agent/engines/panel_signal_translator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Translate spec signals to API field names",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Tuple",
        "from typing import Callable as CallableType"
      ],
      "classes": [
        "TranslationOutcome",
        "TranslatedSignal",
        "PanelSignalTranslator"
      ],
      "functions": [
        "_compute_system_state",
        "_compute_attention_required",
        "_compute_has_near_threshold_runs",
        "_compute_guardrails_holding",
        "get_signal_translator"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/skills_base.py",
      "relative_path": "app/houseofcards/internal/agent/engines/skills_base.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from abc import ABC, abstractmethod",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, Optional, Type",
        "from pydantic import BaseModel",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker",
        "from ..metrics import (",
        "from ..traces.idempotency import ("
      ],
      "classes": [
        "SkillCircuitBreaker",
        "IdempotentSkill",
        "ExternalSkill"
      ],
      "functions": [
        "get_circuit_breaker"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/panel_signal_collector.py",
      "relative_path": "app/houseofcards/internal/agent/engines/panel_signal_collector.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Collect raw signals from backend APIs via capability resolution",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, List, Optional, Set",
        "import httpx",
        "from .panel_capability_resolver import (",
        "from .panel_signal_translator import (",
        "from .panel_types import SlotSpec",
        "from .semantic_validator import SemanticValidator, get_semantic_validator",
        "from .semantic_types import SemanticReport"
      ],
      "classes": [
        "CapabilityResolutionTrace",
        "CollectedSignal",
        "CollectedSignals",
        "PanelSignalCollector"
      ],
      "functions": [
        "create_signal_collector"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/message_service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/message_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import re",
        "import select",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID, uuid4",
        "import psycopg2",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker"
      ],
      "classes": [
        "Message",
        "SendResult",
        "MessageService"
      ],
      "functions": [
        "_sanitize_channel_name",
        "get_message_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/llm_service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/llm_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "LLM service adapter for business builder",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "LLMResult",
        "WorkerLLMService"
      ],
      "functions": [
        "get_llm_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/retry_policy.py",
      "relative_path": "app/houseofcards/internal/agent/engines/retry_policy.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional, Tuple, TypeVar"
      ],
      "classes": [
        "RetryStopReason",
        "RetryConfig",
        "RetryState",
        "RetryResult",
        "RetryPolicy"
      ],
      "functions": [
        "_async_sleep",
        "get_default_retry_config",
        "create_retry_policy"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/credit_service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/credit_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from decimal import Decimal",
        "from typing import Any, Dict, Optional",
        "from uuid import UUID",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker"
      ],
      "classes": [
        "CreditBalance",
        "CreditOperation",
        "CreditService"
      ],
      "functions": [
        "get_credit_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/panel_slot_evaluator.py",
      "relative_path": "app/houseofcards/internal/agent/engines/panel_slot_evaluator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Evaluate individual panel slots",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "import logging",
        "from datetime import datetime, timezone",
        "from typing import Any, Callable, Dict, Optional",
        "from .panel_types import ("
      ],
      "classes": [
        "PanelSlotEvaluator"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/panel_dependency_resolver.py",
      "relative_path": "app/houseofcards/internal/agent/engines/panel_dependency_resolver.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Resolve panel dependencies and evaluation order",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "from typing import Dict, List, Optional, Set",
        "from .panel_types import DependencySpec"
      ],
      "classes": [
        "PanelDependencyResolver"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/agent_invoke.py",
      "relative_path": "app/houseofcards/internal/agent/engines/agent_invoke.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Agent-to-agent invocation skill",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "time\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import re",
        "import time",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, Optional",
        "from uuid import UUID, uuid4",
        "from pydantic import BaseModel, Field",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker",
        "from ..services.credit_service import CREDIT_COSTS, CreditService, get_credit_service",
        "from ..services.invoke_audit_service import InvokeAuditService, get_invoke_audit_service",
        "from ..services.message_service import MessageService, get_message_service",
        "from ..services.registry_service import RegistryService, get_registry_service"
      ],
      "classes": [
        "AgentInvokeInput",
        "AgentInvokeOutput",
        "AgentInvokeSkill"
      ],
      "functions": [
        "_sanitize_channel_name"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/email_send.py",
      "relative_path": "app/houseofcards/internal/agent/engines/email_send.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional, Type",
        "import httpx",
        "from pydantic import BaseModel",
        "from ..schemas.skill import EmailSendInput, EmailSendOutput",
        "from .registry import skill"
      ],
      "classes": [
        "EmailSendConfig",
        "EmailSendSkill"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/governance_service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/governance_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker"
      ],
      "classes": [
        "BudgetStatus",
        "RiskMetrics",
        "GovernanceStatus",
        "WorkerBudgetCheck",
        "GovernanceService"
      ],
      "functions": [
        "get_governance_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/blackboard_service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/blackboard_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID",
        "import redis"
      ],
      "classes": [
        "BlackboardEntry",
        "LockResult",
        "BlackboardService"
      ],
      "functions": [
        "get_blackboard_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/metrics.py",
      "relative_path": "app/houseofcards/internal/agent/engines/metrics.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import functools",
        "import logging",
        "import time",
        "from typing import Any, Callable, Optional"
      ],
      "classes": [],
      "functions": [
        "_get_metrics",
        "_get_cost_model",
        "estimate_cost_cents",
        "track_llm_response",
        "track_llm_usage",
        "track_llm_usage_sync",
        "estimate_monthly_cost"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/integrated_runtime.py",
      "relative_path": "app/houseofcards/internal/agent/engines/integrated_runtime.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import sys",
        "import time",
        "import uuid",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Mapping, Optional",
        "from skills.registry_v2 import SkillRegistry, get_global_registry",
        "from .core import ErrorCategory, Runtime, SkillDescriptor, SkillHandler, StructuredOutcome"
      ],
      "classes": [
        "IntegratedRuntime"
      ],
      "functions": [
        "create_integrated_runtime"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/llm_invoke_stub.py",
      "relative_path": "app/houseofcards/internal/agent/engines/llm_invoke_stub.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import sys",
        "from dataclasses import dataclass, field",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional",
        "from core import SkillDescriptor"
      ],
      "classes": [
        "MockLlmResponse",
        "LlmInvokeStub"
      ],
      "functions": [
        "llm_invoke_stub_handler",
        "get_llm_invoke_stub",
        "configure_llm_invoke_stub"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/definitions.py",
      "relative_path": "app/houseofcards/internal/agent/engines/definitions.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Business builder agent definitions",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from typing import Dict, List",
        "from app.agents.sba.schema import ("
      ],
      "classes": [],
      "functions": [
        "create_researcher_agent",
        "create_strategist_agent",
        "create_copywriter_agent",
        "create_ux_agent",
        "create_recovery_agent",
        "create_governor_agent",
        "create_validator_agent",
        "register_all_agents"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/panel_response_assembler.py",
      "relative_path": "app/houseofcards/internal/agent/engines/panel_response_assembler.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Assemble final panel response envelope",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import asdict",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from .panel_consistency_checker import ConsistencyCheckResult",
        "from .panel_types import ("
      ],
      "classes": [
        "PanelResponseAssembler"
      ],
      "functions": [
        "create_response_assembler"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/http_call.py",
      "relative_path": "app/houseofcards/internal/agent/engines/http_call.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "import time",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Type",
        "import httpx",
        "from pydantic import BaseModel",
        "from ..schemas.skill import HttpCallInput, HttpCallOutput",
        "from .registry import skill"
      ],
      "classes": [
        "HttpCallConfig",
        "HttpCallSkill"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/executor.py",
      "relative_path": "app/houseofcards/internal/agent/engines/executor.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Skill execution with validation and evidence capture",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import time",
        "from datetime import datetime, timezone",
        "from typing import TYPE_CHECKING, Any, Dict, Optional, Tuple",
        "from pydantic import ValidationError",
        "from ..observability.cost_tracker import (",
        "from ..schemas.plan import PlanStep, StepStatus",
        "from .registry import get_skill_entry"
      ],
      "classes": [
        "SkillExecutionError",
        "SkillValidationError",
        "BudgetExceededError",
        "SkillExecutor"
      ],
      "functions": [
        "execute_skill"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/slack_send.py",
      "relative_path": "app/houseofcards/internal/agent/engines/slack_send.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional, Type",
        "import httpx",
        "from pydantic import BaseModel",
        "from ..schemas.skill import SlackSendInput, SlackSendOutput",
        "from .registry import skill"
      ],
      "classes": [
        "SlackSendConfig",
        "SlackSendSkill"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/webhook_send.py",
      "relative_path": "app/houseofcards/internal/agent/engines/webhook_send.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import hmac",
        "import json",
        "import logging",
        "import os",
        "import time",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional, Type",
        "import httpx",
        "from pydantic import BaseModel",
        "from ..schemas.skill import WebhookSendInput, WebhookSendOutput",
        "from .registry import skill"
      ],
      "classes": [
        "WebhookSendConfig",
        "WebhookSendSkill"
      ],
      "functions": [
        "sign_payload",
        "verify_signature"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/onboarding_gate.py",
      "relative_path": "app/houseofcards/internal/agent/engines/onboarding_gate.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Middleware to enforce onboarding state requirements per endpoint",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "return JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import re",
        "from typing import Callable, Optional, Tuple",
        "from fastapi import Request, Response",
        "from fastapi.responses import JSONResponse",
        "from starlette.middleware.base import BaseHTTPMiddleware",
        "from starlette.types import ASGIApp",
        "from .onboarding_state import OnboardingState"
      ],
      "classes": [
        "OnboardingGateMiddleware"
      ],
      "functions": [
        "get_required_state",
        "is_founder_authenticated"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/ai_console_panel_engine.py",
      "relative_path": "app/houseofcards/internal/agent/engines/ai_console_panel_engine.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Main orchestration engine for panel evaluation",
        "raw_layer_line": "# Layer: L4 \u2014 Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import time",
        "from typing import Any, Dict, List, Optional",
        "from .panel_consistency_checker import PanelConsistencyChecker, create_consistency_checker",
        "from .panel_dependency_resolver import PanelDependencyResolver",
        "from .panel_metrics_emitter import PanelMetricsEmitter, get_panel_metrics_emitter",
        "from .panel_response_assembler import PanelResponseAssembler, create_response_assembler",
        "from .panel_signal_collector import PanelSignalCollector, create_signal_collector",
        "from .panel_slot_evaluator import PanelSlotEvaluator",
        "from .panel_spec_loader import PanelSpecLoader, get_panel_spec_loader",
        "from .panel_types import PanelSlotResult, SlotState, VerificationSignals",
        "from .panel_verification_engine import PanelVerificationEngine"
      ],
      "classes": [
        "AIConsolePanelEngine"
      ],
      "functions": [
        "create_panel_engine",
        "get_panel_engine"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/http_call_v2.py",
      "relative_path": "app/houseofcards/internal/agent/engines/http_call_v2.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import sys",
        "import time",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from pathlib import Path",
        "from typing import Any, Dict, Optional, Tuple",
        "from app.worker.runtime.core import SkillDescriptor, StructuredOutcome"
      ],
      "classes": [
        "ErrorCategory",
        "ErrorMapping",
        "RetryConfig",
        "MockResponse"
      ],
      "functions": [
        "compute_retry_delay",
        "_canonical_json",
        "_content_hash",
        "_generate_call_id",
        "validate_idempotency",
        "validate_url",
        "map_http_error",
        "map_network_error",
        "set_mock_response",
        "clear_mock_responses",
        "_make_request",
        "http_call_execute",
        "http_call_handler",
        "register_http_call"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/engines/invoke_audit_service.py",
      "relative_path": "app/houseofcards/internal/agent/engines/invoke_audit_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy\\.orm import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from decimal import Decimal",
        "from typing import Any, Dict, List, Optional",
        "from uuid import UUID, uuid4",
        "from sqlalchemy import create_engine, text",
        "from sqlalchemy.orm import sessionmaker"
      ],
      "classes": [
        "InvokeAuditEntry",
        "InvokeAuditService"
      ],
      "functions": [
        "get_invoke_audit_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/schemas/semantic_failures.py",
      "relative_path": "app/houseofcards/internal/agent/schemas/semantic_failures.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L2",
        "audience": null,
        "role": "Semantic failure taxonomy and fix guidance",
        "raw_layer_line": "# Layer: L2.1 \u2014 Panel Adapter Layer"
      },
      "signals": [],
      "imports": [
        "from typing import Any, Dict, Union",
        "from .semantic_types import ("
      ],
      "classes": [],
      "functions": [
        "get_failure_info",
        "get_fix_owner",
        "get_fix_action",
        "get_violation_class",
        "format_violation_message"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/agent/schemas/schema.py",
      "relative_path": "app/houseofcards/internal/agent/schemas/schema.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "SBA schema definitions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional, Set",
        "from pydantic import BaseModel, Field, field_validator, model_validator"
      ],
      "classes": [
        "GovernanceProvider",
        "DependencyType",
        "Dependency",
        "EnvironmentRequirements",
        "HowToWin",
        "CapabilitiesCapacity",
        "EnablingManagementSystems",
        "WinningAspiration",
        "WhereToPlay",
        "SBASchema",
        "SBAVersionError"
      ],
      "functions": [
        "create_minimal_sba",
        "check_version_supported",
        "check_version_deprecated",
        "negotiate_version",
        "get_version_info",
        "create_tool_dependency",
        "create_agent_dependency",
        "create_api_dependency"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/activity/engines/run_orchestration_kernel.py",
      "relative_path": "app/houseofcards/internal/activity/engines/run_orchestration_kernel.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Run Orchestration Kernel - Single authority for run lifecycle",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Optional",
        "from uuid import UUID",
        "from app.worker.orchestration.phases import ("
      ],
      "classes": [
        "GovernanceCheckError",
        "RunOrchestrationKernel"
      ],
      "functions": [
        "create_rok"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/account/drivers/lifecycle_provider.py",
      "relative_path": "app/houseofcards/internal/account/drivers/lifecycle_provider.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Phase-9 Tenant Lifecycle Provider",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Protocol, Optional, Dict, List, Callable",
        "from enum import Enum",
        "import logging",
        "from app.auth.tenant_lifecycle import ("
      ],
      "classes": [
        "ActorType",
        "ActorContext",
        "TransitionResult",
        "LifecycleTransitionRecord",
        "TenantLifecycleProvider",
        "MockTenantLifecycleProvider"
      ],
      "functions": [
        "get_lifecycle_provider",
        "set_lifecycle_provider"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/account/drivers/tenant_auth.py",
      "relative_path": "app/houseofcards/internal/account/drivers/tenant_auth.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Tenant authentication and isolation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import logging",
        "import os",
        "from typing import TYPE_CHECKING, Optional, Tuple",
        "from fastapi import Depends, Header, HTTPException, Request, status",
        "from sqlmodel import Session, select"
      ],
      "classes": [
        "TenantContext",
        "ConsoleRole"
      ],
      "functions": [
        "get_db_session",
        "hash_api_key",
        "validate_api_key_db",
        "get_tenant_context",
        "require_permission",
        "require_worker_access",
        "verify_api_key_with_fallback",
        "is_operator_user",
        "require_customer_role",
        "require_operator_role"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/account/engines/lifecycle_gate.py",
      "relative_path": "app/houseofcards/internal/account/engines/lifecycle_gate.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Lifecycle enforcement gate",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from typing import Optional, Set",
        "from fastapi import Request, HTTPException",
        "import logging",
        "from app.auth.tenant_lifecycle import TenantLifecycleState",
        "from app.auth.lifecycle_provider import get_lifecycle_provider"
      ],
      "classes": [
        "LifecycleContext",
        "LifecycleGate"
      ],
      "functions": [
        "is_exempt_path",
        "is_sdk_path",
        "check_lifecycle",
        "require_active_lifecycle",
        "require_sdk_execution",
        "require_writes_allowed"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/account/engines/tenant_roles.py",
      "relative_path": "app/houseofcards/internal/account/engines/tenant_roles.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-5 Tenant Role enum and permission derivation",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from enum import IntEnum",
        "from typing import FrozenSet"
      ],
      "classes": [
        "TenantRole"
      ],
      "functions": [
        "get_permissions_for_role",
        "role_has_permission",
        "role_subsumes"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/account/engines/onboarding_state.py",
      "relative_path": "app/houseofcards/internal/account/engines/onboarding_state.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Onboarding state enum and constants",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from enum import IntEnum"
      ],
      "classes": [
        "OnboardingState"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/account/engines/tenant_resolver.py",
      "relative_path": "app/houseofcards/internal/account/engines/tenant_resolver.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "SHARED",
        "role": "Single authority for tenant resolution - ends ambiguity",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from uuid import UUID",
        "from fastapi import HTTPException, Request"
      ],
      "classes": [],
      "functions": [
        "resolve_tenant_id",
        "resolve_tenant_id_optional"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/account/engines/cli.py",
      "relative_path": "app/houseofcards/internal/account/engines/cli.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": "CUSTOMER",
        "role": "Business builder CLI",
        "raw_layer_line": "# Layer: L4 \u2014 Engine"
      },
      "signals": [
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "time\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import json",
        "import time",
        "from pathlib import Path",
        "from typing import Optional",
        "import click",
        "from .schemas.brand import BrandSchema, ToneLevel, create_minimal_brand",
        "from .worker import BusinessBuilderWorker, WorkerResult, replay"
      ],
      "classes": [],
      "functions": [
        "_get_api_client",
        "_run_via_api",
        "_replay_via_api",
        "_inspect_via_api",
        "_list_runs_via_api",
        "cli",
        "build_business",
        "_print_api_result",
        "_print_result",
        "replay_cmd",
        "trace_cmd",
        "inspect_cmd",
        "list_runs_cmd",
        "create_brand_cmd"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/account/engines/tenant_lifecycle.py",
      "relative_path": "app/houseofcards/internal/account/engines/tenant_lifecycle.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Phase-9 Tenant Lifecycle States",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from enum import IntEnum",
        "from typing import Set, Tuple"
      ],
      "classes": [
        "TenantLifecycleState",
        "LifecycleAction"
      ],
      "functions": [
        "is_valid_transition",
        "get_valid_transitions",
        "get_action_for_transition"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/analytics/drivers/checkpoint_offload.py",
      "relative_path": "app/houseofcards/internal/analytics/drivers/checkpoint_offload.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Checkpoint offload to object storage",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import gzip",
        "import hashlib",
        "import io",
        "import json",
        "import logging",
        "import os",
        "import random",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Any, Dict, Optional, Tuple"
      ],
      "classes": [],
      "functions": [
        "_retry_with_backoff",
        "_compute_sha256",
        "_verify_upload_integrity",
        "_get_r2_client",
        "_get_r2_bucket",
        "offload_old_checkpoints",
        "restore_checkpoint_from_r2",
        "get_offload_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/analytics/drivers/db_helpers.py",
      "relative_path": "app/houseofcards/internal/analytics/drivers/db_helpers.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "SQLModel query helpers to prevent Row tuple extraction bugs",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, List, Optional, TypeVar",
        "from sqlmodel import Session"
      ],
      "classes": [],
      "functions": [
        "query_one",
        "query_all",
        "query_scalar",
        "query_exists"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/analytics/drivers/danger_fences.py",
      "relative_path": "app/houseofcards/internal/analytics/drivers/danger_fences.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Danger Fences - Encapsulated patterns for known-dangerous operations",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from typing import Any, Dict, Optional, Tuple",
        "from sqlalchemy import text",
        "from sqlmodel import Session"
      ],
      "classes": [
        "RecoveryEnqueueError"
      ],
      "functions": [
        "enqueue_recovery_candidate_safely",
        "get_danger_fence_documentation"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/analytics/drivers/feature_intent_examples.py",
      "relative_path": "app/houseofcards/internal/analytics/drivers/feature_intent_examples.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Golden examples for feature intent patterns",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from typing import Any, Dict, Optional",
        "from app.infra.feature_intent import (",
        "from app.infra.transaction import ("
      ],
      "classes": [
        "PureQueryExample",
        "AtomicWriteExample",
        "LockedMutationExample",
        "ExternalSideEffectExample",
        "RecoverableOperationExample"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/analytics/drivers/transaction_examples.py",
      "relative_path": "app/houseofcards/internal/analytics/drivers/transaction_examples.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Golden examples for self-defending transaction patterns",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from typing import Optional, Type, TypeVar",
        "from app.infra.transaction import ("
      ],
      "classes": [],
      "functions": [
        "get_entity_by_id",
        "create_entity",
        "trip_circuit_breaker",
        "reset_circuit_breaker",
        "example_caller_pattern"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/analytics/engines/console_auth.py",
      "relative_path": "app/houseofcards/internal/analytics/engines/console_auth.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Console authentication compatibility shim",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from typing import Optional",
        "from fastapi import Depends, HTTPException, Request, status",
        "from pydantic import BaseModel",
        "from .contexts import FounderAuthContext",
        "from .gateway_middleware import get_auth_context"
      ],
      "classes": [
        "CustomerToken",
        "FounderToken"
      ],
      "functions": [
        "verify_fops_token",
        "verify_console_token"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/analytics/engines/simulate.py",
      "relative_path": "app/houseofcards/internal/analytics/engines/simulate.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Pre-execution cost simulation (M5)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Dict, List, Optional"
      ],
      "classes": [
        "FeasibilityStatus",
        "StepRisk",
        "SimulationResult",
        "CostSimulator"
      ],
      "functions": [
        "simulate_plan"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/analytics/engines/runner.py",
      "relative_path": "app/houseofcards/internal/analytics/engines/runner.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Run execution (sync entrypoint wrapping async internal execution)",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "import json",
        "import logging",
        "import os",
        "import time",
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from typing import Optional",
        "from uuid import UUID",
        "from sqlmodel import Session",
        "from app.infra import FeatureIntent, RetryPolicy",
        "from ..db import Agent, Memory, Provenance, Run, engine",
        "from ..events import get_publisher",
        "from ..models.logs_records import ExecutionStatus, LLMRunRecord, RecordSource",
        "from ..metrics import (",
        "from ..services.incidents.facade import get_incident_facade",
        "from ..services.governance.run_governance_facade import get_run_governance_facade",
        "from ..services.governance.transaction_coordinator import (",
        "from ..skills import get_skill_config",
        "from ..skills.executor import (",
        "from ..traces.pg_store import PostgresTraceStore",
        "from ..utils.budget_tracker import deduct_budget",
        "from ..worker.enforcement.enforcement_guard import (",
        "from ..worker.enforcement.step_enforcement import (",
        "from ..core.execution_context import ExecutionCursor, ExecutionPhase, EvidenceSource",
        "from ..evidence.capture import capture_integrity_evidence"
      ],
      "classes": [
        "BudgetContext",
        "RunRunner"
      ],
      "functions": [
        "_load_budget_context",
        "calculate_llm_cost_cents"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/analytics/engines/authority.py",
      "relative_path": "app/houseofcards/internal/analytics/engines/authority.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "RBAC v2 authority enforcement for capabilities",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from fastapi import HTTPException, Request",
        "from .actor import ActorContext, ActorType, IdentitySource",
        "from .authorization import authorize, get_authorization_engine",
        "from .contexts import GatewayContext, HumanAuthContext, MachineCapabilityContext",
        "from .gateway_middleware import get_auth_context"
      ],
      "classes": [
        "AuthorityResult"
      ],
      "functions": [
        "gateway_context_to_actor",
        "_check_authority",
        "_require_authority",
        "require_replay_read",
        "require_replay_execute",
        "require_replay_audit",
        "require_replay_admin",
        "require_predictions_read",
        "require_predictions_execute",
        "require_predictions_audit",
        "require_predictions_admin",
        "verify_tenant_access",
        "emit_authority_audit"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/api_keys/engines/api_key_service.py",
      "relative_path": "app/houseofcards/internal/api_keys/engines/api_key_service.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "API key validation service for machine authentication",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "import logging",
        "from datetime import datetime",
        "from typing import Optional"
      ],
      "classes": [
        "ApiKeyService"
      ],
      "functions": [
        "get_api_key_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/api_keys/engines/onboarding_transitions.py",
      "relative_path": "app/houseofcards/internal/api_keys/engines/onboarding_transitions.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Central service for onboarding state transitions",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass",
        "from datetime import datetime, timedelta, timezone",
        "from enum import Enum",
        "from typing import Optional",
        "from .onboarding_state import OnboardingState"
      ],
      "classes": [
        "TransitionTrigger",
        "TransitionResult",
        "OnboardingTransitionService",
        "StalledTenant"
      ],
      "functions": [
        "detect_stalled_onboarding",
        "emit_stalled_onboarding_signals",
        "get_onboarding_service"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/step_enforcement.py",
      "relative_path": "app/houseofcards/internal/general/drivers/step_enforcement.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Guarantee enforcement happens within same step",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Optional, Any, Dict",
        "from datetime import datetime, timezone",
        "import logging"
      ],
      "classes": [
        "EnforcementHaltReason",
        "EnforcementResult",
        "StepEnforcementError"
      ],
      "functions": [
        "enforce_before_step_completion",
        "_build_eval_context"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/contexts.py",
      "relative_path": "app/houseofcards/internal/general/drivers/contexts.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Gateway authentication context models for human and machine flows",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import FrozenSet, Optional"
      ],
      "classes": [
        "AuthSource",
        "AuthPlane",
        "HumanAuthContext",
        "MachineCapabilityContext",
        "FounderAuthContext"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/artifact.py",
      "relative_path": "app/houseofcards/internal/general/drivers/artifact.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Artifact storage (R2/S3)",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(BaseModel\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Field\\(",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "from abc import ABC, abstractmethod",
        "from datetime import datetime, timezone",
        "from pathlib import Path",
        "from typing import Any, BinaryIO, Dict, List, Optional, Union",
        "from urllib.parse import urlparse",
        "from pydantic import BaseModel, Field",
        "from ..schemas.artifact import ArtifactType, StorageBackend"
      ],
      "classes": [
        "StoredArtifact",
        "ArtifactStore",
        "LocalArtifactStore",
        "S3ArtifactStore"
      ],
      "functions": [
        "get_artifact_store"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/gateway_types.py",
      "relative_path": "app/houseofcards/internal/general/drivers/gateway_types.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Gateway authentication result types and error definitions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Optional, Union",
        "from .contexts import GatewayContext, HumanAuthContext, MachineCapabilityContext"
      ],
      "classes": [
        "GatewayErrorCode",
        "GatewayAuthError"
      ],
      "functions": [
        "error_missing_auth",
        "error_mixed_auth",
        "error_jwt_expired",
        "error_jwt_invalid",
        "error_session_revoked",
        "error_api_key_invalid",
        "error_api_key_revoked",
        "error_rate_limited",
        "error_plane_mismatch",
        "error_worker_jwt_forbidden",
        "error_provider_unavailable",
        "error_internal",
        "is_success",
        "is_error",
        "unwrap_context",
        "unwrap_error"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/invocation_safety.py",
      "relative_path": "app/houseofcards/internal/general/drivers/invocation_safety.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Invocation Safety Layer for CAP-020 (CLI) and CAP-021 (SDK)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "import logging",
        "import time",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Callable, Optional"
      ],
      "classes": [
        "SafetyFlag",
        "Severity",
        "SafetyCheckResult",
        "InvocationSafetyContext",
        "InvocationSafetyResult",
        "CLISafetyHook",
        "SDKSafetyHook",
        "SafetyCheckTimer"
      ],
      "functions": [
        "check_identity_resolved",
        "check_impersonation_declared",
        "check_impersonation_reason",
        "check_agent_ownership",
        "check_run_ownership",
        "check_tenant_scoping",
        "check_budget_validation",
        "compute_plan_hash",
        "check_plan_immutability",
        "check_plan_injection",
        "check_trace_hash_completeness",
        "check_idempotency_key",
        "check_rate_limit",
        "run_safety_checks",
        "emit_safety_metrics",
        "emit_safety_audit_event"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/session_store.py",
      "relative_path": "app/houseofcards/internal/general/drivers/session_store.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Redis-backed session revocation store",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "from typing import TYPE_CHECKING, Optional"
      ],
      "classes": [
        "SessionStore"
      ],
      "functions": [
        "get_session_store"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/idempotency.py",
      "relative_path": "app/houseofcards/internal/general/drivers/idempotency.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Idempotency guarantees for job execution",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "delete\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import hashlib",
        "import json",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import timedelta",
        "from typing import Any, Dict, Optional, Tuple"
      ],
      "classes": [
        "IdempotencyKey",
        "JobAlreadyProcessingException",
        "IdempotencyStore"
      ],
      "functions": [
        "get_idempotency_store",
        "configure_idempotency_store"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/vault_client.py",
      "relative_path": "app/houseofcards/internal/general/drivers/vault_client.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "HashiCorp Vault client for secret retrieval",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import logging",
        "import os",
        "from typing import Dict, Optional",
        "import httpx"
      ],
      "classes": [
        "VaultClient"
      ],
      "functions": [
        "load_secrets_to_env",
        "get_vault_client"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/m7_to_m28.py",
      "relative_path": "app/houseofcards/internal/general/drivers/m7_to_m28.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "M7 to M28 authority mapping (single source of truth)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Dict, FrozenSet, Optional, Tuple"
      ],
      "classes": [
        "MappingStatus",
        "MappingResult",
        "MappingError",
        "M7ToM28Mapping"
      ],
      "functions": [
        "get_m28_equivalent",
        "is_mapping_ambiguous",
        "get_all_mappings",
        "validate_mapping_completeness",
        "_test_valid_mappings",
        "_test_unmapped_returns_error",
        "_test_ambiguous_returns_error"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/health.py",
      "relative_path": "app/houseofcards/internal/general/drivers/health.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Store health checks",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "import os",
        "import time",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Dict, Tuple"
      ],
      "classes": [
        "HealthStatus",
        "ComponentHealth",
        "OverallHealth"
      ],
      "functions": [
        "check_database_health",
        "check_redis_health",
        "check_r2_health",
        "check_health",
        "readiness_probe",
        "liveness_probe",
        "_update_health_metrics"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/execution_envelope.py",
      "relative_path": "app/houseofcards/internal/general/drivers/execution_envelope.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Execution envelope generation for implicit authority hardening",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import json",
        "import logging",
        "import uuid",
        "from contextlib import contextmanager",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Generator, Optional"
      ],
      "classes": [
        "CapabilityId",
        "ExecutionVector",
        "CallerType",
        "CallerIdentity",
        "TenantContext",
        "InvocationTracking",
        "PlanIntegrity",
        "ConfidenceContext",
        "Attribution",
        "EvidenceMetadata",
        "InvocationSafetyFlags",
        "ExecutionEnvelope",
        "ExecutionEnvelopeFactory",
        "EvidenceSink",
        "InMemoryEvidenceSink"
      ],
      "functions": [
        "compute_plan_hash",
        "detect_plan_mutation",
        "get_evidence_sink",
        "set_evidence_sink",
        "emit_envelope",
        "tracked_execution",
        "get_invocation_id_for_tagging"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/redis_publisher.py",
      "relative_path": "app/houseofcards/internal/general/drivers/redis_publisher.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Redis pub/sub event adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional",
        "from .publisher import BasePublisher"
      ],
      "classes": [
        "RedisPublisher"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/actor.py",
      "relative_path": "app/houseofcards/internal/general/drivers/actor.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Canonical actor model for all authorization decisions",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import FrozenSet, Optional"
      ],
      "classes": [
        "ActorType",
        "IdentitySource",
        "ActorContext"
      ],
      "functions": [
        "get_system_actor",
        "create_operator_actor",
        "create_external_actor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/subscribers.py",
      "relative_path": "app/houseofcards/internal/general/drivers/subscribers.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Backend event subscribers for cross-domain reactions",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "time\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import threading",
        "import time",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional"
      ],
      "classes": [
        "ReactorState",
        "EventEnvelope",
        "HandlerRegistration",
        "EventReactorStats",
        "EventReactor"
      ],
      "functions": [
        "get_event_reactor",
        "reset_event_reactor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/metrics.py",
      "relative_path": "app/houseofcards/internal/general/drivers/metrics.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Prometheus metrics definitions and multiprocess support",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import os",
        "from prometheus_client import ("
      ],
      "classes": [],
      "functions": [
        "get_registry",
        "generate_metrics",
        "get_content_type"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/enforcement_guard.py",
      "relative_path": "app/houseofcards/internal/general/drivers/enforcement_guard.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Guarantee enforcement check is never skipped",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from contextlib import contextmanager",
        "from dataclasses import dataclass",
        "from typing import Optional, Any",
        "from datetime import datetime, timezone",
        "import logging"
      ],
      "classes": [
        "EnforcementSkippedError",
        "EnforcementCheckpoint",
        "_EnforcementGuardImpl"
      ],
      "functions": [
        "enforcement_guard",
        "require_enforcement"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/db_async.py",
      "relative_path": "app/houseofcards/internal/general/drivers/db_async.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Async SQLAlchemy session factory for non-blocking DB operations",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from contextlib import asynccontextmanager",
        "from typing import AsyncGenerator",
        "from sqlalchemy.ext.asyncio import ("
      ],
      "classes": [],
      "functions": [
        "get_async_database_url",
        "get_async_session",
        "async_session_context",
        "init_async_db",
        "close_async_db"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/drivers/hallucination_hook.py",
      "relative_path": "app/houseofcards/internal/general/drivers/hallucination_hook.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": "INTERNAL",
        "role": "Wire HallucinationDetector to runner output annotation",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, Optional",
        "from app.services.hallucination.hallucination_detector import (",
        "from app.core.execution_context import ExecutionContext"
      ],
      "classes": [
        "HallucinationAnnotation",
        "HallucinationHook"
      ],
      "functions": [
        "get_hallucination_hook",
        "configure_hallucination_hook",
        "reset_hallucination_hook"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/facades/identity_adapter.py",
      "relative_path": "app/houseofcards/internal/general/facades/identity_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Extract identity from requests, produce ActorContext",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "from abc import ABC, abstractmethod",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import Request",
        "from app.auth.actor import ("
      ],
      "classes": [
        "AuthenticationError",
        "IdentityAdapter",
        "ClerkAdapter",
        "SystemIdentityAdapter",
        "DevIdentityAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/skill_http.py",
      "relative_path": "app/houseofcards/internal/general/engines/skill_http.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "HTTP skill execution adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def run_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import asyncio",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict",
        "import httpx"
      ],
      "classes": [],
      "functions": [
        "run_http_skill"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/authorization_choke.py",
      "relative_path": "app/houseofcards/internal/general/engines/authorization_choke.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Authorization choke point (single entry for all authz decisions)",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "import time",
        "import traceback",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Optional",
        "from app.auth.actor import ActorContext",
        "from app.auth.authorization import (",
        "from app.auth.authorization_metrics import (",
        "from app.auth.mappings import MappingResult, get_m28_equivalent"
      ],
      "classes": [
        "AuthzPhase",
        "AuthorizationSource",
        "AuthorizationDecision"
      ],
      "functions": [
        "get_authz_phase",
        "is_strict_mode",
        "is_tripwire_mode",
        "authorize_action",
        "_emit_fallback_telemetry",
        "can_access",
        "require_permission",
        "get_fallback_stats",
        "check_permission_request",
        "_create_test_actor",
        "_test_m28_native_direct",
        "_test_m7_legacy_mapped",
        "_test_unknown_resource_denied"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/route_planes.py",
      "relative_path": "app/houseofcards/internal/general/engines/route_planes.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Route authentication plane declarations and enforcement",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "return JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import re",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Optional",
        "from .contexts import AuthPlane"
      ],
      "classes": [
        "PlaneRequirement",
        "RoutePlaneRule"
      ],
      "functions": [
        "get_plane_requirement",
        "check_plane_match",
        "is_worker_path",
        "is_admin_path",
        "enforce_plane_requirement"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/memory_update.py",
      "relative_path": "app/houseofcards/internal/general/engines/memory_update.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Memory update background task",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [],
      "imports": [
        "import asyncio",
        "import logging",
        "import threading",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from prometheus_client import Counter, Histogram"
      ],
      "classes": [],
      "functions": [
        "_load_rules",
        "_extract_value",
        "_write_memory_audit",
        "upsert_memory_pin",
        "apply_update_rules",
        "apply_update_rules_sync"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/core.py",
      "relative_path": "app/houseofcards/internal/general/engines/core.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L6",
        "audience": "CUSTOMER",
        "role": "Core runtime execution (StructuredOutcome, never throws)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import asyncio",
        "import hashlib",
        "import json",
        "import logging",
        "import time",
        "import uuid",
        "from dataclasses import asdict, dataclass, field",
        "from enum import Enum",
        "from typing import Any, Callable, Coroutine, Dict, List, Mapping, Optional, Union"
      ],
      "classes": [
        "ErrorCategory",
        "StructuredOutcome",
        "SkillDescriptor",
        "ResourceContract",
        "Runtime"
      ],
      "functions": [
        "_canonical_json",
        "_content_hash"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/authorization_metrics.py",
      "relative_path": "app/houseofcards/internal/general/engines/authorization_metrics.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Prometheus metrics for authorization system",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging"
      ],
      "classes": [],
      "functions": [
        "record_m7_fallback",
        "record_tripwire_hit",
        "record_decision",
        "update_phase_info",
        "update_strict_mode",
        "get_dashboard_queries",
        "get_alert_rules"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/gateway_config.py",
      "relative_path": "app/houseofcards/internal/general/engines/gateway_config.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Gateway configuration and initialization",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "from typing import TYPE_CHECKING"
      ],
      "classes": [],
      "functions": [
        "configure_auth_gateway",
        "get_gateway_middleware_config",
        "setup_auth_middleware"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/rbac_rules_loader.py",
      "relative_path": "app/houseofcards/internal/general/engines/rbac_rules_loader.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Load RBAC rules from canonical YAML schema",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines (Authorization)"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from functools import lru_cache",
        "from pathlib import Path",
        "from typing import Optional",
        "import yaml"
      ],
      "classes": [
        "RBACSchemaViolation",
        "AccessTier",
        "ConsoleKind",
        "Environment",
        "AggregationLevel",
        "QueryAuthority",
        "RBACRule"
      ],
      "functions": [
        "load_rbac_rules",
        "reload_rbac_rules",
        "resolve_rbac_rule",
        "is_path_public",
        "get_public_paths",
        "get_temporary_rules",
        "validate_rbac_rules"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/auth.py",
      "relative_path": "app/houseofcards/internal/general/engines/auth.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "API key verification dependency for FastAPI routes",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import os",
        "from fastapi import Header, HTTPException, status"
      ],
      "classes": [],
      "functions": [
        "verify_api_key"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/gateway.py",
      "relative_path": "app/houseofcards/internal/general/engines/gateway.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Central authentication gateway - single entry point for all auth",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Service\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import hashlib",
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime",
        "from typing import Optional, Set",
        "from .contexts import (",
        "from .gateway_metrics import (",
        "from .gateway_types import ("
      ],
      "classes": [
        "TokenInfo",
        "TokenClassifier",
        "AuthGateway",
        "SessionStore",
        "ApiKeyService"
      ],
      "functions": [
        "get_auth_gateway",
        "configure_auth_gateway"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/authorization.py",
      "relative_path": "app/houseofcards/internal/general/engines/authorization.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Single source of truth for all authorization decisions",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Engine\\b",
          "layer": "L4_ENGINE",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from typing import Dict, Optional, Set",
        "from app.auth.actor import ActorContext, ActorType"
      ],
      "classes": [
        "Decision",
        "AuthorizationResult",
        "AuthorizationEngine"
      ],
      "functions": [
        "get_authorization_engine",
        "authorize"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/invocation_context.py",
      "relative_path": "app/houseofcards/internal/general/engines/invocation_context.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Invocation context for cross-referencing side-effects",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [],
      "imports": [
        "from __future__ import annotations",
        "import contextvars",
        "import logging",
        "from contextlib import contextmanager",
        "from typing import TYPE_CHECKING, Any, Generator, Optional"
      ],
      "classes": [
        "InvocationLogFilter"
      ],
      "functions": [
        "get_current_invocation_id",
        "get_current_envelope",
        "get_current_tenant_id",
        "get_current_capability_id",
        "set_current_invocation",
        "reset_current_invocation",
        "set_current_envelope",
        "reset_current_envelope",
        "invocation_context",
        "tag_with_invocation",
        "get_invocation_metadata",
        "with_invocation_tracking"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/gateway_metrics.py",
      "relative_path": "app/houseofcards/internal/general/engines/gateway_metrics.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Prometheus metrics for auth gateway token verification",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [],
      "imports": [
        "from __future__ import annotations",
        "import logging"
      ],
      "classes": [],
      "functions": [
        "record_token_verified",
        "record_token_rejected"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/role_guard.py",
      "relative_path": "app/houseofcards/internal/general/engines/role_guard.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Phase-5 Role Guard Dependency for endpoint authorization",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.one\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.first\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from typing import Callable, Optional",
        "from fastapi import Depends, HTTPException, Request, status",
        "from sqlmodel import Session, select",
        "from .gateway_middleware import get_auth_context",
        "from .onboarding_state import OnboardingState",
        "from .tenant_roles import TenantRole, get_permissions_for_role, role_has_permission"
      ],
      "classes": [
        "OwnerInvariantViolation",
        "RoleViolationError"
      ],
      "functions": [
        "get_user_role_in_tenant",
        "get_tenant_onboarding_state",
        "count_owners_in_tenant",
        "validate_owner_invariant",
        "require_role",
        "require_permission"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/contracts.py",
      "relative_path": "app/houseofcards/internal/general/engines/contracts.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List"
      ],
      "classes": [
        "ContractMetadata",
        "SkillContract",
        "FailureMode",
        "CostModel",
        "BudgetTracker"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/invariants.py",
      "relative_path": "app/houseofcards/internal/general/engines/invariants.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Invariant guards for auth gateway enforcement",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from typing import Optional",
        "from .contexts import AuthPlane, GatewayContext, HumanAuthContext, MachineCapabilityContext",
        "from .gateway_types import ("
      ],
      "classes": [
        "AuthInvariantViolation"
      ],
      "functions": [
        "assert_no_mixed_auth",
        "assert_plane_match",
        "assert_no_worker_jwt",
        "assert_admin_no_api_key",
        "check_all_invariants",
        "get_headers_to_strip",
        "strip_auth_headers"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/retrieval_hook.py",
      "relative_path": "app/houseofcards/internal/general/engines/retrieval_hook.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": "INTERNAL",
        "role": "Wire RetrievalMediator as MANDATORY in LLM path",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional",
        "from app.services.mediation.retrieval_mediator import (",
        "from app.core.execution_context import ExecutionContext"
      ],
      "classes": [
        "RetrievalRequest",
        "RetrievalResponse",
        "RetrievalHook"
      ],
      "functions": [
        "get_retrieval_hook",
        "configure_retrieval_hook",
        "reset_retrieval_hook"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/identity_chain.py",
      "relative_path": "app/houseofcards/internal/general/engines/identity_chain.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "Unified identity extraction via adapter chain",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "from typing import List, Optional",
        "from fastapi import Request",
        "from app.auth.actor import ActorContext",
        "from app.auth.authorization import get_authorization_engine",
        "from app.auth.identity_adapter import ("
      ],
      "classes": [
        "IdentityChain"
      ],
      "functions": [
        "create_identity_chain",
        "get_identity_chain",
        "reset_identity_chain",
        "get_current_actor",
        "get_current_actor_optional"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/general/engines/tier_gating.py",
      "relative_path": "app/houseofcards/internal/general/engines/tier_gating.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Tier-based feature gating engine",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@router\\.(get|post|put|delete|patch)",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from enum import Enum",
        "from functools import wraps",
        "from typing import Callable, Optional",
        "from fastapi import Depends, HTTPException, Request, status",
        "from ..utils.metrics_helpers import get_or_create_counter"
      ],
      "classes": [
        "TenantTier",
        "PricingPhase",
        "TierAccessResult"
      ],
      "functions": [
        "resolve_tier",
        "check_tier_access",
        "requires_tier",
        "requires_feature",
        "tier_gated",
        "get_tier_features",
        "get_tier_info",
        "get_upgrade_path"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/drivers/correlation.py",
      "relative_path": "app/houseofcards/internal/logs/drivers/correlation.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Correlation ID generation and context propagation",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import uuid",
        "from contextlib import contextmanager",
        "from contextvars import ContextVar",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Generator, Optional"
      ],
      "classes": [
        "CorrelationContext"
      ],
      "functions": [
        "generate_correlation_id",
        "get_current_correlation_id",
        "get_current_span_id",
        "correlation_scope",
        "child_span",
        "with_correlation",
        "inject_correlation",
        "clear_correlation"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/drivers/pool.py",
      "relative_path": "app/houseofcards/internal/logs/drivers/pool.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Worker pool dispatch (polls DB, dispatches to RunRunner via ROK)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "time\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import signal",
        "import sys",
        "import threading",
        "import time",
        "from concurrent.futures import ThreadPoolExecutor",
        "from datetime import datetime, timezone",
        "from typing import Any, List, Optional, cast",
        "from sqlmodel import Session, select",
        "from app.infra import FeatureIntent, RetryPolicy",
        "from ..db import Run, engine",
        "from ..events import get_publisher",
        "from ..metrics import nova_worker_pool_size",
        "from ..models.logs_records import (",
        "from .runner import RunRunner"
      ],
      "classes": [
        "WorkerPool"
      ],
      "functions": [
        "_create_worker_system_record",
        "_signal_handler",
        "main"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/drivers/audit_handlers.py",
      "relative_path": "app/houseofcards/internal/logs/drivers/audit_handlers.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "Event handlers for audit-related events",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict"
      ],
      "classes": [
        "AuditAlertType",
        "AlertSeverity",
        "AuditAlert"
      ],
      "functions": [
        "register_audit_handlers",
        "handle_missing_ack",
        "handle_drift",
        "handle_stale_run",
        "handle_reconciliation_failed",
        "handle_expectation_timeout",
        "handle_run_failed",
        "handle_run_completed",
        "_emit_alert",
        "_attempt_mark_run_failed",
        "_schedule_reconciliation_check"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/drivers/evidence_sink.py",
      "relative_path": "app/houseofcards/internal/logs/drivers/evidence_sink.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Database evidence sink for execution envelopes",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.scalars\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "\\.all\\(\\)",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "select\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from datetime import datetime",
        "from typing import Any, Optional",
        "from sqlalchemy import select",
        "from app.auth.execution_envelope import (",
        "from app.models.execution_envelope import ExecutionEnvelopeModel",
        "from sqlalchemy import Integer"
      ],
      "classes": [
        "DatabaseEvidenceSink"
      ],
      "functions": [
        "emit_envelope_async"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/drivers/reactor_initializer.py",
      "relative_path": "app/houseofcards/internal/logs/drivers/reactor_initializer.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Initialize EventReactor at application startup",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [],
      "imports": [
        "from typing import Optional",
        "import logging"
      ],
      "classes": [],
      "functions": [
        "initialize_event_reactor",
        "get_reactor_status",
        "shutdown_event_reactor"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/drivers/logging_config.py",
      "relative_path": "app/houseofcards/internal/logs/drivers/logging_config.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Structured JSON logging configuration",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [],
      "imports": [
        "import json",
        "import logging",
        "import sys",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict"
      ],
      "classes": [
        "JSONFormatter"
      ],
      "functions": [
        "setup_logging",
        "log_request",
        "log_provenance"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/drivers/phases.py",
      "relative_path": "app/houseofcards/internal/logs/drivers/phases.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Run Orchestration Kernel phase definitions and state machine",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Dict, FrozenSet, List, Optional, Set",
        "from uuid import UUID"
      ],
      "classes": [
        "RunPhase",
        "PhaseTransitionError",
        "PhaseStatusInvariantError",
        "PhaseTransition",
        "PhaseContext",
        "PhaseStateMachine"
      ],
      "functions": [
        "assert_phase_status_invariant",
        "get_expected_statuses_for_phase"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/facades/nats_adapter.py",
      "relative_path": "app/houseofcards/internal/logs/facades/nats_adapter.py",
      "folder_layer": "L3",
      "header": {
        "declared_layer": "L3",
        "audience": null,
        "role": "NATS event streaming adapter",
        "raw_layer_line": "# Layer: L3 \u2014 Boundary Adapter"
      },
      "signals": [
        {
          "pattern": "class \\w+Adapter\\b",
          "layer": "L3_ADAPTER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "from .publisher import BasePublisher"
      ],
      "classes": [
        "NatsAdapter"
      ],
      "functions": [],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/engines/shadow_audit.py",
      "relative_path": "app/houseofcards/internal/logs/engines/shadow_audit.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Shadow audit logging for auth decisions",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import json",
        "import logging",
        "import os",
        "import threading",
        "from collections import defaultdict",
        "from dataclasses import asdict, dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Tuple"
      ],
      "classes": [
        "ShadowAuditEvent",
        "ShadowAuditLogger",
        "ShadowAuditAggregator"
      ],
      "functions": [
        "record_shadow_audit_metric"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/engines/gateway_audit.py",
      "relative_path": "app/houseofcards/internal/logs/engines/gateway_audit.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Audit emission for auth gateway events",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engine"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.add\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import asdict, dataclass",
        "from datetime import datetime",
        "from enum import Enum",
        "from typing import Optional",
        "from .contexts import (",
        "from .gateway_types import GatewayAuthError"
      ],
      "classes": [
        "AuditEventType",
        "GatewayAuditEvent"
      ],
      "functions": [
        "emit_auth_audit",
        "emit_auth_failure_audit",
        "_emit_event",
        "_write_to_db",
        "_sync_write_audit_log"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/logs/engines/jwt_auth.py",
      "relative_path": "app/houseofcards/internal/logs/engines/jwt_auth.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "JWT token validation and parsing",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timedelta",
        "from typing import Any, Dict, List, Optional",
        "from fastapi import HTTPException, Request, Security",
        "from fastapi.security import HTTPAuthorizationCredentials, HTTPBearer"
      ],
      "classes": [
        "JWTConfig",
        "TokenPayload",
        "JWKSCache",
        "JWTAuthDependency"
      ],
      "functions": [
        "get_jwt_auth",
        "verify_token",
        "create_dev_token"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/integrations/drivers/oidc_provider.py",
      "relative_path": "app/houseofcards/internal/integrations/drivers/oidc_provider.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "OIDC authentication provider adapter",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import time",
        "from functools import lru_cache",
        "from typing import Any, Dict, List, Optional, Tuple",
        "import httpx",
        "import jwt",
        "from jwt import PyJWKClient, PyJWKClientError"
      ],
      "classes": [
        "OIDCError",
        "TokenValidationError"
      ],
      "functions": [
        "_get_jwks_client",
        "_get_oidc_config",
        "validate_token",
        "get_roles_from_token",
        "get_user_info_from_token",
        "validate_and_extract",
        "map_keycloak_roles_to_aos"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/integrations/drivers/oauth_providers.py",
      "relative_path": "app/houseofcards/internal/integrations/drivers/oauth_providers.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "OAuth provider adapters (Google, GitHub, etc)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "import secrets",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, Optional",
        "from urllib.parse import urlencode",
        "import httpx"
      ],
      "classes": [
        "OAuthUserInfo",
        "OAuthError",
        "GoogleOAuthProvider",
        "AzureOAuthProvider"
      ],
      "functions": [
        "get_google_provider",
        "get_azure_provider"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/integrations/drivers/clerk_provider.py",
      "relative_path": "app/houseofcards/internal/integrations/drivers/clerk_provider.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Clerk authentication provider adapter",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from typing import Any, Dict, List, Optional",
        "import httpx",
        "import jwt",
        "from jwt import PyJWKClient"
      ],
      "classes": [
        "ClerkUser",
        "ClerkAuthError",
        "ClerkAuthProvider"
      ],
      "functions": [
        "get_clerk_provider",
        "get_user_roles_from_clerk"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/integrations/drivers/role_mapping.py",
      "relative_path": "app/houseofcards/internal/integrations/drivers/role_mapping.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Role-to-permission mapping engine",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Dict, List, Optional"
      ],
      "classes": [
        "CustomerRole",
        "FounderRole",
        "RBACRole",
        "PrincipalType",
        "Principal",
        "AuthContext",
        "FounderIsolationError"
      ],
      "functions": [
        "map_customer_role_to_rbac",
        "map_founder_role_to_rbac",
        "map_console_role_string",
        "guard_founder_isolation",
        "get_role_hierarchy",
        "role_subsumes",
        "build_auth_context",
        "get_role_approval_level",
        "get_max_approval_level",
        "map_external_role_to_aos",
        "map_external_roles_to_aos"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/integrations/engines/gateway_middleware.py",
      "relative_path": "app/houseofcards/internal/integrations/engines/gateway_middleware.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L2",
        "audience": "CUSTOMER",
        "role": "FastAPI middleware for auth gateway integration",
        "raw_layer_line": "# Layer: L2 \u2014 API"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from fastapi.responses import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Response\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "return JSONResponse",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "raise HTTPException",
          "layer": "L2_API",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "import os",
        "import re",
        "from typing import Callable, Optional, Sequence",
        "from fastapi import Request, Response",
        "from fastapi.responses import JSONResponse",
        "from starlette.middleware.base import BaseHTTPMiddleware",
        "from starlette.types import ASGIApp",
        "from .contexts import AuthPlane, GatewayContext",
        "from .gateway import AuthGateway, get_auth_gateway",
        "from .gateway_types import GatewayAuthError, is_error",
        "from .rbac_rules_loader import get_public_paths",
        "from .customer_sandbox import try_sandbox_auth, SandboxCustomerPrincipal, is_sandbox_allowed"
      ],
      "classes": [
        "AuthGatewayMiddleware"
      ],
      "functions": [
        "_get_default_public_paths",
        "get_auth_context",
        "require_auth_context",
        "get_auth_plane"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/integrations/engines/rbac_integration.py",
      "relative_path": "app/houseofcards/internal/integrations/engines/rbac_integration.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Bridge RBACv1 \u2192 RBACv2 for shadow comparison",
        "raw_layer_line": "# Layer: L6 \u2014 Platform Substrate"
      },
      "signals": [
        {
          "pattern": "from fastapi import",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def \\w+\\(.*request:\\s*Request",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from __future__ import annotations",
        "import logging",
        "from dataclasses import dataclass",
        "from typing import Optional",
        "from fastapi import Request",
        "from app.auth.actor import ActorContext, ActorType, IdentitySource",
        "from app.auth.authorization import (",
        "from app.auth.authorization import (",
        "from app.auth.identity_chain import get_identity_chain",
        "from app.auth.rbac_middleware import (",
        "from app.auth.rbac_middleware import ("
      ],
      "classes": [
        "DecisionComparison"
      ],
      "functions": [
        "extract_actor_from_request",
        "build_fallback_actor_from_v1_roles",
        "authorize_with_v2_engine",
        "_create_anonymous_actor",
        "compare_decisions",
        "map_policy_to_permission",
        "map_old_roles_to_new_roles",
        "parallel_authorize",
        "log_decision_comparison"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/integrations/engines/worker.py",
      "relative_path": "app/houseofcards/internal/integrations/engines/worker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Business builder main worker",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Worker\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import json",
        "import logging",
        "import re",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Protocol, Tuple",
        "from .agents import WORKER_AGENTS, register_all_agents",
        "from .execution_plan import (",
        "from .llm_service import get_llm_service",
        "from .schemas.brand import BrandSchema, ToneLevel, create_minimal_brand"
      ],
      "classes": [
        "EventEmitter",
        "WorkerResult",
        "BusinessBuilderWorker"
      ],
      "functions": [
        "replay"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/incidents/drivers/observability_guard.py",
      "relative_path": "app/houseofcards/internal/incidents/drivers/observability_guard.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Observability requirements guard - ensures trace creation with configurable failure modes",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import logging",
        "import os",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Optional"
      ],
      "classes": [
        "ObservabilityMode",
        "ObservabilityStatus",
        "ObservabilityFailure",
        "ObservabilityResult",
        "ObservabilityGuard"
      ],
      "functions": [
        "get_observability_guard"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/incidents/drivers/failure_classification_engine.py",
      "relative_path": "app/houseofcards/internal/incidents/drivers/failure_classification_engine.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Failure pattern classification and aggregation logic",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent",
        "import hashlib",
        "from collections import defaultdict",
        "from dataclasses import dataclass, field",
        "from typing import Any, Dict, List, Optional",
        "from app.services.recovery_rule_engine import ("
      ],
      "classes": [
        "FailurePattern",
        "AggregatedPattern",
        "SummaryStats"
      ],
      "functions": [
        "compute_signature",
        "aggregate_patterns",
        "get_summary_stats"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/incidents/drivers/failure_semantics.py",
      "relative_path": "app/houseofcards/internal/incidents/drivers/failure_semantics.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L4",
        "audience": null,
        "role": "Customer-visible failure semantics with category classification",
        "raw_layer_line": "# Layer: L4 \u2014 Domain Engines"
      },
      "signals": [
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from dataclasses import dataclass, field",
        "from enum import Enum",
        "from typing import Any, Dict, Optional"
      ],
      "classes": [
        "FailureCategory",
        "CustomerFailure",
        "ErrorCodes",
        "SDKResult"
      ],
      "functions": [
        "classify_exception"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/incidents/drivers/failure_aggregation.py",
      "relative_path": "app/houseofcards/internal/incidents/drivers/failure_aggregation.py",
      "folder_layer": "L6",
      "header": {
        "declared_layer": "L6",
        "audience": null,
        "role": "Failure aggregation background job (orchestration only)",
        "raw_layer_line": "# Layer: L6 \u2014 Driver"
      },
      "signals": [
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from app\\.db import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import argparse",
        "import json",
        "import logging",
        "import sys",
        "from datetime import datetime, timedelta, timezone",
        "from pathlib import Path",
        "from typing import Any, Dict, List, Optional",
        "from app.jobs.failure_classification_engine import ("
      ],
      "classes": [],
      "functions": [
        "fetch_unmatched_failures",
        "write_output",
        "run_aggregation",
        "main"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/incidents/engines/recovery_evaluator.py",
      "relative_path": "app/houseofcards/internal/incidents/engines/recovery_evaluator.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": null,
        "role": "Recovery execution (L5 pure execution)",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Decision",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        },
        {
          "pattern": "Outcome",
          "layer": "L4_ENGINE_GOOD",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "from app.infra import FeatureIntent, RetryPolicy",
        "import asyncio",
        "import json",
        "import logging",
        "import os",
        "import time",
        "from dataclasses import dataclass",
        "from datetime import datetime, timezone",
        "from typing import Any, Callable, Dict, List, Optional"
      ],
      "classes": [
        "FailureEvent",
        "EvaluationOutcome",
        "RecoveryHooks",
        "RecoveryExecutor"
      ],
      "functions": [
        "register_hook",
        "unregister_hook"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/incidents/engines/lifecycle_worker.py",
      "relative_path": "app/houseofcards/internal/incidents/engines/lifecycle_worker.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": "L5",
        "audience": "INTERNAL",
        "role": "Lifecycle worker orchestration with progress tracking and failure recovery",
        "raw_layer_line": "# Layer: L5 \u2014 Execution & Workers"
      },
      "signals": [
        {
          "pattern": "from app\\.models",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "update\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+\\(str, Enum\\)",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "@dataclass",
          "layer": "L6_SCHEMA",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Worker\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        }
      ],
      "imports": [
        "import asyncio",
        "import logging",
        "from dataclasses import dataclass, field",
        "from datetime import datetime, timezone",
        "from enum import Enum",
        "from typing import Any, Callable, Dict, List, Optional, Tuple",
        "import uuid"
      ],
      "classes": [
        "LifecycleStageProgress",
        "StageProgressInfo",
        "LifecycleProgress",
        "LifecycleProgressManager",
        "RecoveryState",
        "LifecycleRecoveryManager",
        "LifecycleJobPayload",
        "LifecycleWorker"
      ],
      "functions": [
        "get_lifecycle_worker",
        "get_lifecycle_progress_manager",
        "get_lifecycle_recovery_manager",
        "reset_lifecycle_worker"
      ],
      "error": null
    },
    {
      "file": "backend/app/houseofcards/internal/incidents/engines/outbox_processor.py",
      "relative_path": "app/houseofcards/internal/incidents/engines/outbox_processor.py",
      "folder_layer": "L4",
      "header": {
        "declared_layer": null,
        "audience": null,
        "role": null,
        "raw_layer_line": null
      },
      "signals": [
        {
          "pattern": "Request\\b",
          "layer": "L2_API",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlalchemy import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import Session",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "from sqlmodel import",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.execute\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "session\\.commit\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "insert\\(",
          "layer": "L6_DRIVER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "class \\w+Processor\\b",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "async def process_",
          "layer": "L5_WORKER",
          "line": null,
          "violation": null
        },
        {
          "pattern": "asyncio\\.sleep\\(",
          "layer": "TEMPORAL_LEAK",
          "line": null,
          "violation": "TEMPORAL_LEAK"
        }
      ],
      "imports": [
        "import argparse",
        "import asyncio",
        "import hashlib",
        "import logging",
        "import os",
        "import signal",
        "import socket",
        "import sys",
        "import uuid",
        "from datetime import datetime, timezone",
        "from typing import Any, Dict, List, Optional, Tuple",
        "import httpx",
        "from app.infra import FeatureIntent, RetryPolicy"
      ],
      "classes": [
        "OutboxProcessor"
      ],
      "functions": [
        "main"
      ],
      "error": null
    }
  ]
}
s_no,source_path,audience,domain,layer,target_path,file_header,docstring,existing_hoc_path,auto_status,audit_status,audit_notes,action
1,app/adapters/__init__.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/__init__.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Role: Package for L3 boundary adapters\n# Reference: PIN-258 Phase F\n\n""""""\nL3 Boundary Adapters Package\n\nThis package contains L3 boundary adapters that translate between:\n- L2 (API routes) - request handlers\n- L4 (Domain commands) - domain decisions\n\nAdapters must:\n- Only import from L4 and L6\n- Never import from L1, L2, or L5","\nL3 Boundary Adapters Package\n\nThis package contains L3 boundary adapters that translate between:\n- L2 (API routes) - request handlers\n- L4 (Domain commands) - domain decisions\n\nAdapters must:\n- Only import from L4 and L6\n- Never import from L1, L2, or L5\n- Translate requests, not make domain decisions\n- Be thin (<200 LOC typically)\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
2,app/adapters/customer_activity_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/customer_activity_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync (delegates to L4)\n# Role: Customer activity boundary adapter (L2 → L3 → L4)\n# Callers: L2 activity routes\n# Allowed Imports: L4\n# Forbidden Imports: L1, L2, L5, L6\n# Reference: ACTIVITY Domain Qualification Task\n#\n# GOVERNANCE NOTE:\n# This L3 adapter is TRANSLATION ONLY. It enforces:\n# - Tenant scoping (customer can only see their own data)\n# - Customer-safe schema (no internal fields exposed)",\nCustomer Activity Boundary Adapter (L3)\n\nThis adapter sits between L2 (Activity API routes) and L4 (CustomerActivityReadService).\n\nL2 (API) → L3 (this adapter) → L4 (CustomerActivityReadService)\n\nThe adapter:\n1. Receives API requests with tenant context\n2. Enforces tenant isolation (customer can only see their own activities)\n3. Transforms to customer-safe schema (no internal fields)\n4. Delegates to L4 service\n5. Returns customer-friendly results to L2\n\nThis is a thin translation layer - no bus,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
3,app/adapters/customer_incidents_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/customer_incidents_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync (delegates to L4)\n# Role: Customer incidents boundary adapter (L2 → L3 → L4)\n# Callers: guard.py (L2) — to be wired\n# Allowed Imports: L4\n# Forbidden Imports: L1, L2, L5, L6\n# Reference: PIN-280, PIN-281 (L2 Promotion Governance - PHASE 1 L3 Closure)\n#\n# GOVERNANCE NOTE:\n# This L3 adapter is TRANSLATION ONLY. It enforces:\n# - Tenant scoping (customer can only see their own incidents)\n# - Customer-safe schema (calm vocabulary per M29)","\nCustomer Incidents Boundary Adapter (L3)\n\nThis adapter sits between L2 (guard.py API) and L4 (services).\n\nL2 (Guard API) → L3 (this adapter) → L4 (IncidentReadService/IncidentWriteService)\n\nThe adapter:\n1. Receives API requests with tenant context\n2. Enforces tenant isolation\n3. Transforms to customer-safe schema (calm vocabulary)\n4. Delegates to L4 services (no L6 access)\n5. Returns customer-friendly results\n\nReference: PIN-280 (L2 Promotion Governance), PIN-281 (PHASE 1 L3 Closure)\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
4,app/adapters/customer_keys_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/customer_keys_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync (delegates to L4)\n# Role: Customer API keys boundary adapter (L2 → L3 → L4)\n# Callers: guard.py (L2) — to be wired\n# Allowed Imports: L4\n# Forbidden Imports: L1, L2, L5, L6\n# Reference: PIN-280, PIN-281 (L2 Promotion Governance - PHASE 1 L3 Closure)\n#\n# GOVERNANCE NOTE:\n# This L3 adapter is TRANSLATION ONLY. It enforces:\n# - Tenant scoping (customer can only see their own API keys)\n# - Customer-safe schema (no full key value exposed)","\nCustomer Keys Boundary Adapter (L3)\n\nThis adapter sits between L2 (guard.py API) and L4 (services).\n\nL2 (Guard API) → L3 (this adapter) → L4 (KeysReadService/KeysWriteService)\n\nThe adapter:\n1. Receives API requests with tenant context\n2. Enforces tenant isolation\n3. Transforms to customer-safe schema (prefix only, no full key)\n4. Delegates to L4 services (no L6 access)\n\nReference: PIN-280 (L2 Promotion Governance), PIN-281 (PHASE 1 L3 Closure)\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
5,app/adapters/customer_killswitch_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/customer_killswitch_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync (delegates to L4)\n# Role: Customer killswitch boundary adapter (L2 → L3 → L4)\n# Callers: guard.py (L2)\n# Allowed Imports: L4\n# Forbidden Imports: L1, L2, L5, L6\n# Reference: PIN-280, PIN-281 (L2 Promotion Governance)\n#\n# GOVERNANCE NOTE:\n# This L3 adapter is TRANSLATION ONLY. It enforces:\n# - Tenant scoping (customer can only control their own killswitch)\n# - Customer-safe schema (no internal state details)","\nCustomer Killswitch Boundary Adapter (L3)\n\nThis adapter sits between L2 (guard.py API) and L4 services.\n\nL2 (Guard API) → L3 (this adapter) → L4 (CustomerKillswitchReadService, GuardWriteService)\n\nThe adapter:\n1. Receives API requests with tenant context\n2. Enforces tenant isolation\n3. Delegates to L4 for all operations\n4. Transforms results to customer-safe DTOs\n\nReference: PIN-280 (L2 Promotion Governance), PIN-281 (Claude Task TODO)\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
6,app/adapters/customer_logs_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/customer_logs_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: async (delegates to L4)\n# Role: Customer logs boundary adapter (L2 → L3 → L4)\n# Callers: guard_logs.py (L2)\n# Allowed Imports: L4\n# Forbidden Imports: L1, L2, L5, L6\n# Reference: PIN-280, PIN-281 (L2 Promotion Governance - PHASE 1 L3 Closure)\n#\n# GOVERNANCE NOTE:\n# This L3 adapter is TRANSLATION ONLY. It enforces:\n# - Tenant scoping (customer can only see their own data)\n# - Customer-safe schema (no internal fields exposed)","\nCustomer Logs Boundary Adapter (L3)\n\nThis adapter sits between L2 (guard_logs.py API) and L4 (LogsReadService).\n\nL2 (Guard API) → L3 (this adapter) → L4 (LogsReadService)\n\nThe adapter:\n1. Receives API requests with tenant context\n2. Enforces tenant isolation (customer can only see their own logs)\n3. Transforms to customer-safe schema (no internal fields)\n4. Delegates to L4 service\n5. Returns customer-friendly results to L2\n\nThis is a thin translation layer - no business logic, no domain decisio",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
7,app/adapters/customer_policies_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/customer_policies_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync (delegates to L4)\n# Role: Customer policies boundary adapter (L2 → L3 → L4)\n# Callers: guard_policies.py (L2)\n# Allowed Imports: L4\n# Forbidden Imports: L1, L2, L5, L6\n# Reference: PIN-280, PIN-281 (L2 Promotion Governance)\n#\n# GOVERNANCE NOTE:\n# This L3 adapter is TRANSLATION ONLY. It enforces:\n# - Tenant scoping (customer can only see their own policies)\n# - Customer-safe schema (no internal threshold logic exposed)","\nCustomer Policies Boundary Adapter (L3)\n\nThis adapter sits between L2 (guard_policies.py API) and L4 (CustomerPolicyReadService).\n\nL2 (Guard API) → L3 (this adapter) → L4 (CustomerPolicyReadService)\n\nThe adapter:\n1. Receives API requests with tenant context\n2. Enforces tenant isolation\n3. Transforms to customer-safe policy view\n4. Delegates to L4 service\n5. Returns customer-friendly policy constraints to L2\n\nThis is a thin translation layer - no policy evaluation logic, no direct DB access.\n\nRe",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
8,app/adapters/file_storage/__init__.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/__init__.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: File storage adapters for object storage\n# Callers: DataIngestionExecutor, ExportService\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-147, GAP-148 (File Storage Adapters)\n\n""""""\nFile Storage Adapters (GAP-147, GAP-148)\n\nProvides adapters for object storage:","\nFile Storage Adapters (GAP-147, GAP-148)\n\nProvides adapters for object storage:\n- AWS S3 (GAP-147)\n- Google Cloud Storage (GAP-148)\n\nFeatures:\n- Unified interface for file operations\n- Streaming upload/download\n- Presigned URLs\n- Multipart upload\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
9,app/adapters/file_storage/base.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/file_storage_base.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Base class for file storage adapters\n# Callers: File storage adapter implementations\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-147, GAP-148\n\n""""""\nFile Storage Base Adapter\n\nProvides abstract interface for file storage operations.",\nFile Storage Base Adapter\n\nProvides abstract interface for file storage operations.\nAll file storage adapters must implement this interface.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In adapters/ subdir,TRANSFER
10,app/adapters/file_storage/gcs_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/gcs_adapter.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Google Cloud Storage file storage adapter\n# Callers: DataIngestionExecutor, ExportService\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-148 (GCS File Storage Adapter)\n\n""""""\nGoogle Cloud Storage File Storage Adapter (GAP-148)\n\nProvides integration with Google Cloud Storage:",\nGoogle Cloud Storage File Storage Adapter (GAP-148)\n\nProvides integration with Google Cloud Storage:\n- Bucket operations\n- Resumable uploads for large files\n- Signed URLs\n- Object lifecycle management\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
11,app/adapters/file_storage/s3_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/s3_adapter.py,"# Layer: L3 — Boundary Adapters\n# AUDIENCE: INTERNAL\n# PHASE: W3\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: AWS S3 file storage adapter\n# Callers: DataIngestionExecutor, ExportService\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-147 (S3 File Storage Adapter)\n\n""""""\nAWS S3 File Storage Adapter (GAP-147)",\nAWS S3 File Storage Adapter (GAP-147)\n\nProvides integration with AWS S3:\n- Bucket operations\n- Multipart upload for large files\n- Presigned URLs\n- Server-side encryption\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
12,app/adapters/founder_contract_review_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/founder_contract_review_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide (Part-2 CRM Workflow)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Translate Contract domain models to Founder Review views\n# Callers: founder_review.py (L2)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-293, PART2_CRM_WORKFLOW_CHARTER.md, part2-design-v1\n\n""""""\nFounder Review Adapter (L3)\n\nTranslates L4 Contract domain models to Founder-facing review views.",\nFounder Review Adapter (L3)\n\nTranslates L4 Contract domain models to Founder-facing review views.\n\nL4 (ContractService) → L3 (this adapter) → L2 (founder_review.py)\n\nThe adapter:\n1. Receives ContractState domain models from L4\n2. Selects/renames fields for Founder audience\n3. Returns FounderReviewView for L2\n\nHARD RULES (from PART2_CRM_WORKFLOW_CHARTER.md):\n- NO business logic (that's L4's job)\n- NO state transitions (that's L4's job)\n- NO eligibility decisions (that's L4's job)\n- NO permission,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
13,app/adapters/founder_ops_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/founder_ops_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide (ops visibility)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Translate OpsIncident domain models to Founder-facing views\n# Callers: ops.py (L2)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-264 (Phase-S L3 Adapter)\n\n""""""\nFounder Ops Adapter (L3)\n\nTranslates L4 OpsIncident domain models to Founder-facing API views.",\nFounder Ops Adapter (L3)\n\nTranslates L4 OpsIncident domain models to Founder-facing API views.\n\nL4 (OpsIncidentService) → L3 (this adapter) → L2 (ops.py)\n\nThe adapter:\n1. Receives OpsIncident domain models from L4\n2. Selects/renames fields for Founder audience\n3. Applies minimal redaction if needed\n4. Returns FounderIncidentSummaryView for L2\n\nHARD RULES (from PIN-264):\n- NO infra queries (that's L4's job)\n- NO aggregation (that's L4's job)\n- NO permissions logic (that's L2's job)\n- NO paginati,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
14,app/adapters/notifications/__init__.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/__init__.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Notification adapters\n# Callers: NotificationService, AlertManager\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-151, GAP-152, GAP-153 (Notification Adapters)\n\n""""""\nNotification Adapters (GAP-151, GAP-152, GAP-153)\n\nProvides adapters for sending notifications:","\nNotification Adapters (GAP-151, GAP-152, GAP-153)\n\nProvides adapters for sending notifications:\n- SMTP Email (GAP-151)\n- Slack (GAP-152)\n- Webhooks with Retry Logic (GAP-153)\n\nFeatures:\n- Unified interface for notification delivery\n- Retry logic with exponential backoff\n- Circuit breaker pattern\n- Rich message formatting\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
15,app/adapters/notifications/base.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/notifications_base.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Base class for notification adapters\n# Callers: Notification adapter implementations\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-151, GAP-152, GAP-153\n\n""""""\nNotification Base Adapter\n\nProvides abstract interface for notification operations.",\nNotification Base Adapter\n\nProvides abstract interface for notification operations.\nAll notification adapters must implement this interface.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In adapters/ subdir,TRANSFER
16,app/adapters/notifications/slack_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/slack_adapter.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Slack notification adapter\n# Callers: NotificationService, AlertManager\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-152 (Slack Notification Adapter)\n\n""""""\nSlack Notification Adapter (GAP-152)\n\nProvides Slack notifications:",\nSlack Notification Adapter (GAP-152)\n\nProvides Slack notifications:\n- Channel and DM messaging\n- Rich message formatting (blocks)\n- File uploads\n- Thread replies\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
17,app/adapters/notifications/smtp_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/smtp_adapter.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: SMTP email notification adapter\n# Callers: NotificationService, AlertManager\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-151 (SMTP Notification Adapter)\n\n""""""\nSMTP Notification Adapter (GAP-151)\n\nProvides email notifications via SMTP:",\nSMTP Notification Adapter (GAP-151)\n\nProvides email notifications via SMTP:\n- Async email sending via aiosmtplib\n- HTML and plain text support\n- Attachment handling\n- Connection pooling\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
18,app/adapters/notifications/webhook_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/webhook_adapter.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Webhook notification adapter with retry logic\n# Callers: NotificationService, AlertManager\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-153 (Webhook Retry Logic)\n\n""""""\nWebhook Notification Adapter with Retry Logic (GAP-153)\n\nProvides webhook notifications with robust retry:",\nWebhook Notification Adapter with Retry Logic (GAP-153)\n\nProvides webhook notifications with robust retry:\n- Exponential backoff\n- Configurable retry policies\n- Circuit breaker pattern\n- Dead letter queue support\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
19,app/adapters/platform_eligibility_adapter.py,CUSTOMER,platform,L3,app/houseofcards/customer/platform/facades/platform_eligibility_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide (platform health visibility)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Translate L4 PlatformHealthService outputs to API-friendly views\n# Callers: L2 (/platform/health, /platform/capabilities)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-284 (Platform Monitoring System)\n\n""""""\nPlatform Eligibility Adapter (L3)\n\nTranslates L4 PlatformHealthService outputs to Founder-facing API views.","\nPlatform Eligibility Adapter (L3)\n\nTranslates L4 PlatformHealthService outputs to Founder-facing API views.\n\nL4 (PlatformHealthService) → L3 (this adapter) → L2 (platform endpoints)\n\nThe adapter:\n1. Receives health states from L4 (SystemHealth, DomainHealth, CapabilityHealth)\n2. Selects/renames fields for Founder audience\n3. Converts dataclasses to JSON-serializable dicts\n4. Returns views suitable for REST APIs\n\nHARD RULES (from PIN-264):\n- NO infra queries (that's L4's job)\n- NO health computa",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
20,app/adapters/policy_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/policy_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async (delegates to L4)\n# Role: Policy evaluation boundary adapter (L2 → L3 → L4)\n# Callers: policy.py (L2)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-258 Phase F-3 Policy Cluster\n# Contract: PHASE_F_FIX_DESIGN (F-P-RULE-1 to F-P-RULE-5)\n#\n# GOVERNANCE NOTE (F-P-RULE-3):\n# This L3 adapter is TRANSLATION ONLY. No branching, no thresholds,\n# no interpretation. It accepts API requests, normalizes inputs,","\nPolicy Boundary Adapter (L3)\n\nThis adapter sits between L2 (policy.py API) and L4 (policy_command.py).\n\nL2 (API) → L3 (this adapter) → L4 (command) → L5 (workflow execution)\n\nThe adapter:\n1. Receives API requests with execution context\n2. Translates to domain facts\n3. Delegates to L4 commands\n4. Returns results to L2\n\nThis is a thin translation layer - no branching, no thresholds, no interpretation.\n\nReference: PIN-258 Phase F-3 Policy Cluster\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
21,app/adapters/runtime_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/runtime_adapter.py,"# Layer: L3 — Boundary Adapter (Translation)\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Translate API requests into runtime domain commands\n# Callers: runtime.py (L2)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-258 Phase F-3 Runtime Cluster\n# Contract: PHASE_F_FIX_DESIGN (L3 Adapter Rules)\n#\n# GOVERNANCE NOTE: This L3 adapter is the ONLY thing L2 runtime.py may call.\n# It must NOT import from L5 (workers, execution).\n# It translates API requests into L4 domain commands and returns domain results.",\nRuntime Boundary Adapter (L3)\n\nL3 adapter for runtime API operations. This is the boundary between:\n- L2 (API routes) - callers\n- L4 (Domain commands) - domain decisions\n\nThis adapter:\n1. Receives API requests from L2\n2. Translates them into L4 domain facts\n3. Calls L4 command functions\n4. Returns domain results to L2\n\nIt does NOT:\n- Import from L5 (workers)\n- Execute skills directly\n- Make domain decisions (that's L4's job)\n\nReference: PIN-258 Phase F-3 Runtime Cluster\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
22,app/adapters/serverless/__init__.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/__init__.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Serverless function adapters\n# Callers: SkillExecutor, WorkflowEngine\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-149, GAP-150 (Serverless Adapters)\n\n""""""\nServerless Adapters (GAP-149, GAP-150)\n\nProvides adapters for serverless function execution:","\nServerless Adapters (GAP-149, GAP-150)\n\nProvides adapters for serverless function execution:\n- AWS Lambda (GAP-149)\n- Google Cloud Functions (GAP-150)\n\nFeatures:\n- Unified interface for function invocation\n- Async and sync invocation modes\n- Response parsing\n- Error handling\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
23,app/adapters/serverless/base.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/serverless_base.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Base class for serverless adapters\n# Callers: Serverless adapter implementations\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-149, GAP-150\n\n""""""\nServerless Base Adapter\n\nProvides abstract interface for serverless function operations.",\nServerless Base Adapter\n\nProvides abstract interface for serverless function operations.\nAll serverless adapters must implement this interface.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In adapters/ subdir,TRANSFER
24,app/adapters/serverless/cloud_functions_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/cloud_functions_adapter.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Google Cloud Functions serverless adapter\n# Callers: SkillExecutor, WorkflowEngine\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-150 (Cloud Functions Serverless Adapter)\n\n""""""\nGoogle Cloud Functions Serverless Adapter (GAP-150)\n\nProvides integration with Google Cloud Functions:",\nGoogle Cloud Functions Serverless Adapter (GAP-150)\n\nProvides integration with Google Cloud Functions:\n- HTTP and event-triggered functions\n- Async invocation via Pub/Sub\n- Response parsing\n- Function management\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
25,app/adapters/serverless/lambda_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/lambda_adapter.py,"# Layer: L3 — Boundary Adapters\n# AUDIENCE: INTERNAL\n# PHASE: W3\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: AWS Lambda serverless adapter\n# Callers: SkillExecutor, WorkflowEngine\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-149 (AWS Lambda Serverless Adapter)\n\n""""""\nAWS Lambda Serverless Adapter (GAP-149)",\nAWS Lambda Serverless Adapter (GAP-149)\n\nProvides integration with AWS Lambda:\n- Sync and async invocation\n- Payload encoding/decoding\n- Log retrieval\n- Function management\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
26,app/adapters/vector_stores/__init__.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/__init__.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Vector store adapters for embedding storage and similarity search\n# Callers: RetrievalMediator, IndexingExecutor\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-144, GAP-145, GAP-146 (Vector Store Adapters)\n\n""""""\nVector Store Adapters (GAP-144, GAP-145, GAP-146)\n\nProvides adapters for vector databases:","\nVector Store Adapters (GAP-144, GAP-145, GAP-146)\n\nProvides adapters for vector databases:\n- Pinecone (GAP-144)\n- Weaviate (GAP-145)\n- PGVector (GAP-146)\n\nFeatures:\n- Unified interface for vector operations\n- Batch upsert/query support\n- Metadata filtering\n- Namespace/collection management\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
27,app/adapters/vector_stores/base.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/vector_stores_base.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Base class for vector store adapters\n# Callers: Vector store adapter implementations\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-144, GAP-145, GAP-146\n\n""""""\nVector Store Base Adapter\n\nProvides abstract interface for vector store operations.",\nVector Store Base Adapter\n\nProvides abstract interface for vector store operations.\nAll vector store adapters must implement this interface.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In adapters/ subdir,TRANSFER
28,app/adapters/vector_stores/pgvector_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/pgvector_adapter.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: PGVector production adapter\n# Callers: RetrievalMediator, IndexingExecutor\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-146 (PGVector Production Adapter)\n\n""""""\nPGVector Production Adapter (GAP-146)\n\nProvides integration with PostgreSQL pgvector extension:",\nPGVector Production Adapter (GAP-146)\n\nProvides integration with PostgreSQL pgvector extension:\n- Native PostgreSQL integration\n- HNSW and IVFFlat indexes\n- SQL-based metadata filtering\n- Production-ready with connection pooling\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
29,app/adapters/vector_stores/pinecone_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/pinecone_adapter.py,"# Layer: L3 — Boundary Adapters\n# AUDIENCE: INTERNAL\n# PHASE: W3\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Pinecone vector store adapter\n# Callers: RetrievalMediator, IndexingExecutor\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-144 (Pinecone Vector Store Adapter)\n\n""""""\nPinecone Vector Store Adapter (GAP-144)",\nPinecone Vector Store Adapter (GAP-144)\n\nProvides integration with Pinecone vector database:\n- Serverless and pod-based indexes\n- Namespace support\n- Metadata filtering\n- Batch operations\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
30,app/adapters/vector_stores/weaviate_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/weaviate_adapter.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Weaviate vector store adapter\n# Callers: RetrievalMediator, IndexingExecutor\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: GAP-145 (Weaviate Vector Store Adapter)\n\n""""""\nWeaviate Vector Store Adapter (GAP-145)\n\nProvides integration with Weaviate vector database:",\nWeaviate Vector Store Adapter (GAP-145)\n\nProvides integration with Weaviate vector database:\n- Schema-based collections\n- Hybrid search (vector + keyword)\n- GraphQL queries\n- Multi-tenancy support\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
31,app/adapters/workers_adapter.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/workers_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async (delegates to L4)\n# Role: Worker execution boundary adapter (L2 → L3 → L4)\n# Callers: workers.py (L2)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-258 Phase F-3 Workers Cluster\n# Contract: PHASE_F_FIX_DESIGN (F-W-RULE-1 to F-W-RULE-5)\n#\n# GOVERNANCE NOTE (F-W-RULE-4):\n# This L3 adapter is the ONLY entry point for L2 workers.py.\n# L2 must never import L5 workers directly. This adapter translates","\nWorkers Boundary Adapter (L3)\n\nThis adapter sits between L2 (workers.py API) and L4 (worker_execution_command.py).\n\nL2 (API) → L3 (this adapter) → L4 (command) → L5 (worker execution)\n\nThe adapter:\n1. Receives API requests with execution context\n2. Translates to domain facts\n3. Delegates to L4 commands\n4. Returns results to L2\n\nThis is a thin translation layer - no business logic, no state mutation.\n\nReference: PIN-258 Phase F-3 Workers Cluster\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
32,app/agents/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# M12 Multi-Agent System Module\n# Production-grade multi-agent execution system for AOS\n#\n# Features:\n# - Parallel job execution with orchestrator → workers pattern\n# - SKIP LOCKED claiming for concurrent-safe distribution\n# - agent_spawn and agent_invoke skills with correlation IDs\n# - Redis blackboard for shared state\n# - P2P messaging between agents\n# - Usage-based credit billing\n\nfrom .services.blackboard_service import BlackboardService, get_blackboard_service\nfrom .services.credit_service import CreditService, get_credit_service\nfrom .services.job_service import JobService, get_job_service\nfrom .services.message_service import MessageService, get_message_service",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
33,app/agents/sba/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# M15.1 Strategy-Bound Agents (SBA)\n# Governance layer enforcing Strategy Cascade compliance before spawn\n#\n# Key Components:\n# - SBA Schema: Canonical 5-element strategy cascade\n# - SBA Validator: Spawn-time enforcement\n# - SBA Generator: Auto-generate boilerplate for existing agents\n# - SBA Service: Database operations and enforcement\n# - M18: SBA Evolution (drift detection, boundary tracking, strategy adjustment)\n#\n# Based on: PIN-071 M15 BudgetLLM A2A Integration\n\nfrom .evolution import (\n    DRIFT_WINDOW,\n    LATENCY_DRIFT_THRESHOLD,",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
34,app/agents/sba/evolution.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/evolution.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: SBA agent evolution logic\n# Callers: API routes, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 SBA\n\n# M18 SBA Evolution Engine\n# Self-improving agents with drift detection and boundary awareness\n#\n# Features:",Types of drift that can be detected.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
35,app/agents/sba/generator.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/generator.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: SBA agent generation\n# Callers: API routes\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 SBA\n\n# M15.1 SBA Generator\n# Auto-generate boilerplate SBA for existing agents\n#\n# Strategy:",Quality level of generated SBA content.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
36,app/agents/sba/schema.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/schema.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: SBA schema definitions\n# Callers: agents/sba/*\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 SBA\n\n# M15.1 SBA Schema\n# Canonical Strategy Cascade definition for Strategy-Bound Agents\n#\n# Every agent MUST satisfy this schema before spawn.",Supported governance providers.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
37,app/agents/sba/service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: SBA service orchestration\n# Callers: API routes\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 SBA\n\n# M15.1 SBA Service\n# Database operations for Strategy-Bound Agent registry\n#\n# Manages:",Agent definition from registry.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
38,app/agents/sba/validator.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/validator.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: SBA agent validation\n# Callers: agents/sba/*\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 SBA\n\n# M15.1 SBA Validator\n# Spawn-time enforcement of Strategy Cascade compliance\n#\n# Rules:",Error codes for SBA validation failures.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
39,app/agents/services/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# M12 Agent Services\n# Core services for multi-agent job execution\n\nfrom .blackboard_service import BlackboardService, get_blackboard_service\nfrom .credit_service import CreditService, get_credit_service\nfrom .invoke_audit_service import InvokeAuditService, get_invoke_audit_service\nfrom .job_service import JobService, get_job_service\nfrom .message_service import MessageService, get_message_service\nfrom .registry_service import RegistryService, get_registry_service\nfrom .worker_service import WorkerService, get_worker_service\n\n__all__ = [\n    ""JobService"",\n    ""get_job_service"",\n    ""WorkerService"",",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
40,app/agents/services/blackboard_service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/blackboard_service.py,"# M12 Blackboard Service\n# Shared Redis blackboard for agent coordination\n#\n# Features:\n# - KV read/write\n# - Atomic increment\n# - Pattern read (SCAN)\n# - Distributed locks (SET NX)\n\nimport json\nimport logging\nimport os\nfrom dataclasses import dataclass\nfrom typing import Any, Dict, List, Optional\nfrom uuid import UUID",Entry in the blackboard.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
41,app/agents/services/credit_service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/credit_service.py,"# M12 Credit Service\n# Per-skill and per-item credit billing with reservation, spend, and refund\n#\n# Credit Pricing:\n# - agent_spawn: 5 credits\n# - agent_invoke: 10 credits\n# - blackboard_read: 1 credit\n# - blackboard_write: 1 credit\n# - blackboard_lock: 2 credits\n# - agent_message: 2 credits\n# - per job_item: 2 credits (reserved, refund on failure)\n\nimport logging\nimport os\nfrom dataclasses import dataclass",Current credit balance for a tenant.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
42,app/agents/services/governance_service.py,INTERNAL,agent,L4,app/houseofcards/internal/agent/engines/governance_service.py,"# M15 LLM Governance Service\n# Orchestrates BudgetLLM governance across the M12 multi-agent system\n#\n# Features:\n# - Per-job budget envelope management\n# - Per-worker budget allocation and tracking\n# - Risk aggregation and metrics\n# - Budget check before LLM calls\n# - Automatic budget distribution\n\nimport json\nimport logging\nimport os\nfrom dataclasses import dataclass\nfrom typing import Any, Dict, List, Optional",Budget status for a job or worker.,,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
43,app/agents/services/invoke_audit_service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/invoke_audit_service.py,"# M12.1 Invoke Audit Service\n# Audit trail for agent_invoke calls\n#\n# Based on: PIN-063-m12.1-stabilization.md\n\nimport json\nimport logging\nimport os\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom decimal import Decimal\nfrom typing import Any, Dict, List, Optional\nfrom uuid import UUID, uuid4\n\nfrom sqlalchemy import create_engine, text",Audit entry for an agent_invoke call.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
44,app/agents/services/job_service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/job_service.py,"# M12 Job Service\n# Job creation, status tracking, and item distribution\n#\n# Handles:\n# - Job spawn with item creation\n# - Job status queries\n# - Progress tracking\n# - Job completion/failure handling\n\nimport json\nimport logging\nimport os\nimport uuid\nfrom dataclasses import dataclass\nfrom datetime import datetime, timezone",Configuration for a parallel job.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
45,app/agents/services/message_service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/message_service.py,"# M12 Message Service\n# P2P messaging between agents\n#\n# Pattern reused from M10 outbox_processor.py (80% reuse)\n# M12.1: Added LISTEN/NOTIFY for low-latency message delivery\n\nimport json\nimport logging\nimport os\nimport re\nimport select\nfrom dataclasses import dataclass\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, List, Optional\nfrom uuid import UUID, uuid4",Agent message entity.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
46,app/agents/services/registry_service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/registry_service.py,"# M12 Registry Service\n# Agent registration, heartbeats, and stale detection\n#\n# Pattern reused from M7 memory pins TTL + M2 SkillRegistry (50% reuse)\n\nimport json\nimport logging\nimport os\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom typing import Any, Dict, List, Optional\nfrom uuid import UUID, uuid4\n\nfrom sqlalchemy import create_engine, text\nfrom sqlalchemy.orm import sessionmaker",Registered agent instance.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
47,app/agents/services/retry_policy.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/retry_policy.py,"# M15 Retry Policy for LLM Governance\n# Handles retry logic with parameter adjustment for blocked/failed LLM calls\n#\n# Features:\n# - Configurable max retries\n# - Exponential backoff\n# - Parameter clamping on retry (reduce temperature, etc.)\n# - Stop conditions (budget exhausted, max retries, permanent failure)\n\nimport logging\nfrom dataclasses import dataclass, field\nfrom enum import Enum\nfrom typing import Any, Callable, Dict, List, Optional, Tuple, TypeVar\n\nlogger = logging.getLogger(""nova.agents.retry_policy"")",Reasons for stopping retry.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
48,app/agents/services/worker_service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/worker_service.py,"# M12 Worker Service\n# Concurrent-safe job item claiming using FOR UPDATE SKIP LOCKED\n#\n# Pattern reused from M10 recovery_claim_worker.py (95% reuse)\n\nimport json\nimport logging\nimport os\nfrom dataclasses import dataclass\nfrom typing import Any, Dict, Optional\nfrom uuid import UUID\n\nfrom sqlalchemy import create_engine, text\nfrom sqlalchemy.orm import sessionmaker\n",A claimed job item ready for processing.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
49,app/agents/skills/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# M12 Agent Skills\n# Skills for multi-agent coordination\n\nfrom .agent_invoke import AgentInvokeSkill\nfrom .agent_spawn import AgentSpawnSkill\nfrom .blackboard_ops import BlackboardLockSkill, BlackboardReadSkill, BlackboardWriteSkill\n\n# M15: BudgetLLM Governed LLM Invoke\nfrom .llm_invoke_governed import (\n    GovernanceConfig,\n    GovernedLLMClient,\n    LLMInvokeGovernedSkill,\n    get_governed_llm_skill,\n    governed_llm_invoke,\n)",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
50,app/agents/skills/agent_invoke.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/agent_invoke.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Agent-to-agent invocation skill\n# Callers: agent runtime, workers\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Agent Skills\n\n# M12 Agent Invoke Skill\n# Invoke another agent and wait for response with correlation ID\n#\n# Credit cost: 10 credits",Input schema for agent_invoke skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
51,app/agents/skills/agent_spawn.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/agent_spawn.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Parallel worker agent spawn skill\n# Callers: agent runtime, orchestrators\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Agent Skills\n\n# M12 Agent Spawn Skill\n# Spawns parallel worker agents for job execution\n#\n# Credit cost: 5 credits",Input schema for agent_spawn skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
52,app/agents/skills/blackboard_ops.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/blackboard_ops.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Blackboard read/write operations skill\n# Callers: agent runtime, workers\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Agent Skills\n\n# M12 Blackboard Operation Skills\n# Read, write, and lock operations on shared blackboard\n#\n# Credit costs:",Input schema for blackboard_read skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
53,app/agents/skills/llm_invoke_governed.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/llm_invoke_governed.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Governed LLM invocation skill with budget enforcement\n# Callers: agent runtime, workers\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Agent Skills\n\n# M15 LLM Invoke with BudgetLLM Governance\n# Provides LLM inference with budget control and safety governance\n#\n# Features:",Chat message.,,NEEDS_CLASSIFICATION,ITERATION_1,Agent logic,TRANSFER
54,app/aos_cli.py,INTERNAL,account,L2,app/houseofcards/api/internal/account/aos_cli.py,"# Layer: L7 — Ops & Deployment\n# Product: system-wide\n# Temporal:\n#   Trigger: user (CLI)\n#   Execution: sync\n# Role: Backend CLI utilities\n# Callers: shell\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: CLI Tools\n\n#!/usr/bin/env python3\n""""""\nCLI adapter for AOS - unified execution from command line.\n","\nCLI adapter for AOS - unified execution from command line.\n\nUsage:\n    aos run --agent-id <id> --goal ""your goal here""\n    aos list-agents\n    aos list-skills\n    aos get-run <run_id>\n    aos demo           # Run 60-second demo\n    aos demo --quick   # Run quick demo (30s)\n\nThis provides a command-line interface that uses the same execution path\nas the API endpoints, ensuring consistency.\n\nM3.5 CLI (Machine-Native SDK Demo):\n- Quick 60-second demo showing core capabilities\n- Skill listing with ",,NEEDS_CLASSIFICATION,ITERATION_1,CLI tool,TRANSFER
55,app/api/M17_internal_worker.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/M17_internal_worker.py,"# Layer: L2 — Product APIs\n# AUDIENCE: INTERNAL\n# Product: system-wide (dogfood)\n# Temporal:\n#   Trigger: none (DEPRECATED)\n#   Execution: none (DEPRECATED)\n# Role: M17 Internal Worker Registry - WorkerRegistry/WorkerConfig catalog (DEPRECATED)\n# Callers: None - NOT registered in main.py\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: M17 milestone\n#\n# DEPRECATION NOTE:\n# This file is DEPRECATED and NOT served via any route.\n# It was originally split from connectivity.py but represents internal","\nM17 Internal Worker Registry (DEPRECATED)\n\nSTATUS: DEPRECATED - Not served via any route.\n\nThis file contained read-only endpoints for viewing WorkerRegistry\nand WorkerConfig tables. This is internal infrastructure for the\nAOS worker system, not customer-facing integration management.\n\nOriginal Endpoints (NO LONGER SERVED):\n- GET /api/v1/integrations           → Listed workers from WorkerRegistry\n- GET /api/v1/integrations/{id}      → Worker detail with WorkerConfig\n\nTables:\n- WorkerRegistry: A",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Worker,TRANSFER
56,app/api/M25_integrations.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/M25_integrations.py,"# Layer: L2 — Product APIs\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: M25 Integration System - Loop status, checkpoints, graduation, prevention timeline\n# Authority: WRITE checkpoint resolutions, graduation records (API self-authority)\n# Callers: Ops Console, Founder Console (NOT Customer Console)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: M25 Integration System\n# capability_id: CAP-018\n#\n# GOVERNANCE NOTE:",\nM25 Integration API\n\nEndpoints for:\n- Loop status monitoring\n- Human checkpoint resolution\n- Integration statistics\n- Retry/revert operations\n- Graduation status (M25 learning proof)\n- Prevention timeline (Gate 3)\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
57,app/api/activity.py,CUSTOMER,activity,L2,app/houseofcards/api/customer/activity/activity.py,"# Layer: L2 — Product APIs\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Unified ACTIVITY domain facade - customer-only production API\n# Callers: Customer Console frontend, SDSR validation (same API)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: ACTIVITY Domain - One Facade Architecture\n#\n# GOVERNANCE NOTE:\n# This is the ONE facade for ACTIVITY domain.\n# All activity data flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.",Run lifecycle state.,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
58,app/api/agents.py,CUSTOMER,general,L2,app/houseofcards/api/customer/general/agents.py,"# Layer: L2 — Product APIs\n# AUDIENCE: INTERNAL\n# Role: Multi-agent job execution API - worker coordination, SBA management\n#\n# M12 Agents API Routes\n# REST API for multi-agent job execution\n#\n# Endpoints:\n# - POST /api/v1/jobs - Create job\n# - GET /api/v1/jobs/{id} - Get job status\n# - POST /api/v1/jobs/{id}/cancel - Cancel job\n# - POST /api/v1/jobs/{id}/claim - Worker claims item\n# - POST /api/v1/jobs/{id}/items/{item_id}/complete - Complete item\n# - GET/PUT /api/v1/blackboard/{key} - Blackboard operations\n# - POST /api/v1/blackboard/{key}/lock - Lock operations",Request to create a parallel job.,,NEEDS_CLASSIFICATION,ITERATION_1,API route; Domain uncertain,TRANSFER
59,app/api/alerts.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/alerts.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified ALERTS facade - L2 API for alert operations\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-110 (Alert Configuration), GAP-111 (Alert History), GAP-124 (Alert Routing)\n# GOVERNANCE NOTE:\n# This is the ONE facade for ALERTS domain.\n# All alert flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nAlerts API (L2)\n\nProvides alert operations:\n- POST /api/v1/alerts/rules (create rule)\n- GET /api/v1/alerts/rules (list rules)\n- GET /api/v1/alerts/rules/{id} (get rule)\n- PUT /api/v1/alerts/rules/{id} (update rule)\n- DELETE /api/v1/alerts/rules/{id} (delete rule)\n- GET /api/v1/alerts/history (alert history)\n- GET /api/v1/alerts/history/{id} (get event)\n- POST /api/v1/alerts/history/{id}/acknowledge (acknowledge)\n- POST /api/v1/alerts/history/{id}/resolve (resolve)\n- POST /api/v1/alerts/routes (,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
60,app/api/analytics.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/analytics.py,"# Layer: L2 — Product APIs\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Unified ANALYTICS domain facade - customer-only production API\n# Callers: Customer Console frontend, SDSR validation (same API)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: Analytics Domain Declaration v1, PIN-411\n#\n# GOVERNANCE NOTE:\n# This is the ONE facade for ANALYTICS domain.\n# All analytics reads flow through this API.\n# Console sidebar: LIVE (6th primary domain)",\nUnified Analytics API (L2)\n\nCustomer-facing endpoints for viewing usage statistics.\nAll requests are tenant-scoped via auth_context.\n\nDomain: Analytics\nSubdomain: Statistics\nTopic v1: Usage\n\nEndpoints:\n- GET /api/v1/analytics/statistics/usage             → Usage statistics\n- GET /api/v1/analytics/statistics/usage/export.csv  → CSV export\n- GET /api/v1/analytics/statistics/usage/export.json → JSON export\n- GET /api/v1/analytics/_status                      → Capability probe\n\nArchitecture:\n- ONE,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
61,app/api/aos_accounts.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/aos_accounts.py,"# Layer: L2 — Product APIs\n# AUDIENCE: CUSTOMER\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Unified ACCOUNTS facade - customer-only production API\n# Callers: Customer Console frontend, SDSR validation (same API)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: ACCOUNTS - One Facade Architecture, Customer Console v1 Constitution\n#\n# GOVERNANCE NOTE:\n# Account is NOT a domain - it manages who, what, and billing (not what happened).\n# This is secondary navigation (top-right or footer), not sidebar.","\nUnified Accounts API (L2)\n\nCustomer-facing endpoints for account management: projects, users, profile, billing.\nAll requests are tenant-scoped via auth_context.\n\nIMPORTANT: Account is NOT a domain. It manages:\n- WHO (users, profile)\n- WHAT (projects)\n- BILLING (subscription, invoices)\n\nIt does NOT manage or display:\n- Executions\n- Incidents\n- Policies\n- Logs\n\nEndpoints:\n- GET /api/v1/accounts/projects            → O2 list projects\n- GET /api/v1/accounts/projects/{id}       → O3 project detail\n-",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
62,app/api/aos_api_key.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/aos_api_key.py,"# Layer: L2 — Product APIs\n# AUDIENCE: CUSTOMER\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Unified API KEYS facade - Customer Console Connectivity Domain (API Keys)\n# Callers: Customer Console frontend, SDSR validation (same API)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: Connectivity Domain - Customer Console v1 Constitution\n#\n# GOVERNANCE NOTE:\n# This is the ONE facade for API KEYS in the Connectivity domain.\n# All API key data flows through this API.",\nAPI Keys API (L2) - Connectivity Domain\n\nCustomer-facing endpoints for managing API keys.\nAll requests are tenant-scoped via auth_context.\n\nEndpoints:\n- GET /api/v1/api-keys           → O2 list API keys\n- GET /api/v1/api-keys/{id}      → O3 API key detail\n\nArchitecture:\n- ONE facade for API KEYS in Connectivity domain\n- Queries APIKey table\n- Tenant isolation via auth_context (not header)\n- SDSR validates this same production API\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
63,app/api/aos_cus_integrations.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/aos_cus_integrations.py,"# Layer: L2 — Product APIs\n# AUDIENCE: CUSTOMER\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Customer LLM Integration Management - BYOK (Bring Your Own Key) API\n# Callers: Customer Console frontend, SDK\n# Allowed Imports: L4 (cus_integration_service), L6 (schemas)\n# Forbidden Imports: L1, L3, L5\n# Reference: Connectivity Domain - Customer Console v1 Constitution\n#\n# GOVERNANCE NOTE:\n# This is the customer-facing API for managing LLM provider integrations.\n# Customers register their own API keys (Anthropic, OpenAI, etc.) and","Customer LLM Integration Management API\n\nPURPOSE:\n    CONTROL PLANE for customer LLM integrations. This API manages the lifecycle\n    of integrations - create, update, enable, disable, delete, health checks.\n\nENDPOINTS:\n    CRUD:\n        GET    /integrations           - List integrations (paginated)\n        GET    /integrations/{id}      - Get integration details\n        POST   /integrations           - Create new integration\n        PUT    /integrations/{id}      - Update integration\n        DE",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
64,app/api/auth_helpers.py,CUSTOMER,api_keys,L2,app/houseofcards/api/customer/api_keys/auth_helpers.py,"""""""\nAPI Auth Helpers - Console Authentication\n\nPIN-148: M29 Auth Boundary Verification\n\nProvides API key verification for Guard and Ops console endpoints.\nThese endpoints previously had frontend-only auth which could be bypassed.\n\nUsage:\n    from app.api.auth_helpers import verify_console_api_key\n\n    router = APIRouter(dependencies=[Depends(verify_console_api_key)])\n\n    # Or per-endpoint:\n    @router.get(""/status"")","\nAPI Auth Helpers - Console Authentication\n\nPIN-148: M29 Auth Boundary Verification\n\nProvides API key verification for Guard and Ops console endpoints.\nThese endpoints previously had frontend-only auth which could be bypassed.\n\nUsage:\n    from app.api.auth_helpers import verify_console_api_key\n\n    router = APIRouter(dependencies=[Depends(verify_console_api_key)])\n\n    # Or per-endpoint:\n    @router.get(""/status"")\n    async def get_status(_: str = Depends(verify_console_api_key)):\n        ...\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
65,app/api/authz_status.py,CUSTOMER,agent,L2,app/houseofcards/api/customer/agent/authz_status.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Authorization status endpoint for ops visibility\n# Callers: Ops console, monitoring\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1\n# Reference: docs/invariants/AUTHZ_AUTHORITY.md\n\n""""""\nAuthorization Status API\n\nProvides visibility into the M28/M7 authorization system state.",\nAuthorization Status API\n\nProvides visibility into the M28/M7 authorization system state.\n\nEndpoints:\n    GET /internal/authz/status - Current authorization configuration\n    GET /internal/authz/mappings - All M7→M28 mappings\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
66,app/api/billing_dependencies.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/billing_dependencies.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: request\n#   Execution: sync\n# Role: Phase-6 Billing FastAPI dependencies\n# Callers: API endpoints needing billing context\n# Allowed Imports: L4 (billing, auth.onboarding_state)\n# Forbidden Imports: L1, L5, L6\n# Reference: PIN-399 Phase-6 (Billing, Plans & Limits)\n\n""""""\nPhase-6 Billing Dependencies — FastAPI Integration\n\nProvides dependencies for accessing billing context in API endpoints.","\nPhase-6 Billing Dependencies — FastAPI Integration\n\nProvides dependencies for accessing billing context in API endpoints.\n\nAPPLICABILITY GATE:\n    Billing is evaluated ONLY when tenant.onboarding_state == COMPLETE.\n    Before COMPLETE, these dependencies return neutral placeholders.\n\nDESIGN INVARIANTS:\n- BILLING-001: Billing never blocks onboarding\n- BILLING-003: Billing state does not affect roles\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
67,app/api/compliance.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/compliance.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified COMPLIANCE facade - L2 API for compliance verification\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-103 (Compliance Verification API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for COMPLIANCE domain.\n# All compliance verification flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nCompliance API (L2)\n\nProvides compliance verification operations:\n- POST /api/v1/compliance/verify (run verification)\n- GET /api/v1/compliance/reports (list reports)\n- GET /api/v1/compliance/reports/{id} (get report)\n- GET /api/v1/compliance/rules (list rules)\n- GET /api/v1/compliance/rules/{id} (get rule)\n- GET /api/v1/compliance/status (overall status)\n\nThis is the ONLY facade for compliance verification.\nAll compliance APIs flow through this router.\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
68,app/api/connectors.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/connectors.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified CONNECTORS facade - L2 API for connector operations\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-093 (Connector Registry API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for CONNECTORS domain.\n# All connector data flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nConnectors API (L2)\n\nProvides connector management operations:\n- GET /api/v1/connectors (list connectors)\n- POST /api/v1/connectors (register connector)\n- GET /api/v1/connectors/{id} (get connector)\n- PUT /api/v1/connectors/{id} (update connector)\n- DELETE /api/v1/connectors/{id} (delete connector)\n- POST /api/v1/connectors/{id}/test (test connector)\n\nThis is the ONLY facade for connector operations.\nAll connector APIs flow through this router.\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
69,app/api/controls.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/controls.py,"# Layer: L2 — Product APIs\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified CONTROLS facade - L2 API for control operations\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-123 (Controls API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for CONTROLS domain.\n# All control flows through this API.",\nControls API (L2)\n\nProvides control operations:\n- GET /api/v1/controls (list controls)\n- GET /api/v1/controls/status (overall status)\n- GET /api/v1/controls/{id} (get control)\n- PUT /api/v1/controls/{id} (update control)\n- POST /api/v1/controls/{id}/enable (enable control)\n- POST /api/v1/controls/{id}/disable (disable control)\n\nThis is the ONLY facade for control operations.\nAll controls APIs flow through this router.\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
70,app/api/cost_guard.py,CUSTOMER,incidents,L2,app/houseofcards/api/customer/incidents/cost_guard.py,"""""""Guard Console Cost Visibility API - Customer Cost Transparency\n\nM29 Category 4: Cost Intelligence Completion\n\nThis router provides /guard/costs/* endpoints for the Customer Console.\nCustomers see their own cost data with calm vocabulary.\n\nTHE INVARIANT: All values derive from complete snapshots, never live data.\nCustomer sees ONLY their own tenant data - no cross-tenant leakage.\n\nEndpoints:\n- GET  /guard/costs/summary    - Cost summary with trend and projection\n- GET  /guard/costs/explained  - Why costs are what they are\n- GET  /guard/costs/incidents  - Cost-related incidents\n","Guard Console Cost Visibility API - Customer Cost Transparency\n\nM29 Category 4: Cost Intelligence Completion\n\nThis router provides /guard/costs/* endpoints for the Customer Console.\nCustomers see their own cost data with calm vocabulary.\n\nTHE INVARIANT: All values derive from complete snapshots, never live data.\nCustomer sees ONLY their own tenant data - no cross-tenant leakage.\n\nEndpoints:\n- GET  /guard/costs/summary    - Cost summary with trend and projection\n- GET  /guard/costs/explained  - W",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
71,app/api/cost_intelligence.py,CUSTOMER,logs,L2,app/houseofcards/api/customer/logs/cost_intelligence.py,"""""""\nM26 Cost Intelligence API\n\nCore Objective:\nEvery token spent is attributable to tenant → user → feature → request.\nEvery anomaly must trigger an action, not a chart.\n\nThis is not reporting. This is CONTROL.\n""""""\n\nfrom __future__ import annotations\n\nimport logging\nfrom datetime import datetime, timedelta\nfrom typing import Any, List, Optional, cast","\nM26 Cost Intelligence API\n\nCore Objective:\nEvery token spent is attributable to tenant → user → feature → request.\nEvery anomaly must trigger an action, not a chart.\n\nThis is not reporting. This is CONTROL.\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
72,app/api/cost_ops.py,CUSTOMER,ops,L2,app/houseofcards/api/customer/ops/cost_ops.py,"""""""Ops Console Cost Intelligence API - Founder Cost Visibility\n\nM29 Category 4: Cost Intelligence Completion\n\nThis router provides /ops/cost/* endpoints for the Founder Ops Console.\nFounders see cross-tenant cost aggregation, anomalies, and tenant drilldown.\n\nTHE INVARIANT: All values derive from complete snapshots, never live data.\n\nEndpoints:\n- GET  /ops/cost/overview   - Global cost overview with anomaly summary\n- GET  /ops/cost/anomalies  - Cross-tenant anomaly aggregation\n- GET  /ops/cost/tenants    - Per-tenant cost drilldown\n\nCRITICAL: Uses FROZEN DTOs from app.contracts.ops.","Ops Console Cost Intelligence API - Founder Cost Visibility\n\nM29 Category 4: Cost Intelligence Completion\n\nThis router provides /ops/cost/* endpoints for the Founder Ops Console.\nFounders see cross-tenant cost aggregation, anomalies, and tenant drilldown.\n\nTHE INVARIANT: All values derive from complete snapshots, never live data.\n\nEndpoints:\n- GET  /ops/cost/overview   - Global cost overview with anomaly summary\n- GET  /ops/cost/anomalies  - Cross-tenant anomaly aggregation\n- GET  /ops/cost/tena",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
73,app/api/costsim.py,CUSTOMER,analytics,L2,app/houseofcards/api/customer/analytics/costsim.py,"# CostSim V2 API (M6 + M7 Memory Integration)\n""""""\nAPI endpoints for CostSim V2 sandbox.\n\nEndpoints:\n- POST /costsim/v2/simulate - Run V2 simulation (sandbox mode)\n- GET /costsim/v2/status - Get V2 sandbox status\n- POST /costsim/v2/reset - Reset circuit breaker\n- GET /costsim/divergence - Get divergence report\n- POST /costsim/canary/run - Trigger canary run\n- GET /costsim/canary/reports - Get canary reports\n\nM7 Enhancements:\n- Memory context injection for simulations\n- Post-execution memory updates via rules engine",\nAPI endpoints for CostSim V2 sandbox.\n\nEndpoints:\n- POST /costsim/v2/simulate - Run V2 simulation (sandbox mode)\n- GET /costsim/v2/status - Get V2 sandbox status\n- POST /costsim/v2/reset - Reset circuit breaker\n- GET /costsim/divergence - Get divergence report\n- POST /costsim/canary/run - Trigger canary run\n- GET /costsim/canary/reports - Get canary reports\n\nM7 Enhancements:\n- Memory context injection for simulations\n- Post-execution memory updates via rules engine\n- Drift detection between bas,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
74,app/api/cus_enforcement.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/cus_enforcement.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api (SDK, console)\n#   Execution: sync\n# Role: Enforcement policy API for customer LLM integrations\n# Callers: SDK (cus_enforcer.py), customer console\n# Allowed Imports: L4 (cus_enforcement_service), L6 (schemas)\n# Forbidden Imports: L1, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md Section 15\n\n""""""Customer LLM Enforcement API\n\nPURPOSE:\n    API endpoints for enforcement policy evaluation.","Customer LLM Enforcement API\n\nPURPOSE:\n    API endpoints for enforcement policy evaluation.\n    SDK calls these endpoints before making LLM calls.\n\nENDPOINTS:\n    POST   /enforcement/check    - Pre-flight enforcement check\n    GET    /enforcement/status   - Get current limits and usage\n    POST   /enforcement/batch    - Batch pre-flight checks\n\nSEMANTIC:\n    - Tenant-isolated: All operations scoped to authenticated tenant\n    - Read-only: These endpoints evaluate policies, they don't change them",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
75,app/api/cus_telemetry.py,CUSTOMER,integrations,L2,app/houseofcards/api/customer/integrations/cus_telemetry.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api (SDK calls)\n#   Execution: sync\n# Role: Telemetry ingestion API for customer LLM usage\n# Callers: SDK cus_reporter.py, external integrations\n# Allowed Imports: L4 (cus_telemetry_service), L6 (schemas)\n# Forbidden Imports: L1, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md\n\n""""""Customer LLM Telemetry Ingestion API\n\nPURPOSE:\n    Receives telemetry data from customer SDKs reporting LLM usage.",Customer LLM Telemetry Ingestion API\n\nPURPOSE:\n    Receives telemetry data from customer SDKs reporting LLM usage.\n    This is the DATA PLANE ingestion surface - it records facts about\n    what happened during LLM calls.\n\nENDPOINTS:\n    POST /telemetry/llm-usage     - Single call telemetry\n    POST /telemetry/llm-usage/batch - Batch telemetry (up to 100 records)\n    GET  /telemetry/usage-summary  - Usage summary for dashboard\n\nSEMANTIC:\n    - Append-only: Telemetry records are never updated or d,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
76,app/api/customer_visibility.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/customer_visibility.py,"# Layer: L2a — Product API (Console-scoped)\n# Product: AI Console\n# Auth: verify_api_key\n# Reference: PIN-240\n# NOTE: Part of Phase 4C-2 contract framework.\n\n""""""Phase 4C-2: Customer Visibility Endpoints\n\nCustomer-facing endpoints for predictability and accountability.\n\nRules:\n- Show effects, not mechanics\n- No decision records exposed\n- No governance internals\n- Predictability before execution","Phase 4C-2: Customer Visibility Endpoints\n\nCustomer-facing endpoints for predictability and accountability.\n\nRules:\n- Show effects, not mechanics\n- No decision records exposed\n- No governance internals\n- Predictability before execution\n- Accountability after execution\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
77,app/api/datasources.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/datasources.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified DATASOURCES facade - L2 API for data source operations\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-113 (Data Sources API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for DATASOURCES domain.\n# All data source flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nDataSources API (L2)\n\nProvides data source operations:\n- POST /api/v1/datasources (create source)\n- GET /api/v1/datasources (list sources)\n- GET /api/v1/datasources/{id} (get source)\n- PUT /api/v1/datasources/{id} (update source)\n- DELETE /api/v1/datasources/{id} (delete source)\n- POST /api/v1/datasources/{id}/test (test connection)\n- POST /api/v1/datasources/{id}/activate (activate source)\n- POST /api/v1/datasources/{id}/deactivate (deactivate source)\n- GET /api/v1/datasources/stats (statistic,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
78,app/api/debug_auth.py,CUSTOMER,general,L2,app/houseofcards/api/customer/general/debug_auth.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Debug endpoint for auth context visibility\n# Callers: Developers, debugging tools\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: AUTHORITY_CONTRACT.md (Section: Debug Endpoints)\n\n""""""\nDebug Auth Context Endpoint\n\nProvides visibility into the current authentication state.",\nDebug Auth Context Endpoint\n\nProvides visibility into the current authentication state.\nThis endpoint is for DEBUGGING only — never expose in production without auth.\n\nAuthority Contract (AUTH_AUTHORITY.md):\n- This endpoint reveals the interpreted auth context\n- Shows which auth plane was selected (HUMAN vs MACHINE)\n- Shows tenant state as derived (not cached)\n- Helps diagnose auth failures without guessing\n\nSECURITY NOTE:\n- This endpoint should be protected behind auth\n- Do not return sensitiv,,NEEDS_CLASSIFICATION,ITERATION_1,API route; Domain uncertain,TRANSFER
79,app/api/dependencies/__init__.py,INTERNAL,agent,L2,app/houseofcards/api/internal/agent/__init__.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: FastAPI dependency injection utilities\n# Callers: API route handlers\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n\n""""""API Dependencies Module.""""""\n\nfrom .founder_auth import require_founder, verify_fops_token\n\n__all__ = [""require_founder"", ""verify_fops_token""]",API Dependencies Module.,,NEEDS_CLASSIFICATION,ITERATION_1,API route in subdir,TRANSFER
80,app/api/dependencies/founder_auth.py,INTERNAL,general,L2,app/houseofcards/api/internal/general/founder_auth.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Founder (FOPS) authentication dependency\n# Callers: Founder-only route handlers\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-398 (Founder Auth Architecture)\n\n""""""\nFounder Authentication Dependency\n\nThis module provides the FastAPI dependency for founder-only routes.","\nFounder Authentication Dependency\n\nThis module provides the FastAPI dependency for founder-only routes.\nType-based authority: if auth_context is FounderAuthContext, access is granted.\n\nINVARIANTS:\n- No attribute checks (is_founder, roles, etc.)\n- No permission checks\n- Type is authority\n- All other context types are REJECTED\n\nUsage:\n    @router.get(""/admin/action"")\n    async def admin_action(\n        founder: FounderAuthContext = Depends(verify_fops_token)\n    ):\n        # Only founders reach h",,NEEDS_CLASSIFICATION,ITERATION_1,API route in subdir; Domain uncertain,TRANSFER
81,app/api/detection.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/detection.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified DETECTION facade - L2 API for anomaly detection operations\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-102 (Anomaly Detection API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for DETECTION domain.\n# All anomaly detection data flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nDetection API (L2)\n\nProvides anomaly detection operations:\n- POST /api/v1/detection/run (run detection on demand)\n- GET /api/v1/detection/anomalies (list anomalies)\n- GET /api/v1/detection/anomalies/{id} (get anomaly)\n- POST /api/v1/detection/anomalies/{id}/resolve (resolve anomaly)\n- POST /api/v1/detection/anomalies/{id}/acknowledge (acknowledge anomaly)\n- GET /api/v1/detection/status (detection engine status)\n\nThis is the ONLY facade for anomaly detection operations.\nAll detection APIs flow t,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
82,app/api/discovery.py,CUSTOMER,agent,L2,app/houseofcards/api/customer/agent/discovery.py,"""""""\nDiscovery Ledger API - Founder Console endpoint.\n\nRead-only access to discovery signals.\nFounder/dev only - not customer facing.\n\nReference: docs/contracts/visibility_lifecycle.yaml\n""""""\n\nfrom typing import Optional\n\nfrom fastapi import APIRouter, Query\n\nfrom app.discovery.ledger import get_signals\nfrom app.schemas.response import wrap_dict",\nDiscovery Ledger API - Founder Console endpoint.\n\nRead-only access to discovery signals.\nFounder/dev only - not customer facing.\n\nReference: docs/contracts/visibility_lifecycle.yaml\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
83,app/api/embedding.py,CUSTOMER,api_keys,L2,app/houseofcards/api/customer/api_keys/embedding.py,"# Embedding API Endpoints\n""""""\nAPI endpoints for embedding operations and quota management.\nPIN-047: P2 - Quota Status API Endpoint\nPIN-082: IAEC v3.0 - Instruction-Aware Embedding Composer\n""""""\n\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, List, Optional\n\nfrom fastapi import APIRouter, Depends\nfrom pydantic import BaseModel\n\nfrom ..auth import verify_api_key\nfrom ..schemas.response import wrap_dict",\nAPI endpoints for embedding operations and quota management.\nPIN-047: P2 - Quota Status API Endpoint\nPIN-082: IAEC v3.0 - Instruction-Aware Embedding Composer\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
84,app/api/evidence.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/evidence.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified EVIDENCE facade - L2 API for evidence chain and export\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-104 (Evidence Chain API), GAP-105 (Evidence Export API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for EVIDENCE domain.\n# All evidence chain and export flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nEvidence API (L2)\n\nProvides evidence chain and export operations:\n- GET /api/v1/evidence/chains (list chains)\n- POST /api/v1/evidence/chains (create chain)\n- GET /api/v1/evidence/chains/{id} (get chain)\n- POST /api/v1/evidence/chains/{id}/evidence (add evidence)\n- GET /api/v1/evidence/chains/{id}/verify (verify chain)\n- POST /api/v1/evidence/export (create export)\n- GET /api/v1/evidence/exports (list exports)\n- GET /api/v1/evidence/exports/{id} (get export)\n\nThis is the ONLY facade for evidence,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
85,app/api/feedback.py,CUSTOMER,analytics,L2,app/houseofcards/api/customer/analytics/feedback.py,"""""""\nPB-S3 Pattern Feedback API (READ-ONLY)\n\nExposes pattern_feedback data for observability without modification.\n\nPB-S3 Contract:\n- Feedback observes but never mutates\n- Provenance references runs (read-only)\n- No execution data modification allowed\n\nREAD_ONLY = True\n\nO1: API endpoint exists ✓\nO2: List visible with pagination ✓\nO3: Detail accessible ✓",\nPB-S3 Pattern Feedback API (READ-ONLY)\n\nExposes pattern_feedback data for observability without modification.\n\nPB-S3 Contract:\n- Feedback observes but never mutates\n- Provenance references runs (read-only)\n- No execution data modification allowed\n\nREAD_ONLY = True\n\nO1: API endpoint exists ✓\nO2: List visible with pagination ✓\nO3: Detail accessible ✓\nO4: Execution unchanged ✓ (no POST/PUT/DELETE)\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
86,app/api/founder_actions.py,FOUNDER,ops,L2,app/houseofcards/api/founder/ops/founder_actions.py,"""""""Founder Actions API - M29 Category 6\n\nPIN-151: M29 Categories 4-6 - Founder Action Paths\n\nThis router provides endpoints for founder actions on the Ops Console.\nAll actions are audited, rate-limited, and require MFA verification.\n\nEndpoints:\n- POST /ops/actions/freeze-tenant     - Immediately block all API calls for tenant\n- POST /ops/actions/throttle-tenant   - Reduce tenant rate limit to 10% of normal\n- POST /ops/actions/freeze-api-key    - Immediately revoke specific API key\n- POST /ops/actions/override-incident - Mark incident as false positive\n\nReversal Endpoints:\n- POST /ops/actions/unfreeze-tenant   - Restore tenant access","Founder Actions API - M29 Category 6\n\nPIN-151: M29 Categories 4-6 - Founder Action Paths\n\nThis router provides endpoints for founder actions on the Ops Console.\nAll actions are audited, rate-limited, and require MFA verification.\n\nEndpoints:\n- POST /ops/actions/freeze-tenant     - Immediately block all API calls for tenant\n- POST /ops/actions/throttle-tenant   - Reduce tenant rate limit to 10% of normal\n- POST /ops/actions/freeze-api-key    - Immediately revoke specific API key\n- POST /ops/actio",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
87,app/api/founder_contract_review.py,FOUNDER,agent,L2,app/houseofcards/api/founder/agent/founder_contract_review.py,"# Layer: L2 — Product APIs\n# AUDIENCE: INTERNAL\n# Product: founder-console (fops.agenticverz.com)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Founder Review API - contract approval/rejection gate\n# Callers: Founder Console (frontend)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-293, PART2_CRM_WORKFLOW_CHARTER.md, part2-design-v1\n\n""""""\nFounder Review API (L2)\n",\nFounder Review API (L2)\n\nProvides Founder-only endpoints for contract review.\nThis is the LAST human authority insertion point in the governance workflow.\n\nEndpoints:\n  GET  /founder/contracts/review-queue       - List ELIGIBLE contracts\n  GET  /founder/contracts/{contract_id}      - Get contract details\n  POST /founder/contracts/{contract_id}/review - Submit APPROVE or REJECT\n\nAudience: FOUNDER ONLY\nSecurity: Requires Founder authentication\n\nHARD RULES (from PART2_CRM_WORKFLOW_CHARTER.md):\n- L,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
88,app/api/founder_explorer.py,FOUNDER,account,L2,app/houseofcards/api/founder/account/founder_explorer.py,"# Layer: L2 — Product APIs\n# Product: founder-console\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: H3 Founder Exploratory Mode - Cross-tenant insights (READ-ONLY)\n# Callers: founder console UI\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L5\n# Reference: Phase H3 - Founder Console Exploratory Mode\n""""""\nFounder Exploratory Mode API (H3)\n\nCross-tenant summary and deep diagnostics for founders.\n",\nFounder Exploratory Mode API (H3)\n\nCross-tenant summary and deep diagnostics for founders.\n\nINVARIANTS:\n- FOUNDER ONLY - must NOT expose to customer\n- READ-ONLY - no mutation flows\n- No impersonation or write actions\n- No approval or escalation flows\n- Cross-tenant data for business learning\n\nEndpoints:\n- GET /explorer/summary - Cross-tenant system summary\n- GET /explorer/tenants - List all tenants with metrics\n- GET /explorer/tenant/{tenant_id}/diagnostics - Deep diagnostics for a tenant\n- GET,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
89,app/api/founder_lifecycle.py,FOUNDER,account,L2,app/houseofcards/api/founder/account/founder_lifecycle.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: request\n#   Execution: sync\n# Role: Phase-9 Founder Lifecycle Endpoints\n# Callers: Founder Console\n# Allowed Imports: L4 (lifecycle, onboarding_state)\n# Forbidden Imports: L1, L5, L6\n# Reference: PIN-400 Phase-9 (Offboarding & Tenant Lifecycle)\n\n""""""\nPhase-9 Founder Lifecycle Endpoints\n\nFounder-only endpoints for tenant lifecycle management.","\nPhase-9 Founder Lifecycle Endpoints\n\nFounder-only endpoints for tenant lifecycle management.\n\nOFFBOARD-004: No customer-initiated offboarding mutations.\nOnly founders can trigger lifecycle transitions (suspend, resume, terminate).\n\nDESIGN NOTES:\n- These endpoints are founder-only (require founder role)\n- All transitions are audited via observability\n- No auto-actions (system triggers deferred to future phase)\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
90,app/api/founder_onboarding.py,FOUNDER,incidents,L2,app/houseofcards/api/founder/incidents/founder_onboarding.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async\n# Role: Founder-only onboarding recovery actions\n# Callers: fops.com (Founder Console)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-399 Phase-4 (Onboarding Failure & Recovery Semantics)\n\n""""""\nFounder Onboarding Actions API\n\nPIN-399 Phase-4: Provides founder-only recovery actions for onboarding.","\nFounder Onboarding Actions API\n\nPIN-399 Phase-4: Provides founder-only recovery actions for onboarding.\n\nThis API surfaces ONE mutation endpoint:\n- POST /founder/onboarding/force-complete\n\nDESIGN INVARIANTS (Phase-4 Locked):\n- ONBOARD-003: Transitions are monotonic (no backward, ever)\n- Recovery is forward-only (force-complete is the only mutation)\n- Every action is audited (no audit → action fails)\n- Founder-only (customer consoles cannot access)\n- Explicit justification required\n\nWHAT THIS DO",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
91,app/api/founder_review.py,FOUNDER,logs,L2,app/houseofcards/api/founder/logs/founder_review.py,"# Layer: L2 — Product APIs\n# Product: founder-console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Founder AUTO_EXECUTE Review Endpoints (Evidence-Only)\n# Callers: Founder Console UI\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-333\n\n""""""\nFounder AUTO_EXECUTE Review API - PIN-333\n\nEvidence-only endpoints for reviewing SUB-019 auto-execution decisions.",\nFounder AUTO_EXECUTE Review API - PIN-333\n\nEvidence-only endpoints for reviewing SUB-019 auto-execution decisions.\n\nCRITICAL CONSTRAINTS:\n- READ-ONLY: No mutation endpoints\n- EVIDENCE-ONLY: Data comes from ExecutionEnvelope + SafetyFlags\n- FOUNDER-ONLY: Requires FOPS token with founder role\n- NO CONTROL: Does NOT approve/reject/pause/override anything\n- NO BEHAVIOR CHANGE: AUTO_EXECUTE behavior is unchanged\n\nIf any code in this file implies control → VIOLATION of PIN-333.\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
92,app/api/founder_timeline.py,FOUNDER,logs,L2,app/houseofcards/api/founder/logs/founder_timeline.py,"""""""Phase 4C-1: Founder Timeline View\n\nRaw, chronological consumption of decision records.\n\nRules:\n- Chronological order only\n- No grouping\n- No collapsing\n- No ""status pills""\n- No interpretation\n\nThis is a court transcript, not a dashboard.\n""""""\n\nimport logging","Phase 4C-1: Founder Timeline View\n\nRaw, chronological consumption of decision records.\n\nRules:\n- Chronological order only\n- No grouping\n- No collapsing\n- No ""status pills""\n- No interpretation\n\nThis is a court transcript, not a dashboard.\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
93,app/api/governance.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/governance.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Unified GOVERNANCE facade - L2 API for governance control operations\n# Callers: Ops Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-090, GAP-091, GAP-092, GAP-095\n# GOVERNANCE NOTE:\n# This is the ONE facade for GOVERNANCE domain.\n# All governance control data flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nGovernance API (L2)\n\nProvides governance control operations:\n- POST /api/v1/governance/kill-switch (GAP-090)\n- POST /api/v1/governance/mode (GAP-091)\n- POST /api/v1/governance/resolve-conflict (GAP-092)\n- GET /api/v1/governance/boot-status (GAP-095)\n- GET /api/v1/governance/state\n\nThis is the ONLY facade for governance control operations.\nAll governance APIs flow through this router.\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
94,app/api/guard.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/guard.py,"# Layer: L2a — Product API (Console-scoped)\n# Product: AI Console\n# Auth: verify_console_token (aud=console)\n# Reference: PIN-240\n# NOTE: Workers NEVER call this. SDK NEVER imports this.\n\n""""""Guard API - Customer Console Backend\n\nThis router provides endpoints for the Customer Console (guard.agenticverz.com).\nFocused on TRUST and CONTROL - customers can see what's protecting them and stop it if needed.\n\nEndpoints:\n- GET  /guard/status          - Protection status (am I safe?)\n- GET  /guard/snapshot/today  - Today's metrics\n- POST /guard/killswitch/activate   - Stop all traffic",Guard API - Customer Console Backend\n\nThis router provides endpoints for the Customer Console (guard.agenticverz.com).\nFocused on TRUST and CONTROL - customers can see what's protecting them and stop it if needed.\n\nEndpoints:\n- GET  /guard/status          - Protection status (am I safe?)\n- GET  /guard/snapshot/today  - Today's metrics\n- POST /guard/killswitch/activate   - Stop all traffic\n- POST /guard/killswitch/deactivate - Resume traffic\n- GET  /guard/incidents       - List incidents\n- GET  /,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
95,app/api/guard_logs.py,CUSTOMER,logs,L2,app/houseofcards/api/customer/logs/guard_logs.py,"# Layer: L2a — Boundary Adapter (Console-scoped, DEPRECATED)\n# Product: AI Console (Customer Console)\n# Auth: verify_console_token (aud=console)\n# Reference: PIN-280, PIN-281 (L2 Promotion Governance)\n# NOTE: Workers NEVER call this. SDK NEVER imports this.\n#\n# GOVERNANCE NOTE (LOGS Domain V2):\n# This adapter is DEPRECATED in favor of the unified LOGS facade.\n# The canonical facade is /api/v1/logs/* (logs.py).\n# This adapter remains for backward compatibility with /guard/logs/* routes.\n# New console features should use /api/v1/logs/llm-runs/* instead.\n# Migration path: PIN-TBD (consolidate to unified facade)\n\n""""""Guard Logs API - Customer Console Logs Endpoint\n",Guard Logs API - Customer Console Logs Endpoint\n\nThis router provides endpoints for the Customer Console (guard.agenticverz.com).\nFocused on LOG VISIBILITY - customers can see their execution audit trail.\n\nEndpoints:\n- GET  /guard/logs          - List customer logs (execution audit trail)\n- GET  /guard/logs/export   - Export logs (JSON or CSV)\n- GET  /guard/logs/{id}     - Log detail with steps\n\nPIN-281 Promotion:\n- L4→L3: customer_logs_adapter.py (boundary adapter)\n- L3→L2: This file (API route,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
96,app/api/guard_policies.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/guard_policies.py,"# Layer: L2a — Product API (Console-scoped)\n# Product: AI Console (Customer Console)\n# Auth: verify_console_token (aud=console)\n# Reference: PIN-280, PIN-281 (L2 Promotion Governance)\n# NOTE: Workers NEVER call this. SDK NEVER imports this.\n\n""""""Guard Policies API - Customer Console Policy Constraints Endpoint\n\nThis router provides endpoints for the Customer Console (guard.agenticverz.com).\nFocused on POLICY VISIBILITY - customers can see their constraints and limits.\n\nEndpoints:\n- GET  /guard/policies          - Policy constraints summary\n- GET  /guard/policies/guardrails/{id}  - Guardrail detail\n",Guard Policies API - Customer Console Policy Constraints Endpoint\n\nThis router provides endpoints for the Customer Console (guard.agenticverz.com).\nFocused on POLICY VISIBILITY - customers can see their constraints and limits.\n\nEndpoints:\n- GET  /guard/policies          - Policy constraints summary\n- GET  /guard/policies/guardrails/{id}  - Guardrail detail\n\nPIN-281 Promotion:\n- L4→L3: customer_policies_adapter.py (boundary adapter)\n- L3→L2: This file (API route)\n\nRule: One adapter per route. No ,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
97,app/api/health.py,CUSTOMER,general,L2,app/houseofcards/api/customer/general/health.py,"# Layer: L2 — Product APIs\n# AUDIENCE: INTERNAL\n# Role: Health and determinism status endpoints - operational visibility\n""""""\nHealth and Determinism Status Endpoints\n\nProvides operational visibility into:\n- Service health\n- Determinism status (last replay hash)\n- Adapter availability\n- Registry state\n""""""\n\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict",\nHealth and Determinism Status Endpoints\n\nProvides operational visibility into:\n- Service health\n- Determinism status (last replay hash)\n- Adapter availability\n- Registry state\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route; Domain uncertain,TRANSFER
98,app/api/incidents.py,CUSTOMER,incidents,L2,app/houseofcards/api/customer/incidents/incidents.py,"# Layer: L2 — Product APIs\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Unified INCIDENTS domain facade - customer-only production API\n# Callers: Customer Console frontend, SDSR validation (same API)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: INCIDENTS Domain - One Facade Architecture\n# Reference: docs/architecture/incidents/INCIDENTS_DOMAIN_SQL.md\n#\n# GOVERNANCE NOTE:\n# This is the ONE facade for INCIDENTS domain.\n# All incident data flows through this API.",\nUnified Incidents API (L2)\n\nCustomer-facing endpoints for viewing incidents.\nAll requests are tenant-scoped via auth_context.\n\nEndpoints:\n- GET /api/v1/incidents                        → O2 list with filters\n- GET /api/v1/incidents/{incident_id}          → O3 detail\n- GET /api/v1/incidents/{incident_id}/evidence → O4 context (preflight)\n- GET /api/v1/incidents/{incident_id}/proof    → O5 raw (preflight)\n- GET /api/v1/incidents/{incident_id}/learnings → O4 post-mortem learnings\n- GET /api/v1/inc,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
99,app/api/legacy_routes.py,DEPRECATED,deprecated,N/A,,"""""""M29 Category 7: Legacy Route Handlers\n\nThis module returns 410 Gone for deprecated routes that have been\npermanently removed from the API. This prevents:\n1. Confusion when legacy paths silently fail\n2. Clients relying on deprecated endpoints\n3. Security issues from undocumented paths\n\nForbidden paths return 410 Gone with explanatory message.\nThese are NOT redirects (301/302) - the old paths are dead.\n\nPIN-153: M29 Category 7 - Redirect Expiry & Cleanup\n""""""\n\nfrom fastapi import APIRouter",M29 Category 7: Legacy Route Handlers\n\nThis module returns 410 Gone for deprecated routes that have been\npermanently removed from the API. This prevents:\n1. Confusion when legacy paths silently fail\n2. Clients relying on deprecated endpoints\n3. Security issues from undocumented paths\n\nForbidden paths return 410 Gone with explanatory message.\nThese are NOT redirects (301/302) - the old paths are dead.\n\nPIN-153: M29 Category 7 - Redirect Expiry & Cleanup\n,,DEPRECATED_DUPLICATE,ITERATION_1,Deprecated duplicate file,DELETE
100,app/api/lifecycle.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/lifecycle.py,"# Layer: L2 — Product APIs\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified LIFECYCLE facade - L2 API for lifecycle operations\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-131 to GAP-136 (Lifecycle APIs)\n# GOVERNANCE NOTE:\n# This is the ONE facade for LIFECYCLE domain.\n# All lifecycle flows through this API.",\nLifecycle API (L2)\n\nProvides lifecycle operations:\n- POST /api/v1/lifecycle/agents (create agent)\n- GET /api/v1/lifecycle/agents (list agents)\n- GET /api/v1/lifecycle/agents/{id} (get agent)\n- POST /api/v1/lifecycle/agents/{id}/start (start agent)\n- POST /api/v1/lifecycle/agents/{id}/stop (stop agent)\n- POST /api/v1/lifecycle/agents/{id}/terminate (terminate agent)\n- POST /api/v1/lifecycle/runs (create run)\n- GET /api/v1/lifecycle/runs (list runs)\n- GET /api/v1/lifecycle/runs/{id} (get run)\n- P,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
101,app/api/limits/__init__.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/__init__.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limits API package (PIN-LIM)\n# Callers: main.py router registration\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: LIMITS_MANAGEMENT_AUDIT.md\n\n""""""\nLimits API Package\n\nProvides endpoints for:",\nLimits API Package\n\nProvides endpoints for:\n- Limit simulation (pre-execution checks)\n- Limit overrides (temporary increases)\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route in subdir,TRANSFER
102,app/api/limits/override.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/override.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limit override endpoint (PIN-LIM-05)\n# Callers: Customer Console, Ops Console\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-LIM-05\n\n""""""\nLimit Override API (PIN-LIM-05)\n\nTemporary limit override request endpoints.","\nLimit Override API (PIN-LIM-05)\n\nTemporary limit override request endpoints.\n\nAllows authorized users to request temporary increases to limits,\nwith approval workflow and automatic expiry.\n\nEndpoints:\n    POST /api/v1/limits/overrides         → Request new override\n    GET  /api/v1/limits/overrides         → List overrides for tenant\n    GET  /api/v1/limits/overrides/{id}    → Get specific override\n    DELETE /api/v1/limits/overrides/{id}  → Cancel override\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route in subdir,TRANSFER
103,app/api/limits/simulate.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/simulate.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limit simulation endpoint (PIN-LIM-04)\n# Callers: SDK, Worker runtime, Customer Console\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-LIM-04\n\n""""""\nLimit Simulation API (PIN-LIM-04)\n\nPre-execution limit check endpoint.",\nLimit Simulation API (PIN-LIM-04)\n\nPre-execution limit check endpoint.\n\nAllows callers to test whether an execution would be permitted\nbefore actually running it.\n\nEndpoint:\n    POST /api/v1/limits/simulate\n\nReturns:\n    - decision: ALLOW | BLOCK | WARN\n    - blocking_limit_id (if blocked)\n    - headroom (remaining capacity)\n    - warnings (soft limit warnings)\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route in subdir,TRANSFER
104,app/api/logs.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/logs.py,"# Layer: L2 — Product APIs\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Unified LOGS domain facade - LOGS Domain V2 Implementation\n# Callers: Customer Console frontend, SDSR validation (same API)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: LOGS_DOMAIN_V2_CONTRACT.md\n#\n# GOVERNANCE NOTE:\n# This is the ONE facade for LOGS domain.\n# All log data (audit, LLM runs, system) flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.","\nUnified Logs API (L2) - LOGS Domain V2\n\nCustomer-facing endpoints for viewing logs: audit ledger, LLM run records, and system records.\nAll requests are tenant-scoped via auth_context.\n\nTopics & O-Levels (per LOGS_DOMAIN_V2_CONTRACT.md):\n\nLLM_RUNS:\n- GET /logs/llm-runs                          → List runs\n- GET /logs/llm-runs/{run_id}/envelope        → O1 canonical record\n- GET /logs/llm-runs/{run_id}/trace           → O2 step-by-step trace\n- GET /logs/llm-runs/{run_id}/governance      → O3 poli",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
105,app/api/memory_pins.py,CUSTOMER,account,L2,app/houseofcards/api/customer/account/memory_pins.py,"""""""\nMemory Pins API - M7 Implementation\n\nProvides REST API for managing memory pins (structured key-value storage).\n\nFeatures:\n- Tenant-isolated storage\n- JSONB values for flexible schema\n- Optional TTL for expiring entries\n- RBAC enforcement (when enabled)\n- Prometheus metrics\n\nEndpoints:\n- POST /api/v1/memory/pins - Create or upsert a pin\n- GET /api/v1/memory/pins/{key} - Get a pin by key",\nMemory Pins API - M7 Implementation\n\nProvides REST API for managing memory pins (structured key-value storage).\n\nFeatures:\n- Tenant-isolated storage\n- JSONB values for flexible schema\n- Optional TTL for expiring entries\n- RBAC enforcement (when enabled)\n- Prometheus metrics\n\nEndpoints:\n- POST /api/v1/memory/pins - Create or upsert a pin\n- GET /api/v1/memory/pins/{key} - Get a pin by key\n- GET /api/v1/memory/pins - List pins for tenant\n- DELETE /api/v1/memory/pins/{key} - Delete a pin\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
106,app/api/middleware/__init__.py,INTERNAL,logs,L2,app/houseofcards/api/internal/logs/__init__.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: request\n#   Execution: sync\n# Role: Runtime gate middleware exports\n# Reference: PIN-401 Track A (Production Wiring)\n\n""""""\nRuntime Gate Middleware\n\nTrack A production wiring - enforcement of Phase 6-9 at request boundaries.\n\nGates enforce existing provider decisions without adding new logic:\n- Lifecycle Gate: Blocks SDK execution for non-ACTIVE tenants",\nRuntime Gate Middleware\n\nTrack A production wiring - enforcement of Phase 6-9 at request boundaries.\n\nGates enforce existing provider decisions without adding new logic:\n- Lifecycle Gate: Blocks SDK execution for non-ACTIVE tenants\n- Protection Gate: Applies rate limits and abuse protection\n- Billing Gate: Enforces plan limits at execution boundaries\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route in subdir,TRANSFER
107,app/api/middleware/billing_gate.py,INTERNAL,policies,L2,app/houseofcards/api/internal/policies/billing_gate.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: request\n#   Execution: sync\n# Role: Billing enforcement gate\n# Callers: FastAPI middleware, route dependencies\n# Allowed Imports: L4 (billing provider, state, limits)\n# Forbidden Imports: L1, L5, L6\n# Reference: PIN-401 Track A (Production Wiring)\n\n""""""\nBilling Gate Middleware\n\nEnforces billing state and limits at request boundaries.",\nBilling Gate Middleware\n\nEnforces billing state and limits at request boundaries.\n\nDESIGN RULES:\n- Pure wiring - no new billing logic\n- Calls existing provider methods\n- Respects BILLING-001 (never blocks onboarding)\n- Respects BILLING-003 (doesn't affect roles)\n\nENFORCEMENT SURFACE:\n- SDK execution paths (usage counting)\n- Resource creation endpoints\n\nEXEMPT PATHS:\n- Health/metrics\n- Auth endpoints\n- Founder endpoints\n- Onboarding endpoints (BILLING-001)\n- Docs\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route in subdir,TRANSFER
108,app/api/middleware/lifecycle_gate.py,INTERNAL,account,L4,app/houseofcards/internal/account/engines/lifecycle_gate.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: request\n#   Execution: sync\n# Role: Lifecycle enforcement gate\n# Callers: FastAPI middleware, route dependencies\n# Allowed Imports: L4 (lifecycle_provider, tenant_lifecycle)\n# Forbidden Imports: L1, L5, L6\n# Reference: PIN-401 Track A (Production Wiring)\n\n""""""\nLifecycle Gate Middleware\n\nEnforces TenantLifecycleState at request boundaries.","\nLifecycle Gate Middleware\n\nEnforces TenantLifecycleState at request boundaries.\n\nDESIGN RULES:\n- Pure wiring - no new states or logic\n- Calls existing provider methods\n- Non-blocking for observability (OBSERVE-004)\n- Respects OFFBOARD invariants\n\nENFORCEMENT SURFACE:\n- SDK execution paths (/api/v1/runs, /api/v1/runtime/*)\n- Write operations (POST, PUT, PATCH, DELETE)\n- Token refresh endpoints\n\nEXEMPT PATHS:\n- Health/metrics\n- Auth endpoints\n- Founder endpoints (self-service)\n- Docs\n",,NEEDS_CLASSIFICATION,ITERATION_1,Lifecycle management,TRANSFER
109,app/api/middleware/protection_gate.py,INTERNAL,general,L2,app/houseofcards/api/internal/general/protection_gate.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: request\n#   Execution: sync\n# Role: Protection enforcement gate\n# Callers: FastAPI middleware, route dependencies\n# Allowed Imports: L4 (protection provider, decisions)\n# Forbidden Imports: L1, L5, L6\n# Reference: PIN-401 Track A (Production Wiring)\n\n""""""\nProtection Gate Middleware\n\nApplies AbuseProtectionProvider decisions at request boundaries.",\nProtection Gate Middleware\n\nApplies AbuseProtectionProvider decisions at request boundaries.\n\nDESIGN RULES:\n- Pure wiring - no new protection logic\n- Calls existing provider.check_all()\n- Non-blocking for anomaly signals (ABUSE-003)\n- Respects all ABUSE invariants\n\nENFORCEMENT SURFACE:\n- SDK execution paths\n- Runtime endpoints\n- Write operations\n\nEXEMPT PATHS:\n- Health/metrics\n- Auth endpoints\n- Founder endpoints\n- Docs\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route in subdir; Domain uncertain,TRANSFER
110,app/api/monitors.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/monitors.py,"# Layer: L2 — Product APIs\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified MONITORS facade - L2 API for monitoring operations\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-120 (Health Check API), GAP-121 (Monitor Configuration API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for MONITORS domain.\n# All monitoring flows through this API.",\nMonitors API (L2)\n\nProvides monitoring operations:\n- POST /api/v1/monitors (create monitor)\n- GET /api/v1/monitors (list monitors)\n- GET /api/v1/monitors/{id} (get monitor)\n- PUT /api/v1/monitors/{id} (update monitor)\n- DELETE /api/v1/monitors/{id} (delete monitor)\n- POST /api/v1/monitors/{id}/check (run health check)\n- GET /api/v1/monitors/{id}/history (check history)\n- GET /api/v1/monitors/status (overall status)\n\nThis is the ONLY facade for monitoring operations.\nAll monitor APIs flow throug,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
111,app/api/notifications.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/notifications.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified NOTIFICATIONS facade - L2 API for notification operations\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-109 (Notification API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for NOTIFICATIONS domain.\n# All notification flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nNotifications API (L2)\n\nProvides notification operations:\n- POST /api/v1/notifications (send notification)\n- GET /api/v1/notifications (list notifications)\n- GET /api/v1/notifications/{id} (get notification)\n- POST /api/v1/notifications/{id}/read (mark as read)\n- GET /api/v1/notifications/channels (list channels)\n- GET /api/v1/notifications/preferences (get preferences)\n- PUT /api/v1/notifications/preferences (update preferences)\n\nThis is the ONLY facade for notification operations.\nAll notific,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
112,app/api/onboarding.py,CUSTOMER,agent,L2,app/houseofcards/api/customer/agent/onboarding.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async\n# Role: Onboarding status and progression endpoints\n# Callers: Console UI, SDK clients\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-399 (Onboarding State Machine v1)\n\n""""""\nOnboarding Status API\n\nPIN-399: Provides deterministic onboarding status for UI consumption.","\nOnboarding Status API\n\nPIN-399: Provides deterministic onboarding status for UI consumption.\n\nThis API surfaces:\n1. Current onboarding state\n2. Next required action (action_id only - console-agnostic)\n3. Blocked capabilities at current state (not routes)\n\nDESIGN INVARIANTS:\n- State is the sole authority (ONBOARD-001)\n- Instructions are deterministic, not guessed\n- No bypass, retry, or skip options exposed\n- Backend emits capabilities, consoles map to routes (CONSOLE-001)\n- No progress percentag",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
113,app/api/ops.py,FOUNDER,incidents,L2,app/houseofcards/api/founder/incidents/ops.py,"# Layer: L2 — Product APIs\n# AUDIENCE: INTERNAL\n# Role: Ops Console API - Founder Intelligence System for behavioral insights\n""""""Ops Console API - Founder Intelligence System\n\nPIN-105: Ops Console - Founder Intelligence System\n\nThis router provides endpoints for the Operator Console (ops.agenticverz.com).\nFocused on BEHAVIORAL TRUTH - answer founder questions without customer input.\n\nModules:\n1. System Pulse     - ""Is my business healthy right now?""\n2. Customer Intel   - ""Who is this customer and are they slipping?""\n2.5 At-Risk         - ""Who should I call today?"" (Phase-2)\n3. Incident Intel   - ""What is breaking and is it systemic?""","Ops Console API - Founder Intelligence System\n\nPIN-105: Ops Console - Founder Intelligence System\n\nThis router provides endpoints for the Operator Console (ops.agenticverz.com).\nFocused on BEHAVIORAL TRUTH - answer founder questions without customer input.\n\nModules:\n1. System Pulse     - ""Is my business healthy right now?""\n2. Customer Intel   - ""Who is this customer and are they slipping?""\n2.5 At-Risk         - ""Who should I call today?"" (Phase-2)\n3. Incident Intel   - ""What is breaking and is i",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
114,app/api/overview.py,CUSTOMER,overview,L2,app/houseofcards/api/customer/overview/overview.py,"# Layer: L2 — Product APIs\n# AUDIENCE: CUSTOMER\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Unified OVERVIEW domain facade - customer-only production API\n# Callers: Customer Console frontend, SDSR validation (same API)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: OVERVIEW Domain - One Facade Architecture, PIN-413\n#\n# GOVERNANCE NOTE:\n# This is the ONE facade for OVERVIEW domain.\n# All overview data flows through this API.","\nUnified Overview API (L2)\n\nCustomer-facing endpoints for system overview and health.\nAll requests are tenant-scoped via auth_context.\n\nEndpoints:\n- GET /api/v1/overview/highlights      → O1 system pulse & domain counts (Activity, Incidents, Policies)\n- GET /api/v1/overview/decisions       → O2 pending decisions queue\n- GET /api/v1/overview/decisions/count → O2 decisions count summary\n- GET /api/v1/overview/costs           → O2 cost intelligence summary\n- GET /api/v1/overview/recovery-stats  → O",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
115,app/api/platform.py,CUSTOMER,agent,L2,app/houseofcards/api/customer/agent/platform.py,"# Layer: L2 — Product APIs\n# Product: founder-console (fops.agenticverz.com)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Platform health and eligibility endpoints (Founder-only)\n# Callers: Founder Console (frontend)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-284 (Platform Monitoring System)\n\n""""""\nPlatform Health API (L2)\n\nProvides Founder-only endpoints for platform health monitoring.",\nPlatform Health API (L2)\n\nProvides Founder-only endpoints for platform health monitoring.\n\nEndpoints:\n  GET /platform/health          - System health overview\n  GET /platform/capabilities    - Capability eligibility list\n  GET /platform/domains/{name}  - Domain health detail\n  GET /platform/capabilities/{name} - Capability health detail\n\nAudience: FOUNDER ONLY (Ops Console)\nSecurity: Requires Founder authentication\n\nPIN-284 Rule: Governance > Observability > UI\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
116,app/api/policies.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/policies.py,"# Layer: L2 — Product APIs\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Unified POLICIES domain facade - customer-only production API\n# Callers: Customer Console frontend, SDSR validation (same API)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: POLICIES Domain - One Facade Architecture, PIN-412\n#\n# GOVERNANCE NOTE:\n# This is the ONE facade for POLICIES domain.\n# All policy rules and limits data flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.","\nUnified Policies API (L2)\n\nCustomer-facing endpoints for viewing policy rules and limits.\nAll requests are tenant-scoped via auth_context.\n\nEndpoints:\n- GET /api/v1/policies/rules           → O2 list of policy rules\n- GET /api/v1/policies/rules/{rule_id} → O3 rule detail\n- GET /api/v1/policies/limits          → O2 list of limits\n- GET /api/v1/policies/limits/{limit_id} → O3 limit detail\n\nArchitecture:\n- ONE facade for all POLICIES needs (rules + limits)\n- Queries PolicyRule, PolicyRuleIntegrity",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
117,app/api/policy.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/policy.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Policy sandbox evaluation and approval workflow management\n# Authority: WRITE ApprovalRequest, PolicyApprovalLevel records\n# Callers: External clients, SDK, Customer Console\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: M5 Policy System, PIN-158 Tier Gating, PIN-258 Phase F-3\n# Contract: PHASE_F_FIX_DESIGN (F-P-RULE-1 to F-P-RULE-5)\n#\n# GOVERNANCE NOTE (F-P-RULE-1):\n# This L2 module must ONLY call the L3 policy_adapter.",\nPolicy API Endpoints (M5)\n\nProvides:\n1. Policy sandbox evaluation (/api/v1/policy/eval)\n2. Approval workflow endpoints (/api/v1/policy/requests/*)\n3. Webhook callbacks for async approvals\n\nIntegrates with:\n- PolicyEnforcer from workflow/policies.py\n- PolicyApprovalLevel and ApprovalRequest from db.py\n- Workflow metrics for observability\n- CostSim V2 for simulation\n\nNOTE: Policy subsystem MUST use AsyncSession - async endpoints + M17/M19 routing.\n      Do NOT import sync Session from sqlmodel. S,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
118,app/api/policy_layer.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/policy_layer.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Policy Layer API - Constitutional governance for multi-agent systems\n# Callers: Customer Console, SDSR validation, agent runtime\n# Allowed Imports: L3, L4 (via facade), L6 (models only)\n# Forbidden Imports: L4 engine directly (use facade)\n# Reference: API-001 Guardrail (Domain Facade Required), M19 Policy Engine\n#\n# These endpoints allow agents and subsystems to:\n# 1. Evaluate proposed actions against policies\n# 2. Query policy state and violations\n# 3. Simulate policy evaluation for testing",Request to evaluate an action against policies.,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
119,app/api/policy_limits_crud.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/policy_limits_crud.py,"# Layer: L2 — Product APIs\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Policy limits mutating operations (PIN-LIM-01)\n# Callers: Customer Console frontend, Admin tools\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-LIM-01\n\n""""""\nPolicy Limits CRUD API (PIN-LIM-01)\n\nMutating endpoints for policy limits.",\nPolicy Limits CRUD API (PIN-LIM-01)\n\nMutating endpoints for policy limits.\n\nExtends the read-only policies.py facade with write operations.\n\nEndpoints:\n    POST   /api/v1/policies/limits              → Create limit\n    PUT    /api/v1/policies/limits/{limit_id}   → Update limit\n    DELETE /api/v1/policies/limits/{limit_id}   → Soft-delete limit\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
120,app/api/policy_proposals.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/policy_proposals.py,"""""""\nPB-S4 Policy Proposals API\n\nExposes policy_proposals and policy_versions data with human-controlled approval.\n\nPB-S4 Contract:\n- Policies are proposed, never auto-enforced\n- Human approval is mandatory\n- Proposals have provenance to triggering feedback\n- Rejection preserved for audit trail\n\nO1: API endpoint exists ✓\nO2: List visible with pagination ✓\nO3: Detail accessible ✓\nO4: Approve/Reject actions (human-controlled) ✓ (PIN-373)","\nPB-S4 Policy Proposals API\n\nExposes policy_proposals and policy_versions data with human-controlled approval.\n\nPB-S4 Contract:\n- Policies are proposed, never auto-enforced\n- Human approval is mandatory\n- Proposals have provenance to triggering feedback\n- Rejection preserved for audit trail\n\nO1: API endpoint exists ✓\nO2: List visible with pagination ✓\nO3: Detail accessible ✓\nO4: Approve/Reject actions (human-controlled) ✓ (PIN-373)\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
121,app/api/policy_rules_crud.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/policy_rules_crud.py,"# Layer: L2 — Product APIs\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async (request-response)\n# Role: Policy rules mutating operations (PIN-LIM-02)\n# Callers: Customer Console frontend, Admin tools\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-LIM-02\n\n""""""\nPolicy Rules CRUD API (PIN-LIM-02)\n\nMutating endpoints for policy rules.",\nPolicy Rules CRUD API (PIN-LIM-02)\n\nMutating endpoints for policy rules.\n\nExtends the read-only policies.py facade with write operations.\n\nEndpoints:\n    POST /api/v1/policies/rules              → Create rule\n    PUT  /api/v1/policies/rules/{rule_id}    → Update rule\n\nRules are never deleted - they are retired with reason.\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
122,app/api/predictions.py,CUSTOMER,analytics,L2,app/houseofcards/api/customer/analytics/predictions.py,"""""""\nPB-S5 Predictions API (READ-ONLY)\n\nExposes prediction_events data for observability without modification.\n\nPB-S5 Contract:\n- Predictions are advisory only\n- Predictions have zero side-effects\n- Predictions never modify execution, scheduling, or history\n- Rule: Advise, don't influence\n\nREAD_ONLY = True\n\nO1: API endpoint exists ✓\nO2: List visible with pagination ✓","\nPB-S5 Predictions API (READ-ONLY)\n\nExposes prediction_events data for observability without modification.\n\nPB-S5 Contract:\n- Predictions are advisory only\n- Predictions have zero side-effects\n- Predictions never modify execution, scheduling, or history\n- Rule: Advise, don't influence\n\nREAD_ONLY = True\n\nO1: API endpoint exists ✓\nO2: List visible with pagination ✓\nO3: Detail accessible ✓\nO4: Execution unchanged ✓ (no POST/PUT/DELETE)\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
123,app/api/protection_dependencies.py,CUSTOMER,integrations,L2,app/houseofcards/api/customer/integrations/protection_dependencies.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: request\n#   Execution: sync\n# Role: Phase-7 Protection FastAPI dependencies\n# Callers: API endpoints, middleware\n# Allowed Imports: L4 (protection, billing, auth.onboarding_state)\n# Forbidden Imports: L1, L5, L6\n# Reference: PIN-399 Phase-7 (Abuse & Protection Layer)\n\n""""""\nPhase-7 Protection Dependencies — FastAPI Integration\n\nProvides dependencies for protection checks in API endpoints.","\nPhase-7 Protection Dependencies — FastAPI Integration\n\nProvides dependencies for protection checks in API endpoints.\n\nENFORCEMENT SURFACE:\n    Protection applies to:\n    - SDK endpoints\n    - Runtime execution paths\n    - Background workers\n\n    Protection does NOT apply to:\n    - Onboarding endpoints\n    - Auth endpoints\n    - Founder endpoints\n    - Internal ops endpoints\n\nDESIGN INVARIANTS:\n- ABUSE-001: Protection does not affect onboarding, roles, or billing state\n- ABUSE-002: All enforceme",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
124,app/api/rate_limits.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/rate_limits.py,"# Layer: L2 — Product APIs\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified RATE_LIMITS facade - L2 API for rate limits and quotas\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-122 (Rate Limits API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for RATE_LIMITS domain (usage quotas).\n# All rate limit flows through this API.",\nRate Limits API (L2) - GAP-122\n\nProvides rate limit and quota operations:\n- GET /api/v1/rate-limits (list rate limits)\n- GET /api/v1/rate-limits/usage (current usage)\n- GET /api/v1/rate-limits/{id} (get rate limit)\n- PUT /api/v1/rate-limits/{id} (update rate limit)\n- POST /api/v1/rate-limits/check (check rate limit)\n- POST /api/v1/rate-limits/{id}/reset (reset usage)\n\nThis is the ONLY facade for rate limit/quota operations.\nDistinct from PIN-LIM policy limits (app/api/limits/).\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
125,app/api/rbac_api.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/rbac_api.py,"""""""\nRBAC Management API\n\nProvides endpoints for managing RBAC policies:\n- GET /api/v1/rbac/info - Get current policy info\n- POST /api/v1/rbac/reload - Hot-reload policies from file\n- GET /api/v1/rbac/matrix - Get current permission matrix\n- GET /api/v1/rbac/audit - Query audit logs\n\nRequires RBAC permission: rbac:read or rbac:reload\n\nNOTE (PIN-310): Authorization now routes through M28 via authorization_choke.py.\nPolicy introspection (info, matrix, reload) still uses rbac_engine for admin functions.\n""""""\n","\nRBAC Management API\n\nProvides endpoints for managing RBAC policies:\n- GET /api/v1/rbac/info - Get current policy info\n- POST /api/v1/rbac/reload - Hot-reload policies from file\n- GET /api/v1/rbac/matrix - Get current permission matrix\n- GET /api/v1/rbac/audit - Query audit logs\n\nRequires RBAC permission: rbac:read or rbac:reload\n\nNOTE (PIN-310): Authorization now routes through M28 via authorization_choke.py.\nPolicy introspection (info, matrix, reload) still uses rbac_engine for admin functions",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
126,app/api/recovery.py,CUSTOMER,recovery,L2,app/houseofcards/api/customer/recovery/recovery.py,"# Layer: L2 — Product APIs\n# AUDIENCE: INTERNAL\n# Role: M10 Recovery Suggestion Engine - failure recovery suggestions for founders\n# capability_id: CAP-018\n""""""\nM10 Recovery Suggestion Engine API Endpoints (Enhanced)\n\nProvides REST API for:\n1. POST /api/v1/recovery/suggest - Generate recovery suggestion for failure\n2. GET /api/v1/recovery/candidates - List recovery candidates\n3. GET /api/v1/recovery/candidates/{id} - Get single candidate with full context\n4. PATCH /api/v1/recovery/candidates/{id} - Update candidate (execution status, etc.)\n5. POST /api/v1/recovery/approve - Approve/reject a candidate\n6. DELETE /api/v1/recovery/candidates/{id} - Revoke suggestion (admin)\n7. GET /api/v1/recovery/actions - List available actions","\nM10 Recovery Suggestion Engine API Endpoints (Enhanced)\n\nProvides REST API for:\n1. POST /api/v1/recovery/suggest - Generate recovery suggestion for failure\n2. GET /api/v1/recovery/candidates - List recovery candidates\n3. GET /api/v1/recovery/candidates/{id} - Get single candidate with full context\n4. PATCH /api/v1/recovery/candidates/{id} - Update candidate (execution status, etc.)\n5. POST /api/v1/recovery/approve - Approve/reject a candidate\n6. DELETE /api/v1/recovery/candidates/{id} - Revoke ",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
127,app/api/recovery_ingest.py,CUSTOMER,recovery,L2,app/houseofcards/api/customer/recovery/recovery_ingest.py,"# app/api/recovery_ingest.py\n# capability_id: CAP-018\n""""""\nM10 Recovery Ingest Endpoint - Idempotent failure ingestion\n\nProvides:\n- POST /api/v1/recovery/ingest - Ingest failure for recovery evaluation\n\nFeatures:\n- Idempotent: Duplicate requests return existing candidate\n- Transactional: All operations atomic within DB transaction\n- IntegrityError handling: Catches unique constraint violations gracefully\n- Worker enqueue: Optionally pushes to evaluation queue\n\nAuthentication: Machine token with recovery:write scope.",\nM10 Recovery Ingest Endpoint - Idempotent failure ingestion\n\nProvides:\n- POST /api/v1/recovery/ingest - Ingest failure for recovery evaluation\n\nFeatures:\n- Idempotent: Duplicate requests return existing candidate\n- Transactional: All operations atomic within DB transaction\n- IntegrityError handling: Catches unique constraint violations gracefully\n- Worker enqueue: Optionally pushes to evaluation queue\n\nAuthentication: Machine token with recovery:write scope.\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
128,app/api/replay.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/replay.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Replay UX API - READ-ONLY slice and timeline endpoints\n# Authority: READ replay data (no mutations)\n# Callers: Customer Console replay viewer\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L3, L5\n# Reference: PIN-309 (Phase G Governance Freeze), H1 Replay UX\n# capability_id: CAP-001\n\n""""""\nReplay UX API (H1)","\nReplay UX API (H1)\n\nProvides READ-ONLY endpoints for replay visualization:\n- Time-windowed slice of incident data\n- Grouped view: inputs, decisions, actions, side-effects\n- Immutable, paginated responses\n\nINVARIANTS:\n1. All endpoints are READ-ONLY (no mutations)\n2. Uses existing RBAC v2 enforcement (require_replay_read)\n3. Tenant isolation enforced\n4. No execution or write capabilities\n\nReference: Phase H1 - Replay UX Enablement\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
129,app/api/retrieval.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/retrieval.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified RETRIEVAL facade - L2 API for mediated data access\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-094 (Mediated Data Retrieval API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for RETRIEVAL domain.\n# All data access flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nRetrieval API (L2)\n\nProvides mediated data retrieval operations:\n- POST /api/v1/retrieval/access (mediated data access)\n- GET /api/v1/retrieval/planes (list available planes)\n- POST /api/v1/retrieval/planes (register plane)\n- GET /api/v1/retrieval/planes/{id} (get plane)\n- GET /api/v1/retrieval/evidence (list evidence records)\n- GET /api/v1/retrieval/evidence/{id} (get evidence)\n\nThis is the ONLY facade for mediated data retrieval.\nAll data access from LLM-controlled code MUST flow through this,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
130,app/api/runtime.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/runtime.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Runtime API endpoints for machine-native primitives\n# Callers: External API clients\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-258 Phase F-3 Runtime Cluster\n#\n# GOVERNANCE NOTE (PIN-258 Phase F-3):\n# This L2 API layer must NOT import from L5 (workers/execution).\n# All runtime operations go through L3 RuntimeAdapter.\n# Direct L5 imports were eliminated in Phase F-3.","\nMachine-Native Runtime API Endpoints (M5.5)\n\nProvides REST API exposure for machine-native runtime primitives:\n1. POST /api/v1/runtime/simulate - Pre-execution plan simulation\n2. POST /api/v1/runtime/query - Runtime state queries\n3. GET /api/v1/runtime/skills - List available skills\n4. GET /api/v1/runtime/skills/{skill_id} - Describe a skill\n5. GET /api/v1/runtime/capabilities - Get capabilities for an agent\n\nDesign Principles (from PIN-005):\n- Queryable state: Agent asks questions, gets struct",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
131,app/api/scenarios.py,CUSTOMER,analytics,L2,app/houseofcards/api/customer/analytics/scenarios.py,"# Layer: L2 — Product APIs\n# Product: founder-console\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: H2 Scenario-based cost simulation API (advisory only)\n# Callers: founder console UI\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L5\n# Reference: Phase H2 - Cost Simulation v1\n""""""\nScenario-based Cost Simulation API (H2)\n\nREAD-ONLY simulation endpoints for scenario planning.\n","\nScenario-based Cost Simulation API (H2)\n\nREAD-ONLY simulation endpoints for scenario planning.\n\nINVARIANTS:\n- Pure computation ONLY - no real budget changes\n- No side effects - no database writes for simulation results\n- Advisory only - results are informational, not actionable\n- Scenarios can be stored for re-use (stored in-memory for v1)\n\nEndpoints:\n- GET /scenarios - List available scenarios\n- POST /scenarios - Create new scenario\n- GET /scenarios/{id} - Get scenario details\n- DELETE /scenar",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
132,app/api/scheduler.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/scheduler.py,"# Layer: L2 — Product APIs\n# Product: system-wide (NOT console-only - SDK users call this)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified SCHEDULER facade - L2 API for scheduled job operations\n# Callers: Console, SDK, external systems\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: GAP-112 (Scheduled Job API)\n# GOVERNANCE NOTE:\n# This is the ONE facade for SCHEDULER domain.\n# All scheduler flows through this API.\n# SDSR tests this same API - no separate SDSR endpoints.\n",\nScheduler API (L2)\n\nProvides scheduled job operations:\n- POST /api/v1/scheduler/jobs (create job)\n- GET /api/v1/scheduler/jobs (list jobs)\n- GET /api/v1/scheduler/jobs/{id} (get job)\n- PUT /api/v1/scheduler/jobs/{id} (update job)\n- DELETE /api/v1/scheduler/jobs/{id} (delete job)\n- POST /api/v1/scheduler/jobs/{id}/trigger (trigger job)\n- POST /api/v1/scheduler/jobs/{id}/pause (pause job)\n- POST /api/v1/scheduler/jobs/{id}/resume (resume job)\n- GET /api/v1/scheduler/jobs/{id}/runs (job runs)\n- GE,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
133,app/api/sdk.py,CUSTOMER,general,L2,app/houseofcards/api/customer/general/sdk.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async\n# Role: SDK connection and registration endpoints\n# Callers: SDK clients (Python, JS, etc.)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-399 (Onboarding State Machine v1)\n\n""""""\nSDK Endpoints\n\nPIN-399: Provides SDK handshake and registration endpoints for onboarding.",\nSDK Endpoints\n\nPIN-399: Provides SDK handshake and registration endpoints for onboarding.\n\nThese endpoints are called by SDK clients during initial setup:\n1. /sdk/handshake - Validate SDK connection and advance onboarding\n2. /sdk/register - Register SDK instance (future use)\n3. /sdk/instructions - Get SDK setup instructions (future use)\n\nONBOARDING TRANSITIONS:\n- /sdk/handshake triggers: API_KEY_CREATED → SDK_CONNECTED\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route; Domain uncertain,TRANSFER
134,app/api/session_context.py,CUSTOMER,integrations,L2,app/houseofcards/api/customer/integrations/session_context.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Session context endpoint for frontend auth state\n# Callers: Frontend console (ClerkAuthSync, route guards)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1\n# Reference: PIN-409 (Clerk Auth Integration), RULE-AUTH-UI-001\n\n""""""\nSession Context API\n\nPIN-409: Provides verified session context to frontend.","\nSession Context API\n\nPIN-409: Provides verified session context to frontend.\n\nThis endpoint replaces frontend-derived authorization facts (isFounder, audience)\nwith backend-verified context. The frontend reads, never infers.\n\nEndpoint:\n    GET /api/v1/session/context - Get current session context\n\nResponse:\n    {\n        ""actor_type"": ""customer"" | ""founder"" | ""machine"",\n        ""tenant_id"": ""..."",\n        ""capabilities"": [...],  // for machine clients only\n        ""lifecycle_state"": ""ACTIVE"" | ",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
135,app/api/status_history.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/status_history.py,"# Status History API (M6)\n""""""\nAPI endpoints for immutable status history audit trail.\n\nEndpoints:\n- GET /status_history - Query status history with filters\n- GET /status_history/{entity_type}/{entity_id} - Get history for specific entity\n- GET /status_history/export - Export to CSV/JSONL with signed URL\n- GET /status_history/stats - Get statistics for audit reporting\n\nSecurity:\n- Tenant isolation via tenant_id filter\n- Audit logging for all access\n- Signed URLs for exports (time-limited)\n""""""",\nAPI endpoints for immutable status history audit trail.\n\nEndpoints:\n- GET /status_history - Query status history with filters\n- GET /status_history/{entity_type}/{entity_id} - Get history for specific entity\n- GET /status_history/export - Export to CSV/JSONL with signed URL\n- GET /status_history/stats - Get statistics for audit reporting\n\nSecurity:\n- Tenant isolation via tenant_id filter\n- Audit logging for all access\n- Signed URLs for exports (time-limited)\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
136,app/api/tenants.py,CUSTOMER,logs,L2,app/houseofcards/api/customer/logs/tenants.py,"""""""\nTenant & API Key Management API (M21)\n\nProvides:\n- Tenant management endpoints\n- API key CRUD operations\n- Usage and quota queries\n- Worker registry endpoints\n""""""\n\nimport logging\nfrom datetime import datetime\nfrom typing import List, Optional\n\nfrom fastapi import APIRouter, Depends, HTTPException, Query, status",\nTenant & API Key Management API (M21)\n\nProvides:\n- Tenant management endpoints\n- API key CRUD operations\n- Usage and quota queries\n- Worker registry endpoints\n,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
137,app/api/traces.py,CUSTOMER,logs,L2,app/houseofcards/api/customer/logs/traces.py,"# Layer: L2a — Internal/SDK API (NOT domain authority)\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Trace storage, indexing, query, and determinism validation\n# Authority: WRITE trace mismatch reports (via store abstraction)\n# Callers: SDK, Replay system, Internal services\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1\n# Reference: M8 Trace System\n#\n# GOVERNANCE NOTE (LOGS Domain V2):\n# This is NOT the canonical LOGS domain facade.\n# The canonical facade is /api/v1/logs/* (logs.py).","\nTrace Query API\nM8 Deliverable: Trace storage, indexing, and query endpoints\n\nProvides REST API for:\n- Listing and searching traces\n- Getting trace details\n- Finding traces by root_hash (for replay verification)\n- Comparing traces for determinism validation\n- RBAC-protected access via JWT/OIDC\n- PII redaction on storage\n",,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
138,app/api/v1_killswitch.py,DEPRECATED,deprecated,N/A,,"# Layer: L2b — Public API (Tenant-scoped, NOT console-only)\n# Product: system-wide (BOUNDARY VIOLATION if labeled ai-console)\n# Auth: get_tenant_context + requires_feature (tier-gating)\n# Reference: PIN-240\n# WARNING: This is NOT console-exclusive. SDK users and external systems call this.\n\n""""""M22 KillSwitch MVP - Control & Observability API\n\nEndpoints:\n- POST /v1/killswitch/tenant - Freeze tenant\n- POST /v1/killswitch/key - Freeze API key\n- GET /v1/killswitch/status - Get freeze status\n- DELETE /v1/killswitch/tenant - Unfreeze tenant\n- DELETE /v1/killswitch/key - Unfreeze API key\n- GET /v1/policies/active - Get active guardrails",M22 KillSwitch MVP - Control & Observability API\n\nEndpoints:\n- POST /v1/killswitch/tenant - Freeze tenant\n- POST /v1/killswitch/key - Freeze API key\n- GET /v1/killswitch/status - Get freeze status\n- DELETE /v1/killswitch/tenant - Unfreeze tenant\n- DELETE /v1/killswitch/key - Unfreeze API key\n- GET /v1/policies/active - Get active guardrails\n- GET /v1/incidents - List incidents\n- GET /v1/incidents/{id} - Get incident detail\n- POST /v1/replay/{call_id} - Replay a call\n- GET /v1/calls/{call_id} - G,,DEPRECATED_DUPLICATE,ITERATION_1,Deprecated duplicate file,DELETE
139,app/api/v1_proxy.py,DEPRECATED,deprecated,N/A,,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: OpenAI-compatible proxy with KillSwitch and budget enforcement\n# Authority: WRITE ProxyCall records, Incident records (API self-authority)\n# Callers: External clients (drop-in OpenAI replacement), SDK\n# Reference: M22 KillSwitch MVP\n\n""""""M22 KillSwitch MVP - OpenAI-Compatible Proxy API\n\nDrop-in replacement for OpenAI API with:\n- KillSwitch enforcement (423 Locked if frozen)\n- Budget enforcement (402 Payment Required if exceeded)","M22 KillSwitch MVP - OpenAI-Compatible Proxy API\n\nDrop-in replacement for OpenAI API with:\n- KillSwitch enforcement (423 Locked if frozen)\n- Budget enforcement (402 Payment Required if exceeded)\n- Default guardrails (429 for rate limit, 400 for blocked)\n- Full call logging for replay\n- SSE streaming support\n\nEndpoints:\n- POST /v1/chat/completions - Chat completions (90% of usage)\n- POST /v1/embeddings - Embeddings\n\nHTTP Status Codes:\n- 200: Success\n- 400: Bad Request (validation, blocked content",,DEPRECATED_DUPLICATE,ITERATION_1,Deprecated duplicate file,DELETE
140,app/api/workers.py,CUSTOMER,policies,L2,app/houseofcards/api/customer/policies/workers.py,"# Layer: L2 — Product API\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Business Builder Worker API endpoints\n# Callers: External clients via HTTP\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-258 Phase F-3 Workers Cluster\n# Contract: PHASE_F_FIX_DESIGN (F-W-RULE-1 to F-W-RULE-5)\n#\n# GOVERNANCE NOTE (F-W-RULE-4):\n# This L2 module must ONLY call the L3 workers_adapter.\n# Direct L5 worker imports are FORBIDDEN.",\nAPI endpoints for Business Builder Worker.\n\nEndpoints:\n- POST /api/v1/workers/business-builder/run - Execute the worker\n- POST /api/v1/workers/business-builder/replay - Replay a previous execution\n- GET /api/v1/workers/business-builder/runs/{run_id} - Get run details\n- GET /api/v1/workers/business-builder/runs - List recent runs\n- POST /api/v1/workers/business-builder/validate-brand - Validate brand schema\n- GET /api/v1/workers/business-builder/stream/{run_id} - SSE stream for real-time updates,,NEEDS_CLASSIFICATION,ITERATION_1,API route,TRANSFER
141,app/auth.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/auth.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api (every authenticated request)\n#   Execution: sync\n# Role: API key verification dependency for FastAPI routes\n# Callers: All protected API routes via Depends()\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Security\n\nimport os\n\nfrom fastapi import Header, HTTPException, status\n",,,NEEDS_CLASSIFICATION,ITERATION_1,Auth module; Domain uncertain,TRANSFER
142,app/auth/__init__.py,INTERNAL,account,L4,app/houseofcards/internal/account/engines/__init__.py,"""""""\nAuth module for AOS.\n\nProvides Clerk-based authentication (the ONLY human auth path) and\nauthorization utilities.\n\nReference: AUTH_DESIGN.md\n- AUTH-HUMAN-001: All human users authenticate via Clerk (RS256 JWKS)\n- AUTH-HUMAN-002: No other human authentication mechanism exists\n- AUTH-MACHINE-001: Machine clients authenticate via API Key\n""""""\n\nimport os\n\nfrom fastapi import Header, HTTPException, status",\nAuth module for AOS.\n\nProvides Clerk-based authentication (the ONLY human auth path) and\nauthorization utilities.\n\nReference: AUTH_DESIGN.md\n- AUTH-HUMAN-001: All human users authenticate via Clerk (RS256 JWKS)\n- AUTH-HUMAN-002: No other human authentication mechanism exists\n- AUTH-MACHINE-001: Machine clients authenticate via API Key\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
143,app/auth/actor.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/actor.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker | internal\n#   Execution: sync\n# Role: Canonical actor model for all authorization decisions\n# Callers: AuthorizationEngine, IdentityAdapters, API middleware\n# Allowed Imports: (none - leaf module)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-271 (RBAC Authority Separation)\n\n""""""\nActorContext: The canonical actor model for AOS.\n\nAll authorization decisions consume this model.","\nActorContext: The canonical actor model for AOS.\n\nAll authorization decisions consume this model.\nNo endpoint, worker, or service inspects raw JWTs ever again.\n\nThis module is a leaf in the dependency graph - it imports nothing\nfrom the app package to prevent circular dependencies.\n\nUsage:\n    from app.auth.actor import ActorContext, ActorType, IdentitySource\n\n    actor = ActorContext(\n        actor_id=""user-123"",\n        actor_type=ActorType.EXTERNAL_PAID,\n        source=IdentitySource.CLERK,\n",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
144,app/auth/api_key_service.py,INTERNAL,api_keys,L4,app/houseofcards/internal/api_keys/engines/api_key_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: API key validation service for machine authentication\n# Callers: AuthGateway\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nAPI Key Validation Service\n",\nAPI Key Validation Service\n\nValidates API keys against the database and returns key metadata.\nUsed by the AuthGateway for machine authentication flow.\n\nINVARIANTS:\n1. Keys are validated by hash comparison (never plaintext storage)\n2. Revoked/expired keys are rejected immediately\n3. Key usage is recorded for audit trail\n4. Scopes are extracted from key permissions\n,,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Auth),TRANSFER
145,app/auth/authority.py,INTERNAL,analytics,L4,app/houseofcards/internal/analytics/engines/authority.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: RBAC v2 authority enforcement for capabilities\n# Callers: API routes (replay, predictions, etc.)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-307 (CAP-006 Auth Gateway), PIN-271 (RBAC Authority Separation)\n# capability_id: CAP-001, CAP-004\n\n""""""\nAuthority Enforcement Module\n","\nAuthority Enforcement Module\n\nProvides FastAPI dependencies for RBAC v2 capability authorization.\nConverts GatewayContext to ActorContext and enforces permissions.\n\nUsage:\n    from app.auth.authority import require_replay_execute, require_predictions_read\n\n    @router.post(""/replay/{run_id}"")\n    async def replay_run(\n        run_id: str,\n        _auth: AuthorityResult = Depends(require_replay_execute),\n    ):\n        # _auth contains the authorization result and actor\n        pass\n\nINVARIANTS:",,NEEDS_CLASSIFICATION,ITERATION_1,Authority decisions,TRANSFER
146,app/auth/authorization.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/authorization.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker | internal\n#   Execution: sync\n# Role: Single source of truth for all authorization decisions\n# Callers: API middleware, services, workers\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-271 (RBAC Authority Separation), PERMISSION_TAXONOMY_V1.md\n\n""""""\nAuthorizationEngine: The single source of truth for authorization.\n\nAll authorization decisions flow through this engine.","\nAuthorizationEngine: The single source of truth for authorization.\n\nAll authorization decisions flow through this engine.\nNo JWT logic. No identity provider logic. No HTTP logic.\nConsumes ActorContext, evaluates against policy.\n\nInvariants:\n- Input is ONLY ActorContext (from actor.py)\n- No framework imports (FastAPI, etc.)\n- No identity parsing\n- Same rules in all environments (prod, CI, dev)\n\nUsage:\n    from app.auth.authorization import get_authorization_engine, authorize\n\n    engine = get_au",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
147,app/auth/authorization_choke.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/authorization_choke.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker | internal\n#   Execution: sync\n# Role: Authorization choke point (single entry for all authz decisions)\n# Callers: API middleware, services, workers\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/invariants/AUTHZ_AUTHORITY.md\n\n""""""\nAuthorization Choke Point\n\n=============================================================================",\nAuthorization Choke Point\n\n=============================================================================\nINVARIANT: SINGLE AUTHORIZATION ENTRY POINT (I-AUTH-001)\n=============================================================================\nThis module is the ONLY entry point for authorization decisions.\n\nAll callers MUST use `authorize_action()` from this module.\nDirect calls to M7 (rbac_engine.py) or M28 (authorization.py) are FORBIDDEN.\n\nBehavior:\n1. Call M28 first (authoritative)\n2. If M28 m,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
148,app/auth/authorization_metrics.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/authorization_metrics.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: internal\n#   Execution: sync\n# Role: Prometheus metrics for authorization system\n# Callers: authorization_choke.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/invariants/AUTHZ_AUTHORITY.md\n\n""""""\nAuthorization Metrics\n\nProvides Prometheus metrics for authorization decisions.",\nAuthorization Metrics\n\nProvides Prometheus metrics for authorization decisions.\n\nMetrics:\n    authz_m7_fallback_total: Counter for M7→M28 fallback usage\n    authz_decision_total: Counter for all authorization decisions\n    authz_latency_seconds: Histogram for authorization latency\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
149,app/auth/clerk_provider.py,INTERNAL,integrations,L4,app/houseofcards/internal/integrations/engines/clerk_provider.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: external\n#   Execution: async\n# Role: Clerk authentication provider adapter\n# Callers: auth services\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Auth Integration\n\n""""""\nClerk Auth Provider for AOS\n\nThis module provides Clerk-based authentication and authorization.","\nClerk Auth Provider for AOS\n\nThis module provides Clerk-based authentication and authorization.\nIt replaces the previous Keycloak OIDC and stub auth implementations.\n\nClerk provides:\n- User management with roles via public_metadata\n- JWT verification via JWKS\n- M2M (machine-to-machine) authentication support\n\nUsage:\n    from app.auth.clerk_provider import ClerkAuthProvider, get_clerk_provider\n\n    provider = get_clerk_provider()\n    user_info = await provider.get_user_roles(user_id, tenant_id)\n",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
150,app/auth/console_auth.py,INTERNAL,analytics,L4,app/houseofcards/internal/analytics/engines/console_auth.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Console authentication compatibility shim\n# Callers: guard.py, cost_guard.py, and other routes\n# Reference: PIN-398 (Auth Design Sanitization)\n\n""""""\nConsole Authentication Compatibility Shim\n\nPIN-398: This module was deleted as part of auth sanitization.\nLegacy console token authentication is FORBIDDEN per AUTH_DESIGN.md.\n",\nConsole Authentication Compatibility Shim\n\nPIN-398: This module was deleted as part of auth sanitization.\nLegacy console token authentication is FORBIDDEN per AUTH_DESIGN.md.\n\nThis shim exists ONLY to maintain backwards compatibility with routes\nthat still import from console_auth. These routes should be migrated\nto use Clerk authentication via the gateway middleware.\n\nMIGRATION PATH:\n1. Routes should get auth context from request.state.auth_context\n2. Use get_auth_context(request) from gateway,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
151,app/auth/contexts.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/contexts.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Gateway authentication context models for human and machine flows\n# Callers: AuthGateway, gateway_middleware\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nGateway Authentication Contexts\n","\nGateway Authentication Contexts\n\nThis module defines the context models produced by the Auth Gateway.\nThese are GATEWAY-level contexts, distinct from RBAC-level contexts.\n\nTwo flows, two context types:\n1. Human Flow (JWT) → HumanAuthContext\n2. Machine Flow (API Key) → MachineCapabilityContext\n\nINVARIANTS:\n- HumanAuthContext has NO permissions (RBAC decides later)\n- MachineCapabilityContext has scopes only (NO RBAC, NO role lookup)\n- These contexts are immutable after creation\n- Downstream code ",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
152,app/auth/customer_sandbox.py,INTERNAL,platform,L4,app/houseofcards/internal/platform/engines/customer_sandbox.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Customer Sandbox Authentication for local development and CI\n# Callers: gateway_middleware.py\n# Allowed Imports: L6 (settings, models)\n# Forbidden Imports: L1, L2, L4, L5\n# Reference: PIN-440\n\n""""""Customer Sandbox Authentication Mode\n\nPURPOSE:\n    Provides customer-grade authentication for local development and CI testing","Customer Sandbox Authentication Mode\n\nPURPOSE:\n    Provides customer-grade authentication for local development and CI testing\n    WITHOUT touching production auth (JWT/Clerk) or production database (Neon).\n\nDESIGN PRINCIPLES:\n    1. Local testing must simulate a real customer, not bypass a real system\n    2. Sandbox mode is compile-time gated by environment variables\n    3. No JWT, no Neon prod, no external dependencies\n    4. Prod auth paths remain completely untouched\n\nACTIVATION:\n    Require",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
153,app/auth/evidence_sink.py,INTERNAL,logs,L4,app/houseofcards/internal/logs/engines/evidence_sink.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker\n#   Execution: async\n# Role: Database evidence sink for execution envelopes\n# Callers: auth/execution_envelope.py\n# Allowed Imports: L6 (models)\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: PIN-330\n\n""""""\nDatabase Evidence Sink - PIN-330 Implicit Authority Hardening\n\nProvides append-only database storage for execution envelopes.",\nDatabase Evidence Sink - PIN-330 Implicit Authority Hardening\n\nProvides append-only database storage for execution envelopes.\n\nCONSTRAINTS:\n- Append-only (no UPDATE/DELETE)\n- Emission failure MUST NOT block execution\n- All writes are fire-and-forget from caller perspective\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
154,app/auth/execution_envelope.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/execution_envelope.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api | cli | worker\n#   Execution: sync\n# Role: Execution envelope generation for implicit authority hardening\n# Callers: CLI entry, SDK invocation, auto-execute trigger\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-330\n\n""""""\nExecution Envelope - PIN-330 Implicit Authority Hardening\n\nThis module provides non-blocking execution envelope generation for:","\nExecution Envelope - PIN-330 Implicit Authority Hardening\n\nThis module provides non-blocking execution envelope generation for:\n- CAP-020 (CLI Execution)\n- CAP-021 (SDK Execution)\n- SUB-019 (Auto-Execute Recovery)\n\nCONSTRAINTS:\n- Envelope creation failure MUST NOT block execution\n- No enforcement, blocking, or behavior changes\n- All fields are evidence, not policy gates\n- Preserves execution semantics exactly\n",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
155,app/auth/gateway.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/gateway.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Central authentication gateway - single entry point for all auth\n# Callers: gateway_middleware ONLY\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nAuth Gateway - Central Authentication Entry Point\n","\nAuth Gateway - Central Authentication Entry Point\n\nThis module is the ONLY place where authentication headers are parsed.\nAll downstream code consumes contexts, never raw headers.\n\nINVARIANTS (AUTH_DESIGN.md):\n1. Mutual Exclusivity: JWT XOR API Key (both = HARD FAIL)\n2. Human Flow: Clerk JWT (RS256) → HumanAuthContext\n3. Machine Flow: API Key → MachineCapabilityContext\n4. Session Revocation: Every human request checks revocation\n5. Headers Stripped: After gateway, auth headers are removed from ",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
156,app/auth/gateway_audit.py,INTERNAL,logs,L4,app/houseofcards/internal/logs/engines/gateway_audit.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Audit emission for auth gateway events\n# Callers: gateway_middleware\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nGateway Audit Emission\n",\nGateway Audit Emission\n\nEmits audit events for every authentication attempt through the gateway.\nProvides visibility into authentication patterns and security events.\n\nEVENTS:\n- auth.success.human - Successful JWT authentication\n- auth.success.machine - Successful API key authentication\n- auth.failure - Authentication failure (any type)\n\nINVARIANTS:\n1. Every gateway call emits an audit event\n2. Audit failures do not block requests\n3. Events are non-blocking (async emission)\n4. Sensitive data (t,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
157,app/auth/gateway_config.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/gateway_config.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: startup\n#   Execution: sync\n# Role: Gateway configuration and initialization\n# Callers: main.py lifespan\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nGateway Configuration\n",\nGateway Configuration\n\nConfigures and initializes the Auth Gateway with all dependencies.\nCalled during application startup to wire together:\n- Session revocation store (Redis)\n- API key validation service (Database)\n- Gateway singleton\n\nThis module provides a single entry point for gateway setup.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
158,app/auth/gateway_metrics.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/gateway_metrics.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: internal\n#   Execution: sync\n# Role: Prometheus metrics for auth gateway token verification\n# Callers: gateway.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-XXX (Auth Gateway Metrics)\n\n""""""\nAuth Gateway Metrics\n\nProvides Prometheus metrics for token verification.",\nAuth Gateway Metrics\n\nProvides Prometheus metrics for token verification.\n\nMetrics:\n    auth_tokens_verified_total: Counter for successful token verifications\n    auth_tokens_rejected_total: Counter for rejected tokens\n\nReference: AUTH_DESIGN.md\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
159,app/auth/gateway_middleware.py,INTERNAL,integrations,L4,app/houseofcards/internal/integrations/engines/gateway_middleware.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async\n# Role: FastAPI middleware for auth gateway integration\n# Callers: FastAPI app (main.py)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nAuth Gateway Middleware\n",\nAuth Gateway Middleware\n\nFastAPI middleware that calls the AuthGateway on every request.\nInjects authentication context into request.state for downstream use.\n\nFLOW:\n1. Extract Authorization and X-AOS-Key headers\n2. Call gateway.authenticate()\n3. If error: return HTTP error response\n4. If success: inject context into request.state.auth_context\n5. Proceed to route handler\n\nINVARIANTS:\n1. All protected routes have auth context in request.state\n2. Public paths bypass authentication\n3. Auth headers,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
160,app/auth/gateway_types.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/gateway_types.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Gateway authentication result types and error definitions\n# Callers: AuthGateway, gateway_middleware\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nGateway Authentication Types\n",\nGateway Authentication Types\n\nThis module defines result types and error classes for the Auth Gateway.\n\nGatewayResult is a union type representing the outcome of gateway authentication:\n- Success → HumanAuthContext or MachineCapabilityContext\n- Failure → GatewayAuthError\n\nINVARIANTS:\n- Every gateway call returns exactly one GatewayResult\n- Errors have specific codes for programmatic handling\n- Error messages are safe to return to clients\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
161,app/auth/identity_adapter.py,INTERNAL,general,L3,app/houseofcards/internal/general/facades/identity_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Extract identity from requests, produce ActorContext\n# Callers: IdentityChain, API middleware\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-271 (RBAC Authority Separation)\n\n""""""\nIdentity Adapters: Extract identity from requests.\n\nEach adapter handles a specific identity source (Clerk, System, Dev).","\nIdentity Adapters: Extract identity from requests.\n\nEach adapter handles a specific identity source (Clerk, System, Dev).\nAll adapters produce ActorContext - the canonical actor model.\n\nInvariants:\n- Adapters do identity extraction ONLY\n- No authorization logic inside adapters\n- No permission computation inside adapters\n- All produce ActorContext\n\nUsage:\n    adapter = ClerkAdapter()\n    actor = await adapter.extract_actor(request)\n\n    if actor is None:\n        # No valid identity found\n       ",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter; Domain uncertain,TRANSFER
162,app/auth/identity_chain.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/identity_chain.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified identity extraction via adapter chain\n# Callers: API middleware\n# Allowed Imports: L3, L4\n# Forbidden Imports: L1, L2\n# Reference: PIN-271 (RBAC Authority Separation)\n\n""""""\nIdentityChain: Unified identity extraction.\n\nTries identity adapters in order until one succeeds.",\nIdentityChain: Unified identity extraction.\n\nTries identity adapters in order until one succeeds.\nEnvironment decides which adapters are active.\nAll adapters produce ActorContext → same authorization path.\n\nInvariants:\n- Adapter order matters (first match wins)\n- System adapter always checked first (machine tokens)\n- Clerk checked in production\n- Dev adapter only in development\n- Permissions computed after identity extraction\n\nUsage:\n    chain = create_identity_chain()\n    actor = await chain.e,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
163,app/auth/invariants.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/invariants.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Invariant guards for auth gateway enforcement\n# Callers: AuthGateway, gateway_middleware\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nAuth Gateway Invariant Guards\n",\nAuth Gateway Invariant Guards\n\nHard-fail guards that enforce authentication invariants.\nThese guards are called within the gateway and middleware\nto ensure the auth contract is never violated.\n\nINVARIANTS:\n1. No mixed auth (JWT AND API Key) - HARD FAIL\n2. Plane must match route requirement - HARD FAIL\n3. Workers never use JWT - HARD FAIL\n4. Headers are stripped after gateway - ENFORCED\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
164,app/auth/invocation_context.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/invocation_context.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker\n#   Execution: sync\n# Role: Invocation context for cross-referencing side-effects\n# Callers: All execution paths that produce side-effects\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-330\n\n""""""\nInvocation Context - PIN-330 Cross-Reference Side-Effects\n\nProvides context propagation for tagging side-effects with invocation_id.","\nInvocation Context - PIN-330 Cross-Reference Side-Effects\n\nProvides context propagation for tagging side-effects with invocation_id.\n\nUSAGE:\n    from app.auth.invocation_context import (\n        get_current_invocation_id,\n        set_current_invocation,\n        invocation_context,\n    )\n\n    # In execution entry point:\n    with invocation_context(envelope):\n        # All side-effects in this context can access invocation_id\n        do_work()\n\n    # In side-effect code:\n    invocation_id = get_c",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
165,app/auth/invocation_safety.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/invocation_safety.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api | cli | sdk\n#   Execution: sync\n# Role: Invocation Safety Layer for CAP-020 (CLI) and CAP-021 (SDK)\n# Callers: CLI dispatcher, SDK wrappers\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-332\n\n""""""\nInvocation Safety Layer - PIN-332 Invocation Safety Closure\n\nProvides safety validation for CLI and SDK invocations at the capability boundary.",\nInvocation Safety Layer - PIN-332 Invocation Safety Closure\n\nProvides safety validation for CLI and SDK invocations at the capability boundary.\nDoes NOT change core execution logic or authority declarations.\n\nENFORCEMENT MODE: OBSERVE_WARN (v1)\n- Log safety check failures\n- Add flags to execution envelope\n- Emit metrics\n- No hard blocks except plan injection\n\nCONSTRAINTS:\n- Does NOT change authority (PIN-331)\n- Does NOT add RBAC per command/method\n- Does NOT touch L2 core logic\n- Lives ONLY at ,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
166,app/auth/jwt_auth.py,INTERNAL,logs,L4,app/houseofcards/internal/logs/engines/jwt_auth.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: JWT token validation and parsing\n# Callers: middleware, API routes\n# Allowed Imports: None\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Auth Infrastructure\n\n""""""\nJWT/OIDC Authentication for AOS Traces API\n\nM8 Deliverable: Production-ready JWT authentication with JWKS verification.",\nJWT/OIDC Authentication for AOS Traces API\n\nM8 Deliverable: Production-ready JWT authentication with JWKS verification.\n\nFeatures:\n- JWKS (JSON Web Key Set) verification with caching\n- Support for RS256 and ES256 algorithms\n- Automatic key rotation handling\n- Tenant isolation via JWT claims\n- Rate limit tier extraction from claims\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
167,app/auth/lifecycle_provider.py,INTERNAL,account,L4,app/houseofcards/internal/account/engines/lifecycle_provider.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: request\n#   Execution: sync\n# Role: Phase-9 Tenant Lifecycle Provider\n# Callers: Auth middleware, protection provider, founder endpoints\n# Allowed Imports: L4 (tenant_lifecycle), L6 (observability emit only)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-400 Phase-9 (Offboarding & Tenant Lifecycle)\n\n""""""\nPhase-9 Tenant Lifecycle Provider\n\nPIN-400 Phase-9: Offboarding is state transition with guarantees.",\nPhase-9 Tenant Lifecycle Provider\n\nPIN-400 Phase-9: Offboarding is state transition with guarantees.\n\nThis module provides:\n- TenantLifecycleProvider: Protocol for lifecycle operations\n- MockTenantLifecycleProvider: Deterministic mock implementation\n- TransitionResult: Result of lifecycle transitions\n\nDESIGN INVARIANTS (LOCKED):\n- OFFBOARD-001: Lifecycle transitions are monotonic\n- OFFBOARD-002: TERMINATED is irreversible\n- OFFBOARD-003: ARCHIVED is unreachable from ACTIVE\n- OFFBOARD-004: No cu,,NEEDS_CLASSIFICATION,ITERATION_1,Lifecycle management,TRANSFER
168,app/auth/mappings/__init__.py,INTERNAL,policies,L4,app/houseofcards/internal/policies/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: internal\n#   Execution: sync\n# Role: M7→M28 authority mapping package\n# Reference: docs/invariants/AUTHZ_AUTHORITY.md\n\n""""""\nM7→M28 Authority Mapping Package\n\nThis package contains the translation layer from legacy M7 (PolicyObject)\nto the authoritative M28 (AuthorizationEngine).\n\nINVARIANT: This is a ONE-WAY mapping. No M28→M7 reverse mapping allowed.",\nM7→M28 Authority Mapping Package\n\nThis package contains the translation layer from legacy M7 (PolicyObject)\nto the authoritative M28 (AuthorizationEngine).\n\nINVARIANT: This is a ONE-WAY mapping. No M28→M7 reverse mapping allowed.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
169,app/auth/mappings/m7_to_m28.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/m7_to_m28.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: internal\n#   Execution: sync\n# Role: M7 to M28 authority mapping (single source of truth)\n# Callers: Authorization choke point only\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: docs/invariants/AUTHZ_AUTHORITY.md\n\n""""""\nM7 to M28 Authority Mapping\n\n=============================================================================",\nM7 to M28 Authority Mapping\n\n=============================================================================\nINVARIANT: SINGLE MAPPING FILE (I-AUTH-002)\n=============================================================================\nThis is the ONLY file that may contain M7→M28 mapping logic.\nNo other file may import from M7 and translate to M28 patterns.\n\nRules:\n1. Mapping must be lossless (no information loss)\n2. Ambiguous mappings HARD-FAIL (raise MappingError)\n3. No reverse mapping (M28→M7) all,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
170,app/auth/oauth_providers.py,INTERNAL,integrations,L4,app/houseofcards/internal/integrations/engines/oauth_providers.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: external\n#   Execution: async\n# Role: OAuth provider adapters (Google, GitHub, etc)\n# Callers: auth services\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Auth Integration\n\n""""""\nOAuth2 Providers - Google & Azure\n\nProvides OAuth2 authentication flow for customer onboarding.","\nOAuth2 Providers - Google & Azure\n\nProvides OAuth2 authentication flow for customer onboarding.\n\nConfiguration (environment variables):\n    GOOGLE_CLIENT_ID: Google OAuth client ID\n    GOOGLE_CLIENT_SECRET: Google OAuth client secret\n    AZURE_CLIENT_ID: Azure AD client ID\n    AZURE_CLIENT_SECRET: Azure AD client secret\n    AZURE_TENANT_ID: Azure AD tenant ID (or ""common"" for multi-tenant)\n    OAUTH_REDIRECT_BASE: Base URL for OAuth redirects (e.g., https://agenticverz.com)\n",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
171,app/auth/oidc_provider.py,INTERNAL,integrations,L4,app/houseofcards/internal/integrations/engines/oidc_provider.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: external\n#   Execution: async\n# Role: OIDC authentication provider adapter\n# Callers: auth services\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Auth Integration\n\n""""""\nOIDC Provider Integration for Keycloak\n\nProvides JWT validation using JWKS (JSON Web Key Set) from Keycloak.","\nOIDC Provider Integration for Keycloak\n\nProvides JWT validation using JWKS (JSON Web Key Set) from Keycloak.\nExtracts roles from Keycloak-specific token claims.\n\nConfiguration (environment variables):\n    OIDC_ISSUER_URL: Keycloak realm URL (e.g., https://auth-dev.xuniverz.com/realms/agentiverz-dev)\n    OIDC_CLIENT_ID: Client ID for audience validation\n    OIDC_VERIFY_SSL: Whether to verify SSL certificates (default: true)\n\nUsage:\n    from app.auth.oidc_provider import validate_token, get_roles",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
172,app/auth/onboarding_gate.py,INTERNAL,agent,L4,app/houseofcards/internal/agent/engines/onboarding_gate.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: async\n# Role: Middleware to enforce onboarding state requirements per endpoint\n# Callers: FastAPI app (main.py)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-399 (Onboarding State Machine v1), ONBOARDING_ENDPOINT_MAP_V1.md\n\n""""""\nOnboarding Gate Middleware\n\nPIN-399: Enforces onboarding state requirements for all endpoints.",\nOnboarding Gate Middleware\n\nPIN-399: Enforces onboarding state requirements for all endpoints.\n\nFLOW:\n1. Get tenant_id from auth context (set by AuthGatewayMiddleware)\n2. Look up tenant's onboarding_state from database\n3. Compare against required_state for this endpoint\n4. If insufficient: return 403 with structured error\n5. If sufficient: proceed to route handler\n\nDESIGN INVARIANTS:\n- State is the sole authority (ONBOARD-001)\n- No RBAC coupling - this middleware does NOT check permissions\n- Fo,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
173,app/auth/onboarding_state.py,INTERNAL,account,L4,app/houseofcards/internal/account/engines/onboarding_state.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Onboarding state enum and constants\n# Callers: OnboardingGateMiddleware, Tenant model, onboarding endpoints\n# Allowed Imports: None (foundational enum)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 (Onboarding State Machine v1)\n\n""""""\nOnboarding State Machine - Shared Enum\n\nPIN-399: Linear, monotonic onboarding state machine.","\nOnboarding State Machine - Shared Enum\n\nPIN-399: Linear, monotonic onboarding state machine.\n\nStates:\n    CREATED → IDENTITY_VERIFIED → API_KEY_CREATED → SDK_CONNECTED → COMPLETE\n\nDesign Invariants (from ONBOARDING_STATE_MACHINE_V1.md):\n- ONBOARD-001: Onboarding state is the sole authority for bootstrap permissions\n- ONBOARD-002: Roles and plans do not apply before COMPLETE\n- ONBOARD-003: Founders and customers follow identical state transitions\n- ONBOARD-004: No endpoint may infer onboarding p",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
174,app/auth/onboarding_transitions.py,INTERNAL,api_keys,L4,app/houseofcards/internal/api_keys/engines/onboarding_transitions.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api, worker\n#   Execution: async\n# Role: Central service for onboarding state transitions\n# Callers: gateway_middleware, api_keys router, sdk handshake\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-399 (Onboarding State Machine v1)\n\n""""""\nOnboarding Transition Service\n\nPIN-399: Central point of mutation for tenant onboarding state.","\nOnboarding Transition Service\n\nPIN-399: Central point of mutation for tenant onboarding state.\n\nDESIGN INVARIANTS:\n- ONBOARD-TRANS-001: Transitions are idempotent (repeated calls are no-ops)\n- ONBOARD-TRANS-002: Transitions are monotonic (forward-only, never regress)\n- ONBOARD-TRANS-003: All transitions are audited\n- ONBOARD-TRANS-004: Single service owns all mutations\n\nTRANSITION TRIGGERS:\n- CREATED → IDENTITY_VERIFIED: First authenticated human request\n- IDENTITY_VERIFIED → API_KEY_CREATED: F",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
175,app/auth/query_authority.py,INTERNAL,policies,L4,app/houseofcards/internal/policies/engines/query_authority.py,"# Layer: L4 — Domain Engines (Authorization)\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Query authority enforcement for data access\n# Reference: PIN-392\n""""""\nQuery Authority Enforcement\n\nEnforces data query constraints declared in RBAC_RULES.yaml.\nControls WHAT KIND OF DATA a request may ask for.\n\nUsage:\n    from app.auth.query_authority import (","\nQuery Authority Enforcement\n\nEnforces data query constraints declared in RBAC_RULES.yaml.\nControls WHAT KIND OF DATA a request may ask for.\n\nUsage:\n    from app.auth.query_authority import (\n        enforce_query_authority,\n        QueryAuthorityViolation,\n    )\n\n    # In your endpoint\n    rule = resolve_rbac_rule(path, method, console, env, strict=True)\n    enforce_query_authority(\n        rule.query_authority,\n        include_synthetic=request.query.get(""include_synthetic"", False),\n        ma",,NEEDS_CLASSIFICATION,ITERATION_1,Authority decisions,TRANSFER
176,app/auth/rbac.py,INTERNAL,policies,L4,app/houseofcards/internal/policies/engines/rbac.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: RBAC core logic and permission checks\n# Callers: API routes, services\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Auth System\n\n""""""\nRBAC (Role-Based Access Control) Integration for Policy API\n\nThis module provides authorization checks for approval workflows.","\nRBAC (Role-Based Access Control) Integration for Policy API\n\nThis module provides authorization checks for approval workflows.\nIt integrates with Clerk (primary) or legacy auth service for role validation.\n\nUsage:\n    from app.auth.rbac import check_approver_permission, RBACError\n\n    try:\n        check_approver_permission(\n            approver_id=""user-123"",\n            required_level=3,\n            tenant_id=""tenant-abc""\n        )\n    except RBACError as e:\n        raise HTTPException(status_",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
177,app/auth/rbac_engine.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/rbac_engine.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: RBAC authorization engine with policy evaluation\n# Callers: API routes, middleware, services\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Auth System\n\n""""""\nEnhanced RBAC Engine - M7 Implementation\n\n=============================================================================","\nEnhanced RBAC Engine - M7 Implementation\n\n=============================================================================\nINVARIANT: M7 IS LEGACY - TRANSLATION LAYER ONLY (I-AUTH-002, I-AUTH-003)\n=============================================================================\nThis module is a TEMPORARY TRANSLATION LAYER scheduled for removal.\n\nALL authorization decisions MUST originate from M28 (authorization.py).\nM7 is READ-ONLY and must not be extended.\n\nDO NOT:\n- Add new roles or permissions to t",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
178,app/auth/rbac_integration.py,INTERNAL,integrations,L4,app/houseofcards/internal/integrations/engines/rbac_integration.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Bridge RBACv1 → RBACv2 for shadow comparison\n# Callers: RBACMiddleware\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-271 (RBAC Authority Separation), PIN-273 (Phase 1 Complete)\n\n""""""\nRBAC Integration Layer: RBACv1 ↔ RBACv2 Shadow Comparison.\n\n=============================================================================",\nRBAC Integration Layer: RBACv1 ↔ RBACv2 Shadow Comparison.\n\n=============================================================================\nTERMINOLOGY (LOCKED - PIN-273)\n=============================================================================\n\n| Concept                      | Name                          |\n|------------------------------|-------------------------------|\n| Existing enforcement path    | RBACv1 (Enforcement Authority)|\n| ActorContext + AuthEngine    | RBACv2 (Reference Autho,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
179,app/auth/rbac_middleware.py,INTERNAL,policies,L4,app/houseofcards/internal/policies/engines/rbac_middleware.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: FastAPI RBAC middleware for request auth\n# Callers: main.py, route handlers\n# Allowed Imports: None\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Auth Infrastructure\n\n""""""\nRBAC Middleware with PolicyObject - M7/M8 Implementation\n\nProvides request-level authorization using PolicyObject pattern.","\nRBAC Middleware with PolicyObject - M7/M8 Implementation\n\nProvides request-level authorization using PolicyObject pattern.\nIntegrates with JWT claims, machine tokens, and Keycloak OIDC.\n\nFeatures:\n- PolicyObject-based authorization\n- Machine token support\n- JWT role extraction with JWKS validation (Keycloak)\n- Feature flag toggle (RBAC_ENFORCE)\n- Prometheus metrics\n\nUsage:\n    # In FastAPI app startup\n    from app.auth.rbac_middleware import RBACMiddleware\n\n    app.add_middleware(RBACMiddleware",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
180,app/auth/rbac_rules_loader.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/rbac_rules_loader.py,"# Layer: L4 — Domain Engines (Authorization)\n# Product: system-wide\n# Temporal:\n#   Trigger: import\n#   Execution: sync\n# Role: Load RBAC rules from canonical YAML schema\n# Reference: PIN-391\n""""""\nRBAC Rules Loader\n\nLoads authorization rules from the canonical RBAC_RULES.yaml schema.\nThis is the bridge between the declarative schema and runtime enforcement.\n\nUsage:\n    from app.auth.rbac_rules_loader import (","\nRBAC Rules Loader\n\nLoads authorization rules from the canonical RBAC_RULES.yaml schema.\nThis is the bridge between the declarative schema and runtime enforcement.\n\nUsage:\n    from app.auth.rbac_rules_loader import (\n        load_rbac_rules,\n        resolve_rbac_rule,\n        get_public_paths,\n        RBACRule,\n    )\n\n    # Get all rules\n    rules = load_rbac_rules()\n\n    # Resolve a specific request (raises RBACSchemaViolation if no rule)\n    rule = resolve_rbac_rule(""/api/v1/incidents/"", ""GET""",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
181,app/auth/role_guard.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/role_guard.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Phase-5 Role Guard Dependency for endpoint authorization\n# Callers: API endpoints (via Depends)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-399 Phase-5 (Post-Onboarding Permissions & Roles)\n\n""""""\nPhase-5 Role Guard — Dependency-Based Authorization\n\nPIN-399 Phase-5: Authorization is explicit at the endpoint boundary.","\nPhase-5 Role Guard — Dependency-Based Authorization\n\nPIN-399 Phase-5: Authorization is explicit at the endpoint boundary.\n\nDESIGN INVARIANTS (LOCKED):\n- ROLE-001: Roles do not exist before onboarding COMPLETE\n- ROLE-002: Permissions are derived, not stored\n- ROLE-003: Human roles never affect machine scopes\n- ROLE-004: Console origin never grants authority\n- ROLE-005: Role enforcement never mutates state\n\nUSAGE:\n    @router.post(""/policies"")\n    async def create_policy(\n        request: Request",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
182,app/auth/role_mapping.py,INTERNAL,integrations,L4,app/houseofcards/internal/integrations/engines/role_mapping.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Role-to-permission mapping engine\n# Callers: RBAC engine, services\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Auth System\n\n""""""\nRole Mapping - M7-M28 RBAC Integration (PIN-169)\n\nONE-WAY MAPPING ONLY: Console roles → RBAC roles","\nRole Mapping - M7-M28 RBAC Integration (PIN-169)\n\nONE-WAY MAPPING ONLY: Console roles → RBAC roles\nM7 RBAC roles are CANONICAL. M28 roles are presentation aliases.\n\nINVARIANTS:\n1. This mapping is ONE-WAY. Never invert.\n2. If M28 invents authority, the invariant is broken.\n3. Founder roles NEVER flow through tenant RBAC.\n\nCreated: 2025-12-25\n",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
183,app/auth/route_planes.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/route_planes.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Route authentication plane declarations and enforcement\n# Callers: gateway_middleware\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nRoute Plane Declarations\n","\nRoute Plane Declarations\n\nDefines which authentication plane (HUMAN, MACHINE, or BOTH)\nis allowed for each route pattern.\n\nDESIGN:\n- Routes are matched by prefix patterns\n- More specific patterns take precedence\n- Worker/agent routes are MACHINE only\n- Admin routes are HUMAN only\n- Most API routes allow BOTH\n\nINVARIANTS:\n1. Worker endpoints NEVER accept JWT (workers can't impersonate users)\n2. Admin endpoints NEVER accept API keys (prevent privilege escalation)\n3. Mismatch = 403 Forbidden (not ",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
184,app/auth/session_store.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/session_store.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Redis-backed session revocation store\n# Callers: AuthGateway\n# Allowed Imports: (none - leaf module)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-306 (Capability Registry), CAP-006 (Authentication)\n# capability_id: CAP-006\n\n""""""\nSession Revocation Store\n","\nSession Revocation Store\n\nRedis-backed store for tracking revoked sessions.\nWhen a user logs out or their session is invalidated,\nthe session ID is added to this store.\n\nThe gateway checks this store on every human request\nto ensure revoked sessions cannot be used.\n\nINVARIANTS:\n1. Session revocation is immediate (no caching delay)\n2. Missing Redis = sessions NOT revoked (fail-open for availability)\n3. Session IDs expire from Redis after TTL (default: 7 days)\n4. This is advisory only - Redis los",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
185,app/auth/shadow_audit.py,INTERNAL,logs,L4,app/houseofcards/internal/logs/engines/shadow_audit.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Shadow audit logging for auth decisions\n# Callers: RBAC engine, middleware\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Auth System\n\n""""""\nShadow Audit Logging - M7-M28 RBAC Integration (PIN-169)\n\nLogs RBAC decisions WITHOUT enforcing them.",\nShadow Audit Logging - M7-M28 RBAC Integration (PIN-169)\n\nLogs RBAC decisions WITHOUT enforcing them.\nUsed during Phase 1-3 to collect real-world decision data before enforcement.\n\nUsage:\n    RBAC_SHADOW_AUDIT=true  # Enable shadow audit logging\n    RBAC_ENFORCE=false      # Disable enforcement (log only)\n\nROLLOUT GATES (must pass before enforcement):\n    - READ would-block rate < 0.1%\n    - WRITE would-block rate < 0.01%\n    - Founder-tenant violations = 0 (ever)\n    - Shadow audit running >= ,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
186,app/auth/tenant_auth.py,INTERNAL,account,L4,app/houseofcards/internal/account/engines/tenant_auth.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Tenant authentication and isolation\n# Callers: middleware, services\n# Allowed Imports: None\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Auth Infrastructure\n\n""""""\nTenant-Aware API Key Authentication (M21)\n\nProvides:",\nTenant-Aware API Key Authentication (M21)\n\nProvides:\n- API key validation against database (not env vars)\n- Tenant context extraction from API key\n- Quota enforcement before request processing\n- Usage tracking after request completion\n- Rate limiting per key/tenant\n- TenantTier integration (M32)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
187,app/auth/tenant_lifecycle.py,INTERNAL,account,L4,app/houseofcards/internal/account/engines/tenant_lifecycle.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-9 Tenant Lifecycle States\n# Callers: Lifecycle provider, auth middleware, protection\n# Allowed Imports: stdlib only\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-400 Phase-9 (Offboarding & Tenant Lifecycle)\n\n""""""\nPhase-9 Tenant Lifecycle States\n\nPIN-400 Phase-9: A tenant must be able to leave the system safely,","\nPhase-9 Tenant Lifecycle States\n\nPIN-400 Phase-9: A tenant must be able to leave the system safely,\ndeterministically, and irreversibly.\n\nThis module defines the lifecycle states that govern tenant runtime existence.\n\nRELATIONSHIP TO ONBOARDING:\n    OnboardingState answers: ""Did you ever earn the right to run?""\n    LifecycleState answers:  ""Are you currently allowed to run?""\n\n    OnboardingState.COMPLETE causes entry into TenantLifecycleState.ACTIVE.\n    They are ADJACENT state machines, not th",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
188,app/auth/tenant_resolver.py,INTERNAL,account,L4,app/houseofcards/internal/account/engines/tenant_resolver.py,"# Layer: L3 — Boundary Adapter\n# AUDIENCE: SHARED\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Single authority for tenant resolution - ends ambiguity\n# Callers: API routers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L4, L5\n# Reference: Tenant Resolution Contract\n\n""""""Tenant Resolver - Single Authority for Tenant Identity\n\nINVARIANT (NON-NEGOTIABLE):","Tenant Resolver - Single Authority for Tenant Identity\n\nINVARIANT (NON-NEGOTIABLE):\n    Tenant identity must be fully resolved before entering the service layer.\n    Services never infer, parse, or default tenant_id.\n\nThis module is the ONLY place where tenant_id is resolved from requests.\nAll downstream code receives UUID, never strings.\n\nRESOLUTION ORDER:\n    1. Auth context (human JWT or DB-backed machine key with tenant)\n    2. X-Tenant-ID header (machine-plane fallback, must be valid UUID)\n",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
189,app/auth/tenant_roles.py,INTERNAL,account,L4,app/houseofcards/internal/account/engines/tenant_roles.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-5 Tenant Role enum and permission derivation\n# Callers: require_role dependency, tenant_members model, role guard\n# Allowed Imports: None (foundational enum)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-5 (Post-Onboarding Permissions & Roles)\n\n""""""\nPhase-5 Tenant Roles — Post-Onboarding Authority Model\n\nPIN-399 Phase-5: Roles do not exist until onboarding is COMPLETE.","\nPhase-5 Tenant Roles — Post-Onboarding Authority Model\n\nPIN-399 Phase-5: Roles do not exist until onboarding is COMPLETE.\n\nDESIGN INVARIANTS (LOCKED):\n- ROLE-001: Roles do not exist before onboarding COMPLETE\n- ROLE-002: Permissions are derived, not stored\n- ROLE-003: Human roles never affect machine scopes\n- ROLE-004: Console origin never grants authority\n- ROLE-005: Role enforcement never mutates state\n\nROLE HIERARCHY:\n    OWNER  → Full control of tenant\n    ADMIN  → Manage config, users\n    ",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure,TRANSFER
190,app/auth/tier_gating.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/tier_gating.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Tier-based feature gating engine\n# Callers: API routes, services\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Auth System\n\n""""""\nTier-Based Feature Gating (M32 Implementation)\n\nProvides:","\nTier-Based Feature Gating (M32 Implementation)\n\nProvides:\n- TenantTier enum (OBSERVE, REACT, PREVENT, ASSIST, GOVERN)\n- PricingPhase toggle (LEARNING = soft limits, AUTHORITY = hard limits)\n- Feature→Tier mapping for 60+ features\n- @requires_tier decorator for FastAPI endpoints\n- Prometheus metrics for tier access decisions\n\nBased on:\n- PIN-155: M32 Tier Infrastructure Blueprint\n- PIN-157: Numeric Pricing Anchors\n\nUsage:\n    from app.auth.tier_gating import requires_tier, TenantTier\n\n    @route",,NEEDS_CLASSIFICATION,ITERATION_1,Auth infrastructure; Domain uncertain,TRANSFER
191,app/billing/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-6 Billing package exports\n# Callers: Any module needing billing functionality\n# Allowed Imports: L4 (billing submodules)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-6 (Billing, Plans & Limits)\n\n""""""\nPhase-6 Billing Package\n\nPIN-399 Phase-6: Billing never blocks onboarding.","\nPhase-6 Billing Package\n\nPIN-399 Phase-6: Billing never blocks onboarding.\n\nThis package provides:\n- BillingState: Commercial state model (TRIAL, ACTIVE, PAST_DUE, SUSPENDED)\n- Plan: Named contracts (not pricing logic)\n- Limits: Derived from plan (not stored)\n- BillingProvider: Protocol for billing operations\n- MockBillingProvider: Deterministic mock implementation\n\nDESIGN INVARIANTS (LOCKED):\n- BILLING-001: Billing never blocks onboarding\n- BILLING-002: Limits are derived, not stored\n- BILLING",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
192,app/billing/limits.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/limits.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-6 Limits derivation (code only, not stored)\n# Callers: BillingProvider, enforcement middleware\n# Allowed Imports: L4 (billing.plan)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-6 (Billing, Plans & Limits)\n\n""""""\nPhase-6 Limits — Derived from Plan (Not Stored)\n\nPIN-399 Phase-6: Limits are derived from plan at runtime, never hand-edited.","\nPhase-6 Limits — Derived from Plan (Not Stored)\n\nPIN-399 Phase-6: Limits are derived from plan at runtime, never hand-edited.\n\nDESIGN INVARIANTS (LOCKED):\n- BILLING-002: Limits are derived, not stored\n\nENFORCEMENT SEMANTICS:\n- Limits are evaluated at runtime\n- Limits are enforced after onboarding COMPLETE\n- Limits may emit warnings before enforcement\n\nWHAT LIMITS CAN DO:\n- Throttle\n- Reject with explicit error\n- Emit usage warnings\n\nWHAT LIMITS MUST NOT DO:\n- Mutate onboarding state\n- Revoke AP",,NEEDS_CLASSIFICATION,ITERATION_1,Billing logic,TRANSFER
193,app/billing/plan.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/plan.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-6 Plan model (abstract, no DB persistence)\n# Callers: BillingProvider, limits derivation\n# Allowed Imports: L4 (billing.state)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-6 (Billing, Plans & Limits)\n\n""""""\nPhase-6 Plan Model — Named Contracts (Not Pricing Logic)\n\nPIN-399 Phase-6: Plans are named contracts, not pricing logic.","\nPhase-6 Plan Model — Named Contracts (Not Pricing Logic)\n\nPIN-399 Phase-6: Plans are named contracts, not pricing logic.\n\nEXPLICIT NON-GOALS:\n- No prices\n- No currency\n- No billing cycle assumptions\n- No gateway IDs\n- No subscriptions\n- No coupons / proration / invoices\n- No taxes\n\nThose come in future phases, if ever.\n\nThis module defines the abstract Plan model used for limit derivation.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Billing logic,TRANSFER
194,app/billing/provider.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/billing_provider.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: runtime\n#   Execution: sync\n# Role: Phase-6 BillingProvider protocol and MockBillingProvider\n# Callers: billing middleware, billing APIs, runtime enforcement\n# Allowed Imports: L4 (billing.state, billing.plan, billing.limits)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-6 (Billing, Plans & Limits)\n\n""""""\nPhase-6 Billing Provider — Interface and Mock Implementation\n\nPIN-399 Phase-6: Mock provider must satisfy same interface as real provider.",\nPhase-6 Billing Provider — Interface and Mock Implementation\n\nPIN-399 Phase-6: Mock provider must satisfy same interface as real provider.\n\nDESIGN INVARIANTS (LOCKED):\n- BILLING-005: Mock provider must satisfy same interface as real provider\n\nIMPLEMENTATION CONSTRAINTS:\n- Hardcoded plan assignment\n- Hardcoded limits\n- Deterministic behavior\n- No network calls\n- No external dependencies\n\nThis ensures zero refactor when Stripe/etc is added later.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Billing logic,TRANSFER
195,app/billing/state.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/state.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-6 Billing State enum\n# Callers: BillingProvider, Tenant model (when extended), billing middleware\n# Allowed Imports: None (foundational enum)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-6 (Billing, Plans & Limits)\n\n""""""\nPhase-6 Billing State — Commercial State Model\n\nPIN-399 Phase-6: Billing never blocks onboarding.","\nPhase-6 Billing State — Commercial State Model\n\nPIN-399 Phase-6: Billing never blocks onboarding.\n\nDESIGN INVARIANTS (LOCKED):\n- BILLING-001: Billing never blocks onboarding\n- BILLING-002: Limits are derived, not stored\n- BILLING-003: Billing state does not affect roles\n- BILLING-004: No billing mutation without audit\n- BILLING-005: Mock provider must satisfy same interface as real provider\n\nAPPLICABILITY GATE:\n    Billing logic is evaluated ONLY IF tenant.onboarding_state == COMPLETE.\n    Befo",,NEEDS_CLASSIFICATION,ITERATION_1,Billing logic,TRANSFER
196,app/commands/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Commands\n# Product: system-wide\n# Role: Package for L4 domain command facades\n# Reference: PIN-258 Phase F\n\n""""""\nL4 Domain Commands Package\n\nThis package contains L4 domain command facades that:\n- Receive domain facts (not execution context)\n- Make domain decisions\n- Produce command specs or rejections\n- Delegate to L5 for execution (L4 → L5 is allowed)\n\nCommands must:","\nL4 Domain Commands Package\n\nThis package contains L4 domain command facades that:\n- Receive domain facts (not execution context)\n- Make domain decisions\n- Produce command specs or rejections\n- Delegate to L5 for execution (L4 → L5 is allowed)\n\nCommands must:\n- Only import from L4, L5, and L6 (L4 → L5 allowed per layer rules)\n- Never import from L1, L2, L3\n- Authorize and delegate, not contain execution logic\n- Return result types, not raw L5 objects\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
197,app/commands/policy_command.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_command.py,"# Layer: L4 — Domain Engine (Command Facade)\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async (delegates to L5)\n# Role: Policy evaluation and decision authority\n# Callers: policy_adapter.py (L3)\n# Allowed Imports: L4, L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-258 Phase F-3 Policy Cluster\n# Contract: PHASE_F_FIX_DESIGN (F-P-RULE-1 to F-P-RULE-5)\n#\n# GOVERNANCE NOTE (F-P-RULE-1):\n# This L4 command owns ALL policy decisions. L2/L3 must NEVER evaluate\n# policy truth. All cost feasibility, policy enforcement, and outcome","\nPolicy Command (L4)\n\nDomain command for policy evaluation and approval workflow. This L4 command:\n1. Owns all policy decisions (cost feasibility, violations, outcomes)\n2. Delegates to L5 for execution (metrics, simulation, enforcement)\n3. Returns result objects to L3 adapter\n\nThis command may import L5 (workflow.metrics, workflow.cost_sim, workflow.policies)\nbecause L4 → L5 is allowed per layer rules.\n\nReference: PIN-258 Phase F-3 Policy Cluster\n",,NEEDS_CLASSIFICATION,ITERATION_1,Commands,TRANSFER
198,app/commands/runtime_command.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/runtime_command.py,"# Layer: L4 — Domain Engine (Command Facade)\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Runtime domain commands and query logic\n# Callers: runtime_adapter.py (L3)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-258 Phase F-3 Runtime Cluster\n# Contract: PHASE_F_FIX_DESIGN (L4 Command = Data)\n#\n# GOVERNANCE NOTE: This L4 engine provides domain decisions for runtime operations.\n# It must NOT execute skills or import L5 workers.\n# All domain knowledge about skills, contracts, and queries lives here.","\nRuntime Domain Commands (L4)\n\nDomain engine for runtime-related decisions. Provides authoritative answers for:\n1. Skill descriptions - what skills exist and their metadata\n2. Runtime queries - budget, history, capability information\n3. Resource contracts - budget, rate limits, constraints\n\nThis is an L4 domain engine. It makes decisions based on domain facts.\nIt does NOT execute skills. Execution is L5's responsibility.\n\nReference: PIN-258 Phase F-3 Runtime Cluster\n",,NEEDS_CLASSIFICATION,ITERATION_1,Commands,TRANSFER
199,app/commands/worker_execution_command.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/worker_execution_command.py,"# Layer: L4 — Domain Engine (Command Facade)\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async (delegates to L5)\n# Role: Worker execution authorization and delegation\n# Callers: workers_adapter.py (L3)\n# Allowed Imports: L4, L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-258 Phase F-3 Workers Cluster\n# Contract: PHASE_F_FIX_DESIGN (F-W-RULE-1 to F-W-RULE-5)\n#\n# GOVERNANCE NOTE (F-W-RULE-3):\n# This L4 command takes facts, makes authorization decisions, and delegates\n# to L5 for execution. It does NOT contain execution logic itself.","\nWorker Execution Command (L4)\n\nDomain command for Business Builder Worker execution. This L4 command:\n1. Takes domain facts (task, brand, budget, etc.)\n2. Provides authorization for execution\n3. Delegates to L5 workers (since L4 → L5 is allowed)\n4. Returns results\n\nThis is NOT an execution layer. It authorizes and delegates.\nAll execution logic remains in L5 workers.\n\nReference: PIN-258 Phase F-3 Workers Cluster\n",,NEEDS_CLASSIFICATION,ITERATION_1,Commands,TRANSFER
200,app/config/__init__.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/__init__.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Configuration package marker\n# Callers: Config imports\n# Allowed Imports: None\n# Forbidden Imports: None\n# Reference: Package Structure\n\n# Configuration module\n""""""\nRuntime configuration and feature flags.\n","\nRuntime configuration and feature flags.\n\nUsage:\n    from app.config import get_feature_flag, is_flag_enabled\n\n    if is_flag_enabled(""failure_catalog_runtime_integration""):\n        # Use enriched error handling\n        pass\n",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Config),TRANSFER
201,app/config/console_modes.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/console_modes.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Runtime safety switches for console deployment\n# Callers: API routes, services, middleware\n# Allowed Imports: None (foundational config)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Console Deployment Plan\n\n""""""\nConsole Runtime Safety Switches\n\nThree environment variables control console behavior:",\nConsole Runtime Safety Switches\n\nThree environment variables control console behavior:\n\nCONSOLE_MODE:\n    - DRAFT: Console is in draft/development mode\n    - LIVE: Console is production-ready\n    - MAINTENANCE: Console is in maintenance mode\n\nDATA_MODE:\n    - SYNTHETIC: Use synthetic/mock data\n    - REAL: Use real production data\n\nACTION_MODE:\n    - NOOP: All write/activate actions are logged but not executed\n    - LIVE: All actions execute normally\n\nSafety Matrix:\n┌─────────────────┬──────────,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Config),TRANSFER
202,app/config/flag_sync.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/flag_sync.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler\n#   Execution: async\n# Role: Feature flag synchronization\n# Callers: Background jobs\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Configuration\n\n""""""\nFeature Flag File↔DB Sync Shim\n\nProvides bi-directional sync between file-based feature_flags.json and DB-backed flags.",\nFeature Flag File↔DB Sync Shim\n\nProvides bi-directional sync between file-based feature_flags.json and DB-backed flags.\nThis is a transitional component for migration from file to DB storage.\n\nUsage:\n    # Sync file → DB (initial migration)\n    python -m app.config.flag_sync --direction file-to-db\n\n    # Sync DB → file (for canary compatibility)\n    python -m app.config.flag_sync --direction db-to-file\n\n    # Check consistency\n    python -m app.config.flag_sync --check-only\n\nDesign:\n    - Uses ,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Config),TRANSFER
203,app/config/secrets.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/secrets.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Secret loading and configuration\n# Callers: All modules needing secrets\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Configuration\n\n""""""\nCentralized Secret Access Module\n================================\n",\nCentralized Secret Access Module\n================================\n\nINVARIANT: No script or module should call os.environ.get() for secrets directly.\n           All secret access MUST go through this module.\n\nThis module provides:\n1. Typed accessors for all secrets\n2. Validation at access time (fail-fast)\n3. Clear categorization (REQUIRED vs OPTIONAL)\n4. Startup invariant checking\n\nUsage:\n    from app.config.secrets import Secrets\n\n    # Get required secret (raises if missing)\n    key = Secrets.,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Config),TRANSFER
204,app/contracts/__init__.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/__init__.py,"""""""\nData Contracts Module - M29 Data Contract Freeze\n\nThis module defines the FROZEN API contracts for AOS.\nThese contracts are IMMUTABLE once deployed.\n\nContract Invariants:\n1. Field names NEVER change (use deprecation instead)\n2. Required fields NEVER become optional\n3. Types NEVER widen (int -> float is FORBIDDEN)\n4. New optional fields MAY be added (backward compatible)\n5. Removal requires 2-version deprecation cycle\n\nDomains:\n- guard: Customer Console contracts (tenant-scoped)",\nData Contracts Module - M29 Data Contract Freeze\n\nThis module defines the FROZEN API contracts for AOS.\nThese contracts are IMMUTABLE once deployed.\n\nContract Invariants:\n1. Field names NEVER change (use deprecation instead)\n2. Required fields NEVER become optional\n3. Types NEVER widen (int -> float is FORBIDDEN)\n4. New optional fields MAY be added (backward compatible)\n5. Removal requires 2-version deprecation cycle\n\nDomains:\n- guard: Customer Console contracts (tenant-scoped)\n- ops: Founder O,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
205,app/contracts/common.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/common.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Common contract definitions\n# Callers: contracts/*\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Contract System\n\n""""""\nCommon Data Contracts - Shared Infrastructure Types\n\nThese are NON-DOMAIN contracts used by both consoles:",\nCommon Data Contracts - Shared Infrastructure Types\n\nThese are NON-DOMAIN contracts used by both consoles:\n- Health checks\n- Error responses\n- Pagination\n\nThese are the ONLY contracts allowed to be shared between domains.\nDomain-specific data MUST NOT be in this module.\n\nFrozen: 2025-12-23 (M29)\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Contracts),TRANSFER
206,app/contracts/decisions.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/decisions.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Decision contract enforcement\n# Callers: API routes, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Contract System\n\n""""""Phase 4B: Decision Record Models and Service\n\nImplements DECISION_RECORD_CONTRACT v0.2.\n",Phase 4B: Decision Record Models and Service\n\nImplements DECISION_RECORD_CONTRACT v0.2.\n\nContract-mandated fields:\n- decision_source: human | system | hybrid\n- decision_trigger: explicit | autonomous | reactive\n\nRule: Emit records where decisions already happen. No logic changes.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Contracts),TRANSFER
207,app/contracts/guard.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/guard.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Guard contract for access control\n# Callers: API routes\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Contract System\n\n""""""\nGuard Console Data Contracts - Customer-Facing API\n\nDOMAIN: Customer Console (/guard/*)","\nGuard Console Data Contracts - Customer-Facing API\n\nDOMAIN: Customer Console (/guard/*)\nAUDIENCE: Customers (tenant-scoped access)\nAUTH: aud=""console"", requires org_id\n\nThese contracts are FROZEN as of M29. Changes require:\n1. Deprecation annotation\n2. 2-version grace period\n3. PIN documentation\n\nINVARIANTS:\n- All responses are tenant-scoped (no cross-tenant data)\n- No founder-only fields (those belong in ops.py)\n- Times are ISO8601 strings\n- IDs are prefixed strings (inc_, key_, etc.)\n",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Contracts),TRANSFER
208,app/contracts/ops.py,CUSTOMER,ops,L6,app/houseofcards/customer/ops/schemas/ops.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Ops contract definitions\n# Callers: Ops console API\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Contract System\n\n""""""\nOps Console Data Contracts - Founder-Facing API\n\nDOMAIN: Founder Ops Console (/ops/*)","\nOps Console Data Contracts - Founder-Facing API\n\nDOMAIN: Founder Ops Console (/ops/*)\nAUDIENCE: Founders/Operators (global view)\nAUTH: aud=""fops"", requires mfa=true\n\nThese contracts are FROZEN as of M29. Changes require:\n1. Deprecation annotation\n2. 2-version grace period\n3. PIN documentation\n\nINVARIANTS:\n- All responses are GLOBAL (cross-tenant aggregation allowed)\n- Contains founder-only intelligence (not for customers)\n- Times are ISO8601 strings\n- IDs are prefixed strings (tenant_*, etc.)\n\n",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Contracts),TRANSFER
209,app/core/__init__.py,INTERNAL,logs,L6,app/houseofcards/internal/logs/drivers/__init__.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Role: Core module - foundational primitives\n# Reference: ExecutionContext Specification v1.0\n\n""""""\nCore Module\n\nFoundational primitives for the AOS runtime.\n""""""\n\nfrom app.core.execution_context import (\n    EvidenceSource,\n    ExecutionContext,\n    ExecutionPhase,",\nCore Module\n\nFoundational primitives for the AOS runtime.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Core utilities,TRANSFER
210,app/core/execution_context.py,INTERNAL,policies,L4,app/houseofcards/internal/policies/engines/execution_context.py,"# Layer: L6 — Platform Substrate\n# AUDIENCE: INTERNAL\n# PHASE: W0\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker | sdk\n#   Execution: sync\n# Role: ExecutionContext - authoritative execution identity and causality carrier\n# Callers: runner, skills, adapters, policy engine, evidence capture\n# Allowed Imports: None (pure value object)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: ExecutionContext Specification v1.1\n\n""""""\nExecutionContext Specification v1.1",\nExecutionContext Specification v1.1\n\nThe ExecutionContext is the single source of truth for execution identity\nand causality across the system.\n\nArchitecture (v1.1 - Structural Authority):\n- ExecutionContext: Read-only execution identity (consumed by evidence writers)\n- ExecutionCursor: Step advancement authority (owned only by executor)\n\nRules:\n- Created once at intent acceptance / run creation\n- Propagated everywhere (never reconstructed)\n- Step advancement is structurally restricted to Execu,,NEEDS_CLASSIFICATION,ITERATION_1,Execution context,TRANSFER
211,app/core/failure_semantics.py,INTERNAL,incidents,L6,app/houseofcards/internal/incidents/drivers/failure_semantics.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api | sdk | worker\n#   Execution: sync\n# Role: Customer-visible failure semantics with category classification\n# Callers: SDK facades, L2 API routes, lifecycle handlers\n# Allowed Imports: None (pure value object)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: INV-W0-004\n\n""""""\nModule: failure_semantics\nPurpose: Provide structured failure semantics for customer-visible errors.\n","\nModule: failure_semantics\nPurpose: Provide structured failure semantics for customer-visible errors.\n\nINV-W0-004: All customer-visible failures MUST be categorized.\n\nCustomers cannot distinguish between ""try again later"" and ""this will never work""\nwithout explicit failure categories. This module provides the standard structure.\n\nCategories:\n    TRANSIENT: Retry may succeed (network, rate limit, temporary outage)\n    PERMANENT: Retry will not succeed (invalid input, missing resource)\n    POLICY:",,NEEDS_CLASSIFICATION,ITERATION_1,Core utilities,TRANSFER
212,app/costsim/__init__.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/__init__.py,"# CostSim V2 Package (M6)\n""""""\nCost Simulation V2 with sandbox evaluation path.\n\nComponents:\n- v2_adapter: CostSimV2Adapter for enhanced simulation\n- provenance: Full provenance logging\n- canary: Daily canary runner\n- sandbox: Sandbox routing via feature flag\n- circuit_breaker: Auto-disable on drift\n- metrics: Drift detection metrics\n- divergence: Divergence reporting\n- datasets: Reference dataset validation\n""""""\n",\nCost Simulation V2 with sandbox evaluation path.\n\nComponents:\n- v2_adapter: CostSimV2Adapter for enhanced simulation\n- provenance: Full provenance logging\n- canary: Daily canary runner\n- sandbox: Sandbox routing via feature flag\n- circuit_breaker: Auto-disable on drift\n- metrics: Drift detection metrics\n- divergence: Divergence reporting\n- datasets: Reference dataset validation\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
213,app/costsim/alert_worker.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/alert_worker.py,"""""""\nCostSim Alert Worker - Reliable Alert Delivery\n\nBackground worker for reliable alert delivery.\n\nThis worker processes the alert queue, sending alerts to Alertmanager\nwith exponential backoff retry logic. It ensures alerts are delivered\neven if Alertmanager is temporarily unavailable.\n\nFeatures:\n- Exponential backoff (1s, 2s, 4s, 8s, ... up to max_backoff)\n- Maximum retry attempts (configurable, default 10)\n- Dead letter handling (marks alerts as failed after max attempts)\n- Leader election (only one worker processes at a time)\n- Batch processing for efficiency","\nCostSim Alert Worker - Reliable Alert Delivery\n\nBackground worker for reliable alert delivery.\n\nThis worker processes the alert queue, sending alerts to Alertmanager\nwith exponential backoff retry logic. It ensures alerts are delivered\neven if Alertmanager is temporarily unavailable.\n\nFeatures:\n- Exponential backoff (1s, 2s, 4s, 8s, ... up to max_backoff)\n- Maximum retry attempts (configurable, default 10)\n- Dead letter handling (marks alerts as failed after max attempts)\n- Leader election (onl",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Worker,TRANSFER
214,app/costsim/canary.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/canary.py,"# CostSim V2 Canary Runner (M6)\n""""""\nDaily canary runner for CostSim V2 validation.\n\nThe canary runner:\n1. Acquires leader lock (only one instance runs at a time)\n2. Loads a sample of historical simulation requests\n3. Runs both V1 and V2 on each sample\n4. Computes drift metrics (KL divergence, percentiles, outliers)\n5. Compares V2 against golden reference datasets\n6. Produces a CanaryReport with pass/fail verdict\n7. Triggers circuit breaker if drift exceeds thresholds\n\nRuns daily via systemd timer or cron.\n","\nDaily canary runner for CostSim V2 validation.\n\nThe canary runner:\n1. Acquires leader lock (only one instance runs at a time)\n2. Loads a sample of historical simulation requests\n3. Runs both V1 and V2 on each sample\n4. Computes drift metrics (KL divergence, percentiles, outliers)\n5. Compares V2 against golden reference datasets\n6. Produces a CanaryReport with pass/fail verdict\n7. Triggers circuit breaker if drift exceeds thresholds\n\nRuns daily via systemd timer or cron.\n\nLeader Election:\n    On",,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
215,app/costsim/cb_sync_wrapper.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/cb_sync_wrapper.py,"# CostSim Circuit Breaker Sync Wrapper\n""""""\nThread-safe sync wrapper for async circuit breaker functions.\n\nThis module provides sync-compatible wrappers that safely execute\nasync circuit breaker functions from sync contexts, including when\nan event loop is already running.\n\nWhy this exists:\n- The async circuit breaker functions use asyncpg which requires an event loop\n- Some callers may be sync (e.g., middleware, legacy code)\n- Calling asyncio.run() from a running event loop raises RuntimeError\n- The naive workaround of returning True (disabled) is too conservative\n  and causes false-positive V2 disables\n","\nThread-safe sync wrapper for async circuit breaker functions.\n\nThis module provides sync-compatible wrappers that safely execute\nasync circuit breaker functions from sync contexts, including when\nan event loop is already running.\n\nWhy this exists:\n- The async circuit breaker functions use asyncpg which requires an event loop\n- Some callers may be sync (e.g., middleware, legacy code)\n- Calling asyncio.run() from a running event loop raises RuntimeError\n- The naive workaround of returning True (d",,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
216,app/costsim/circuit_breaker.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/circuit_breaker.py,"from __future__ import annotations\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# DB-backed circuit breaker state tracking with SELECT FOR UPDATE\n# State mutations are atomic and recoverable\nFEATURE_INTENT = FeatureIntent.STATE_MUTATION\nRETRY_POLICY = RetryPolicy.SAFE\n\n# CostSim V2 Circuit Breaker (M6 - DB-backed)\n""""""\nDB-backed auto-disable circuit breaker for CostSim V2.\n\nFeatures:",Current state of the circuit breaker (in-memory representation).,,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
217,app/costsim/circuit_breaker_async.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/circuit_breaker_async.py,"from __future__ import annotations\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Async DB-backed circuit breaker state tracking with SELECT FOR UPDATE\n# State mutations are atomic and recoverable\nFEATURE_INTENT = FeatureIntent.STATE_MUTATION\nRETRY_POLICY = RetryPolicy.SAFE\n\n# CostSim V2 Circuit Breaker - Async Implementation\n""""""\nFully async DB-backed circuit breaker for CostSim V2.\n\nThis module provides non-blocking database access using SQLAlchemy async",Current state of the circuit breaker.,,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
218,app/costsim/config.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/config.py,"# CostSim V2 Configuration (M6)\n""""""\nFeature flags and configuration for CostSim V2 sandbox.\n\nEnvironment Variables:\n- COSTSIM_V2_SANDBOX: Enable V2 sandbox path (default: false)\n- COSTSIM_V2_AUTO_DISABLE: Enable auto-disable on drift (default: true)\n- COSTSIM_DRIFT_THRESHOLD: Max acceptable drift score (default: 0.2)\n- COSTSIM_CANARY_ENABLED: Enable daily canary runner (default: true)\n- ALERTMANAGER_URL: Alertmanager API endpoint for alerts\n- INSTANCE_ID: Instance identifier for alerts\n""""""\n\nfrom __future__ import annotations\n",\nFeature flags and configuration for CostSim V2 sandbox.\n\nEnvironment Variables:\n- COSTSIM_V2_SANDBOX: Enable V2 sandbox path (default: false)\n- COSTSIM_V2_AUTO_DISABLE: Enable auto-disable on drift (default: true)\n- COSTSIM_DRIFT_THRESHOLD: Max acceptable drift score (default: 0.2)\n- COSTSIM_CANARY_ENABLED: Enable daily canary runner (default: true)\n- ALERTMANAGER_URL: Alertmanager API endpoint for alerts\n- INSTANCE_ID: Instance identifier for alerts\n,,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
219,app/costsim/datasets.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/datasets.py,"# CostSim V2 Reference Datasets (M6)\n""""""\nReference datasets for V2 validation.\n\nRequired datasets (5):\n1. low_variance - Simple, predictable plans\n2. high_variance - Complex, high-variance plans\n3. mixed_city - Mixed workload patterns\n4. noise_injected - Plans with deliberate noise\n5. historical - Real historical data samples\n\nEach dataset provides:\n- Sample plans for testing\n- Expected V2 behavior\n- Validation metrics thresholds","\nReference datasets for V2 validation.\n\nRequired datasets (5):\n1. low_variance - Simple, predictable plans\n2. high_variance - Complex, high-variance plans\n3. mixed_city - Mixed workload patterns\n4. noise_injected - Plans with deliberate noise\n5. historical - Real historical data samples\n\nEach dataset provides:\n- Sample plans for testing\n- Expected V2 behavior\n- Validation metrics thresholds\n",,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
220,app/costsim/divergence.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/divergence.py,"# CostSim V2 Divergence Reporting (M6)\n""""""\nCost divergence reporting between V1 and V2.\n\nProvides:\n- delta_p50: Median cost delta\n- delta_p90: 90th percentile cost delta\n- kl_divergence: KL divergence between cost distributions\n- outlier_count: Number of outlier samples\n- fail_ratio: Ratio of major drift samples\n- matching_rate: Ratio of matching samples\n\nReports can be generated:\n- On-demand via API\n- Automatically by canary runner",\nCost divergence reporting between V1 and V2.\n\nProvides:\n- delta_p50: Median cost delta\n- delta_p90: 90th percentile cost delta\n- kl_divergence: KL divergence between cost distributions\n- outlier_count: Number of outlier samples\n- fail_ratio: Ratio of major drift samples\n- matching_rate: Ratio of matching samples\n\nReports can be generated:\n- On-demand via API\n- Automatically by canary runner\n- Scheduled via cron/systemd timer\n,,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
221,app/costsim/leader.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/leader.py,"# CostSim Leader Election via PostgreSQL Advisory Locks\n""""""\nLeader election using PostgreSQL advisory locks.\n\nThis module provides a simple leader election mechanism for scenarios where\nonly one instance should run a task (e.g., daily canary runs). Uses\npg_try_advisory_lock() which is session-scoped and automatically released\nwhen the connection closes.\n\nUsage:\n    from app.costsim.leader import try_acquire_leader_lock, LeaderContext\n\n    # Simple check\n    async with AsyncSessionLocal() as session:\n        if await try_acquire_leader_lock(session, LOCK_CANARY_RUNNER):","\nLeader election using PostgreSQL advisory locks.\n\nThis module provides a simple leader election mechanism for scenarios where\nonly one instance should run a task (e.g., daily canary runs). Uses\npg_try_advisory_lock() which is session-scoped and automatically released\nwhen the connection closes.\n\nUsage:\n    from app.costsim.leader import try_acquire_leader_lock, LeaderContext\n\n    # Simple check\n    async with AsyncSessionLocal() as session:\n        if await try_acquire_leader_lock(session, LOCK",,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
222,app/costsim/metrics.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/metrics.py,"# CostSim V2 Drift Detection Metrics (M6)\n""""""\nPrometheus metrics for CostSim V2 drift detection.\n\nMetrics (6 required):\n1. costsim_v2_drift_score - Drift score histogram\n2. costsim_v2_cost_delta_cents - Cost delta distribution\n3. costsim_v2_schema_errors_total - Schema validation errors\n4. costsim_v2_simulation_duration_ms - V2 simulation latency\n5. costsim_v2_comparison_verdict - Verdict distribution\n6. costsim_v2_circuit_breaker_state - Circuit breaker state\n\nAlert Rules:\n- P1: drift_score > 0.2 for 5m (auto-disable)\n- P2: drift_score > 0.15 for 15m (warning)",\nPrometheus metrics for CostSim V2 drift detection.\n\nMetrics (6 required):\n1. costsim_v2_drift_score - Drift score histogram\n2. costsim_v2_cost_delta_cents - Cost delta distribution\n3. costsim_v2_schema_errors_total - Schema validation errors\n4. costsim_v2_simulation_duration_ms - V2 simulation latency\n5. costsim_v2_comparison_verdict - Verdict distribution\n6. costsim_v2_circuit_breaker_state - Circuit breaker state\n\nAlert Rules:\n- P1: drift_score > 0.2 for 5m (auto-disable)\n- P2: drift_score > ,,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
223,app/costsim/models.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/costsim_models.py,"# CostSim V2 Models (M6)\n""""""\nData models for CostSim V2 sandbox evaluation.\n""""""\n\nfrom __future__ import annotations\n\nimport hashlib\nimport json\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timezone\nfrom enum import Enum\nfrom typing import Any, Dict, List, Optional\n\n",\nData models for CostSim V2 sandbox evaluation.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
224,app/costsim/provenance.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/provenance.py,"# CostSim V2 Provenance Logging (M6)\n""""""\nFull provenance logging for CostSim V2 sandbox.\n\nLogs:\n- input_hash: SHA256 of input\n- output_hash: SHA256 of output\n- input_json: Full input (optionally compressed)\n- output_json: Full output (optionally compressed)\n- model_version: V2 model version\n- adapter_version: Adapter version\n- commit_sha: Git commit\n- runtime_ms: Execution time\n- status: success/error/schema_error\n- tenant_id: Tenant if present",\nFull provenance logging for CostSim V2 sandbox.\n\nLogs:\n- input_hash: SHA256 of input\n- output_hash: SHA256 of output\n- input_json: Full input (optionally compressed)\n- output_json: Full output (optionally compressed)\n- model_version: V2 model version\n- adapter_version: Adapter version\n- commit_sha: Git commit\n- runtime_ms: Execution time\n- status: success/error/schema_error\n- tenant_id: Tenant if present\n,,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
225,app/costsim/provenance_async.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/provenance_async.py,"# CostSim V2 Provenance Logger - Async Implementation\n""""""\nAsync provenance logging for CostSim V2.\n\nThis module provides non-blocking database access for writing provenance\nrecords. Use this instead of the sync provenance.py for all async code paths.\n\nFeatures:\n- Non-blocking DB operations (won't hang event loop)\n- Batch writing support for high-throughput scenarios\n- Deduplication via input_hash\n- V1 baseline backfill support\n\nUsage:\n    from app.costsim.provenance_async import (","\nAsync provenance logging for CostSim V2.\n\nThis module provides non-blocking database access for writing provenance\nrecords. Use this instead of the sync provenance.py for all async code paths.\n\nFeatures:\n- Non-blocking DB operations (won't hang event loop)\n- Batch writing support for high-throughput scenarios\n- Deduplication via input_hash\n- V1 baseline backfill support\n\nUsage:\n    from app.costsim.provenance_async import (\n        write_provenance,\n        write_provenance_batch,\n        query",,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
226,app/costsim/sandbox.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/sandbox.py,"# CostSim V2 Sandbox Routing (M6)\n""""""\nSandbox routing layer for CostSim V1 vs V2.\n\nFeature flag controlled routing:\n- COSTSIM_V2_SANDBOX=false (default): Only V1, no V2\n- COSTSIM_V2_SANDBOX=true: Run both V1 and V2, log comparison\n\nThe sandbox NEVER changes production behavior. V1 is always\nthe source of truth. V2 runs in shadow mode for validation.\n""""""\n\nfrom __future__ import annotations\n\nimport logging","\nSandbox routing layer for CostSim V1 vs V2.\n\nFeature flag controlled routing:\n- COSTSIM_V2_SANDBOX=false (default): Only V1, no V2\n- COSTSIM_V2_SANDBOX=true: Run both V1 and V2, log comparison\n\nThe sandbox NEVER changes production behavior. V1 is always\nthe source of truth. V2 runs in shadow mode for validation.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Cost simulation,TRANSFER
227,app/costsim/v2_adapter.py,CUSTOMER,analytics,L3,app/houseofcards/customer/analytics/facades/v2_adapter.py,"# CostSim V2 Adapter (M6)\n# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: async\n# Role: Cost simulation adapter (translation only)\n# Callers: simulation endpoints, workflow engine\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-254 Phase B Fix\n""""""\nCostSim V2 Adapter - Enhanced simulation with confidence scoring.\n\nB02 FIX: Cost modeling logic moved to L4 CostModelEngine.","\nCostSim V2 Adapter - Enhanced simulation with confidence scoring.\n\nB02 FIX: Cost modeling logic moved to L4 CostModelEngine.\nThis adapter now delegates domain decisions to L4:\n- Step cost estimation → L4 estimate_step_cost()\n- Feasibility checks → L4 check_feasibility()\n- Drift classification → L4 classify_drift()\n\nL3 responsibility: shape, transport, provenance, context binding.\n\nThis adapter wraps V1 CostSimulator and adds:\n1. Confidence scoring (delegated to L4)\n2. V2-specific model calculat",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
228,app/db.py,INTERNAL,agent,L6,app/houseofcards/internal/agent/drivers/db.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any (import-time lazy, runtime on-demand)\n#   Execution: sync (connection pooled)\n# Role: Database connection, SQLModel definitions, session management\n# Callers: All services, API routes, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Infrastructure\n\nimport os\nimport uuid\nfrom contextlib import asynccontextmanager\nfrom datetime import date, datetime, timezone",Lazy proxy for SQLAlchemy engine to avoid import-time initialization.,,NEEDS_CLASSIFICATION,ITERATION_1,Database connection,TRANSFER
229,app/db_async.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/db_async.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any (async contexts)\n#   Execution: async\n# Role: Async SQLAlchemy session factory for non-blocking DB operations\n# Callers: Async API routes, async services\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Infrastructure\n\n""""""\nAsync SQLAlchemy session factory for non-blocking DB operations.\n\nThis module provides async database access using SQLAlchemy 2.0+ async support","\nAsync SQLAlchemy session factory for non-blocking DB operations.\n\nThis module provides async database access using SQLAlchemy 2.0+ async support\nwith asyncpg driver. Use this for all new async code paths.\n\nUsage:\n    from app.db_async import get_async_session, AsyncSessionLocal\n\n    # As context manager\n    async with AsyncSessionLocal() as session:\n        result = await session.execute(select(Model))\n\n    # With dependency injection\n    async def endpoint(session: AsyncSession = Depends(get_a",,NEEDS_CLASSIFICATION,ITERATION_1,Async database; Domain uncertain,TRANSFER
230,app/db_helpers.py,INTERNAL,analytics,L6,app/houseofcards/internal/analytics/drivers/db_helpers.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: SQLModel query helpers to prevent Row tuple extraction bugs\n# Callers: All DB-accessing code\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Infrastructure\n\n""""""Database Query Helpers - Prevent SQLModel Row Tuple Issues\n\nSQLModel's session.exec() returns Row tuples, not model instances directly.\nThese helpers ensure consistent extraction patterns across the codebase.","Database Query Helpers - Prevent SQLModel Row Tuple Issues\n\nSQLModel's session.exec() returns Row tuples, not model instances directly.\nThese helpers ensure consistent extraction patterns across the codebase.\n\nUsage:\n    from app.db_helpers import query_one, query_all, query_scalar\n\n    # Instead of: row = session.exec(stmt).first(); obj = row[0] if row else None\n    obj = query_one(session, stmt)\n\n    # Instead of: objs = [r[0] for r in session.exec(stmt).all()]\n    objs = query_all(session, st",,NEEDS_CLASSIFICATION,ITERATION_1,Database helpers,TRANSFER
231,app/discovery/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Discovery system package marker\n# Callers: Discovery imports\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Package Structure\n\n""""""\nDiscovery Ledger - Phase C observational signal log.\n\nPassive, append-only system that records interesting signals.","\nDiscovery Ledger - Phase C observational signal log.\n\nPassive, append-only system that records interesting signals.\nDoes NOT enforce visibility. Does NOT require approval.\n\nUsage:\n    from app.discovery import emit_signal\n\n    emit_signal(\n        artifact=""prediction_events"",\n        signal_type=""high_operator_access"",\n        evidence={""count_7d"": 21, ""route"": ""/api/v1/predictions""},\n        confidence=0.8,\n        detected_by=""api_access_monitor""\n    )\n\nReference: docs/contracts/visibility_l",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
232,app/discovery/ledger.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/ledger.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Discovery ledger for artifact tracking\n# Callers: API routes, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Discovery System\n\n""""""\nDiscovery Ledger - signal recording helpers.\n\nCore principle: Discovery Ledger records curiosity, not decisions.","\nDiscovery Ledger - signal recording helpers.\n\nCore principle: Discovery Ledger records curiosity, not decisions.\n\nThis module provides:\n- emit_signal(): Record a discovery signal (aggregating duplicates)\n- DiscoverySignal: Pydantic model for signal data\n\nSignals are aggregated: same (artifact, field, signal_type) updates seen_count.\nNothing in the system depends on this table - it's pure observation.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Discovery; Domain uncertain,TRANSFER
233,app/domain/__init__.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: internal\n#   Execution: sync\n# Role: Domain package providing canonical exports for business rules\n# Callers: L5 workers, L3 adapters, L8 tests\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-267\n\n""""""\nL4 Domain Layer - Canonical business rule exports.\n\nThis package provides the stable public interface for domain concepts.",\nL4 Domain Layer - Canonical business rule exports.\n\nThis package provides the stable public interface for domain concepts.\nAll domain logic should be accessed through this layer's exports.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Domain logic,TRANSFER
234,app/domain/failure_intelligence.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/failure_intelligence.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: internal\n#   Execution: sync\n# Role: Canonical export surface for failure intelligence domain concepts\n# Callers: L5 workers, L3 adapters, L8 tests (test_failure_catalog_m9.py)\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-267 (CI Logic Issue Tracker)\n\n""""""\nFailure Intelligence Domain Facade (L4).\n\nThis module provides the canonical public interface for failure classification","\nFailure Intelligence Domain Facade (L4).\n\nThis module provides the canonical public interface for failure classification\nand recovery intelligence. It re-exports stable domain concepts from their\nimplementation locations, hiding internal job/service placement from callers.\n\nDesign Principle:\n    ""Tests do not define architecture. Architecture defines tests.""\n\n    Tests import from this facade. The facade decides which implementations\n    to expose. Implementation modules can be refactored witho",,NEEDS_CLASSIFICATION,ITERATION_1,Domain logic,TRANSFER
235,app/domain/tenants/__init__.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Role: Tenant domain exports\n# Reference: docs/architecture/contracts/AUTHORITY_CONTRACT.md\n\n""""""\nTenant Domain\n\nProvides:\n- TenantState: Enum of valid tenant states\n- TenantStateResolver: Derives tenant state from account/user readiness\n- require_tenant_ready: Gate function for auth middleware\n""""""\n\nfrom app.domain.tenants.state_resolver import (",\nTenant Domain\n\nProvides:\n- TenantState: Enum of valid tenant states\n- TenantStateResolver: Derives tenant state from account/user readiness\n- require_tenant_ready: Gate function for auth middleware\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/domain/__init__.py,SKIP_INIT_COLLISION
236,app/domain/tenants/state_resolver.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/state_resolver.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Tenant state derivation (authoritative)\n# Callers: Auth middleware, API endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/architecture/contracts/AUTHORITY_CONTRACT.md\n\n""""""\nTenant State Resolver\n\nDerives tenant state from account and user readiness.","\nTenant State Resolver\n\nDerives tenant state from account and user readiness.\nState is COMPUTED, not manually set.\n\nDesign Rules:\n- State is derived from: account → users → bindings → billing\n- onboarding_state column is CACHED, system-owned\n- No direct updates except via resolver\n- Auth must fail loudly with explicit state info\n\nState Derivation:\n    CREATED (0)      → tenant exists\n    CONFIGURING (1)  → account created\n    VALIDATING (2)   → at least one user exists\n    PROVISIONING (3) → use",,NEEDS_CLASSIFICATION,ITERATION_1,Domain logic,TRANSFER
237,app/dsl/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: import\n#   Execution: sync\n# Role: Policy DSL module initialization\n# Reference: PIN-341, PIN-345\n\n""""""\nGC_L Policy DSL Module\n\nThis module provides the core DSL infrastructure for policy evaluation:\n- AST definitions (immutable, typed structures)\n- Parser (DSL text → AST)\n- Validator (semantic rule enforcement)","\nGC_L Policy DSL Module\n\nThis module provides the core DSL infrastructure for policy evaluation:\n- AST definitions (immutable, typed structures)\n- Parser (DSL text → AST)\n- Validator (semantic rule enforcement)\n- IR Compiler (AST → bytecode)\n- Interpreter (pure evaluation)\n\nGOVERNANCE: This module is PURE. No I/O, no DB, no side effects.\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
238,app/dsl/ast.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/ast.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: import\n#   Execution: sync\n# Role: Policy DSL AST node definitions (immutable, typed)\n# Reference: PIN-341 Section 1.8, PIN-345\n\n""""""\nPolicy DSL Abstract Syntax Tree (AST) Definitions\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- All nodes are IMMUTABLE (frozen dataclasses)\n- No dynamic fields\n- No generic dicts (typed structures only)","\nPolicy DSL Abstract Syntax Tree (AST) Definitions\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- All nodes are IMMUTABLE (frozen dataclasses)\n- No dynamic fields\n- No generic dicts (typed structures only)\n- No runtime evaluation logic\n- Must be serializable to JSON\n\nGOVERNANCE:\n- These types define the MEANING of policy structure\n- No authority, no execution, no side effects\n",,NEEDS_CLASSIFICATION,ITERATION_1,DSL,TRANSFER
239,app/dsl/interpreter.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/interpreter.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: import\n#   Execution: sync\n# Role: Policy DSL Interpreter (pure IR evaluation)\n# Reference: PIN-341 Section 1.8, PIN-345\n\n""""""\nPolicy DSL Interpreter\n\nPure evaluation of compiled IR against runtime facts.\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- PURE: No side effects, no I/O, no DB, no network","\nPolicy DSL Interpreter\n\nPure evaluation of compiled IR against runtime facts.\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- PURE: No side effects, no I/O, no DB, no network\n- NO CONTEXT: No tenants, actors, permissions, time\n- DESCRIPTIVE OUTPUT: Returns what is true, not what to do\n- STACK-BASED: Explicit stack for condition evaluation\n- NO COERCION: Type mismatches raise errors\n\nINPUT:\n- PolicyIR: Compiled intermediate representation\n- Facts: dict[str, value] - runtime metric values\n\nOUTPUT:\n- ",,NEEDS_CLASSIFICATION,ITERATION_1,DSL,TRANSFER
240,app/dsl/ir_compiler.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/ir_compiler.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: import\n#   Execution: sync\n# Role: Policy DSL IR Compiler (AST → bytecode)\n# Reference: PIN-341 Section 1.8, PIN-345\n\n""""""\nPolicy DSL Intermediate Representation (IR) Compiler\n\nCompiles validated AST into deterministic bytecode for the interpreter.\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- CLOSED instruction set (exactly 10 opcodes)","\nPolicy DSL Intermediate Representation (IR) Compiler\n\nCompiles validated AST into deterministic bytecode for the interpreter.\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- CLOSED instruction set (exactly 10 opcodes)\n- Deterministic: Same AST → Same IR → Same hash\n- No evaluation logic (pure compilation)\n- No jumps, labels, or control flow\n- IR structure is hashable for audit identity\n\nINSTRUCTION SET (CLOSED - NO ADDITIONS):\n    LOAD_METRIC     - Load metric value onto stack\n    LOAD_CONST      -",,NEEDS_CLASSIFICATION,ITERATION_1,DSL,TRANSFER
241,app/dsl/parser.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/dsl_parser.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: import\n#   Execution: sync\n# Role: Policy DSL text parser (DSL → AST)\n# Reference: PIN-341 Section 1.8, PIN-345\n\n""""""\nPolicy DSL Parser\n\nConverts DSL text into typed, immutable AST nodes.\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- Single-pass recursive descent parser","\nPolicy DSL Parser\n\nConverts DSL text into typed, immutable AST nodes.\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- Single-pass recursive descent parser\n- No external parser libraries (no PLY, no ANTLR)\n- All errors must be position-aware\n- Must produce valid AST or raise ParseError\n\nGRAMMAR (Simplified EBNF):\n    policy      := header clause+\n    header      := 'policy' NAME 'version' INT 'scope' SCOPE 'mode' MODE\n    clause      := 'when' condition 'then' action+\n    condition   := or_expr\n    ",,NEEDS_CLASSIFICATION,ITERATION_1,DSL,TRANSFER
242,app/dsl/validator.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/validator.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: import\n#   Execution: sync\n# Role: Policy DSL semantic validator\n# Reference: PIN-341 Section 1.8, PIN-345\n\n""""""\nPolicy DSL Semantic Validator\n\nValidates AST against semantic rules. Does NOT parse.\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- Pure validation logic","\nPolicy DSL Semantic Validator\n\nValidates AST against semantic rules. Does NOT parse.\n\nDESIGN CONSTRAINTS (BLOCKING - PIN-341):\n- Pure validation logic\n- No side effects\n- No I/O, no DB\n- Must produce validation result (errors/warnings), not exceptions\n\nSEMANTIC RULES:\n1. Mode Enforcement:\n   - MONITOR mode: Only WARN actions allowed\n   - ENFORCE mode: WARN, BLOCK, REQUIRE_APPROVAL allowed\n\n2. Metric Validation (optional):\n   - If metric registry provided, validate metrics exist\n\n3. Version Vali",,NEEDS_CLASSIFICATION,ITERATION_1,DSL,TRANSFER
243,app/errors/__init__.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Error types for cross-domain governance\n# Callers: L2, L3, L4 services\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: CROSS_DOMAIN_GOVERNANCE.md\n\n""""""\nCross-Domain Governance Errors\n\nFoundational error types for mandatory governance operations.",\nCross-Domain Governance Errors\n\nFoundational error types for mandatory governance operations.\nThese errors MUST surface to the caller - they cannot be silently caught.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/config/__init__.py,SKIP_INIT_COLLISION
244,app/errors/governance.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/governance.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: GovernanceError for mandatory cross-domain governance\n# Callers: L2, L3, L4 services\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: CROSS_DOMAIN_GOVERNANCE.md\n\n""""""\nGovernanceError - Mandatory Governance Failure\n\nPIN: Cross-Domain Governance (design/CROSS_DOMAIN_GOVERNANCE.md)","\nGovernanceError - Mandatory Governance Failure\n\nPIN: Cross-Domain Governance (design/CROSS_DOMAIN_GOVERNANCE.md)\n\nThis exception is raised when a governance operation fails.\nGovernance operations are MANDATORY - they must succeed or the\nentire operation must fail.\n\nDOCTRINE (from CROSS_DOMAIN_GOVERNANCE.md):\n\nRule 1: Governance Must Throw\n    - If a customer-visible invariant is violated, raise GovernanceError\n    - Never log-and-continue\n    - Never return None\n\nRule 2: No Optional Dependencie",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Errors),TRANSFER
245,app/events/__init__.py,INTERNAL,logs,L6,app/houseofcards/internal/logs/drivers/__init__.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Event system package marker\n# Callers: Event imports\n# Allowed Imports: None\n# Forbidden Imports: None\n# Reference: Package Structure, PIN-454 Phase 5\n\n# NOVA Events Package\n# Event publishing adapters and subscribers\n\nfrom .publisher import BasePublisher, LoggingPublisher, get_publisher",,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/core/__init__.py,SKIP_INIT_COLLISION
246,app/events/audit_handlers.py,INTERNAL,logs,L6,app/houseofcards/internal/logs/drivers/audit_handlers.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: event\n#   Execution: sync\n# Role: Event handlers for audit-related events\n# Callers: EventReactor (L3)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-454, Phase 5 (Audit Alert Handlers)\n\n""""""\nAudit Event Handlers\n\nHandles audit-related events from the Runtime Audit Contract (RAC):",\nAudit Event Handlers\n\nHandles audit-related events from the Runtime Audit Contract (RAC):\n- Audit reconciliation failures\n- Missing domain acknowledgments\n- Drift detection\n- Stale run detection\n\nThese handlers emit alerts and take corrective actions when\naudit violations are detected.\n\nUsage:\n    from app.events.subscribers import get_event_reactor\n    from app.events.audit_handlers import register_audit_handlers\n\n    reactor = get_event_reactor()\n    register_audit_handlers(reactor)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Events,TRANSFER
247,app/events/nats_adapter.py,INTERNAL,logs,L3,app/houseofcards/internal/logs/facades/nats_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: NATS event streaming adapter\n# Callers: event publisher\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Event System\n\n""""""\nNATS adapter stub. Does not actually require a NATS server by default.\nIf NATS is configured in env (NATS_URL), this adapter will attempt a connect.\nIn many test/dev setups this remains a logging stub.","\nNATS adapter stub. Does not actually require a NATS server by default.\nIf NATS is configured in env (NATS_URL), this adapter will attempt a connect.\nIn many test/dev setups this remains a logging stub.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
248,app/events/publisher.py,INTERNAL,policies,L6,app/houseofcards/internal/policies/drivers/publisher.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: async\n# Role: Event publishing abstraction\n# Callers: services, workers\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Event System\n\n""""""\nPublisher interface for events. Uses pluggable adapters.\n\nDESIGN CONSTRAINTS:","\nPublisher interface for events. Uses pluggable adapters.\n\nDESIGN CONSTRAINTS:\n1. Adapter pattern (redis, nats, logging)\n2. Fail-fast if misconfigured (no silent fallback)\n3. Observable at runtime\n\nSupported adapters:\n- redis: Redis Pub/Sub (recommended for realtime)\n- nats: NATS messaging\n- logging: Fallback that logs events (default)\n",,NEEDS_CLASSIFICATION,ITERATION_1,Events,TRANSFER
249,app/events/reactor_initializer.py,INTERNAL,logs,L6,app/houseofcards/internal/logs/drivers/reactor_initializer.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: startup\n#   Execution: sync (blocking until ready)\n# Role: Initialize EventReactor at application startup\n# Callers: main.py lifespan\n# Allowed Imports: L4 (events), L6 (logging)\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-046\n\n""""""\nModule: reactor_initializer\nPurpose: Ensures EventReactor is initialized at startup and blocks if failed.\n","\nModule: reactor_initializer\nPurpose: Ensures EventReactor is initialized at startup and blocks if failed.\n\nImports (Dependencies):\n    - app.events.subscribers: get_event_reactor, EventReactor\n    - app.events.audit_handlers: register_audit_handlers\n    - app.services.governance.profile: get_governance_config\n\nExports (Provides):\n    - initialize_event_reactor(): EventReactor — initialized reactor\n    - get_reactor_status(): ReactorStatus — health check\n\nWiring Points:\n    - Called from: main.p",,NEEDS_CLASSIFICATION,ITERATION_1,Events,TRANSFER
250,app/events/redis_publisher.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/redis_publisher.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: async\n# Role: Redis pub/sub event adapter\n# Callers: event publisher\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Event System\n\n""""""\nRedis Pub/Sub Event Publisher Adapter.\n\nPublishes events to Redis channel 'aos.events' for realtime consumption","\nRedis Pub/Sub Event Publisher Adapter.\n\nPublishes events to Redis channel 'aos.events' for realtime consumption\nby Ops Console and other subscribers.\n\nDESIGN CONSTRAINTS (Non-Negotiable):\n1. Fire-and-forget (no retries, no persistence in v1)\n2. Fail-fast if misconfigured (no silent fallback)\n3. Schema-stable events (standard envelope)\n4. Observable at runtime\n\nUsage:\n    publisher = RedisPublisher()\n    publisher.publish(""INCIDENT_CREATED"", {""incident_id"": ""123"", ...})\n",,NEEDS_CLASSIFICATION,ITERATION_1,Events; Domain uncertain,TRANSFER
251,app/events/subscribers.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/subscribers.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Backend event subscribers for cross-domain reactions\n# Callers: Worker process (event reactor loop)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-454, FIX-003 (Phase 5)\n\n""""""\nEvent Reactor — Backend Event Subscriber System\n\nSubscribes to Redis pub/sub channel and routes events to appropriate handlers.","\nEvent Reactor — Backend Event Subscriber System\n\nSubscribes to Redis pub/sub channel and routes events to appropriate handlers.\nEnables backend reactions to cross-domain events.\n\nDESIGN CONSTRAINTS:\n1. Layer L3 — Boundary Adapter (no business logic)\n2. Handler registration via decorator\n3. Fire-and-forget event dispatch (handlers may fail independently)\n4. Prometheus metrics for observability\n5. Graceful shutdown support\n\nUsage:\n    from app.events.subscribers import EventReactor, get_event_rea",,NEEDS_CLASSIFICATION,ITERATION_1,Events; Domain uncertain,TRANSFER
252,app/evidence/__init__.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/__init__.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Role: Evidence capture module\n# Reference: Evidence Architecture v1.1\n\n""""""\nEvidence Capture Module (v1.1)\n\nProvides ctx-aware taxonomy evidence capture for Classes B-J.\n\nArchitecture (v1.1):\n- capture.py: Evidence capture functions\n- integrity.py: Split integrity computation (Assembler/Evaluator)\n\nKey Changes (v1.1):",\nEvidence Capture Module (v1.1)\n\nProvides ctx-aware taxonomy evidence capture for Classes B-J.\n\nArchitecture (v1.1):\n- capture.py: Evidence capture functions\n- integrity.py: Split integrity computation (Assembler/Evaluator)\n\nKey Changes (v1.1):\n- Category B1: Activity evidence taxonomy rule (documented)\n- Category B2: Separated IntegrityState/IntegrityGrade from execution status\n- Category C2: Split compute_integrity into IntegrityAssembler/IntegrityEvaluator\n- Category C3: Formalized failure re,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
253,app/evidence/capture.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/drivers/capture.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker | skill\n#   Execution: sync\n# Role: Taxonomy evidence capture service (ctx-aware)\n# Callers: workers.py, runner.py, adapters, decisions.py\n# Allowed Imports: L6 (database)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Evidence Architecture v1.1, ExecutionContext Specification v1.1\n\n""""""\nTaxonomy Evidence Capture Service (v1.1)\n\nSingle entry point for all governance taxonomy evidence writes (Classes B-J).","\nTaxonomy Evidence Capture Service (v1.1)\n\nSingle entry point for all governance taxonomy evidence writes (Classes B-J).\n\nRules:\n- All taxonomy writes go through this file\n- All functions require ExecutionContext (except integrity)\n- No context → No evidence (hard failure, not best-effort)\n- No business logic - thin DB writes only\n- No inference - fields must be provided explicitly\n- Best-effort semantics for DB writes - failures logged, not blocking\n\nArchitecture:\n- Layer 1 (Operational): contr",,NEEDS_CLASSIFICATION,ITERATION_1,Evidence storage,TRANSFER
254,app/evidence/integrity.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/integrity.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: terminal execution state\n#   Execution: sync\n# Role: Integrity computation with separated concerns\n# Callers: runner.py (at terminal), evidence.capture\n# Allowed Imports: L6 (database)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Evidence Architecture v1.1\n\n""""""\nIntegrity Computation Module (v1.1)\n\nSeparated concerns for integrity evidence:",\nIntegrity Computation Module (v1.1)\n\nSeparated concerns for integrity evidence:\n- IntegrityAssembler: Gathers facts from evidence tables\n- IntegrityEvaluator: Applies policy to compute state/grade\n- IntegritySerializer: Persists integrity evidence\n\nDesign rationale (Category C2 fix):\n    compute_integrity() was becoming a god function.\n    Split responsibilities enable:\n    - Policy-driven integrity (enterprise tiers)\n    - Explainable integrity decisions\n    - Testable components\n\nState Model ,,NEEDS_CLASSIFICATION,ITERATION_1,Evidence storage,TRANSFER
255,app/governance/__init__.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api | cli | worker | sdk | auto_execute\n#   Execution: sync\n# Role: Governance enforcement infrastructure (structural, non-coercive)\n# Callers: All EXECUTE-power paths\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-337\n\n""""""\nPIN-337: Governance Enforcement Infrastructure\n\nThis module provides the MANDATORY execution kernel that all EXECUTE-power","\nPIN-337: Governance Enforcement Infrastructure\n\nThis module provides the MANDATORY execution kernel that all EXECUTE-power\npaths must route through. This is STRUCTURAL governance - making ungoverned\nexecution physically impossible.\n\nCONSTRAINTS (v1):\n- Kernel MUST NOT block execution\n- Kernel MUST NOT change business semantics\n- Kernel MUST emit envelopes and record invocations\n- Strictness is capability-scoped, not global\n- v1 behavior is fully PERMISSIVE\n\nThe kernel is PHYSICS, not POLICY.\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
256,app/governance/decorator.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/decorator.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api | cli\n#   Execution: sync\n# Role: Optional ergonomic decorator over ExecutionKernel\n# Callers: HTTP route handlers, CLI commands\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-337\n\n""""""\n@governed Decorator - PIN-337 Optional Ergonomic Wrapper\n\nThis decorator provides convenient syntax for routing execution","\n@governed Decorator - PIN-337 Optional Ergonomic Wrapper\n\nThis decorator provides convenient syntax for routing execution\nthrough the ExecutionKernel.\n\nIMPORTANT:\n- This decorator is OPTIONAL, not required\n- CI does NOT enforce decorator presence\n- CI enforces KERNEL usage (semantic), not syntax\n- The decorator is CONVENIENCE, the kernel is PHYSICS\n",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
257,app/governance/kernel.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/kernel.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api | cli | worker | sdk | auto_execute\n#   Execution: sync\n# Role: Mandatory execution kernel - single choke point for all EXECUTE power\n# Callers: HTTP handlers, CLI dispatchers, SDK wrappers, workers, AUTO_EXECUTE\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-337\n\n""""""\nExecutionKernel - PIN-337 Governance Enforcement Infrastructure\n\nThis is the MANDATORY choke point for all EXECUTE-power paths.","\nExecutionKernel - PIN-337 Governance Enforcement Infrastructure\n\nThis is the MANDATORY choke point for all EXECUTE-power paths.\nAll execution must flow through this kernel.\n\nINVARIANTS:\n- Every EXECUTE path MUST call ExecutionKernel.invoke()\n- Kernel MUST NOT block execution in v1 (PERMISSIVE mode)\n- Kernel MUST emit ExecutionEnvelope for attribution\n- Kernel MUST record invocation metrics\n- Unknown capability_id = CI FAIL (compile-time), not runtime block\n\nThe kernel is PHYSICS, not POLICY.\nIf",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
258,app/houseofcards/__init__.py,INTERNAL,general,L5,app/houseofcards/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: ALL\n# Role: House of Cards - New isolated domain structure\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nHouse of Cards (houseofcards)\n\nIsolated new directory structure for domain reorganization.\nThis namespace is completely separate from the existing `app/services/` structure.\n\nStructure:\n    app/houseofcards/{audience}/{domain}/{role}/{file}.py\n\nAudiences:",\nHouse of Cards (houseofcards)\n\nIsolated new directory structure for domain reorganization.\nThis namespace is completely separate from the existing `app/services/` structure.\n\nStructure:\n    app/houseofcards/{audience}/{domain}/{role}/{file}.py\n\nAudiences:\n    - customer: Customer-facing domains (10 domains)\n    - internal: Infrastructure services (2 domains)\n    - founder: Admin/ops tools (1 domain)\n\nRoles:\n    - facades: Entry points (L2 APIs call these)\n    - drivers: Orchestrators (coordinat,,NEEDS_CLASSIFICATION,ITERATION_1,Package init; Domain uncertain,TRANSFER
259,app/houseofcards/customer/__init__.py,CUSTOMER,overview,L5,app/houseofcards/customer/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Customer-facing domain services package\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nCustomer Domain Services (houseofcards)\n\nAll customer-facing domain logic organized by:\n- Domain (overview, activity, incidents, policies, logs, analytics, account, integrations, api_keys, general)\n- Role (facades, drivers, engines, schemas)\n\nPattern: app/houseofcards/customer/{domain}/{role}/{file}.py\n""""""\n","\nCustomer Domain Services (houseofcards)\n\nAll customer-facing domain logic organized by:\n- Domain (overview, activity, incidents, policies, logs, analytics, account, integrations, api_keys, general)\n- Role (facades, drivers, engines, schemas)\n\nPattern: app/houseofcards/customer/{domain}/{role}/{file}.py\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
260,app/houseofcards/customer/account/__init__.py,CUSTOMER,account,L5,app/houseofcards/customer/account/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Account domain - Identity and billing\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nAccount Domain\n\nTopics: projects, users, profile, billing, support\nRoles: facades, schemas\n""""""","\nAccount Domain\n\nTopics: projects, users, profile, billing, support\nRoles: facades, schemas\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
261,app/houseofcards/customer/account/drivers/__init__.py,CUSTOMER,account,L6,app/houseofcards/customer/account/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: account domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\naccount / drivers\n\nExports will be added as files are moved here.\n""""""",\naccount / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
262,app/houseofcards/customer/account/engines/__init__.py,CUSTOMER,account,L5,app/houseofcards/customer/account/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: account domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md, HOC_account_analysis_v1.md\n\n""""""\naccount / engines\n\nCUSTOMER-facing account engines.\n\nNOTE: iam_service.py was moved to internal/platform/iam/engines/\nbecause it declares AUDIENCE: INTERNAL.\n\nFor INTERNAL IAM operations, use:\n    from app.houseofcards.internal.platform.iam.engines import get_iam_service","\naccount / engines\n\nCUSTOMER-facing account engines.\n\nNOTE: iam_service.py was moved to internal/platform/iam/engines/\nbecause it declares AUDIENCE: INTERNAL.\n\nFor INTERNAL IAM operations, use:\n    from app.houseofcards.internal.platform.iam.engines import get_iam_service\n\nFor CUSTOMER account operations, use the facades:\n    from app.houseofcards.customer.account.facades import get_accounts_facade\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
263,app/houseofcards/customer/account/engines/email_verification.py,CUSTOMER,account,L5,app/houseofcards/customer/account/engines/email_verification.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Callers: onboarding.py (auth flow)\n# Reference: PIN-240\n# NOTE: Redis-only state (not PostgreSQL). M24 onboarding.\n\n""""""\nEmail Verification Service\n\nProvides OTP-based email verification for customer onboarding.\n\nConfiguration (environment variables):\n    RESEND_API_KEY: Resend.com API key for sending emails\n    EMAIL_FROM: Sender email address\n    EMAIL_VERIFICATION_TTL: OTP validity in seconds (default: 600 = 10 min)",\nEmail Verification Service\n\nProvides OTP-based email verification for customer onboarding.\n\nConfiguration (environment variables):\n    RESEND_API_KEY: Resend.com API key for sending emails\n    EMAIL_FROM: Sender email address\n    EMAIL_VERIFICATION_TTL: OTP validity in seconds (default: 600 = 10 min)\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
264,app/houseofcards/customer/account/engines/identity_resolver.py,CUSTOMER,account,L5,app/houseofcards/customer/account/engines/identity_resolver.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Identity resolution from various providers\n# Callers: IAMService, Auth middleware\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-173 (IAM Integration)\n\n""""""\nIdentity Resolver (GAP-173)\n\nResolves identities from various sources:","\nIdentity Resolver (GAP-173)\n\nResolves identities from various sources:\n- JWT tokens (Clerk, Auth0)\n- API keys\n- System tokens\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
265,app/houseofcards/customer/account/engines/profile.py,CUSTOMER,account,L5,app/houseofcards/customer/account/engines/profile.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: startup\n#   Execution: sync\n# Role: Governance Profile configuration and validation\n# Callers: main.py (L2), workers (L5)\n# Allowed Imports: L6 (stdlib, logging)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), Section 2.1\n\n""""""\nGovernance Profile Configuration\n\nReduces cognitive load and configuration drift by providing three","\nGovernance Profile Configuration\n\nReduces cognitive load and configuration drift by providing three\nwell-defined governance profiles:\n\n- STRICT: Full enforcement, all features enabled, production-ready\n- STANDARD: Core features enabled, some optional features disabled\n- OBSERVE_ONLY: Audit and observe without enforcement (safe rollout)\n\nUsage:\n    from app.services.governance.profile import (\n        get_governance_profile,\n        validate_governance_config,\n        GovernanceProfile,\n    )\n\n ",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
266,app/houseofcards/customer/account/engines/tenant_service.py,CUSTOMER,account,L5,app/houseofcards/customer/account/engines/tenant_service.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Role: Tenant CRUD, API key management, quota enforcement\n# Callers: L2 APIs, L4 engines, L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""\nTenant Service (M21)\n\nProvides:\n- Tenant CRUD operations\n- API key management (create, revoke, list)\n- Quota enforcement (runs per day, tokens per month)\n- Usage tracking and metering\n- Plan management","\nTenant Service (M21)\n\nProvides:\n- Tenant CRUD operations\n- API key management (create, revoke, list)\n- Quota enforcement (runs per day, tokens per month)\n- Usage tracking and metering\n- Plan management\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
267,app/houseofcards/customer/account/engines/user_write_service.py,CUSTOMER,account,L5,app/houseofcards/customer/account/engines/user_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for User management (Phase 2B extraction)\n# Callers: api/onboarding.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 1\n\n""""""\nUser Write Service - DB write operations for User management.\n\nPhase 2B Batch 1: Extracted from api/onboarding.py.",\nUser Write Service - DB write operations for User management.\n\nPhase 2B Batch 1: Extracted from api/onboarding.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
268,app/houseofcards/customer/account/facades/__init__.py,CUSTOMER,account,L5,app/houseofcards/customer/account/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: account domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\naccount / facades\n\nExports will be added as files are moved here.\n""""""",\naccount / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
269,app/houseofcards/customer/account/facades/accounts_facade.py,CUSTOMER,account,L3,app/houseofcards/customer/account/facades/accounts_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB reads/writes)\n# Role: Accounts domain facade - unified entry point for account management\n# Callers: L2 accounts API (accounts.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Customer Console v1 Constitution\n#\n""""""\nAccounts Domain Facade (L4)\n","\nAccounts Domain Facade (L4)\n\nUnified facade for all accounts domain operations:\n- Projects: list, detail\n- Users: list, detail, invite, remove, update role\n- Profile: get, update\n- Billing: summary, invoices\n- Support: contact, tickets\n\nGOVERNANCE NOTE:\nAccount is NOT a domain - it manages who, what, and billing (not what happened).\nAccount pages MUST NOT display executions, incidents, policies, or logs.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
270,app/houseofcards/customer/account/facades/notifications_facade.py,CUSTOMER,account,L3,app/houseofcards/customer/account/facades/notifications_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api or worker (async delivery)\n#   Execution: async\n# Role: Notifications Facade - Centralized access to notification operations\n# Callers: L2 notifications.py API, SDK, Worker\n# Allowed Imports: L4 notification services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-109 (Notification API)\n\n""""""\nNotifications Facade (L4 Domain Logic)\n\nThis facade provides the external interface for notification operations.",\nNotifications Facade (L4 Domain Logic)\n\nThis facade provides the external interface for notification operations.\nAll notification APIs MUST use this facade instead of directly importing\ninternal notification modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes notification delivery logic\n- Provides unified access to multiple notification channels\n- Single point for audit emission\n\nL2 API Routes (GAP-109):\n- POST /api/v1/notifications (send notification)\n- GET /api/v,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
271,app/houseofcards/customer/account/notifications/engines/channel_service.py,CUSTOMER,account,L5,app/houseofcards/customer/account/notifications/engines/channel_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: async\n# Role: Configurable notification channel management\n# Callers: alert_emitter, incident_service, policy_engine\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-017 (Notify Channels)\n\n""""""\nModule: channel_service\nPurpose: Configurable notification channels for alerts and events.\n",\nModule: channel_service\nPurpose: Configurable notification channels for alerts and events.\n\nGAP-017: Notify channels must be configurable per tenant/policy.\nThis service provides:\n    - Channel configuration (enable/disable per channel type)\n    - Channel validation (test connectivity)\n    - Delivery tracking (success/failure metrics)\n    - Retry logic for failed deliveries\n\nExports:\n    - NotifyChannel: Enum of available channels\n    - NotifyEventType: Enum of event types\n    - NotifyChannelCo,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
272,app/houseofcards/customer/account/schemas/__init__.py,CUSTOMER,account,L6,app/houseofcards/customer/account/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: account domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\naccount / schemas\n\nExports will be added as files are moved here.\n""""""",\naccount / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
273,app/houseofcards/customer/account/support/CRM/engines/audit_service.py,CUSTOMER,account,L5,app/houseofcards/customer/account/support/CRM/engines/audit_service.py,"# Layer: L8 — Catalyst / Verification\n# Product: system-wide (Part-2 CRM Workflow)\n# Temporal:\n#   Trigger: job completion\n#   Execution: sync (deterministic verification)\n# Role: Audit Service - verifies job execution against contract intent\n# Callers: GovernanceOrchestrator (via AuditTrigger)\n# Allowed Imports: L6 models only\n# Forbidden Imports: L1, L2, L3, L4, L5 (auditor is independent)\n# Reference: PIN-295, GOVERNANCE_AUDIT_MODEL.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: AUDIT-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#",\nPart-2 Governance Audit Service (L8)\n\nVerifies that job execution matched contract intent.\n\nAudit is:\n- Post-execution (runs after job completes)\n- Deterministic (same evidence → same verdict)\n- Authoritative (verdicts cannot be overridden)\n- Mandatory (no rollout without audit)\n\nInvariants:\n- AUDIT-001: All completed jobs require audit\n- AUDIT-002: PASS required for COMPLETED\n- AUDIT-003: FAIL triggers rollback\n- AUDIT-004: Verdicts are immutable\n- AUDIT-005: Evidence is preserved\n- AUDIT-006:,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
274,app/houseofcards/customer/account/support/CRM/engines/job_executor.py,CUSTOMER,account,L5,app/houseofcards/customer/account/support/CRM/engines/job_executor.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide (Part-2 CRM Workflow)\n# Temporal:\n#   Trigger: worker|scheduler\n#   Execution: async (background execution)\n# Role: Job Executor - executes job steps and emits evidence\n# Callers: workers, governance orchestrator (via message queue)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: PIN-294, PIN-292, PART2_CRM_WORKFLOW_CHARTER.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: EXECUTOR-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Job Executor (L5)\n\nExecutes governance job steps in order and emits evidence.\n\nThis is a MACHINE that performs declared steps. It does not:\n- Decide what to execute (that's Contract + Orchestrator)\n- Retry failures (failed = done)\n- Interpret results (that's Audit)\n- Modify health (that's PlatformHealthService)\n\nThe Executor is ""just physics"" - it runs the plan and records what happened.\n\nInvariants:\n- EXEC-001: Execute steps in declared order\n- EXEC-002: Emit evidence per step\n- EXEC-00",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
275,app/houseofcards/customer/account/support/CRM/engines/validator_service.py,CUSTOMER,account,L5,app/houseofcards/customer/account/support/CRM/engines/validator_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Issue Validator - pure analysis, advisory verdicts\n# Callers: L3 (adapters), L2 (governance APIs)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-287, VALIDATOR_LOGIC.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: VALIDATOR-IS-ADVISORY (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Validator Service (L4)\n\nAnalyzes incoming CRM issues and produces structured verdicts for the\neligibility engine. The Validator is advisory only - it recommends but\ndoes not decide.\n\nResponsibilities:\n1. Classify issue type (capability_request, bug_report, etc.)\n2. Determine severity (critical, high, medium, low)\n3. Extract affected capabilities\n4. Recommend action (create_contract, defer, reject, escalate)\n5. Calculate confidence score\n\nInvariants (from VALIDATOR_LOGIC.md):\n- VAL-001: V",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
276,app/houseofcards/customer/activity/__init__.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Activity domain - Execution monitoring\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nActivity Domain\n\nTopics: completed, live, signals\nRoles: facades, schemas\n""""""","\nActivity Domain\n\nTopics: completed, live, signals\nRoles: facades, schemas\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
277,app/houseofcards/customer/activity/drivers/__init__.py,CUSTOMER,activity,L6,app/houseofcards/customer/activity/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: activity domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nactivity / drivers\n\nExports will be added as files are moved here.\n""""""",\nactivity / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
278,app/houseofcards/customer/activity/engines/__init__.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: activity domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nactivity / engines\n\nExports will be added as files are moved here.\n""""""",\nactivity / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
279,app/houseofcards/customer/activity/engines/activity_enums.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/engines/activity_enums.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Canonical enums for activity domain - owned by engines\n""""""\nActivity Domain Enums\n\nCanonical enum definitions for the activity domain.\nThese are the single source of truth for categorical fields.\n\nRules (per ACT-DUP-006, ACTIVITY_DTO_RULES.md):\n- No free-text categorical fields in Activity\n- Signals are governance inputs - they must be enumerable\n- Engines own canonical enums, facades import them\n""""""","\nActivity Domain Enums\n\nCanonical enum definitions for the activity domain.\nThese are the single source of truth for categorical fields.\n\nRules (per ACT-DUP-006, ACTIVITY_DTO_RULES.md):\n- No free-text categorical fields in Activity\n- Signals are governance inputs - they must be enumerable\n- Engines own canonical enums, facades import them\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
280,app/houseofcards/customer/activity/engines/attention_ranking_service.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/engines/attention_ranking_service.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Attention ranking service for activity signals\n""""""Attention ranking service for prioritizing signals.""""""\n\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom typing import Any, Optional\n\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\nfrom app.houseofcards.customer.general.utils.time import utc_now\n\n",Attention ranking service for prioritizing signals.,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
281,app/houseofcards/customer/activity/engines/cost_analysis_service.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/engines/cost_analysis_service.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Cost analysis service for activity signals\n""""""Cost analysis service for detecting cost anomalies.""""""\n\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom typing import Optional\n\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\nfrom app.houseofcards.customer.general.utils.time import utc_now\n\n",Cost analysis service for detecting cost anomalies.,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
282,app/houseofcards/customer/activity/engines/pattern_detection_service.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/engines/pattern_detection_service.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Pattern detection service for activity signals\n""""""Pattern detection service for identifying recurring patterns.""""""\n\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom typing import Optional\n\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\nfrom app.houseofcards.customer.general.utils.time import utc_now\n\n",Pattern detection service for identifying recurring patterns.,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
283,app/houseofcards/customer/activity/engines/signal_feedback_service.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/engines/signal_feedback_service.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Signal feedback service for acknowledging/suppressing signals\n""""""Signal feedback service for user interactions with signals.""""""\n\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom typing import Optional\n\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\nfrom app.houseofcards.customer.general.utils.time import utc_now\n\n",Signal feedback service for user interactions with signals.,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
284,app/houseofcards/customer/activity/engines/signal_identity.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/engines/signal_identity.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Signal identity computation for deduplication\n""""""Signal identity utilities for fingerprinting and deduplication.""""""\n\nimport hashlib\nimport json\nfrom typing import Any\n\n\ndef compute_signal_fingerprint_from_row(row: dict[str, Any]) -> str:\n    """"""\n    Compute a stable fingerprint for a signal row.\n",Signal identity utilities for fingerprinting and deduplication.,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
285,app/houseofcards/customer/activity/facades/__init__.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: activity domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nactivity / facades\n\nExports will be added as files are moved here.\n""""""",\nactivity / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
286,app/houseofcards/customer/activity/facades/activity_facade.py,CUSTOMER,activity,L3,app/houseofcards/customer/activity/facades/activity_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: internal (called by L2 API)\n#   Execution: async\n# Role: Activity Facade - Centralized access to activity domain operations\n# Callers: app.api.activity (L2)\n# Allowed Imports: L6, services within L4\n# Forbidden Imports: L1, L2, L5\n# Reference: Activity Domain - One Facade Architecture, W4 Pattern\n\n""""""\nActivity Facade (L4)\n",\nActivity Facade (L4)\n\nProvides unified access to activity domain operations.\nThis is the single entry point for all activity business logic.\n\nOperations:\n- get_runs: List runs with filters\n- get_run_detail: Get run details (O3)\n- get_run_evidence: Get run evidence context (O4)\n- get_run_proof: Get run integrity proof (O5)\n- get_status_summary: Get runs grouped by status\n- get_patterns: Pattern detection (SIG-O3)\n- get_cost_analysis: Cost anomalies (SIG-O4)\n- get_attention_queue: Attention ranki,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
287,app/houseofcards/customer/activity/schemas/__init__.py,CUSTOMER,activity,L6,app/houseofcards/customer/activity/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: activity domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nactivity / schemas\n\nExports will be added as files are moved here.\n""""""",\nactivity / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
288,app/houseofcards/customer/analytics/__init__.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Analytics domain - Usage and cost intelligence\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md, HOC_analytics_analysis_v1.md\n\n""""""\nAnalytics Domain\n\nTopics: usage, cost, trends\nRoles: facades, engines, schemas\n\nCONCEPTUAL SPLIT (Do not merge these concerns)\n==============================================\n\nINSIGHT LAYER (Customer Console owned):","\nAnalytics Domain\n\nTopics: usage, cost, trends\nRoles: facades, engines, schemas\n\nCONCEPTUAL SPLIT (Do not merge these concerns)\n==============================================\n\nINSIGHT LAYER (Customer Console owned):\n  - analytics_facade.py — aggregations, statistics, trends\n  - detection_facade.py — anomaly lifecycle, read models\n\nTRUTH LAYER (System-wide, governance-adjacent):\n  - cost_model_engine.py — system truth, all products depend\n  - cost_anomaly_detector.py — system truth, incident esca",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
289,app/houseofcards/customer/analytics/drivers/__init__.py,CUSTOMER,analytics,L6,app/houseofcards/customer/analytics/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: analytics domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nanalytics / drivers\n\nExports will be added as files are moved here.\n""""""",\nanalytics / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
290,app/houseofcards/customer/analytics/engines/__init__.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: analytics domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nanalytics / engines\n\nExports will be added as files are moved here.\n""""""",\nanalytics / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
291,app/houseofcards/customer/analytics/engines/cost_anomaly_detector.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/cost_anomaly_detector.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: tests, future background job\n# Reference: PIN-240\n# WARNING: If this logic is wrong, ALL products break.\n\n""""""\nM29 Cost Anomaly Detector - Aligned Rules\n\nCategory 4 Anomaly Rules:\n1. Absolute spike: daily_spend > baseline * 1.4 FOR 2 consecutive daily intervals\n2. Sustained drift: 7d rolling avg > baseline_7d * 1.25 FOR >= 3 days\n3. Severity: LOW +15-25%, MEDIUM +25-40%, HIGH >40%\n\nTHE INVARIANT: Every anomaly triggers an action, not a chart.","\nM29 Cost Anomaly Detector - Aligned Rules\n\nCategory 4 Anomaly Rules:\n1. Absolute spike: daily_spend > baseline * 1.4 FOR 2 consecutive daily intervals\n2. Sustained drift: 7d rolling avg > baseline_7d * 1.25 FOR >= 3 days\n3. Severity: LOW +15-25%, MEDIUM +25-40%, HIGH >40%\n\nTHE INVARIANT: Every anomaly triggers an action, not a chart.\n\nDetection Types:\n- ABSOLUTE_SPIKE: Consecutive daily breaches (user, feature, tenant)\n- SUSTAINED_DRIFT: Rolling average above baseline for multiple days\n- BUDGET",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
292,app/houseofcards/customer/analytics/engines/cost_model_engine.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/cost_model_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Cost modeling and risk estimation domain authority\n# Callers: CostSimV2Adapter (L3), simulation endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-254 Phase B Fix\n\n""""""\nL4 Cost Model Engine - Domain Authority for Cost/Risk Estimation\n\nB02 FIX: Moved from L3 CostSimV2Adapter to L4 domain engine.",\nL4 Cost Model Engine - Domain Authority for Cost/Risk Estimation\n\nB02 FIX: Moved from L3 CostSimV2Adapter to L4 domain engine.\nThis engine is the authoritative source for:\n- Cost model coefficients (per-skill pricing)\n- Risk estimation logic\n- Feasibility determination\n- Drift classification\n\nL3 adapters must delegate all domain decisions to this engine.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
293,app/houseofcards/customer/analytics/engines/cost_write_service.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/cost_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Cost Intelligence)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Cost Intelligence API (Phase 2B extraction)\n# Callers: api/cost_intelligence.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 2\n\n""""""\nCost Write Service - DB write operations for Cost Intelligence API.\n\nPhase 2B Batch 2: Extracted from api/cost_intelligence.py.",\nCost Write Service - DB write operations for Cost Intelligence API.\n\nPhase 2B Batch 2: Extracted from api/cost_intelligence.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
294,app/houseofcards/customer/analytics/engines/pattern_detection.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/pattern_detection.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: None\n# Reference: PIN-240\n#\n# STATUS: DORMANT BY DESIGN\n# =========================\n# This file is complete, contract-safe (PB-S3), and intentionally unwired.\n# Do NOT activate without review. Cost anomaly detection is already handled\n# by cost_anomaly_detector.py for the primary use case.\n#\n# If wiring is needed in the future:\n#   - Route through detection_facade.py, not direct import\n#   - Ensure PB-S3 contract is preserved (observe → feedback → no mutation)\n#   - Review governance implications before activation","\nPattern Detection Service (PB-S3)\n\nDetects patterns in execution data and emits feedback WITHOUT modifying history.\n\nPB-S3 Contract:\n- Observe patterns → create feedback → do nothing else\n- NO modification of worker_runs, traces, or costs\n- Feedback stored SEPARATELY in pattern_feedback table\n\nPattern Types:\n- failure_pattern: Same error signature N times\n- cost_spike: Abnormal cost increase detected\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
295,app/houseofcards/customer/analytics/engines/prediction.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/prediction.py,"# Layer: L4 — Domain Engine (Advisory)\n# Product: AI Console\n# Callers: predictions API (read-side)\n# Reference: PIN-240\n#\n# CLASSIFICATION: Advisory Engine (not Boundary Adapter)\n# ======================================================\n# This file contains 400+ LOC of business logic for prediction generation.\n# It queries DB, builds predictions, and emits records — engine behavior.\n#\n# Advisory engines have zero side-effects per PB-S5 contract:\n#   - Predictions are advisory only\n#   - Predictions never modify execution, scheduling, or history\n#   - is_advisory=True is enforced by design\n#","\nPrediction Service (PB-S5)\n\nGenerates predictions WITHOUT affecting execution behavior.\n\nPB-S5 Contract:\n- Advise → Observe → Do Nothing\n- Predictions are advisory only\n- Predictions have zero side-effects\n- Predictions never modify execution, scheduling, or history\n\nRule: Advise, don't influence.\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
296,app/houseofcards/customer/analytics/facades/__init__.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: analytics domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nanalytics / facades\n\nExports will be added as files are moved here.\n""""""",\nanalytics / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
297,app/houseofcards/customer/analytics/facades/analytics_facade.py,CUSTOMER,analytics,L3,app/houseofcards/customer/analytics/facades/analytics_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: internal (called by L2 API)\n#   Execution: async\n# Role: Analytics Facade - Centralized access to analytics domain operations\n# Callers: app.api.analytics (L2)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Analytics Domain Declaration v1, PIN-411, W4 Pattern\n\n""""""\nAnalytics Facade (L4)\n",\nAnalytics Facade (L4)\n\nProvides unified access to analytics domain operations.\nThis is the single entry point for all analytics business logic.\n\nOperations:\n- get_usage_statistics: Get usage statistics for a time window\n- get_cost_statistics: Get cost statistics for a time window\n- get_status: Get analytics domain capability status\n\nSignal Sources:\n- cost_records (cost attribution)\n- llm.usage (LLM runs)\n- worker.execution (trace execution)\n- gateway.metrics (API gateway)\n\nReference: Analytics ,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
298,app/houseofcards/customer/analytics/facades/detection_facade.py,CUSTOMER,analytics,L3,app/houseofcards/customer/analytics/facades/detection_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api (on-demand) or worker (scheduled)\n#   Execution: async\n# Role: Detection Facade - Centralized access to anomaly detection operations\n# Callers: L2 detection.py API, SDK, Worker\n# Allowed Imports: L4 detection services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-102 (Anomaly Detection API)\n\n""""""\nDetection Facade (L4 Domain Logic)\n\nThis facade provides the external interface for anomaly detection operations.","\nDetection Facade (L4 Domain Logic)\n\nThis facade provides the external interface for anomaly detection operations.\nAll detection APIs MUST use this facade instead of directly importing\ninternal detection modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes anomaly detection logic\n- Provides unified access to cost, behavioral, and policy anomalies\n- Single point for audit emission\n\nWrapped Services:\n- CostAnomalyDetector: Cost anomaly detection (GAP-066)\n- (Future) Be",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
299,app/houseofcards/customer/analytics/schemas/__init__.py,CUSTOMER,analytics,L6,app/houseofcards/customer/analytics/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: analytics domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nanalytics / schemas\n\nExports will be added as files are moved here.\n""""""",\nanalytics / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
300,app/houseofcards/customer/api_keys/__init__.py,CUSTOMER,api_keys,L5,app/houseofcards/customer/api_keys/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: API Keys domain - Programmatic access\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md, HOC_api_keys_analysis_v1.md\n\n""""""\nAPI Keys Domain\n\nTopics: keys, permissions, usage\nRoles: facades, engines, schemas\n\nDOMAIN CONTRACT\n===============\n\nAPI Keys is a small, security-sensitive domain. Clarity matters more","\nAPI Keys Domain\n\nTopics: keys, permissions, usage\nRoles: facades, engines, schemas\n\nDOMAIN CONTRACT\n===============\n\nAPI Keys is a small, security-sensitive domain. Clarity matters more\nthan code volume here.\n\nENTRY POINT HIERARCHY:\n\n  1. APIKeysFacade (facades/api_keys_facade.py)\n     - CUSTOMER-FACING entry point\n     - Async (AsyncSession)\n     - READ-ONLY operations\n     - Synthetic keys filtered out\n     - Callers: L2 API routes only\n\n  2. KeysReadService / KeysWriteService (engines/keys_s",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
301,app/houseofcards/customer/api_keys/drivers/__init__.py,CUSTOMER,api_keys,L6,app/houseofcards/customer/api_keys/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: api_keys domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\napi_keys / drivers\n\nExports will be added as files are moved here.\n""""""",\napi_keys / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
302,app/houseofcards/customer/api_keys/engines/__init__.py,CUSTOMER,api_keys,L5,app/houseofcards/customer/api_keys/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: api_keys domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\napi_keys / engines\n\nExports will be added as files are moved here.\n""""""",\napi_keys / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
303,app/houseofcards/customer/api_keys/engines/keys_service.py,CUSTOMER,api_keys,L5,app/houseofcards/customer/api_keys/engines/keys_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync (DB reads/writes)\n# Role: API Keys domain operations (L4)\n# Callers: customer_keys_adapter.py (L3), runtime, gateway — NOT L2\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (L3 Adapter Closure - PHASE 1)\n#\n# PRODUCT SCOPE NOTE:\n# Marked system-wide because engines serve runtime/gateway (not just console).\n# The facade (api_keys_facade.py) is ai-console because it's customer-facing only.\n# See api_keys/__init__.py for full domain contract.",\nKeys Service (L4)\n\nThis service provides all operations for the API Keys domain.\nIt sits between L3 (CustomerKeysAdapter) and L6 (Database).\n\nL3 (Adapter) → L4 (this service) → L6 (Database)\n\nResponsibilities:\n- Query API keys with tenant isolation\n- Freeze/unfreeze keys\n- Get key usage statistics\n- No direct exposure to L2\n\nReference: PIN-281 (L3 Adapter Closure - PHASE 1)\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
304,app/houseofcards/customer/api_keys/facades/__init__.py,CUSTOMER,api_keys,L5,app/houseofcards/customer/api_keys/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: api_keys domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\napi_keys / facades\n\nExports will be added as files are moved here.\n""""""",\napi_keys / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
305,app/houseofcards/customer/api_keys/facades/api_keys_facade.py,CUSTOMER,api_keys,L3,app/houseofcards/customer/api_keys/facades/api_keys_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB reads)\n# Role: API Keys domain facade - unified entry point for API key operations\n# Callers: L2 api-keys API (aos_api_key.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Connectivity Domain - Customer Console v1 Constitution\n#\n""""""\nAPI Keys Domain Facade (L4)\n",\nAPI Keys Domain Facade (L4)\n\nUnified facade for API key management operations.\n\nProvides:\n- List API keys (O2)\n- Get API key detail (O3)\n\nAPI keys are used for:\n- SDK authentication\n- Programmatic access to AOS APIs\n- RBAC-controlled permissions\n,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
306,app/houseofcards/customer/api_keys/schemas/__init__.py,CUSTOMER,api_keys,L6,app/houseofcards/customer/api_keys/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: api_keys domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\napi_keys / schemas\n\nExports will be added as files are moved here.\n""""""",\napi_keys / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
307,app/houseofcards/customer/general/__init__.py,CUSTOMER,general,L5,app/houseofcards/customer/general/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: General domain - Runtime orchestration, lifecycle management, cross-domain governance\n# Reference: docs/architecture/HOC_general_domain_constitution_v1.md\n\n""""""\nGeneral Domain\n\nCONSTITUTION: docs/architecture/HOC_general_domain_constitution_v1.md\n\nPURPOSE:\nGeneral exists ONLY for:\n- Cross-domain invariants\n- Irreversible decisions\n- Lifecycle state machines","\nGeneral Domain\n\nCONSTITUTION: docs/architecture/HOC_general_domain_constitution_v1.md\n\nPURPOSE:\nGeneral exists ONLY for:\n- Cross-domain invariants\n- Irreversible decisions\n- Lifecycle state machines\n- Projections of audited truth\n\nIf a feature can live elsewhere safely, it MUST.\n\nSUB-CONSTITUTIONS:\n1. Control Plane - ""Is this allowed to happen?""\n   - governance_orchestrator.py, contract_service.py, cross_domain.py\n   - Invariants: GOV-001, GOV-002, CON-001 to CON-007\n\n2. Lifecycle Plane - ""Wher",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
308,app/houseofcards/customer/general/controls/engines/guard_write_service.py,CUSTOMER,general,L5,app/houseofcards/customer/general/controls/engines/guard_write_service.py,"# Layer: L4 — Domain Engine\n# Product: AI Console (Guard)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Guard API (Phase 2B extraction)\n# Callers: api/guard.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 1\n#\n# =============================================================================\n# PHASE 2 NOTE:\n# This is a TEMPORARY AGGREGATE service for Phase 2 structural extraction.\n# It bundles KillSwitch, Incident, and IncidentEvent writes together.",\nGuard Write Service - DB write operations for Guard API.\n\nPhase 2B Batch 1: Extracted from api/guard.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
309,app/houseofcards/customer/general/cross-domain/engines/cross_domain.py,CUSTOMER,general,L5,app/houseofcards/customer/general/cross-domain/engines/cross_domain.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync (async session)\n# Role: Cross-Domain Governance - Mandatory data integrity functions\n# Callers: cost_anomaly_detector, budget services, worker runtime\n# Allowed Imports: L5, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: design/CROSS_DOMAIN_GOVERNANCE.md\n\n""""""\nCross-Domain Governance Functions (Mandatory)\n\nPIN: design/CROSS_DOMAIN_GOVERNANCE.md",\nCross-Domain Governance Functions (Mandatory)\n\nPIN: design/CROSS_DOMAIN_GOVERNANCE.md\n\nThese functions implement mandatory governance for customer-facing paths.\nThey MUST succeed or raise GovernanceError. Silent failures are forbidden.\n\nDOCTRINE:\n- Rule 1: Governance must throw\n- Rule 2: No optional dependencies\n- Rule 3: Learning is downstream only\n\nDOMAINS:\n- Analytics → Incidents: Cost anomalies MUST create incidents\n- Policies ↔ Analytics: Limit breaches MUST be recorded\n\nCOROLLARY: Governa,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
310,app/houseofcards/customer/general/drivers/__init__.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: general domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\ngeneral / drivers\n\nExports will be added as files are moved here.\n""""""",\ngeneral / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
311,app/houseofcards/customer/general/engines/__init__.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: general domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\ngeneral / engines\n\nExports will be added as files are moved here.\n""""""",\ngeneral / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
312,app/houseofcards/customer/general/engines/alert_emitter.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/alert_emitter.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Emit alerts for near-threshold and breach events\n# Callers: policy/prevention_engine.py\n# Allowed Imports: L4, L5, L6\n# Forbidden Imports: L1, L2\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-007\n\n""""""\nAlert Emitter Service\n\nEmits alerts for threshold events via configured channels:","\nAlert Emitter Service\n\nEmits alerts for threshold events via configured channels:\n- UI notifications\n- Webhooks\n- Email (future)\n- Slack (future)\n\nAlert flow:\n1. ThresholdSignal created\n2. AlertEmitter checks AlertConfig\n3. If enabled and not throttled, send via configured channels\n4. Record alert sent status\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
313,app/houseofcards/customer/general/engines/alert_log_linker.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/alert_log_linker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Link alerts to log records for explicit correlation\n# Callers: alert_emitter, incident_service, trace_service\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-019 (Alert → Log Linking)\n\n""""""\nModule: alert_log_linker\nPurpose: Explicit linking between alerts and log records.\n","\nModule: alert_log_linker\nPurpose: Explicit linking between alerts and log records.\n\nGAP-019: Alert → Log linking must be explicit, not implicit.\nThis service provides:\n    - Create links between alerts and log entries\n    - Query logs by alert or alerts by run\n    - Track link creation and access patterns\n    - Support for different link types (threshold, breach, incident)\n\nExports:\n    - AlertLogLinkType: Type of link (threshold, breach, incident)\n    - AlertLogLinkStatus: Status of link (acti",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
314,app/houseofcards/customer/general/engines/cus_enforcement_service.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/cus_enforcement_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api, sdk\n#   Execution: sync\n# Role: Enforcement policy evaluation for customer LLM integrations\n# Callers: SDK (via API), cus_telemetry API\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md Section 15\n\n""""""Customer Enforcement Service\n\nPURPOSE:\n    Evaluate enforcement policies for customer LLM calls.","Customer Enforcement Service\n\nPURPOSE:\n    Evaluate enforcement policies for customer LLM calls.\n    Returns policy DECISIONS, not actions.\n\nRESPONSIBILITIES:\n    - Evaluate integration status (enabled/disabled/error)\n    - Check budget limits against current usage\n    - Check token limits against current usage\n    - Check rate limits (requests per minute)\n    - Return structured decision with explainability\n\nDESIGN PRINCIPLES:\n    1. NO SIDE EFFECTS: This service only evaluates and returns deci",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
315,app/houseofcards/customer/general/engines/cus_health_service.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/cus_health_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api, scheduler\n#   Execution: async\n# Role: Health checking for customer LLM integrations\n# Callers: cus_integration_service.py, scheduled health checks\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md\n\n""""""Customer Health Service\n\nPURPOSE:\n    Provider reachability and credential validation for customer LLM integrations.",Customer Health Service\n\nPURPOSE:\n    Provider reachability and credential validation for customer LLM integrations.\n    Performs lightweight health checks without consuming significant quota.\n\nRESPONSIBILITIES:\n    - Test provider connectivity\n    - Validate credentials are still valid\n    - Measure response latency\n    - Update health state in integrations\n\nHEALTH STATES:\n    - UNKNOWN: Never checked or no recent data\n    - HEALTHY: Last check successful\n    - DEGRADED: Slow or partial respons,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
316,app/houseofcards/customer/general/engines/cus_telemetry_service.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/cus_telemetry_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Business logic for customer LLM telemetry ingestion and querying\n# Callers: cus_telemetry.py API\n# Allowed Imports: L5, L6 (cus_models, database)\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md\n\n""""""Customer LLM Telemetry Service\n\nPURPOSE:\n    Domain engine for telemetry data. Handles:",Customer LLM Telemetry Service\n\nPURPOSE:\n    Domain engine for telemetry data. Handles:\n    - Ingesting individual and batch LLM usage records\n    - Idempotency checking via call_id\n    - Usage aggregation and summary computation\n    - Daily aggregate management\n\nSEMANTIC:\n    This service owns the DATA PLANE for customer integrations.\n    It records FACTS about what happened - append-only by design.\n\nINVARIANTS:\n    - Telemetry records are never updated once created\n    - call_id provides idemp,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
317,app/houseofcards/customer/general/engines/fatigue_controller.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/fatigue_controller.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-049 (AlertFatigueController)\n""""""\nAlertFatigueController - Alert fatigue management service.\n\nManages alert fatigue through:\n- Rate limiting: Limit alerts per source per time window\n- Suppression: Temporarily suppress repetitive alerts\n- Aggregation: Group similar alerts together\n- Cool-down periods: Auto-suppress after threshold breaches\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timedelta, timezone",\nAlertFatigueController - Alert fatigue management service.\n\nManages alert fatigue through:\n- Rate limiting: Limit alerts per source per time window\n- Suppression: Temporarily suppress repetitive alerts\n- Aggregation: Group similar alerts together\n- Cool-down periods: Auto-suppress after threshold breaches\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
318,app/houseofcards/customer/general/engines/knowledge_lifecycle_manager.py,CUSTOMER,general,L4,app/houseofcards/customer/general/engines/knowledge_lifecycle_manager.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api, worker\n#   Execution: sync (with async job coordination)\n# Role: GAP-086 Knowledge Lifecycle Manager (THE ORCHESTRATOR)\n# Callers: SDK facade, API endpoints, async workers\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-086, DOMAINS_E2E_SCAFFOLD_V3.md Section 7.15\n\n""""""\nGAP-086: Knowledge Lifecycle Manager\n\nTHE ORCHESTRATOR — Single service owning entire knowledge plane lifecycle.","\nGAP-086: Knowledge Lifecycle Manager\n\nTHE ORCHESTRATOR — Single service owning entire knowledge plane lifecycle.\n\nARCHITECTURAL PRINCIPLE:\n    Lifecycle operations are governance-controlled, not user-controlled.\n    SDK calls REQUEST transitions. This manager DECIDES.\n    Policy + state machine ARBITRATE.\n    Users never force transitions directly.\n\nRESPONSIBILITIES:\n1. Enforce state machine transitions (GAP-089)\n2. Coordinate with policy gates (GAP-087)\n3. Emit audit events for all transitions",,NEEDS_CLASSIFICATION,ITERATION_1,Lifecycle management,TRANSFER
319,app/houseofcards/customer/general/engines/knowledge_sdk.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/knowledge_sdk.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api, sdk\n#   Execution: sync (with async wait support)\n# Role: GAP-083-085 Knowledge SDK Façade\n# Callers: External SDK consumers, API endpoints\n# Allowed Imports: L4 (KnowledgeLifecycleManager)\n# Forbidden Imports: L1, L5, L6 (direct)\n# Reference: GAP-083-085, GAP_IMPLEMENTATION_PLAN_V1.md Section 7.18\n\n""""""\nGAP-083-085: Knowledge SDK Façade\n\nA thin, state-driven, async-aware SDK interface over KnowledgeLifecycleManager.","\nGAP-083-085: Knowledge SDK Façade\n\nA thin, state-driven, async-aware SDK interface over KnowledgeLifecycleManager.\n\nARCHITECTURAL PRINCIPLE:\n    SDK calls REQUEST transitions.\n    LifecycleManager DECIDES.\n    Policy + state machine ARBITRATE.\n\nDESIGN INVARIANTS:\n- SDK-001: SDK does NOT force transitions — it requests them\n- SDK-002: SDK does NOT manage state — orchestrator does\n- SDK-003: SDK does NOT bypass policy gates — gates are mandatory\n- SDK-004: SDK provides async-aware wait semantics\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
320,app/houseofcards/customer/general/engines/panel_invariant_monitor.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/panel_invariant_monitor.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler\n#   Execution: async\n# Role: Monitor panel invariants and detect silent governance failures\n# Callers: main.py (scheduler), ops endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-411 (Gap Closure - Part B)\n\n""""""\nPanel Invariant Monitor\n\nThis module prevents silent governance failures by monitoring panel-backing queries.",\nPanel Invariant Monitor\n\nThis module prevents silent governance failures by monitoring panel-backing queries.\n\nA panel returning zero rows may mean:\n- Correct state (no violations) - acceptable\n- Broken ingestion - FAILURE\n- Filter regression - FAILURE\n- Upstream failure - FAILURE\n\nThe UI cannot distinguish these. This monitor provides out-of-band alerting.\n\nKey Principle: Zero results NEVER block UI rendering.\n               Zero results only trigger out-of-band alerting.\n\nAlert Types:\n- EMPTY,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
321,app/houseofcards/customer/general/facades/__init__.py,CUSTOMER,general,L5,app/houseofcards/customer/general/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: general domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\ngeneral / facades\n\nExports will be added as files are moved here.\n""""""",\ngeneral / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
322,app/houseofcards/customer/general/facades/alerts_facade.py,CUSTOMER,general,L3,app/houseofcards/customer/general/facades/alerts_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api or worker (alert processing)\n#   Execution: async\n# Role: Alerts Facade - Centralized access to alert operations\n# Callers: L2 alerts.py API, SDK, Worker\n# Allowed Imports: L4 alert services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-110 (Alert Configuration API), GAP-111 (Alert History API), GAP-124 (Alert Routing API)\n\n""""""\nAlerts Facade (L4 Domain Logic)\n\nThis facade provides the external interface for alert operations.","\nAlerts Facade (L4 Domain Logic)\n\nThis facade provides the external interface for alert operations.\nAll alert APIs MUST use this facade instead of directly importing\ninternal alert modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes alert configuration and routing\n- Provides unified access to alert history\n- Single point for audit emission\n\nL2 API Routes (GAP-110, GAP-111, GAP-124):\n- POST /api/v1/alerts/rules (create alert rule)\n- GET /api/v1/alerts/rules (list ale",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
323,app/houseofcards/customer/general/facades/compliance_facade.py,CUSTOMER,general,L3,app/houseofcards/customer/general/facades/compliance_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Compliance Facade - Centralized access to compliance operations\n# Callers: L2 compliance.py API, SDK\n# Allowed Imports: L4 compliance services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-103 (Compliance Verification API)\n\n""""""\nCompliance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for compliance verification operations.",\nCompliance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for compliance verification operations.\nAll compliance APIs MUST use this facade instead of directly importing\ninternal compliance modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes compliance verification logic\n- Provides unified access to compliance checks and reports\n- Single point for audit emission\n\nL2 API Routes (GAP-103):\n- POST /api/v1/compliance/verify (run compliance verific,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
324,app/houseofcards/customer/general/facades/lifecycle_facade.py,CUSTOMER,general,L3,app/houseofcards/customer/general/facades/lifecycle_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Lifecycle Facade - Centralized access to lifecycle operations\n# Callers: L2 lifecycle.py API, SDK\n# Allowed Imports: L4 lifecycle services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-131 to GAP-136 (Lifecycle APIs)\n\n""""""\nLifecycle Facade (L4 Domain Logic)",\nLifecycle Facade (L4 Domain Logic)\n\nThis facade provides the external interface for lifecycle operations.\nAll lifecycle APIs MUST use this facade instead of directly importing\ninternal lifecycle modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes agent and run lifecycle logic\n- Provides unified access to state transitions\n- Single point for audit emission\n\nL2 API Routes (GAP-131 to GAP-136):\n- POST /api/v1/lifecycle/agents (create agent)\n- GET /api/v1/lifecycle/age,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
325,app/houseofcards/customer/general/facades/monitors_facade.py,CUSTOMER,general,L3,app/houseofcards/customer/general/facades/monitors_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Temporal:\n#   Trigger: api or scheduler\n#   Execution: async\n# Role: Monitors Facade - Centralized access to monitoring operations\n# Callers: L2 monitors.py API, SDK, Scheduler\n# Allowed Imports: L4 monitor services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-120 (Health Check API), GAP-121 (Monitor Configuration API)\n\n""""""\nMonitors Facade (L4 Domain Logic)","\nMonitors Facade (L4 Domain Logic)\n\nThis facade provides the external interface for monitoring operations.\nAll monitor APIs MUST use this facade instead of directly importing\ninternal monitor modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes health monitoring logic\n- Provides unified access to monitor configuration\n- Single point for audit emission\n\nL2 API Routes (GAP-120, GAP-121):\n- POST /api/v1/monitors (create monitor)\n- GET /api/v1/monitors (list monitors)\n- ",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
326,app/houseofcards/customer/general/facades/scheduler_facade.py,CUSTOMER,general,L3,app/houseofcards/customer/general/facades/scheduler_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api or worker (scheduled execution)\n#   Execution: async\n# Role: Scheduler Facade - Centralized access to job scheduling operations\n# Callers: L2 scheduler.py API, SDK, Worker\n# Allowed Imports: L4 scheduler services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-112 (Scheduled Job API)\n\n""""""\nScheduler Facade (L4 Domain Logic)\n\nThis facade provides the external interface for scheduled job operations.",\nScheduler Facade (L4 Domain Logic)\n\nThis facade provides the external interface for scheduled job operations.\nAll scheduler APIs MUST use this facade instead of directly importing\ninternal scheduler modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes job scheduling logic\n- Provides unified access to job management\n- Single point for audit emission\n\nL2 API Routes (GAP-112):\n- POST /api/v1/scheduler/jobs (create job)\n- GET /api/v1/scheduler/jobs (list jobs)\n- GET /ap,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
327,app/houseofcards/customer/general/lifecycle/engines/base.py,CUSTOMER,general,L5,app/houseofcards/customer/general/lifecycle/engines/base.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync/async\n# Role: Stage Handler Protocol and Base Types\n# Callers: KnowledgeLifecycleManager, stage handlers\n# Allowed Imports: stdlib, L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-071-082, GAP_IMPLEMENTATION_PLAN_V1.md\n\n""""""\nStage Handler Protocol and Base Types\n\nThis module defines the contract for lifecycle stage handlers.","\nStage Handler Protocol and Base Types\n\nThis module defines the contract for lifecycle stage handlers.\n\nCRITICAL DESIGN INVARIANT:\n    Stage handlers are DUMB PLUGINS.\n    They do NOT manage state.\n    They do NOT emit events.\n    They do NOT check policies.\n    The orchestrator does ALL of that.\n\nWhy Dumb:\n- If stages manage state, you get split-brain\n- If stages emit events, you get duplicate audit\n- If stages check policy, you get enforcement fragmentation\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
328,app/houseofcards/customer/general/lifecycle/engines/execution.py,CUSTOMER,general,L5,app/houseofcards/customer/general/lifecycle/engines/execution.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: execution\n# Parent Gap: GAP-071-077 (Lifecycle Stages)\n# Reference: GAP-159, GAP-160, GAP-161\n# Depends On: GAP-057 (ConnectorRegistry), GAP-156/157/158 (Job infrastructure)\n# Temporal:\n#   Trigger: lifecycle orchestrator\n#   Execution: async\n# Role: Real execution implementations for lifecycle stage handlers\n# Callers: IngestHandler, IndexHandler, ClassifyHandler\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""",\nModule: execution\nPurpose: Real execution implementations for knowledge plane lifecycle stages.\n\nWires:\n    - Source: ConnectorRegistry for data source access\n    - Target: Internal storage for processed data\n\nContains:\n    - DataIngestionExecutor (GAP-159): Real data ingestion from connectors\n    - IndexingExecutor (GAP-160): Real embedding generation and indexing\n    - ClassificationExecutor (GAP-161): Real PII detection and classification\n\nAcceptance Criteria:\n    - AC-159-01: Data read via ,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
329,app/houseofcards/customer/general/lifecycle/engines/knowledge_plane.py,CUSTOMER,general,L5,app/houseofcards/customer/general/lifecycle/engines/knowledge_plane.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-056 (KnowledgePlane model)\n""""""\nKnowledgePlane - Knowledge plane models and registry.\n\nProvides knowledge graph abstraction for:\n- Knowledge organization\n- Semantic relationships\n- Multi-source integration\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timezone\nfrom enum import Enum",\nKnowledgePlane - Knowledge plane models and registry.\n\nProvides knowledge graph abstraction for:\n- Knowledge organization\n- Semantic relationships\n- Multi-source integration\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
330,app/houseofcards/customer/general/lifecycle/engines/offboarding.py,CUSTOMER,general,L5,app/houseofcards/customer/general/lifecycle/engines/offboarding.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync/async\n# Role: Offboarding Stage Handlers (GAP-078 to GAP-082)\n# Callers: KnowledgeLifecycleManager via StageRegistry\n# Allowed Imports: stdlib, L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-078-082, GAP_IMPLEMENTATION_PLAN_V1.md\n\n""""""\nOffboarding Stage Handlers\n\nThese handlers implement the ""dumb plugin"" contract for knowledge plane offboarding.","\nOffboarding Stage Handlers\n\nThese handlers implement the ""dumb plugin"" contract for knowledge plane offboarding.\n\nOffboarding Path:\n    ACTIVE → PENDING_DEACTIVATE → DEACTIVATED → ARCHIVED → PURGED\n\nEach handler:\n- Performs ONLY its specific operation\n- Returns success/failure\n- Does NOT manage state\n- Does NOT emit events\n- Does NOT check policies\n\nThe KnowledgeLifecycleManager orchestrates everything else.\n\nCRITICAL: Offboarding is governance-controlled for GDPR/CCPA compliance.\n- PENDING_DEA",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
331,app/houseofcards/customer/general/lifecycle/engines/onboarding.py,CUSTOMER,general,L5,app/houseofcards/customer/general/lifecycle/engines/onboarding.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync/async\n# Role: Onboarding Stage Handlers (GAP-071 to GAP-077)\n# Callers: KnowledgeLifecycleManager via StageRegistry\n# Allowed Imports: stdlib, L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-071-077, GAP_IMPLEMENTATION_PLAN_V1.md\n\n""""""\nOnboarding Stage Handlers\n\nThese handlers implement the ""dumb plugin"" contract for knowledge plane onboarding.","\nOnboarding Stage Handlers\n\nThese handlers implement the ""dumb plugin"" contract for knowledge plane onboarding.\n\nOnboarding Path:\n    DRAFT → PENDING_VERIFY → VERIFIED → INGESTING → INDEXED →\n    CLASSIFIED → PENDING_ACTIVATE → ACTIVE\n\nEach handler:\n- Performs ONLY its specific operation\n- Returns success/failure\n- Does NOT manage state\n- Does NOT emit events\n- Does NOT check policies\n\nThe KnowledgeLifecycleManager orchestrates everything else.\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
332,app/houseofcards/customer/general/lifecycle/engines/pool_manager.py,CUSTOMER,general,L5,app/houseofcards/customer/general/lifecycle/engines/pool_manager.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified connection pool manager with health checking\n# Callers: Services, API routes\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-172 (Connection Pool Management)\n\n""""""\nConnection Pool Manager (GAP-172)\n\nManages connection pools for various services with:",\nConnection Pool Manager (GAP-172)\n\nManages connection pools for various services with:\n- Health checking\n- Per-tenant limits\n- Metrics\n- Graceful shutdown\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
333,app/houseofcards/customer/general/runtime/engines/__init__.py,CUSTOMER,general,L4,app/houseofcards/customer/general/runtime/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Part-2 CRM Workflow Governance Services\n# Callers: L2 (governance APIs), L3 (adapters)\n# Allowed Imports: L5, L6, L8\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-287, PIN-288, PIN-289, PIN-291, PIN-292, PIN-294, PIN-295, part2-design-v1\n\n""""""\nPart-2 CRM Workflow Governance Services\n\nL4 domain services for the Part-2 governance workflow:","\nPart-2 CRM Workflow Governance Services\n\nL4 domain services for the Part-2 governance workflow:\n- Validator: Issue analysis (advisory, stateless)\n- Eligibility: Contract gating (pure rules)\n- Contract Service: State machine (stateful)\n- Governance Orchestrator: Workflow coordination (orchestration only)\n- Job Executor: Step execution (L5)\n- Audit Service: Verification (L8)\n\nImplementation Order (from VALIDATOR_LOGIC.md):\n1. Validator (pure analysis) - DONE (PIN-288)\n2. Eligibility engine (pure ",,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
334,app/houseofcards/customer/general/runtime/engines/constraint_checker.py,CUSTOMER,general,L4,app/houseofcards/customer/general/runtime/engines/constraint_checker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Enforce MonitorConfig inspection constraints before logging\n# Callers: worker/runtime/trace_collector.py, services/logging_service.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-033 (Inspection Constraints)\n\n""""""\nModule: constraint_checker\nPurpose: Enforce inspection constraints from MonitorConfig.\n","\nModule: constraint_checker\nPurpose: Enforce inspection constraints from MonitorConfig.\n\nInspection constraints are ""negative capabilities"" - they define what\na policy is NOT allowed to inspect or capture. Before any logging\noperation, the runner/worker must check these constraints.\n\nConstraint Fields (from MonitorConfig):\n    - allow_prompt_logging: Can prompts be logged?\n    - allow_response_logging: Can responses be logged?\n    - allow_pii_capture: Can PII be captured?\n    - allow_secret_acce",,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
335,app/houseofcards/customer/general/runtime/engines/governance_orchestrator.py,CUSTOMER,general,L4,app/houseofcards/customer/general/runtime/engines/governance_orchestrator.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Governance Orchestrator - orchestrates contract execution\n# Callers: L3 (adapters), L2 (governance APIs)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-292, PART2_CRM_WORKFLOW_CHARTER.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: ORCHESTRATOR-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Governance Orchestrator (L4)\n\nOrchestrates the governance workflow from contract activation through\naudit triggering. This is the ""traffic controller"" - it directs flow\nbut does not execute.\n\nComponents:\n1. Contract Activation Service - APPROVED → ACTIVE\n2. Execution Orchestrator - contract → job plan\n3. Job State Tracker - observes job states\n4. Audit Trigger - hands evidence to audit layer\n\nKey Constraints (PIN-292):\n- Orchestrates only; does not execute jobs\n- No health or audit autho",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
336,app/houseofcards/customer/general/runtime/engines/phase_status_invariants.py,CUSTOMER,general,L4,app/houseofcards/customer/general/runtime/engines/phase_status_invariants.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Phase-status invariant enforcement from GovernanceConfig\n# Callers: ROK (L5), worker runtime\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-051 (Phase-Status Invariants)\n\n""""""\nModule: phase_status_invariants\nPurpose: Enforce phase-status invariants using GovernanceConfig.\n","\nModule: phase_status_invariants\nPurpose: Enforce phase-status invariants using GovernanceConfig.\n\nThe phase_status_invariant_enforce flag in GovernanceConfig controls\nwhether invalid phase-status combinations are blocked.\n\nPhase-Status Invariants:\n    - CREATED, AUTHORIZED: status must be ""queued""\n    - EXECUTING, GOVERNANCE_CHECK, FINALIZING: status must be ""running""\n    - COMPLETED: status must be ""succeeded""\n    - FAILED: status must be ""failed"", ""failed_policy"", ""cancelled"", or ""retry""\n\nWhe",,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
337,app/houseofcards/customer/general/runtime/engines/plan_generation_engine.py,CUSTOMER,general,L4,app/houseofcards/customer/general/runtime/engines/plan_generation_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: api (run creation)\n#   Execution: sync\n# Role: Plan generation (domain logic)\n# Authority: Plan generation decisions (M7 pattern)\n# Callers: API endpoints (L2), run creation flow\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md\n# Reference: PIN-257 Phase R-2 (L5→L4 Violation Fix)\n#\n# GOVERNANCE NOTE: This L4 engine owns PLAN GENERATION logic.\n# L5 runner.py owns only PLAN EXECUTION logic.","\nDomain engine for plan generation.\n\nThis L4 engine contains the authoritative logic for:\n1. Memory context retrieval\n2. Plan generation via planner\n3. Plan validation\n\nL5 workers must receive plans from this engine (via run.plan_json),\nnot generate their own plans.\n\nReference: PIN-257 Phase R-2\nGovernance: PHASE_R_L5_L4_VIOLATIONS.md\n",,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
338,app/houseofcards/customer/general/runtime/engines/run_governance_facade.py,CUSTOMER,general,L3,app/houseofcards/customer/general/runtime/engines/run_governance_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (run lifecycle events)\n#   Execution: sync\n# Role: Run Governance Facade - Centralized access to governance operations for runs\n# Callers: L5 runner (worker runtime)\n# Allowed Imports: L4 domain engines (lessons, policy), L4 audit, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), FIX-002\n\n""""""\nRun Governance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance operations",\nRun Governance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance operations\nduring run execution. The L5 runner MUST use this facade instead of\ndirectly importing L4 engines.\n\nWhy This Facade Exists (PIN-454):\n- Prevents L5→L4 layer violations (runner importing engines directly)\n- Centralizes governance logic for run lifecycle\n- Provides RAC (Runtime Audit Contract) acknowledgment emission\n- Single point for audit expectation/acknowledgment emission\n\nWrapped S,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
339,app/houseofcards/customer/general/runtime/engines/transaction_coordinator.py,CUSTOMER,general,L4,app/houseofcards/customer/general/runtime/engines/transaction_coordinator.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (run completion)\n#   Execution: sync\n# Role: Transaction Coordinator for atomic cross-domain writes\n# Callers: ROK (L5), RunRunner (L5)\n# Allowed Imports: L4 facades, L6 (db, models)\n# Forbidden Imports: L1, L2, L3, L4 engines directly\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), FIX-001\n\n""""""\nTransaction Coordinator for Cross-Domain Writes\n","\nTransaction Coordinator for Cross-Domain Writes\n\nThis module provides atomic transaction coordination for run completion,\nensuring that ALL domain updates succeed or NONE persist.\n\nProblem Addressed (FIX-001):\n- Incident/policy/trace writes are independent\n- Partial failure causes inconsistent state\n- Events published before all operations complete\n\nSolution:\n- Wrap all domain operations in single transaction boundary\n- Track which operations succeeded for rollback\n- Publish events ONLY after s",,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
340,app/houseofcards/customer/general/schemas/__init__.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: general domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\ngeneral / schemas\n\nExports will be added as files are moved here.\n""""""",\ngeneral / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
341,app/houseofcards/customer/general/ui/engines/rollout_projection.py,CUSTOMER,general,L5,app/houseofcards/customer/general/ui/engines/rollout_projection.py,"# Layer: L4 — Domain Engine (Projection)\n# Product: system-wide (Part-2 CRM Workflow)\n# Temporal:\n#   Trigger: query-time\n#   Execution: sync (read-only projection)\n# Role: Rollout Projection - read-only projection of audited truth\n# Callers: L2 (founder console, customer console)\n# Allowed Imports: L6 models only\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-296, GOVERNANCE_AUDIT_MODEL.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: PROJECTION-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Rollout Projection Service (L4 - Projection)\n\nRead-only projection layer that derives rollout state from audited truth.\n\nThis is the FINAL layer of Part-2 governance workflow.\n\nKey Properties:\n- Read-only and derived\n- No execution authority\n- No approval authority\n- No mutation authority\n- A lens, not a lever\n\nComponents:\n- FounderRolloutView: Full lineage projection for founders\n- GovernanceCompletionReport: Machine-generated completion artifact\n- RolloutStage: State machine for exposu",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
342,app/houseofcards/customer/general/utils/time.py,CUSTOMER,general,L6,app/houseofcards/customer/general/utils/time.py,"# Layer: L6 — Platform Substrate\n# AUDIENCE: CUSTOMER\n# Role: Common time utilities for customer domain modules\n\nfrom datetime import datetime, timezone\n\n\ndef utc_now() -> datetime:\n    """"""Get current UTC time.""""""\n    return datetime.now(timezone.utc)",Get current UTC time.,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Utilities),TRANSFER
343,app/houseofcards/customer/general/workflow/contracts/engines/contract_service.py,CUSTOMER,general,L5,app/houseofcards/customer/general/workflow/contracts/engines/contract_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Contract Service - stateful contract state machine\n# Callers: L3 (adapters), L2 (governance APIs)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-291, SYSTEM_CONTRACT_OBJECT.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: CONTRACT-STATE-MACHINE (Non-Negotiable)\n# ==============================================================================\n#",\nPart-2 Contract Service (L4)\n\nManages the System Contract state machine - the first stateful component\nin the Part-2 governance workflow.\n\nResponsibilities:\n1. Create contracts from validated + eligible proposals\n2. Enforce state machine transitions\n3. Record transition history for audit\n4. Enforce terminal state immutability\n\nInvariants (from SYSTEM_CONTRACT_OBJECT.md):\n- CONTRACT-001: Status transitions must follow state machine\n- CONTRACT-002: APPROVED requires approved_by\n- CONTRACT-003: AC,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
344,app/houseofcards/customer/incidents/__init__.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Incidents domain - Exception management\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nIncidents Domain\n\nTopics: active, historical, resolved\nRoles: facades, drivers, engines, schemas\n""""""","\nIncidents Domain\n\nTopics: active, historical, resolved\nRoles: facades, drivers, engines, schemas\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
345,app/houseofcards/customer/incidents/drivers/__init__.py,CUSTOMER,incidents,L6,app/houseofcards/customer/incidents/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: incidents domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nincidents / drivers\n\nExports will be added as files are moved here.\n""""""",\nincidents / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
346,app/houseofcards/customer/incidents/engines/__init__.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: incidents domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nincidents / engines\n\nExports will be added as files are moved here.\n""""""",\nincidents / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
347,app/houseofcards/customer/incidents/engines/incident_aggregator.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/incident_aggregator.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: Incident grouping rules, escalation logic\n# Callers: L2 APIs, L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""Incident Aggregation Service - Prevents Incident Explosion Under Load\n\nThis service implements intelligent incident grouping to prevent thousands of\nmicro-incidents during large outages. It uses a sliding window approach with\nconfigurable thresholds.\n\nKey Features:\n1. Time-window aggregation (default 5 minutes)\n2. Tenant + trigger_type grouping key",Incident Aggregation Service - Prevents Incident Explosion Under Load\n\nThis service implements intelligent incident grouping to prevent thousands of\nmicro-incidents during large outages. It uses a sliding window approach with\nconfigurable thresholds.\n\nKey Features:\n1. Time-window aggregation (default 5 minutes)\n2. Tenant + trigger_type grouping key\n3. Rate limiting (max 1 incident per key per window)\n4. Auto-escalation for high-volume windows\n5. Incident merging for related failures\n\nWatchpoint ,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
348,app/houseofcards/customer/incidents/engines/incident_engine.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/incident_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: worker (run failure events)\n#   Execution: sync\n# Role: Incident creation decision-making (domain logic)\n# Authority: Incident generation from run failures (SDSR pattern)\n# Callers: Worker runtime, API endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: SDSR (PIN-370)\n# Reference: PIN-370 (Scenario-Driven System Realization)\n#\n# GOVERNANCE NOTE: This L4 engine owns INCIDENT CREATION logic.\n# Scenarios inject causes (failed runs), this engine creates incidents.","\nIncident Engine (L4 Domain Logic)\n\nThis engine implements the SDSR cross-domain propagation contract:\n- Run failure (Activity domain) → Incident creation (Incidents domain)\n\nPer PIN-370 Rule 6 (Scenarios Inject Causes, Not Consequences):\n- Scenarios inject a failed run\n- This engine AUTOMATICALLY creates incidents\n- If incident doesn't appear, the ENGINE is broken, not the scenario\n\nReference: PIN-370, INCIDENTS-EXEC-FAILURE-001\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
349,app/houseofcards/customer/incidents/engines/incident_pattern_service.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/incident_pattern_service.py,"# Layer: L4 — Domain Engines\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Detect structural patterns across incidents\n# Callers: Incidents API (L2)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: docs/architecture/incidents/INCIDENTS_DOMAIN_SQL.md#5-act-o4\n\n""""""\nIncident Pattern Service\n\nDetects structural patterns across incidents:","\nIncident Pattern Service\n\nDetects structural patterns across incidents:\n- category_cluster: Multiple incidents in same category\n- severity_spike: Multiple high/critical in short window\n- cascade_failure: Multiple incidents from same source run\n- resolution_pattern: Common resolution methods\n\nDesign Rules:\n- Rule-based only (v1, no ML)\n- Read-only (no writes)\n- No cross-service calls\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
350,app/houseofcards/customer/incidents/engines/incident_read_service.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/incident_read_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync (DB reads)\n# Role: Incident domain read operations (L4)\n# Callers: customer_incidents_adapter.py (L3)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (L3 Adapter Closure - PHASE 1)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides READ operations for the Incidents domain.\n# All incident reads must go through this service.\n# Write operations are handled by GuardWriteService.","\nIncident Read Service (L4)\n\nThis service provides all READ operations for the Incidents domain.\nIt sits between L3 (CustomerIncidentsAdapter) and L6 (Database).\n\nL3 (Adapter) → L4 (this service) → L6 (Database)\n\nResponsibilities:\n- Query incidents with tenant isolation\n- Query incident events\n- Provide bounded, paginated reads\n- No write operations (see GuardWriteService)\n\nReference: PIN-281 (L3 Adapter Closure - PHASE 1)\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
351,app/houseofcards/customer/incidents/engines/incident_write_service.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/incident_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync (DB writes)\n# Role: Incident domain write operations (L4)\n# Callers: customer_incidents_adapter.py (L3)\n# Allowed Imports: L6, L4 (AuditLedgerService)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (L3 Adapter Closure - PHASE 1), PIN-413 (Logs Domain)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides WRITE operations for the Incidents domain.\n# All incident mutations must go through this service.\n# Read operations are handled by IncidentReadService.",\nIncident Write Service (L4)\n\nThis service provides all WRITE operations for the Incidents domain.\nIt sits between L3 (CustomerIncidentsAdapter) and L6 (Database).\n\nL3 (Adapter) → L4 (this service) → L6 (Database)\n\nResponsibilities:\n- Acknowledge incidents (with event creation + audit emit)\n- Resolve incidents (with event creation + audit emit)\n- No direct exposure to L2\n\nReference: PIN-281 (L3 Adapter Closure - PHASE 1)\nReference: PIN-413 (Logs Domain - Audit Ledger)\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
352,app/houseofcards/customer/incidents/engines/incidents_types.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/incidents_types.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Shared type aliases for incidents domain engines\n""""""\nIncidents Domain Shared Types\n\nCanonical type aliases used across multiple engines in the incidents domain.\nThis file consolidates duplicated type definitions (INC-DUP-008).\n\nUsage:\n    from app.houseofcards.customer.incidents.engines.incidents_types import (\n        UuidFn,\n        ClockFn,\n    )","\nIncidents Domain Shared Types\n\nCanonical type aliases used across multiple engines in the incidents domain.\nThis file consolidates duplicated type definitions (INC-DUP-008).\n\nUsage:\n    from app.houseofcards.customer.incidents.engines.incidents_types import (\n        UuidFn,\n        ClockFn,\n    )\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
353,app/houseofcards/customer/incidents/engines/llm_failure_service.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/llm_failure_service.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: S4 failure truth model, fact persistence\n# Callers: L5 workers (on LLM failure)\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""\nLLMFailureService - S4 Failure Truth Implementation\n\nImplements PIN-196 requirements:\n- Failure fact persistence (before any other action)\n- Run state transition to FAILED\n- Evidence capture (mandatory)\n- No downstream contamination\n","\nLLMFailureService - S4 Failure Truth Implementation\n\nImplements PIN-196 requirements:\n- Failure fact persistence (before any other action)\n- Run state transition to FAILED\n- Evidence capture (mandatory)\n- No downstream contamination\n\nARCHITECTURE RULE: Explicit dependency injection, NO lazy service resolution.\nSee LESSONS_ENFORCED.md Invariant #10.\n\nCritical Invariant:\n> A failed run must never appear as ""successful"" or ""completed with results.""\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
354,app/houseofcards/customer/incidents/engines/postmortem_service.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/postmortem_service.py,"# Layer: L4 — Domain Engines\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Extract learnings and post-mortem insights from resolved incidents\n# Callers: Incidents API (L2)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: docs/architecture/incidents/INCIDENTS_DOMAIN_SQL.md#8-res-o4\n\n""""""\nPost-Mortem Service\n\nExtracts learnings from resolved incidents:",\nPost-Mortem Service\n\nExtracts learnings from resolved incidents:\n- Resolution summaries\n- Impact analysis\n- Prevention recommendations\n- Pattern correlations\n\nDesign Rules:\n- Aggregation and analysis only\n- Read-only (no writes)\n- No cross-service calls\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
355,app/houseofcards/customer/incidents/engines/recovery_evaluation_engine.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/recovery_evaluation_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: worker (via failure events)\n#   Execution: async\n# Role: Recovery evaluation decision-making (domain logic)\n# Authority: Recovery decision generation (M9/M10 pattern)\n# Callers: API endpoints, failure processing pipeline\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: DECISION_RECORD_CONTRACT.md\n# Reference: PIN-257 Phase R-1 (L5→L4 Violation Fix)\n#\n# GOVERNANCE NOTE: This L4 engine owns all DECISION logic.\n# L5 recovery_evaluator.py owns only EXECUTION logic.","\nDomain engine for recovery evaluation decisions.\n\nThis L4 engine contains the authoritative decision logic for:\n1. Rule evaluation - evaluate_rules()\n2. Pattern matching - RecoveryMatcher\n3. Confidence combination - combine_confidences()\n4. Action selection threshold - should_select_action()\n5. Auto-execution threshold - should_auto_execute()\n6. Decision record emission - emit_recovery_decision()\n\nL5 workers must call this engine and execute the returned decisions,\nnot implement their own decis",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
356,app/houseofcards/customer/incidents/engines/recovery_rule_engine.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/recovery_rule_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: recovery_evaluator.py (worker)\n# Reference: PIN-240\n# WARNING: If this logic is wrong, ALL products break.\n\n# M10 Recovery Rule Engine\n""""""\nRule-based evaluation engine for recovery suggestions.\n\nEvaluates a set of rules against failure context and returns\nscored action recommendations.\n\nRules can be:\n1. Error code matching (exact or prefix)","\nRule-based evaluation engine for recovery suggestions.\n\nEvaluates a set of rules against failure context and returns\nscored action recommendations.\n\nRules can be:\n1. Error code matching (exact or prefix)\n2. Historical pattern matching\n3. Skill-specific rules\n4. Tenant-specific overrides\n5. Time-based rules (e.g., different behavior during incidents)\n\nEnvironment Variables:\n- RECOVERY_RULE_DEBUG: Enable debug logging for rule evaluation\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
357,app/houseofcards/customer/incidents/engines/recurrence_analysis_service.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/recurrence_analysis_service.py,"# Layer: L4 — Domain Engines\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Analyze recurring incident patterns\n# Callers: Incidents API (L2)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: docs/architecture/incidents/INCIDENTS_DOMAIN_SQL.md#9-hist-o3\n\n""""""\nRecurrence Analysis Service\n\nAnswers ""how often does this type repeat?"":","\nRecurrence Analysis Service\n\nAnswers ""how often does this type repeat?"":\n- Group by (category, resolution_method)\n- Count occurrences over time window\n- Calculate recurrence rate\n\nDesign Rules:\n- Statistical analysis only\n- Read-only (no writes)\n- No cross-service calls\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
358,app/houseofcards/customer/incidents/facades/__init__.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: incidents domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nincidents / facades\n\nExports will be added as files are moved here.\n""""""",\nincidents / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
359,app/houseofcards/customer/incidents/facades/incidents_facade.py,CUSTOMER,incidents,L3,app/houseofcards/customer/incidents/facades/incidents_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB operations)\n# Role: Incidents domain facade - unified entry point for incident management operations\n# Callers: L2 incidents API (incidents.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: INCIDENTS Domain - Customer Console v1 Constitution\n#\n""""""\nIncidents Domain Facade (L4)\n","\nIncidents Domain Facade (L4)\n\nUnified facade for incident management operations.\n\nProvides:\n- List incidents: active, resolved, historical\n- Get incident detail\n- Get incidents by run\n- Pattern detection (ACT-O5)\n- Recurrence analysis (HIST-O3)\n- Cost impact analysis (RES-O3)\n- Metrics\n- Historical trend/distribution/cost-trend\n- Post-mortem learnings (RES-O4)\n\nAll operations are tenant-scoped for isolation.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
360,app/houseofcards/customer/incidents/schemas/__init__.py,CUSTOMER,incidents,L6,app/houseofcards/customer/incidents/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: incidents domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nincidents / schemas\n\nExports will be added as files are moved here.\n""""""",\nincidents / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
361,app/houseofcards/customer/integrations/__init__.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Integrations domain - LLM provider management, connectors, retrieval mediation\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md, HOC_integrations_analysis_v1.md\n\n""""""\nIntegrations Domain\n\nTopics: providers, health, limits, connectors, datasources, mediation, credentials\nRoles: facades, engines, schemas, vault\n\nDOMAIN PERSONA DECLARATION\n==========================\n\nIntegrations serves three personas:","\nIntegrations Domain\n\nTopics: providers, health, limits, connectors, datasources, mediation, credentials\nRoles: facades, engines, schemas, vault\n\nDOMAIN PERSONA DECLARATION\n==========================\n\nIntegrations serves three personas:\n\n1. CUSTOMER CONSOLE — BYOK LLM integrations, datasources, limits\n   - Key files: cus_integration_service.py, integrations_facade.py\n\n2. PLATFORM RUNTIME — Connector registries, lifecycle, health\n   - Key files: connector_registry.py, *_connector.py\n\n3. MEDIATION",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
362,app/houseofcards/customer/integrations/drivers/__init__.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: integrations domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nintegrations / drivers\n\nExports will be added as files are moved here.\n""""""",\nintegrations / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
363,app/houseofcards/customer/integrations/engines/__init__.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: integrations domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nintegrations / engines\n\nExports will be added as files are moved here.\n""""""",\nintegrations / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
364,app/houseofcards/customer/integrations/engines/connector_registry.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/connector_registry.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-057 (ConnectorRegistry), GAP-061/062/064 (Connectors)\n""""""\nConnectorRegistry - Connector management and registration.\n\nProvides a unified registry for:\n- Connector type registration\n- Connector instance management\n- Capability discovery\n- Status monitoring\n""""""\n\nfrom abc import ABC, abstractmethod\nfrom dataclasses import dataclass, field",\nConnectorRegistry - Connector management and registration.\n\nProvides a unified registry for:\n- Connector type registration\n- Connector instance management\n- Capability discovery\n- Status monitoring\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
365,app/houseofcards/customer/integrations/engines/credentials/__init__.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/credentials/__init__.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Temporal:\n#   Trigger: api (via connectors)\n#   Execution: async\n# Role: Canonical credential types for connector services\n# Callers: http_connector.py, mcp_connector.py, sql_gateway.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: INT-DUP-001, INT-DUP-002 (Quarantine Resolution)\n\n""""""\nCredentials Engine — Canonical Types\n","\nCredentials Engine — Canonical Types\n\nThis package provides the canonical definitions for credential types\nused by connector services (HTTP, MCP, SQL Gateway).\n\nAUTHORITY:\n    This is the ONLY authoritative source for:\n    - Credential dataclass\n    - CredentialService protocol\n\nAll connector files MUST import from here.\nDo NOT define local Credential or CredentialService types in connectors.\n\nExports:\n    - Credential: Simple credential value holder\n    - CredentialService: Protocol for creden",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
366,app/houseofcards/customer/integrations/engines/credentials/protocol.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/engines/credentials/protocol.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Temporal:\n#   Trigger: api (via connectors)\n#   Execution: async\n# Role: Canonical CredentialService protocol for connector services\n# Callers: http_connector.py, mcp_connector.py, sql_gateway.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: INT-DUP-002 (Quarantine Resolution)\n\n""""""\nCredentialService Protocol — Canonical Definition\n",\nCredentialService Protocol — Canonical Definition\n\nThis is the CANONICAL and ONLY authoritative definition of the\nCredentialService protocol used by connector services.\n\nHistory:\n    Previously duplicated in:\n    - http_connector.py (lines 106-112)\n    - mcp_connector.py (lines 97-103)\n    - sql_gateway.py (lines 121-127)\n\n    Consolidated here per INT-DUP-002 quarantine resolution.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Protocol),TRANSFER
367,app/houseofcards/customer/integrations/engines/credentials/types.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/engines/credentials/types.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Temporal:\n#   Trigger: api (via connectors)\n#   Execution: async\n# Role: Canonical Credential dataclass for connector services\n# Callers: http_connector.py, mcp_connector.py, sql_gateway.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: INT-DUP-001 (Quarantine Resolution)\n\n""""""\nCredential Type — Canonical Definition\n",\nCredential Type — Canonical Definition\n\nThis is the CANONICAL and ONLY authoritative definition of the\nCredential dataclass used by connector services.\n\nHistory:\n    Previously duplicated in:\n    - http_connector.py (lines 99-103)\n    - mcp_connector.py (lines 90-94)\n    - sql_gateway.py (lines 114-118)\n\n    Consolidated here per INT-DUP-001 quarantine resolution.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Types),TRANSFER
368,app/houseofcards/customer/integrations/engines/cus_integration_service.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/cus_integration_service.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: CUSTOMER\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync (with async DB operations)\n# Role: Business logic for Customer Integration domain (LLM BYOK, SDK, RAG)\n# Callers: aos_cus_integrations.py API router\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Connectivity Domain - Customer Console v1 Constitution\n\n""""""Customer Integration Service\n\nPURPOSE:","Customer Integration Service\n\nPURPOSE:\n    Business logic for managing customer LLM integrations.\n    Handles CRUD operations, lifecycle transitions, and limit calculations.\n\nRESPONSIBILITIES:\n    - Create, update, delete integrations\n    - Enable/disable lifecycle transitions\n    - Calculate current usage vs limits\n    - Coordinate health checks (delegates to cus_health_service)\n\nSTATE MACHINE:\n    created -> enabled -> disabled -> enabled (cycle)\n    created -> deleted (terminal)\n    enabled -",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
369,app/houseofcards/customer/integrations/engines/external_response_service.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/external_response_service.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker|scheduler\n#   Execution: sync\n# Role: External response persistence and interpretation service\n# Callers: L3 adapters (record_raw), L4 engines (interpret), L5/L2 (read_interpreted)\n# Allowed Imports: L6 (db, models)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-256 Phase E FIX-04\n\n""""""\nExternal Response Service (Phase E FIX-04)\n\nL6 service for persisting raw external responses and their interpretations.",\nExternal Response Service (Phase E FIX-04)\n\nL6 service for persisting raw external responses and their interpretations.\n\nWrite Path (L3 → L6):\n- Adapters call record_raw_response() with raw data\n- Raw data is persisted with interpretation_owner declared\n- L3 returns only receipt confirmation (not interpretation)\n\nInterpretation Path (L4 → L6):\n- L4 engines call interpret() with domain-meaningful result\n- interpreted_value is persisted with interpreted_by\n\nRead Path (L5/L2 ← L6):\n- Consumers cal,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
370,app/houseofcards/customer/integrations/engines/http_connector.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/http_connector.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (via mediation layer)\n#   Execution: async\n# Role: Machine-controlled HTTP connector (NOT LLM-controlled)\n# Callers: RetrievalMediator\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-059\n\n""""""\nModule: http_connector\nPurpose: Machine-controlled HTTP connector (NOT LLM-controlled).\n","\nModule: http_connector\nPurpose: Machine-controlled HTTP connector (NOT LLM-controlled).\n\nKey Difference from HttpCallSkill:\n    - HttpCallSkill: LLM controls URL, headers, body (DANGEROUS)\n    - HttpConnectorService: Machine resolves URL from registry, LLM only provides action\n\nSecurity Model:\n    - Base URL: Machine-controlled (from connector config)\n    - Auth: Machine-controlled (from vault)\n    - Endpoints: Machine-controlled (action -> path mapping)\n    - Payload: LLM-controlled but valida",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
371,app/houseofcards/customer/integrations/engines/mcp_connector.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/mcp_connector.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (via mediation layer)\n#   Execution: async\n# Role: Model Context Protocol (MCP) tool invocation with governance\n# Callers: RetrievalMediator\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-063\n\n""""""\nModule: mcp_connector\nPurpose: Model Context Protocol (MCP) tool invocation with governance.\n",\nModule: mcp_connector\nPurpose: Model Context Protocol (MCP) tool invocation with governance.\n\nMCP Spec: Tools are invoked via standardized JSON-RPC protocol.\nThis connector governs which tools can be called and with what parameters.\n\nSecurity Model:\n    - Tool allowlist: Machine-controlled\n    - Server URL: Machine-controlled\n    - Authentication: Machine-controlled (from vault)\n    - Parameter validation: Against JSON Schema\n\nImports (Dependencies):\n    - None (credential service passed via co,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
372,app/houseofcards/customer/integrations/engines/retrieval_mediator.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/retrieval_mediator.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (aos_sdk.access calls)\n#   Execution: sync\n# Role: Unified mediation layer for all external data access\n# Callers: L2 API routes, skill execution\n# Allowed Imports: L6 (logging, datetime)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-065\n\n""""""\nModule: retrieval_mediator\nPurpose: All external data access must route through this layer.\n","\nModule: retrieval_mediator\nPurpose: All external data access must route through this layer.\n\nThis is the CENTRAL CHOKE POINT for data retrieval.\nAny data access from LLM-controlled code MUST go through here.\n\nImports (Dependencies):\n    - None (interfaces defined here, implementations injected)\n\nExports (Provides):\n    - RetrievalMediator: Main mediation class\n    - MediatedResult: Result of a mediated access\n    - MediationDeniedError: Raised when access denied\n    - get_retrieval_mediator(): ",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
373,app/houseofcards/customer/integrations/engines/server_registry.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/server_registry.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# PHASE: W0\n# Product: system-wide\n# Wiring Type: registry\n# Parent Gap: GAP-063 (MCPConnector)\n# Reference: GAP-141, HOC_integrations_analysis_v1.md\n# Temporal:\n#   Trigger: api (MCP server management)\n#   Execution: async\n# Role: Registry for external MCP servers\n# Callers: L2 API routes, skill execution\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n#",\nModule: server_registry\nPurpose: Registry for external MCP servers.\n\nProvides:\n    - MCP server registration\n    - Server capability discovery\n    - Health monitoring\n    - Tenant-scoped access control\n\nDatabase Table: mcp_servers (requires GAP-170 migration)\n\nMCP Protocol Reference: https://modelcontextprotocol.io/specification\n\nAcceptance Criteria:\n    - AC-141-01: Servers can be registered\n    - AC-141-02: Tool discovery via MCP protocol\n    - AC-141-03: Health monitoring\n    - AC-141-04: Te,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
374,app/houseofcards/customer/integrations/engines/sql_gateway.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/sql_gateway.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (via mediation layer)\n#   Execution: async\n# Role: Template-based SQL queries (NO raw SQL from LLM)\n# Callers: RetrievalMediator\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-060\n\n""""""\nModule: sql_gateway\nPurpose: Template-based SQL queries (NO raw SQL from LLM).\n","\nModule: sql_gateway\nPurpose: Template-based SQL queries (NO raw SQL from LLM).\n\nKey Difference from PostgresQuerySkill:\n    - PostgresQuerySkill: LLM provides SQL string (DANGEROUS)\n    - SqlGatewayService: LLM selects template ID, machine fills parameters\n\nSecurity Invariant: LLM NEVER sees or constructs SQL.\nThe SQL comes from pre-registered, audited templates.\n\nImports (Dependencies):\n    - None (credential service passed via constructor)\n\nExports (Provides):\n    - SqlGatewayService: Governe",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
375,app/houseofcards/customer/integrations/facades/__init__.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: integrations domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nintegrations / facades\n\nExports will be added as files are moved here.\n""""""",\nintegrations / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
376,app/houseofcards/customer/integrations/facades/connectors_facade.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/connectors_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Connectors Facade - Centralized access to connector operations\n# Callers: L2 connectors.py API, SDK\n# Allowed Imports: L4 connector services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-093 (Connector Registry API)\n\n""""""\nConnectors Facade (L4 Domain Logic)\n\nThis facade provides the external interface for connector operations.","\nConnectors Facade (L4 Domain Logic)\n\nThis facade provides the external interface for connector operations.\nAll connector APIs MUST use this facade instead of directly importing\ninternal connector modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes connector management logic\n- Provides unified access to HTTP, SQL, MCP connectors\n- Single point for audit emission\n\nWrapped Services:\n- ConnectorRegistry: Connector registration and management\n- HTTPConnector: HTTP/REST ",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
377,app/houseofcards/customer/integrations/facades/datasources_facade.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/datasources_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: DataSources Facade - Centralized access to data source operations\n# Callers: L2 datasources.py API, SDK\n# Allowed Imports: L4 datasource services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-113 (Data Sources API)\n\n""""""\nDataSources Facade (L4 Domain Logic)\n\nThis facade provides the external interface for data source operations.",\nDataSources Facade (L4 Domain Logic)\n\nThis facade provides the external interface for data source operations.\nAll data source APIs MUST use this facade instead of directly importing\ninternal datasource modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes data source management\n- Provides unified access to source configuration\n- Single point for audit emission\n\nL2 API Routes (GAP-113):\n- POST /api/v1/datasources (create source)\n- GET /api/v1/datasources (list sources,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
378,app/houseofcards/customer/integrations/facades/integrations_facade.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/integrations_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB operations)\n# Role: Integrations domain facade - unified entry point for integration management\n# Callers: L2 integrations API (aos_cus_integrations.py)\n# Allowed Imports: L4 (CusIntegrationService), L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Connectivity Domain - Customer Console v1 Constitution\n#\n""""""\nIntegrations Domain Facade (L4)\n","\nIntegrations Domain Facade (L4)\n\nUnified facade for LLM integration management (BYOK - Bring Your Own Key).\n\nProvides:\n- CRUD: list, get, create, update, delete integrations\n- Lifecycle: enable, disable\n- Health: get health status, test credentials\n- Limits: get usage vs limits\n\nThis facade wraps the CusIntegrationService and provides dataclass result types\nfor consistency with other domain facades.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
379,app/houseofcards/customer/integrations/facades/retrieval_facade.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/retrieval_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Retrieval Facade - Centralized access to mediated data retrieval\n# Callers: L2 retrieval.py API, SDK\n# Allowed Imports: L4 retrieval mediator, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-094 (Mediated Data Retrieval API)\n\n""""""\nRetrieval Facade (L4 Domain Logic)\n\nThis facade provides the external interface for mediated data retrieval operations.",\nRetrieval Facade (L4 Domain Logic)\n\nThis facade provides the external interface for mediated data retrieval operations.\nAll retrieval APIs MUST use this facade instead of directly importing\nthe RetrievalMediator.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes retrieval mediation logic\n- Provides unified access to data retrieval with policy enforcement\n- Single point for audit emission\n\nWrapped Services:\n- RetrievalMediator: Central choke point for data access (GAP-065),,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
380,app/houseofcards/customer/integrations/schemas/__init__.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: integrations domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nintegrations / schemas\n\nExports will be added as files are moved here.\n""""""",\nintegrations / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
381,app/houseofcards/customer/integrations/schemas/datasource_model.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/schemas/datasource_model.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-055 (CustomerDataSource model)\n""""""\nCustomerDataSource - Customer data source models and registry.\n\nProvides data source abstraction for:\n- Database connections\n- File storage\n- API endpoints\n- Vector stores\n- Custom connectors\n""""""\n\nfrom dataclasses import dataclass, field",\nCustomerDataSource - Customer data source models and registry.\n\nProvides data source abstraction for:\n- Database connections\n- File storage\n- API endpoints\n- Vector stores\n- Custom connectors\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
382,app/houseofcards/customer/integrations/vault/engines/cus_credential_service.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/vault/engines/cus_credential_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Credential encryption and vault integration for customer LLM integrations\n# Callers: cus_integration_service.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md\n\n""""""Customer Credential Service\n\nPURPOSE:\n    Secure handling of customer LLM API credentials.","Customer Credential Service\n\nPURPOSE:\n    Secure handling of customer LLM API credentials.\n    Encrypts credentials at rest, provides vault-ready integration.\n\nSECURITY PRINCIPLES:\n    1. NO PLAINTEXT PERSISTENCE: All stored credentials are encrypted\n    2. ROTATION-READY: Credentials can be rotated without downtime\n    3. AUDIT TRAIL: All credential access is logged\n    4. MINIMAL EXPOSURE: Decryption only at point of use\n\nCREDENTIAL REFERENCE FORMAT:\n    - vault://<path>         - HashiCorp Va",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
383,app/houseofcards/customer/integrations/vault/engines/service.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/vault/engines/service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: High-level credential service with validation and auditing\n# Callers: ConnectorRegistry, LifecycleHandlers, API routes\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-171 (Credential Vault Integration)\n\n""""""\nCredential Service (GAP-171)\n\nHigh-level service for credential management with:",\nCredential Service (GAP-171)\n\nHigh-level service for credential management with:\n- Input validation\n- Audit logging\n- Expiration checking\n- Rotation scheduling\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
384,app/houseofcards/customer/integrations/vault/engines/vault.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/vault/engines/vault.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# PHASE: W2\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Credential vault abstraction with multiple provider support\n# Callers: CredentialService\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-171 (Credential Vault Integration), HOC_integrations_analysis_v1.md\n#\n# GOVERNANCE: TRANSITIONAL FILE — INV-INT-006\n# This file is AUDIENCE: INTERNAL but currently lives under customer/.",\nCredential Vault Abstraction (GAP-171)\n\nSupports multiple vault providers:\n- HashiCorp Vault (production)\n- AWS Secrets Manager (production)\n- Environment variables (development only)\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
385,app/houseofcards/customer/logs/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Logs domain - Evidence and audit\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nLogs Domain\n\nTopics: audit, llm_runs, system\nRoles: facades, schemas\n""""""","\nLogs Domain\n\nTopics: audit, llm_runs, system\nRoles: facades, schemas\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
386,app/houseofcards/customer/logs/drivers/__init__.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: logs domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nlogs / drivers\n\nExports will be added as files are moved here.\n""""""",\nlogs / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
387,app/houseofcards/customer/logs/engines/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: logs domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nlogs / engines\n\nExports will be added as files are moved here.\n""""""",\nlogs / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
388,app/houseofcards/customer/logs/engines/audit_evidence.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/audit_evidence.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: audit\n# Parent Gap: GAP-063 (MCPConnector), GAP-081 (AuditDaemon)\n# Reference: GAP-143\n# Depends On: GAP-141 (MCPServerRegistry), GAP-142 (MCPPolicyMapper)\n# Temporal:\n#   Trigger: worker (tool invocation)\n#   Execution: async\n# Role: Emit compliance-grade audit for MCP tool calls\n# Callers: Runner, skill executor\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""",\nModule: audit_evidence\nPurpose: Emit compliance-grade audit for MCP tool calls.\n\nWires:\n    - Source: app/services/mcp/policy_mapper.py (policy decisions)\n    - Source: app/services/mcp/server_registry.py (server/tool info)\n    - Target: app/events (event bus) / audit storage\n\nThis module:\n    1. Emits audit events for all MCP tool invocations\n    2. Records policy decisions for compliance\n    3. Captures input/output for forensic analysis\n    4. Provides tamper-evident audit trail\n\nAcceptance ,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
389,app/houseofcards/customer/logs/engines/certificate.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/certificate.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Callers: guard.py (replay endpoint)\n# Reference: PIN-240\n\n""""""M23 Certificate Service - Cryptographic Evidence of Deterministic Replay\n\nUses M4 HMAC infrastructure to create signed certificates that prove:\n1. Policy decisions were evaluated at a specific time\n2. Replay validation passed at a specific determinism level\n3. No tampering occurred between original call and validation\n\nCertificate Structure:\n- Certificate ID (UUID)\n- Original call metadata",M23 Certificate Service - Cryptographic Evidence of Deterministic Replay\n\nUses M4 HMAC infrastructure to create signed certificates that prove:\n1. Policy decisions were evaluated at a specific time\n2. Replay validation passed at a specific determinism level\n3. No tampering occurred between original call and validation\n\nCertificate Structure:\n- Certificate ID (UUID)\n- Original call metadata\n- Replay validation result\n- HMAC signature (using M4 infrastructure)\n- Timestamp and expiry\n\nUsage:\n    fr,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
390,app/houseofcards/customer/logs/engines/completeness_checker.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/completeness_checker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Evidence PDF completeness validation for SOC2 compliance\n# Callers: pdf_renderer, evidence_report, export APIs\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-027 (Evidence PDF Completeness)\n\n""""""\nModule: completeness_checker\nPurpose: Validate evidence bundle completeness before PDF generation.\n","\nModule: completeness_checker\nPurpose: Validate evidence bundle completeness before PDF generation.\n\nEvidence PDF exports require specific fields for SOC2 compliance.\nThis module validates that all required fields are present and\nnon-empty before allowing PDF generation.\n\nRequired Fields (Standard):\n    - incident_id, tenant_id, run_id, trace_id\n    - policy_snapshot_id, termination_reason\n    - total_steps, total_tokens, total_cost_cents\n\nSOC2 Required Fields (Enhanced):\n    - control_mappings,",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
391,app/houseofcards/customer/logs/engines/durability.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/durability.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: RAC durability enforcement before acknowledgment\n# Callers: ROK (L5), Facades (L4), AuditReconciler (L4)\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-050 (RAC Durability Enforcement)\n\n""""""\nModule: durability\nPurpose: Enforce RAC durability before acknowledgment.\n",\nModule: durability\nPurpose: Enforce RAC durability before acknowledgment.\n\nThe rac_durability_enforce flag in GovernanceConfig controls whether\ndurability is strictly enforced before acknowledging audit operations.\n\nWhen enabled:\n    - Acks must be persisted to durable storage before being accepted\n    - Expectations must be durably stored before run starts\n    - In-memory-only mode raises RACDurabilityEnforcementError\n\nThis ensures audit contracts survive crashes and can be reconciled\neven if ,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
392,app/houseofcards/customer/logs/engines/evidence_report.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/evidence_report.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Callers: guard.py (incident export endpoint)\n# Reference: PIN-240\n\n""""""\nEvidence Report Generator - Legal-Grade PDF Export\n\nGenerates deterministic, verifiable PDF evidence reports for AI incidents.\nThis document must survive legal review, audit, and hostile questioning.\n\nFeatures:\n- Cover page with metadata\n- Executive summary for legal/leadership\n- Factual reconstruction (pure evidence)","\nEvidence Report Generator - Legal-Grade PDF Export\n\nGenerates deterministic, verifiable PDF evidence reports for AI incidents.\nThis document must survive legal review, audit, and hostile questioning.\n\nFeatures:\n- Cover page with metadata\n- Executive summary for legal/leadership\n- Factual reconstruction (pure evidence)\n- Policy evaluation record\n- Decision timeline (deterministic trace)\n- Replay verification with hash matching\n- Counterfactual prevention proof\n- Remediation & controls\n- Legal at",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
393,app/houseofcards/customer/logs/engines/export_bundle_service.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/export_bundle_service.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Generate structured export bundles from incidents and traces\n# Callers: api/incidents.py\n# Allowed Imports: L4, L5, L6\n# Forbidden Imports: L1, L2\n# Reference: BACKEND_REMEDIATION_PLAN.md GAP-004, GAP-005, GAP-008\n\n""""""\nExport Bundle Service\n\nGenerates structured export bundles from incidents, runs, and traces","\nExport Bundle Service\n\nGenerates structured export bundles from incidents, runs, and traces\nfor evidence export, SOC2 compliance, and executive debriefs.\n\nKey Responsibilities:\n1. Load incident, run, and trace data\n2. Assemble EvidenceBundle with all cross-domain links\n3. Enhance for SOC2 compliance (control mappings)\n4. Generate executive summary (non-technical)\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
394,app/houseofcards/customer/logs/engines/logs_read_service.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/logs_read_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async (delegates to L6)\n# Role: Logs/Traces domain read operations (L4)\n# Callers: customer_logs_adapter.py (L3)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (L3 Adapter Closure - PHASE 1)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides READ operations for the Logs/Traces domain.\n# All log/trace reads must go through this service.\n# The L3 adapter should NOT import L6 directly.",\nLogs Read Service (L4)\n\nThis service provides all READ operations for the Logs/Traces domain.\nIt sits between L3 (CustomerLogsAdapter) and L6 (PostgresTraceStore).\n\nL3 (Adapter) → L4 (this service) → L6 (PostgresTraceStore)\n\nResponsibilities:\n- Query traces with tenant isolation\n- Get trace details\n- Get trace counts\n- Search traces with filters\n- No write operations (writes go through runtime)\n\nReference: PIN-281 (L3 Adapter Closure - PHASE 1)\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
395,app/houseofcards/customer/logs/engines/pdf_renderer.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/pdf_renderer.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Render export bundles to PDF format\n# Callers: api/incidents.py\n# Allowed Imports: L4, L5, L6\n# Forbidden Imports: L1, L2\n# Reference: BACKEND_REMEDIATION_PLAN.md GAP-004, GAP-005\n\n""""""\nPDF Renderer Service\n\nRenders export bundles to PDF format for compliance exports,","\nPDF Renderer Service\n\nRenders export bundles to PDF format for compliance exports,\nexecutive debriefs, and evidence documentation.\n\nKey Responsibilities:\n1. Render EvidenceBundle to detailed PDF\n2. Render SOC2Bundle with control attestations\n3. Render ExecutiveDebriefBundle for leadership\n\nUses reportlab for PDF generation (same library as evidence_report.py).\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
396,app/houseofcards/customer/logs/engines/reconciler.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/reconciler.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler/ROK\n#   Execution: sync\n# Role: Reconcile audit expectations against acknowledgments\n# Callers: ROK (L5), Scheduler (L5)\n# Allowed Imports: L4 (audit models/store), L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nAudit Reconciler\n\nPerforms four-way validation of expectations vs acknowledgments:",\nAudit Reconciler\n\nPerforms four-way validation of expectations vs acknowledgments:\n\n1. expected − acked → missing (audit alert)\n2. acked − expected → drift (unexpected action)\n3. missing finalization → stale run (liveness violation)\n4. expectations without deadline → invalid contract\n\nThis is the core of the Runtime Audit Contract (RAC).\n\nUsage:\n    reconciler = get_audit_reconciler()\n    result = reconciler.reconcile(run_id)\n\n    if not result.is_clean:\n        # Handle issues\n        if resul,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
397,app/houseofcards/customer/logs/engines/replay_determinism.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/replay_determinism.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Replay determinism validation for LLM calls — CANONICAL DEFINITIONS\n# Callers: logs_facade.py, evidence services, other domains (read-only)\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Governance: INV-LOGS-003 — Determinism definitions live here exclusively\n# Reference: HOC_logs_analysis_v1.md\n\n""""""Replay Determinism Service - Defines and Enforces Determinism Semantics\n","Replay Determinism Service - Defines and Enforces Determinism Semantics\n\nWatchpoint #2: Replay Determinism Across Model Versions\n\nThis service addresses the fundamental tension between:\n- ""Logical Determinism"": Same policy decision given same context\n- ""Byte-for-byte Determinism"": Exact same output bytes\n\nKey Insight: As upstream LLM models drift (model updates, temperature changes),\nwe cannot guarantee byte-for-byte determinism. However, we CAN guarantee:\n\n1. Policy decisions are deterministic ",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
398,app/houseofcards/customer/logs/engines/store.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/store.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Storage for audit expectations and acknowledgments\n# Callers: ROK (L5), Facades (L4), AuditReconciler (L4)\n# Allowed Imports: L6 (Redis, stdlib)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nAudit Store\n\nProvides storage for audit expectations and acknowledgments.","\nAudit Store\n\nProvides storage for audit expectations and acknowledgments.\n\nStorage Strategy:\n- MEMORY: In-memory dictionary (dev/test only - NOT crash-safe)\n- REDIS: Redis-backed store (staging/prod - crash-safe, cross-process)\n\nDurability Modes:\n- AOS_MODE=local → MEMORY allowed\n- AOS_MODE=test/prod → REDIS required (startup fails without it)\n\nThe store is designed to be:\n1. Fast for writes (acks happen in hot path)\n2. Durable in production (Redis backing mandatory)\n3. TTL-managed (old data ex",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
399,app/houseofcards/customer/logs/facades/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: logs domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nlogs / facades\n\nExports will be added as files are moved here.\n""""""",\nlogs / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
400,app/houseofcards/customer/logs/facades/evidence_facade.py,CUSTOMER,logs,L3,app/houseofcards/customer/logs/facades/evidence_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Evidence Facade - Centralized access to evidence and export operations\n# Callers: L2 evidence.py API, SDK\n# Allowed Imports: L4 evidence services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-104 (Evidence Chain API), GAP-105 (Evidence Export API)\n\n""""""\nEvidence Facade (L4 Domain Logic)\n\nThis facade provides the external interface for evidence chain and export operations.","\nEvidence Facade (L4 Domain Logic)\n\nThis facade provides the external interface for evidence chain and export operations.\nAll evidence APIs MUST use this facade instead of directly importing\ninternal evidence modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes evidence chain management\n- Provides unified access to evidence export\n- Single point for audit emission\n\nL2 API Routes (GAP-104, GAP-105):\n- GET /api/v1/evidence/chains (list evidence chains)\n- GET /api/v1/ev",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
401,app/houseofcards/customer/logs/facades/logs_facade.py,CUSTOMER,logs,L3,app/houseofcards/customer/logs/facades/logs_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB reads)\n# Role: Logs domain facade - unified entry point for all logs operations\n# Callers: L2 logs API (logs.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: LOGS_DOMAIN_V2_CONTRACT.md, PIN-411, HOC_logs_analysis_v1.md\n#\n# GOVERNANCE: INV-LOGS-005\n# This facade is COMPOSITION-ONLY. No new computation logic inside.\n# All logic must live in engines or sub-facades.","\nLogs Domain Facade (L4)\n\nUnified facade for all logs domain operations:\n- LLM_RUNS: envelope, trace, governance, replay, export\n- SYSTEM_LOGS: snapshot, telemetry, events, replay, audit\n- AUDIT: identity, authorization, access, integrity, exports\n\nAll responses include EvidenceMetadata per INV-LOG-META-001.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
402,app/houseofcards/customer/logs/facades/trace_facade.py,CUSTOMER,logs,L3,app/houseofcards/customer/logs/facades/trace_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (run execution)\n#   Execution: async\n# Role: Trace Domain Facade - Centralized access to trace operations with RAC acks\n# Callers: L5 runner/observability guard (via dependency injection), API routes\n# Allowed Imports: L4 audit, L6 (trace store, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nTrace Domain Facade (L4 Domain Logic)\n\nThis facade provides the external interface to the Trace domain.",\nTrace Domain Facade (L4 Domain Logic)\n\nThis facade provides the external interface to the Trace domain.\nIt wraps TraceStore operations and emits RAC acknowledgments.\n\nWhy This Facade Exists (PIN-454):\n- Centralized RAC acknowledgment emission for trace operations\n- Clean interface between L5 execution and L6 platform\n- Domain encapsulation for trace operations\n\nRAC Integration:\n- Emits START_TRACE ack after trace creation\n- Emits COMPLETE_TRACE ack after trace completion\n\nUsage:\n    from app.se,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
403,app/houseofcards/customer/logs/schemas/__init__.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: logs domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nlogs / schemas\n\nExports will be added as files are moved here.\n""""""",\nlogs / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
404,app/houseofcards/customer/logs/schemas/models.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/schemas/models.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Runtime Audit Contract models\n# Callers: AuditStore, AuditReconciler, ROK, Facades\n# Allowed Imports: L6 (stdlib only)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nRuntime Audit Contract (RAC) Models\n\nThese models define the data structures for the audit system:",\nRuntime Audit Contract (RAC) Models\n\nThese models define the data structures for the audit system:\n\n- AuditExpectation: Declares what action MUST happen for a run\n- DomainAck: Reports that an action has completed\n- ReconciliationResult: Result of comparing expectations vs acks\n\nDesign Principles:\n1. Immutable after creation (expectations are contracts)\n2. UUID-based for correlation across domains\n3. Serializable for Redis storage\n4. Type-safe with enums for domains and actions\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
405,app/houseofcards/customer/overview/__init__.py,CUSTOMER,overview,L5,app/houseofcards/customer/overview/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Overview domain - System health at a glance\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md, HOC_overview_analysis_v1.md\n\n""""""\nOverview Domain\n\nTopics: cost_intelligence, decisions, highlights\nRoles: facades, schemas\n\nDOMAIN CONTRACT (Constitutional)\n================================\n\nOverview is a PROJECTION-ONLY domain. It synthesizes status","\nOverview Domain\n\nTopics: cost_intelligence, decisions, highlights\nRoles: facades, schemas\n\nDOMAIN CONTRACT (Constitutional)\n================================\n\nOverview is a PROJECTION-ONLY domain. It synthesizes status\nfrom other domains but owns no state and triggers no effects.\n\nINVARIANTS (Non-Negotiable):\n\n  INV-OVW-001: Overview DOES NOT own any tables\n  INV-OVW-002: Overview NEVER triggers side-effects\n  INV-OVW-003: All mutations route to owning domains\n  INV-OVW-004: No business rules — ",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
406,app/houseofcards/customer/overview/drivers/__init__.py,CUSTOMER,overview,L6,app/houseofcards/customer/overview/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: overview domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\noverview / drivers\n\nExports will be added as files are moved here.\n""""""",\noverview / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
407,app/houseofcards/customer/overview/engines/__init__.py,CUSTOMER,overview,L5,app/houseofcards/customer/overview/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: overview domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\noverview / engines\n\nExports will be added as files are moved here.\n""""""",\noverview / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
408,app/houseofcards/customer/overview/facades/__init__.py,CUSTOMER,overview,L5,app/houseofcards/customer/overview/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: overview domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\noverview / facades\n\nExports will be added as files are moved here.\n""""""",\noverview / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
409,app/houseofcards/customer/overview/facades/overview_facade.py,CUSTOMER,overview,L3,app/houseofcards/customer/overview/facades/overview_facade.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Overview Facade - Centralized access to overview domain operations\n# Pattern: app/houseofcards/customer/overview/facades/overview_facade.py\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nOverview Facade (L4 Domain Logic)\n\nThis facade provides the external interface for overview operations.\nAll overview APIs MUST use this facade instead of directly importing\nmodels or executing queries in L2.\n\nWhy This Facade Exists:\n- Prevents L2→L6 layer violations (direct model imports)",\nOverview Facade (L4 Domain Logic)\n\nThis facade provides the external interface for overview operations.\nAll overview APIs MUST use this facade instead of directly importing\nmodels or executing queries in L2.\n\nWhy This Facade Exists:\n- Prevents L2→L6 layer violations (direct model imports)\n- Centralizes overview aggregation logic\n- Single point for tenant-scoped queries\n- Maintains projection-only architecture\n\nARCHITECTURAL RULE:\n- Overview DOES NOT own any tables\n- Overview aggregates/projects,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
410,app/houseofcards/customer/overview/schemas/__init__.py,CUSTOMER,overview,L6,app/houseofcards/customer/overview/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: overview domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\noverview / schemas\n\nExports will be added as files are moved here.\n""""""",\noverview / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
411,app/houseofcards/customer/policies/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: Policies domain - Behavior control\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nPolicies Domain\n\nTopics: active, lessons, library, controls, violations\nRoles: facades, drivers, engines, schemas\n""""""","\nPolicies Domain\n\nTopics: active, lessons, library, controls, violations\nRoles: facades, drivers, engines, schemas\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
412,app/houseofcards/customer/policies/controls/KillSwitch/engines/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/controls/KillSwitch/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: KillSwitch engines - Reserved\n# Reference: HOC_policies_analysis_v1.md\n\n""""""\npolicies/controls/KillSwitch/engines\n\nEMPTY - facade.py was deleted as duplicate of governance_facade.py.\n\nFor governance operations, use:\n    from app.houseofcards.customer.policies.facades import get_governance_facade\n""""""","\npolicies/controls/KillSwitch/engines\n\nEMPTY - facade.py was deleted as duplicate of governance_facade.py.\n\nFor governance operations, use:\n    from app.houseofcards.customer.policies.facades import get_governance_facade\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
413,app/houseofcards/customer/policies/controls/engines/customer_killswitch_read_service.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/controls/engines/customer_killswitch_read_service.py,"# Layer: L4 — Domain Engine\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Customer killswitch read operations (L4 service)\n# Callers: customer_killswitch_adapter.py (L3)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-280, PIN-281 (L2 Promotion Governance)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides read operations for customer killswitch status.\n# It queries L6 models and returns domain DTOs.\n# The L3 adapter transforms these to customer-safe DTOs.","\nCustomer Killswitch Read Service (L4)\n\nThis service provides read operations for customer killswitch status.\nL3 adapters call this service to get killswitch state, guardrails, and incident info.\n\nL3 (customer_killswitch_adapter.py) → L4 (this service) → L6 (models)\n\nThe service:\n1. Queries KillSwitchState for tenant freeze status\n2. Queries DefaultGuardrail for active guardrails\n3. Queries Incident for incident statistics\n4. Returns domain DTOs (not customer-safe - L3 transforms)\n\nReference: PI",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
414,app/houseofcards/customer/policies/controls/engines/degraded_mode_checker.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/controls/engines/degraded_mode_checker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Governance degraded mode checker with incident response\n# Callers: ROK (L5), prevention_engine, incident_engine\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-070 (Governance Degraded Mode)\n\n""""""\nModule: degraded_mode_checker\nPurpose: Check and manage governance degraded mode with incident integration.\n","\nModule: degraded_mode_checker\nPurpose: Check and manage governance degraded mode with incident integration.\n\nWhen governance systems are unavailable or degraded, this module:\n    - Tracks the degraded state with proper metadata\n    - Creates incidents for degraded mode transitions\n    - Enforces degraded mode rules (block new runs, warn existing)\n    - Integrates with incident response for visibility\n\nDegraded Mode States:\n    - NORMAL: Governance is fully operational\n    - DEGRADED: Governance",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
415,app/houseofcards/customer/policies/controls/engines/runtime_switch.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/controls/engines/runtime_switch.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (emergency) or internal (failure detection)\n#   Execution: sync\n# Role: Runtime toggle for governance enforcement\n# Callers: ops_api.py, failure_mode_handler.py, health.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-069\n\n""""""\nModule: runtime_switch\nPurpose: Provides runtime toggle for governance. Emergency kill switch.\n","\nModule: runtime_switch\nPurpose: Provides runtime toggle for governance. Emergency kill switch.\n\nImports (Dependencies):\n    - logging\n    - datetime\n    - threading (for atomic operations)\n\nExports (Provides):\n    - is_governance_active() -> bool\n    - disable_governance_runtime(reason, actor) -> None\n    - enable_governance_runtime(actor) -> None\n    - get_governance_state() -> GovernanceState\n    - is_degraded_mode() -> bool (GAP-070)\n    - enter_degraded_mode(reason, actor) -> None (GAP-070)",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
416,app/houseofcards/customer/policies/drivers/__init__.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: policies/drivers - Reserved for L3 adapters\n# Reference: HOC_policies_analysis_v1.md\n\n""""""\npolicies/drivers\n\nEMPTY - Reserved for L3 adapters.\n\nNOTE: policy_driver.py was moved to internal/platform/policy/engines/\nbecause it declares AUDIENCE: INTERNAL.\n\nFor INTERNAL policy operations, use:\n    from app.houseofcards.internal.platform.policy.engines import get_policy_driver","\npolicies/drivers\n\nEMPTY - Reserved for L3 adapters.\n\nNOTE: policy_driver.py was moved to internal/platform/policy/engines/\nbecause it declares AUDIENCE: INTERNAL.\n\nFor INTERNAL policy operations, use:\n    from app.houseofcards.internal.platform.policy.engines import get_policy_driver\n\nFor CUSTOMER policy operations, use:\n    from app.houseofcards.customer.policies.facades import get_policies_facade\n",,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
417,app/houseofcards/customer/policies/engines/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: policies domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\npolicies / engines\n\nExports will be added as files are moved here.\n""""""",\npolicies / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
418,app/houseofcards/customer/policies/engines/authority_checker.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/authority_checker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Check override authority before policy enforcement\n# Callers: policy/prevention_engine.py, services/enforcement/\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-034 (Override Authority Integration)\n\n""""""\nModule: authority_checker\nPurpose: Check override authority status for prevention engine.\n","\nModule: authority_checker\nPurpose: Check override authority status for prevention engine.\n\nThe prevention engine must check override authority before enforcing\nany policy actions. If an override is active, enforcement is skipped.\n\nIntegration Flow:\n    1. Prevention engine receives policy ID\n    2. Calls OverrideAuthorityChecker.check()\n    3. If override is active, skip enforcement\n    4. If no override, proceed with enforcement\n\nExports:\n    - OverrideStatus: Enum of override states\n    - Ove",,NEEDS_CLASSIFICATION,ITERATION_1,Authority decisions,TRANSFER
419,app/houseofcards/customer/policies/engines/budget_enforcement_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/budget_enforcement_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: scheduler (background task)\n#   Execution: async\n# Role: Budget enforcement decision-making (domain logic)\n# Authority: Budget decision generation (M9/M10 pattern)\n# Callers: Background tasks, API endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: DECISION_RECORD_CONTRACT.md\n# Reference: PIN-257 Phase R-3 (L5→L4 Violation Fix)\n#\n# GOVERNANCE NOTE: This L4 engine owns BUDGET ENFORCEMENT DECISION logic.\n# L5 runner.py owns only EXECUTION logic (halting the run).",\nDomain engine for budget enforcement decisions.\n\nThis L4 engine contains the authoritative logic for:\n1. Identifying runs halted due to budget enforcement\n2. Emitting budget_enforcement decision records\n\nL5 workers must halt runs when budget is exhausted but must NOT\nemit decision records directly. Decision emission is L4 responsibility.\n\nReference: PIN-257 Phase R-3\nGovernance: PHASE_R_L5_L4_VIOLATIONS.md\n,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
420,app/houseofcards/customer/policies/engines/claim_decision_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/claim_decision_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: L4 services (L5 no longer imports this module)\n# Reference: PIN-257 Phase R-4 (L5→L4 Violation Fix)\n# WARNING: If this logic is wrong, claim processing breaks.\n#\n# GOVERNANCE NOTE (Phase R-4):\n# L5 workers now read threshold from environment variable RECOVERY_CLAIM_THRESHOLD.\n# This L4 module reads from the same env var for consistency (dependency inversion).\n# L5 workers inline simple status/confidence extraction instead of calling L4.\n\n# M10 Claim Decision Engine\n""""""\nDomain engine for recovery claim decisions.\n",\nDomain engine for recovery claim decisions.\n\nThis L4 engine defines the authoritative rules for:\n1. Claim eligibility - what candidates qualify for evaluation\n2. Status determination - how evaluation results map to status\n\nPhase R-4 Note:\nL5 workers no longer import this module. Configuration is shared via\nenvironment variables. Simple data extractions are inlined in L5.\n\nReference: PIN-257 Phase R-4\nGovernance: PHASE_R_L5_L4_VIOLATIONS.md\n,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
421,app/houseofcards/customer/policies/engines/control_registry.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/control_registry.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: SOC2 Trust Service Criteria control registry\n# Callers: services/soc2/mapper.py, services/export_bundle_service.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-025 (SOC2 Control Mapping)\n\n""""""\nModule: control_registry\nPurpose: Registry of SOC2 Trust Service Criteria controls.\n",\nModule: control_registry\nPurpose: Registry of SOC2 Trust Service Criteria controls.\n\nSOC2 Trust Service Categories:\n    - CC (Common Criteria): Security-related controls\n    - A (Availability): System availability controls\n    - PI (Processing Integrity): Processing accuracy controls\n    - C (Confidentiality): Data confidentiality controls\n    - P (Privacy): Privacy-related controls\n\nKey Controls for AI Agent Governance:\n    - CC7.x: System Operations (Incident Response)\n    - CC6.x: Logical an,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
422,app/houseofcards/customer/policies/engines/customer_policy_read_service.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/customer_policy_read_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync (delegates to L6)\n# Role: Customer policy domain read operations (L4)\n# Callers: customer_policies_adapter.py (L3)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (POLICY Domain Qualification)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides READ operations for the Policy domain.\n# All policy constraint reads must go through this service.\n# The L3 adapter should NOT import L6 directly.","\nCustomer Policy Read Service (L4)\n\nThis service provides all READ operations for the Policy domain.\nIt sits between L3 (CustomerPoliciesAdapter) and L6 (Tenant, ProxyCall, DefaultGuardrail).\n\nL3 (Adapter) → L4 (this service) → L6 (Models)\n\nResponsibilities:\n- Query tenant budget settings\n- Calculate current period usage\n- Query guardrails list\n- Translate internal models → customer-visible policy constraints\n- Hide internal fields (threshold values, rule configs)\n- Stable period calculation\n\nRe",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
423,app/houseofcards/customer/policies/engines/eligibility_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/eligibility_engine.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Eligibility Engine - pure rules, deterministic gating\n# Callers: L3 (adapters), L2 (governance APIs)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-287, ELIGIBILITY_RULES.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: ELIGIBILITY-IS-DETERMINISTIC (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Eligibility Engine (L4)\n\nApplies eligibility rules to determine if a validated proposal MAY or\nMAY_NOT become a System Contract. The engine is pure - it receives data\nvia lookups, does not fetch externally.\n\nResponsibilities:\n1. Evaluate MAY_NOT rules (rejection rules)\n2. Evaluate MAY rules (acceptance rules)\n3. Produce deterministic verdicts\n4. Track rule evaluation for auditing\n\nInvariants (from ELIGIBILITY_RULES.md):\n- ELIG-001: Eligibility is deterministic (pure function, no side eff",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
424,app/houseofcards/customer/policies/engines/hallucination_detector.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/hallucination_detector.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Detect potential hallucinations in LLM outputs (non-blocking)\n# Callers: worker/runner.py, services/incident_engine.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-023, INV-002 (HALLU-INV-001)\n\n""""""\nModule: hallucination_detector\nPurpose: Detect potential hallucinations in LLM outputs.\n","\nModule: hallucination_detector\nPurpose: Detect potential hallucinations in LLM outputs.\n\nCRITICAL INVARIANT (INV-002 / HALLU-INV-001):\n    Hallucination detection is ALWAYS non-blocking by default.\n    This is because:\n    - Hallucination detection is PROBABILISTIC (60-90% confidence)\n    - Policy violations (cost, rate, PII) are DETERMINISTIC (facts)\n    - False positives on hallucination blocking destroy customer trust\n    - Blocking requires explicit customer opt-in\n\nImports (Dependencies):\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
425,app/houseofcards/customer/policies/engines/lessons_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/lessons_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: worker (run events), incident_engine (failure events)\n#   Execution: sync\n# Role: Lessons learned creation and management (domain logic)\n# Authority: Lesson generation from system events (SDSR pattern)\n# Callers: IncidentEngine, Worker runtime, API endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: SDSR (PIN-370), PB-S4 (Policy Proposals)\n# Reference: PIN-411, POLICIES_DOMAIN_AUDIT.md Section 11\n#\n# GOVERNANCE NOTE: This L4 engine owns LESSON CREATION logic.\n# Scenarios inject causes (events), this engine creates lessons.","\nLessons Learned Engine (L4 Domain Logic)\n\nThis engine implements the learning-driven governance pattern:\n- Failures (all severities) → Lesson created\n- Near-threshold events → Lesson created\n- Critical success events → Lesson created\n\nLessons are the memory substrate for policy evolution.\nOnly human action (via PolicyProposalEngine) converts lessons to drafts.\n\nReference: PIN-411, POLICIES_DOMAIN_AUDIT.md Section 11\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
426,app/houseofcards/customer/policies/engines/llm_policy_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/llm_policy_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: LLM policy and safety limits enforcement\n# Callers: OpenAIAdapter (L3), TenantLLMConfig (L3), llm_invoke skills\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-254 Phase B Fix\n\n""""""\nL4 LLM Policy Engine - Domain Authority for LLM Safety and Cost Controls\n\nB01/B05 FIX: Moved from L3 adapters to L4 domain engine.","\nL4 LLM Policy Engine - Domain Authority for LLM Safety and Cost Controls\n\nB01/B05 FIX: Moved from L3 adapters to L4 domain engine.\nThis engine is the authoritative source for:\n- Safety limits (max tokens, max cost, rate limits)\n- Model selection policy\n- Budget enforcement\n- Model restrictions\n\nL3 adapters must delegate all policy decisions to this engine.\n\nEnvironment Variables:\n- LLM_MAX_TOKENS_PER_REQUEST: Max tokens per request (default: 16000)\n- LLM_MAX_COST_CENTS_PER_REQUEST: Max cost in ",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
427,app/houseofcards/customer/policies/engines/llm_threshold_service.py,CUSTOMER,activity,L5,app/houseofcards/customer/policies/engines/llm_threshold_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker\n#   Execution: sync\n# Role: LLM run threshold resolution and evaluation\n# Callers: api/activity/*, worker/runtime/*\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Policies → Limits → Thresholds → Set Params panel\n#\n# =============================================================================\n# SIGNAL EMISSION ARCHITECTURE\n# =============================================================================\n#","\nLLM Threshold Service\n\nProvides:\n- ThresholdParams: Validated threshold configuration\n- LLMRunThresholdResolver: Resolves effective params from Policy → Limit chain\n- LLMRunEvaluator: Evaluates runs against thresholds, emits signals\n- emit_and_persist_threshold_signal: Dual emit to Founder AND Customer consoles\n\nThis is the governance layer that enables:\n- ACT-LLM-LIVE-O2: ""Surface live runs exceeding expected execution time""\n- ACT-LLM-COMP-O3: ""Expose completed runs that ended in failure""\n\nSaf",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
428,app/houseofcards/customer/policies/engines/mapper.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/mapper.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Map incidents to relevant SOC2 controls\n# Callers: services/export_bundle_service.py, api/incidents.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-025 (SOC2 Control Mapping)\n\n""""""\nModule: mapper\nPurpose: Map incidents and evidence to SOC2 controls.\n",\nModule: mapper\nPurpose: Map incidents and evidence to SOC2 controls.\n\nProvides intelligent mapping of incident categories and evidence\nto the appropriate SOC2 Trust Service Criteria controls.\n\nExports:\n    - SOC2ControlMapper: Maps incidents to controls\n    - get_control_mappings_for_incident: Main entry point\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
429,app/houseofcards/customer/policies/engines/override_service.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/override_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limit override service (PIN-LIM-05)\n# Callers: api/limits/override.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-LIM-05\n\n""""""\nLimit Override Service (PIN-LIM-05)\n\nLifecycle of temporary limit overrides.",\nLimit Override Service (PIN-LIM-05)\n\nLifecycle of temporary limit overrides.\n\nResponsibilities:\n- Create override requests\n- Handle approval workflow\n- Expiry handling\n- Attach justification & requester\n- Emit signals to runtime evaluator\n- Audit events\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
430,app/houseofcards/customer/policies/engines/policy_graph_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_graph_engine.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy conflict detection and dependency graph computation\n# Callers: policies.py, policy_layer.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-411 (Gap Closure), DFT-O4, DFT-O5\n\n""""""\nPolicy Graph Engine — Conflict Detection & Dependency Analysis\n\nThis module implements:","\nPolicy Graph Engine — Conflict Detection & Dependency Analysis\n\nThis module implements:\n- PolicyConflictEngine: Detects logical contradictions between policies (DFT-O4)\n- PolicyDependencyEngine: Computes structural relationships between policies (DFT-O5)\n\nThese engines answer STATIC governance questions, not runtime enforcement.\nThey must be deterministic, explainable, and replayable.\n\nReference: PIN-411 Gap Closure Spec (Part A)\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
431,app/houseofcards/customer/policies/engines/policy_limits_service.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_limits_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Policy limits CRUD service (PIN-LIM-01)\n# Callers: api/policies.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-LIM-01\n\n""""""\nPolicy Limits Service (PIN-LIM-01)\n\nAuthoritative writer for policy limits table.","\nPolicy Limits Service (PIN-LIM-01)\n\nAuthoritative writer for policy limits table.\n\nResponsibilities:\n- Create/update/delete limits\n- Validate scope (tenant / worker / global)\n- Enforce immutables (category, type cannot change after creation)\n- Emit audit events\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
432,app/houseofcards/customer/policies/engines/policy_mapper.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_mapper.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: policy-gate\n# Parent Gap: GAP-063 (MCPConnector), GAP-087 (PolicyGate)\n# Reference: GAP-142\n# Depends On: GAP-141 (MCPServerRegistry)\n# Temporal:\n#   Trigger: worker (tool invocation)\n#   Execution: async\n# Role: Map MCP tool invocations to policy gates\n# Callers: Runner, skill executor\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""",\nModule: policy_mapper\nPurpose: Map MCP tool invocations to policy gates.\n\nWires:\n    - Source: app/services/mcp/server_registry.py (tools)\n    - Source: app/services/policies/policy_engine.py (policy evaluation)\n    - Target: Tool invocations are gated by policy\n\nThis module:\n    1. Maps MCP tool invocations to policy checks\n    2. Determines required permissions for each tool\n    3. Evaluates policy before allowing invocation\n    4. Provides deny-by-default for unknown tools\n\nAcceptance Criter,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
433,app/houseofcards/customer/policies/engines/policy_proposal.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_proposal.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Callers: None (ORPHAN - pending M25+ integration)\n# Reference: PIN-240\n# NOTE: Service complete, UI integration missing. Human approval required.\n\n""""""\nPolicy Proposal Service (PB-S4)\n\nProposes policy changes based on observed feedback WITHOUT auto-enforcement.\n\nPB-S4 Contract:\n- Observe feedback patterns → propose policy → wait for human\n- NO auto-enforcement\n- NO execution modification",\nPolicy Proposal Service (PB-S4)\n\nProposes policy changes based on observed feedback WITHOUT auto-enforcement.\n\nPB-S4 Contract:\n- Observe feedback patterns → propose policy → wait for human\n- NO auto-enforcement\n- NO execution modification\n- Human approval is MANDATORY\n\nRule: Propose → Review → Decide (Human)\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
434,app/houseofcards/customer/policies/engines/policy_rules_service.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_rules_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Policy rules CRUD service (PIN-LIM-02)\n# Callers: api/policies.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-LIM-02\n\n""""""\nPolicy Rules Service (PIN-LIM-02)\n\nPersist and validate policy rule logic.",\nPolicy Rules Service (PIN-LIM-02)\n\nPersist and validate policy rule logic.\n\nResponsibilities:\n- Create/update rules\n- Rule syntax validation\n- Link rules → limits\n- Handle retirement (rules are never deleted)\n- Emit audit events\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
435,app/houseofcards/customer/policies/engines/policy_violation_service.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_violation_service.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: S3 violation truth model, fact persistence, evidence linking\n# Callers: L4 policy engine, L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""\nPolicy Violation Service - S3 Hardening for Phase A.5 Verification\n\nThis service implements the S3 truth model from PIN-195:\n1. Violation detection\n2. Violation fact persistence\n3. Incident creation (severity-bound)\n4. Evidence linking\n5. API + Console exposure","\nPolicy Violation Service - S3 Hardening for Phase A.5 Verification\n\nThis service implements the S3 truth model from PIN-195:\n1. Violation detection\n2. Violation fact persistence\n3. Incident creation (severity-bound)\n4. Evidence linking\n5. API + Console exposure\n\nCritical invariants (VERIFICATION_MODE):\n- No incident may exist without a persisted violation fact\n- Policy must be enabled for tenant\n- Evidence must exist before incident creation\n- One incident per (run_id, policy_id)\n- Cost and pol",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
436,app/houseofcards/customer/policies/engines/simulation_service.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/simulation_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limits simulation service (PIN-LIM-04)\n# Callers: api/limits/simulate.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-LIM-04\n\n""""""\nLimits Simulation Service (PIN-LIM-04)\n\nCoordination layer for pre-execution limit checks.","\nLimits Simulation Service (PIN-LIM-04)\n\nCoordination layer for pre-execution limit checks.\n\nResponsibilities:\n- Aggregate all limit types (tenant quotas, cost budgets, worker limits, policy limits)\n- Load active overrides\n- Call evaluator\n- Normalize response for API\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
437,app/houseofcards/customer/policies/engines/snapshot_service.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/snapshot_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-029 (Policy snapshot immutability)\n""""""\nPolicy Snapshot Immutability Service (GAP-029).\n\nProvides immutable policy snapshot management with:\n- Immutability enforcement (no modifications after creation)\n- Snapshot versioning and history\n- Integrity verification\n- Tenant isolation\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timezone",\nPolicy Snapshot Immutability Service (GAP-029).\n\nProvides immutable policy snapshot management with:\n- Immutability enforcement (no modifications after creation)\n- Snapshot versioning and history\n- Integrity verification\n- Tenant isolation\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
438,app/houseofcards/customer/policies/facades/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: policies domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\npolicies / facades\n\nExports will be added as files are moved here.\n""""""",\npolicies / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
439,app/houseofcards/customer/policies/facades/controls_facade.py,CUSTOMER,policies,L3,app/houseofcards/customer/policies/facades/controls_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Controls Facade - Centralized access to control operations\n# Callers: L2 controls.py API, SDK\n# Allowed Imports: L4 control services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-123 (Controls API)\n\n""""""\nControls Facade (L4 Domain Logic)",\nControls Facade (L4 Domain Logic)\n\nThis facade provides the external interface for control operations.\nAll control APIs MUST use this facade instead of directly importing\ninternal control modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes killswitch and control logic\n- Provides unified access to system controls\n- Single point for audit emission\n\nL2 API Routes (GAP-123):\n- GET /api/v1/controls (list controls)\n- GET /api/v1/controls/{id} (get control)\n- PUT /api/v1/,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
440,app/houseofcards/customer/policies/facades/governance_facade.py,CUSTOMER,policies,L3,app/houseofcards/customer/policies/facades/governance_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api (governance control) or internal (health checks)\n#   Execution: sync\n# Role: Governance Facade - Centralized access to governance control operations\n# Callers: L2 governance.py API, SDK\n# Allowed Imports: L4 domain engines, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-090, GAP-091, GAP-092, GAP-095\n\n""""""\nGovernance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance control operations.","\nGovernance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance control operations.\nAll governance APIs MUST use this facade instead of directly importing\ninternal governance modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes governance control logic\n- Provides unified access to kill switch, degraded mode, conflict resolution\n- Single point for audit emission\n\nWrapped Services:\n- runtime_switch: Kill switch and degraded mode (GAP-06",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
441,app/houseofcards/customer/policies/facades/limits_facade.py,CUSTOMER,policies,L3,app/houseofcards/customer/policies/facades/limits_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limits Facade - Centralized access to rate limits and quotas\n# Callers: L2 limits.py API, SDK\n# Allowed Imports: L4 limit services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-122 (Limits API)\n\n""""""\nLimits Facade (L4 Domain Logic)",\nLimits Facade (L4 Domain Logic)\n\nThis facade provides the external interface for limit operations.\nAll limit APIs MUST use this facade instead of directly importing\ninternal limit modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes rate limit and quota logic\n- Provides unified access to usage tracking\n- Single point for audit emission\n\nL2 API Routes (GAP-122):\n- GET /api/v1/limits (list limits)\n- GET /api/v1/limits/{id} (get limit)\n- PUT /api/v1/limits/{id} (update,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
442,app/houseofcards/customer/policies/facades/policies_facade.py,CUSTOMER,policies,L3,app/houseofcards/customer/policies/facades/policies_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB operations)\n# Role: Policies domain facade - unified entry point for policy management operations\n# Callers: L2 policies API (policies.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: POLICIES Domain - Customer Console v1 Constitution\n#\n""""""\nPolicies Domain Facade (L4)\n","\nPolicies Domain Facade (L4)\n\nUnified facade for policy management operations.\n\nProvides:\n- Policy Rules: list, get detail\n- Limits: list, get detail\n- Lessons: list, get detail, stats\n- Policy State: synthesized snapshot\n- Policy Metrics: enforcement effectiveness\n- Policy Conflicts: detect contradictions\n- Policy Dependencies: structural relationships\n- Policy Violations: unified violation view\n- Budget Definitions: enforcement limits\n- Policy Requests: pending approvals\n\nAll operations are te",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
443,app/houseofcards/customer/policies/facades/run_governance_facade.py,CUSTOMER,policies,L3,app/houseofcards/customer/policies/facades/run_governance_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (run lifecycle events)\n#   Execution: sync\n# Role: Run Governance Facade - Centralized access to governance operations for runs\n# Callers: L5 runner (worker runtime)\n# Allowed Imports: L4 domain engines (lessons, policy), L4 audit, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), FIX-002\n\n""""""\nRun Governance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance operations",\nRun Governance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance operations\nduring run execution. The L5 runner MUST use this facade instead of\ndirectly importing L4 engines.\n\nWhy This Facade Exists (PIN-454):\n- Prevents L5→L4 layer violations (runner importing engines directly)\n- Centralizes governance logic for run lifecycle\n- Provides RAC (Runtime Audit Contract) acknowledgment emission\n- Single point for audit expectation/acknowledgment emission\n\nWrapped S,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
444,app/houseofcards/customer/policies/schemas/__init__.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: CUSTOMER\n# Role: policies domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\npolicies / schemas\n\nExports will be added as files are moved here.\n""""""",\npolicies / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
445,app/houseofcards/duplicate/analytics/anomaly_severity.py,DEPRECATED,analytics,DELETE,app/houseofcards/duplicate/analytics/anomaly_severity.py,"# ============================================================\n# DUPLICATE — QUARANTINED (ANALYTICS DOMAIN)\n#\n# This enum is a historical duplicate and MUST NOT be used.\n#\n# Canonical Definition:\n#   houseofcards/customer/analytics/engines/cost_anomaly_detector.py\n#   Enum: AnomalySeverity (lines 60-65)\n#\n# Duplicate Origin:\n#   houseofcards/customer/analytics/facades/detection_facade.py\n#   (lines 67-71, now removed)\n#\n# Audit Reference:\n#   ANA-DUP-001","QUARANTINED — Use AnomalySeverity from cost_anomaly_detector.py instead.\n\nAnomaly severity levels.\n\nThis is the FROZEN facade version. The canonical version lives in:\nhouseofcards/customer/analytics/engines/cost_anomaly_detector.py\n\nMembers (100% overlap with canonical):\n    - LOW = ""LOW""      # +15% to +25%\n    - MEDIUM = ""MEDIUM""  # +25% to +40%\n    - HIGH = ""HIGH""    # >40%",,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
446,app/houseofcards/duplicate/general/alert_fatigue.py,DEPRECATED,general,DELETE,app/houseofcards/duplicate/general/alert_fatigue.py,# ==============================================================================\n# DEPRECATED - DO NOT USE\n# ==============================================================================\n# Status: DEPRECATED\n# Deprecated Date: 2026-01-23\n# Reason: DUPLICATE of fatigue_controller.py (GEN-DUP-001)\n# Canonical Location: app/houseofcards/customer/general/engines/fatigue_controller.py\n#\n# This file has been moved to the duplicate archive directory.\n# The canonical implementation is fatigue_controller.py which is the SUPERSET\n# with additional features:\n#   - Aggregation mode (MONITOR/WARN/ENFORCE/AGGREGATE)\n#   - Comprehensive stats tracking\n#   - Source-based tracking\n#   - Advanced cooldown periods,\nDEPRECATED: Alert Fatigue Controller\n\nTHIS MODULE IS DEPRECATED. Use fatigue_controller.py instead.\nCanonical location: app/houseofcards/customer/general/engines/fatigue_controller.py\n\nOriginal description:\nAlert Fatigue Controller\n\nProvides deduplication and fatigue controls for alerts:\n\n1. Same-domain alert deduplication (within configurable window)\n2. Per-domain cooldown periods\n3. Per-tenant fatigue settings\n4. Sliding window rate limiting\n\nDesign Principles:\n1. Alerts are important - but t,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
447,app/houseofcards/duplicate/incidents/learning_insight_result.py,DEPRECATED,incidents,DELETE,app/houseofcards/duplicate/incidents/learning_insight_result.py,# ============================================================\n# DUPLICATE — QUARANTINED\n#\n# This file is a historical duplicate and MUST NOT be used\n# for new development.\n#\n# Original (Authoritative):\n#   houseofcards/customer/incidents/engines/postmortem_service.py\n#   Class: LearningInsight\n#\n# Superseding Type:\n#   houseofcards/customer/incidents/facades/incidents_facade.py\n#   Class: LearningInsightResult (QUARANTINED)\n#\n# Reason for Quarantine:,QUARANTINED — Use LearningInsight from postmortem_service.py instead.\n\nA learning insight from incident analysis.,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
448,app/houseofcards/duplicate/incidents/learnings_result.py,DEPRECATED,incidents,DELETE,app/houseofcards/duplicate/incidents/learnings_result.py,# ============================================================\n# DUPLICATE — QUARANTINED\n#\n# This file is a historical duplicate and MUST NOT be used\n# for new development.\n#\n# Original (Authoritative):\n#   houseofcards/customer/incidents/engines/postmortem_service.py\n#   Class: PostMortemResult\n#\n# Superseding Type:\n#   houseofcards/customer/incidents/facades/incidents_facade.py\n#   Class: LearningsResult (QUARANTINED)\n#\n# Reason for Quarantine:,QUARANTINED — Use PostMortemResult from postmortem_service.py instead.\n\nIncident learnings response.,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
449,app/houseofcards/duplicate/incidents/pattern_detection_result.py,DEPRECATED,incidents,DELETE,app/houseofcards/duplicate/incidents/pattern_detection_result.py,# ============================================================\n# DUPLICATE — QUARANTINED\n#\n# This file is a historical duplicate and MUST NOT be used\n# for new development.\n#\n# Original (Authoritative):\n#   houseofcards/customer/incidents/engines/incident_pattern_service.py\n#   Class: PatternResult\n#\n# Superseding Type:\n#   houseofcards/customer/incidents/facades/incidents_facade.py\n#   Class: PatternDetectionResult (QUARANTINED)\n#\n# Reason for Quarantine:,QUARANTINED — Use PatternResult from incident_pattern_service.py instead.\n\nPattern detection response.\nNote: This has window_hours which is not in the engine DTO.,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
450,app/houseofcards/duplicate/incidents/pattern_match_result.py,DEPRECATED,incidents,DELETE,app/houseofcards/duplicate/incidents/pattern_match_result.py,# ============================================================\n# DUPLICATE — QUARANTINED\n#\n# This file is a historical duplicate and MUST NOT be used\n# for new development.\n#\n# Original (Authoritative):\n#   houseofcards/customer/incidents/engines/incident_pattern_service.py\n#   Class: PatternMatch\n#\n# Superseding Type:\n#   houseofcards/customer/incidents/facades/incidents_facade.py\n#   Class: PatternMatchResult (QUARANTINED)\n#\n# Reason for Quarantine:,QUARANTINED — Use PatternMatch from incident_pattern_service.py instead.\n\nA detected incident pattern.,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
451,app/houseofcards/duplicate/incidents/recurrence_analysis_result.py,DEPRECATED,incidents,DELETE,app/houseofcards/duplicate/incidents/recurrence_analysis_result.py,# ============================================================\n# DUPLICATE — QUARANTINED\n#\n# This file is a historical duplicate and MUST NOT be used\n# for new development.\n#\n# Original (Authoritative):\n#   houseofcards/customer/incidents/engines/recurrence_analysis_service.py\n#   Class: RecurrenceResult\n#\n# Superseding Type:\n#   houseofcards/customer/incidents/facades/incidents_facade.py\n#   Class: RecurrenceAnalysisResult (QUARANTINED)\n#\n# Reason for Quarantine:,QUARANTINED — Use RecurrenceResult from recurrence_analysis_service.py instead.\n\nRecurrence analysis response.,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
452,app/houseofcards/duplicate/incidents/recurrence_group_result.py,DEPRECATED,incidents,DELETE,app/houseofcards/duplicate/incidents/recurrence_group_result.py,# ============================================================\n# DUPLICATE — QUARANTINED\n#\n# This file is a historical duplicate and MUST NOT be used\n# for new development.\n#\n# Original (Authoritative):\n#   houseofcards/customer/incidents/engines/recurrence_analysis_service.py\n#   Class: RecurrenceGroup\n#\n# Superseding Type:\n#   houseofcards/customer/incidents/facades/incidents_facade.py\n#   Class: RecurrenceGroupResult (QUARANTINED)\n#\n# Reason for Quarantine:,QUARANTINED — Use RecurrenceGroup from recurrence_analysis_service.py instead.\n\nA group of recurring incidents.,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
453,app/houseofcards/duplicate/incidents/resolution_summary_result.py,DEPRECATED,incidents,DELETE,app/houseofcards/duplicate/incidents/resolution_summary_result.py,# ============================================================\n# DUPLICATE — QUARANTINED\n#\n# This file is a historical duplicate and MUST NOT be used\n# for new development.\n#\n# Original (Authoritative):\n#   houseofcards/customer/incidents/engines/postmortem_service.py\n#   Class: ResolutionSummary\n#\n# Superseding Type:\n#   houseofcards/customer/incidents/facades/incidents_facade.py\n#   Class: ResolutionSummaryResult (QUARANTINED)\n#\n# Reason for Quarantine:,QUARANTINED — Use ResolutionSummary from postmortem_service.py instead.\n\nSummary of incident resolution.,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
454,app/houseofcards/duplicate/integrations/credential.py,DEPRECATED,integrations,DELETE,app/houseofcards/duplicate/integrations/credential.py,# ============================================================\n# DUPLICATE — QUARANTINED (INTEGRATIONS DOMAIN)\n#\n# This dataclass is a historical duplicate and MUST NOT be used.\n#\n# Canonical Definition:\n#   houseofcards/customer/integrations/engines/credentials/types.py\n#   class Credential\n#\n# Duplicate Origins:\n#   - http_connector.py (lines 99-103)\n#   - mcp_connector.py (lines 90-94)\n#   - sql_gateway.py (lines 114-118)\n#\n# Audit Reference:,"QUARANTINED — Use Credential from credentials/types.py instead.\n\nCredential from vault.\n\nThis is the FROZEN connector version. The canonical version lives in:\nhouseofcards/customer/integrations/engines/credentials/types.py\n\nAttributes:\n    value: The credential value (e.g., API key, token)\n    expires_at: Optional expiration timestamp",,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
455,app/houseofcards/duplicate/integrations/credential_service.py,DEPRECATED,integrations,DELETE,app/houseofcards/duplicate/integrations/credential_service.py,# ============================================================\n# DUPLICATE — QUARANTINED (INTEGRATIONS DOMAIN)\n#\n# This protocol is a historical duplicate and MUST NOT be used.\n#\n# Canonical Definition:\n#   houseofcards/customer/integrations/engines/credentials/protocol.py\n#   class CredentialService\n#\n# Duplicate Origins:\n#   - http_connector.py (lines 106-112)\n#   - mcp_connector.py (lines 97-103)\n#   - sql_gateway.py (lines 121-127)\n#\n# Audit Reference:,Credential from vault (local copy for protocol definition).,,NEEDS_CLASSIFICATION,ITERATION_1,Quarantined duplicate,DELETE
456,app/houseofcards/duplicate/policies/dependency_graph_result.py,DEPRECATED,policies,DELETE,app/houseofcards/duplicate/policies/dependency_graph_result.py,# ============================================================\n# ⚠️ DUPLICATE — QUARANTINED (POLICIES DOMAIN)\n#\n# This file is NOT authoritative and MUST NOT be used.\n#\n# Canonical Type:\n#   houseofcards/customer/policies/engines/policy_graph_engine.py\n#   Class: DependencyGraphResult (line 151)\n#\n# Duplicate Of:\n#   Originally defined in facade for response shaping\n#   houseofcards/customer/policies/facades/policies_facade.py:266\n#\n# Audit Reference:\n#   POL-DUP-003,QUARANTINED — Use DependencyGraphResult from policy_graph_engine.py instead.\n\nPolicy dependency graph response.\n\nFacade-added presentation fields (not in canonical):\n    - nodes_count: int\n    - edges_count: int\n\nCanonical fields:\n    - nodes: list[PolicyNodeResult]\n    - edges: list[PolicyDependencyEdge]\n    - computed_at: datetime,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
457,app/houseofcards/duplicate/policies/policy_conflict_result.py,DEPRECATED,policies,DELETE,app/houseofcards/duplicate/policies/policy_conflict_result.py,# ============================================================\n# ⚠️ DUPLICATE — QUARANTINED (POLICIES DOMAIN)\n#\n# This file is NOT authoritative and MUST NOT be used.\n#\n# Canonical Type:\n#   houseofcards/customer/policies/engines/policy_graph_engine.py\n#   Class: PolicyConflict (line 73)\n#\n# Duplicate Of:\n#   Originally defined in facade for response shaping\n#   houseofcards/customer/policies/facades/policies_facade.py:205\n#\n# Audit Reference:\n#   POL-DUP-004,"QUARANTINED — Use PolicyConflict from policy_graph_engine.py instead.\n\nPolicy conflict summary (DFT-O4).\n\nFields (100% overlap with canonical PolicyConflict):\n    - policy_a_id: str\n    - policy_b_id: str\n    - policy_a_name: str\n    - policy_b_name: str\n    - conflict_type: str (SCOPE_OVERLAP, THRESHOLD_CONTRADICTION, TEMPORAL_CONFLICT, PRIORITY_OVERRIDE)\n    - severity: str (BLOCKING, WARNING)\n    - explanation: str\n    - recommended_action: str\n    - detected_at: datetime",,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
458,app/houseofcards/duplicate/policies/policy_dependency_edge.py,DEPRECATED,policies,DELETE,app/houseofcards/duplicate/policies/policy_dependency_edge.py,# ============================================================\n# ⚠️ DUPLICATE — QUARANTINED (POLICIES DOMAIN)\n#\n# This file is NOT authoritative and MUST NOT be used.\n#\n# Canonical Type:\n#   houseofcards/customer/policies/engines/policy_graph_engine.py\n#   Class: PolicyDependency (line 101)\n#\n# Duplicate Of:\n#   Originally defined in facade for response shaping\n#   houseofcards/customer/policies/facades/policies_facade.py:254\n#\n# Audit Reference:\n#   POL-DUP-002,QUARANTINED — Use PolicyDependency from policy_graph_engine.py instead.\n\nA dependency edge in the graph.\n\nFields (100% overlap with canonical PolicyDependency):\n    - policy_id: str\n    - depends_on_id: str\n    - policy_name: str\n    - depends_on_name: str\n    - dependency_type: str\n    - reason: str,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
459,app/houseofcards/duplicate/policies/policy_node_result.py,DEPRECATED,policies,DELETE,app/houseofcards/duplicate/policies/policy_node_result.py,# ============================================================\n# ⚠️ DUPLICATE — QUARANTINED (POLICIES DOMAIN)\n#\n# This file is NOT authoritative and MUST NOT be used.\n#\n# Canonical Type:\n#   houseofcards/customer/policies/engines/policy_graph_engine.py\n#   Class: PolicyNode (line 125)\n#\n# Duplicate Of:\n#   Originally defined in facade for response shaping\n#   houseofcards/customer/policies/facades/policies_facade.py:240\n#\n# Audit Reference:\n#   POL-DUP-001,QUARANTINED — Part of PolicyNodeResult structure.\n\nA dependency relationship.,,NEEDS_CLASSIFICATION,ITERATION_1,Deprecated duplicate,DELETE
460,app/houseofcards/founder/__init__.py,FOUNDER,analytics,L5,app/houseofcards/founder/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: FOUNDER\n# Role: Founder/admin domain services package\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nFounder Domain Services (houseofcards)\n\nAdmin and ops tools:\n- ops: Administrative diagnostics and operations\n\nPattern: app/houseofcards/founder/{domain}/{role}/{file}.py\n""""""\n\n__all__ = [",\nFounder Domain Services (houseofcards)\n\nAdmin and ops tools:\n- ops: Administrative diagnostics and operations\n\nPattern: app/houseofcards/founder/{domain}/{role}/{file}.py\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
461,app/houseofcards/founder/ops/__init__.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: FOUNDER\n# Role: Ops domain - Admin diagnostics\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nOps Domain\n\nTopics: admin, diagnostics\nRoles: facades, schemas\n""""""","\nOps Domain\n\nTopics: admin, diagnostics\nRoles: facades, schemas\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
462,app/houseofcards/founder/ops/drivers/__init__.py,FOUNDER,ops,L6,app/houseofcards/founder/ops/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: FOUNDER\n# Role: ops domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nops / drivers\n\nExports will be added as files are moved here.\n""""""",\nops / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
463,app/houseofcards/founder/ops/drivers/ops_write_service.py,FOUNDER,ops,L6,app/houseofcards/founder/ops/drivers/ops_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Ops Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Ops API (Phase 2B extraction)\n# Callers: api/ops.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 3\n\n""""""\nOps Write Service - DB write operations for Ops API.\n\nPhase 2B Batch 3: Extracted from api/ops.py.",\nOps Write Service - DB write operations for Ops API.\n\nPhase 2B Batch 3: Extracted from api/ops.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
464,app/houseofcards/founder/ops/engines/__init__.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: FOUNDER\n# Role: ops domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nops / engines\n\nExports will be added as files are moved here.\n""""""",\nops / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
465,app/houseofcards/founder/ops/engines/error_store.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/engines/error_store.py,"# Layer: L4 — Domain Engine\n# Product: founder-console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: ErrorStoreProtocol implementation for OpsIncidentService\n# Callers: OpsFacade\n# Allowed Imports: L6 (infra, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-264 (Phase-S Track 1.3)\n\n""""""\nDatabase Error Store\n\nImplements ErrorStoreProtocol for OpsIncidentService using the",\nDatabase Error Store\n\nImplements ErrorStoreProtocol for OpsIncidentService using the\ninfra_error_events table via app.infra.error_store functions.\n\nThis bridges the L6 infra layer with the L4 ops aggregation service.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
466,app/houseofcards/founder/ops/engines/event_emitter.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/engines/event_emitter.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Callers: Multiple products (founder console, ops console)\n# Reference: PIN-240\n# NOTE: This layer must not know what a ""product"" is.\n#\n# =============================================================================\n# EventEmitter - FOUNDER CONSOLE ONLY\n# =============================================================================\n#\n# IMPORTANT: This service writes to ops_events table which is consumed\n# EXCLUSIVELY by the Founder Console (api/ops.py).\n#\n# DO NOT use EventEmitter for Customer Console signal paths.\n# Customer Console signals should update the runs table directly via",\nEvent Emitter Service (M24 Ops Console)\n\nPIN-105: Ops Console - Founder Intelligence System\n\nProvides:\n- Event emission to ops_events table (FOUNDER CONSOLE ONLY)\n- Background batching for high-throughput scenarios\n- Type-safe event creation\n- Automatic timestamp and metadata handling\n\nNOTE: This service is for FOUNDER CONSOLE monitoring only.\nCustomer Console signals use RunSignalService to update runs table.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
467,app/houseofcards/founder/ops/engines/founder_action_write_service.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/engines/founder_action_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Founder Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Founder Actions API (Phase 2B extraction)\n# Callers: api/founder_actions.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 3\n\n""""""\nFounder Action Write Service - DB write operations for Founder Actions API.\n\nPhase 2B Batch 3: Extracted from api/founder_actions.py.",\nFounder Action Write Service - DB write operations for Founder Actions API.\n\nPhase 2B Batch 3: Extracted from api/founder_actions.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
468,app/houseofcards/founder/ops/engines/ops_incident_service.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/engines/ops_incident_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide (ops visibility)\n# Temporal:\n#   Trigger: api|scheduler\n#   Execution: sync\n# Role: Translate infra errors into operator-facing incidents\n# Callers: L3 adapters (FounderOpsAdapter, PreflightOpsAdapter)\n# Allowed Imports: L6 (infra stores), L4 (ops domain models)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-264 (Phase-S L4 Aggregation)\n\n""""""\nOps Incident Service — L4 Aggregation Layer\n\nTranslates infra truth (ErrorEnvelope) into operator understanding (OpsIncident).","\nOps Incident Service — L4 Aggregation Layer\n\nTranslates infra truth (ErrorEnvelope) into operator understanding (OpsIncident).\n\nThis service answers: ""What incidents are happening?""\n\nDesign Principles:\n- INPUT: Time window, severity threshold, optional component scope\n- OUTPUT: List[OpsIncident] (domain models only)\n- NO: UI shaping, pagination, sorting for display, auth, filtering by role\n\nHARD RULES:\n1. Never return infra artifacts (ErrorEnvelope, raw DB rows)\n2. Never know about consoles (fo",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
469,app/houseofcards/founder/ops/facades/__init__.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: FOUNDER\n# Role: ops domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nops / facades\n\nExports will be added as files are moved here.\n""""""",\nops / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
470,app/houseofcards/founder/ops/facades/ops_facade.py,FOUNDER,ops,L3,app/houseofcards/founder/ops/facades/ops_facade.py,"# Layer: L4 — Domain Engine\n# Product: founder-console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Ops Domain Facade - Centralized access to ops operations\n# Callers: Ops API routes (L2)\n# Allowed Imports: L4 ops services, L5, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: API-001 Guardrail (Domain Facade Required)\n\n""""""\nOps Domain Facade\n\nThis facade provides the external interface to the Ops domain.","\nOps Domain Facade\n\nThis facade provides the external interface to the Ops domain.\nAll code outside the Ops domain MUST use this facade.\n\nWhy Facades Matter:\n- Authorization checks happen in one place\n- Audit logging is centralized\n- Domain encapsulation is preserved\n- Interface stability for external callers\n\nUsage:\n    from app.services.ops import get_ops_facade\n\n    facade = get_ops_facade()\n    incidents = facade.get_active_incidents(since, until)\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
471,app/houseofcards/founder/ops/schemas/__init__.py,FOUNDER,ops,L6,app/houseofcards/founder/ops/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: FOUNDER\n# Role: ops domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nops / schemas\n\nExports will be added as files are moved here.\n""""""",\nops / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
472,app/houseofcards/founder/ops/schemas/ops_domain_models.py,FOUNDER,ops,L6,app/houseofcards/founder/ops/schemas/ops_domain_models.py,"# Layer: L4 — Domain Engines\n# Product: system-wide (ops visibility)\n# Temporal:\n#   Trigger: api|scheduler\n#   Execution: sync\n# Role: Ops domain models for operator intelligence views\n# Callers: L3 adapters, L2 ops APIs\n# Allowed Imports: L6 (stdlib only for models)\n# Forbidden Imports: L6 infra artifacts (ErrorEnvelope, CorrelationContext)\n# Reference: PIN-264 (Phase-S Ops Domain)\n\n""""""\nOps Domain Models — L4 Interpreted Meaning\n\nThese models represent OPERATOR understanding, NOT infra truth.","\nOps Domain Models — L4 Interpreted Meaning\n\nThese models represent OPERATOR understanding, NOT infra truth.\n\nDesign Principles:\n- Derived: Computed from infra data, never raw infra\n- Lossy: Intentionally simplified for human consumption\n- Opinionated: Contains interpretation and severity judgment\n- Role-scoped: Designed for operator visibility, not debugging\n\nPublication Pipeline:\n    L6 Infra (ErrorEnvelope, DecisionSnapshot)\n        ↓ (translation happens in services)\n    L4 Ops Domain Models",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
473,app/houseofcards/internal/__init__.py,INTERNAL,incidents,L5,app/houseofcards/internal/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: Internal infrastructure domain services package\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nInternal Domain Services (houseofcards)\n\nInfrastructure and background services:\n- recovery: Failure handling and recovery logic\n- agent: Agent planning and orchestration\n\nPattern: app/houseofcards/internal/{domain}/{role}/{file}.py\n""""""\n",\nInternal Domain Services (houseofcards)\n\nInfrastructure and background services:\n- recovery: Failure handling and recovery logic\n- agent: Agent planning and orchestration\n\nPattern: app/houseofcards/internal/{domain}/{role}/{file}.py\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
474,app/houseofcards/internal/agent/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: Agent domain - Agent planning\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nAgent Domain\n\nTopics: planning\nRoles: facades, engines, schemas\n""""""","\nAgent Domain\n\nTopics: planning\nRoles: facades, engines, schemas\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
475,app/houseofcards/internal/agent/drivers/__init__.py,INTERNAL,agent,L6,app/houseofcards/internal/agent/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: agent domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nagent / drivers\n\nExports will be added as files are moved here.\n""""""",\nagent / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
476,app/houseofcards/internal/agent/engines/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: agent domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nagent / engines\n\nExports will be added as files are moved here.\n""""""",\nagent / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
477,app/houseofcards/internal/agent/engines/ai_console_panel_engine.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/ai_console_panel_engine.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Main orchestration engine for panel evaluation\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nAI Console Panel Engine — Main orchestration for panel evaluation\n\nOrchestrates the complete panel evaluation pipeline:\n1. Load spec → resolve dependencies → collect signals\n2. Verify inputs → evaluate slots → check consistency\n3. Assemble response → emit metrics\n\nThis is Option A: Spec Interpreter pattern.\n""""""",\nAI Console Panel Engine — Main orchestration for panel evaluation\n\nOrchestrates the complete panel evaluation pipeline:\n1. Load spec → resolve dependencies → collect signals\n2. Verify inputs → evaluate slots → check consistency\n3. Assemble response → emit metrics\n\nThis is Option A: Spec Interpreter pattern.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
478,app/houseofcards/internal/agent/engines/intent_guardrails.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/intent_guardrails.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Phase A Intent Guardrails (design-time validation)\n# Reference: PIN-420, L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nIntent Guardrails — Phase A of two-phase semantic validation.\n\nThese rules validate intent YAML at design-time, BEFORE any SDSR or API calls.\n\nCRITICAL INVARIANT:\n    Phase A rules must NEVER depend on SDSR or APIs.\n    Phase A rules judge whether an idea is allowed to exist.\n\nFix Owner: Product / Architecture","\nIntent Guardrails — Phase A of two-phase semantic validation.\n\nThese rules validate intent YAML at design-time, BEFORE any SDSR or API calls.\n\nCRITICAL INVARIANT:\n    Phase A rules must NEVER depend on SDSR or APIs.\n    Phase A rules judge whether an idea is allowed to exist.\n\nFix Owner: Product / Architecture\nTrigger: sync from intent ledger, adding/modifying intent YAML\n\nChecks:\n    INT-001: Signal provability\n    INT-002: Capability cardinality\n    INT-003: Semantic duplication\n    INT-004: ",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
479,app/houseofcards/internal/agent/engines/panel_capability_resolver.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_capability_resolver.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Resolve capability IDs to endpoints via AURORA registry\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml, AURORA_L2_CAPABILITY_REGISTRY\n\n""""""\nPanel Capability Resolver — Binds panels to capabilities, not endpoints.\n\nCore principle:\n    Panels bind to capability IDs (semantic).\n    Endpoints are resolved via AURORA capability registry (reality).\n    Only OBSERVED/TRUSTED capabilities may be called.\n\nThis enforces:\n    - GAP 6 fix: Capability registry now used","\nPanel Capability Resolver — Binds panels to capabilities, not endpoints.\n\nCore principle:\n    Panels bind to capability IDs (semantic).\n    Endpoints are resolved via AURORA capability registry (reality).\n    Only OBSERVED/TRUSTED capabilities may be called.\n\nThis enforces:\n    - GAP 6 fix: Capability registry now used\n    - GAP 4 fix: SDSR observation status checked before calls\n    - Clean separation: spec = meaning, registry = plumbing\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
480,app/houseofcards/internal/agent/engines/panel_consistency_checker.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_consistency_checker.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Cross-slot consistency enforcement\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Consistency Checker — Cross-slot consistency rules\n\nChecks that output signals across slots in a panel are consistent.\nInconsistencies are violations, not warnings.\n""""""\n\nimport logging\nfrom dataclasses import dataclass, field\nfrom typing import Any, Dict, List, Optional","\nPanel Consistency Checker — Cross-slot consistency rules\n\nChecks that output signals across slots in a panel are consistent.\nInconsistencies are violations, not warnings.\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
481,app/houseofcards/internal/agent/engines/panel_dependency_resolver.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_dependency_resolver.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Resolve panel dependencies and evaluation order\n# Reference: L2_1_PANEL_DEPENDENCY_GRAPH.yaml\n\n""""""\nPanel Dependency Resolver — Resolve evaluation order for panels\n\nDetermines which panels must be evaluated before others based on\nthe dependency graph. Supports short-circuit evaluation.\n""""""\n\nfrom typing import Dict, List, Optional, Set\n\nfrom .panel_types import DependencySpec",\nPanel Dependency Resolver — Resolve evaluation order for panels\n\nDetermines which panels must be evaluated before others based on\nthe dependency graph. Supports short-circuit evaluation.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
482,app/houseofcards/internal/agent/engines/panel_metrics_emitter.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_metrics_emitter.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Emit Prometheus metrics for panel evaluation\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Metrics Emitter — Prometheus metrics for panel adapter\n\nEmits counters, histograms, and gauges for:\n- Panel evaluation latency\n- Slot evaluation counts\n- Verification signal counts\n- Consistency violation counts\n- Authority distribution\n""""""","\nPanel Metrics Emitter — Prometheus metrics for panel adapter\n\nEmits counters, histograms, and gauges for:\n- Panel evaluation latency\n- Slot evaluation counts\n- Verification signal counts\n- Consistency violation counts\n- Authority distribution\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
483,app/houseofcards/internal/agent/engines/panel_response_assembler.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_response_assembler.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Assemble final panel response envelope\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Response Assembler — Assemble spec-compliant response envelope\n\nConstructs the final JSON response structure from evaluated slots,\nconsistency results, and metadata.\n""""""\n\nimport logging\nfrom dataclasses import asdict\nfrom datetime import datetime, timezone","\nPanel Response Assembler — Assemble spec-compliant response envelope\n\nConstructs the final JSON response structure from evaluated slots,\nconsistency results, and metadata.\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
484,app/houseofcards/internal/agent/engines/panel_signal_collector.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_signal_collector.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Collect raw signals from backend APIs via capability resolution\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Signal Collector — Capability-Bound API I/O for panel evaluation\n\nV2.0: Now resolves capabilities via AURORA registry instead of direct paths.\n\nCore principle:\n    - Slots declare capability IDs (semantic)\n    - This collector resolves to endpoints via AURORA registry\n    - Only OBSERVED/TRUSTED capabilities are callable\n    - Non-callable capabilities surface as negative authority",\nPanel Signal Collector — Capability-Bound API I/O for panel evaluation\n\nV2.0: Now resolves capabilities via AURORA registry instead of direct paths.\n\nCore principle:\n    - Slots declare capability IDs (semantic)\n    - This collector resolves to endpoints via AURORA registry\n    - Only OBSERVED/TRUSTED capabilities are callable\n    - Non-callable capabilities surface as negative authority\n\nThis enforces:\n    - GAP 6 fix: Capability registry now used\n    - GAP 4 fix: SDSR observation status check,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
485,app/houseofcards/internal/agent/engines/panel_signal_translator.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_signal_translator.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Translate spec signals to API field names\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Signal Translator — Maps semantic signals to API fields.\n\nCore principle:\n    Spec signals are SEMANTIC (what customers understand).\n    API fields are IMPLEMENTATION (what backend returns).\n    This layer absorbs the translation.\n\nBenefits:\n    - Spec remains stable even when APIs change field names","\nPanel Signal Translator — Maps semantic signals to API fields.\n\nCore principle:\n    Spec signals are SEMANTIC (what customers understand).\n    API fields are IMPLEMENTATION (what backend returns).\n    This layer absorbs the translation.\n\nBenefits:\n    - Spec remains stable even when APIs change field names\n    - Semantic naming in spec, implementation naming in backend\n    - Single place to fix mismatches\n    - API field changes don't break panel spec\n",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
486,app/houseofcards/internal/agent/engines/panel_slot_evaluator.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_slot_evaluator.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Evaluate individual panel slots\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Slot Evaluator — Execute slot evaluation logic\n\nEvaluates a slot given collected signals and verification results.\nComputes derived output signals.\n""""""\n\nimport logging\nfrom datetime import datetime, timezone\nfrom typing import Any, Callable, Dict, Optional",\nPanel Slot Evaluator — Execute slot evaluation logic\n\nEvaluates a slot given collected signals and verification results.\nComputes derived output signals.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
487,app/houseofcards/internal/agent/engines/panel_spec_loader.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_spec_loader.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Load and parse L2.1 Panel Adapter YAML spec\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Spec Loader — Load YAML specification for AI Console panels\n\nLoads:\n- L2_1_PANEL_ADAPTER_SPEC.yaml — panel definitions\n- L2_1_PANEL_DEPENDENCY_GRAPH.yaml — evaluation order\n- L2_1_SLOT_DETERMINISM_MATRIX.csv — determinism rules\n""""""\n\nimport csv",\nPanel Spec Loader — Load YAML specification for AI Console panels\n\nLoads:\n- L2_1_PANEL_ADAPTER_SPEC.yaml — panel definitions\n- L2_1_PANEL_DEPENDENCY_GRAPH.yaml — evaluation order\n- L2_1_SLOT_DETERMINISM_MATRIX.csv — determinism rules\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
488,app/houseofcards/internal/agent/engines/panel_verification_engine.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/panel_verification_engine.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Determinism verification and input validation\n# Reference: L2_1_SLOT_DETERMINISM_MATRIX.csv\n\n""""""\nPanel Verification Engine — Determinism enforcement\n\nVerifies inputs and enforces determinism rules.\nHard failures on violations. No best-effort.\n""""""\n\nimport logging\nfrom typing import Any, Dict, List, Optional, Tuple\n",\nPanel Verification Engine — Determinism enforcement\n\nVerifies inputs and enforces determinism rules.\nHard failures on violations. No best-effort.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
489,app/houseofcards/internal/agent/engines/semantic_validator.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/semantic_validator.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Semantic validation gate — enforce semantic authority\n# Reference: PIN-420, L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nSemantic Validator — Force semantic authority in the panel pipeline.\n\nCore Principle:\n    Semantics must be declared once, validated mechanically, enforced everywhere.\n\nThis validator sits between SDSR and HISAR binding:\n    SDSR (API works?) → Semantic Validator → HISAR (bind or block)\n\nIt enforces:","\nSemantic Validator — Force semantic authority in the panel pipeline.\n\nCore Principle:\n    Semantics must be declared once, validated mechanically, enforced everywhere.\n\nThis validator sits between SDSR and HISAR binding:\n    SDSR (API works?) → Semantic Validator → HISAR (bind or block)\n\nIt enforces:\n    1. Signal Completeness - Every signal has translation OR compute function\n    2. Capability Reality - Every capability is OBSERVED or TRUSTED\n    3. API Field Presence - Every translated field ",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
490,app/houseofcards/internal/agent/engines/validator_engine.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/validator_engine.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Two-phase semantic validation orchestrator\n# Reference: PIN-420\n\n""""""\nValidator Engine — Two-phase semantic validation orchestrator.\n\nThis engine runs:\n    Phase A: Intent Guardrails (design-time, human-facing)\n    Phase B: Semantic Reality (proof-time, system-facing)\n\nKey Invariant:\n    Phase A rules must NEVER depend on SDSR or APIs.\n    Phase B rules must NEVER judge human intent quality.","\nValidator Engine — Two-phase semantic validation orchestrator.\n\nThis engine runs:\n    Phase A: Intent Guardrails (design-time, human-facing)\n    Phase B: Semantic Reality (proof-time, system-facing)\n\nKey Invariant:\n    Phase A rules must NEVER depend on SDSR or APIs.\n    Phase B rules must NEVER judge human intent quality.\n\nThe engine enforces ordering: Phase A MUST complete before Phase B runs.\nIf Phase A has BLOCKING violations, Phase B is skipped.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
491,app/houseofcards/internal/agent/engines/worker_registry_service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/worker_registry_service.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Role: Worker discovery, status queries, capability registry\n# Callers: L2 APIs, L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""\nWorker Registry Service (M21)\n\nProvides:\n- Dynamic worker discovery from database\n- Worker status and capability queries\n- Per-tenant worker configuration\n- Worker availability checks\n""""""",\nWorker Registry Service (M21)\n\nProvides:\n- Dynamic worker discovery from database\n- Worker status and capability queries\n- Per-tenant worker configuration\n- Worker availability checks\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
492,app/houseofcards/internal/agent/engines/worker_write_service_async.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/worker_write_service_async.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Worker API)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: DB write delegation for Worker API (Phase 2B extraction)\n# Callers: api/workers.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 4\n\n""""""\nWorker Write Service (Async) - DB write operations for Worker API.\n\nPhase 2B Batch 4: Extracted from api/workers.py.",\nWorker Write Service (Async) - DB write operations for Worker API.\n\nPhase 2B Batch 4: Extracted from api/workers.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n- Preserve async semantics exactly\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
493,app/houseofcards/internal/agent/facades/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: agent domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nagent / facades\n\nExports will be added as files are moved here.\n""""""",\nagent / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
494,app/houseofcards/internal/agent/schemas/__init__.py,INTERNAL,agent,L6,app/houseofcards/internal/agent/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: agent domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nagent / schemas\n\nExports will be added as files are moved here.\n""""""",\nagent / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
495,app/houseofcards/internal/agent/schemas/panel_types.py,INTERNAL,agent,L6,app/houseofcards/internal/agent/schemas/panel_types.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Shared type primitives for Panel Adapter\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Types — Shared primitives for AI Console Panel Adapter\n\nAll type definitions used across the panel adapter system.\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime\nfrom enum import Enum\nfrom typing import Any, Dict, List, Optional",\nPanel Types — Shared primitives for AI Console Panel Adapter\n\nAll type definitions used across the panel adapter system.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
496,app/houseofcards/internal/agent/schemas/semantic_failures.py,INTERNAL,agent,L6,app/houseofcards/internal/agent/schemas/semantic_failures.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Semantic failure taxonomy and fix guidance\n# Reference: PIN-420\n\n""""""\nSemantic Failures — Canonical failure taxonomy for two-phase validation.\n\nTwo Phases:\n- Phase A: Intent Guardrails (INT-*) — design-time, human-facing\n- Phase B: Semantic Reality (SEM-*) — proof-time, system-facing\n\nEach failure code has:\n- Name: Human-readable name\n- Class: INTENT_VIOLATION or SEMANTIC_VIOLATION","\nSemantic Failures — Canonical failure taxonomy for two-phase validation.\n\nTwo Phases:\n- Phase A: Intent Guardrails (INT-*) — design-time, human-facing\n- Phase B: Semantic Reality (SEM-*) — proof-time, system-facing\n\nEach failure code has:\n- Name: Human-readable name\n- Class: INTENT_VIOLATION or SEMANTIC_VIOLATION\n- Severity: BLOCKING or WARNING\n- Fix Owner: Who is responsible for fixing\n- Fix Action: What action to take\n\nThis taxonomy ensures violations are actionable, not just noise.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
497,app/houseofcards/internal/agent/schemas/semantic_types.py,INTERNAL,agent,L6,app/houseofcards/internal/agent/schemas/semantic_types.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Type definitions for semantic validation\n# Reference: PIN-420, L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nSemantic Types — Core structures for two-phase semantic validation.\n\nTwo-Phase Architecture:\n    Phase A: Intent Guardrails (design-time, human-facing)\n    Phase B: Semantic Reality (proof-time, system-facing)\n\nKey Invariant:\n    - Intent rules must never depend on SDSR or APIs\n    - Semantic rules must never judge human intent quality","\nSemantic Types — Core structures for two-phase semantic validation.\n\nTwo-Phase Architecture:\n    Phase A: Intent Guardrails (design-time, human-facing)\n    Phase B: Semantic Reality (proof-time, system-facing)\n\nKey Invariant:\n    - Intent rules must never depend on SDSR or APIs\n    - Semantic rules must never judge human intent quality\n\nThese types enforce semantic authority in the panel pipeline.\nSemantics are declared in intent, validated mechanically, enforced everywhere.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
498,app/houseofcards/internal/platform/engines/executor.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/executor.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: executor\n# Parent Gap: GAP-039 (JobScheduler)\n# Reference: GAP-154\n# Depends On: GAP-052 (JobScheduler service)\n# Temporal:\n#   Trigger: worker (startup)\n#   Execution: async\n# Role: Bind JobScheduler to APScheduler for actual execution\n# Callers: Worker startup, application lifecycle\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""",\nModule: executor\nPurpose: Bind JobScheduler to APScheduler for actual execution.\n\nWires:\n    - Source: app/services/scheduler/job_scheduler.py\n    - Target: APScheduler library\n\nExecution Modes:\n    - Cron: Periodic execution via APScheduler cron trigger\n    - One-time: Delayed execution via APScheduler date trigger\n    - Interval: Fixed interval execution\n    - Immediate: Direct execution (no scheduling)\n\nAcceptance Criteria:\n    - AC-154-01: Jobs are scheduled via APScheduler\n    - AC-154-02:,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
499,app/houseofcards/internal/platform/engines/job_execution.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/job_execution.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: service\n# Parent Gap: GAP-039 (JobScheduler)\n# Reference: GAP-156 (Retry), GAP-157 (Progress), GAP-158 (Audit)\n# Temporal:\n#   Trigger: worker (job execution)\n#   Execution: async\n# Role: Job execution support services (retry, progress, audit)\n# Callers: JobQueueWorker, APSchedulerExecutor\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""\nModule: job_execution",\nModule: job_execution\nPurpose: Job execution support services.\n\nProvides:\n    - GAP-156: Retry logic with exponential backoff\n    - GAP-157: Progress reporting and tracking\n    - GAP-158: Audit evidence emission\n\nAcceptance Criteria:\n    - AC-156-01: Exponential backoff with jitter\n    - AC-156-02: Max retries respected\n    - AC-156-03: Retry history recorded\n    - AC-157-01: Progress percentage tracked\n    - AC-157-02: Progress events emitted\n    - AC-157-03: ETA calculation\n    - AC-158-01: J,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
500,app/houseofcards/internal/platform/engines/job_scheduler.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/job_scheduler.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-052 (Jobs Scheduler)\n""""""\nJobScheduler - Job scheduling and management service.\n\nProvides scheduling capabilities for:\n- Cron-like periodic jobs\n- One-time delayed execution\n- Interval-based recurring jobs\n- Job lifecycle management\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timedelta, timezone",\nJobScheduler - Job scheduling and management service.\n\nProvides scheduling capabilities for:\n- Cron-like periodic jobs\n- One-time delayed execution\n- Interval-based recurring jobs\n- Job lifecycle management\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
501,app/houseofcards/internal/platform/engines/sandbox_executor.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/sandbox_executor.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Low-level sandbox execution with process isolation\n# Callers: SandboxService\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-174 (Execution Sandboxing)\n\n""""""\nSandbox Executor (GAP-174)\n\nProvides low-level execution isolation:",\nSandbox Executor (GAP-174)\n\nProvides low-level execution isolation:\n- Process-based execution with resource limits\n- Container-based execution (Docker/Podman)\n- Network namespace isolation\n- Filesystem sandboxing\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
502,app/houseofcards/internal/platform/engines/sandbox_service.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/sandbox_service.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# PHASE: W2\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: High-level sandbox service with policy enforcement\n# Callers: Runtime, API routes, Skill executors\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-174 (Execution Sandboxing)\n\n""""""\nSandbox Service (GAP-174)",\nSandbox Service (GAP-174)\n\nHigh-level service for managing sandbox execution:\n- Policy-based isolation level selection\n- Execution quota management\n- Audit logging\n- Result caching\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
503,app/houseofcards/internal/platform/governance/engines/governance_signal_service.py,INTERNAL,platform,L4,app/houseofcards/internal/platform/governance/engines/governance_signal_service.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker|scheduler\n#   Execution: sync\n# Role: Governance signal persistence service\n# Callers: L7 (BLCA, CI) for writes, L4/L5 for reads\n# Allowed Imports: L6 (db, models)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-256 Phase E FIX-03\n\n""""""\nGovernance Signal Service (Phase E FIX-03)\n\nL6 service for persisting and querying governance signals.","\nGovernance Signal Service (Phase E FIX-03)\n\nL6 service for persisting and querying governance signals.\n\nWrite Path (L7 → L6):\n- BLCA, CI, OPS write signals via record_signal()\n- Signals are persisted to governance_signals table\n- Previous signals for same scope/type are superseded\n\nRead Path (L4/L5 ← L6):\n- Domain orchestrators check governance before decisions\n- Workers check governance before execution\n- Returns blocking/warning signals for scope\n\nContract:\n- All governance influence becomes ",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
504,app/houseofcards/internal/platform/iam/__init__.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/iam/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: internal/platform/iam - IAM infrastructure for internal callers\n# Reference: HOC_account_analysis_v1.md\n\n""""""\ninternal/platform/iam\n\nIdentity and Access Management infrastructure for internal callers.\nCUSTOMER-facing operations should use high-level auth abstractions.\n""""""",\ninternal/platform/iam\n\nIdentity and Access Management infrastructure for internal callers.\nCUSTOMER-facing operations should use high-level auth abstractions.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
505,app/houseofcards/internal/platform/iam/engines/__init__.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/iam/engines/__init__.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# Role: internal/platform/iam/engines - IAM engines for internal callers\n# Reference: HOC_account_analysis_v1.md\n\n""""""\ninternal/platform/iam/engines\n\nIAM engines for internal orchestration.\n""""""\n\nfrom .iam_service import (\n    IAMService,\n    Identity,\n    AccessDecision,",\ninternal/platform/iam/engines\n\nIAM engines for internal orchestration.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
506,app/houseofcards/internal/platform/iam/engines/iam_service.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/iam/engines/iam_service.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# PHASE: W2\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: IAM service for identity and access management\n# Callers: Auth middleware, API routes\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-173 (IAM Integration)\n\n""""""\nIAM Service (GAP-173)",\nIAM Service (GAP-173)\n\nProvides unified IAM capabilities:\n- Identity resolution from multiple providers\n- Role and permission management\n- Access control decisions\n- Audit logging\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
507,app/houseofcards/internal/platform/monitoring/platform_health_service.py,INTERNAL,platform,L4,app/houseofcards/internal/platform/monitoring/platform_health_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker|scheduler\n#   Execution: sync\n# Role: Platform Health Authority - THE source of truth for platform state\n# Callers: L3 (PlatformEligibilityAdapter), L2 (/platform/health), L7 (bootstrap)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-284 (Platform Monitoring System)\n#\n# ==============================================================================\n# GOVERNANCE RULE: HEALTH-IS-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#","\nPlatform Health Service (L4)\n\nThe authoritative source for platform health state.\nConverts raw signals into deterministic health states.\n\nResponsibilities:\n1. Aggregate signals from L6/L7 sources (BLCA, guards, incidents, contracts)\n2. Produce deterministic health states (HEALTHY/DEGRADED/BLOCKED)\n3. Provide health for system, domains, and individual capabilities\n4. Drive governance consequences via health→qualifier binding\n\nContract:\n- Health states are closed set: {HEALTHY, DEGRADED, BLOCKED}",,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Health),TRANSFER
508,app/houseofcards/internal/platform/policy/__init__.py,INTERNAL,policies,L5,app/houseofcards/internal/platform/policy/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: internal/platform/policy - Policy infrastructure for internal callers\n# Reference: HOC_policies_analysis_v1.md\n\n""""""\ninternal/platform/policy\n\nPolicy infrastructure for internal callers (workers, governance services).\nCUSTOMER-facing operations use customer/policies/ instead.\n""""""","\ninternal/platform/policy\n\nPolicy infrastructure for internal callers (workers, governance services).\nCUSTOMER-facing operations use customer/policies/ instead.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
509,app/houseofcards/internal/platform/policy/engines/__init__.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/policy/engines/__init__.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# Role: internal/platform/policy/engines - Policy engines for internal callers\n# Reference: HOC_policies_analysis_v1.md\n\n""""""\ninternal/platform/policy/engines\n\nPolicy engines for internal orchestration.\n""""""\n\nfrom .policy_driver import PolicyDriver, get_policy_driver, reset_policy_driver\n\n__all__ = [\n    ""PolicyDriver"",",\ninternal/platform/policy/engines\n\nPolicy engines for internal orchestration.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
510,app/houseofcards/internal/platform/policy/engines/policy_driver.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/policy/engines/policy_driver.py,"# Layer: L4 — Domain Driver\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync/async\n# Role: Policy Domain Driver - Internal orchestration for policy operations\n# Callers: policy_layer API, governance services, worker runtime\n# Allowed Imports: L4 policy engine, L5, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: FACADE_CONSOLIDATION_PLAN.md, API-001 Guardrail\n#\n# GOVERNANCE NOTE:\n# This is the INTERNAL driver for policy evaluation operations.\n# CUSTOMER-facing CRUD operations use policies_facade.py (L2 API projection).","\nPolicy Domain Driver (INTERNAL)\n\nThis driver provides the internal interface for policy evaluation operations.\nUsed by policy_layer API, governance services, and worker runtime.\n\nFor CUSTOMER policy CRUD operations, use policies_facade.py instead.\n\nWhy Drivers (not Facades for internal use):\n- Facades are API projection layers (CUSTOMER-facing)\n- Drivers are orchestration layers (INTERNAL)\n- Clear separation prevents confusion\n- Import rules become enforceable\n\nUsage:\n    from app.services.poli",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
511,app/houseofcards/internal/recovery/__init__.py,INTERNAL,recovery,L5,app/houseofcards/internal/recovery/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: Recovery domain - Failure handling\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nRecovery Domain\n\nTopics: claims, evaluation, rules\nRoles: facades, engines, schemas\n""""""","\nRecovery Domain\n\nTopics: claims, evaluation, rules\nRoles: facades, engines, schemas\n",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
512,app/houseofcards/internal/recovery/drivers/__init__.py,INTERNAL,recovery,L6,app/houseofcards/internal/recovery/drivers/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: recovery domain - drivers\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nrecovery / drivers\n\nExports will be added as files are moved here.\n""""""",\nrecovery / drivers\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
513,app/houseofcards/internal/recovery/drivers/recovery_write_service.py,INTERNAL,recovery,L6,app/houseofcards/internal/recovery/drivers/recovery_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Recovery API)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Recovery APIs (Phase 2B extraction)\n# Callers: api/recovery_ingest.py, api/recovery.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 4\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# DB write operations with atomic UPSERT via ON CONFLICT DO UPDATE","Sync DB write operations for Recovery APIs.\n\nWrite-only facade. No policy logic, no branching beyond DB operations.\nRaw SQL preserved exactly as extracted from API files.",,NEEDS_CLASSIFICATION,ITERATION_1,In drivers/ dir,TRANSFER
514,app/houseofcards/internal/recovery/engines/__init__.py,INTERNAL,recovery,L5,app/houseofcards/internal/recovery/engines/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: recovery domain - engines\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nrecovery / engines\n\nExports will be added as files are moved here.\n""""""",\nrecovery / engines\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
515,app/houseofcards/internal/recovery/engines/incident_driver.py,INTERNAL,recovery,L5,app/houseofcards/internal/recovery/engines/incident_driver.py,"# Layer: L4 — Domain Driver\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Incident Domain Driver - Internal orchestration for incident operations\n# Callers: worker runtime, governance services, transaction coordinator\n# Allowed Imports: L4 incident services, L4 audit, L5, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: FACADE_CONSOLIDATION_PLAN.md, PIN-454 (RAC)\n#\n# GOVERNANCE NOTE:\n# This is the INTERNAL driver for incident operations.\n# CUSTOMER-facing operations use incidents_facade.py (L2 API projection).","\nIncident Domain Driver (INTERNAL)\n\nThis driver provides the internal interface for incident operations.\nUsed by workers, governance services, and transaction coordinators.\n\nFor CUSTOMER API operations, use incidents_facade.py instead.\n\nWhy Drivers (not Facades for internal use):\n- Facades are API projection layers (CUSTOMER-facing)\n- Drivers are orchestration layers (INTERNAL)\n- Clear separation prevents confusion\n- Import rules become enforceable\n\nUsage:\n    from app.services.incidents.inciden",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
516,app/houseofcards/internal/recovery/engines/orphan_recovery.py,INTERNAL,recovery,L5,app/houseofcards/internal/recovery/engines/orphan_recovery.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: Orphan detection logic, PB-S2 truth guarantee\n# Callers: L5 workers (startup), L7 ops scripts\n# Reference: PIN-242 (Baseline Freeze)\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Updates run status from ""running"" to ""crashed"" - factual state mutation\n# Atomic updates with no external dependencies\nFEATURE_INTENT = FeatureIntent.STATE_MUTATION\nRETRY_POLICY = RetryPolicy.SAFE\n\n""""""",,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
517,app/houseofcards/internal/recovery/engines/recovery_matcher.py,INTERNAL,recovery,L5,app/houseofcards/internal/recovery/engines/recovery_matcher.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: recovery_evaluator.py (worker)\n# Reference: PIN-240\n# WARNING: If this logic is wrong, ALL products break.\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Escalates to LLM for recovery suggestions - external HTTP calls are non-deterministic\n# LLM responses cannot be safely retried without semantic duplication\nFEATURE_INTENT = FeatureIntent.EXTERNAL_SIDE_EFFECT\nRETRY_POLICY = RetryPolicy.NEVER\n\n# app/services/recovery_matcher.py",Result from matching a failure to a recovery suggestion.,,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
518,app/houseofcards/internal/recovery/engines/scoped_execution.py,INTERNAL,recovery,L5,app/houseofcards/internal/recovery/engines/scoped_execution.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: Pre-execution gate, scope enforcement\n# Callers: L2 APIs (recovery actions), L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n# app/services/scoped_execution.py\n""""""\nM6: Scoped Execution Context Service (P2FC-4)\n\nPre-execution gate for MEDIUM+ risk recovery actions.\n\nCORE INVARIANT (M6):\n> ""No recovery action may execute without an explicit, bounded execution\n>  scope derived from incident context.""","\nM6: Scoped Execution Context Service (P2FC-4)\n\nPre-execution gate for MEDIUM+ risk recovery actions.\n\nCORE INVARIANT (M6):\n> ""No recovery action may execute without an explicit, bounded execution\n>  scope derived from incident context.""\n\nThe Scoped Execution primitive provides:\n1. Scope creation with incident binding, cost ceiling, action limits, expiry\n2. Scope-gated execution (no execution without valid scope)\n3. Scope exhaustion tracking (single-use by default)\n4. Scope tampering detection (",,NEEDS_CLASSIFICATION,ITERATION_1,In engines/ dir,TRANSFER
519,app/houseofcards/internal/recovery/facades/__init__.py,INTERNAL,recovery,L5,app/houseofcards/internal/recovery/facades/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: recovery domain - facades\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nrecovery / facades\n\nExports will be added as files are moved here.\n""""""",\nrecovery / facades\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
520,app/houseofcards/internal/recovery/schemas/__init__.py,INTERNAL,recovery,L6,app/houseofcards/internal/recovery/schemas/__init__.py,"# Layer: L4 — Domain Services\n# AUDIENCE: INTERNAL\n# Role: recovery domain - schemas\n# Reference: DIRECTORY_REORGANIZATION_PLAN.md\n\n""""""\nrecovery / schemas\n\nExports will be added as files are moved here.\n""""""",\nrecovery / schemas\n\nExports will be added as files are moved here.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
521,app/infra/__init__.py,INTERNAL,agent,L6,app/houseofcards/internal/agent/drivers/__init__.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Infrastructure namespace for Phase-S systems\n# Callers: Any layer requiring infra utilities\n# Allowed Imports: L6 only\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-264\n\n""""""\nInfrastructure Namespace (infra.*)\n\nThis namespace contains Phase-S systems for:",\nInfrastructure Namespace (infra.*)\n\nThis namespace contains Phase-S systems for:\n- Error capture and forensics\n- Correlation tracking\n- Replay infrastructure\n- Synthetic traffic generation\n\nSemantic Separation:\n- infra.* = Infrastructure systems (this namespace)\n- product.* = Customer-facing product code\n\nEverything here is L6 (Platform Substrate) or L7 (Ops Tools).\nNothing here should import L4 (Domain Engines) or L5 (Workers).\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
522,app/infra/correlation.py,INTERNAL,logs,L6,app/houseofcards/internal/logs/drivers/correlation.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any (api|worker|scheduler|external)\n#   Execution: sync\n# Role: Correlation ID generation and context propagation\n# Callers: Any layer requiring request tracing\n# Allowed Imports: None (pure utilities + stdlib)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-264 (Phase-S Error Capture, Section 1.2)\n\n""""""\nCorrelation ID Utilities — Phase-S Track 1.2\n\nOne request/workflow must be traceable across:","\nCorrelation ID Utilities — Phase-S Track 1.2\n\nOne request/workflow must be traceable across:\n- API layer\n- Domain engine\n- Worker\n- Decision emission\n\nDesign Principles:\n- Thread-safe: Uses contextvars for async-safe propagation\n- Immutable IDs: Once generated, correlation IDs never change\n- Hierarchical: Can create child spans for sub-operations\n- Lightweight: No external dependencies\n",,NEEDS_CLASSIFICATION,ITERATION_1,Infrastructure,TRANSFER
523,app/infra/danger_fences.py,INTERNAL,analytics,L6,app/houseofcards/internal/analytics/drivers/danger_fences.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Danger Fences - Encapsulated patterns for known-dangerous operations\n# Callers: Recovery services, workers\n# Allowed Imports: L6 only\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-268 (GU-004), PIN-267 (Test System Protection Rule)\n\n""""""\nDanger Fences Module (PIN-268 GU-004)\n\nThis module contains DANGER FENCE helpers - explicit functions that encapsulate",\nDanger Fences Module (PIN-268 GU-004)\n\nThis module contains DANGER FENCE helpers - explicit functions that encapsulate\nknown-dangerous patterns. These exist to:\n\n1. Prevent reimplementation of patterns with known race conditions\n2. Centralize documentation of why patterns are dangerous\n3. Provide safe entry points that handle edge cases correctly\n4. Make it impossible to accidentally introduce known bugs\n\nGOVERNANCE RULE:\n- Any code touching these patterns MUST use these helpers\n- Reimplementin,,NEEDS_CLASSIFICATION,ITERATION_1,Infrastructure,TRANSFER
524,app/infra/error_envelope.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/error_envelope.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any (api|worker|scheduler|external)\n#   Execution: sync\n# Role: Unified error envelope for forensic diagnostics\n# Callers: Any layer emitting errors (L2, L3, L4, L5, L6)\n# Allowed Imports: None (pure data structures + stdlib)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-264 (Phase-S Error Capture)\n\n""""""\nUnified Error Envelope — Phase-S Track 1\n\nEvery error in the system MUST emit this envelope.","\nUnified Error Envelope — Phase-S Track 1\n\nEvery error in the system MUST emit this envelope.\nThis is the atomic unit of error observability.\n\nDesign Principles:\n- Immutable: Once created, cannot be modified\n- Complete: Contains all information needed for diagnosis\n- Safe: No raw secrets, only hashes where needed\n- Traceable: Correlation IDs link across system boundaries\n\nRequired Fields (PIN-264):\n- error_id: Unique identifier for this error instance\n- timestamp: When the error occurred (UTC)\n-",,NEEDS_CLASSIFICATION,ITERATION_1,Infrastructure,TRANSFER
525,app/infra/error_store.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/error_store.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any (api|worker|scheduler)\n#   Execution: sync\n# Role: Append-only error persistence for forensic diagnostics\n# Callers: L4 aggregation services, L7 ops tools\n# Allowed Imports: L6 only (db, infra)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-264 (Phase-S Track 1.3)\n\n""""""\nError Persistence Store — Phase-S Track 1.3\n\nAppend-only, write-once store for ErrorEnvelope persistence.","\nError Persistence Store — Phase-S Track 1.3\n\nAppend-only, write-once store for ErrorEnvelope persistence.\n\nDesign Principles:\n- APPEND-ONLY: No updates, no deletes (except retention cleanup)\n- WRITE-ONCE: Each error_id is immutable after insert\n- INFRA-ONLY: Never exposed to product APIs\n- VERSIONED: Envelope version stored for replay compatibility\n\nThis is the forensic memory of the system.\nErrors written here become incident history.\n\nHARD RULES:\n1. No UPDATE operations\n2. No DELETE operation",,NEEDS_CLASSIFICATION,ITERATION_1,Infrastructure,TRANSFER
526,app/infra/feature_intent.py,INTERNAL,agent,L6,app/houseofcards/internal/agent/drivers/feature_intent.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Feature-level intent declarations for self-defending architecture\n# Callers: Any module requiring feature-level intent clarity\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-264 (Phase-2.3 Feature Intent System)\n\n""""""\nFeature Intent System (L6)\n\nPHILOSOPHY (Phase-2.3)","\nFeature Intent System (L6)\n\nPHILOSOPHY (Phase-2.3)\n----------------------\nTransactionIntent answers: ""How does this function interact with the database?""\n\nFeatureIntent answers: ""What does this feature DO to system state?""\n\nA fully self-defending system requires BOTH:\n- Function-level: TransactionIntent (READ_ONLY, ATOMIC_WRITE, LOCKED_MUTATION)\n- Feature-level: FeatureIntent (PURE_QUERY, STATE_MUTATION, EXTERNAL_SIDE_EFFECT, RECOVERABLE_OPERATION)\n\nINTENT HIERARCHY\n----------------\nThe system ",,NEEDS_CLASSIFICATION,ITERATION_1,Infrastructure,TRANSFER
527,app/infra/feature_intent_examples.py,INTERNAL,analytics,L6,app/houseofcards/internal/analytics/drivers/feature_intent_examples.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Golden examples for feature intent patterns\n# Callers: Reference for engineers implementing features\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-264 (Phase-2.3 Feature Intent System)\n\n""""""\nFeature Intent Golden Examples\n\nThis module contains REFERENCE IMPLEMENTATIONS for proper use of",\nFeature Intent Golden Examples\n\nThis module contains REFERENCE IMPLEMENTATIONS for proper use of\nthe FeatureIntent + TransactionIntent hierarchy.\n\nINTENT HIERARCHY\n----------------\n\n    FeatureIntent (module-level)\n         ↓ constrains\n    TransactionIntent (function-level)\n         ↓ constrains\n    Primitive (implementation-level)\n\nVALID COMBINATIONS\n------------------\n\n| FeatureIntent           | TransactionIntent        | RetryPolicy    |\n|-------------------------|-------------------------,,NEEDS_CLASSIFICATION,ITERATION_1,Infrastructure,TRANSFER
528,app/infra/transaction.py,INTERNAL,agent,L6,app/houseofcards/internal/agent/drivers/transaction.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker\n#   Execution: sync\n# Role: Single-connection transaction primitives for lock-safe operations\n# Callers: Any code requiring transactional continuity with row locks\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-264 (Phase-2.2 Self-Defending Transactions with Intent)\n\n""""""\nSelf-Defending Transaction System (L6)\n\nPHILOSOPHY (Phase-2.2 Upgrade)","\nSelf-Defending Transaction System (L6)\n\nPHILOSOPHY (Phase-2.2 Upgrade)\n------------------------------\nThis module doesn't just BLOCK dangerous patterns — it GUIDES engineers\ninto correct design by construction. Prevention acts BEFORE code is written.\n\nThe root cause class is NOT ""FOR UPDATE"". The root cause is:\n    ""Transactional intent is not explicit in feature design.""\n\nThis module solves that by requiring:\n1. Engineers DECLARE intent before they can write logic\n2. Only BLESSED primitives al",,NEEDS_CLASSIFICATION,ITERATION_1,Infrastructure,TRANSFER
529,app/infra/transaction_examples.py,INTERNAL,analytics,L6,app/houseofcards/internal/analytics/drivers/transaction_examples.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Golden examples for self-defending transaction patterns\n# Callers: Reference for engineers implementing lock-safe operations\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-264 (Phase-2.2 Self-Defending Transactions with Intent)\n\n""""""\nTransaction Intent Golden Examples\n\nThis module contains REFERENCE IMPLEMENTATIONS for proper use of",\nTransaction Intent Golden Examples\n\nThis module contains REFERENCE IMPLEMENTATIONS for proper use of\nthe TransactionIntent system. Use these as templates when implementing\nnew lock-safe operations.\n\nPHILOSOPHY (Phase-2.2)\n----------------------\nThese examples demonstrate the correct design pattern:\n\n1. DECLARE intent before implementation\n2. Use BLESSED primitives only\n3. Make dangerous states STRUCTURALLY IMPOSSIBLE\n\nPATTERN SUMMARY\n---------------\n\n| Intent          | First Parameter       | ,,NEEDS_CLASSIFICATION,ITERATION_1,Infrastructure,TRANSFER
530,app/integrations/__init__.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: M25 Pillar Integration — internal domain coordination\n# Callers: API (L2), Services (L4), Jobs (L5)\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-129 (M25 Pillar Integration Blueprint)\n#\n# HISTORICAL NOTE (2025-12-30, ARCH-GOV-007 Audit):\n# Directory named ""integrations"" for historical reasons (M25 ""pillar integration"").\n# This is NOT L3 (Boundary Adapter). This IS L4 (Domain Engine).\n# The name refers to internal domain coordination, not external service adapters.",Get the singleton M25 integration dispatcher.\n\nCreates and configures the dispatcher on first call:\n- Connects to Redis for pub/sub\n- Configures database session factory\n- Registers all 5 bridges\n\nReturns:\n    IntegrationDispatcher: Configured dispatcher instance,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
531,app/integrations/bridges.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/bridges.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Integration bridge abstractions\n# Callers: services\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Integration System\n\n""""""\nM25 Integration Bridges\n\nFive bridges connecting the three pillars:",\nM25 Integration Bridges\n\nFive bridges connecting the three pillars:\n1. Incident → Failure Catalog (with confidence bands)\n2. Pattern → Recovery (with template/generated distinction)\n3. Recovery → Policy (with shadow mode)\n4. Policy → CARE Routing (with guardrails)\n5. Loop Status → Console (with narrative artifacts)\n\nFROZEN: 2025-12-23\nDo NOT modify loop mechanics without explicit approval.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Integrations,TRANSFER
532,app/integrations/cost_bridges.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/cost_bridges.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Cost-related integration bridges\n# Callers: cost services\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Cost Integration\n\n""""""\nM27 Cost Loop Integration Bridges\n\nWires Cost Intelligence into M25 Integration Loop:",\nM27 Cost Loop Integration Bridges\n\nWires Cost Intelligence into M25 Integration Loop:\n- C1: Cost Anomaly → Incident\n- C2: Cost Pattern → Failure Catalog\n- C3: Cost Recovery Generator\n- C4: Cost Policy Generator\n- C5: Cost Routing Adjuster\n\nThe Invariant: Every cost anomaly enters the loop.\nEvery loop completion reduces future cost risk.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Integrations,TRANSFER
533,app/integrations/cost_safety_rails.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/cost_safety_rails.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Cost safety rail enforcement\n# Callers: cost services, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Cost Safety\n\n""""""\nM27 Cost Safety Rails\n=====================\n","\nM27 Cost Safety Rails\n=====================\n\nPer-tenant auto-apply caps and blast-radius limits.\n\nTHE INVARIANT:\n    No automatic cost action may exceed:\n    - Per-tenant daily cap\n    - Per-org daily cap\n    - Blast-radius scope limits\n\nGPT Analysis Warning (2025-12-23):\n    ""Confidence >=90% can auto-apply, Zero confirmations required in some paths.\n     Once customers are live, you'll need:\n     - Per-tenant auto-apply caps\n     - Blast-radius limits (per org/day)""\n",,NEEDS_CLASSIFICATION,ITERATION_1,Integrations,TRANSFER
534,app/integrations/cost_snapshots.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/cost_snapshots.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Cost snapshot management\n# Callers: cost services\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Cost System\n\n""""""M27 Cost Snapshots - Deterministic Enforcement Barrier\n\nThis module provides the snapshot layer between async cost ingestion\nand synchronous anomaly detection.","M27 Cost Snapshots - Deterministic Enforcement Barrier\n\nThis module provides the snapshot layer between async cost ingestion\nand synchronous anomaly detection.\n\nTHE INVARIANT:\n  Anomaly detection reads ONLY from complete snapshots, never from live data.\n\nArchitecture:\n  cost_records (streaming, async)\n         ↓\n  SnapshotComputer.compute_snapshot()\n         ↓\n  cost_snapshots (status='complete')\n         ↓\n  CostAnomalyDetector.evaluate_from_snapshot()\n\nUsage:\n  # Scheduled job (e.g., every hou",,NEEDS_CLASSIFICATION,ITERATION_1,Integrations,TRANSFER
535,app/integrations/dispatcher.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/dispatcher.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Integration event dispatcher\n# Callers: workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: Event Dispatch\n\n""""""\nM25 Integration Dispatcher\n\nOrchestrates the feedback loop with:",\nM25 Integration Dispatcher\n\nOrchestrates the feedback loop with:\n- Event-driven architecture (Redis pub/sub + PostgreSQL durability)\n- Failure state handling\n- Human checkpoint integration\n- Guardrail enforcement\n\nFROZEN: 2025-12-23\nDo NOT modify loop mechanics without explicit approval.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Integrations,TRANSFER
536,app/integrations/events.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/events.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Integration event definitions\n# Callers: integrations/*\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Event System\n\n""""""\nM25 Integration Loop Events\n\n# =============================================================================",\nM25 Integration Loop Events\n\n# =============================================================================\n# M25_FROZEN - DO NOT MODIFY\n# =============================================================================\n# Any changes here require explicit M25 reopen approval.\n# Changes invalidate all prior graduation evidence.\n# See PIN-140 for freeze rationale.\n# =============================================================================\n\nEnhanced with:\n- Confidence bands (strong/weak/novel) i,,NEEDS_CLASSIFICATION,ITERATION_1,Integrations,TRANSFER
537,app/integrations/graduation_engine.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/graduation_engine.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker (called by L5)\n#   Execution: sync (REQUIRED - async forbidden)\n# Role: Agent graduation evaluation domain logic (pure computation)\n# Callers: graduation_evaluator.py (L5)\n# Allowed Imports: L4 only (stdlib, dataclasses, typing, enum)\n# Forbidden Imports: L5, L6, L7, L8\n# Reference: PIN-256 Phase E FIX-01\n#\n# Extraction Source: Phase E purity enforcement\n# Semantic Promotion: Graduation level computation, gate evaluation, degradation detection\n# BLCA Violations Resolved: Async/DB methods removed from L4\n#","\nM25 Graduation Engine\n\nCRITICAL: This module ensures graduation is DERIVED, not DECLARED.\n\nGraduation is:\n- Computed from evidence (not manually set)\n- Re-evaluated periodically (not one-time)\n- Downgradable when evidence regresses\n- Separate from simulation state\n- Tied to real capability gates\n\n""A badge you flip once and forget"" is worthless.\nGraduation must be continuously earned.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
538,app/integrations/learning_proof.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/learning_proof.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Learning proof generation\n# Callers: learning workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Learning System\n\n""""""\nM25 Learning Proof System\n\nThis module provides the evidence that the integration loop actually LEARNS,","\nM25 Learning Proof System\n\nThis module provides the evidence that the integration loop actually LEARNS,\nnot just executes. It tracks:\n\n1. PREVENTION PROOF - Did a policy actually prevent a second incident?\n2. REGRET TRACKING - Did a policy cause harm? Auto-demote if so.\n3. ADAPTIVE CONFIDENCE - Calibrate thresholds based on outcomes, not assumptions.\n4. CHECKPOINT PRIORITY - Make human decisions tractable, not noisy.\n\n""A system that can safely attempt to improve itself"" is different from\n""A sys",,NEEDS_CLASSIFICATION,ITERATION_1,Integrations,TRANSFER
539,app/integrations/prevention_contract.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/drivers/prevention_contract.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Prevention contract enforcement\n# Callers: policy engine, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Prevention System\n\n""""""\nM25 Prevention Contract Enforcement\n\n# =============================================================================","\nM25 Prevention Contract Enforcement\n\n# =============================================================================\n# M25_FROZEN - DO NOT MODIFY\n# =============================================================================\n# Any changes here require explicit M25 reopen approval.\n# Changes invalidate all prior graduation evidence.\n# See PIN-140 for freeze rationale.\n# PREVENTION_CONTRACT_VERSION = ""1.0.0""\n# =============================================================================\n\nFrom PI",,NEEDS_CLASSIFICATION,ITERATION_1,Integrations,TRANSFER
540,app/jobs/__init__.py,INTERNAL,incidents,L5,app/houseofcards/internal/incidents/engines/__init__.py,"# M9 Background Jobs\n""""""\nBackground jobs for failure analytics and aggregation.\n\nJobs:\n- failure_aggregation: Aggregate unmatched failures for catalog expansion\n""""""\n\n# =============================================================================\n# STRUCTURAL NOTE (Phase 2):\n# =============================================================================\n# This module contains job definitions that are NOT currently scheduled.\n# No scheduler is wired. These are either:\n# - Future work (incomplete)\n# - Dead code (to be removed in future phase)",\nBackground jobs for failure analytics and aggregation.\n\nJobs:\n- failure_aggregation: Aggregate unmatched failures for catalog expansion\n,,NEEDS_CLASSIFICATION,ITERATION_1,In jobs/ dir,TRANSFER
541,app/jobs/failure_aggregation.py,INTERNAL,incidents,L5,app/houseofcards/internal/incidents/engines/failure_aggregation.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler\n#   Execution: async\n# Role: Failure aggregation background job (orchestration only)\n# Callers: scheduler\n# Allowed Imports: L4, L6\n# Domain Engine: failure_classification_engine.py (L4)\n# Reference: M9 Failure System, PIN-256 Phase E FIX-01\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Uploads aggregated patterns to Cloudflare R2 and sends alerts",Fetch unmatched failures from database.\n\nArgs:\n    days: Look back period in days\n    min_occurrences: Minimum occurrences to include\n\nReturns:\n    List of aggregated failure patterns,,NEEDS_CLASSIFICATION,ITERATION_1,In jobs/ dir,TRANSFER
542,app/jobs/failure_classification_engine.py,INTERNAL,incidents,L5,app/houseofcards/internal/incidents/engines/failure_classification_engine.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker (called by L5)\n#   Execution: sync (REQUIRED - async forbidden)\n# Role: Failure pattern classification and aggregation logic\n# Callers: failure_aggregation.py (L5)\n# Allowed Imports: L4 only (stdlib, dataclasses, typing, enum, other L4 engines)\n# Forbidden Imports: L5, L6, L7, L8\n# Reference: PIN-256 Phase E FIX-01\n#\n# Extraction Source: app/jobs/failure_aggregation.py\n# Semantic Promotion: Failure signature computation, pattern aggregation, summary statistics\n# BLCA Violations Resolved: L5 domain classification authority\n#",Input: Raw failure pattern from database query.,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
543,app/jobs/graduation_evaluator.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/graduation_evaluator.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler\n#   Execution: async\n# Role: Agent graduation evaluation job (orchestration only)\n# Callers: scheduler\n# Allowed Imports: L4, L6\n# Domain Engine: graduation_engine.py (L4)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-256 Phase E FIX-01\n#\n# GOVERNANCE NOTE: L5 owns all DB operations.\n# L4 graduation_engine.py provides pure domain logic only.\n# This L5 file:",CLI entry point for manual runs.,,NEEDS_CLASSIFICATION,ITERATION_1,In jobs/ dir,TRANSFER
544,app/jobs/storage.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/storage.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler\n#   Execution: async\n# Role: Storage maintenance jobs\n# Callers: scheduler\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: Storage System\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Uploads files to Cloudflare R2 with exponential backoff","Load R2 credentials from HashiCorp Vault.\n\nReturns dict with R2_ACCESS_KEY_ID, R2_SECRET_ACCESS_KEY, etc.\nFalls back to environment variables if Vault unavailable.",,NEEDS_CLASSIFICATION,ITERATION_1,In jobs/ dir,TRANSFER
545,app/learning/__init__.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/__init__.py,"""""""\nC5 Learning Module - Advisory Learning from Historical Outcomes.\n\nThis module MUST NOT be imported by:\n- app/optimization/killswitch.py\n- app/optimization/coordinator.py (core paths)\n\nIt MAY be imported by:\n- app/api/learning.py (for approval endpoints)\n- app/optimization/metrics.py (for learning metrics)\n\nCore Principle:\n    Learning observes rollbacks. Humans interpret. Existing envelopes apply.\n\nReference: PIN-232, C5_S1_LEARNING_SCENARIO.md","\nC5 Learning Module - Advisory Learning from Historical Outcomes.\n\nThis module MUST NOT be imported by:\n- app/optimization/killswitch.py\n- app/optimization/coordinator.py (core paths)\n\nIt MAY be imported by:\n- app/api/learning.py (for approval endpoints)\n- app/optimization/metrics.py (for learning metrics)\n\nCore Principle:\n    Learning observes rollbacks. Humans interpret. Existing envelopes apply.\n\nReference: PIN-232, C5_S1_LEARNING_SCENARIO.md\n",,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/domain/__init__.py,SKIP_INIT_COLLISION
546,app/learning/config.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/config.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Learning system configuration\n# Callers: learning/*\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: C5 Learning\n\n""""""\nC5 Learning Configuration.\n\nCRITICAL: LEARNING_ENABLED defaults to False.","\nC5 Learning Configuration.\n\nCRITICAL: LEARNING_ENABLED defaults to False.\nLearning must be explicitly enabled by operator.\n\nReference: CI-C5-5, PIN-232\n",,NEEDS_CLASSIFICATION,ITERATION_1,Learning logic,TRANSFER
547,app/learning/s1_rollback.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/s1_rollback.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker|scheduler\n#   Execution: sync\n# Role: S1 rollback learning and suggestions\n# Callers: workers, scheduled jobs\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: C5 S1 Learning\n\n""""""\nC5-S1: Learning from Rollback Frequency.\n\nThis module observes envelope rollback patterns and produces","\nC5-S1: Learning from Rollback Frequency.\n\nThis module observes envelope rollback patterns and produces\nadvisory suggestions for humans to consider.\n\nCRITICAL BOUNDARIES (CI-C5-3, CI-C5-6):\n- This module MUST NOT import kill-switch modules\n- This module MUST NOT import coordinator core paths\n- This module ONLY reads from coordination audit records (metadata)\n\nADVISORY ONLY (CI-C5-1):\n- All outputs are suggestions, never directives\n- No direct envelope modification\n- No coordinator.apply() calls\n",,NEEDS_CLASSIFICATION,ITERATION_1,Learning logic,TRANSFER
548,app/learning/suggestions.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/suggestions.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Learning-based suggestion generation\n# Callers: API routes, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: C5 Learning\n\n""""""\nC5 Learning Suggestions Model.\n\nAll suggestions are:","\nC5 Learning Suggestions Model.\n\nAll suggestions are:\n- Advisory only (CI-C5-1)\n- Versioned and immutable (CI-C5-4)\n- Require human approval (CI-C5-2)\n\nReference: C5_S1_LEARNING_SCENARIO.md, C5_S1_ACCEPTANCE_CRITERIA.md\n",,NEEDS_CLASSIFICATION,ITERATION_1,Learning logic,TRANSFER
549,app/learning/tables.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/tables.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Learning system database tables\n# Callers: learning/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: C5 Learning\n\n""""""\nC5 Learning Table Boundaries.\n\nLearning MUST operate on metadata tables only.","\nC5 Learning Table Boundaries.\n\nLearning MUST operate on metadata tables only.\nIt MUST NOT access runtime, coordination, or kill-switch tables.\n\nReference: CI-C5-3, PIN-232, C5_S1_CI_ENFORCEMENT.md\n",,NEEDS_CLASSIFICATION,ITERATION_1,Learning logic,TRANSFER
550,app/logging_config.py,INTERNAL,logs,L6,app/houseofcards/internal/logs/drivers/logging_config.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Structured JSON logging configuration\n# Callers: main.py, all modules via logging\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Infrastructure\n\nimport json\nimport logging\nimport sys\nfrom datetime import datetime, timezone",Custom JSON formatter for structured logging.,,NEEDS_CLASSIFICATION,ITERATION_1,Logging configuration,TRANSFER
551,app/main.py,INTERNAL,agent,L2,app/houseofcards/api/internal/agent/main.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: sync (request-response)\n# Role: FastAPI application entry point, route registration, middleware setup\n# Callers: uvicorn, gunicorn, docker entrypoint\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5 (no direct worker imports)\n# Reference: Core Application\n\nimport asyncio\nimport json\nimport os\nimport uuid",Request to retry a failed worker run (PB-S1 compliant).,,NEEDS_CLASSIFICATION,ITERATION_1,FastAPI main,TRANSFER
552,app/memory/__init__.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/__init__.py,"# NOVA Memory Module\n# Provides memory storage and retrieval for agent context\n\nfrom .retriever import (\n    MemoryRetriever,\n    get_retriever,\n)\nfrom .store import (\n    MemoryStore,\n    PostgresMemoryStore,\n    get_memory_store,\n)\n\n__all__ = [\n    ""MemoryStore"",",,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/config/__init__.py,SKIP_INIT_COLLISION
553,app/memory/drift_detector.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/drift_detector.py,"""""""\nDrift Detection Service - M7 Implementation\n\nDetects determinism drift between baseline and memory-enabled runs:\n- Compare execution traces\n- Identify divergence points\n- Track drift metrics\n- Generate reports\n\nUsage:\n    from app.memory.drift_detector import DriftDetector\n\n    detector = DriftDetector()\n    result = detector.compare(baseline_trace, memory_trace)\n    if result.has_drift:","\nDrift Detection Service - M7 Implementation\n\nDetects determinism drift between baseline and memory-enabled runs:\n- Compare execution traces\n- Identify divergence points\n- Track drift metrics\n- Generate reports\n\nUsage:\n    from app.memory.drift_detector import DriftDetector\n\n    detector = DriftDetector()\n    result = detector.compare(baseline_trace, memory_trace)\n    if result.has_drift:\n        print(f""Drift detected: {result.divergence_point}"")\n",,NEEDS_CLASSIFICATION,ITERATION_1,Memory,TRANSFER
554,app/memory/embedding_cache.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/embedding_cache.py,"# Embedding Cache Layer\n""""""\nRedis-based cache for embedding results.\nPIN-047: P3 - Embedding Cache Layer\n\nReduces API costs and latency by caching embedding results.\nCache key: sha256(text + model) truncated to 32 chars\n\nFeatures:\n- Configurable TTL (default 7 days)\n- Cache hit/miss metrics\n- Automatic serialization of vectors\n- Provider-aware caching (different models = different keys)\n""""""\n",\nRedis-based cache for embedding results.\nPIN-047: P3 - Embedding Cache Layer\n\nReduces API costs and latency by caching embedding results.\nCache key: sha256(text + model) truncated to 32 chars\n\nFeatures:\n- Configurable TTL (default 7 days)\n- Cache hit/miss metrics\n- Automatic serialization of vectors\n- Provider-aware caching (different models = different keys)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Memory,TRANSFER
555,app/memory/embedding_metrics.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/embedding_metrics.py,"# Embedding Metrics for Memory Vector Store\n""""""\nPrometheus metrics for embedding operations monitoring.\n\nTracks:\n- Backfill progress\n- API calls to embedding providers\n- Latency and errors\n- Vector query performance\n""""""\n\nimport os\n\nfrom app.utils.metrics_helpers import get_or_create_counter, get_or_create_gauge, get_or_create_histogram\n",\nPrometheus metrics for embedding operations monitoring.\n\nTracks:\n- Backfill progress\n- API calls to embedding providers\n- Latency and errors\n- Vector query performance\n,,NEEDS_CLASSIFICATION,ITERATION_1,Memory,TRANSFER
556,app/memory/iaec.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/iaec.py,"# Instruction-Aware Embedding Composer (IAEC) v3.2\n""""""\nDeterministic embedding combiner with 4-slot architecture:\n- Instruction slot: encodes task type (summarize, extract, analyze, etc.)\n- Query slot: encodes user intent\n- Context slot: encodes retrieved/system context\n- Temporal slot: encodes version/epoch for drift control\n- Policy slot: encodes governance hierarchy\n\nv3.2 Improvements (Production Scale Ready):\n- TRANSFORM DAG MANAGER: Canonical paths, graph pruning, transitive collapsing\n- CORRECTION COOLDOWN: Monotonic correction policy prevents oscillation loops\n- POLICY FOLDING SOFTMAX: Normalized weights for deep stacks\n- WHITENING VERSIONING: Declared in every IAEC output for audit replay\n","\nDeterministic embedding combiner with 4-slot architecture:\n- Instruction slot: encodes task type (summarize, extract, analyze, etc.)\n- Query slot: encodes user intent\n- Context slot: encodes retrieved/system context\n- Temporal slot: encodes version/epoch for drift control\n- Policy slot: encodes governance hierarchy\n\nv3.2 Improvements (Production Scale Ready):\n- TRANSFORM DAG MANAGER: Canonical paths, graph pruning, transitive collapsing\n- CORRECTION COOLDOWN: Monotonic correction policy prevent",,NEEDS_CLASSIFICATION,ITERATION_1,Memory,TRANSFER
557,app/memory/memory_service.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/memory_service.py,"""""""\nMemory Service - M7 Implementation\n\nProvides memory integration with:\n- Redis caching layer with fail-open behavior\n- Database persistence\n- Audit logging\n- Prometheus metrics\n- Update rules engine integration\n\nUsage:\n    from app.memory.memory_service import MemoryService\n\n    service = MemoryService(db_session_factory, redis_client)\n    memory = await service.get(""agent-123"", ""key"")","\nMemory Service - M7 Implementation\n\nProvides memory integration with:\n- Redis caching layer with fail-open behavior\n- Database persistence\n- Audit logging\n- Prometheus metrics\n- Update rules engine integration\n\nUsage:\n    from app.memory.memory_service import MemoryService\n\n    service = MemoryService(db_session_factory, redis_client)\n    memory = await service.get(""agent-123"", ""key"")\n    await service.set(""agent-123"", ""key"", {""data"": ""value""})\n",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Platform Substrate (Memory),TRANSFER
558,app/memory/retriever.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/retriever.py,"# Memory Retriever\n# Retrieves and formats memories for planner context\n\nimport logging\nfrom typing import Any, Dict, List, Optional\n\nfrom .store import PostgresMemoryStore, get_memory_store\n\nlogger = logging.getLogger(""nova.memory.retriever"")\n\n\nclass MemoryRetriever:\n    """"""Retrieves memories and builds context for planners.\n\n    Combines recent memories, relevant searches, and run history","Retrieves memories and builds context for planners.\n\nCombines recent memories, relevant searches, and run history\nto build a context summary for planning.",,NEEDS_CLASSIFICATION,ITERATION_1,Memory,TRANSFER
559,app/memory/store.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/memory_store.py,"# Memory Store\n# Provides storage interface for agent memories\n\nimport logging\nfrom typing import Any, Dict, List, Optional, Protocol, cast\n\nfrom sqlmodel import Session, desc, select\n\nfrom ..db import Memory, engine\n\nlogger = logging.getLogger(""nova.memory.store"")\n\n\nclass MemoryStore(Protocol):\n    """"""Protocol for memory storage backends.""""""",Protocol for memory storage backends.,,NEEDS_CLASSIFICATION,ITERATION_1,Memory,TRANSFER
560,app/memory/update_rules.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/update_rules.py,"""""""\nMemory Update Rules Engine - M7 Implementation\n\nProvides rule-based transformations for memory updates:\n- Schema validation\n- Data sanitization\n- Transformation rules\n- Merge strategies\n\nUsage:\n    from app.memory.update_rules import UpdateRulesEngine\n\n    engine = UpdateRulesEngine()\n    engine.add_rule(""config:*"", schema=ConfigSchema, merge=""deep"")\n    transformed = await engine.apply(""tenant"", ""config:rate_limits"", data)","\nMemory Update Rules Engine - M7 Implementation\n\nProvides rule-based transformations for memory updates:\n- Schema validation\n- Data sanitization\n- Transformation rules\n- Merge strategies\n\nUsage:\n    from app.memory.update_rules import UpdateRulesEngine\n\n    engine = UpdateRulesEngine()\n    engine.add_rule(""config:*"", schema=ConfigSchema, merge=""deep"")\n    transformed = await engine.apply(""tenant"", ""config:rate_limits"", data)\n",,NEEDS_CLASSIFICATION,ITERATION_1,Memory,TRANSFER
561,app/memory/vector_store.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/vector_store.py,"# Vector Memory Store with pgvector\n""""""\npgvector-backed memory store for semantic search.\n\nFeatures:\n- Embeddings via OpenAI or Anthropic (Voyage)\n- HNSW index for fast approximate nearest neighbor search\n- Hybrid search (vector + keyword fallback)\n- Async support\n\nUsage:\n    from app.memory.vector_store import get_vector_memory_store\n\n    store = get_vector_memory_store()\n","\npgvector-backed memory store for semantic search.\n\nFeatures:\n- Embeddings via OpenAI or Anthropic (Voyage)\n- HNSW index for fast approximate nearest neighbor search\n- Hybrid search (vector + keyword fallback)\n- Async support\n\nUsage:\n    from app.memory.vector_store import get_vector_memory_store\n\n    store = get_vector_memory_store()\n\n    # Store with auto-embedding\n    memory_id = await store.store(\n        agent_id=""agent-123"",\n        text=""Important information about the project"",\n    )\n\n  ",,NEEDS_CLASSIFICATION,ITERATION_1,Memory,TRANSFER
562,app/metrics.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/metrics.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time, runtime increment\n#   Execution: sync\n# Role: Prometheus metrics definitions and multiprocess support\n# Callers: All modules that emit metrics\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Observability\n\n""""""\nPrometheus metrics for NOVA Agent Manager.\n\nSupports multiprocess mode via PROMETHEUS_MULTIPROC_DIR environment variable.","\nPrometheus metrics for NOVA Agent Manager.\n\nSupports multiprocess mode via PROMETHEUS_MULTIPROC_DIR environment variable.\nWhen set, uses a shared directory for metric aggregation across processes.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Metrics; Domain uncertain,TRANSFER
563,app/middleware/__init__.py,INTERNAL,account,L5,app/houseofcards/internal/account/engines/__init__.py,"# NOVA Middleware\n# FastAPI middleware components\n\nfrom .tenancy import TenancyMiddleware, get_tenant_id\nfrom .tenant import (\n    TenantContext,\n    TenantMiddleware,\n    clear_tenant_context,\n    ensure_tenant_access,\n    get_tenant_context,\n    require_tenant,\n    require_tenant_context,\n    set_tenant_context,\n    tenant_scoped_query,\n)",,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/auth/__init__.py,SKIP_INIT_COLLISION
564,app/middleware/rate_limit.py,INTERNAL,policies,L2-Infra,app/houseofcards/api/infrastructure/rate_limit.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api (every request)\n#   Execution: sync\n# Role: Rate limiting middleware\n# Callers: main.py middleware chain\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Security\n\n""""""\nRate Limit Middleware\nM8 Deliverable: JWT-based rate limiting per tenant/tier\n","\nRate Limit Middleware\nM8 Deliverable: JWT-based rate limiting per tenant/tier\n\nEnforces per-tenant rate limits based on user's rate_limit_tier claim from JWT.\nUses Redis (Upstash) for distributed rate limiting with fixed-window algorithm.\n\nTiers:\n- free: 60 requests/minute\n- dev: 300 requests/minute\n- pro: 1200 requests/minute\n- unlimited: no practical limit\n\nUsage:\n    from app.middleware.rate_limit import rate_limit_dependency\n\n    @router.post(""/simulate"")\n    async def simulate(\n        req",,NEEDS_CLASSIFICATION,ITERATION_1,Middleware,TRANSFER
565,app/middleware/slow_requests.py,INTERNAL,logs,L2-Infra,app/houseofcards/api/infrastructure/slow_requests.py,"# Layer: L2 — Product APIs (Middleware)\n# Product: system-wide\n# Temporal:\n#   Trigger: external (HTTP)\n#   Execution: sync (request-response)\n# Role: Diagnostic middleware for slow request detection\n# Callers: FastAPI middleware stack\n# Allowed Imports: stdlib only\n# Forbidden Imports: app.*, domain logic\n# Reference: PIN-443 (Cold-Start Observability)\n\n""""""\nSlow Request Diagnostic Middleware (PIN-443)\n\nLogs warnings for requests exceeding a configurable threshold.","\nSlow Request Diagnostic Middleware (PIN-443)\n\nLogs warnings for requests exceeding a configurable threshold.\nUsed to diagnose VPS hangs (e.g., /openapi.json cold generation).\n\nThis is OBSERVABILITY ONLY:\n- No impact on request semantics\n- No impact on auth, RBAC, or Evidence Plane\n- Zero cost when disabled\n",,NEEDS_CLASSIFICATION,ITERATION_1,Middleware,TRANSFER
566,app/middleware/tenancy.py,INTERNAL,logs,L2-Infra,app/houseofcards/api/infrastructure/tenancy.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api (every request)\n#   Execution: sync\n# Role: Tenant context injection middleware\n# Callers: main.py middleware chain\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Security\n\n# Tenancy Middleware\n# Enforces tenant_id on all requests and provides tenant context\n\nimport logging",Middleware to enforce multi-tenancy on all requests.\n\nExtracts tenant_id from header and attaches to request.state.\nRejects requests without valid tenant_id (except public paths).,,NEEDS_CLASSIFICATION,ITERATION_1,Middleware,TRANSFER
567,app/middleware/tenant.py,INTERNAL,account,L2-Infra,app/houseofcards/api/infrastructure/tenant.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api (every request)\n#   Execution: sync\n# Role: Tenant isolation enforcement middleware\n# Callers: main.py middleware chain\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Security\n\n# Tenant Context Middleware (M6)\n""""""\nTenant context propagation for multi-tenancy isolation.\n",\nTenant context propagation for multi-tenancy isolation.\n\nThis middleware:\n1. Extracts tenant_id from request headers/tokens\n2. Propagates tenant context through the request lifecycle\n3. Ensures tenant-scoped queries\n4. Provides audit context for status_history\n,,NEEDS_CLASSIFICATION,ITERATION_1,Middleware,TRANSFER
568,app/models/__init__.py,INTERNAL,models,L7,app/models/__init__.py,"# AOS Models Package\n""""""\nSQLAlchemy models for async database access.\n\nThis package contains pure SQLAlchemy models (not SQLModel) for use with\nasync sessions. These models mirror the SQLModel definitions in db.py\nbut are designed for async operations.\n""""""\n\nfrom app.models.contract import (\n    TERMINAL_STATES,\n    VALID_TRANSITIONS,\n    AuditVerdict,\n    ContractApproval,\n    ContractCreate,",\nSQLAlchemy models for async database access.\n\nThis package contains pure SQLAlchemy models (not SQLModel) for use with\nasync sessions. These models mirror the SQLModel definitions in db.py\nbut are designed for async operations.\n,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
569,app/models/alert_config.py,INTERNAL,models,L7,app/models/alert_config.py,"# Layer: L4 — Domain Engine\n# Product: AI Console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Configure alerting behavior for near-threshold events\n# Callers: services/alert_emitter.py, api/policy_alerts.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-007\n\n""""""\nAlert Configuration Model\n\nConfigures how and when alerts are sent for threshold events:","\nAlert Configuration Model\n\nConfigures how and when alerts are sent for threshold events:\n- Near-threshold percentage trigger\n- Notification channels (UI, webhook)\n- Alert throttling\n\nAlert flow:\n1. ThresholdSignal created (NEAR or BREACH)\n2. AlertEmitter checks AlertConfig\n3. If enabled and not throttled, send via configured channels\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
570,app/models/audit_ledger.py,INTERNAL,models,L7,app/models/audit_ledger.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Audit Ledger model for Logs domain (PIN-413)\n# Callers: runtime_projections/logs/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-413 Domain Design — Overview & Logs (CORRECTED)\n\n""""""\nAudit Ledger Model (PIN-413 CORRECTED)\n\nSCOPE: Logs domain ONLY. Not Overview.",\nAudit Ledger Model (PIN-413 CORRECTED)\n\nSCOPE: Logs domain ONLY. Not Overview.\n\nAuditLedger is the immutable governance action log:\n- Records governance-relevant actions taken by actors\n- APPEND-ONLY (enforced by DB trigger)\n- Only canonical events create rows\n\nARCHITECTURAL RULE:\n- Overview is PROJECTION-ONLY (no owned tables)\n- AuditLedger belongs to Logs domain\n,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
571,app/models/contract.py,INTERNAL,models,L7,app/models/contract.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: System Contract database models\n# Callers: governance/*, L4 domain services\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-291, SYSTEM_CONTRACT_OBJECT.md, part2-design-v1\n\n""""""\nSystem Contract Models (Part-2 CRM Workflow)\n\nModels for persisting System Contracts - the first stateful component",\nSystem Contract Models (Part-2 CRM Workflow)\n\nModels for persisting System Contracts - the first stateful component\nof the Part-2 governance workflow.\n\nContract Properties:\n- STATE MACHINE: Explicit state transitions with invariants\n- IMMUTABLE POST-APPROVED: Terminal and approved states cannot revert\n- AUDIT ANCHORED: Every transition is traceable\n- GOVERNANCE BOUND: Created only via validated proposals\n\nInvariants:\n- CONTRACT-001: Status transitions must follow state machine\n- CONTRACT-002: A,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
572,app/models/costsim_cb.py,INTERNAL,models,L7,app/models/costsim_cb.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: CostSim circuit breaker models\n# Callers: costsim/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: CostSim\n\n# CostSim Circuit Breaker Models (Async SQLAlchemy)\n""""""\nPure SQLAlchemy models for async database access.\n",\nPure SQLAlchemy models for async database access.\n\nThese models are used with AsyncSession for non-blocking DB operations.\nThey mirror the SQLModel definitions in db.py but are designed for\nasync use with SQLAlchemy 2.0+.\n,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
573,app/models/cus_models.py,INTERNAL,models,L7,app/models/cus_models.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Customer integration data models\n# Callers: cus_* services, cus_* APIs\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md\n\n""""""Customer Integrations Models\n\nPURPOSE:\n    SQLModel ORM classes for customer LLM integrations. These models represent",Customer Integrations Models\n\nPURPOSE:\n    SQLModel ORM classes for customer LLM integrations. These models represent\n    the control plane (integrations) and data plane (usage telemetry) for\n    customer-owned LLM providers.\n\nMODELS:\n    - CusIntegration: Customer LLM provider configuration with credentials and limits\n    - CusLLMUsage: Individual LLM call telemetry record\n    - CusUsageDaily: Pre-aggregated daily usage statistics\n\nSEMANTIC:\n    - CusIntegration: CONTROL PLANE - defines what in,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
574,app/models/execution_envelope.py,INTERNAL,models,L7,app/models/execution_envelope.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Execution envelope models for implicit authority hardening\n# Callers: auth/execution_envelope.py, worker/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-330\n\n""""""\nExecution Envelope Database Models - PIN-330 Implicit Authority Hardening\n\nProvides append-only storage for execution envelopes.",\nExecution Envelope Database Models - PIN-330 Implicit Authority Hardening\n\nProvides append-only storage for execution envelopes.\n\nCONSTRAINTS:\n- Records are immutable once created\n- No UPDATE or DELETE operations allowed\n- Failure to write MUST NOT block execution\n,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
575,app/models/export_bundles.py,INTERNAL,models,L7,app/models/export_bundles.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Structured export bundle models for SOC2, evidence, and executive debrief\n# Callers: services/export_bundle_service.py, services/pdf_renderer.py\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: BACKEND_REMEDIATION_PLAN.md GAP-008\n\n""""""\nExport Bundle Models\n\nProvides structured data models for exporting incident evidence,","\nExport Bundle Models\n\nProvides structured data models for exporting incident evidence,\nSOC2 compliance reports, and executive debriefs.\n\nKey Bundle Types:\n1. EvidenceBundle - Generic evidence export with full trace data\n2. SOC2Bundle - SOC2-compliant export with control objectives\n3. ExecutiveDebriefBundle - Non-technical summary for leadership\n\nRemediation: GAP-008 (Structured Export Bundles)\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
576,app/models/external_response.py,INTERNAL,models,L7,app/models/external_response.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: External response data models (DB tables)\n# Callers: L3 adapters (write raw), L4 engines (read/interpret)\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-256 Phase E FIX-04\n\n""""""\nExternal Response Models (Phase E FIX-04)\n\nModels for persisting raw external API responses with explicit interpretation","\nExternal Response Models (Phase E FIX-04)\n\nModels for persisting raw external API responses with explicit interpretation\nownership. L3 adapters write raw data; L4 engines interpret.\n\nPhase E Contract:\n- L3 adapters write raw responses to L6\n- L4 engines read raw, interpret, write interpreted_value\n- L5/L2 consumers read L4's interpretation only\n- No implicit interpretation in adapters\n\nViolations Resolved: VIOLATION-007, VIOLATION-008, VIOLATION-009, VIOLATION-010\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
577,app/models/feedback.py,INTERNAL,models,L7,app/models/feedback.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Feedback data models\n# Callers: feedback API, services\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Feedback System\n\n""""""\nPattern Feedback Models (PB-S3)\n\nModels for storing observed patterns WITHOUT modifying execution history.",\nPattern Feedback Models (PB-S3)\n\nModels for storing observed patterns WITHOUT modifying execution history.\n\nPB-S3 Contract:\n- Feedback observes but never mutates\n- Provenance references runs (read-only)\n- No execution data modification allowed\n,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
578,app/models/governance.py,INTERNAL,models,L7,app/models/governance.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Governance signal data models (DB tables)\n# Callers: governance/*, L4 orchestrators, L5 executors\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-256 Phase E FIX-03\n\n""""""\nGovernance Signal Models (Phase E FIX-03)\n\nModels for persisting governance decisions from L7 (BLCA, CI) to L6,","\nGovernance Signal Models (Phase E FIX-03)\n\nModels for persisting governance decisions from L7 (BLCA, CI) to L6,\nmaking governance influence explicit and queryable by L4/L5.\n\nPhase E Contract:\n- L7 writes governance signals to L6\n- L4 reads signals before domain decisions\n- L5 reads signals before execution\n- No implicit governance influence\n\nViolations Resolved: VIOLATION-004, VIOLATION-005\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
579,app/models/governance_job.py,INTERNAL,models,L7,app/models/governance_job.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Governance Job database models\n# Callers: governance/*, L4 domain services\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-292, PART2_CRM_WORKFLOW_CHARTER.md, part2-design-v1\n\n""""""\nGovernance Job Models (Part-2 CRM Workflow)\n\nModels for persisting Governance Jobs - the execution tracking component","\nGovernance Job Models (Part-2 CRM Workflow)\n\nModels for persisting Governance Jobs - the execution tracking component\nof the Part-2 governance workflow.\n\nJob Properties:\n- DERIVED FROM CONTRACT: Jobs are created only from activated contracts\n- STEP-ORDERED: Jobs execute steps in sequence\n- OBSERVABLE: State changes are recorded for audit\n- NO AUTHORITY: Jobs track execution, they don't decide outcomes\n\nInvariants:\n- JOB-001: Jobs require contract_id (no orphan jobs)\n- JOB-002: Job steps execute",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
580,app/models/killswitch.py,INTERNAL,models,L7,app/models/killswitch.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Killswitch data models\n# Callers: killswitch API, services\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Killswitch System\n\n""""""M22 KillSwitch Models\n\nProvides:\n- KillSwitchState: Tenant/key freeze state tracking",M22 KillSwitch Models\n\nProvides:\n- KillSwitchState: Tenant/key freeze state tracking\n- ProxyCall: OpenAI proxy call logging for replay\n- Incident: Auto-grouped failure incidents\n- IncidentEvent: Timeline events within incidents\n- DefaultGuardrail: Read-only default policy pack\n\nIncident Grouping v1 Heuristics (LOCKED):\n- GROUPING_WINDOW_SECONDS: 300 (5 minutes) - Fixed correlation window\n- Single root cause per incident - No merging after close\n- One call belongs to exactly one incident\n- No spl,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
581,app/models/knowledge_lifecycle.py,INTERNAL,models,L7,app/models/knowledge_lifecycle.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: GAP-089 Knowledge Plane Lifecycle State Machine\n# Callers: KnowledgeLifecycleManager, SDK facade, policy gates\n# Allowed Imports: stdlib only\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: GAP-089, DOMAINS_E2E_SCAFFOLD_V3.md Section 7.15.2\n\n""""""\nGAP-089: Knowledge Plane Lifecycle State Machine\n\nThis module defines the lifecycle states and valid transitions for knowledge planes.","\nGAP-089: Knowledge Plane Lifecycle State Machine\n\nThis module defines the lifecycle states and valid transitions for knowledge planes.\nKnowledge planes follow a strict lifecycle from registration through activation,\nand optionally through deactivation and purge.\n\nARCHITECTURAL PRINCIPLE:\n    Lifecycle operations are governance-controlled, not user-controlled.\n    SDK calls REQUEST transitions. LifecycleManager DECIDES.\n    Policy + state machine ARBITRATE.\n\nDESIGN INVARIANTS (LOCKED):\n- LIFECYC",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
582,app/models/lessons_learned.py,INTERNAL,models,L7,app/models/lessons_learned.py,"# Layer: L6 — Platform Substrate (Data Models)\n# Product: system-wide\n# Temporal:\n#   Trigger: n/a (data model)\n#   Execution: n/a\n# Role: Lessons learned data model for policy domain intelligence\n# Callers: LessonsLearnedEngine (L4), API facades (L2)\n# Allowed Imports: sqlalchemy, sqlmodel\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-411, POLICIES_DOMAIN_AUDIT.md Section 11\n\n""""""\nLessons Learned Model (L6)\n\nData model for storing learning signals from:","\nLessons Learned Model (L6)\n\nData model for storing learning signals from:\n- Failures (HIGH, MEDIUM, LOW, CRITICAL)\n- Near-threshold events\n- Critical success events\n\nThese lessons can be converted to draft policy proposals.\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
583,app/models/log_exports.py,INTERNAL,models,L7,app/models/log_exports.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Log Exports model for LOGS Domain V2 (O5 evidence bundles)\n# Callers: logs API, LogExportService\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: LOGS_DOMAIN_V2_CONTRACT.md\n\n""""""\nLog Exports Model (LOGS Domain V2)\n\nSCOPE: LOGS domain — O5 evidence bundles.","\nLog Exports Model (LOGS Domain V2)\n\nSCOPE: LOGS domain — O5 evidence bundles.\n\nLogExport tracks audit-grade evidence exports:\n- APPEND-ONLY (enforced by DB trigger)\n- WRITE-ONCE (no UPDATE, no DELETE)\n- Every export is itself logged (audit trail)\n\nPer LOGS_DOMAIN_V2_CONTRACT.md:\n- Captures export metadata and provenance\n- Integrates with correlation spine\n- Supports compliance tags (SOC2, ISO27001)\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
584,app/models/logs_records.py,INTERNAL,models,L7,app/models/logs_records.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: LLM Run Records and System Records models for Logs domain (PIN-413)\n# Callers: runtime_projections/logs/*, worker capture\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-413 Domain Design — Logs v1 Expansion\n\n""""""\nLogs Records Models (PIN-413)\n\nSCOPE: Logs domain ONLY.","\nLogs Records Models (PIN-413)\n\nSCOPE: Logs domain ONLY.\n\nTwo immutable record types:\n- LLMRunRecord: Immutable execution record for every LLM run\n- SystemRecord: Immutable records for system-level events\n\nBoth are:\n- APPEND-ONLY (enforced by DB trigger)\n- WRITE-ONCE (no UPDATE, no DELETE)\n- Trust anchors for verification\n\nThese are SEPARATE from Activity tables:\n- Activity is stateful, lifecycle-driven\n- Logs are immutable facts\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
585,app/models/m10_recovery.py,INTERNAL,models,L7,app/models/m10_recovery.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: M10 recovery data models\n# Callers: recovery services, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: M10 Recovery\n\n# M10 Recovery Suggestion Engine - Async SQLAlchemy Models\n""""""\nSQLAlchemy models for M10 Recovery Suggestion Engine.\n",\nSQLAlchemy models for M10 Recovery Suggestion Engine.\n\nTables:\n- SuggestionInput: Structured inputs for rule evaluation\n- SuggestionAction: Action catalog with templates\n- SuggestionProvenance: Lineage tracking for audit/debugging\n\nUses asyncpg for async database access.\n,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
586,app/models/monitor_config.py,INTERNAL,models,L7,app/models/monitor_config.py,"# Layer: L4 — Domain Engine\n# Product: AI Console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Define what signals to monitor during run execution\n# Callers: policy/prevention_engine.py, api/policy_monitors.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-005\n\n""""""\nMonitor Configuration Model\n\nDefines WHAT signals to collect during run execution:","\nMonitor Configuration Model\n\nDefines WHAT signals to collect during run execution:\n- Token usage (total, per step)\n- Cost tracking (total, burn rate)\n- RAG access monitoring\n- Inspection constraints (negative capabilities)\n\nKey Rule:\n> If something is not monitored, it cannot trigger a limit or action.\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
587,app/models/override_authority.py,INTERNAL,models,L7,app/models/override_authority.py,"# Layer: L4 — Domain Engine\n# Product: AI Console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Define emergency override rules for policies\n# Callers: policy/prevention_engine.py, api/policy_overrides.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-010\n\n""""""\nOverride Authority Model\n\nDefines emergency override rules for policies:",\nOverride Authority Model\n\nDefines emergency override rules for policies:\n- Who can override (roles)\n- Whether reason is required\n- Maximum override duration\n- Override audit trail\n\nOverrides:\n- Create audit entries\n- Do not mutate the original policy snapshot\n- Have time-limited effect\n,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
588,app/models/policy.py,INTERNAL,models,L7,app/models/policy.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Policy data models (DB tables)\n# Callers: policy/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Policy System\n\n""""""\nPolicy Proposal Models (PB-S4)\n\nModels for storing policy proposals WITHOUT auto-enforcement.",\nPolicy Proposal Models (PB-S4)\n\nModels for storing policy proposals WITHOUT auto-enforcement.\n\nPB-S4 Contract:\n- Policies are proposed based on observed feedback\n- Human approval is mandatory\n- No policy auto-enforces\n- No policy affects past executions\n\nRule: Propose → Review → Decide (Human)\n,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
589,app/models/policy_control_plane.py,INTERNAL,models,L7,app/models/policy_control_plane.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Policy control-plane models (PIN-412)\n# Callers: policy/*, api/policies/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-412 Domain Design\n\n""""""\nPolicy Control-Plane Models (PIN-412)\n\nEstablishes the foundational persistence for the Policies domain:","\nPolicy Control-Plane Models (PIN-412)\n\nEstablishes the foundational persistence for the Policies domain:\n- PolicyRule: Governance rules (active, retired)\n- PolicyEnforcement: Rule trigger history\n- Limit: Budget, rate, threshold constraints\n- LimitBreach: Breach history\n\nAfter this schema:\n- Policies › Governance is eligible for O2 API design\n- Policies › Limits is eligible for O2 API design\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
590,app/models/policy_precedence.py,INTERNAL,models,L7,app/models/policy_precedence.py,"# Layer: L4 — Domain Engine\n# Product: AI Console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Define policy precedence and conflict resolution strategies\n# Callers: policy/arbitrator.py, api/policy_precedence.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-003\n\n""""""\nPolicy Precedence Model\n\nDefines conflict resolution when multiple policies apply to the same run:","\nPolicy Precedence Model\n\nDefines conflict resolution when multiple policies apply to the same run:\n- Precedence number (lower = higher priority)\n- Conflict strategy (most_restrictive, explicit_priority, fail_closed)\n- Binding moment (when policy becomes authoritative)\n\nArbitration Rules:\n1. Lower precedence number wins\n2. Same precedence → use conflict_strategy\n3. MOST_RESTRICTIVE → smallest limit, harshest action\n4. FAIL_CLOSED → if ambiguous, deny\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
591,app/models/policy_scope.py,INTERNAL,models,L7,app/models/policy_scope.py,"# Layer: L4 — Domain Engine\n# Product: AI Console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Define policy scope selectors for targeting runs by agent, API key, or human actor\n# Callers: policy/scope_resolver.py, api/policy_scopes.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-001\n\n""""""\nPolicy Scope Model\n\nDefines WHO a policy applies to:",\nPolicy Scope Model\n\nDefines WHO a policy applies to:\n- ALL_RUNS: All LLM runs for the tenant\n- AGENT: Specific agent IDs (native or spawned)\n- API_KEY: Specific API keys\n- HUMAN_ACTOR: Specific human actor IDs\n\nInvariants:\n1. ALL_RUNS cannot be combined with specific IDs\n2. Scope is resolved BEFORE run starts\n3. Resolved scope is stored in policy snapshot\n,,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
592,app/models/policy_snapshot.py,INTERNAL,models,L7,app/models/policy_snapshot.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Immutable policy snapshot for run-time governance\n# Callers: worker/runner.py, policy/engine.py\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: BACKEND_REMEDIATION_PLAN.md GAP-006, GAP-022\n\n""""""\nPolicy Snapshot Model\n\nCaptures immutable snapshot of active policies at run start.","\nPolicy Snapshot Model\n\nCaptures immutable snapshot of active policies at run start.\nEnsures that policy evaluation during a run uses the SAME rules\nthat were active when the run began, not current rules.\n\nKey Invariants:\n1. Snapshot is created ONCE at run start\n2. Snapshot is IMMUTABLE (never updated)\n3. All policy evaluations during run use snapshot, not live policies\n4. Content hash provides integrity verification\n5. Threshold hash provides independent threshold audit trail (GAP-022)\n\nRemedia",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
593,app/models/prediction.py,INTERNAL,models,L7,app/models/prediction.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Prediction data models\n# Callers: predictions/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: C2 Prediction\n\n""""""\nPrediction Event Models (PB-S5)\n\nModels for storing predictions WITHOUT affecting execution behavior.","\nPrediction Event Models (PB-S5)\n\nModels for storing predictions WITHOUT affecting execution behavior.\n\nPB-S5 Contract:\n- Predictions are advisory only\n- Predictions have zero side-effects\n- Predictions never modify execution, scheduling, or history\n- Predictions are clearly labeled as estimates, not facts\n\nRule: Advise, don't influence.\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
594,app/models/retrieval_evidence.py,INTERNAL,models,L7,app/models/retrieval_evidence.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Audit log model for mediated data access\n# Callers: RetrievalMediator (GAP-065), export services\n# Allowed Imports: L6 (sqlmodel)\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-058\n\n""""""\nModule: retrieval_evidence\nPurpose: Audit log for every mediated data access.\n","\nModule: retrieval_evidence\nPurpose: Audit log for every mediated data access.\n\nTable: retrieval_evidence\nImmutability: Write-once (DB trigger prevents UPDATE/DELETE)\n\nImports (Dependencies):\n    - sqlmodel: SQLModel, Field\n    - sqlalchemy: Column, JSONB\n\nExports (Provides):\n    - RetrievalEvidence: SQLModel table for audit records\n\nWiring Points:\n    - Created by: RetrievalMediator (GAP-065)\n    - Queried by: SOC2 export services, audit dashboards\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
595,app/models/run_lifecycle.py,INTERNAL,models,L7,app/models/run_lifecycle.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Run lifecycle enums and models for governance\n# Callers: worker/runner.py, services/*, api/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: BACKEND_REMEDIATION_PLAN.md GAP-002, GAP-007\n\n""""""\nRun Lifecycle Models\n\nProvides formal enums for run termination and status tracking.","\nRun Lifecycle Models\n\nProvides formal enums for run termination and status tracking.\nReplaces string-based status/error codes with typed enums for:\n- Better type safety\n- Clear precedence rules\n- SOC2-ready audit trails\n\nRemediation: GAP-002 (Run stop on violation), GAP-007 (Termination enum)\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
596,app/models/tenant.py,INTERNAL,models,L7,app/models/tenant.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Tenant data models\n# Callers: tenant services\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Tenant System\n\n""""""Tenant, User, and Multi-Tenancy Models (M21)\n\nProvides:\n- Tenant (organization) management","Tenant, User, and Multi-Tenancy Models (M21)\n\nProvides:\n- Tenant (organization) management\n- User accounts linked to Clerk\n- Tenant memberships with roles\n- API key generation and validation\n- Subscription/billing support\n- TenantTier integration (M32)\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
597,app/models/threshold_signal.py,INTERNAL,models,L7,app/models/threshold_signal.py,"# Layer: L4 — Domain Engine\n# Product: AI Console\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Record near-threshold and breach events for alerting and audit\n# Callers: policy/prevention_engine.py, services/alert_emitter.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-006\n\n""""""\nThreshold Signal Model\n\nRecords threshold events during run execution:","\nThreshold Signal Model\n\nRecords threshold events during run execution:\n- NEAR: Approaching threshold (configurable percentage)\n- BREACH: Threshold exceeded, enforcement triggered\n\nThese signals are immutable evidence for audit and compliance.\n",,STAYS,ITERATION_1,L7 model - stays in app/,STAYS
598,app/observability/__init__.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-8 Observability Package Exports\n# Callers: all systems emitting or querying events\n# Allowed Imports: L4 (events, provider, emitters)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-8 (Observability Unification)\n\n""""""\nPhase-8 Observability Package\n\nUnified event model for all observability data.","\nPhase-8 Observability Package\n\nUnified event model for all observability data.\n\nUsage:\n    from app.observability import emit_event, emit_billing_state_changed\n    from app.observability import get_observability_provider\n\n    # Emit a billing state change\n    emit_billing_state_changed(\n        tenant_id=""tenant-123"",\n        from_state=""TRIAL"",\n        to_state=""ACTIVE"",\n        plan_id=""pro"",\n    )\n\n    # Query events\n    provider = get_observability_provider()\n    events = provider.query(\n  ",,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/config/__init__.py,SKIP_INIT_COLLISION
599,app/observability/cost_tracker.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/cost_tracker.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Cost tracking and metrics\n# Callers: services, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Cost Observability\n\n# app/observability/cost_tracker.py\n""""""\nCost Tracking and Quota Management\n","\nCost Tracking and Quota Management\n\nTracks LLM spend per tenant, workflow, and skill.\nProvides alerting when budgets are approached/exceeded.\nEnforces hard cost ceilings at workflow and tenant levels.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Observability,TRANSFER
600,app/observability/emitters.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/emitters.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: runtime\n#   Execution: sync\n# Role: Phase-8 Event Emitters (helper functions)\n# Callers: onboarding, billing, protection, auth, founder ops\n# Allowed Imports: L4 (events, provider)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-8 (Observability Unification)\n\n""""""\nPhase-8 Event Emitters\n\nConvenience functions for emitting events from each system.",\nPhase-8 Event Emitters\n\nConvenience functions for emitting events from each system.\nAll emitters are thin wrappers around the provider's emit() method.\n\nOBSERVE-004: All emitters are non-blocking and fail silently.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Observability,TRANSFER
601,app/observability/events.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/events.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-8 Unified Event model\n# Callers: ObservabilityProvider, event emitters\n# Allowed Imports: None (foundational types)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-8 (Observability Unification)\n\n""""""\nPhase-8 Unified Event Model\n\nPIN-399 Phase-8: Observability answers ""what happened?"" — never ""what should happen?""","\nPhase-8 Unified Event Model\n\nPIN-399 Phase-8: Observability answers ""what happened?"" — never ""what should happen?""\n\nDESIGN INVARIANTS (LOCKED):\n- OBSERVE-001: Observability never mutates system state\n- OBSERVE-002: Events are immutable once accepted\n- OBSERVE-003: All events are tenant-scoped\n- OBSERVE-004: Failure to emit must not block execution\n- OBSERVE-005: Mock provider must be interface-compatible with real provider\n\nCORE CONCEPT:\n    Everything becomes an event.\n    Events are append-on",,NEEDS_CLASSIFICATION,ITERATION_1,Observability,TRANSFER
602,app/observability/provider.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/observability_provider.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time, runtime\n#   Execution: sync\n# Role: Phase-8 Observability Provider (protocol + mock)\n# Callers: emitters, query handlers\n# Allowed Imports: L4 (events), L6 (logging)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-399 Phase-8 (Observability Unification)\n\n""""""\nPhase-8 Observability Provider\n\nImplements OBSERVE-004: Failure to emit must not block execution.",\nPhase-8 Observability Provider\n\nImplements OBSERVE-004: Failure to emit must not block execution.\nImplements OBSERVE-005: Mock provider must be interface-compatible with real provider.\n\nThe provider is the single interface for emitting and querying events.\nAll emit operations are non-blocking and fail silently (logged locally).\n,,NEEDS_CLASSIFICATION,ITERATION_1,Observability,TRANSFER
603,app/optimization/__init__.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/__init__.py,"# C3 Optimization Safety Layer\n# Phase: C3_OPTIMIZATION\n# Reference: PIN-225, C3_ENVELOPE_ABSTRACTION.md, C3_KILLSWITCH_ROLLBACK_MODEL.md\n#\n# This module provides the safety cage for prediction-driven optimization.\n# Predictions may influence behavior ONLY via declared optimization envelopes.\n#\n# Core invariants (I-C3-1 to I-C3-6):\n# - Predictions influence via declared envelopes only\n# - Every change bounded (impact + time)\n# - All influence reversible\n# - Human override always wins\n# - Replay without predictions = baseline behavior\n# - Optimization failure never creates incidents\n",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
604,app/optimization/audit_persistence.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/audit_persistence.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Optimization audit trail persistence\n# Callers: optimization/coordinator\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: M10 Optimization\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Append-only INSERT operations to coordination_audit_records",SQLModel for coordination_audit_records table.\n\nThis is a read-only reflection of the table created by migration\n063_c4_coordination_audit.py. The model is for persistence only.,,NEEDS_CLASSIFICATION,ITERATION_1,Optimization logic,TRANSFER
605,app/optimization/coordinator.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/coordinator.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Optimization envelope coordination\n# Callers: workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: M10 Optimization\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Coordinates optimization envelopes with conflict detection and preemption",Raised when coordination fails in an unrecoverable way.,,NEEDS_CLASSIFICATION,ITERATION_1,Optimization logic,TRANSFER
606,app/optimization/envelope.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/envelope.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Base optimization envelope definition\n# Callers: optimization/*\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M10 Optimization\n\n# C3/C4 Optimization Envelope\n# Reference: C3_ENVELOPE_ABSTRACTION.md (FROZEN), C4_ENVELOPE_COORDINATION_CONTRACT.md (FROZEN)\n#\n# The envelope is the ONLY legal interface through which predictions",How bounds are expressed.,,NEEDS_CLASSIFICATION,ITERATION_1,Optimization logic,TRANSFER
607,app/optimization/envelopes/__init__.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/__init__.py,"# C3 Envelope Declarations\n# Reference: PIN-225, C3_ENVELOPE_ABSTRACTION.md\n\nfrom app.optimization.envelopes.s1_retry_backoff import (\n    S1_RETRY_BACKOFF_ENVELOPE,\n    create_s1_envelope,\n)\nfrom app.optimization.envelopes.s2_cost_smoothing import (\n    S2_ABSOLUTE_FLOOR,\n    S2_COST_SMOOTHING_ENVELOPE,\n    calculate_s2_bounded_value,\n    create_s2_envelope,\n    validate_s2_envelope,\n)\n",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
608,app/optimization/envelopes/s1_retry_backoff.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/s1_retry_backoff.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: S1 Retry backoff envelope implementation\n# Callers: optimization/coordinator\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M10 S1 Envelope\n\n# C3-S1: Bounded Retry Optimization Envelope\n# Reference: PIN-225, C3_ENVELOPE_ABSTRACTION.md\n#\n# Scenario: Prediction suggests elevated incident risk.",Create a fresh S1 envelope instance with specified baseline.\n\nArgs:\n    baseline_value: The baseline initial_backoff_ms value\n    reference_id: Version/hash of the baseline config\n\nReturns:\n    New Envelope instance ready for validation,,NEEDS_CLASSIFICATION,ITERATION_1,Optimization logic,TRANSFER
609,app/optimization/envelopes/s2_cost_smoothing.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/s2_cost_smoothing.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: S2 Cost smoothing envelope implementation\n# Callers: optimization/coordinator\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M10 S2 Envelope\n\n# C3-S2: Cost Smoothing Optimization Envelope\n# Reference: PIN-225, C3_ENVELOPE_ABSTRACTION.md\n#\n# Scenario: Spend Spike prediction exists.",Create a fresh S2 envelope instance with specified baseline.\n\nArgs:\n    baseline_value: The baseline max_concurrent_jobs value\n    reference_id: Version/hash of the baseline config\n\nReturns:\n    New Envelope instance ready for validation,,NEEDS_CLASSIFICATION,ITERATION_1,Optimization logic,TRANSFER
610,app/optimization/killswitch.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/killswitch.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Optimization killswitch for emergency stops\n# Callers: API routes, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M10 Optimization\n\n# C3 Kill-Switch Implementation\n# Reference: C3_KILLSWITCH_ROLLBACK_MODEL.md (FROZEN)\n#\n# Kill-switch invariants (K-1 to K-5):",Global kill-switch state. Exactly two values. No partial states.,,NEEDS_CLASSIFICATION,ITERATION_1,Optimization logic,TRANSFER
611,app/optimization/manager.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/manager.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Optimization envelope lifecycle management\n# Callers: workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: M10 Optimization\n\n# C3 Envelope Manager\n# Reference: PIN-225, C3_ENVELOPE_ABSTRACTION.md, C3_KILLSWITCH_ROLLBACK_MODEL.md\n#\n# Manages active envelopes and handles rollback on kill-switch.",Record of an active envelope application.,,NEEDS_CLASSIFICATION,ITERATION_1,Optimization logic,TRANSFER
612,app/planner/__init__.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/__init__.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Planner package marker\n# Callers: Planner imports\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Package Structure\n\n# planner/__init__.py\n""""""\nPlanner Module (M2.5)\n",\nPlanner Module (M2.5)\n\nThis module provides planner abstractions for AOS:\n- PlannerInterface - Protocol for planner implementations\n- StubPlanner - Rule-based planner for testing\n- LegacyStubPlanner - Backwards-compatible interface\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/domain/__init__.py,SKIP_INIT_COLLISION
613,app/planner/interface.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/interface.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Planner interface definition (contract)\n# Callers: planners/*\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: LLM Integration\n\n# planner/interface.py\n""""""\nPlannerInterface Protocol (M2.5)\n","\nPlannerInterface Protocol (M2.5)\n\nDefines the contract that all planner implementations must follow.\nThis enables planner modularity - swap between Claude, OpenAI, local models,\nor rule-based planners without changing the runtime.\n\nSee: app/specs/planner_determinism.md for full specification.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Planning logic,TRANSFER
614,app/planner/stub_planner.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/stub_planner.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Stub planner for testing\n# Callers: planner interface (test mode)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: LLM Integration\n\n# planner/stub_planner.py\n""""""\nStub Planner (M2.5)\n",\nStub Planner (M2.5)\n\nRule-based deterministic planner for testing.\nImplements PlannerInterface from interface.py.\n\nKey features:\n1. Full determinism - same inputs always produce identical plans\n2. Rule-based planning using keyword matching\n3. Supports all PlannerInterface methods\n4. Zero-cost planning (no LLM calls)\n5. Perfect for unit tests and golden file comparisons\n\nSee: app/specs/planner_determinism.md for full specification.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Planning logic,TRANSFER
615,app/planners/__init__.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/__init__.py,"# NOVA Planner Adapters\n# Provides pluggable planner backends (stub, anthropic, openai)\n\nimport logging\nimport os\nfrom typing import Any, Dict, List, Optional, Protocol\n\nlogger = logging.getLogger(""nova.planners"")\n\n\nclass PlannerProtocol(Protocol):\n    """"""Protocol for planner adapters.""""""\n\n    def plan(\n        self,",Protocol for planner adapters.,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/domain/__init__.py,SKIP_INIT_COLLISION
616,app/planners/anthropic_adapter.py,INTERNAL,platform,L3,app/houseofcards/internal/platform/facades/anthropic_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: async\n# Role: Anthropic Claude LLM adapter\n# Callers: planner interface, workers\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: LLM Integration\n\n# Anthropic Planner Adapter\n# Uses Claude API for intelligent plan generation with proper Plan schema output\n\nimport json",Anthropic Claude-based planner for intelligent plan generation.\n\nGenerates structured plans conforming to the Plan schema using\nClaude's API with structured output guidance.,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
617,app/planners/stub_adapter.py,INTERNAL,platform,L3,app/houseofcards/internal/platform/facades/stub_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Stub LLM adapter for testing\n# Callers: planner interface (test mode)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: LLM Integration\n\n# Stub Planner Adapter\n# Default fallback planner that returns a basic single-step plan\n\nimport logging",Stub planner for testing and fallback scenarios.\n\nReturns a simple single-step plan that directly executes the goal.,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
618,app/policy/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# M19 Policy Layer\n# Constitutional governance for multi-agent systems\n#\n# This module provides the policy engine that every agent and subsystem\n# must consult before deciding, routing, executing, escalating, or self-modifying.\n#\n# GAP Fixes (M19.1):\n# - GAP 1: Policy Versioning & Provenance\n# - GAP 2: Policy Dependency Graph & Conflict Resolution\n# - GAP 3: Temporal Policies (Sliding Windows)\n# - GAP 4: Policy Context Object\n# - GAP 5: Enhanced Violation Classifications\n\nfrom app.policy.engine import PolicyEngine, get_policy_engine\nfrom app.policy.prevention_engine import (",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
619,app/policy/arbitrator.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/arbitrator.py,"# Layer: L4 — Domain Engine\n# Product: AI Console\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Resolve conflicts between multiple applicable policies\n# Callers: policy/prevention_engine.py, worker/runner.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-004\n\n""""""\nPolicy Arbitrator Engine\n\nResolves conflicts when multiple policies apply to the same run:","\nPolicy Arbitrator Engine\n\nResolves conflicts when multiple policies apply to the same run:\n1. Sort policies by precedence (lower = higher priority)\n2. Resolve limit conflicts using conflict strategy\n3. Resolve action conflicts (harshest action wins)\n4. Return effective limits and actions\n\nArbitration Rules:\n- MOST_RESTRICTIVE: Smallest limit, harshest action wins\n- EXPLICIT_PRIORITY: Higher precedence (lower number) wins\n- FAIL_CLOSED: If ambiguous, deny/stop\n",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
620,app/policy/ast/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# M20 Policy AST\n# Abstract Syntax Tree for PLang v2.0\n#\n# AST nodes with M19 governance metadata:\n# - GovernanceMetadata attached to policy/rule nodes\n# - Category and priority information preserved\n# - Visitor pattern for AST traversal\n\nfrom app.policy.ast.nodes import (\n    ActionBlockNode,\n    # Base\n    ASTNode,\n    AttrAccessNode,\n    # Expressions\n    BinaryOpNode,",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
621,app/policy/ast/nodes.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/nodes.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Policy AST node definitions\n# Callers: policy/compiler, policy/engine\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 Policy AST Nodes\n# AST node definitions with M19 governance metadata\n""""""\nAST nodes for PLang v2.0.","\nAST nodes for PLang v2.0.\n\nEach node includes:\n- Source location (line, column)\n- Governance metadata where applicable\n- Type-safe structure for analysis\n",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
622,app/policy/ast/visitors.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/visitors.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Policy AST visitor pattern implementations\n# Callers: policy/engine\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 Policy AST Visitors\n# Visitor pattern implementations for AST traversal\n""""""\nAST visitors for PLang v2.0.",\nAST visitors for PLang v2.0.\n\nVisitors for:\n- Pretty printing\n- Category collection\n- Rule extraction\n- Governance analysis\n,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
623,app/policy/binding_moment_enforcer.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/binding_moment_enforcer.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (during policy evaluation)\n#   Execution: sync\n# Role: Enforce binding moments - when policies are evaluated\n# Callers: prevention_engine.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-031\n\n""""""\nModule: binding_moment_enforcer\nPurpose: Ensures policies are evaluated at the correct binding moment.\n","\nModule: binding_moment_enforcer\nPurpose: Ensures policies are evaluated at the correct binding moment.\n\nBinding moments define WHEN a policy is evaluated:\n- RUN_START: Evaluate once at run start (snapshot-based)\n- STEP_START: Evaluate before each step\n- STEP_END: Evaluate after each step\n- ON_CHANGE: Evaluate when specific fields change\n\nIf a policy has bind_at=RUN_START, it should NOT be re-evaluated mid-run.\n\nImports (Dependencies):\n    - None (standalone)\n\nExports (Provides):\n    - should_ev",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
624,app/policy/compiler/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# M20 Policy Compiler - PLang v2.0\n# Tokenizer, Parser, Grammar for policy language compilation\n#\n# PLang v2.0 supports M19 governance categories:\n# - SAFETY: Safety rules and constraints\n# - PRIVACY: Data protection and access control\n# - OPERATIONAL: Business logic and workflows\n# - ROUTING: Agent routing and load balancing\n# - CUSTOM: User-defined policies\n\nfrom app.policy.compiler.grammar import (\n    PLANG_GRAMMAR,\n    PLangGrammar,\n)\nfrom app.policy.compiler.parser import (",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
625,app/policy/compiler/grammar.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/grammar.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Policy language grammar definitions\n# Callers: policy/compiler/parser\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 PLang v2.0 Grammar\n# Policy Language Grammar with M19 Categories\n""""""\nPLang v2.0 Grammar (EBNF):",\nPLang v2.0 Grammar (EBNF):\n\nprogram         ::= statement*\nstatement       ::= policy_decl | rule_decl | import_stmt\npolicy_decl     ::= 'policy' IDENT ':' category '{' policy_body '}'\ncategory        ::= 'SAFETY' | 'PRIVACY' | 'OPERATIONAL' | 'ROUTING' | 'CUSTOM'\npolicy_body     ::= (rule_ref | condition_block | action_block)*\nrule_ref        ::= 'rule' IDENT\ncondition_block ::= 'when' expr 'then' action_block\naction_block    ::= 'deny' | 'allow' | 'escalate' | 'route' route_target\nroute_targe,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
626,app/policy/compiler/parser.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/compiler_parser.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy language parser\n# Callers: policy/engine\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 PLang v2.0 Parser\n# Syntax analysis for policy language\n""""""\nParser for PLang v2.0 with M19 category support.","\nParser for PLang v2.0 with M19 category support.\n\nProduces an AST from tokens, supporting:\n- Policy declarations with categories\n- Rule declarations with priorities\n- Condition blocks (when/then)\n- Action blocks (deny/allow/escalate/route)\n- Expression evaluation\n",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
627,app/policy/compiler/tokenizer.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/tokenizer.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy language tokenizer\n# Callers: policy/compiler/parser\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 PLang v2.0 Tokenizer\n# Lexical analysis for policy language\n""""""\nTokenizer for PLang v2.0 with M19 category support.","\nTokenizer for PLang v2.0 with M19 category support.\n\nToken types include:\n- Keywords: policy, rule, when, then, deny, allow, etc.\n- Categories: SAFETY, PRIVACY, OPERATIONAL, ROUTING, CUSTOM\n- Identifiers: user-defined names\n- Literals: numbers, strings, booleans\n- Operators: ==, !=, <, >, etc.\n- Delimiters: {, }, (, ), :, ,\n",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
628,app/policy/conflict_resolver.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_conflict_resolver.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (during policy evaluation)\n#   Execution: sync\n# Role: Resolve conflicts when multiple policies trigger different actions\n# Callers: prevention_engine.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-068\n\n""""""\nModule: conflict_resolver\nPurpose: Defines explicit rules for resolving policy conflicts.\n","\nModule: conflict_resolver\nPurpose: Defines explicit rules for resolving policy conflicts.\n\nImplements INV-005: Policy Conflict Determinism (CONFLICT-DET-001)\n> When multiple policies apply to the same action, the most restrictive action wins.\n> If two policies have equal restrictiveness, the policy with the lowest policy_id wins\n> (deterministic tiebreaker).\n\nImports (Dependencies):\n    - None (standalone)\n\nExports (Provides):\n    - resolve_policy_conflict(actions: List[PolicyAction]) -> Resolv",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
629,app/policy/degraded_mode.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/degraded_mode.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: system-condition or operator-action\n#   Execution: sync\n# Role: Degraded mode for governance system\n# Callers: main.py, prevention_engine.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-070\n\n""""""\nDegraded Mode - Graceful Governance Degradation\n\nWhen governance systems are partially unavailable, the system","\nDegraded Mode - Graceful Governance Degradation\n\nWhen governance systems are partially unavailable, the system\ncan enter degraded mode:\n- New runs are blocked\n- Existing runs continue with WARN action\n- Telemetry and logging continue\n\nThis prevents cascading failures while maintaining visibility.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
630,app/policy/engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/engine.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Policy rule evaluation engine\n# Callers: API routes, workers, services\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Policy System\n\n# M19 Policy Engine\n# Constitutional governance for multi-agent systems\n#\n# This is the core Policy Engine that every agent and subsystem",M19 Policy Engine - Constitutional Governance Layer.\n\nEvery agent decision must go through policy.evaluate() before execution.\n\nResponsibilities:\n- Enforce compliance rules\n- Enforce ethical constraints\n- Enforce risk ceilings\n- Enforce safety rules\n- Enforce business rules\n- Route violations to M18 Governor\n- Audit all evaluations,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
631,app/policy/failure_mode_handler.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/failure_mode_handler.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (during policy evaluation)\n#   Execution: sync\n# Role: Handle failure modes - default to fail-closed\n# Callers: prevention_engine.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-035\n\n""""""\nModule: failure_mode_handler\nPurpose: Handles failure modes when policy evaluation fails or is uncertain.\n","\nModule: failure_mode_handler\nPurpose: Handles failure modes when policy evaluation fails or is uncertain.\n\nKey Principle: FAIL-CLOSED by default.\nIf policy evaluation fails, the system MUST block the action, not allow it.\n\nImports (Dependencies):\n    - app.services.governance.profile: get_governance_config\n\nExports (Provides):\n    - handle_policy_failure(error, context) -> FailureDecision\n    - FailureMode: Enum of failure modes\n    - FailureDecision: Decision when failure occurs\n\nWiring Points",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
632,app/policy/ir/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# M20 Policy IR - Intermediate Representation\n# Category-aware IR for policy compilation\n#\n# IR v2.0 features:\n# - M19 category awareness\n# - Governance metadata propagation\n# - Symbol table with policy hierarchy\n# - SSA-like form for optimization\n\nfrom app.policy.ir.ir_builder import (\n    IRBuilder,\n)\nfrom app.policy.ir.ir_nodes import (\n    IRAction,\n    IRBinaryOp,",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
633,app/policy/ir/ir_builder.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/ir_builder.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy intermediate representation builder\n# Callers: policy/engine\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 Policy IR Builder\n# AST to IR transformation\n""""""\nIR Builder for PLang v2.0.",\nIR Builder for PLang v2.0.\n\nTransforms AST nodes into IR with:\n- M19 category propagation\n- Symbol table population\n- Basic block construction\n- Governance metadata attachment\n,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
634,app/policy/ir/ir_nodes.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/ir_nodes.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Policy IR node definitions\n# Callers: policy/ir/*\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 Policy IR Nodes\n# Intermediate representation nodes with governance metadata\n""""""\nIR nodes for PLang v2.0 compilation.",\nIR nodes for PLang v2.0 compilation.\n\nIR design principles:\n- Category-aware: Every node carries governance metadata\n- SSA-like: Single assignment for optimization\n- Intent-oriented: Designed for M18 intent emission\n- Deterministic: Reproducible execution paths\n,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
635,app/policy/ir/symbol_table.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/symbol_table.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy symbol table management\n# Callers: policy/ir/ir_builder\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 Policy IR Symbol Table\n# Symbol management for policy compilation\n""""""\nSymbol table for PLang v2.0 compilation.","\nSymbol table for PLang v2.0 compilation.\n\nFeatures:\n- Hierarchical scoping (global, policy, rule, block)\n- Category-aware symbol lookup\n- Governance metadata tracking\n- M19 policy reference resolution\n",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
636,app/policy/kill_switch.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/kill_switch.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: operator-action\n#   Execution: sync\n# Role: Runtime kill switch for governance bypass\n# Callers: main.py, prevention_engine.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-069\n\n""""""\nKill Switch - Runtime Governance Bypass\n\nProvides emergency governance disable capability without restart.","\nKill Switch - Runtime Governance Bypass\n\nProvides emergency governance disable capability without restart.\nWhen active, all governance checks are bypassed (fail-open mode).\n\nUse cases:\n- Emergency maintenance\n- Security incident response\n- Governance system failures\n\nSecurity considerations:\n- Activation requires authenticated operator\n- All activations are logged\n- Automatic timeout for safety\n",,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
637,app/policy/models.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_models.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Policy domain models and types\n# Callers: policy/*\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M19 Policy Layer Models\n# Constitutional governance for multi-agent systems\n#\n# These models define the policy types and evaluation results",Categories of policies in the M19 Policy Layer.,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
638,app/policy/optimizer/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# M20 Policy Optimizer\n# Governance-aware IR optimization\n#\n# Optimizer v2.0 features:\n# - Constant folding\n# - Dead code elimination\n# - Conflict resolution\n# - DAG-based execution ordering\n# - Category priority propagation\n\nfrom app.policy.optimizer.conflict_resolver import (\n    ConflictResolver,\n    ConflictType,\n    PolicyConflict,\n)",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
639,app/policy/optimizer/conflict_resolver.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/optimizer_conflict_resolver.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy conflict resolution\n# Callers: policy/engine\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 Policy Optimizer - Conflict Resolution\n# Resolves conflicts between policies using governance rules\n""""""\nConflict resolution for PLang v2.0.",\nConflict resolution for PLang v2.0.\n\nConflict types:\n- Action conflicts: Different actions for same condition\n- Priority conflicts: Same priority for different policies\n- Category conflicts: Cross-category interactions\n\nResolution strategies:\n- Category precedence: SAFETY > PRIVACY > OPERATIONAL > ROUTING > CUSTOM\n- Priority ordering: Higher priority wins\n- Action precedence: deny > escalate > route > allow\n,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
640,app/policy/optimizer/dag_sorter.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/dag_sorter.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy DAG topological sorting\n# Callers: policy/optimizer\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 Policy Optimizer - DAG Sorter\n# Topological ordering for deterministic execution\n""""""\nDAG-based execution ordering for PLang v2.0.",\nDAG-based execution ordering for PLang v2.0.\n\nFeatures:\n- Topological sort for dependency-respecting execution\n- Category-aware ordering (SAFETY first)\n- Priority-based tie breaking\n- Deterministic execution plan generation\n,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
641,app/policy/optimizer/folds.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/folds.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy constant folding optimizations\n# Callers: policy/optimizer\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M20 Policy Optimizer - Constant Folding and Simplification\n# Optimizations that preserve governance semantics\n""""""\nIR optimizations for PLang v2.0.",\nIR optimizations for PLang v2.0.\n\nOptimizations:\n- Constant folding: Evaluate constant expressions at compile time\n- Dead code elimination: Remove unreachable code\n- Policy simplification: Merge compatible policies\n,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
642,app/policy/prevention_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/prevention_engine.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: per-step\n#   Execution: sync\n# Role: Policy prevention engine for runtime enforcement\n# Callers: worker/runner.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: BACKEND_REMEDIATION_PLAN.md GAP-001, GAP-002\n\n""""""\nPrevention Engine\n\nEvaluates policies DURING run execution at each step checkpoint.","\nPrevention Engine\n\nEvaluates policies DURING run execution at each step checkpoint.\nUses the policy snapshot captured at run start (not live policies)\nto ensure consistent enforcement throughout the run.\n\nKey Responsibilities:\n1. Evaluate step against policy thresholds\n2. Determine action (ALLOW, WARN, BLOCK)\n3. Return structured result for runner to act on\n\nRemediation: GAP-001 (Prevention hook integration), GAP-002 (Run stop on violation)\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
643,app/policy/runtime/__init__.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/__init__.py,"# M20 Policy Runtime\n# Deterministic execution engine for compiled policies\n#\n# Runtime features:\n# - MN-OS Layer 0: No randomness, reproducible execution\n# - M18 intent emission\n# - M19 governance validation\n# - Audit logging\n\nfrom app.policy.runtime.dag_executor import (\n    DAGExecutor,\n    ExecutionTrace,\n    StageResult,\n)\nfrom app.policy.runtime.deterministic_engine import (",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
644,app/policy/runtime/dag_executor.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/dag_executor.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: DAG-based parallel policy executor\n# Callers: policy engine, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: Policy System\n\n# M20 Policy Runtime - DAG Executor\n# Parallel execution of policy DAG stages\n""""""\nDAG-based executor for PLang v2.0.",\nDAG-based executor for PLang v2.0.\n\nExecutes policies in topologically sorted order:\n- Parallel execution within stages\n- Sequential execution across stages\n- Governance-aware ordering\n- Full execution trace\n,,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
645,app/policy/runtime/deterministic_engine.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/deterministic_engine.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Deterministic policy execution engine\n# Callers: policy evaluators, workers\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Policy System\n\n# M20 Policy Runtime - Deterministic Engine\n# MN-OS Layer 0: No randomness, reproducible execution\n""""""\nDeterministic execution engine for PLang v2.0.",\nDeterministic execution engine for PLang v2.0.\n\nKey principles:\n- NO RANDOMNESS: Every execution is reproducible\n- GOVERNANCE-FIRST: Safety checks before any action\n- AUDITABLE: Full execution trace for debugging\n- DETERMINISTIC: Same input = same output\n\nIntegration points:\n- M18: Intent emission for execution\n- M19: Policy validation before actions\n- M4: Execution plan generation\n,,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
646,app/policy/runtime/intent.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/intent.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Policy intent model and declaration\n# Callers: policy engine, evaluators\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Policy System\n\n# M20 Policy Runtime - Intent System\n# M18 intent emission for governance-aware execution\n""""""\nIntent system for PLang v2.0 runtime.",\nIntent system for PLang v2.0 runtime.\n\nIntents are the bridge between policy decisions and M18 execution:\n- Policy compiler emits intents based on actions\n- M18 executes intents with governance constraints\n- M19 validates intents before execution\n\nIntent types:\n- ROUTE: Route to specific agent\n- ESCALATE: Escalate to higher authority\n- EXECUTE: Execute with constraints\n- DENY: Block execution with reason\n- ALLOW: Permit execution\n,,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
647,app/policy/scope_resolver.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/scope_resolver.py,"# Layer: L4 — Domain Engine\n# Product: AI Console\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Resolve which policies apply to a given run context\n# Callers: policy/prevention_engine.py, worker/runner.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-002\n\n""""""\nScope Resolver Engine\n\nResolves which policies apply to a run based on:",\nScope Resolver Engine\n\nResolves which policies apply to a run based on:\n- Tenant ID (always required)\n- Agent ID (for AGENT scope)\n- API Key ID (for API_KEY scope)\n- Human Actor ID (for HUMAN_ACTOR scope)\n\nResolution happens BEFORE run starts and the result is frozen\ninto the policy snapshot for audit purposes.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
648,app/policy/validators/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# M23/M24 Policy Validators\n# Content accuracy and assertion validation for LLM outputs\n#\n# Prevention mechanisms for policy gaps:\n# - CONTENT_ACCURACY: Prevents assertions about missing data\n# - PII: Detects and blocks PII exposure\n# - SAFETY: Detects harmful content\n# - HALLUCINATION: Detects unsupported claims\n# - BUDGET_LIMIT: Token/cost enforcement\n# - Prevention hooks: Pre-response validation\n# - Prevention engine: Multi-policy evaluation with severity levels\n\nfrom app.policy.validators.content_accuracy import (\n    AssertionCheck,\n    ContentAccuracyResult,",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
649,app/policy/validators/content_accuracy.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/content_accuracy.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy content accuracy validation\n# Callers: policy/engine\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M23 Content Accuracy Validator\n# Prevents AI from making assertions about data that is missing or NULL\n#\n# The CONTENT_ACCURACY policy gap:",Types of assertions detected in output.,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
650,app/policy/validators/prevention_engine.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/prevention_engine.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Prevention-based policy validation\n# Callers: policy/engine, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M24 Prevention Engine\n# Multi-policy prevention with severity levels, async incident creation, and metrics\n#\n# Improvements over M23:",Types of policies that can be evaluated.,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
651,app/policy/validators/prevention_hook.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/prevention_hook.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Prevention hook for policy enforcement\n# Callers: workers, execution runtime\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Policy System\n\n# M23 Prevention Hook\n# Pre-response and post-response hooks for policy enforcement\n#\n# This module provides hooks that can be called:",Action to take when prevention hook triggers.,,NEEDS_CLASSIFICATION,ITERATION_1,Policy logic,TRANSFER
652,app/predictions/api.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/api.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Prediction service API logic\n# Callers: API routes\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: C2 Prediction\n\n""""""\nC2 Prediction API (Minimal, Advisory-Only)\n\nThis is a CANARY implementation, not a system.","\nC2 Prediction API (Minimal, Advisory-Only)\n\nThis is a CANARY implementation, not a system.\nPurpose: Prove predictions can exist without influencing truth.\n\nScenarios:\n- C2-T1: Incident Risk\n- C2-T2: Spend Spike\n- C2-T3: Policy Drift (HIGH-RISK, strictest semantic constraints)\n\nC2 Contract:\n- All predictions are advisory (I-C2-1)\n- Predictions expire and are disposable (I-C2-5)\n- No control path influence (I-C2-2)\n- No truth mutation (I-C2-3)\n- Replay is blind to predictions (I-C2-4)\n\nC2-T2 Rule",,NEEDS_CLASSIFICATION,ITERATION_1,Predictions,TRANSFER
653,app/protection/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-7 Protection package exports\n# Callers: Any module needing abuse protection functionality\n# Allowed Imports: L4 (protection submodules)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-7 (Abuse & Protection Layer)\n\n""""""\nPhase-7 Abuse Protection Package\n\nPIN-399 Phase-7: Abuse protection constrains behavior, not identity.","\nPhase-7 Abuse Protection Package\n\nPIN-399 Phase-7: Abuse protection constrains behavior, not identity.\n\nThis package provides:\n- Decision: Enforcement outcomes (ALLOW, THROTTLE, REJECT, WARN)\n- ProtectionResult: Result of protection checks\n- AnomalySignal: Non-blocking anomaly detection signals\n- AbuseProtectionProvider: Protocol for protection operations\n- MockAbuseProtectionProvider: Deterministic mock implementation\n\nDESIGN INVARIANTS (LOCKED):\n- ABUSE-001: Protection does not affect onboard",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
654,app/protection/decisions.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/decisions.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Phase-7 Decision enum and result types\n# Callers: AbuseProtectionProvider, protection middleware\n# Allowed Imports: None (foundational types)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-7 (Abuse & Protection Layer)\n\n""""""\nPhase-7 Abuse Protection — Decision Types\n\nPIN-399 Phase-7: Abuse protection constrains behavior, not identity.","\nPhase-7 Abuse Protection — Decision Types\n\nPIN-399 Phase-7: Abuse protection constrains behavior, not identity.\n\nDESIGN INVARIANTS (LOCKED):\n- ABUSE-001: Protection does not affect onboarding, roles, or billing state\n- ABUSE-002: All enforcement outcomes are explicit (no silent failure)\n- ABUSE-003: Anomaly detection never blocks user traffic\n- ABUSE-004: Protection providers are swappable behind a fixed interface\n- ABUSE-005: Mock provider must be behavior-compatible with real provider\n\nDECISI",,NEEDS_CLASSIFICATION,ITERATION_1,Protection logic,TRANSFER
655,app/protection/provider.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/protection_provider.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: runtime\n#   Execution: sync\n# Role: Phase-7 AbuseProtectionProvider protocol and MockAbuseProtectionProvider\n# Callers: protection middleware, SDK endpoints, runtime paths\n# Allowed Imports: L4 (protection.decisions, billing)\n# Forbidden Imports: L1, L2, L3, L5, L6\n# Reference: PIN-399 Phase-7 (Abuse & Protection Layer)\n\n""""""\nPhase-7 Abuse Protection Provider — Interface and Mock Implementation\n\nPIN-399 Phase-7: Mock provider must be behavior-compatible with real provider.",\nPhase-7 Abuse Protection Provider — Interface and Mock Implementation\n\nPIN-399 Phase-7: Mock provider must be behavior-compatible with real provider.\n\nDESIGN INVARIANTS (LOCKED):\n- ABUSE-004: Protection providers are swappable behind a fixed interface\n- ABUSE-005: Mock provider must be behavior-compatible with real provider\n\nIMPLEMENTATION CONSTRAINTS:\n- Deterministic thresholds\n- Static configs\n- No external calls\n- No ML\n\nORDERING RULE (Critical):\n    Checks execute in this order:\n    1. Rate,,NEEDS_CLASSIFICATION,ITERATION_1,Protection logic,TRANSFER
656,app/quarantine/founder_review.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/engines/founder_review.py,"# Layer: L2 — Product APIs\n# Product: founder-console (fops.agenticverz.com)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Founder Review API - contract approval/rejection gate\n# Callers: Founder Console (frontend)\n# Allowed Imports: L3, L4, L6\n# Forbidden Imports: L1, L5\n# Reference: PIN-293, PART2_CRM_WORKFLOW_CHARTER.md, part2-design-v1\n\n""""""\nFounder Review API (L2)\n\nProvides Founder-only endpoints for contract review.",\nFounder Review API (L2)\n\nProvides Founder-only endpoints for contract review.\nThis is the LAST human authority insertion point in the governance workflow.\n\nEndpoints:\n  GET  /founder/contracts/review-queue       - List ELIGIBLE contracts\n  GET  /founder/contracts/{contract_id}      - Get contract details\n  POST /founder/contracts/{contract_id}/review - Submit APPROVE or REJECT\n\nAudience: FOUNDER ONLY\nSecurity: Requires Founder authentication\n\nHARD RULES (from PART2_CRM_WORKFLOW_CHARTER.md):\n- L,,NEEDS_CLASSIFICATION,ITERATION_1,Quarantine logic,TRANSFER
657,app/quarantine/founder_review_adapter.py,FOUNDER,ops,L3,app/houseofcards/founder/ops/facades/founder_review_adapter.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide (Part-2 CRM Workflow)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Translate Contract domain models to Founder Review views\n# Callers: founder_review.py (L2)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-293, PART2_CRM_WORKFLOW_CHARTER.md, part2-design-v1\n\n""""""\nFounder Review Adapter (L3)\n\nTranslates L4 Contract domain models to Founder-facing review views.",\nFounder Review Adapter (L3)\n\nTranslates L4 Contract domain models to Founder-facing review views.\n\nL4 (ContractService) → L3 (this adapter) → L2 (founder_review.py)\n\nThe adapter:\n1. Receives ContractState domain models from L4\n2. Selects/renames fields for Founder audience\n3. Returns FounderReviewView for L2\n\nHARD RULES (from PART2_CRM_WORKFLOW_CHARTER.md):\n- NO business logic (that's L4's job)\n- NO state transitions (that's L4's job)\n- NO eligibility decisions (that's L4's job)\n- NO permission,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
658,app/routing/__init__.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/__init__.py,"# M17/M18 - Cascade-Aware Routing Engine (CARE) + Learning Layer\n# Strategic router that routes based on agent Strategy Cascade\n# M18: Learning router with reputation, quarantine, hysteresis\n# M18.2: Governor, Feedback Loop, SLA-aware scoring, Explainability\n\nfrom .care import (\n    CAREEngine,\n    FairnessTracker,\n    PerformanceStore,\n    get_care_engine,\n    get_fairness_tracker,\n    get_performance_store,\n)\nfrom .feedback import (\n    BATCH_WINDOW,",,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/config/__init__.py,SKIP_INIT_COLLISION
659,app/routing/care.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/care.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: CARE-L routing algorithm core\n# Callers: API routes, runtime\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 CARE-L\n\n# M17 CARE - Cascade-Aware Routing Engine\n# Strategic router that routes based on agent Strategy Cascade\n#\n# 5-Stage Pipeline:",Redis-based rate limiter with per-policy limits.\n\nFalls back to no-op if Redis unavailable (degraded mode).,,NEEDS_CLASSIFICATION,ITERATION_1,Routing,TRANSFER
660,app/routing/feedback.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/feedback.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: CARE-L feedback loop processing\n# Callers: API routes\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 CARE-L\n\n# M18 Feedback Loop\n# Bidirectional reward loop between CARE-L (routing) and SBA Evolution (agents)\n#\n# Features:",Task priority levels for SLA weighting.,,NEEDS_CLASSIFICATION,ITERATION_1,Routing,TRANSFER
661,app/routing/governor.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/governor.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: CARE-L routing governor/throttling\n# Callers: API routes, workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 CARE-L\n\n# M18 Governor / Stabilization Layer\n# Prevents oscillation and overcorrection in the learning system\n#\n# Features:",System stability states.,,NEEDS_CLASSIFICATION,ITERATION_1,Routing,TRANSFER
662,app/routing/learning.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/learning.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: CARE-L learning from routing decisions\n# Callers: workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 CARE-L\n\n# M18 CARE-L Learning Engine\n# Adaptive routing based on historical performance\n#\n# Features:",Agent quarantine states.,,NEEDS_CLASSIFICATION,ITERATION_1,Routing,TRANSFER
663,app/routing/models.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/routing_models.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: CARE-L routing models and types\n# Callers: routing/*\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 CARE-L\n\n# M17 CARE - Routing Models\n# Pydantic models for Cascade-Aware Routing Engine\n\nfrom datetime import datetime, timezone",Success metrics derived from winning aspiration.,,NEEDS_CLASSIFICATION,ITERATION_1,Routing,TRANSFER
664,app/routing/probes.py,INTERNAL,platform,L6,app/houseofcards/internal/platform/drivers/probes.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler\n#   Execution: async\n# Role: CARE-L health probes for routing\n# Callers: scheduler\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: M18 CARE-L\n\n# M17 CARE - Capability Probes\n# Real-time capability checking with Redis caching\n\nimport asyncio",Real-time capability probing with Redis caching.\n\nProbes infrastructure dependencies to ensure agents can execute:\n- SMTP: Mail server reachability\n- DNS: DNS resolution working\n- API_KEY: Required API keys present and valid format\n- S3: Bucket reachability\n- HTTP: HTTP endpoint health\n- REDIS: Redis connectivity\n- DATABASE: Database connectivity\n- AGENT: Agent availability\n- SERVICE: Internal service health,,NEEDS_CLASSIFICATION,ITERATION_1,Routing,TRANSFER
665,app/runtime/failure_catalog.py,INTERNAL,platform,L4,app/houseofcards/internal/platform/engines/failure_catalog.py,"# Failure Catalog (M4.5 + M9 Persistence)\n""""""\nOffline failure catalog for structured error handling and recovery.\n\nProvides:\n1. Load and validate failure catalog from JSON\n2. Match error codes/messages to catalog entries\n3. Get recovery strategies and suggestions\n4. Support for exact, prefix, and regex matching\n5. [M9] Persist all matches to database for learning\n6. [M9] Prometheus metrics for failure tracking\n\nDesign Principles:\n- Offline-first: No runtime dependencies, works standalone\n- Deterministic: Same input produces same match result","\nOffline failure catalog for structured error handling and recovery.\n\nProvides:\n1. Load and validate failure catalog from JSON\n2. Match error codes/messages to catalog entries\n3. Get recovery strategies and suggestions\n4. Support for exact, prefix, and regex matching\n5. [M9] Persist all matches to database for learning\n6. [M9] Prometheus metrics for failure tracking\n\nDesign Principles:\n- Offline-first: No runtime dependencies, works standalone\n- Deterministic: Same input produces same match resu",,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
666,app/runtime/limits/__init__.py,INTERNAL,platform,L4,app/houseofcards/internal/platform/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: runtime\n#   Execution: sync\n# Role: Limits runtime evaluation (PIN-LIM-03)\n# Callers: services/limits/*, worker/runtime/*\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: LIMITS_MANAGEMENT_AUDIT.md, Evaluation Order Contract\n\n""""""\nLimits Runtime Package\n\nProvides deterministic limit evaluation at runtime:",\nLimits Runtime Package\n\nProvides deterministic limit evaluation at runtime:\n- LimitsEvaluator: Core decision engine\n- OverrideResolver: Apply active overrides\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/domain/__init__.py,SKIP_INIT_COLLISION
667,app/runtime/limits/evaluator.py,INTERNAL,platform,L4,app/houseofcards/internal/platform/engines/evaluator.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: runtime\n#   Execution: sync\n# Role: Core limits evaluation engine (PIN-LIM-03)\n# Callers: services/limits/simulation_service.py, worker/runtime/*\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Evaluation Order Contract (Section B)\n\n""""""\nLimits Evaluator (PIN-LIM-03)\n\nThe single deterministic decision engine for all limit checks.","\nLimits Evaluator (PIN-LIM-03)\n\nThe single deterministic decision engine for all limit checks.\nThis is the CRITICAL piece that makes limits enforcement work.\n\nEvaluation Order (HARD → SOFT):\n1. Tenant Quotas (HARD, PLAN-LOCKED)\n2. Active Overrides (TEMPORARY MUTATION)\n3. Policy Limits (HARD unless advisory)\n4. Worker Limits (HARD)\n5. Cost Budgets (SOFT by default, HARD if flagged)\n\nAlgorithm (Normative):\n- FOR each limit_group IN ordered_groups:\n    - resolve_effective_limit(limit_group, overrid",,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
668,app/runtime/limits/override_resolver.py,INTERNAL,platform,L4,app/houseofcards/internal/platform/engines/override_resolver.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: runtime\n#   Execution: sync\n# Role: Override resolution for limits evaluation (PIN-LIM-05)\n# Callers: runtime/limits/evaluator.py, services/limits/simulation_service.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Override Resolver (Section C10)\n\n""""""\nOverride Resolver (PIN-LIM-05)\n\nResolves and applies active overrides during limit evaluation.",\nOverride Resolver (PIN-LIM-05)\n\nResolves and applies active overrides during limit evaluation.\n\nResponsibilities:\n- Check override validity window\n- Merge override values\n- Prevent override stacking abuse\n- Track applied overrides for audit\n,,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
669,app/runtime/replay.py,INTERNAL,platform,L4,app/houseofcards/internal/platform/engines/replay.py,"""""""\nReplay API for AOS\nM6 Deliverable: Re-execute stored plans and verify determinism\n\nThis module provides the ability to replay a previously executed run\nand verify that the runtime behavior is deterministic.\n\nFROZEN SEMANTICS (PIN-198, S6 Trace Integrity Truth):\n- emit_traces=False is the DEFAULT and must remain so\n- Replay is OBSERVATIONAL - it must not emit traces\n- Replay must not generate new IDs during verification\n- Replay must not consult wall-clock time\nSee LESSONS_ENFORCED.md Invariant #14: Replay Is Observational\n""""""\n","\nReplay API for AOS\nM6 Deliverable: Re-execute stored plans and verify determinism\n\nThis module provides the ability to replay a previously executed run\nand verify that the runtime behavior is deterministic.\n\nFROZEN SEMANTICS (PIN-198, S6 Trace Integrity Truth):\n- emit_traces=False is the DEFAULT and must remain so\n- Replay is OBSERVATIONAL - it must not emit traces\n- Replay must not generate new IDs during verification\n- Replay must not consult wall-clock time\nSee LESSONS_ENFORCED.md Invariant ",,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
670,app/runtime_projections/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# Layer: L3 — Boundary Adapters\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Runtime data projection for Aurora UI panels (DEPRECATED)\n# Callers: Frontend via slot binding\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2\n# Reference: PIN-411\n\n""""""\nRuntime Projections Module\n\nSTATUS: DEPRECATED - All domains consolidated into unified facades",\nRuntime Projections Module\n\nSTATUS: DEPRECATED - All domains consolidated into unified facades\n\nAll runtime projection endpoints have been moved to unified domain facades:\n\n| Domain       | Old Path                      | New Unified Facade              |\n|--------------|-------------------------------|---------------------------------|\n| Activity     | /api/v1/runtime/activity/*    | /api/v1/activity/*              |\n| Incidents    | /api/v1/runtime/incidents/*   | /api/v1/incidents/*         ,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
671,app/schemas/__init__.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/__init__.py,"# NOVA Schemas Package\n# Pydantic models for Plan, Skills, Agents, and Artifacts\n# JSON Schemas for M0 machine-native contracts\n\nimport json\nfrom pathlib import Path\n\nfrom .agent import (\n    AgentCapabilities,\n    AgentConfig,\n    PlannerConfig,\n)\nfrom .artifact import (\n    Artifact,\n    ArtifactType,",Load a JSON schema by name (without .schema.json extension).,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
672,app/schemas/agent.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/agent.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Agent API request/response schemas\n# Callers: API routes\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: API Schemas\n\n# Agent Schemas\n# Pydantic models for Agent capabilities and configuration\n\nfrom datetime import datetime, timezone",Agent operational status.,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema); Domain uncertain,TRANSFER
673,app/schemas/artifact.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/artifact.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Artifact API schemas\n# Callers: API routes\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: API Schemas\n\n# Artifact Schemas\n# Pydantic models for run outputs and artifacts\n\nfrom datetime import datetime, timezone",Type of artifact produced by a run.,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema); Domain uncertain,TRANSFER
674,app/schemas/cus_schemas.py,CUSTOMER,integrations,L6,app/houseofcards/customer/integrations/schemas/cus_schemas.py,"# Layer: L6 — Platform Substrate (Schemas)\n# AUDIENCE: CUSTOMER\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Pydantic schemas for Customer Integration domain (LLM BYOK, SDK, RAG)\n# Callers: aos_cus_integrations.py, cus_telemetry.py APIs\n# Allowed Imports: cus_models.py (enums only)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Connectivity Domain - Customer Console v1 Constitution\n\n""""""Customer Integrations API Schemas\n\nPURPOSE:",Customer Integrations API Schemas\n\nPURPOSE:\n    Pydantic request/response models for the Customer Integrations API surface.\n    These schemas define the contract between SDK/clients and the backend.\n\nSCHEMAS:\n    Request Schemas:\n    - CusIntegrationCreate: Create a new integration\n    - CusIntegrationUpdate: Update integration settings\n    - CusLLMUsageIngest: Telemetry ingestion from SDK\n\n    Response Schemas:\n    - CusIntegrationResponse: Full integration details\n    - CusIntegrationSummary: ,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
675,app/schemas/limits/__init__.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/schemas/__init__.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Limits domain schemas (PIN-LIM)\n# Callers: api/limits/*, services/limits/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: LIMITS_MANAGEMENT_AUDIT.md\n\n""""""\nLimits Domain Schemas\n\nProvides request/response models for:",\nLimits Domain Schemas\n\nProvides request/response models for:\n- Policy limits CRUD\n- Policy rules CRUD\n- Limit simulation (pre-execution check)\n- Limit overrides (temporary increases)\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
676,app/schemas/limits/overrides.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/schemas/overrides.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Limit override request/response schemas\n# Callers: api/limits/override.py, services/limits/override_service.py\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-LIM-05\n\n""""""\nLimit Override Schemas (PIN-LIM-05)\n\nRequest and response models for temporary limit increases.",\nLimit Override Schemas (PIN-LIM-05)\n\nRequest and response models for temporary limit increases.\nOverrides allow customers to request and apply temporary limit increases\nwith proper audit trail.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
677,app/schemas/limits/policy_limits.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/schemas/policy_limits.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Policy limits request/response schemas\n# Callers: api/policies.py, services/limits/policy_limits_service.py\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-LIM-01\n\n""""""\nPolicy Limits Schemas (PIN-LIM-01)\n\nRequest and response models for policy limit CRUD operations.",\nPolicy Limits Schemas (PIN-LIM-01)\n\nRequest and response models for policy limit CRUD operations.\nEnforces schema contract between API and service layer.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
678,app/schemas/limits/policy_rules.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/schemas/policy_rules.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Policy rules request/response schemas\n# Callers: api/policies.py, services/limits/policy_rules_service.py\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-LIM-02\n\n""""""\nPolicy Rules Schemas (PIN-LIM-02)\n\nRequest and response models for policy rule CRUD operations.",\nPolicy Rules Schemas (PIN-LIM-02)\n\nRequest and response models for policy rule CRUD operations.\nRules define governance constraints that govern LLM Run behavior.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
679,app/schemas/limits/simulation.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/schemas/simulation.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Limit simulation request/response schemas\n# Callers: api/limits/simulate.py, services/limits/simulation_service.py\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-LIM-04\n\n""""""\nLimit Simulation Schemas (PIN-LIM-04)\n\nRequest and response models for pre-execution limit checks.",\nLimit Simulation Schemas (PIN-LIM-04)\n\nRequest and response models for pre-execution limit checks.\nThe simulation endpoint allows dry-run verification against all limits\nbefore actually executing a run.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
680,app/schemas/plan.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/plan.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Plan API schemas\n# Callers: API routes\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: API Schemas\n\n# Plan Schemas\n# Pydantic models for Plan and PlanStep definitions\n\nfrom datetime import datetime, timezone",What to do when a step fails.,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema); Domain uncertain,TRANSFER
681,app/schemas/response.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/response.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Standard API response envelope for consistent client experience\n# Callers: All API routes (L2)\n# Allowed Imports: None (foundational schema)\n# Forbidden Imports: L1, L3, L4, L5, L6\n# Reference: API-002 Guardrail (Response Envelope Consistency)\n\n""""""\nStandard API Response Envelope\n\nThis module provides the standard response format for all API endpoints.","\nStandard API Response Envelope\n\nThis module provides the standard response format for all API endpoints.\nConsistent response structures enable:\n- Predictable error handling in clients\n- Request tracing via metadata\n- Pagination support\n- SDK code generation\n\nStandard format:\n    {\n        ""success"": true,\n        ""data"": { ... },\n        ""meta"": {\n            ""timestamp"": ""2024-01-15T10:30:00Z"",\n            ""request_id"": ""req-abc123""\n        }\n    }\n\nUsage:\n    from app.schemas.response import ",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema); Domain uncertain,TRANSFER
682,app/schemas/retry.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/schemas/retry.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Retry API schemas\n# Callers: API routes\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: API Schemas\n\n# Retry Policy Schemas\n# Defines retry behavior and backoff strategies\n\nfrom enum import Enum",Backoff strategy for retries.,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema),TRANSFER
683,app/schemas/skill.py,CUSTOMER,general,L6,app/houseofcards/customer/general/schemas/skill.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Skill API schemas\n# Callers: API routes\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: API Schemas\n\n# Skill I/O Schemas\n# Pydantic models for skill input/output validation\n\nfrom datetime import datetime",Skill execution status.,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Data Layer (Schema); Domain uncertain,TRANSFER
684,app/secrets/__init__.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/__init__.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Secrets management package marker\n# Callers: Secrets imports\n# Allowed Imports: None\n# Forbidden Imports: None\n# Reference: Package Structure\n\n""""""Secrets management module.""""""\n\nfrom .vault_client import (\n    VaultClient,",Secrets management module.,,NEEDS_CLASSIFICATION,ITERATION_1,Secrets; Domain uncertain,TRANSFER
685,app/secrets/vault_client.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/vault_client.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: HashiCorp Vault client for secret retrieval\n# Callers: config, services needing secrets\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Security\n\n""""""\nHashiCorp Vault client for secrets management.\n\nThis module provides a thin wrapper around Vault's KV v2 secrets engine",\nHashiCorp Vault client for secrets management.\n\nThis module provides a thin wrapper around Vault's KV v2 secrets engine\nfor loading secrets at application startup.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Secrets; Domain uncertain,TRANSFER
686,app/security/__init__.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/__init__.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Reference: PIN-052\n\n""""""\nSecurity utilities for AOS.\n\nModules:\n- sanitize: Text sanitization for embeddings to prevent secret leakage\n""""""\n\nfrom .sanitize import (\n    is_safe_for_embedding,\n    sanitize,\n    sanitize_error_message,",\nSecurity utilities for AOS.\n\nModules:\n- sanitize: Text sanitization for embeddings to prevent secret leakage\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/secrets/__init__.py,SKIP_INIT_COLLISION
687,app/security/sanitize.py,INTERNAL,recovery,L6,app/houseofcards/internal/recovery/drivers/sanitize.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Sanitize text before embedding to prevent secret leakage\n# Callers: vector_store.py, recovery_matcher.py, iaec.py\n# Allowed Imports: None (pure functions)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-052\n\n""""""\nSecurity Sanitization for Embedding Operations\n\nPrevents secrets, PII, and sensitive data from being embedded and stored","\nSecurity Sanitization for Embedding Operations\n\nPrevents secrets, PII, and sensitive data from being embedded and stored\nin vector databases. This is critical for data security compliance.\n\nPatterns removed:\n- API keys (various formats)\n- Passwords and secrets in error messages\n- Bearer tokens\n- Connection strings with credentials\n- Email addresses\n- IP addresses (optional)\n- Credit card numbers\n- SSN patterns\n\nPIN-052: Data Ownership & Embedding Security\n",,NEEDS_CLASSIFICATION,ITERATION_1,Security,TRANSFER
688,app/services/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/__init__.py,"# app/services/__init__.py\n""""""Service layer for business logic.""""""\n\nfrom .event_emitter import (\n    EntityType,\n    EventEmitter,\n    EventEmitterError,\n    EventType,\n    OpsEvent,\n    get_event_emitter,\n)\nfrom .recovery_matcher import RecoveryMatcher\nfrom .tenant_service import (\n    QuotaExceededError,\n    TenantService,",Service layer for business logic.,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
689,app/services/accounts_facade.py,CUSTOMER,account,L3,app/houseofcards/customer/account/facades/accounts_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB reads/writes)\n# Role: Accounts domain facade - unified entry point for account management\n# Callers: L2 accounts API (accounts.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Customer Console v1 Constitution\n#\n""""""\nAccounts Domain Facade (L4)\n","\nAccounts Domain Facade (L4)\n\nUnified facade for all accounts domain operations:\n- Projects: list, detail\n- Users: list, detail, invite, remove, update role\n- Profile: get, update\n- Billing: summary, invoices\n- Support: contact, tickets\n\nGOVERNANCE NOTE:\nAccount is NOT a domain - it manages who, what, and billing (not what happened).\nAccount pages MUST NOT display executions, incidents, policies, or logs.\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
690,app/services/activity/__init__.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/engines/__init__.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Activity domain services package\n""""""Activity domain services.""""""\n\nfrom app.services.activity.attention_ranking_service import AttentionRankingService\nfrom app.services.activity.cost_analysis_service import CostAnalysisService\nfrom app.services.activity.pattern_detection_service import PatternDetectionService\nfrom app.services.activity.signal_feedback_service import (\n    AcknowledgeResult,\n    SignalFeedbackService,\n    SuppressResult,\n)\nfrom app.services.activity.signal_identity import compute_signal_fingerprint_from_row",Activity domain services.,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
691,app/services/activity/attention_ranking_service.py,CUSTOMER,activity,L4,app/houseofcards/customer/activity/engines/attention_ranking_service.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Attention ranking service for activity signals\n""""""Attention ranking service for prioritizing signals.""""""\n\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom typing import Any, Optional\n\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\n\n@dataclass\nclass AttentionSignal:",Attention ranking service for prioritizing signals.,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
692,app/services/activity/cost_analysis_service.py,CUSTOMER,activity,L4,app/houseofcards/customer/activity/engines/cost_analysis_service.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Cost analysis service for activity signals\n""""""Cost analysis service for detecting cost anomalies.""""""\n\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom typing import Optional\n\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\n\n@dataclass\nclass CostAnomaly:",Cost analysis service for detecting cost anomalies.,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
693,app/services/activity/pattern_detection_service.py,CUSTOMER,activity,L4,app/houseofcards/customer/activity/engines/pattern_detection_service.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Pattern detection service for activity signals\n""""""Pattern detection service for identifying recurring patterns.""""""\n\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom typing import Optional\n\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\n\n@dataclass\nclass DetectedPattern:",Pattern detection service for identifying recurring patterns.,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
694,app/services/activity/signal_feedback_service.py,CUSTOMER,activity,L4,app/houseofcards/customer/activity/engines/signal_feedback_service.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Signal feedback service for acknowledging/suppressing signals\n""""""Signal feedback service for user interactions with signals.""""""\n\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom typing import Optional\n\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\n\n@dataclass\nclass AcknowledgeResult:",Signal feedback service for user interactions with signals.,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
695,app/services/activity/signal_identity.py,CUSTOMER,activity,L5,app/houseofcards/customer/activity/engines/signal_identity.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Role: Signal identity computation for deduplication\n""""""Signal identity utilities for fingerprinting and deduplication.""""""\n\nimport hashlib\nimport json\nfrom typing import Any\n\n\ndef compute_signal_fingerprint_from_row(row: dict[str, Any]) -> str:\n    """"""\n    Compute a stable fingerprint for a signal row.\n",Signal identity utilities for fingerprinting and deduplication.,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
696,app/services/activity_facade.py,CUSTOMER,activity,L3,app/houseofcards/customer/activity/facades/activity_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: internal (called by L2 API)\n#   Execution: async\n# Role: Activity Facade - Centralized access to activity domain operations\n# Callers: app.api.activity (L2)\n# Allowed Imports: L6, services within L4\n# Forbidden Imports: L1, L2, L5\n# Reference: Activity Domain - One Facade Architecture, W4 Pattern\n\n""""""\nActivity Facade (L4)\n",\nActivity Facade (L4)\n\nProvides unified access to activity domain operations.\nThis is the single entry point for all activity business logic.\n\nOperations:\n- get_runs: List runs with filters\n- get_run_detail: Get run details (O3)\n- get_run_evidence: Get run evidence context (O4)\n- get_run_proof: Get run integrity proof (O5)\n- get_status_summary: Get runs grouped by status\n- get_patterns: Pattern detection (SIG-O3)\n- get_cost_analysis: Cost anomalies (SIG-O4)\n- get_attention_queue: Attention ranki,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
697,app/services/ai_console_panel_adapter/__init__.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/__init__.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Module exports for AI Console Panel Adapter\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nAI Console Panel Adapter — L2.1 Panel Evaluation Layer\n\nThis module transforms raw backend API responses into spec-compliant\npanel responses with truth metadata, verification signals, and provenance.\n\nMain Entry Points:\n    - AIConsolePanelEngine: Main orchestration engine\n    - get_panel_engine(): Get singleton engine instance\n    - create_panel_engine(): Factory for custom instances","\nAI Console Panel Adapter — L2.1 Panel Evaluation Layer\n\nThis module transforms raw backend API responses into spec-compliant\npanel responses with truth metadata, verification signals, and provenance.\n\nMain Entry Points:\n    - AIConsolePanelEngine: Main orchestration engine\n    - get_panel_engine(): Get singleton engine instance\n    - create_panel_engine(): Factory for custom instances\n\nArchitecture (Option A: Spec Interpreter):\n    1. Load YAML spec (panel definitions, dependencies, determinism",,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
698,app/services/ai_console_panel_adapter/ai_console_panel_engine.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/ai_console_panel_engine.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Main orchestration engine for panel evaluation\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nAI Console Panel Engine — Main orchestration for panel evaluation\n\nOrchestrates the complete panel evaluation pipeline:\n1. Load spec → resolve dependencies → collect signals\n2. Verify inputs → evaluate slots → check consistency\n3. Assemble response → emit metrics\n\nThis is Option A: Spec Interpreter pattern.\n""""""",\nAI Console Panel Engine — Main orchestration for panel evaluation\n\nOrchestrates the complete panel evaluation pipeline:\n1. Load spec → resolve dependencies → collect signals\n2. Verify inputs → evaluate slots → check consistency\n3. Assemble response → emit metrics\n\nThis is Option A: Spec Interpreter pattern.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
699,app/services/ai_console_panel_adapter/intent_guardrails.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/intent_guardrails.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Phase A Intent Guardrails (design-time validation)\n# Reference: PIN-420, L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nIntent Guardrails — Phase A of two-phase semantic validation.\n\nThese rules validate intent YAML at design-time, BEFORE any SDSR or API calls.\n\nCRITICAL INVARIANT:\n    Phase A rules must NEVER depend on SDSR or APIs.\n    Phase A rules judge whether an idea is allowed to exist.\n\nFix Owner: Product / Architecture","\nIntent Guardrails — Phase A of two-phase semantic validation.\n\nThese rules validate intent YAML at design-time, BEFORE any SDSR or API calls.\n\nCRITICAL INVARIANT:\n    Phase A rules must NEVER depend on SDSR or APIs.\n    Phase A rules judge whether an idea is allowed to exist.\n\nFix Owner: Product / Architecture\nTrigger: sync from intent ledger, adding/modifying intent YAML\n\nChecks:\n    INT-001: Signal provability\n    INT-002: Capability cardinality\n    INT-003: Semantic duplication\n    INT-004: ",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
700,app/services/ai_console_panel_adapter/panel_capability_resolver.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/panel_capability_resolver.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Resolve capability IDs to endpoints via AURORA registry\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml, AURORA_L2_CAPABILITY_REGISTRY\n\n""""""\nPanel Capability Resolver — Binds panels to capabilities, not endpoints.\n\nCore principle:\n    Panels bind to capability IDs (semantic).\n    Endpoints are resolved via AURORA capability registry (reality).\n    Only OBSERVED/TRUSTED capabilities may be called.\n\nThis enforces:\n    - GAP 6 fix: Capability registry now used","\nPanel Capability Resolver — Binds panels to capabilities, not endpoints.\n\nCore principle:\n    Panels bind to capability IDs (semantic).\n    Endpoints are resolved via AURORA capability registry (reality).\n    Only OBSERVED/TRUSTED capabilities may be called.\n\nThis enforces:\n    - GAP 6 fix: Capability registry now used\n    - GAP 4 fix: SDSR observation status checked before calls\n    - Clean separation: spec = meaning, registry = plumbing\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
701,app/services/ai_console_panel_adapter/panel_consistency_checker.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/panel_consistency_checker.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Cross-slot consistency enforcement\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Consistency Checker — Cross-slot consistency rules\n\nChecks that output signals across slots in a panel are consistent.\nInconsistencies are violations, not warnings.\n""""""\n\nimport logging\nfrom dataclasses import dataclass, field\nfrom typing import Any, Dict, List, Optional","\nPanel Consistency Checker — Cross-slot consistency rules\n\nChecks that output signals across slots in a panel are consistent.\nInconsistencies are violations, not warnings.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
702,app/services/ai_console_panel_adapter/panel_dependency_resolver.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/panel_dependency_resolver.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Resolve panel dependencies and evaluation order\n# Reference: L2_1_PANEL_DEPENDENCY_GRAPH.yaml\n\n""""""\nPanel Dependency Resolver — Resolve evaluation order for panels\n\nDetermines which panels must be evaluated before others based on\nthe dependency graph. Supports short-circuit evaluation.\n""""""\n\nfrom typing import Dict, List, Optional, Set\n\nfrom .panel_types import DependencySpec",\nPanel Dependency Resolver — Resolve evaluation order for panels\n\nDetermines which panels must be evaluated before others based on\nthe dependency graph. Supports short-circuit evaluation.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
703,app/services/ai_console_panel_adapter/panel_metrics_emitter.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/panel_metrics_emitter.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Emit Prometheus metrics for panel evaluation\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Metrics Emitter — Prometheus metrics for panel adapter\n\nEmits counters, histograms, and gauges for:\n- Panel evaluation latency\n- Slot evaluation counts\n- Verification signal counts\n- Consistency violation counts\n- Authority distribution\n""""""","\nPanel Metrics Emitter — Prometheus metrics for panel adapter\n\nEmits counters, histograms, and gauges for:\n- Panel evaluation latency\n- Slot evaluation counts\n- Verification signal counts\n- Consistency violation counts\n- Authority distribution\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
704,app/services/ai_console_panel_adapter/panel_response_assembler.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/panel_response_assembler.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Assemble final panel response envelope\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Response Assembler — Assemble spec-compliant response envelope\n\nConstructs the final JSON response structure from evaluated slots,\nconsistency results, and metadata.\n""""""\n\nimport logging\nfrom dataclasses import asdict\nfrom datetime import datetime, timezone","\nPanel Response Assembler — Assemble spec-compliant response envelope\n\nConstructs the final JSON response structure from evaluated slots,\nconsistency results, and metadata.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
705,app/services/ai_console_panel_adapter/panel_signal_collector.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/panel_signal_collector.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Collect raw signals from backend APIs via capability resolution\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Signal Collector — Capability-Bound API I/O for panel evaluation\n\nV2.0: Now resolves capabilities via AURORA registry instead of direct paths.\n\nCore principle:\n    - Slots declare capability IDs (semantic)\n    - This collector resolves to endpoints via AURORA registry\n    - Only OBSERVED/TRUSTED capabilities are callable\n    - Non-callable capabilities surface as negative authority",\nPanel Signal Collector — Capability-Bound API I/O for panel evaluation\n\nV2.0: Now resolves capabilities via AURORA registry instead of direct paths.\n\nCore principle:\n    - Slots declare capability IDs (semantic)\n    - This collector resolves to endpoints via AURORA registry\n    - Only OBSERVED/TRUSTED capabilities are callable\n    - Non-callable capabilities surface as negative authority\n\nThis enforces:\n    - GAP 6 fix: Capability registry now used\n    - GAP 4 fix: SDSR observation status check,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
706,app/services/ai_console_panel_adapter/panel_signal_translator.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/panel_signal_translator.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Translate spec signals to API field names\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Signal Translator — Maps semantic signals to API fields.\n\nCore principle:\n    Spec signals are SEMANTIC (what customers understand).\n    API fields are IMPLEMENTATION (what backend returns).\n    This layer absorbs the translation.\n\nBenefits:\n    - Spec remains stable even when APIs change field names","\nPanel Signal Translator — Maps semantic signals to API fields.\n\nCore principle:\n    Spec signals are SEMANTIC (what customers understand).\n    API fields are IMPLEMENTATION (what backend returns).\n    This layer absorbs the translation.\n\nBenefits:\n    - Spec remains stable even when APIs change field names\n    - Semantic naming in spec, implementation naming in backend\n    - Single place to fix mismatches\n    - API field changes don't break panel spec\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
707,app/services/ai_console_panel_adapter/panel_slot_evaluator.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/panel_slot_evaluator.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Evaluate individual panel slots\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Slot Evaluator — Execute slot evaluation logic\n\nEvaluates a slot given collected signals and verification results.\nComputes derived output signals.\n""""""\n\nimport logging\nfrom datetime import datetime, timezone\nfrom typing import Any, Callable, Dict, Optional",\nPanel Slot Evaluator — Execute slot evaluation logic\n\nEvaluates a slot given collected signals and verification results.\nComputes derived output signals.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
708,app/services/ai_console_panel_adapter/panel_spec_loader.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/panel_spec_loader.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Load and parse L2.1 Panel Adapter YAML spec\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Spec Loader — Load YAML specification for AI Console panels\n\nLoads:\n- L2_1_PANEL_ADAPTER_SPEC.yaml — panel definitions\n- L2_1_PANEL_DEPENDENCY_GRAPH.yaml — evaluation order\n- L2_1_SLOT_DETERMINISM_MATRIX.csv — determinism rules\n""""""\n\nimport csv",\nPanel Spec Loader — Load YAML specification for AI Console panels\n\nLoads:\n- L2_1_PANEL_ADAPTER_SPEC.yaml — panel definitions\n- L2_1_PANEL_DEPENDENCY_GRAPH.yaml — evaluation order\n- L2_1_SLOT_DETERMINISM_MATRIX.csv — determinism rules\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
709,app/services/ai_console_panel_adapter/panel_types.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/panel_types.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Shared type primitives for Panel Adapter\n# Reference: L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nPanel Types — Shared primitives for AI Console Panel Adapter\n\nAll type definitions used across the panel adapter system.\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime\nfrom enum import Enum\nfrom typing import Any, Dict, List, Optional",\nPanel Types — Shared primitives for AI Console Panel Adapter\n\nAll type definitions used across the panel adapter system.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
710,app/services/ai_console_panel_adapter/panel_verification_engine.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/panel_verification_engine.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Determinism verification and input validation\n# Reference: L2_1_SLOT_DETERMINISM_MATRIX.csv\n\n""""""\nPanel Verification Engine — Determinism enforcement\n\nVerifies inputs and enforces determinism rules.\nHard failures on violations. No best-effort.\n""""""\n\nimport logging\nfrom typing import Any, Dict, List, Optional, Tuple\n",\nPanel Verification Engine — Determinism enforcement\n\nVerifies inputs and enforces determinism rules.\nHard failures on violations. No best-effort.\n,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
711,app/services/ai_console_panel_adapter/semantic_failures.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/semantic_failures.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Semantic failure taxonomy and fix guidance\n# Reference: PIN-420\n\n""""""\nSemantic Failures — Canonical failure taxonomy for two-phase validation.\n\nTwo Phases:\n- Phase A: Intent Guardrails (INT-*) — design-time, human-facing\n- Phase B: Semantic Reality (SEM-*) — proof-time, system-facing\n\nEach failure code has:\n- Name: Human-readable name\n- Class: INTENT_VIOLATION or SEMANTIC_VIOLATION","\nSemantic Failures — Canonical failure taxonomy for two-phase validation.\n\nTwo Phases:\n- Phase A: Intent Guardrails (INT-*) — design-time, human-facing\n- Phase B: Semantic Reality (SEM-*) — proof-time, system-facing\n\nEach failure code has:\n- Name: Human-readable name\n- Class: INTENT_VIOLATION or SEMANTIC_VIOLATION\n- Severity: BLOCKING or WARNING\n- Fix Owner: Who is responsible for fixing\n- Fix Action: What action to take\n\nThis taxonomy ensures violations are actionable, not just noise.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
712,app/services/ai_console_panel_adapter/semantic_types.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/semantic_types.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Type definitions for semantic validation\n# Reference: PIN-420, L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nSemantic Types — Core structures for two-phase semantic validation.\n\nTwo-Phase Architecture:\n    Phase A: Intent Guardrails (design-time, human-facing)\n    Phase B: Semantic Reality (proof-time, system-facing)\n\nKey Invariant:\n    - Intent rules must never depend on SDSR or APIs\n    - Semantic rules must never judge human intent quality","\nSemantic Types — Core structures for two-phase semantic validation.\n\nTwo-Phase Architecture:\n    Phase A: Intent Guardrails (design-time, human-facing)\n    Phase B: Semantic Reality (proof-time, system-facing)\n\nKey Invariant:\n    - Intent rules must never depend on SDSR or APIs\n    - Semantic rules must never judge human intent quality\n\nThese types enforce semantic authority in the panel pipeline.\nSemantics are declared in intent, validated mechanically, enforced everywhere.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
713,app/services/ai_console_panel_adapter/semantic_validator.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/semantic_validator.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Semantic validation gate — enforce semantic authority\n# Reference: PIN-420, L2_1_PANEL_ADAPTER_SPEC.yaml\n\n""""""\nSemantic Validator — Force semantic authority in the panel pipeline.\n\nCore Principle:\n    Semantics must be declared once, validated mechanically, enforced everywhere.\n\nThis validator sits between SDSR and HISAR binding:\n    SDSR (API works?) → Semantic Validator → HISAR (bind or block)\n\nIt enforces:","\nSemantic Validator — Force semantic authority in the panel pipeline.\n\nCore Principle:\n    Semantics must be declared once, validated mechanically, enforced everywhere.\n\nThis validator sits between SDSR and HISAR binding:\n    SDSR (API works?) → Semantic Validator → HISAR (bind or block)\n\nIt enforces:\n    1. Signal Completeness - Every signal has translation OR compute function\n    2. Capability Reality - Every capability is OBSERVED or TRUSTED\n    3. API Field Presence - Every translated field ",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
714,app/services/ai_console_panel_adapter/validator_engine.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/validator_engine.py,"# Layer: L2.1 — Panel Adapter Layer\n# Product: ai-console\n# Role: Two-phase semantic validation orchestrator\n# Reference: PIN-420\n\n""""""\nValidator Engine — Two-phase semantic validation orchestrator.\n\nThis engine runs:\n    Phase A: Intent Guardrails (design-time, human-facing)\n    Phase B: Semantic Reality (proof-time, system-facing)\n\nKey Invariant:\n    Phase A rules must NEVER depend on SDSR or APIs.\n    Phase B rules must NEVER judge human intent quality.","\nValidator Engine — Two-phase semantic validation orchestrator.\n\nThis engine runs:\n    Phase A: Intent Guardrails (design-time, human-facing)\n    Phase B: Semantic Reality (proof-time, system-facing)\n\nKey Invariant:\n    Phase A rules must NEVER depend on SDSR or APIs.\n    Phase B rules must NEVER judge human intent quality.\n\nThe engine enforces ordering: Phase A MUST complete before Phase B runs.\nIf Phase A has BLOCKING violations, Phase B is skipped.\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
715,app/services/alert_emitter.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/alert_emitter.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Emit alerts for near-threshold and breach events\n# Callers: policy/prevention_engine.py\n# Allowed Imports: L4, L5, L6\n# Forbidden Imports: L1, L2\n# Reference: POLICY_CONTROL_LEVER_IMPLEMENTATION_PLAN.md PCL-007\n\n""""""\nAlert Emitter Service\n\nEmits alerts for threshold events via configured channels:","\nAlert Emitter Service\n\nEmits alerts for threshold events via configured channels:\n- UI notifications\n- Webhooks\n- Email (future)\n- Slack (future)\n\nAlert flow:\n1. ThresholdSignal created\n2. AlertEmitter checks AlertConfig\n3. If enabled and not throttled, send via configured channels\n4. Record alert sent status\n",,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
716,app/services/alert_fatigue.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/alert_fatigue.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker/api\n#   Execution: sync\n# Role: Alert deduplication and fatigue control\n# Callers: AlertEmitter (L3), EventReactor (L5)\n# Allowed Imports: L5, L6 (Redis, stdlib)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), Section 3.3\n\n""""""\nAlert Fatigue Controller\n\nProvides deduplication and fatigue controls for alerts:",\nAlert Fatigue Controller\n\nProvides deduplication and fatigue controls for alerts:\n\n1. Same-domain alert deduplication (within configurable window)\n2. Per-domain cooldown periods\n3. Per-tenant fatigue settings\n4. Sliding window rate limiting\n\nDesign Principles:\n1. Alerts are important - but too many alerts = no alerts\n2. Configurable per-tenant and per-domain\n3. Feature flag controlled for safe rollout\n4. Redis-backed for distributed deployment (optional)\n\nUsage:\n    from app.services.alert_fati,,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
717,app/services/alerts/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-049 (AlertFatigueController)\n""""""\nAlert Services (GAP-049)\n\nProvides alert fatigue management including rate limiting,\nsuppression, and aggregation of repetitive alerts.\n\nThis module provides:\n    - AlertFatigueController: Main service for fatigue management\n    - AlertFatigueConfig: Configuration for fatigue thresholds\n    - AlertFatigueState: State tracking for alert sources\n    - Helper functions for quick access\n""""""","\nAlert Services (GAP-049)\n\nProvides alert fatigue management including rate limiting,\nsuppression, and aggregation of repetitive alerts.\n\nThis module provides:\n    - AlertFatigueController: Main service for fatigue management\n    - AlertFatigueConfig: Configuration for fatigue thresholds\n    - AlertFatigueState: State tracking for alert sources\n    - Helper functions for quick access\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
718,app/services/alerts/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/alerts_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api or worker (alert processing)\n#   Execution: async\n# Role: Alerts Facade - Centralized access to alert operations\n# Callers: L2 alerts.py API, SDK, Worker\n# Allowed Imports: L4 alert services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-110 (Alert Configuration API), GAP-111 (Alert History API), GAP-124 (Alert Routing API)\n\n""""""\nAlerts Facade (L4 Domain Logic)\n\nThis facade provides the external interface for alert operations.","\nAlerts Facade (L4 Domain Logic)\n\nThis facade provides the external interface for alert operations.\nAll alert APIs MUST use this facade instead of directly importing\ninternal alert modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes alert configuration and routing\n- Provides unified access to alert history\n- Single point for audit emission\n\nL2 API Routes (GAP-110, GAP-111, GAP-124):\n- POST /api/v1/alerts/rules (create alert rule)\n- GET /api/v1/alerts/rules (list ale",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
719,app/services/alerts/fatigue_controller.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/fatigue_controller.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-049 (AlertFatigueController)\n""""""\nAlertFatigueController - Alert fatigue management service.\n\nManages alert fatigue through:\n- Rate limiting: Limit alerts per source per time window\n- Suppression: Temporarily suppress repetitive alerts\n- Aggregation: Group similar alerts together\n- Cool-down periods: Auto-suppress after threshold breaches\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timedelta, timezone",\nAlertFatigueController - Alert fatigue management service.\n\nManages alert fatigue through:\n- Rate limiting: Limit alerts per source per time window\n- Suppression: Temporarily suppress repetitive alerts\n- Aggregation: Group similar alerts together\n- Cool-down periods: Auto-suppress after threshold breaches\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
720,app/services/analytics_facade.py,CUSTOMER,analytics,L3,app/houseofcards/customer/analytics/facades/analytics_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: internal (called by L2 API)\n#   Execution: async\n# Role: Analytics Facade - Centralized access to analytics domain operations\n# Callers: app.api.analytics (L2)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Analytics Domain Declaration v1, PIN-411, W4 Pattern\n\n""""""\nAnalytics Facade (L4)\n",\nAnalytics Facade (L4)\n\nProvides unified access to analytics domain operations.\nThis is the single entry point for all analytics business logic.\n\nOperations:\n- get_usage_statistics: Get usage statistics for a time window\n- get_cost_statistics: Get cost statistics for a time window\n- get_status: Get analytics domain capability status\n\nSignal Sources:\n- cost_records (cost attribution)\n- llm.usage (LLM runs)\n- worker.execution (trace execution)\n- gateway.metrics (API gateway)\n\nReference: Analytics ,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
721,app/services/api_keys_facade.py,CUSTOMER,api_keys,L3,app/houseofcards/customer/api_keys/facades/api_keys_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB reads)\n# Role: API Keys domain facade - unified entry point for API key operations\n# Callers: L2 api-keys API (aos_api_key.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Connectivity Domain - Customer Console v1 Constitution\n#\n""""""\nAPI Keys Domain Facade (L4)\n",\nAPI Keys Domain Facade (L4)\n\nUnified facade for API key management operations.\n\nProvides:\n- List API keys (O2)\n- Get API key detail (O3)\n\nAPI keys are used for:\n- SDK authentication\n- Programmatic access to AOS APIs\n- RBAC-controlled permissions\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
722,app/services/audit/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Runtime Audit Contract (RAC) services\n# Callers: ROK (L5), Facades (L4), Scheduler (L5)\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nRuntime Audit Contract (RAC) Services\n\nThis module implements the audit infrastructure for cross-domain operations:",\nRuntime Audit Contract (RAC) Services\n\nThis module implements the audit infrastructure for cross-domain operations:\n\n- AuditExpectation: What MUST happen during a run\n- DomainAck: Acknowledgment that an action completed\n- AuditStore: Storage for expectations and acks\n- AuditReconciler: Validates expectations against acks\n\nThe RAC ensures:\n1. Silent failures are detected (expected - acked = missing)\n2. Unexpected actions are flagged (acked - expected = drift)\n3. Stale runs are identified (finali,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
723,app/services/audit/durability.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/audit_durability.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: RAC durability enforcement before acknowledgment\n# Callers: ROK (L5), Facades (L4), AuditReconciler (L4)\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-050 (RAC Durability Enforcement)\n\n""""""\nModule: durability\nPurpose: Enforce RAC durability before acknowledgment.\n",\nModule: durability\nPurpose: Enforce RAC durability before acknowledgment.\n\nThe rac_durability_enforce flag in GovernanceConfig controls whether\ndurability is strictly enforced before acknowledging audit operations.\n\nWhen enabled:\n    - Acks must be persisted to durable storage before being accepted\n    - Expectations must be durably stored before run starts\n    - In-memory-only mode raises RACDurabilityEnforcementError\n\nThis ensures audit contracts survive crashes and can be reconciled\neven if ,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
724,app/services/audit/models.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/audit_models.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Runtime Audit Contract models\n# Callers: AuditStore, AuditReconciler, ROK, Facades\n# Allowed Imports: L6 (stdlib only)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nRuntime Audit Contract (RAC) Models\n\nThese models define the data structures for the audit system:",\nRuntime Audit Contract (RAC) Models\n\nThese models define the data structures for the audit system:\n\n- AuditExpectation: Declares what action MUST happen for a run\n- DomainAck: Reports that an action has completed\n- ReconciliationResult: Result of comparing expectations vs acks\n\nDesign Principles:\n1. Immutable after creation (expectations are contracts)\n2. UUID-based for correlation across domains\n3. Serializable for Redis storage\n4. Type-safe with enums for domains and actions\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
725,app/services/audit/reconciler.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/audit_reconciler.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler/ROK\n#   Execution: sync\n# Role: Reconcile audit expectations against acknowledgments\n# Callers: ROK (L5), Scheduler (L5)\n# Allowed Imports: L4 (audit models/store), L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nAudit Reconciler\n\nPerforms four-way validation of expectations vs acknowledgments:",\nAudit Reconciler\n\nPerforms four-way validation of expectations vs acknowledgments:\n\n1. expected − acked → missing (audit alert)\n2. acked − expected → drift (unexpected action)\n3. missing finalization → stale run (liveness violation)\n4. expectations without deadline → invalid contract\n\nThis is the core of the Runtime Audit Contract (RAC).\n\nUsage:\n    reconciler = get_audit_reconciler()\n    result = reconciler.reconcile(run_id)\n\n    if not result.is_clean:\n        # Handle issues\n        if resul,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
726,app/services/audit/store.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/audit_store.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Storage for audit expectations and acknowledgments\n# Callers: ROK (L5), Facades (L4), AuditReconciler (L4)\n# Allowed Imports: L6 (Redis, stdlib)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nAudit Store\n\nProvides storage for audit expectations and acknowledgments.","\nAudit Store\n\nProvides storage for audit expectations and acknowledgments.\n\nStorage Strategy:\n- MEMORY: In-memory dictionary (dev/test only - NOT crash-safe)\n- REDIS: Redis-backed store (staging/prod - crash-safe, cross-process)\n\nDurability Modes:\n- AOS_MODE=local → MEMORY allowed\n- AOS_MODE=test/prod → REDIS required (startup fails without it)\n\nThe store is designed to be:\n1. Fast for writes (acks happen in hot path)\n2. Durable in production (Redis backing mandatory)\n3. TTL-managed (old data ex",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
727,app/services/budget_enforcement_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/budget_enforcement_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: scheduler (background task)\n#   Execution: async\n# Role: Budget enforcement decision-making (domain logic)\n# Authority: Budget decision generation (M9/M10 pattern)\n# Callers: Background tasks, API endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: DECISION_RECORD_CONTRACT.md\n# Reference: PIN-257 Phase R-3 (L5→L4 Violation Fix)\n#\n# GOVERNANCE NOTE: This L4 engine owns BUDGET ENFORCEMENT DECISION logic.\n# L5 runner.py owns only EXECUTION logic (halting the run).",\nDomain engine for budget enforcement decisions.\n\nThis L4 engine contains the authoritative logic for:\n1. Identifying runs halted due to budget enforcement\n2. Emitting budget_enforcement decision records\n\nL5 workers must halt runs when budget is exhausted but must NOT\nemit decision records directly. Decision emission is L4 responsibility.\n\nReference: PIN-257 Phase R-3\nGovernance: PHASE_R_L5_L4_VIOLATIONS.md\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
728,app/services/certificate.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/certificate.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Callers: guard.py (replay endpoint)\n# Reference: PIN-240\n\n""""""M23 Certificate Service - Cryptographic Evidence of Deterministic Replay\n\nUses M4 HMAC infrastructure to create signed certificates that prove:\n1. Policy decisions were evaluated at a specific time\n2. Replay validation passed at a specific determinism level\n3. No tampering occurred between original call and validation\n\nCertificate Structure:\n- Certificate ID (UUID)\n- Original call metadata",M23 Certificate Service - Cryptographic Evidence of Deterministic Replay\n\nUses M4 HMAC infrastructure to create signed certificates that prove:\n1. Policy decisions were evaluated at a specific time\n2. Replay validation passed at a specific determinism level\n3. No tampering occurred between original call and validation\n\nCertificate Structure:\n- Certificate ID (UUID)\n- Original call metadata\n- Replay validation result\n- HMAC signature (using M4 infrastructure)\n- Timestamp and expiry\n\nUsage:\n    fr,,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
729,app/services/claim_decision_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/claim_decision_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: L4 services (L5 no longer imports this module)\n# Reference: PIN-257 Phase R-4 (L5→L4 Violation Fix)\n# WARNING: If this logic is wrong, claim processing breaks.\n#\n# GOVERNANCE NOTE (Phase R-4):\n# L5 workers now read threshold from environment variable RECOVERY_CLAIM_THRESHOLD.\n# This L4 module reads from the same env var for consistency (dependency inversion).\n# L5 workers inline simple status/confidence extraction instead of calling L4.\n\n# M10 Claim Decision Engine\n""""""\nDomain engine for recovery claim decisions.\n",\nDomain engine for recovery claim decisions.\n\nThis L4 engine defines the authoritative rules for:\n1. Claim eligibility - what candidates qualify for evaluation\n2. Status determination - how evaluation results map to status\n\nPhase R-4 Note:\nL5 workers no longer import this module. Configuration is shared via\nenvironment variables. Simple data extractions are inlined in L5.\n\nReference: PIN-257 Phase R-4\nGovernance: PHASE_R_L5_L4_VIOLATIONS.md\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
730,app/services/compliance/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/compliance_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Compliance Facade - Centralized access to compliance operations\n# Callers: L2 compliance.py API, SDK\n# Allowed Imports: L4 compliance services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-103 (Compliance Verification API)\n\n""""""\nCompliance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for compliance verification operations.",\nCompliance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for compliance verification operations.\nAll compliance APIs MUST use this facade instead of directly importing\ninternal compliance modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes compliance verification logic\n- Provides unified access to compliance checks and reports\n- Single point for audit emission\n\nL2 API Routes (GAP-103):\n- POST /api/v1/compliance/verify (run compliance verific,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
731,app/services/connectors/__init__.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Role: Connector services for governed external access\n\n""""""\nConnectors Package\n\nContains governed connectors for external data access:\n- http_connector: Machine-controlled HTTP access (GAP-059)\n- sql_gateway: Template-based SQL queries (GAP-060)\n- mcp_connector: MCP tool invocation (GAP-063)\n- connector_registry: Connector management (GAP-057)\n- VectorConnector: Vector database connector (GAP-061)\n- FileConnector: File storage connector (GAP-062)\n- ServerlessConnector: Serverless function connector (GAP-064)",\nConnectors Package\n\nContains governed connectors for external data access:\n- http_connector: Machine-controlled HTTP access (GAP-059)\n- sql_gateway: Template-based SQL queries (GAP-060)\n- mcp_connector: MCP tool invocation (GAP-063)\n- connector_registry: Connector management (GAP-057)\n- VectorConnector: Vector database connector (GAP-061)\n- FileConnector: File storage connector (GAP-062)\n- ServerlessConnector: Serverless function connector (GAP-064)\n\nAll connectors implement the Connector proto,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
732,app/services/connectors/connector_registry.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/connector_registry.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-057 (ConnectorRegistry), GAP-061/062/064 (Connectors)\n""""""\nConnectorRegistry - Connector management and registration.\n\nProvides a unified registry for:\n- Connector type registration\n- Connector instance management\n- Capability discovery\n- Status monitoring\n""""""\n\nfrom abc import ABC, abstractmethod\nfrom dataclasses import dataclass, field",\nConnectorRegistry - Connector management and registration.\n\nProvides a unified registry for:\n- Connector type registration\n- Connector instance management\n- Capability discovery\n- Status monitoring\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
733,app/services/connectors/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/connectors_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Connectors Facade - Centralized access to connector operations\n# Callers: L2 connectors.py API, SDK\n# Allowed Imports: L4 connector services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-093 (Connector Registry API)\n\n""""""\nConnectors Facade (L4 Domain Logic)\n\nThis facade provides the external interface for connector operations.","\nConnectors Facade (L4 Domain Logic)\n\nThis facade provides the external interface for connector operations.\nAll connector APIs MUST use this facade instead of directly importing\ninternal connector modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes connector management logic\n- Provides unified access to HTTP, SQL, MCP connectors\n- Single point for audit emission\n\nWrapped Services:\n- ConnectorRegistry: Connector registration and management\n- HTTPConnector: HTTP/REST ",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
734,app/services/connectors/http_connector.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/http_connector.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (via mediation layer)\n#   Execution: async\n# Role: Machine-controlled HTTP connector (NOT LLM-controlled)\n# Callers: RetrievalMediator\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-059\n\n""""""\nModule: http_connector\nPurpose: Machine-controlled HTTP connector (NOT LLM-controlled).\n","\nModule: http_connector\nPurpose: Machine-controlled HTTP connector (NOT LLM-controlled).\n\nKey Difference from HttpCallSkill:\n    - HttpCallSkill: LLM controls URL, headers, body (DANGEROUS)\n    - HttpConnectorService: Machine resolves URL from registry, LLM only provides action\n\nSecurity Model:\n    - Base URL: Machine-controlled (from connector config)\n    - Auth: Machine-controlled (from vault)\n    - Endpoints: Machine-controlled (action -> path mapping)\n    - Payload: LLM-controlled but valida",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
735,app/services/connectors/mcp_connector.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/mcp_connector.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (via mediation layer)\n#   Execution: async\n# Role: Model Context Protocol (MCP) tool invocation with governance\n# Callers: RetrievalMediator\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-063\n\n""""""\nModule: mcp_connector\nPurpose: Model Context Protocol (MCP) tool invocation with governance.\n",\nModule: mcp_connector\nPurpose: Model Context Protocol (MCP) tool invocation with governance.\n\nMCP Spec: Tools are invoked via standardized JSON-RPC protocol.\nThis connector governs which tools can be called and with what parameters.\n\nSecurity Model:\n    - Tool allowlist: Machine-controlled\n    - Server URL: Machine-controlled\n    - Authentication: Machine-controlled (from vault)\n    - Parameter validation: Against JSON Schema\n\nImports (Dependencies):\n    - None (credential service passed via co,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
736,app/services/connectors/sql_gateway.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/sql_gateway.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (via mediation layer)\n#   Execution: async\n# Role: Template-based SQL queries (NO raw SQL from LLM)\n# Callers: RetrievalMediator\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-060\n\n""""""\nModule: sql_gateway\nPurpose: Template-based SQL queries (NO raw SQL from LLM).\n","\nModule: sql_gateway\nPurpose: Template-based SQL queries (NO raw SQL from LLM).\n\nKey Difference from PostgresQuerySkill:\n    - PostgresQuerySkill: LLM provides SQL string (DANGEROUS)\n    - SqlGatewayService: LLM selects template ID, machine fills parameters\n\nSecurity Invariant: LLM NEVER sees or constructs SQL.\nThe SQL comes from pre-registered, audited templates.\n\nImports (Dependencies):\n    - None (credential service passed via constructor)\n\nExports (Provides):\n    - SqlGatewayService: Governe",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
737,app/services/controls/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Reference: GAP-123 (Controls API)\n""""""\nControls Services (GAP-123)\n\nProvides control and killswitch operations.\n""""""\n\nfrom app.services.controls.facade import (\n    ControlsFacade,\n    ControlConfig,\n    ControlStatusSummary,",\nControls Services (GAP-123)\n\nProvides control and killswitch operations.\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
738,app/services/controls/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/controls_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Controls Facade - Centralized access to control operations\n# Callers: L2 controls.py API, SDK\n# Allowed Imports: L4 control services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-123 (Controls API)\n\n""""""\nControls Facade (L4 Domain Logic)",\nControls Facade (L4 Domain Logic)\n\nThis facade provides the external interface for control operations.\nAll control APIs MUST use this facade instead of directly importing\ninternal control modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes killswitch and control logic\n- Provides unified access to system controls\n- Single point for audit emission\n\nL2 API Routes (GAP-123):\n- GET /api/v1/controls (list controls)\n- GET /api/v1/controls/{id} (get control)\n- PUT /api/v1/,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
739,app/services/cost_anomaly_detector.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/cost_anomaly_detector.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: tests, future background job\n# Reference: PIN-240\n# WARNING: If this logic is wrong, ALL products break.\n\n""""""\nM29 Cost Anomaly Detector - Aligned Rules\n\nCategory 4 Anomaly Rules:\n1. Absolute spike: daily_spend > baseline * 1.4 FOR 2 consecutive daily intervals\n2. Sustained drift: 7d rolling avg > baseline_7d * 1.25 FOR >= 3 days\n3. Severity: LOW +15-25%, MEDIUM +25-40%, HIGH >40%\n\nTHE INVARIANT: Every anomaly triggers an action, not a chart.","\nM29 Cost Anomaly Detector - Aligned Rules\n\nCategory 4 Anomaly Rules:\n1. Absolute spike: daily_spend > baseline * 1.4 FOR 2 consecutive daily intervals\n2. Sustained drift: 7d rolling avg > baseline_7d * 1.25 FOR >= 3 days\n3. Severity: LOW +15-25%, MEDIUM +25-40%, HIGH >40%\n\nTHE INVARIANT: Every anomaly triggers an action, not a chart.\n\nDetection Types:\n- ABSOLUTE_SPIKE: Consecutive daily breaches (user, feature, tenant)\n- SUSTAINED_DRIFT: Rolling average above baseline for multiple days\n- BUDGET",,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
740,app/services/cost_model_engine.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/cost_model_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Cost modeling and risk estimation domain authority\n# Callers: CostSimV2Adapter (L3), simulation endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-254 Phase B Fix\n\n""""""\nL4 Cost Model Engine - Domain Authority for Cost/Risk Estimation\n\nB02 FIX: Moved from L3 CostSimV2Adapter to L4 domain engine.",\nL4 Cost Model Engine - Domain Authority for Cost/Risk Estimation\n\nB02 FIX: Moved from L3 CostSimV2Adapter to L4 domain engine.\nThis engine is the authoritative source for:\n- Cost model coefficients (per-skill pricing)\n- Risk estimation logic\n- Feasibility determination\n- Drift classification\n\nL3 adapters must delegate all domain decisions to this engine.\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
741,app/services/cost_write_service.py,CUSTOMER,analytics,L6,app/houseofcards/customer/analytics/drivers/cost_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Cost Intelligence)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Cost Intelligence API (Phase 2B extraction)\n# Callers: api/cost_intelligence.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 2\n\n""""""\nCost Write Service - DB write operations for Cost Intelligence API.\n\nPhase 2B Batch 2: Extracted from api/cost_intelligence.py.",\nCost Write Service - DB write operations for Cost Intelligence API.\n\nPhase 2B Batch 2: Extracted from api/cost_intelligence.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,Write service → Driver,TRANSFER
742,app/services/credentials/__init__.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Credential vault abstraction for secure credential management\n# Callers: ConnectorRegistry, LifecycleHandlers, API routes\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-171 (Credential Vault Integration)\n\n""""""\nCredential Vault Service (GAP-171)\n\nProvides a unified interface for secure credential management across:",\nCredential Vault Service (GAP-171)\n\nProvides a unified interface for secure credential management across:\n- HashiCorp Vault\n- AWS Secrets Manager\n- Environment variables (development only)\n\nFeatures:\n- Tenant-isolated credential storage\n- Credential type validation\n- Automatic rotation support\n- Audit logging of credential access\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
743,app/services/credentials/service.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: High-level credential service with validation and auditing\n# Callers: ConnectorRegistry, LifecycleHandlers, API routes\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-171 (Credential Vault Integration)\n\n""""""\nCredential Service (GAP-171)\n\nHigh-level service for credential management with:",\nCredential Service (GAP-171)\n\nHigh-level service for credential management with:\n- Input validation\n- Audit logging\n- Expiration checking\n- Rotation scheduling\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
744,app/services/credentials/vault.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/vault.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# PHASE: W2\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Credential vault abstraction with multiple provider support\n# Callers: CredentialService\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-171 (Credential Vault Integration)\n\n""""""\nCredential Vault Abstraction (GAP-171)",\nCredential Vault Abstraction (GAP-171)\n\nSupports multiple vault providers:\n- HashiCorp Vault (production)\n- AWS Secrets Manager (production)\n- Environment variables (development only)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
745,app/services/cus_credential_service.py,CUSTOMER,integrations,L4,app/houseofcards/customer/integrations/engines/cus_credential_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Credential encryption and vault integration for customer LLM integrations\n# Callers: cus_integration_service.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md\n\n""""""Customer Credential Service\n\nPURPOSE:\n    Secure handling of customer LLM API credentials.","Customer Credential Service\n\nPURPOSE:\n    Secure handling of customer LLM API credentials.\n    Encrypts credentials at rest, provides vault-ready integration.\n\nSECURITY PRINCIPLES:\n    1. NO PLAINTEXT PERSISTENCE: All stored credentials are encrypted\n    2. ROTATION-READY: Credentials can be rotated without downtime\n    3. AUDIT TRAIL: All credential access is logged\n    4. MINIMAL EXPOSURE: Decryption only at point of use\n\nCREDENTIAL REFERENCE FORMAT:\n    - vault://<path>         - HashiCorp Va",,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Customer),TRANSFER
746,app/services/cus_enforcement_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/cus_enforcement_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api, sdk\n#   Execution: sync\n# Role: Enforcement policy evaluation for customer LLM integrations\n# Callers: SDK (via API), cus_telemetry API\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md Section 15\n\n""""""Customer Enforcement Service\n\nPURPOSE:\n    Evaluate enforcement policies for customer LLM calls.","Customer Enforcement Service\n\nPURPOSE:\n    Evaluate enforcement policies for customer LLM calls.\n    Returns policy DECISIONS, not actions.\n\nRESPONSIBILITIES:\n    - Evaluate integration status (enabled/disabled/error)\n    - Check budget limits against current usage\n    - Check token limits against current usage\n    - Check rate limits (requests per minute)\n    - Return structured decision with explainability\n\nDESIGN PRINCIPLES:\n    1. NO SIDE EFFECTS: This service only evaluates and returns deci",,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Customer),TRANSFER
747,app/services/cus_health_service.py,CUSTOMER,integrations,L4,app/houseofcards/customer/integrations/engines/cus_health_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api, scheduler\n#   Execution: async\n# Role: Health checking for customer LLM integrations\n# Callers: cus_integration_service.py, scheduled health checks\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md\n\n""""""Customer Health Service\n\nPURPOSE:\n    Provider reachability and credential validation for customer LLM integrations.",Customer Health Service\n\nPURPOSE:\n    Provider reachability and credential validation for customer LLM integrations.\n    Performs lightweight health checks without consuming significant quota.\n\nRESPONSIBILITIES:\n    - Test provider connectivity\n    - Validate credentials are still valid\n    - Measure response latency\n    - Update health state in integrations\n\nHEALTH STATES:\n    - UNKNOWN: Never checked or no recent data\n    - HEALTHY: Last check successful\n    - DEGRADED: Slow or partial respons,,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Customer),TRANSFER
748,app/services/cus_integration_service.py,CUSTOMER,logs,L4,app/houseofcards/customer/logs/engines/cus_integration_service.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: CUSTOMER\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync (with async DB operations)\n# Role: Business logic for Customer Integration domain (LLM BYOK, SDK, RAG)\n# Callers: aos_cus_integrations.py API router\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Connectivity Domain - Customer Console v1 Constitution\n\n""""""Customer Integration Service\n\nPURPOSE:","Customer Integration Service\n\nPURPOSE:\n    Business logic for managing customer LLM integrations.\n    Handles CRUD operations, lifecycle transitions, and limit calculations.\n\nRESPONSIBILITIES:\n    - Create, update, delete integrations\n    - Enable/disable lifecycle transitions\n    - Calculate current usage vs limits\n    - Coordinate health checks (delegates to cus_health_service)\n\nSTATE MACHINE:\n    created -> enabled -> disabled -> enabled (cycle)\n    created -> deleted (terminal)\n    enabled -",,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Customer),TRANSFER
749,app/services/cus_telemetry_service.py,CUSTOMER,logs,L4,app/houseofcards/customer/logs/engines/cus_telemetry_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Business logic for customer LLM telemetry ingestion and querying\n# Callers: cus_telemetry.py API\n# Allowed Imports: L5, L6 (cus_models, database)\n# Forbidden Imports: L1, L2, L3\n# Reference: docs/architecture/CUSTOMER_INTEGRATIONS_ARCHITECTURE.md\n\n""""""Customer LLM Telemetry Service\n\nPURPOSE:\n    Domain engine for telemetry data. Handles:",Customer LLM Telemetry Service\n\nPURPOSE:\n    Domain engine for telemetry data. Handles:\n    - Ingesting individual and batch LLM usage records\n    - Idempotency checking via call_id\n    - Usage aggregation and summary computation\n    - Daily aggregate management\n\nSEMANTIC:\n    This service owns the DATA PLANE for customer integrations.\n    It records FACTS about what happened - append-only by design.\n\nINVARIANTS:\n    - Telemetry records are never updated once created\n    - call_id provides idemp,,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Customer),TRANSFER
750,app/services/datasources/__init__.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-055 (CustomerDataSource model)\n""""""\nCustomer Data Source Services (GAP-055)\n\nProvides models and services for customer-owned data sources\nincluding configuration, status tracking, and access management.\n\nThis module provides:\n    - CustomerDataSource: Data source model\n    - DataSourceConfig: Configuration model\n    - DataSourceRegistry: Service for managing data sources\n    - Helper functions for quick access\n""""""","\nCustomer Data Source Services (GAP-055)\n\nProvides models and services for customer-owned data sources\nincluding configuration, status tracking, and access management.\n\nThis module provides:\n    - CustomerDataSource: Data source model\n    - DataSourceConfig: Configuration model\n    - DataSourceRegistry: Service for managing data sources\n    - Helper functions for quick access\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
751,app/services/datasources/datasource_model.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/datasource_model.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-055 (CustomerDataSource model)\n""""""\nCustomerDataSource - Customer data source models and registry.\n\nProvides data source abstraction for:\n- Database connections\n- File storage\n- API endpoints\n- Vector stores\n- Custom connectors\n""""""\n\nfrom dataclasses import dataclass, field",\nCustomerDataSource - Customer data source models and registry.\n\nProvides data source abstraction for:\n- Database connections\n- File storage\n- API endpoints\n- Vector stores\n- Custom connectors\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
752,app/services/datasources/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/datasources_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: DataSources Facade - Centralized access to data source operations\n# Callers: L2 datasources.py API, SDK\n# Allowed Imports: L4 datasource services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-113 (Data Sources API)\n\n""""""\nDataSources Facade (L4 Domain Logic)\n\nThis facade provides the external interface for data source operations.",\nDataSources Facade (L4 Domain Logic)\n\nThis facade provides the external interface for data source operations.\nAll data source APIs MUST use this facade instead of directly importing\ninternal datasource modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes data source management\n- Provides unified access to source configuration\n- Single point for audit emission\n\nL2 API Routes (GAP-113):\n- POST /api/v1/datasources (create source)\n- GET /api/v1/datasources (list sources,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
753,app/services/detection/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/detection_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api (on-demand) or worker (scheduled)\n#   Execution: async\n# Role: Detection Facade - Centralized access to anomaly detection operations\n# Callers: L2 detection.py API, SDK, Worker\n# Allowed Imports: L4 detection services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-102 (Anomaly Detection API)\n\n""""""\nDetection Facade (L4 Domain Logic)\n\nThis facade provides the external interface for anomaly detection operations.","\nDetection Facade (L4 Domain Logic)\n\nThis facade provides the external interface for anomaly detection operations.\nAll detection APIs MUST use this facade instead of directly importing\ninternal detection modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes anomaly detection logic\n- Provides unified access to cost, behavioral, and policy anomalies\n- Single point for audit emission\n\nWrapped Services:\n- CostAnomalyDetector: Cost anomaly detection (GAP-066)\n- (Future) Be",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
754,app/services/email_verification.py,CUSTOMER,api_keys,L5,app/houseofcards/customer/api_keys/engines/email_verification.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Callers: onboarding.py (auth flow)\n# Reference: PIN-240\n# NOTE: Redis-only state (not PostgreSQL). M24 onboarding.\n\n""""""\nEmail Verification Service\n\nProvides OTP-based email verification for customer onboarding.\n\nConfiguration (environment variables):\n    RESEND_API_KEY: Resend.com API key for sending emails\n    EMAIL_FROM: Sender email address\n    EMAIL_VERIFICATION_TTL: OTP validity in seconds (default: 600 = 10 min)",\nEmail Verification Service\n\nProvides OTP-based email verification for customer onboarding.\n\nConfiguration (environment variables):\n    RESEND_API_KEY: Resend.com API key for sending emails\n    EMAIL_FROM: Sender email address\n    EMAIL_VERIFICATION_TTL: OTP validity in seconds (default: 600 = 10 min)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
755,app/services/event_emitter.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/event_emitter.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Callers: Multiple products (founder console, ops console)\n# Reference: PIN-240\n# NOTE: This layer must not know what a ""product"" is.\n#\n# =============================================================================\n# EventEmitter - FOUNDER CONSOLE ONLY\n# =============================================================================\n#\n# IMPORTANT: This service writes to ops_events table which is consumed\n# EXCLUSIVELY by the Founder Console (api/ops.py).\n#\n# DO NOT use EventEmitter for Customer Console signal paths.\n# Customer Console signals should update the runs table directly via",\nEvent Emitter Service (M24 Ops Console)\n\nPIN-105: Ops Console - Founder Intelligence System\n\nProvides:\n- Event emission to ops_events table (FOUNDER CONSOLE ONLY)\n- Background batching for high-throughput scenarios\n- Type-safe event creation\n- Automatic timestamp and metadata handling\n\nNOTE: This service is for FOUNDER CONSOLE monitoring only.\nCustomer Console signals use RunSignalService to update runs table.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
756,app/services/evidence/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/evidence_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Evidence Facade - Centralized access to evidence and export operations\n# Callers: L2 evidence.py API, SDK\n# Allowed Imports: L4 evidence services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-104 (Evidence Chain API), GAP-105 (Evidence Export API)\n\n""""""\nEvidence Facade (L4 Domain Logic)\n\nThis facade provides the external interface for evidence chain and export operations.","\nEvidence Facade (L4 Domain Logic)\n\nThis facade provides the external interface for evidence chain and export operations.\nAll evidence APIs MUST use this facade instead of directly importing\ninternal evidence modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes evidence chain management\n- Provides unified access to evidence export\n- Single point for audit emission\n\nL2 API Routes (GAP-104, GAP-105):\n- GET /api/v1/evidence/chains (list evidence chains)\n- GET /api/v1/ev",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
757,app/services/evidence_report.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/evidence_report.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Callers: guard.py (incident export endpoint)\n# Reference: PIN-240\n\n""""""\nEvidence Report Generator - Legal-Grade PDF Export\n\nGenerates deterministic, verifiable PDF evidence reports for AI incidents.\nThis document must survive legal review, audit, and hostile questioning.\n\nFeatures:\n- Cover page with metadata\n- Executive summary for legal/leadership\n- Factual reconstruction (pure evidence)","\nEvidence Report Generator - Legal-Grade PDF Export\n\nGenerates deterministic, verifiable PDF evidence reports for AI incidents.\nThis document must survive legal review, audit, and hostile questioning.\n\nFeatures:\n- Cover page with metadata\n- Executive summary for legal/leadership\n- Factual reconstruction (pure evidence)\n- Policy evaluation record\n- Decision timeline (deterministic trace)\n- Replay verification with hash matching\n- Counterfactual prevention proof\n- Remediation & controls\n- Legal at",,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
758,app/services/export/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-027 (Evidence PDF Completeness)\n""""""\nExport Services (GAP-027)\n\nProvides services for evidence export completeness validation\nbefore PDF generation for SOC2 compliance.\n\nThis module provides:\n    - EvidenceCompletenessChecker: Validates evidence bundle completeness\n    - EvidenceCompletenessError: Raised on incomplete evidence\n    - CompletenessResult: Result of completeness check\n    - Helper functions for quick validation\n""""""",\nExport Services (GAP-027)\n\nProvides services for evidence export completeness validation\nbefore PDF generation for SOC2 compliance.\n\nThis module provides:\n    - EvidenceCompletenessChecker: Validates evidence bundle completeness\n    - EvidenceCompletenessError: Raised on incomplete evidence\n    - CompletenessResult: Result of completeness check\n    - Helper functions for quick validation\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
759,app/services/export/completeness_checker.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/export_completeness_checker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Evidence PDF completeness validation for SOC2 compliance\n# Callers: pdf_renderer, evidence_report, export APIs\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-027 (Evidence PDF Completeness)\n\n""""""\nModule: completeness_checker\nPurpose: Validate evidence bundle completeness before PDF generation.\n","\nModule: completeness_checker\nPurpose: Validate evidence bundle completeness before PDF generation.\n\nEvidence PDF exports require specific fields for SOC2 compliance.\nThis module validates that all required fields are present and\nnon-empty before allowing PDF generation.\n\nRequired Fields (Standard):\n    - incident_id, tenant_id, run_id, trace_id\n    - policy_snapshot_id, termination_reason\n    - total_steps, total_tokens, total_cost_cents\n\nSOC2 Required Fields (Enhanced):\n    - control_mappings,",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
760,app/services/export_bundle_service.py,CUSTOMER,incidents,L3,app/houseofcards/customer/incidents/facades/export_bundle_service.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Generate structured export bundles from incidents and traces\n# Callers: api/incidents.py\n# Allowed Imports: L4, L5, L6\n# Forbidden Imports: L1, L2\n# Reference: BACKEND_REMEDIATION_PLAN.md GAP-004, GAP-005, GAP-008\n\n""""""\nExport Bundle Service\n\nGenerates structured export bundles from incidents, runs, and traces","\nExport Bundle Service\n\nGenerates structured export bundles from incidents, runs, and traces\nfor evidence export, SOC2 compliance, and executive debriefs.\n\nKey Responsibilities:\n1. Load incident, run, and trace data\n2. Assemble EvidenceBundle with all cross-domain links\n3. Enhance for SOC2 compliance (control mappings)\n4. Generate executive summary (non-technical)\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Boundary Adapter,TRANSFER
761,app/services/external_response_service.py,CUSTOMER,platform,L6,app/houseofcards/customer/platform/drivers/external_response_service.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker|scheduler\n#   Execution: sync\n# Role: External response persistence and interpretation service\n# Callers: L3 adapters (record_raw), L4 engines (interpret), L5/L2 (read_interpreted)\n# Allowed Imports: L6 (db, models)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-256 Phase E FIX-04\n\n""""""\nExternal Response Service (Phase E FIX-04)\n\nL6 service for persisting raw external responses and their interpretations.",\nExternal Response Service (Phase E FIX-04)\n\nL6 service for persisting raw external responses and their interpretations.\n\nWrite Path (L3 → L6):\n- Adapters call record_raw_response() with raw data\n- Raw data is persisted with interpretation_owner declared\n- L3 returns only receipt confirmation (not interpretation)\n\nInterpretation Path (L4 → L6):\n- L4 engines call interpret() with domain-meaningful result\n- interpreted_value is persisted with interpreted_by\n\nRead Path (L5/L2 ← L6):\n- Consumers cal,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Platform Substrate (External),TRANSFER
762,app/services/founder_action_write_service.py,FOUNDER,agent,L6,app/houseofcards/founder/agent/drivers/founder_action_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Founder Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Founder Actions API (Phase 2B extraction)\n# Callers: api/founder_actions.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 3\n\n""""""\nFounder Action Write Service - DB write operations for Founder Actions API.\n\nPhase 2B Batch 3: Extracted from api/founder_actions.py.",\nFounder Action Write Service - DB write operations for Founder Actions API.\n\nPhase 2B Batch 3: Extracted from api/founder_actions.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,Write service → Driver,TRANSFER
763,app/services/governance/__init__.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Part-2 CRM Workflow Governance Services\n# Callers: L2 (governance APIs), L3 (adapters)\n# Allowed Imports: L5, L6, L8\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-287, PIN-288, PIN-289, PIN-291, PIN-292, PIN-294, PIN-295, part2-design-v1\n\n""""""\nPart-2 CRM Workflow Governance Services\n\nL4 domain services for the Part-2 governance workflow:","\nPart-2 CRM Workflow Governance Services\n\nL4 domain services for the Part-2 governance workflow:\n- Validator: Issue analysis (advisory, stateless)\n- Eligibility: Contract gating (pure rules)\n- Contract Service: State machine (stateful)\n- Governance Orchestrator: Workflow coordination (orchestration only)\n- Job Executor: Step execution (L5)\n- Audit Service: Verification (L8)\n\nImplementation Order (from VALIDATOR_LOGIC.md):\n1. Validator (pure analysis) - DONE (PIN-288)\n2. Eligibility engine (pure ",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
764,app/services/governance/audit_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/audit_service.py,"# Layer: L8 — Catalyst / Verification\n# Product: system-wide (Part-2 CRM Workflow)\n# Temporal:\n#   Trigger: job completion\n#   Execution: sync (deterministic verification)\n# Role: Audit Service - verifies job execution against contract intent\n# Callers: GovernanceOrchestrator (via AuditTrigger)\n# Allowed Imports: L6 models only\n# Forbidden Imports: L1, L2, L3, L4, L5 (auditor is independent)\n# Reference: PIN-295, GOVERNANCE_AUDIT_MODEL.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: AUDIT-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#",\nPart-2 Governance Audit Service (L8)\n\nVerifies that job execution matched contract intent.\n\nAudit is:\n- Post-execution (runs after job completes)\n- Deterministic (same evidence → same verdict)\n- Authoritative (verdicts cannot be overridden)\n- Mandatory (no rollout without audit)\n\nInvariants:\n- AUDIT-001: All completed jobs require audit\n- AUDIT-002: PASS required for COMPLETED\n- AUDIT-003: FAIL triggers rollback\n- AUDIT-004: Verdicts are immutable\n- AUDIT-005: Evidence is preserved\n- AUDIT-006:,,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
765,app/services/governance/contract_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/contract_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Contract Service - stateful contract state machine\n# Callers: L3 (adapters), L2 (governance APIs)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-291, SYSTEM_CONTRACT_OBJECT.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: CONTRACT-STATE-MACHINE (Non-Negotiable)\n# ==============================================================================\n#",\nPart-2 Contract Service (L4)\n\nManages the System Contract state machine - the first stateful component\nin the Part-2 governance workflow.\n\nResponsibilities:\n1. Create contracts from validated + eligible proposals\n2. Enforce state machine transitions\n3. Record transition history for audit\n4. Enforce terminal state immutability\n\nInvariants (from SYSTEM_CONTRACT_OBJECT.md):\n- CONTRACT-001: Status transitions must follow state machine\n- CONTRACT-002: APPROVED requires approved_by\n- CONTRACT-003: AC,,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
766,app/services/governance/cross_domain.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/cross_domain.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync (async session)\n# Role: Cross-Domain Governance - Mandatory data integrity functions\n# Callers: cost_anomaly_detector, budget services, worker runtime\n# Allowed Imports: L5, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: design/CROSS_DOMAIN_GOVERNANCE.md\n\n""""""\nCross-Domain Governance Functions (Mandatory)\n\nPIN: design/CROSS_DOMAIN_GOVERNANCE.md",\nCross-Domain Governance Functions (Mandatory)\n\nPIN: design/CROSS_DOMAIN_GOVERNANCE.md\n\nThese functions implement mandatory governance for customer-facing paths.\nThey MUST succeed or raise GovernanceError. Silent failures are forbidden.\n\nDOCTRINE:\n- Rule 1: Governance must throw\n- Rule 2: No optional dependencies\n- Rule 3: Learning is downstream only\n\nDOMAINS:\n- Analytics → Incidents: Cost anomalies MUST create incidents\n- Policies ↔ Analytics: Limit breaches MUST be recorded\n\nCOROLLARY: Governa,,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
767,app/services/governance/degraded/__init__.py,CUSTOMER,incidents,L4,app/houseofcards/customer/incidents/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-070 (Governance Degraded Mode)\n""""""\nGovernance Degraded Mode Services (GAP-070)\n\nProvides services for governance degraded mode with incident response\nintegration. When governance systems are unavailable, the system enters\na DEGRADED state that properly surfaces to incident response.\n\nThis module provides:\n    - GovernanceDegradedModeChecker: Validates and manages degraded state\n    - DegradedModeIncidentCreator: Creates incidents for degraded mode\n    - DegradedModeState: State tracking for degraded mode\n    - Helper functions for degraded mode operations","\nGovernance Degraded Mode Services (GAP-070)\n\nProvides services for governance degraded mode with incident response\nintegration. When governance systems are unavailable, the system enters\na DEGRADED state that properly surfaces to incident response.\n\nThis module provides:\n    - GovernanceDegradedModeChecker: Validates and manages degraded state\n    - DegradedModeIncidentCreator: Creates incidents for degraded mode\n    - DegradedModeState: State tracking for degraded mode\n    - Helper functions f",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
768,app/services/governance/degraded/degraded_mode_checker.py,CUSTOMER,incidents,L4,app/houseofcards/customer/incidents/engines/degraded_mode_checker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Governance degraded mode checker with incident response\n# Callers: ROK (L5), prevention_engine, incident_engine\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-070 (Governance Degraded Mode)\n\n""""""\nModule: degraded_mode_checker\nPurpose: Check and manage governance degraded mode with incident integration.\n","\nModule: degraded_mode_checker\nPurpose: Check and manage governance degraded mode with incident integration.\n\nWhen governance systems are unavailable or degraded, this module:\n    - Tracks the degraded state with proper metadata\n    - Creates incidents for degraded mode transitions\n    - Enforces degraded mode rules (block new runs, warn existing)\n    - Integrates with incident response for visibility\n\nDegraded Mode States:\n    - NORMAL: Governance is fully operational\n    - DEGRADED: Governance",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
769,app/services/governance/eligibility_engine.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/eligibility_engine.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Eligibility Engine - pure rules, deterministic gating\n# Callers: L3 (adapters), L2 (governance APIs)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-287, ELIGIBILITY_RULES.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: ELIGIBILITY-IS-DETERMINISTIC (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Eligibility Engine (L4)\n\nApplies eligibility rules to determine if a validated proposal MAY or\nMAY_NOT become a System Contract. The engine is pure - it receives data\nvia lookups, does not fetch externally.\n\nResponsibilities:\n1. Evaluate MAY_NOT rules (rejection rules)\n2. Evaluate MAY rules (acceptance rules)\n3. Produce deterministic verdicts\n4. Track rule evaluation for auditing\n\nInvariants (from ELIGIBILITY_RULES.md):\n- ELIG-001: Eligibility is deterministic (pure function, no side eff",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
770,app/services/governance/facade.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/governance_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api (governance control) or internal (health checks)\n#   Execution: sync\n# Role: Governance Facade - Centralized access to governance control operations\n# Callers: L2 governance.py API, SDK\n# Allowed Imports: L4 domain engines, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-090, GAP-091, GAP-092, GAP-095\n\n""""""\nGovernance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance control operations.","\nGovernance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance control operations.\nAll governance APIs MUST use this facade instead of directly importing\ninternal governance modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes governance control logic\n- Provides unified access to kill switch, degraded mode, conflict resolution\n- Single point for audit emission\n\nWrapped Services:\n- runtime_switch: Kill switch and degraded mode (GAP-06",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
771,app/services/governance/governance_orchestrator.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/governance_orchestrator.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Governance Orchestrator - orchestrates contract execution\n# Callers: L3 (adapters), L2 (governance APIs)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-292, PART2_CRM_WORKFLOW_CHARTER.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: ORCHESTRATOR-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Governance Orchestrator (L4)\n\nOrchestrates the governance workflow from contract activation through\naudit triggering. This is the ""traffic controller"" - it directs flow\nbut does not execute.\n\nComponents:\n1. Contract Activation Service - APPROVED → ACTIVE\n2. Execution Orchestrator - contract → job plan\n3. Job State Tracker - observes job states\n4. Audit Trigger - hands evidence to audit layer\n\nKey Constraints (PIN-292):\n- Orchestrates only; does not execute jobs\n- No health or audit autho",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
772,app/services/governance/job_executor.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/job_executor.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide (Part-2 CRM Workflow)\n# Temporal:\n#   Trigger: worker|scheduler\n#   Execution: async (background execution)\n# Role: Job Executor - executes job steps and emits evidence\n# Callers: workers, governance orchestrator (via message queue)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: PIN-294, PIN-292, PART2_CRM_WORKFLOW_CHARTER.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: EXECUTOR-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Job Executor (L5)\n\nExecutes governance job steps in order and emits evidence.\n\nThis is a MACHINE that performs declared steps. It does not:\n- Decide what to execute (that's Contract + Orchestrator)\n- Retry failures (failed = done)\n- Interpret results (that's Audit)\n- Modify health (that's PlatformHealthService)\n\nThe Executor is ""just physics"" - it runs the plan and records what happened.\n\nInvariants:\n- EXEC-001: Execute steps in declared order\n- EXEC-002: Emit evidence per step\n- EXEC-00",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
773,app/services/governance/profile.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/profile.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: startup\n#   Execution: sync\n# Role: Governance Profile configuration and validation\n# Callers: main.py (L2), workers (L5)\n# Allowed Imports: L6 (stdlib, logging)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), Section 2.1\n\n""""""\nGovernance Profile Configuration\n\nReduces cognitive load and configuration drift by providing three","\nGovernance Profile Configuration\n\nReduces cognitive load and configuration drift by providing three\nwell-defined governance profiles:\n\n- STRICT: Full enforcement, all features enabled, production-ready\n- STANDARD: Core features enabled, some optional features disabled\n- OBSERVE_ONLY: Audit and observe without enforcement (safe rollout)\n\nUsage:\n    from app.services.governance.profile import (\n        get_governance_profile,\n        validate_governance_config,\n        GovernanceProfile,\n    )\n\n ",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
774,app/services/governance/rollout_projection.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/rollout_projection.py,"# Layer: L4 — Domain Engine (Projection)\n# Product: system-wide (Part-2 CRM Workflow)\n# Temporal:\n#   Trigger: query-time\n#   Execution: sync (read-only projection)\n# Role: Rollout Projection - read-only projection of audited truth\n# Callers: L2 (founder console, customer console)\n# Allowed Imports: L6 models only\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-296, GOVERNANCE_AUDIT_MODEL.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: PROJECTION-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Rollout Projection Service (L4 - Projection)\n\nRead-only projection layer that derives rollout state from audited truth.\n\nThis is the FINAL layer of Part-2 governance workflow.\n\nKey Properties:\n- Read-only and derived\n- No execution authority\n- No approval authority\n- No mutation authority\n- A lens, not a lever\n\nComponents:\n- FounderRolloutView: Full lineage projection for founders\n- GovernanceCompletionReport: Machine-generated completion artifact\n- RolloutStage: State machine for exposu",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
775,app/services/governance/run_governance_facade.py,CUSTOMER,activity,L3,app/houseofcards/customer/activity/facades/run_governance_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (run lifecycle events)\n#   Execution: sync\n# Role: Run Governance Facade - Centralized access to governance operations for runs\n# Callers: L5 runner (worker runtime)\n# Allowed Imports: L4 domain engines (lessons, policy), L4 audit, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), FIX-002\n\n""""""\nRun Governance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance operations",\nRun Governance Facade (L4 Domain Logic)\n\nThis facade provides the external interface for governance operations\nduring run execution. The L5 runner MUST use this facade instead of\ndirectly importing L4 engines.\n\nWhy This Facade Exists (PIN-454):\n- Prevents L5→L4 layer violations (runner importing engines directly)\n- Centralizes governance logic for run lifecycle\n- Provides RAC (Runtime Audit Contract) acknowledgment emission\n- Single point for audit expectation/acknowledgment emission\n\nWrapped S,,NEEDS_CLASSIFICATION,ITERATION_1,L3 Facade → Adapter,TRANSFER
776,app/services/governance/runtime_switch.py,CUSTOMER,incidents,L4,app/houseofcards/customer/incidents/engines/runtime_switch.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (emergency) or internal (failure detection)\n#   Execution: sync\n# Role: Runtime toggle for governance enforcement\n# Callers: ops_api.py, failure_mode_handler.py, health.py\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-069\n\n""""""\nModule: runtime_switch\nPurpose: Provides runtime toggle for governance. Emergency kill switch.\n","\nModule: runtime_switch\nPurpose: Provides runtime toggle for governance. Emergency kill switch.\n\nImports (Dependencies):\n    - logging\n    - datetime\n    - threading (for atomic operations)\n\nExports (Provides):\n    - is_governance_active() -> bool\n    - disable_governance_runtime(reason, actor) -> None\n    - enable_governance_runtime(actor) -> None\n    - get_governance_state() -> GovernanceState\n    - is_degraded_mode() -> bool (GAP-070)\n    - enter_degraded_mode(reason, actor) -> None (GAP-070)",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
777,app/services/governance/transaction_coordinator.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/transaction_coordinator.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (run completion)\n#   Execution: sync\n# Role: Transaction Coordinator for atomic cross-domain writes\n# Callers: ROK (L5), RunRunner (L5)\n# Allowed Imports: L4 facades, L6 (db, models)\n# Forbidden Imports: L1, L2, L3, L4 engines directly\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), FIX-001\n\n""""""\nTransaction Coordinator for Cross-Domain Writes\n","\nTransaction Coordinator for Cross-Domain Writes\n\nThis module provides atomic transaction coordination for run completion,\nensuring that ALL domain updates succeed or NONE persist.\n\nProblem Addressed (FIX-001):\n- Incident/policy/trace writes are independent\n- Partial failure causes inconsistent state\n- Events published before all operations complete\n\nSolution:\n- Wrap all domain operations in single transaction boundary\n- Track which operations succeeded for rollback\n- Publish events ONLY after s",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
778,app/services/governance/validator_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/validator_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Issue Validator - pure analysis, advisory verdicts\n# Callers: L3 (adapters), L2 (governance APIs)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-287, VALIDATOR_LOGIC.md, part2-design-v1\n#\n# ==============================================================================\n# GOVERNANCE RULE: VALIDATOR-IS-ADVISORY (Non-Negotiable)\n# ==============================================================================\n#","\nPart-2 Validator Service (L4)\n\nAnalyzes incoming CRM issues and produces structured verdicts for the\neligibility engine. The Validator is advisory only - it recommends but\ndoes not decide.\n\nResponsibilities:\n1. Classify issue type (capability_request, bug_report, etc.)\n2. Determine severity (critical, high, medium, low)\n3. Extract affected capabilities\n4. Recommend action (create_contract, defer, reject, escalate)\n5. Calculate confidence score\n\nInvariants (from VALIDATOR_LOGIC.md):\n- VAL-001: V",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
779,app/services/governance_signal_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/governance_signal_service.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker|scheduler\n#   Execution: sync\n# Role: Governance signal persistence service\n# Callers: L7 (BLCA, CI) for writes, L4/L5 for reads\n# Allowed Imports: L6 (db, models)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: PIN-256 Phase E FIX-03\n\n""""""\nGovernance Signal Service (Phase E FIX-03)\n\nL6 service for persisting and querying governance signals.","\nGovernance Signal Service (Phase E FIX-03)\n\nL6 service for persisting and querying governance signals.\n\nWrite Path (L7 → L6):\n- BLCA, CI, OPS write signals via record_signal()\n- Signals are persisted to governance_signals table\n- Previous signals for same scope/type are superseded\n\nRead Path (L4/L5 ← L6):\n- Domain orchestrators check governance before decisions\n- Workers check governance before execution\n- Returns blocking/warning signals for scope\n\nContract:\n- All governance influence becomes ",,NEEDS_CLASSIFICATION,ITERATION_1,Governance runtime,TRANSFER
780,app/services/guard_write_service.py,CUSTOMER,incidents,L6,app/houseofcards/customer/incidents/drivers/guard_write_service.py,"# Layer: L4 — Domain Engine\n# Product: AI Console (Guard)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Guard API (Phase 2B extraction)\n# Callers: api/guard.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 1\n#\n# =============================================================================\n# PHASE 2 NOTE:\n# This is a TEMPORARY AGGREGATE service for Phase 2 structural extraction.\n# It bundles KillSwitch, Incident, and IncidentEvent writes together.",\nGuard Write Service - DB write operations for Guard API.\n\nPhase 2B Batch 1: Extracted from api/guard.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,Write service → Driver,TRANSFER
781,app/services/hallucination/__init__.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-023, INV-002 (HALLU-INV-001)\n""""""\nHallucination Detection Service (GAP-023)\n\nCRITICAL INVARIANT (INV-002 / HALLU-INV-001):\n    Hallucination detection is ALWAYS non-blocking by default.\n    Blocking requires explicit customer opt-in.\n\nThis module provides:\n    - HallucinationDetector: Main detection service\n    - HallucinationResult: Detection result dataclass\n    - HallucinationIndicator: Individual indicator\n    - HallucinationType: Types of hallucinations",\nHallucination Detection Service (GAP-023)\n\nCRITICAL INVARIANT (INV-002 / HALLU-INV-001):\n    Hallucination detection is ALWAYS non-blocking by default.\n    Blocking requires explicit customer opt-in.\n\nThis module provides:\n    - HallucinationDetector: Main detection service\n    - HallucinationResult: Detection result dataclass\n    - HallucinationIndicator: Individual indicator\n    - HallucinationType: Types of hallucinations\n    - HallucinationSeverity: Severity levels\n    - HallucinationConfig,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/services/ai_console_panel_adapter/__init__.py,SKIP_INIT_COLLISION
782,app/services/hallucination/hallucination_detector.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/hallucination_detector.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Detect potential hallucinations in LLM outputs (non-blocking)\n# Callers: worker/runner.py, services/incident_engine.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-023, INV-002 (HALLU-INV-001)\n\n""""""\nModule: hallucination_detector\nPurpose: Detect potential hallucinations in LLM outputs.\n","\nModule: hallucination_detector\nPurpose: Detect potential hallucinations in LLM outputs.\n\nCRITICAL INVARIANT (INV-002 / HALLU-INV-001):\n    Hallucination detection is ALWAYS non-blocking by default.\n    This is because:\n    - Hallucination detection is PROBABILISTIC (60-90% confidence)\n    - Policy violations (cost, rate, PII) are DETERMINISTIC (facts)\n    - False positives on hallucination blocking destroy customer trust\n    - Blocking requires explicit customer opt-in\n\nImports (Dependencies):\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
783,app/services/iam/__init__.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: IAM integration for identity and access management\n# Callers: Auth middleware, API routes\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-173 (IAM Integration)\n\n""""""\nIAM Integration (GAP-173)\n\nProvides integration with external identity providers:",\nIAM Integration (GAP-173)\n\nProvides integration with external identity providers:\n- Clerk (primary)\n- Auth0 (planned)\n- Custom OIDC providers\n\nFeatures:\n- Identity resolution\n- Role mapping\n- Permission checking\n- Audit logging\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
784,app/services/iam/iam_service.py,CUSTOMER,integrations,L4,app/houseofcards/customer/integrations/engines/iam_service.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# PHASE: W2\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: IAM service for identity and access management\n# Callers: Auth middleware, API routes\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-173 (IAM Integration)\n\n""""""\nIAM Service (GAP-173)",\nIAM Service (GAP-173)\n\nProvides unified IAM capabilities:\n- Identity resolution from multiple providers\n- Role and permission management\n- Access control decisions\n- Audit logging\n,,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (IAM),TRANSFER
785,app/services/iam/identity_resolver.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/identity_resolver.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Identity resolution from various providers\n# Callers: IAMService, Auth middleware\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-173 (IAM Integration)\n\n""""""\nIdentity Resolver (GAP-173)\n\nResolves identities from various sources:","\nIdentity Resolver (GAP-173)\n\nResolves identities from various sources:\n- JWT tokens (Clerk, Auth0)\n- API keys\n- System tokens\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
786,app/services/incident_aggregator.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/incident_aggregator.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: Incident grouping rules, escalation logic\n# Callers: L2 APIs, L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""Incident Aggregation Service - Prevents Incident Explosion Under Load\n\nThis service implements intelligent incident grouping to prevent thousands of\nmicro-incidents during large outages. It uses a sliding window approach with\nconfigurable thresholds.\n\nKey Features:\n1. Time-window aggregation (default 5 minutes)\n2. Tenant + trigger_type grouping key",Incident Aggregation Service - Prevents Incident Explosion Under Load\n\nThis service implements intelligent incident grouping to prevent thousands of\nmicro-incidents during large outages. It uses a sliding window approach with\nconfigurable thresholds.\n\nKey Features:\n1. Time-window aggregation (default 5 minutes)\n2. Tenant + trigger_type grouping key\n3. Rate limiting (max 1 incident per key per window)\n4. Auto-escalation for high-volume windows\n5. Incident merging for related failures\n\nWatchpoint ,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
787,app/services/incident_read_service.py,CUSTOMER,incidents,L6,app/houseofcards/customer/incidents/drivers/incident_read_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync (DB reads)\n# Role: Incident domain read operations (L4)\n# Callers: customer_incidents_adapter.py (L3)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (L3 Adapter Closure - PHASE 1)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides READ operations for the Incidents domain.\n# All incident reads must go through this service.\n# Write operations are handled by GuardWriteService.","\nIncident Read Service (L4)\n\nThis service provides all READ operations for the Incidents domain.\nIt sits between L3 (CustomerIncidentsAdapter) and L6 (Database).\n\nL3 (Adapter) → L4 (this service) → L6 (Database)\n\nResponsibilities:\n- Query incidents with tenant isolation\n- Query incident events\n- Provide bounded, paginated reads\n- No write operations (see GuardWriteService)\n\nReference: PIN-281 (L3 Adapter Closure - PHASE 1)\n",,NEEDS_CLASSIFICATION,ITERATION_1,Read service → Driver,TRANSFER
788,app/services/incident_write_service.py,CUSTOMER,incidents,L6,app/houseofcards/customer/incidents/drivers/incident_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync (DB writes)\n# Role: Incident domain write operations (L4)\n# Callers: customer_incidents_adapter.py (L3)\n# Allowed Imports: L6, L4 (AuditLedgerService)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (L3 Adapter Closure - PHASE 1), PIN-413 (Logs Domain)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides WRITE operations for the Incidents domain.\n# All incident mutations must go through this service.\n# Read operations are handled by IncidentReadService.",\nIncident Write Service (L4)\n\nThis service provides all WRITE operations for the Incidents domain.\nIt sits between L3 (CustomerIncidentsAdapter) and L6 (Database).\n\nL3 (Adapter) → L4 (this service) → L6 (Database)\n\nResponsibilities:\n- Acknowledge incidents (with event creation + audit emit)\n- Resolve incidents (with event creation + audit emit)\n- No direct exposure to L2\n\nReference: PIN-281 (L3 Adapter Closure - PHASE 1)\nReference: PIN-413 (Logs Domain - Audit Ledger)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Write service → Driver,TRANSFER
789,app/services/incidents/__init__.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/__init__.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync/async\n# Role: Incidents domain services module\n# Callers: Incidents API (L2), worker runtime, governance services\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: docs/architecture/incidents/INCIDENTS_DOMAIN_SQL.md, FACADE_CONSOLIDATION_PLAN.md\n\n""""""\nIncidents Domain Services\n","\nIncidents Domain Services\n\nL4 services for incident analysis and post-mortem:\n- IncidentDriver: INTERNAL driver for worker/governance (use for internal callers)\n- IncidentPatternService: Detect structural patterns (category_cluster, severity_spike, cascade_failure)\n- RecurrenceAnalysisService: Analyze recurring incident types\n- PostMortemService: Extract learnings from resolved incidents\n\nFor CUSTOMER API operations, use incidents_facade.py (at services root) instead.\n\nDesign Rules:\n- All servi",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
790,app/services/incidents/incident_driver.py,CUSTOMER,incidents,L6,app/houseofcards/customer/incidents/drivers/incident_driver.py,"# Layer: L4 — Domain Driver\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Incident Domain Driver - Internal orchestration for incident operations\n# Callers: worker runtime, governance services, transaction coordinator\n# Allowed Imports: L4 incident services, L4 audit, L5, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: FACADE_CONSOLIDATION_PLAN.md, PIN-454 (RAC)\n#\n# GOVERNANCE NOTE:\n# This is the INTERNAL driver for incident operations.\n# CUSTOMER-facing operations use incidents_facade.py (L2 API projection).","\nIncident Domain Driver (INTERNAL)\n\nThis driver provides the internal interface for incident operations.\nUsed by workers, governance services, and transaction coordinators.\n\nFor CUSTOMER API operations, use incidents_facade.py instead.\n\nWhy Drivers (not Facades for internal use):\n- Facades are API projection layers (CUSTOMER-facing)\n- Drivers are orchestration layers (INTERNAL)\n- Clear separation prevents confusion\n- Import rules become enforceable\n\nUsage:\n    from app.services.incidents.inciden",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Driver,TRANSFER
791,app/services/incidents/incident_engine.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/incident_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: worker (run failure events)\n#   Execution: sync\n# Role: Incident creation decision-making (domain logic)\n# Authority: Incident generation from run failures (SDSR pattern)\n# Callers: Worker runtime, API endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: SDSR (PIN-370)\n# Reference: PIN-370 (Scenario-Driven System Realization)\n#\n# GOVERNANCE NOTE: This L4 engine owns INCIDENT CREATION logic.\n# Scenarios inject causes (failed runs), this engine creates incidents.","\nIncident Engine (L4 Domain Logic)\n\nThis engine implements the SDSR cross-domain propagation contract:\n- Run failure (Activity domain) → Incident creation (Incidents domain)\n\nPer PIN-370 Rule 6 (Scenarios Inject Causes, Not Consequences):\n- Scenarios inject a failed run\n- This engine AUTOMATICALLY creates incidents\n- If incident doesn't appear, the ENGINE is broken, not the scenario\n\nReference: PIN-370, INCIDENTS-EXEC-FAILURE-001\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
792,app/services/incidents/incident_pattern_service.py,CUSTOMER,incidents,L4,app/houseofcards/customer/incidents/engines/incident_pattern_service.py,"# Layer: L4 — Domain Engines\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Detect structural patterns across incidents\n# Callers: Incidents API (L2)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: docs/architecture/incidents/INCIDENTS_DOMAIN_SQL.md#5-act-o4\n\n""""""\nIncident Pattern Service\n\nDetects structural patterns across incidents:","\nIncident Pattern Service\n\nDetects structural patterns across incidents:\n- category_cluster: Multiple incidents in same category\n- severity_spike: Multiple high/critical in short window\n- cascade_failure: Multiple incidents from same source run\n- resolution_pattern: Common resolution methods\n\nDesign Rules:\n- Rule-based only (v1, no ML)\n- Read-only (no writes)\n- No cross-service calls\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
793,app/services/incidents/postmortem_service.py,CUSTOMER,incidents,L4,app/houseofcards/customer/incidents/engines/postmortem_service.py,"# Layer: L4 — Domain Engines\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Extract learnings and post-mortem insights from resolved incidents\n# Callers: Incidents API (L2)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: docs/architecture/incidents/INCIDENTS_DOMAIN_SQL.md#8-res-o4\n\n""""""\nPost-Mortem Service\n\nExtracts learnings from resolved incidents:",\nPost-Mortem Service\n\nExtracts learnings from resolved incidents:\n- Resolution summaries\n- Impact analysis\n- Prevention recommendations\n- Pattern correlations\n\nDesign Rules:\n- Aggregation and analysis only\n- Read-only (no writes)\n- No cross-service calls\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
794,app/services/incidents/recurrence_analysis_service.py,CUSTOMER,incidents,L4,app/houseofcards/customer/incidents/engines/recurrence_analysis_service.py,"# Layer: L4 — Domain Engines\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Analyze recurring incident patterns\n# Callers: Incidents API (L2)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: docs/architecture/incidents/INCIDENTS_DOMAIN_SQL.md#9-hist-o3\n\n""""""\nRecurrence Analysis Service\n\nAnswers ""how often does this type repeat?"":","\nRecurrence Analysis Service\n\nAnswers ""how often does this type repeat?"":\n- Group by (category, resolution_method)\n- Count occurrences over time window\n- Calculate recurrence rate\n\nDesign Rules:\n- Statistical analysis only\n- Read-only (no writes)\n- No cross-service calls\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
795,app/services/incidents_facade.py,CUSTOMER,incidents,L3,app/houseofcards/customer/incidents/facades/incidents_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB operations)\n# Role: Incidents domain facade - unified entry point for incident management operations\n# Callers: L2 incidents API (incidents.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: INCIDENTS Domain - Customer Console v1 Constitution\n#\n""""""\nIncidents Domain Facade (L4)\n","\nIncidents Domain Facade (L4)\n\nUnified facade for incident management operations.\n\nProvides:\n- List incidents: active, resolved, historical\n- Get incident detail\n- Get incidents by run\n- Pattern detection (ACT-O5)\n- Recurrence analysis (HIST-O3)\n- Cost impact analysis (RES-O3)\n- Metrics\n- Historical trend/distribution/cost-trend\n- Post-mortem learnings (RES-O4)\n\nAll operations are tenant-scoped for isolation.\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
796,app/services/inspection/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-033 (Inspection Constraints)\n""""""\nInspection Constraint Enforcement Service (GAP-033)\n\nEnforces MonitorConfig inspection constraints before logging\nor data capture operations. These are ""negative capabilities"" -\nthings the policy is NOT allowed to inspect.\n\nThis module provides:\n    - InspectionConstraintChecker: Main enforcement class\n    - InspectionOperation: Enum of operations requiring constraint checks\n    - check_inspection_allowed: Quick helper function\n    - get_constraint_violations: Get all violations for a set of operations","\nInspection Constraint Enforcement Service (GAP-033)\n\nEnforces MonitorConfig inspection constraints before logging\nor data capture operations. These are ""negative capabilities"" -\nthings the policy is NOT allowed to inspect.\n\nThis module provides:\n    - InspectionConstraintChecker: Main enforcement class\n    - InspectionOperation: Enum of operations requiring constraint checks\n    - check_inspection_allowed: Quick helper function\n    - get_constraint_violations: Get all violations for a set of op",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
797,app/services/inspection/constraint_checker.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/constraint_checker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Enforce MonitorConfig inspection constraints before logging\n# Callers: worker/runtime/trace_collector.py, services/logging_service.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-033 (Inspection Constraints)\n\n""""""\nModule: constraint_checker\nPurpose: Enforce inspection constraints from MonitorConfig.\n","\nModule: constraint_checker\nPurpose: Enforce inspection constraints from MonitorConfig.\n\nInspection constraints are ""negative capabilities"" - they define what\na policy is NOT allowed to inspect or capture. Before any logging\noperation, the runner/worker must check these constraints.\n\nConstraint Fields (from MonitorConfig):\n    - allow_prompt_logging: Can prompts be logged?\n    - allow_response_logging: Can responses be logged?\n    - allow_pii_capture: Can PII be captured?\n    - allow_secret_acce",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
798,app/services/integrations_facade.py,CUSTOMER,integrations,L3,app/houseofcards/customer/integrations/facades/integrations_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB operations)\n# Role: Integrations domain facade - unified entry point for integration management\n# Callers: L2 integrations API (aos_cus_integrations.py)\n# Allowed Imports: L4 (CusIntegrationService), L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Connectivity Domain - Customer Console v1 Constitution\n#\n""""""\nIntegrations Domain Facade (L4)\n","\nIntegrations Domain Facade (L4)\n\nUnified facade for LLM integration management (BYOK - Bring Your Own Key).\n\nProvides:\n- CRUD: list, get, create, update, delete integrations\n- Lifecycle: enable, disable\n- Health: get health status, test credentials\n- Limits: get usage vs limits\n\nThis facade wraps the CusIntegrationService and provides dataclass result types\nfor consistency with other domain facades.\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
799,app/services/keys_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/keys_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync (DB reads/writes)\n# Role: API Keys domain operations (L4)\n# Callers: customer_keys_adapter.py (L3)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (L3 Adapter Closure - PHASE 1)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides READ and WRITE operations for the Keys domain.\n# All key operations must go through this service.\n",\nKeys Service (L4)\n\nThis service provides all operations for the API Keys domain.\nIt sits between L3 (CustomerKeysAdapter) and L6 (Database).\n\nL3 (Adapter) → L4 (this service) → L6 (Database)\n\nResponsibilities:\n- Query API keys with tenant isolation\n- Freeze/unfreeze keys\n- Get key usage statistics\n- No direct exposure to L2\n\nReference: PIN-281 (L3 Adapter Closure - PHASE 1)\n,,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Keys),TRANSFER
800,app/services/killswitch/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Role: Killswitch domain services package\n# Reference: KILLSWITCH Domain Qualification\n\n""""""\nKillswitch Domain Services (L4)\n\nThis package provides domain-level services for killswitch operations.\nL3 adapters should import from this package, NOT from L6 models directly.\n\nAvailable services:\n- CustomerKillswitchReadService: Read operations for customer killswitch status\n""""""\n","\nKillswitch Domain Services (L4)\n\nThis package provides domain-level services for killswitch operations.\nL3 adapters should import from this package, NOT from L6 models directly.\n\nAvailable services:\n- CustomerKillswitchReadService: Read operations for customer killswitch status\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
801,app/services/killswitch/customer_killswitch_read_service.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/drivers/customer_killswitch_read_service.py,"# Layer: L4 — Domain Engine\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Customer killswitch read operations (L4 service)\n# Callers: customer_killswitch_adapter.py (L3)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-280, PIN-281 (L2 Promotion Governance)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides read operations for customer killswitch status.\n# It queries L6 models and returns domain DTOs.\n# The L3 adapter transforms these to customer-safe DTOs.","\nCustomer Killswitch Read Service (L4)\n\nThis service provides read operations for customer killswitch status.\nL3 adapters call this service to get killswitch state, guardrails, and incident info.\n\nL3 (customer_killswitch_adapter.py) → L4 (this service) → L6 (models)\n\nThe service:\n1. Queries KillSwitchState for tenant freeze status\n2. Queries DefaultGuardrail for active guardrails\n3. Queries Incident for incident statistics\n4. Returns domain DTOs (not customer-safe - L3 transforms)\n\nReference: PI",,NEEDS_CLASSIFICATION,ITERATION_1,Read service → Driver,TRANSFER
802,app/services/knowledge/__init__.py,CUSTOMER,agent,L5,app/houseofcards/customer/agent/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-056 (KnowledgePlane model)\n""""""\nKnowledge Plane Services (GAP-056)\n\nProvides models and services for knowledge plane management\nincluding knowledge graphs, semantic indexing, and retrieval.\n\nThis module provides:\n    - KnowledgePlane: Knowledge plane model\n    - KnowledgeNode: Node in knowledge graph\n    - KnowledgePlaneRegistry: Service for managing planes\n    - Helper functions for quick access\n""""""","\nKnowledge Plane Services (GAP-056)\n\nProvides models and services for knowledge plane management\nincluding knowledge graphs, semantic indexing, and retrieval.\n\nThis module provides:\n    - KnowledgePlane: Knowledge plane model\n    - KnowledgeNode: Node in knowledge graph\n    - KnowledgePlaneRegistry: Service for managing planes\n    - Helper functions for quick access\n",,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/services/ai_console_panel_adapter/__init__.py,SKIP_INIT_COLLISION
803,app/services/knowledge/knowledge_plane.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/knowledge_plane.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-056 (KnowledgePlane model)\n""""""\nKnowledgePlane - Knowledge plane models and registry.\n\nProvides knowledge graph abstraction for:\n- Knowledge organization\n- Semantic relationships\n- Multi-source integration\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timezone\nfrom enum import Enum",\nKnowledgePlane - Knowledge plane models and registry.\n\nProvides knowledge graph abstraction for:\n- Knowledge organization\n- Semantic relationships\n- Multi-source integration\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
804,app/services/knowledge_lifecycle_manager.py,CUSTOMER,general,L4,app/houseofcards/customer/general/engines/knowledge_lifecycle_manager.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api, worker\n#   Execution: sync (with async job coordination)\n# Role: GAP-086 Knowledge Lifecycle Manager (THE ORCHESTRATOR)\n# Callers: SDK facade, API endpoints, async workers\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-086, DOMAINS_E2E_SCAFFOLD_V3.md Section 7.15\n\n""""""\nGAP-086: Knowledge Lifecycle Manager\n\nTHE ORCHESTRATOR — Single service owning entire knowledge plane lifecycle.","\nGAP-086: Knowledge Lifecycle Manager\n\nTHE ORCHESTRATOR — Single service owning entire knowledge plane lifecycle.\n\nARCHITECTURAL PRINCIPLE:\n    Lifecycle operations are governance-controlled, not user-controlled.\n    SDK calls REQUEST transitions. This manager DECIDES.\n    Policy + state machine ARBITRATE.\n    Users never force transitions directly.\n\nRESPONSIBILITIES:\n1. Enforce state machine transitions (GAP-089)\n2. Coordinate with policy gates (GAP-087)\n3. Emit audit events for all transitions",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
805,app/services/knowledge_sdk.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/knowledge_sdk.py,"# Layer: L2 — Product APIs\n# Product: system-wide\n# Temporal:\n#   Trigger: api, sdk\n#   Execution: sync (with async wait support)\n# Role: GAP-083-085 Knowledge SDK Façade\n# Callers: External SDK consumers, API endpoints\n# Allowed Imports: L4 (KnowledgeLifecycleManager)\n# Forbidden Imports: L1, L5, L6 (direct)\n# Reference: GAP-083-085, GAP_IMPLEMENTATION_PLAN_V1.md Section 7.18\n\n""""""\nGAP-083-085: Knowledge SDK Façade\n\nA thin, state-driven, async-aware SDK interface over KnowledgeLifecycleManager.","\nGAP-083-085: Knowledge SDK Façade\n\nA thin, state-driven, async-aware SDK interface over KnowledgeLifecycleManager.\n\nARCHITECTURAL PRINCIPLE:\n    SDK calls REQUEST transitions.\n    LifecycleManager DECIDES.\n    Policy + state machine ARBITRATE.\n\nDESIGN INVARIANTS:\n- SDK-001: SDK does NOT force transitions — it requests them\n- SDK-002: SDK does NOT manage state — orchestrator does\n- SDK-003: SDK does NOT bypass policy gates — gates are mandatory\n- SDK-004: SDK provides async-aware wait semantics\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
806,app/services/lifecycle/__init__.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/__init__.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Reference: GAP-131 to GAP-136 (Lifecycle APIs)\n""""""\nLifecycle Services (GAP-131-136)\n\nProvides agent and run lifecycle operations.\n""""""\n\nfrom app.services.lifecycle.facade import (\n    LifecycleFacade,\n    AgentLifecycle,\n    RunLifecycle,",\nLifecycle Services (GAP-131-136)\n\nProvides agent and run lifecycle operations.\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
807,app/services/lifecycle/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/lifecycle_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Lifecycle Facade - Centralized access to lifecycle operations\n# Callers: L2 lifecycle.py API, SDK\n# Allowed Imports: L4 lifecycle services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-131 to GAP-136 (Lifecycle APIs)\n\n""""""\nLifecycle Facade (L4 Domain Logic)",\nLifecycle Facade (L4 Domain Logic)\n\nThis facade provides the external interface for lifecycle operations.\nAll lifecycle APIs MUST use this facade instead of directly importing\ninternal lifecycle modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes agent and run lifecycle logic\n- Provides unified access to state transitions\n- Single point for audit emission\n\nL2 API Routes (GAP-131 to GAP-136):\n- POST /api/v1/lifecycle/agents (create agent)\n- GET /api/v1/lifecycle/age,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
808,app/services/lifecycle_stages/__init__.py,CUSTOMER,general,L4,app/houseofcards/customer/general/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync/async\n# Role: T4 Lifecycle Stage Handlers (GAP-071 to GAP-082, GAP-159 to GAP-161)\n# Callers: KnowledgeLifecycleManager\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-071-082, GAP-159-161, GAP_IMPLEMENTATION_PLAN_V1.md\n\n""""""\nT4 Lifecycle Stage Handlers\n\nThis package contains ""dumb plugin"" stage handlers for the Knowledge Plane lifecycle.","\nT4 Lifecycle Stage Handlers\n\nThis package contains ""dumb plugin"" stage handlers for the Knowledge Plane lifecycle.\n\nDesign Discipline:\n- Stage handlers do NOT manage state directly\n- Stage handlers do NOT emit audit events\n- Stage handlers do NOT check policies\n- Stage handlers ONLY perform their specific operation and return success/failure\n\nThe orchestrator (KnowledgeLifecycleManager) handles:\n- State management\n- Audit event emission\n- Policy gate checks\n- Error recovery\n\nOnboarding Stages (",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
809,app/services/lifecycle_stages/base.py,CUSTOMER,general,L4,app/houseofcards/customer/general/engines/lifecycle_stages_base.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync/async\n# Role: Stage Handler Protocol and Base Types\n# Callers: KnowledgeLifecycleManager, stage handlers\n# Allowed Imports: stdlib, L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-071-082, GAP_IMPLEMENTATION_PLAN_V1.md\n\n""""""\nStage Handler Protocol and Base Types\n\nThis module defines the contract for lifecycle stage handlers.","\nStage Handler Protocol and Base Types\n\nThis module defines the contract for lifecycle stage handlers.\n\nCRITICAL DESIGN INVARIANT:\n    Stage handlers are DUMB PLUGINS.\n    They do NOT manage state.\n    They do NOT emit events.\n    They do NOT check policies.\n    The orchestrator does ALL of that.\n\nWhy Dumb:\n- If stages manage state, you get split-brain\n- If stages emit events, you get duplicate audit\n- If stages check policy, you get enforcement fragmentation\n",,NEEDS_CLASSIFICATION,ITERATION_1,Lifecycle management; Domain uncertain,TRANSFER
810,app/services/lifecycle_stages/execution.py,CUSTOMER,integrations,L4,app/houseofcards/customer/integrations/engines/execution.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: execution\n# Parent Gap: GAP-071-077 (Lifecycle Stages)\n# Reference: GAP-159, GAP-160, GAP-161\n# Depends On: GAP-057 (ConnectorRegistry), GAP-156/157/158 (Job infrastructure)\n# Temporal:\n#   Trigger: lifecycle orchestrator\n#   Execution: async\n# Role: Real execution implementations for lifecycle stage handlers\n# Callers: IngestHandler, IndexHandler, ClassifyHandler\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""",\nModule: execution\nPurpose: Real execution implementations for knowledge plane lifecycle stages.\n\nWires:\n    - Source: ConnectorRegistry for data source access\n    - Target: Internal storage for processed data\n\nContains:\n    - DataIngestionExecutor (GAP-159): Real data ingestion from connectors\n    - IndexingExecutor (GAP-160): Real embedding generation and indexing\n    - ClassificationExecutor (GAP-161): Real PII detection and classification\n\nAcceptance Criteria:\n    - AC-159-01: Data read via ,,NEEDS_CLASSIFICATION,ITERATION_1,Lifecycle management,TRANSFER
811,app/services/lifecycle_stages/offboarding.py,CUSTOMER,general,L4,app/houseofcards/customer/general/engines/offboarding.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync/async\n# Role: Offboarding Stage Handlers (GAP-078 to GAP-082)\n# Callers: KnowledgeLifecycleManager via StageRegistry\n# Allowed Imports: stdlib, L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-078-082, GAP_IMPLEMENTATION_PLAN_V1.md\n\n""""""\nOffboarding Stage Handlers\n\nThese handlers implement the ""dumb plugin"" contract for knowledge plane offboarding.","\nOffboarding Stage Handlers\n\nThese handlers implement the ""dumb plugin"" contract for knowledge plane offboarding.\n\nOffboarding Path:\n    ACTIVE → PENDING_DEACTIVATE → DEACTIVATED → ARCHIVED → PURGED\n\nEach handler:\n- Performs ONLY its specific operation\n- Returns success/failure\n- Does NOT manage state\n- Does NOT emit events\n- Does NOT check policies\n\nThe KnowledgeLifecycleManager orchestrates everything else.\n\nCRITICAL: Offboarding is governance-controlled for GDPR/CCPA compliance.\n- PENDING_DEA",,NEEDS_CLASSIFICATION,ITERATION_1,Lifecycle management; Domain uncertain,TRANSFER
812,app/services/lifecycle_stages/onboarding.py,CUSTOMER,general,L4,app/houseofcards/customer/general/engines/onboarding.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync/async\n# Role: Onboarding Stage Handlers (GAP-071 to GAP-077)\n# Callers: KnowledgeLifecycleManager via StageRegistry\n# Allowed Imports: stdlib, L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-071-077, GAP_IMPLEMENTATION_PLAN_V1.md\n\n""""""\nOnboarding Stage Handlers\n\nThese handlers implement the ""dumb plugin"" contract for knowledge plane onboarding.","\nOnboarding Stage Handlers\n\nThese handlers implement the ""dumb plugin"" contract for knowledge plane onboarding.\n\nOnboarding Path:\n    DRAFT → PENDING_VERIFY → VERIFIED → INGESTING → INDEXED →\n    CLASSIFIED → PENDING_ACTIVATE → ACTIVE\n\nEach handler:\n- Performs ONLY its specific operation\n- Returns success/failure\n- Does NOT manage state\n- Does NOT emit events\n- Does NOT check policies\n\nThe KnowledgeLifecycleManager orchestrates everything else.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Lifecycle management; Domain uncertain,TRANSFER
813,app/services/limits/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limits domain services (PIN-LIM)\n# Callers: api/limits/*, api/policies.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: LIMITS_MANAGEMENT_AUDIT.md\n\n""""""\nLimits Domain Services\n\nProvides business logic for:",\nLimits Domain Services\n\nProvides business logic for:\n- Policy limits CRUD\n- Policy rules CRUD\n- Limit simulation (pre-execution check)\n- Limit overrides (temporary increases)\n\nAudit events are emitted via AuditLedgerServiceAsync (PIN-413).\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
814,app/services/limits/facade.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/limits_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limits Facade - Centralized access to rate limits and quotas\n# Callers: L2 limits.py API, SDK\n# Allowed Imports: L4 limit services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-122 (Limits API)\n\n""""""\nLimits Facade (L4 Domain Logic)",\nLimits Facade (L4 Domain Logic)\n\nThis facade provides the external interface for limit operations.\nAll limit APIs MUST use this facade instead of directly importing\ninternal limit modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes rate limit and quota logic\n- Provides unified access to usage tracking\n- Single point for audit emission\n\nL2 API Routes (GAP-122):\n- GET /api/v1/limits (list limits)\n- GET /api/v1/limits/{id} (get limit)\n- PUT /api/v1/limits/{id} (update,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
815,app/services/limits/override_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/override_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limit override service (PIN-LIM-05)\n# Callers: api/limits/override.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-LIM-05\n\n""""""\nLimit Override Service (PIN-LIM-05)\n\nLifecycle of temporary limit overrides.",\nLimit Override Service (PIN-LIM-05)\n\nLifecycle of temporary limit overrides.\n\nResponsibilities:\n- Create override requests\n- Handle approval workflow\n- Expiry handling\n- Attach justification & requester\n- Emit signals to runtime evaluator\n- Audit events\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
816,app/services/limits/policy_limits_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/policy_limits_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Policy limits CRUD service (PIN-LIM-01)\n# Callers: api/policies.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-LIM-01\n\n""""""\nPolicy Limits Service (PIN-LIM-01)\n\nAuthoritative writer for policy limits table.","\nPolicy Limits Service (PIN-LIM-01)\n\nAuthoritative writer for policy limits table.\n\nResponsibilities:\n- Create/update/delete limits\n- Validate scope (tenant / worker / global)\n- Enforce immutables (category, type cannot change after creation)\n- Emit audit events\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
817,app/services/limits/policy_rules_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/policy_rules_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Policy rules CRUD service (PIN-LIM-02)\n# Callers: api/policies.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-LIM-02\n\n""""""\nPolicy Rules Service (PIN-LIM-02)\n\nPersist and validate policy rule logic.",\nPolicy Rules Service (PIN-LIM-02)\n\nPersist and validate policy rule logic.\n\nResponsibilities:\n- Create/update rules\n- Rule syntax validation\n- Link rules → limits\n- Handle retirement (rules are never deleted)\n- Emit audit events\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
818,app/services/limits/simulation_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/simulation_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Limits simulation service (PIN-LIM-04)\n# Callers: api/limits/simulate.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-LIM-04\n\n""""""\nLimits Simulation Service (PIN-LIM-04)\n\nCoordination layer for pre-execution limit checks.","\nLimits Simulation Service (PIN-LIM-04)\n\nCoordination layer for pre-execution limit checks.\n\nResponsibilities:\n- Aggregate all limit types (tenant quotas, cost budgets, worker limits, policy limits)\n- Load active overrides\n- Call evaluator\n- Normalize response for API\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
819,app/services/llm_failure_service.py,CUSTOMER,incidents,L4,app/houseofcards/customer/incidents/engines/llm_failure_service.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: S4 failure truth model, fact persistence\n# Callers: L5 workers (on LLM failure)\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""\nLLMFailureService - S4 Failure Truth Implementation\n\nImplements PIN-196 requirements:\n- Failure fact persistence (before any other action)\n- Run state transition to FAILED\n- Evidence capture (mandatory)\n- No downstream contamination\n","\nLLMFailureService - S4 Failure Truth Implementation\n\nImplements PIN-196 requirements:\n- Failure fact persistence (before any other action)\n- Run state transition to FAILED\n- Evidence capture (mandatory)\n- No downstream contamination\n\nARCHITECTURE RULE: Explicit dependency injection, NO lazy service resolution.\nSee LESSONS_ENFORCED.md Invariant #10.\n\nCritical Invariant:\n> A failed run must never appear as ""successful"" or ""completed with results.""\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
820,app/services/llm_policy_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/llm_policy_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: LLM policy and safety limits enforcement\n# Callers: OpenAIAdapter (L3), TenantLLMConfig (L3), llm_invoke skills\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-254 Phase B Fix\n\n""""""\nL4 LLM Policy Engine - Domain Authority for LLM Safety and Cost Controls\n\nB01/B05 FIX: Moved from L3 adapters to L4 domain engine.","\nL4 LLM Policy Engine - Domain Authority for LLM Safety and Cost Controls\n\nB01/B05 FIX: Moved from L3 adapters to L4 domain engine.\nThis engine is the authoritative source for:\n- Safety limits (max tokens, max cost, rate limits)\n- Model selection policy\n- Budget enforcement\n- Model restrictions\n\nL3 adapters must delegate all policy decisions to this engine.\n\nEnvironment Variables:\n- LLM_MAX_TOKENS_PER_REQUEST: Max tokens per request (default: 16000)\n- LLM_MAX_COST_CENTS_PER_REQUEST: Max cost in ",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
821,app/services/llm_threshold_service.py,CUSTOMER,activity,L4,app/houseofcards/customer/activity/engines/llm_threshold_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api | worker\n#   Execution: sync\n# Role: LLM run threshold resolution and evaluation\n# Callers: api/activity/*, worker/runtime/*\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Policies → Limits → Thresholds → Set Params panel\n#\n# =============================================================================\n# SIGNAL EMISSION ARCHITECTURE\n# =============================================================================\n#","\nLLM Threshold Service\n\nProvides:\n- ThresholdParams: Validated threshold configuration\n- LLMRunThresholdResolver: Resolves effective params from Policy → Limit chain\n- LLMRunEvaluator: Evaluates runs against thresholds, emits signals\n- emit_and_persist_threshold_signal: Dual emit to Founder AND Customer consoles\n\nThis is the governance layer that enables:\n- ACT-LLM-LIVE-O2: ""Surface live runs exceeding expected execution time""\n- ACT-LLM-COMP-O3: ""Expose completed runs that ended in failure""\n\nSaf",,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Thresholds),TRANSFER
822,app/services/logging/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-019 (Alert → Log Linking)\n""""""\nLogging Services (GAP-019)\n\nProvides alert-to-log linking for explicit correlation between\nthreshold alerts and run execution logs.\n\nThis module provides:\n    - AlertLogLink: Model for alert-log relationships\n    - AlertLogLinker: Service for creating and querying links\n    - AlertLogLinkResponse: Response model for API\n    - Helper functions for quick access\n""""""",\nLogging Services (GAP-019)\n\nProvides alert-to-log linking for explicit correlation between\nthreshold alerts and run execution logs.\n\nThis module provides:\n    - AlertLogLink: Model for alert-log relationships\n    - AlertLogLinker: Service for creating and querying links\n    - AlertLogLinkResponse: Response model for API\n    - Helper functions for quick access\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
823,app/services/logging/alert_log_linker.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/alert_log_linker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Link alerts to log records for explicit correlation\n# Callers: alert_emitter, incident_service, trace_service\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-019 (Alert → Log Linking)\n\n""""""\nModule: alert_log_linker\nPurpose: Explicit linking between alerts and log records.\n","\nModule: alert_log_linker\nPurpose: Explicit linking between alerts and log records.\n\nGAP-019: Alert → Log linking must be explicit, not implicit.\nThis service provides:\n    - Create links between alerts and log entries\n    - Query logs by alert or alerts by run\n    - Track link creation and access patterns\n    - Support for different link types (threshold, breach, incident)\n\nExports:\n    - AlertLogLinkType: Type of link (threshold, breach, incident)\n    - AlertLogLinkStatus: Status of link (acti",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
824,app/services/logs_facade.py,CUSTOMER,logs,L3,app/houseofcards/customer/logs/facades/logs_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB reads)\n# Role: Logs domain facade - unified entry point for all logs operations\n# Callers: L2 logs API (logs.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: LOGS_DOMAIN_V2_CONTRACT.md, PIN-411\n#\n""""""\nLogs Domain Facade (L4)\n","\nLogs Domain Facade (L4)\n\nUnified facade for all logs domain operations:\n- LLM_RUNS: envelope, trace, governance, replay, export\n- SYSTEM_LOGS: snapshot, telemetry, events, replay, audit\n- AUDIT: identity, authorization, access, integrity, exports\n\nAll responses include EvidenceMetadata per INV-LOG-META-001.\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
825,app/services/logs_read_service.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/drivers/logs_read_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async (delegates to L6)\n# Role: Logs/Traces domain read operations (L4)\n# Callers: customer_logs_adapter.py (L3)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (L3 Adapter Closure - PHASE 1)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides READ operations for the Logs/Traces domain.\n# All log/trace reads must go through this service.\n# The L3 adapter should NOT import L6 directly.",\nLogs Read Service (L4)\n\nThis service provides all READ operations for the Logs/Traces domain.\nIt sits between L3 (CustomerLogsAdapter) and L6 (PostgresTraceStore).\n\nL3 (Adapter) → L4 (this service) → L6 (PostgresTraceStore)\n\nResponsibilities:\n- Query traces with tenant isolation\n- Get trace details\n- Get trace counts\n- Search traces with filters\n- No write operations (writes go through runtime)\n\nReference: PIN-281 (L3 Adapter Closure - PHASE 1)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Read service → Driver,TRANSFER
826,app/services/mcp/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Role: MCP (Model Context Protocol) services package\n# Reference: GAP-141, GAP-142, GAP-143\n\n""""""\nMCP services for external server integration.\n\nProvides:\n- Server registration and discovery (GAP-141)\n- Tool→Policy mapping (GAP-142)\n- Audit evidence emission (GAP-143)\n""""""\n\nfrom app.services.mcp.server_registry import (",\nMCP services for external server integration.\n\nProvides:\n- Server registration and discovery (GAP-141)\n- Tool→Policy mapping (GAP-142)\n- Audit evidence emission (GAP-143)\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
827,app/services/mcp/audit_evidence.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/audit_evidence.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: audit\n# Parent Gap: GAP-063 (MCPConnector), GAP-081 (AuditDaemon)\n# Reference: GAP-143\n# Depends On: GAP-141 (MCPServerRegistry), GAP-142 (MCPPolicyMapper)\n# Temporal:\n#   Trigger: worker (tool invocation)\n#   Execution: async\n# Role: Emit compliance-grade audit for MCP tool calls\n# Callers: Runner, skill executor\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""",\nModule: audit_evidence\nPurpose: Emit compliance-grade audit for MCP tool calls.\n\nWires:\n    - Source: app/services/mcp/policy_mapper.py (policy decisions)\n    - Source: app/services/mcp/server_registry.py (server/tool info)\n    - Target: app/events (event bus) / audit storage\n\nThis module:\n    1. Emits audit events for all MCP tool invocations\n    2. Records policy decisions for compliance\n    3. Captures input/output for forensic analysis\n    4. Provides tamper-evident audit trail\n\nAcceptance ,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
828,app/services/mcp/policy_mapper.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_mapper.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: policy-gate\n# Parent Gap: GAP-063 (MCPConnector), GAP-087 (PolicyGate)\n# Reference: GAP-142\n# Depends On: GAP-141 (MCPServerRegistry)\n# Temporal:\n#   Trigger: worker (tool invocation)\n#   Execution: async\n# Role: Map MCP tool invocations to policy gates\n# Callers: Runner, skill executor\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""",\nModule: policy_mapper\nPurpose: Map MCP tool invocations to policy gates.\n\nWires:\n    - Source: app/services/mcp/server_registry.py (tools)\n    - Source: app/services/policies/policy_engine.py (policy evaluation)\n    - Target: Tool invocations are gated by policy\n\nThis module:\n    1. Maps MCP tool invocations to policy checks\n    2. Determines required permissions for each tool\n    3. Evaluates policy before allowing invocation\n    4. Provides deny-by-default for unknown tools\n\nAcceptance Criter,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
829,app/services/mcp/server_registry.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/server_registry.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# PHASE: W0\n# Product: system-wide\n# Wiring Type: registry\n# Parent Gap: GAP-063 (MCPConnector)\n# Reference: GAP-141\n# Temporal:\n#   Trigger: api (MCP server management)\n#   Execution: async\n# Role: Registry for external MCP servers\n# Callers: L2 API routes, skill execution\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n",\nModule: server_registry\nPurpose: Registry for external MCP servers.\n\nProvides:\n    - MCP server registration\n    - Server capability discovery\n    - Health monitoring\n    - Tenant-scoped access control\n\nDatabase Table: mcp_servers (requires GAP-170 migration)\n\nMCP Protocol Reference: https://modelcontextprotocol.io/specification\n\nAcceptance Criteria:\n    - AC-141-01: Servers can be registered\n    - AC-141-02: Tool discovery via MCP protocol\n    - AC-141-03: Health monitoring\n    - AC-141-04: Te,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
830,app/services/mediation/__init__.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Role: Mediation layer for governed data access\n\n""""""\nMediation Package\n\nContains the retrieval mediation layer for governed data access:\n- retrieval_mediator: Central mediation point (GAP-065)\n""""""\n\nfrom app.services.mediation.retrieval_mediator import (\n    RetrievalMediator,\n    MediatedResult,\n    MediationDeniedError,",\nMediation Package\n\nContains the retrieval mediation layer for governed data access:\n- retrieval_mediator: Central mediation point (GAP-065)\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
831,app/services/mediation/retrieval_mediator.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/retrieval_mediator.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api (aos_sdk.access calls)\n#   Execution: sync\n# Role: Unified mediation layer for all external data access\n# Callers: L2 API routes, skill execution\n# Allowed Imports: L6 (logging, datetime)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-065\n\n""""""\nModule: retrieval_mediator\nPurpose: All external data access must route through this layer.\n","\nModule: retrieval_mediator\nPurpose: All external data access must route through this layer.\n\nThis is the CENTRAL CHOKE POINT for data retrieval.\nAny data access from LLM-controlled code MUST go through here.\n\nImports (Dependencies):\n    - None (interfaces defined here, implementations injected)\n\nExports (Provides):\n    - RetrievalMediator: Main mediation class\n    - MediatedResult: Result of a mediated access\n    - MediationDeniedError: Raised when access denied\n    - get_retrieval_mediator(): ",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
832,app/services/monitors/__init__.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/__init__.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Reference: GAP-120 (Health Check API), GAP-121 (Monitor Configuration API)\n""""""\nMonitors Services (GAP-120, GAP-121)\n\nProvides monitoring and health check operations.\n""""""\n\nfrom app.services.monitors.facade import (\n    MonitorsFacade,\n    MonitorConfig,\n    HealthCheckResult,","\nMonitors Services (GAP-120, GAP-121)\n\nProvides monitoring and health check operations.\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
833,app/services/monitors/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/monitors_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# PHASE: W4\n# Product: system-wide\n# Temporal:\n#   Trigger: api or scheduler\n#   Execution: async\n# Role: Monitors Facade - Centralized access to monitoring operations\n# Callers: L2 monitors.py API, SDK, Scheduler\n# Allowed Imports: L4 monitor services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-120 (Health Check API), GAP-121 (Monitor Configuration API)\n\n""""""\nMonitors Facade (L4 Domain Logic)","\nMonitors Facade (L4 Domain Logic)\n\nThis facade provides the external interface for monitoring operations.\nAll monitor APIs MUST use this facade instead of directly importing\ninternal monitor modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes health monitoring logic\n- Provides unified access to monitor configuration\n- Single point for audit emission\n\nL2 API Routes (GAP-120, GAP-121):\n- POST /api/v1/monitors (create monitor)\n- GET /api/v1/monitors (list monitors)\n- ",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
834,app/services/notifications/__init__.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-017 (Notify Channels)\n""""""\nNotification Services (GAP-017)\n\nProvides configurable notification channels for alerts, incidents,\nand policy events. Supports UI, Webhook, Email, and Slack channels.\n\nThis module provides:\n    - NotifyChannel: Enum of available notification channels\n    - NotifyChannelConfig: Channel configuration model\n    - NotifyChannelService: Service for channel management\n    - NotifyDeliveryResult: Delivery result tracking\n    - Helper functions for notification operations","\nNotification Services (GAP-017)\n\nProvides configurable notification channels for alerts, incidents,\nand policy events. Supports UI, Webhook, Email, and Slack channels.\n\nThis module provides:\n    - NotifyChannel: Enum of available notification channels\n    - NotifyChannelConfig: Channel configuration model\n    - NotifyChannelService: Service for channel management\n    - NotifyDeliveryResult: Delivery result tracking\n    - Helper functions for notification operations\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
835,app/services/notifications/channel_service.py,CUSTOMER,incidents,L4,app/houseofcards/customer/incidents/engines/channel_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: async\n# Role: Configurable notification channel management\n# Callers: alert_emitter, incident_service, policy_engine\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-017 (Notify Channels)\n\n""""""\nModule: channel_service\nPurpose: Configurable notification channels for alerts and events.\n",\nModule: channel_service\nPurpose: Configurable notification channels for alerts and events.\n\nGAP-017: Notify channels must be configurable per tenant/policy.\nThis service provides:\n    - Channel configuration (enable/disable per channel type)\n    - Channel validation (test connectivity)\n    - Delivery tracking (success/failure metrics)\n    - Retry logic for failed deliveries\n\nExports:\n    - NotifyChannel: Enum of available channels\n    - NotifyEventType: Enum of event types\n    - NotifyChannelCo,,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Notifications),TRANSFER
836,app/services/notifications/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/notifications_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api or worker (async delivery)\n#   Execution: async\n# Role: Notifications Facade - Centralized access to notification operations\n# Callers: L2 notifications.py API, SDK, Worker\n# Allowed Imports: L4 notification services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-109 (Notification API)\n\n""""""\nNotifications Facade (L4 Domain Logic)\n\nThis facade provides the external interface for notification operations.",\nNotifications Facade (L4 Domain Logic)\n\nThis facade provides the external interface for notification operations.\nAll notification APIs MUST use this facade instead of directly importing\ninternal notification modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes notification delivery logic\n- Provides unified access to multiple notification channels\n- Single point for audit emission\n\nL2 API Routes (GAP-109):\n- POST /api/v1/notifications (send notification)\n- GET /api/v,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
837,app/services/observability/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Observability domain services\n# Callers: L5 runner, L2 APIs\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nObservability Domain Services\n\nThis module provides the facade for trace operations with RAC integration.",\nObservability Domain Services\n\nThis module provides the facade for trace operations with RAC integration.\n\nComponents:\n- TraceFacade: Wraps trace store operations with RAC ack emission\n\nReference: PIN-454 Section 8.2 (Runtime Audit Contract)\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
838,app/services/observability/trace_facade.py,CUSTOMER,logs,L3,app/houseofcards/customer/logs/facades/trace_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (run execution)\n#   Execution: async\n# Role: Trace Domain Facade - Centralized access to trace operations with RAC acks\n# Callers: L5 runner/observability guard (via dependency injection), API routes\n# Allowed Imports: L4 audit, L6 (trace store, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nTrace Domain Facade (L4 Domain Logic)\n\nThis facade provides the external interface to the Trace domain.",\nTrace Domain Facade (L4 Domain Logic)\n\nThis facade provides the external interface to the Trace domain.\nIt wraps TraceStore operations and emits RAC acknowledgments.\n\nWhy This Facade Exists (PIN-454):\n- Centralized RAC acknowledgment emission for trace operations\n- Clean interface between L5 execution and L6 platform\n- Domain encapsulation for trace operations\n\nRAC Integration:\n- Emits START_TRACE ack after trace creation\n- Emits COMPLETE_TRACE ack after trace completion\n\nUsage:\n    from app.se,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
839,app/services/ops/__init__.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: founder-console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Ops domain services for Founder Console\n# Callers: Ops API (L2)\n# Allowed Imports: L5, L6 (infra, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: API-001 Guardrail (Domain Facade Required)\n\n""""""\nOps Domain Services\n\nL4 services for Founder Console operations:",\nOps Domain Services\n\nL4 services for Founder Console operations:\n- OpsFacade: External access point for ops operations\n- DatabaseErrorStore: ErrorStoreProtocol implementation\n\nDesign Rules:\n- External code MUST use OpsFacade (API-001)\n- Internal services accessed only via facade\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
840,app/services/ops/error_store.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/engines/error_store.py,"# Layer: L4 — Domain Engine\n# Product: founder-console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: ErrorStoreProtocol implementation for OpsIncidentService\n# Callers: OpsFacade\n# Allowed Imports: L6 (infra, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-264 (Phase-S Track 1.3)\n\n""""""\nDatabase Error Store\n\nImplements ErrorStoreProtocol for OpsIncidentService using the",\nDatabase Error Store\n\nImplements ErrorStoreProtocol for OpsIncidentService using the\ninfra_error_events table via app.infra.error_store functions.\n\nThis bridges the L6 infra layer with the L4 ops aggregation service.\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
841,app/services/ops/facade.py,FOUNDER,ops,L5,app/houseofcards/founder/ops/engines/ops_facade.py,"# Layer: L4 — Domain Engine\n# Product: founder-console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Ops Domain Facade - Centralized access to ops operations\n# Callers: Ops API routes (L2)\n# Allowed Imports: L4 ops services, L5, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: API-001 Guardrail (Domain Facade Required)\n\n""""""\nOps Domain Facade\n\nThis facade provides the external interface to the Ops domain.","\nOps Domain Facade\n\nThis facade provides the external interface to the Ops domain.\nAll code outside the Ops domain MUST use this facade.\n\nWhy Facades Matter:\n- Authorization checks happen in one place\n- Audit logging is centralized\n- Domain encapsulation is preserved\n- Interface stability for external callers\n\nUsage:\n    from app.services.ops import get_ops_facade\n\n    facade = get_ops_facade()\n    incidents = facade.get_active_incidents(since, until)\n",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
842,app/services/ops_domain_models.py,FOUNDER,platform,L5,app/houseofcards/founder/platform/engines/ops_domain_models.py,"# Layer: L4 — Domain Engines\n# Product: system-wide (ops visibility)\n# Temporal:\n#   Trigger: api|scheduler\n#   Execution: sync\n# Role: Ops domain models for operator intelligence views\n# Callers: L3 adapters, L2 ops APIs\n# Allowed Imports: L6 (stdlib only for models)\n# Forbidden Imports: L6 infra artifacts (ErrorEnvelope, CorrelationContext)\n# Reference: PIN-264 (Phase-S Ops Domain)\n\n""""""\nOps Domain Models — L4 Interpreted Meaning\n\nThese models represent OPERATOR understanding, NOT infra truth.","\nOps Domain Models — L4 Interpreted Meaning\n\nThese models represent OPERATOR understanding, NOT infra truth.\n\nDesign Principles:\n- Derived: Computed from infra data, never raw infra\n- Lossy: Intentionally simplified for human consumption\n- Opinionated: Contains interpretation and severity judgment\n- Role-scoped: Designed for operator visibility, not debugging\n\nPublication Pipeline:\n    L6 Infra (ErrorEnvelope, DecisionSnapshot)\n        ↓ (translation happens in services)\n    L4 Ops Domain Models",,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
843,app/services/ops_incident_service.py,FOUNDER,incidents,L4,app/houseofcards/founder/incidents/engines/ops_incident_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide (ops visibility)\n# Temporal:\n#   Trigger: api|scheduler\n#   Execution: sync\n# Role: Translate infra errors into operator-facing incidents\n# Callers: L3 adapters (FounderOpsAdapter, PreflightOpsAdapter)\n# Allowed Imports: L6 (infra stores), L4 (ops domain models)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-264 (Phase-S L4 Aggregation)\n\n""""""\nOps Incident Service — L4 Aggregation Layer\n\nTranslates infra truth (ErrorEnvelope) into operator understanding (OpsIncident).","\nOps Incident Service — L4 Aggregation Layer\n\nTranslates infra truth (ErrorEnvelope) into operator understanding (OpsIncident).\n\nThis service answers: ""What incidents are happening?""\n\nDesign Principles:\n- INPUT: Time window, severity threshold, optional component scope\n- OUTPUT: List[OpsIncident] (domain models only)\n- NO: UI shaping, pagination, sorting for display, auth, filtering by role\n\nHARD RULES:\n1. Never return infra artifacts (ErrorEnvelope, raw DB rows)\n2. Never know about consoles (fo",,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Ops),TRANSFER
844,app/services/ops_write_service.py,FOUNDER,agent,L6,app/houseofcards/founder/agent/drivers/ops_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Ops Console)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Ops API (Phase 2B extraction)\n# Callers: api/ops.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 3\n\n""""""\nOps Write Service - DB write operations for Ops API.\n\nPhase 2B Batch 3: Extracted from api/ops.py.",\nOps Write Service - DB write operations for Ops API.\n\nPhase 2B Batch 3: Extracted from api/ops.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,Write service → Driver,TRANSFER
845,app/services/orphan_recovery.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/orphan_recovery.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: Orphan detection logic, PB-S2 truth guarantee\n# Callers: L5 workers (startup), L7 ops scripts\n# Reference: PIN-242 (Baseline Freeze)\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Updates run status from ""running"" to ""crashed"" - factual state mutation\n# Atomic updates with no external dependencies\nFEATURE_INTENT = FeatureIntent.STATE_MUTATION\nRETRY_POLICY = RetryPolicy.SAFE\n\n""""""",,,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
846,app/services/override/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-034 (Override Authority Integration)\n""""""\nOverride Authority Integration Service (GAP-034)\n\nProvides integration between OverrideAuthority model and the\nprevention engine. The prevention engine must check override\nstatus before enforcing policy actions.\n\nThis module provides:\n    - OverrideAuthorityChecker: Checks override status for policies\n    - OverrideStatus: Result of an override check\n    - should_skip_enforcement: Quick helper function\n""""""",\nOverride Authority Integration Service (GAP-034)\n\nProvides integration between OverrideAuthority model and the\nprevention engine. The prevention engine must check override\nstatus before enforcing policy actions.\n\nThis module provides:\n    - OverrideAuthorityChecker: Checks override status for policies\n    - OverrideStatus: Result of an override check\n    - should_skip_enforcement: Quick helper function\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
847,app/services/override/authority_checker.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/authority_checker.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Check override authority before policy enforcement\n# Callers: policy/prevention_engine.py, services/enforcement/\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-034 (Override Authority Integration)\n\n""""""\nModule: authority_checker\nPurpose: Check override authority status for prevention engine.\n","\nModule: authority_checker\nPurpose: Check override authority status for prevention engine.\n\nThe prevention engine must check override authority before enforcing\nany policy actions. If an override is active, enforcement is skipped.\n\nIntegration Flow:\n    1. Prevention engine receives policy ID\n    2. Calls OverrideAuthorityChecker.check()\n    3. If override is active, skip enforcement\n    4. If no override, proceed with enforcement\n\nExports:\n    - OverrideStatus: Enum of override states\n    - Ove",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
848,app/services/overview_facade.py,CUSTOMER,overview,L3,app/houseofcards/customer/overview/facades/overview_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console (Customer Console)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Overview Facade - Centralized access to overview domain operations\n# Callers: L2 overview.py API\n# Allowed Imports: L4 services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: OVERVIEW Domain - One Facade Architecture, PIN-413\n\n""""""\nOverview Facade (L4 Domain Logic)\n",\nOverview Facade (L4 Domain Logic)\n\nThis facade provides the external interface for overview operations.\nAll overview APIs MUST use this facade instead of directly importing\nmodels or executing queries in L2.\n\nWhy This Facade Exists:\n- Prevents L2→L6 layer violations (direct model imports)\n- Centralizes overview aggregation logic\n- Single point for tenant-scoped queries\n- Maintains projection-only architecture\n\nARCHITECTURAL RULE:\n- Overview DOES NOT own any tables\n- Overview aggregates/projects,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
849,app/services/panel_invariant_monitor.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/panel_invariant_monitor.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler\n#   Execution: async\n# Role: Monitor panel invariants and detect silent governance failures\n# Callers: main.py (scheduler), ops endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-411 (Gap Closure - Part B)\n\n""""""\nPanel Invariant Monitor\n\nThis module prevents silent governance failures by monitoring panel-backing queries.",\nPanel Invariant Monitor\n\nThis module prevents silent governance failures by monitoring panel-backing queries.\n\nA panel returning zero rows may mean:\n- Correct state (no violations) - acceptable\n- Broken ingestion - FAILURE\n- Filter regression - FAILURE\n- Upstream failure - FAILURE\n\nThe UI cannot distinguish these. This monitor provides out-of-band alerting.\n\nKey Principle: Zero results NEVER block UI rendering.\n               Zero results only trigger out-of-band alerting.\n\nAlert Types:\n- EMPTY,,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
850,app/services/pattern_detection.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/pattern_detection.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: None (ORPHAN - pending integration)\n# Reference: PIN-240\n# WARNING: If this logic is wrong, ALL products break.\n\n""""""\nPattern Detection Service (PB-S3)\n\nDetects patterns in execution data and emits feedback WITHOUT modifying history.\n\nPB-S3 Contract:\n- Observe patterns → create feedback → do nothing else\n- NO modification of worker_runs, traces, or costs\n- Feedback stored SEPARATELY in pattern_feedback table","\nPattern Detection Service (PB-S3)\n\nDetects patterns in execution data and emits feedback WITHOUT modifying history.\n\nPB-S3 Contract:\n- Observe patterns → create feedback → do nothing else\n- NO modification of worker_runs, traces, or costs\n- Feedback stored SEPARATELY in pattern_feedback table\n\nPattern Types:\n- failure_pattern: Same error signature N times\n- cost_spike: Abnormal cost increase detected\n",,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
851,app/services/pdf_renderer.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/pdf_renderer.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Render export bundles to PDF format\n# Callers: api/incidents.py\n# Allowed Imports: L4, L5, L6\n# Forbidden Imports: L1, L2\n# Reference: BACKEND_REMEDIATION_PLAN.md GAP-004, GAP-005\n\n""""""\nPDF Renderer Service\n\nRenders export bundles to PDF format for compliance exports,","\nPDF Renderer Service\n\nRenders export bundles to PDF format for compliance exports,\nexecutive debriefs, and evidence documentation.\n\nKey Responsibilities:\n1. Render EvidenceBundle to detailed PDF\n2. Render SOC2Bundle with control attestations\n3. Render ExecutiveDebriefBundle for leadership\n\nUses reportlab for PDF generation (same library as evidence_report.py).\n",,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
852,app/services/plan_generation_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/plan_generation_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: api (run creation)\n#   Execution: sync\n# Role: Plan generation (domain logic)\n# Authority: Plan generation decisions (M7 pattern)\n# Callers: API endpoints (L2), run creation flow\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md\n# Reference: PIN-257 Phase R-2 (L5→L4 Violation Fix)\n#\n# GOVERNANCE NOTE: This L4 engine owns PLAN GENERATION logic.\n# L5 runner.py owns only PLAN EXECUTION logic.","\nDomain engine for plan generation.\n\nThis L4 engine contains the authoritative logic for:\n1. Memory context retrieval\n2. Plan generation via planner\n3. Plan validation\n\nL5 workers must receive plans from this engine (via run.plan_json),\nnot generate their own plans.\n\nReference: PIN-257 Phase R-2\nGovernance: PHASE_R_L5_L4_VIOLATIONS.md\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
853,app/services/platform/__init__.py,CUSTOMER,platform,L5,app/houseofcards/customer/platform/engines/__init__.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Platform services package initialization\n# Callers: L3 adapters, L2 APIs\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-284 (Platform Monitoring System)\n\n""""""\nPlatform Services Package (L4)\n\nProvides platform-level domain engines for:",\nPlatform Services Package (L4)\n\nProvides platform-level domain engines for:\n- Platform health monitoring (platform_health_service)\n- [Future] Platform eligibility (wire to L3)\n\nContract:\n- All platform services are L4 authority\n- They consume L6 signals and produce deterministic states\n- No L3/L2 imports allowed\n,,NEEDS_CLASSIFICATION,ITERATION_1,Package init,TRANSFER
854,app/services/platform/platform_health_service.py,CUSTOMER,platform,L4,app/houseofcards/customer/platform/engines/platform_health_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker|scheduler\n#   Execution: sync\n# Role: Platform Health Authority - THE source of truth for platform state\n# Callers: L3 (PlatformEligibilityAdapter), L2 (/platform/health), L7 (bootstrap)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-284 (Platform Monitoring System)\n#\n# ==============================================================================\n# GOVERNANCE RULE: HEALTH-IS-AUTHORITY (Non-Negotiable)\n# ==============================================================================\n#","\nPlatform Health Service (L4)\n\nThe authoritative source for platform health state.\nConverts raw signals into deterministic health states.\n\nResponsibilities:\n1. Aggregate signals from L6/L7 sources (BLCA, guards, incidents, contracts)\n2. Produce deterministic health states (HEALTHY/DEGRADED/BLOCKED)\n3. Provide health for system, domains, and individual capabilities\n4. Drive governance consequences via health→qualifier binding\n\nContract:\n- Health states are closed set: {HEALTHY, DEGRADED, BLOCKED}",,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Platform),TRANSFER
855,app/services/policies_facade.py,CUSTOMER,policies,L3,app/houseofcards/customer/policies/facades/policies_facade.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: CUSTOMER\n# Product: ai-console\n# Temporal:\n#   Trigger: api\n#   Execution: async (DB operations)\n# Role: Policies domain facade - unified entry point for policy management operations\n# Callers: L2 policies API (policies.py)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: POLICIES Domain - Customer Console v1 Constitution\n#\n""""""\nPolicies Domain Facade (L4)\n","\nPolicies Domain Facade (L4)\n\nUnified facade for policy management operations.\n\nProvides:\n- Policy Rules: list, get detail\n- Limits: list, get detail\n- Lessons: list, get detail, stats\n- Policy State: synthesized snapshot\n- Policy Metrics: enforcement effectiveness\n- Policy Conflicts: detect contradictions\n- Policy Dependencies: structural relationships\n- Policy Violations: unified violation view\n- Budget Definitions: enforcement limits\n- Policy Requests: pending approvals\n\nAll operations are te",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
856,app/services/policy/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engine\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Role: Policy domain services package\n# Reference: POLICY Domain Qualification, API-001 Guardrail, FACADE_CONSOLIDATION_PLAN.md\n\n""""""\nPolicy Domain Services (L4)\n\nThis package provides domain-level services for policy operations.\nL3 adapters should import from this package, NOT from L6 models directly.\n\nAvailable services:\n- PolicyDriver: INTERNAL driver for policy evaluation (workers, governance)\n- CustomerPolicyReadService: Read operations for customer policy constraints","\nPolicy Domain Services (L4)\n\nThis package provides domain-level services for policy operations.\nL3 adapters should import from this package, NOT from L6 models directly.\n\nAvailable services:\n- PolicyDriver: INTERNAL driver for policy evaluation (workers, governance)\n- CustomerPolicyReadService: Read operations for customer policy constraints\n- PolicySnapshotRegistry: Immutable policy snapshot management (GAP-029)\n\nFor CUSTOMER API CRUD operations, use policies_facade.py (at services root) inste",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
857,app/services/policy/customer_policy_read_service.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/drivers/customer_policy_read_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync (delegates to L6)\n# Role: Customer policy domain read operations (L4)\n# Callers: customer_policies_adapter.py (L3)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: PIN-281 (POLICY Domain Qualification)\n#\n# GOVERNANCE NOTE:\n# This L4 service provides READ operations for the Policy domain.\n# All policy constraint reads must go through this service.\n# The L3 adapter should NOT import L6 directly.","\nCustomer Policy Read Service (L4)\n\nThis service provides all READ operations for the Policy domain.\nIt sits between L3 (CustomerPoliciesAdapter) and L6 (Tenant, ProxyCall, DefaultGuardrail).\n\nL3 (Adapter) → L4 (this service) → L6 (Models)\n\nResponsibilities:\n- Query tenant budget settings\n- Calculate current period usage\n- Query guardrails list\n- Translate internal models → customer-visible policy constraints\n- Hide internal fields (threshold values, rule configs)\n- Stable period calculation\n\nRe",,NEEDS_CLASSIFICATION,ITERATION_1,Read service → Driver,TRANSFER
858,app/services/policy/lessons_engine.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/lessons_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: worker (run events), incident_engine (failure events)\n#   Execution: sync\n# Role: Lessons learned creation and management (domain logic)\n# Authority: Lesson generation from system events (SDSR pattern)\n# Callers: IncidentEngine, Worker runtime, API endpoints\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: SDSR (PIN-370), PB-S4 (Policy Proposals)\n# Reference: PIN-411, POLICIES_DOMAIN_AUDIT.md Section 11\n#\n# GOVERNANCE NOTE: This L4 engine owns LESSON CREATION logic.\n# Scenarios inject causes (events), this engine creates lessons.","\nLessons Learned Engine (L4 Domain Logic)\n\nThis engine implements the learning-driven governance pattern:\n- Failures (all severities) → Lesson created\n- Near-threshold events → Lesson created\n- Critical success events → Lesson created\n\nLessons are the memory substrate for policy evolution.\nOnly human action (via PolicyProposalEngine) converts lessons to drafts.\n\nReference: PIN-411, POLICIES_DOMAIN_AUDIT.md Section 11\n",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Engine,TRANSFER
859,app/services/policy/policy_driver.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/drivers/policy_driver.py,"# Layer: L4 — Domain Driver\n# AUDIENCE: INTERNAL\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync/async\n# Role: Policy Domain Driver - Internal orchestration for policy operations\n# Callers: policy_layer API, governance services, worker runtime\n# Allowed Imports: L4 policy engine, L5, L6 (models, db)\n# Forbidden Imports: L1, L2, L3\n# Reference: FACADE_CONSOLIDATION_PLAN.md, API-001 Guardrail\n#\n# GOVERNANCE NOTE:\n# This is the INTERNAL driver for policy evaluation operations.\n# CUSTOMER-facing CRUD operations use policies_facade.py (L2 API projection).","\nPolicy Domain Driver (INTERNAL)\n\nThis driver provides the internal interface for policy evaluation operations.\nUsed by policy_layer API, governance services, and worker runtime.\n\nFor CUSTOMER policy CRUD operations, use policies_facade.py instead.\n\nWhy Drivers (not Facades for internal use):\n- Facades are API projection layers (CUSTOMER-facing)\n- Drivers are orchestration layers (INTERNAL)\n- Clear separation prevents confusion\n- Import rules become enforceable\n\nUsage:\n    from app.services.poli",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Driver,TRANSFER
860,app/services/policy/snapshot_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/snapshot_service.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-029 (Policy snapshot immutability)\n""""""\nPolicy Snapshot Immutability Service (GAP-029).\n\nProvides immutable policy snapshot management with:\n- Immutability enforcement (no modifications after creation)\n- Snapshot versioning and history\n- Integrity verification\n- Tenant isolation\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timezone",\nPolicy Snapshot Immutability Service (GAP-029).\n\nProvides immutable policy snapshot management with:\n- Immutability enforcement (no modifications after creation)\n- Snapshot versioning and history\n- Integrity verification\n- Tenant isolation\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
861,app/services/policy_graph_engine.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_graph_engine.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Policy conflict detection and dependency graph computation\n# Callers: policies.py, policy_layer.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-411 (Gap Closure), DFT-O4, DFT-O5\n\n""""""\nPolicy Graph Engine — Conflict Detection & Dependency Analysis\n\nThis module implements:","\nPolicy Graph Engine — Conflict Detection & Dependency Analysis\n\nThis module implements:\n- PolicyConflictEngine: Detects logical contradictions between policies (DFT-O4)\n- PolicyDependencyEngine: Computes structural relationships between policies (DFT-O5)\n\nThese engines answer STATIC governance questions, not runtime enforcement.\nThey must be deterministic, explainable, and replayable.\n\nReference: PIN-411 Gap Closure Spec (Part A)\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
862,app/services/policy_proposal.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/policy_proposal.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Callers: None (ORPHAN - pending M25+ integration)\n# Reference: PIN-240\n# NOTE: Service complete, UI integration missing. Human approval required.\n\n""""""\nPolicy Proposal Service (PB-S4)\n\nProposes policy changes based on observed feedback WITHOUT auto-enforcement.\n\nPB-S4 Contract:\n- Observe feedback patterns → propose policy → wait for human\n- NO auto-enforcement\n- NO execution modification",\nPolicy Proposal Service (PB-S4)\n\nProposes policy changes based on observed feedback WITHOUT auto-enforcement.\n\nPB-S4 Contract:\n- Observe feedback patterns → propose policy → wait for human\n- NO auto-enforcement\n- NO execution modification\n- Human approval is MANDATORY\n\nRule: Propose → Review → Decide (Human)\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
863,app/services/policy_violation_service.py,CUSTOMER,incidents,L4,app/houseofcards/customer/incidents/engines/policy_violation_service.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: S3 violation truth model, fact persistence, evidence linking\n# Callers: L4 policy engine, L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""\nPolicy Violation Service - S3 Hardening for Phase A.5 Verification\n\nThis service implements the S3 truth model from PIN-195:\n1. Violation detection\n2. Violation fact persistence\n3. Incident creation (severity-bound)\n4. Evidence linking\n5. API + Console exposure","\nPolicy Violation Service - S3 Hardening for Phase A.5 Verification\n\nThis service implements the S3 truth model from PIN-195:\n1. Violation detection\n2. Violation fact persistence\n3. Incident creation (severity-bound)\n4. Evidence linking\n5. API + Console exposure\n\nCritical invariants (VERIFICATION_MODE):\n- No incident may exist without a persisted violation fact\n- Policy must be enabled for tenant\n- Evidence must exist before incident creation\n- One incident per (run_id, policy_id)\n- Cost and pol",,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Violations),TRANSFER
864,app/services/pools/__init__.py,CUSTOMER,integrations,L5,app/houseofcards/customer/integrations/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Connection pool management for database and external services\n# Callers: ConnectorRegistry, Services, API routes\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-172 (Connection Pool Management)\n\n""""""\nConnection Pool Management (GAP-172)\n\nProvides unified connection pool management for:",\nConnection Pool Management (GAP-172)\n\nProvides unified connection pool management for:\n- Database connections (PostgreSQL via asyncpg)\n- Redis connections\n- HTTP client pools\n- External service connections\n\nFeatures:\n- Health checking\n- Connection limits per tenant\n- Graceful shutdown\n- Metrics collection\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
865,app/services/pools/pool_manager.py,CUSTOMER,platform,L5,app/houseofcards/customer/platform/engines/pool_manager.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Unified connection pool manager with health checking\n# Callers: Services, API routes\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-172 (Connection Pool Management)\n\n""""""\nConnection Pool Manager (GAP-172)\n\nManages connection pools for various services with:",\nConnection Pool Manager (GAP-172)\n\nManages connection pools for various services with:\n- Health checking\n- Per-tenant limits\n- Metrics\n- Graceful shutdown\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
866,app/services/prediction.py,CUSTOMER,analytics,L5,app/houseofcards/customer/analytics/engines/prediction.py,"# Layer: L3 — Boundary Adapter (Console → Platform)\n# Product: AI Console\n# Callers: predictions API (read-side)\n# Reference: PIN-240\n# NOTE: Advisory only. Predictions have zero side-effects.\n\n""""""\nPrediction Service (PB-S5)\n\nGenerates predictions WITHOUT affecting execution behavior.\n\nPB-S5 Contract:\n- Advise → Observe → Do Nothing\n- Predictions are advisory only\n- Predictions have zero side-effects","\nPrediction Service (PB-S5)\n\nGenerates predictions WITHOUT affecting execution behavior.\n\nPB-S5 Contract:\n- Advise → Observe → Do Nothing\n- Predictions are advisory only\n- Predictions have zero side-effects\n- Predictions never modify execution, scheduling, or history\n\nRule: Advise, don't influence.\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
867,app/services/recovery_evaluation_engine.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/recovery_evaluation_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Temporal:\n#   Trigger: worker (via failure events)\n#   Execution: async\n# Role: Recovery evaluation decision-making (domain logic)\n# Authority: Recovery decision generation (M9/M10 pattern)\n# Callers: API endpoints, failure processing pipeline\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: DECISION_RECORD_CONTRACT.md\n# Reference: PIN-257 Phase R-1 (L5→L4 Violation Fix)\n#\n# GOVERNANCE NOTE: This L4 engine owns all DECISION logic.\n# L5 recovery_evaluator.py owns only EXECUTION logic.","\nDomain engine for recovery evaluation decisions.\n\nThis L4 engine contains the authoritative decision logic for:\n1. Rule evaluation - evaluate_rules()\n2. Pattern matching - RecoveryMatcher\n3. Confidence combination - combine_confidences()\n4. Action selection threshold - should_select_action()\n5. Auto-execution threshold - should_auto_execute()\n6. Decision record emission - emit_recovery_decision()\n\nL5 workers must call this engine and execute the returned decisions,\nnot implement their own decis",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
868,app/services/recovery_matcher.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/recovery_matcher.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: recovery_evaluator.py (worker)\n# Reference: PIN-240\n# WARNING: If this logic is wrong, ALL products break.\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Escalates to LLM for recovery suggestions - external HTTP calls are non-deterministic\n# LLM responses cannot be safely retried without semantic duplication\nFEATURE_INTENT = FeatureIntent.EXTERNAL_SIDE_EFFECT\nRETRY_POLICY = RetryPolicy.NEVER\n\n# app/services/recovery_matcher.py",Result from matching a failure to a recovery suggestion.,,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
869,app/services/recovery_rule_engine.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/recovery_rule_engine.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide (NOT console-owned)\n# Callers: recovery_evaluator.py (worker)\n# Reference: PIN-240\n# WARNING: If this logic is wrong, ALL products break.\n\n# M10 Recovery Rule Engine\n""""""\nRule-based evaluation engine for recovery suggestions.\n\nEvaluates a set of rules against failure context and returns\nscored action recommendations.\n\nRules can be:\n1. Error code matching (exact or prefix)","\nRule-based evaluation engine for recovery suggestions.\n\nEvaluates a set of rules against failure context and returns\nscored action recommendations.\n\nRules can be:\n1. Error code matching (exact or prefix)\n2. Historical pattern matching\n3. Skill-specific rules\n4. Tenant-specific overrides\n5. Time-based rules (e.g., different behavior during incidents)\n\nEnvironment Variables:\n- RECOVERY_RULE_DEBUG: Enable debug logging for rule evaluation\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
870,app/services/recovery_write_service.py,CUSTOMER,policies,L6,app/houseofcards/customer/policies/drivers/recovery_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Recovery API)\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for Recovery APIs (Phase 2B extraction)\n# Callers: api/recovery_ingest.py, api/recovery.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 4\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# DB write operations with atomic UPSERT via ON CONFLICT DO UPDATE","Sync DB write operations for Recovery APIs.\n\nWrite-only facade. No policy logic, no branching beyond DB operations.\nRaw SQL preserved exactly as extracted from API files.",,NEEDS_CLASSIFICATION,ITERATION_1,Write service → Driver,TRANSFER
871,app/services/replay_determinism.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/replay_determinism.py,"""""""Replay Determinism Service - Defines and Enforces Determinism Semantics\n\nWatchpoint #2: Replay Determinism Across Model Versions\n\nThis service addresses the fundamental tension between:\n- ""Logical Determinism"": Same policy decision given same context\n- ""Byte-for-byte Determinism"": Exact same output bytes\n\nKey Insight: As upstream LLM models drift (model updates, temperature changes),\nwe cannot guarantee byte-for-byte determinism. However, we CAN guarantee:\n\n1. Policy decisions are deterministic (same rules -> same enforcement)\n2. Replay validates logical equivalence, not exact match\n3. Version tracking allows audit trail of what ran when\n","Replay Determinism Service - Defines and Enforces Determinism Semantics\n\nWatchpoint #2: Replay Determinism Across Model Versions\n\nThis service addresses the fundamental tension between:\n- ""Logical Determinism"": Same policy decision given same context\n- ""Byte-for-byte Determinism"": Exact same output bytes\n\nKey Insight: As upstream LLM models drift (model updates, temperature changes),\nwe cannot guarantee byte-for-byte determinism. However, we CAN guarantee:\n\n1. Policy decisions are deterministic ",,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
872,app/services/retrieval/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/retrieval_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Retrieval Facade - Centralized access to mediated data retrieval\n# Callers: L2 retrieval.py API, SDK\n# Allowed Imports: L4 retrieval mediator, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-094 (Mediated Data Retrieval API)\n\n""""""\nRetrieval Facade (L4 Domain Logic)\n\nThis facade provides the external interface for mediated data retrieval operations.",\nRetrieval Facade (L4 Domain Logic)\n\nThis facade provides the external interface for mediated data retrieval operations.\nAll retrieval APIs MUST use this facade instead of directly importing\nthe RetrievalMediator.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes retrieval mediation logic\n- Provides unified access to data retrieval with policy enforcement\n- Single point for audit emission\n\nWrapped Services:\n- RetrievalMediator: Central choke point for data access (GAP-065),,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
873,app/services/rok/__init__.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-051 (Phase-Status Invariants)\n""""""\nROK (Run Orchestration Kernel) Services (GAP-051)\n\nProvides services for ROK phase-status invariant enforcement\nusing GovernanceConfig flags.\n\nThis module provides:\n    - PhaseStatusInvariantChecker: Validates phase-status combinations\n    - PhaseStatusInvariantEnforcementError: Raised on violations\n    - PHASE_STATUS_INVARIANTS: Valid combinations map\n    - Helper functions for quick validation\n""""""",\nROK (Run Orchestration Kernel) Services (GAP-051)\n\nProvides services for ROK phase-status invariant enforcement\nusing GovernanceConfig flags.\n\nThis module provides:\n    - PhaseStatusInvariantChecker: Validates phase-status combinations\n    - PhaseStatusInvariantEnforcementError: Raised on violations\n    - PHASE_STATUS_INVARIANTS: Valid combinations map\n    - Helper functions for quick validation\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
874,app/services/rok/phase_status_invariants.py,CUSTOMER,policies,L5,app/houseofcards/customer/policies/engines/phase_status_invariants.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api/worker\n#   Execution: sync\n# Role: Phase-status invariant enforcement from GovernanceConfig\n# Callers: ROK (L5), worker runtime\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-051 (Phase-Status Invariants)\n\n""""""\nModule: phase_status_invariants\nPurpose: Enforce phase-status invariants using GovernanceConfig.\n","\nModule: phase_status_invariants\nPurpose: Enforce phase-status invariants using GovernanceConfig.\n\nThe phase_status_invariant_enforce flag in GovernanceConfig controls\nwhether invalid phase-status combinations are blocked.\n\nPhase-Status Invariants:\n    - CREATED, AUTHORIZED: status must be ""queued""\n    - EXECUTING, GOVERNANCE_CHECK, FINALIZING: status must be ""running""\n    - COMPLETED: status must be ""succeeded""\n    - FAILED: status must be ""failed"", ""failed_policy"", ""cancelled"", or ""retry""\n\nWhe",,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
875,app/services/sandbox/__init__.py,CUSTOMER,platform,L5,app/houseofcards/customer/platform/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Execution sandboxing for safe code execution\n# Callers: Runtime, Skill executors\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-174 (Execution Sandboxing)\n\n""""""\nExecution Sandboxing (GAP-174)\n\nProvides isolated execution environments for:","\nExecution Sandboxing (GAP-174)\n\nProvides isolated execution environments for:\n- Code execution with resource limits\n- Network isolation\n- File system sandboxing\n- Process isolation\n\nFeatures:\n- Container-based isolation (Docker/Podman)\n- Process-based isolation (subprocess with limits)\n- Resource limits (CPU, memory, time)\n- Network policies\n- File system restrictions\n",,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/services/platform/__init__.py,SKIP_INIT_COLLISION
876,app/services/sandbox/sandbox_executor.py,CUSTOMER,platform,L5,app/houseofcards/customer/platform/engines/sandbox_executor.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: Low-level sandbox execution with process isolation\n# Callers: SandboxService\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-174 (Execution Sandboxing)\n\n""""""\nSandbox Executor (GAP-174)\n\nProvides low-level execution isolation:",\nSandbox Executor (GAP-174)\n\nProvides low-level execution isolation:\n- Process-based execution with resource limits\n- Container-based execution (Docker/Podman)\n- Network namespace isolation\n- Filesystem sandboxing\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
877,app/services/sandbox/sandbox_service.py,CUSTOMER,policies,L4,app/houseofcards/customer/policies/engines/sandbox_service.py,"# Layer: L4 — Domain Engines\n# AUDIENCE: INTERNAL\n# PHASE: W2\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: High-level sandbox service with policy enforcement\n# Callers: Runtime, API routes, Skill executors\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-174 (Execution Sandboxing)\n\n""""""\nSandbox Service (GAP-174)",\nSandbox Service (GAP-174)\n\nHigh-level service for managing sandbox execution:\n- Policy-based isolation level selection\n- Execution quota management\n- Audit logging\n- Result caching\n,,NEEDS_CLASSIFICATION,ITERATION_1,L4 Domain Engine (Sandbox),TRANSFER
878,app/services/scheduler/__init__.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-052 (Jobs Scheduler), GAP-154, GAP-155, GAP-156, GAP-157, GAP-158\n""""""\nJobs Scheduler Services\n\nProvides job scheduling capabilities including:\n- Cron-like periodic scheduling (GAP-052)\n- One-time delayed execution\n- Job management and monitoring\n- Tenant-isolated job queues\n- APScheduler binding (GAP-154)\n- Job retry logic (GAP-156)\n- Job progress reporting (GAP-157)\n- Job audit evidence (GAP-158)",\nJobs Scheduler Services\n\nProvides job scheduling capabilities including:\n- Cron-like periodic scheduling (GAP-052)\n- One-time delayed execution\n- Job management and monitoring\n- Tenant-isolated job queues\n- APScheduler binding (GAP-154)\n- Job retry logic (GAP-156)\n- Job progress reporting (GAP-157)\n- Job audit evidence (GAP-158)\n\nThis module provides:\n    - JobScheduler: Main scheduling service\n    - ScheduledJob: Job definition model\n    - JobSchedule: Schedule configuration\n    - APSchedulerE,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
879,app/services/scheduler/executor.py,CUSTOMER,platform,L5,app/houseofcards/customer/platform/engines/executor.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: executor\n# Parent Gap: GAP-039 (JobScheduler)\n# Reference: GAP-154\n# Depends On: GAP-052 (JobScheduler service)\n# Temporal:\n#   Trigger: worker (startup)\n#   Execution: async\n# Role: Bind JobScheduler to APScheduler for actual execution\n# Callers: Worker startup, application lifecycle\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""",\nModule: executor\nPurpose: Bind JobScheduler to APScheduler for actual execution.\n\nWires:\n    - Source: app/services/scheduler/job_scheduler.py\n    - Target: APScheduler library\n\nExecution Modes:\n    - Cron: Periodic execution via APScheduler cron trigger\n    - One-time: Delayed execution via APScheduler date trigger\n    - Interval: Fixed interval execution\n    - Immediate: Direct execution (no scheduling)\n\nAcceptance Criteria:\n    - AC-154-01: Jobs are scheduled via APScheduler\n    - AC-154-02:,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
880,app/services/scheduler/facade.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/scheduler_facade.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api or worker (scheduled execution)\n#   Execution: async\n# Role: Scheduler Facade - Centralized access to job scheduling operations\n# Callers: L2 scheduler.py API, SDK, Worker\n# Allowed Imports: L4 scheduler services, L6 (models, db)\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-112 (Scheduled Job API)\n\n""""""\nScheduler Facade (L4 Domain Logic)\n\nThis facade provides the external interface for scheduled job operations.",\nScheduler Facade (L4 Domain Logic)\n\nThis facade provides the external interface for scheduled job operations.\nAll scheduler APIs MUST use this facade instead of directly importing\ninternal scheduler modules.\n\nWhy This Facade Exists:\n- Prevents L2→L4 layer violations\n- Centralizes job scheduling logic\n- Provides unified access to job management\n- Single point for audit emission\n\nL2 API Routes (GAP-112):\n- POST /api/v1/scheduler/jobs (create job)\n- GET /api/v1/scheduler/jobs (list jobs)\n- GET /ap,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
881,app/services/scheduler/job_execution.py,CUSTOMER,logs,L5,app/houseofcards/customer/logs/engines/job_execution.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Wiring Type: service\n# Parent Gap: GAP-039 (JobScheduler)\n# Reference: GAP-156 (Retry), GAP-157 (Progress), GAP-158 (Audit)\n# Temporal:\n#   Trigger: worker (job execution)\n#   Execution: async\n# Role: Job execution support services (retry, progress, audit)\n# Callers: JobQueueWorker, APSchedulerExecutor\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n\n""""""\nModule: job_execution",\nModule: job_execution\nPurpose: Job execution support services.\n\nProvides:\n    - GAP-156: Retry logic with exponential backoff\n    - GAP-157: Progress reporting and tracking\n    - GAP-158: Audit evidence emission\n\nAcceptance Criteria:\n    - AC-156-01: Exponential backoff with jitter\n    - AC-156-02: Max retries respected\n    - AC-156-03: Retry history recorded\n    - AC-157-01: Progress percentage tracked\n    - AC-157-02: Progress events emitted\n    - AC-157-03: ETA calculation\n    - AC-158-01: J,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
882,app/services/scheduler/job_scheduler.py,CUSTOMER,platform,L5,app/houseofcards/customer/platform/engines/job_scheduler.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-052 (Jobs Scheduler)\n""""""\nJobScheduler - Job scheduling and management service.\n\nProvides scheduling capabilities for:\n- Cron-like periodic jobs\n- One-time delayed execution\n- Interval-based recurring jobs\n- Job lifecycle management\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timedelta, timezone",\nJobScheduler - Job scheduling and management service.\n\nProvides scheduling capabilities for:\n- Cron-like periodic jobs\n- One-time delayed execution\n- Interval-based recurring jobs\n- Job lifecycle management\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
883,app/services/scoped_execution.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/scoped_execution.py,"# Layer: L4 — Domain Engine (System Truth)\n# Product: system-wide\n# Role: Pre-execution gate, scope enforcement\n# Callers: L2 APIs (recovery actions), L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n# app/services/scoped_execution.py\n""""""\nM6: Scoped Execution Context Service (P2FC-4)\n\nPre-execution gate for MEDIUM+ risk recovery actions.\n\nCORE INVARIANT (M6):\n> ""No recovery action may execute without an explicit, bounded execution\n>  scope derived from incident context.""","\nM6: Scoped Execution Context Service (P2FC-4)\n\nPre-execution gate for MEDIUM+ risk recovery actions.\n\nCORE INVARIANT (M6):\n> ""No recovery action may execute without an explicit, bounded execution\n>  scope derived from incident context.""\n\nThe Scoped Execution primitive provides:\n1. Scope creation with incident binding, cost ceiling, action limits, expiry\n2. Scope-gated execution (no execution without valid scope)\n3. Scope exhaustion tracking (single-use by default)\n4. Scope tampering detection (",,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service,TRANSFER
884,app/services/soc2/__init__.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/__init__.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Reference: GAP-025 (SOC2 Control Mapping)\n""""""\nSOC2 Control Mapping Service (GAP-025)\n\nProvides complete SOC2 Trust Service Criteria mapping for\nincident response, evidence export, and compliance reporting.\n\nThis module provides:\n    - SOC2ControlRegistry: Registry of all SOC2 controls\n    - SOC2ControlMapper: Maps incidents to relevant controls\n    - SOC2ComplianceStatus: Enum for compliance states\n    - get_control_mappings_for_incident: Main entry point\n""""""","\nSOC2 Control Mapping Service (GAP-025)\n\nProvides complete SOC2 Trust Service Criteria mapping for\nincident response, evidence export, and compliance reporting.\n\nThis module provides:\n    - SOC2ControlRegistry: Registry of all SOC2 controls\n    - SOC2ControlMapper: Maps incidents to relevant controls\n    - SOC2ComplianceStatus: Enum for compliance states\n    - get_control_mappings_for_incident: Main entry point\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
885,app/services/soc2/control_registry.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/control_registry.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: SOC2 Trust Service Criteria control registry\n# Callers: services/soc2/mapper.py, services/export_bundle_service.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-025 (SOC2 Control Mapping)\n\n""""""\nModule: control_registry\nPurpose: Registry of SOC2 Trust Service Criteria controls.\n",\nModule: control_registry\nPurpose: Registry of SOC2 Trust Service Criteria controls.\n\nSOC2 Trust Service Categories:\n    - CC (Common Criteria): Security-related controls\n    - A (Availability): System availability controls\n    - PI (Processing Integrity): Processing accuracy controls\n    - C (Confidentiality): Data confidentiality controls\n    - P (Privacy): Privacy-related controls\n\nKey Controls for AI Agent Governance:\n    - CC7.x: System Operations (Incident Response)\n    - CC6.x: Logical an,,NEEDS_CLASSIFICATION,ITERATION_1,Service module; Domain uncertain,TRANSFER
886,app/services/soc2/mapper.py,CUSTOMER,incidents,L5,app/houseofcards/customer/incidents/engines/mapper.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Map incidents to relevant SOC2 controls\n# Callers: services/export_bundle_service.py, api/incidents.py\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-025 (SOC2 Control Mapping)\n\n""""""\nModule: mapper\nPurpose: Map incidents and evidence to SOC2 controls.\n",\nModule: mapper\nPurpose: Map incidents and evidence to SOC2 controls.\n\nProvides intelligent mapping of incident categories and evidence\nto the appropriate SOC2 Trust Service Criteria controls.\n\nExports:\n    - SOC2ControlMapper: Maps incidents to controls\n    - get_control_mappings_for_incident: Main entry point\n,,NEEDS_CLASSIFICATION,ITERATION_1,Service module,TRANSFER
887,app/services/tenant_service.py,CUSTOMER,account,L6,app/houseofcards/customer/account/drivers/tenant_service.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Role: Tenant CRUD, API key management, quota enforcement\n# Callers: L2 APIs, L4 engines, L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""\nTenant Service (M21)\n\nProvides:\n- Tenant CRUD operations\n- API key management (create, revoke, list)\n- Quota enforcement (runs per day, tokens per month)\n- Usage tracking and metering\n- Plan management","\nTenant Service (M21)\n\nProvides:\n- Tenant CRUD operations\n- API key management (create, revoke, list)\n- Quota enforcement (runs per day, tokens per month)\n- Usage tracking and metering\n- Plan management\n",,NEEDS_CLASSIFICATION,ITERATION_1,L6 Platform Substrate (Tenant),TRANSFER
888,app/services/user_write_service.py,CUSTOMER,account,L6,app/houseofcards/customer/account/drivers/user_write_service.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: DB write delegation for User management (Phase 2B extraction)\n# Callers: api/onboarding.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 1\n\n""""""\nUser Write Service - DB write operations for User management.\n\nPhase 2B Batch 1: Extracted from api/onboarding.py.",\nUser Write Service - DB write operations for User management.\n\nPhase 2B Batch 1: Extracted from api/onboarding.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n,,NEEDS_CLASSIFICATION,ITERATION_1,Write service → Driver,TRANSFER
889,app/services/worker_registry_service.py,CUSTOMER,account,L6,app/houseofcards/customer/account/drivers/worker_registry_service.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Role: Worker discovery, status queries, capability registry\n# Callers: L2 APIs, L5 workers\n# Reference: PIN-242 (Baseline Freeze)\n\n""""""\nWorker Registry Service (M21)\n\nProvides:\n- Dynamic worker discovery from database\n- Worker status and capability queries\n- Per-tenant worker configuration\n- Worker availability checks\n""""""",\nWorker Registry Service (M21)\n\nProvides:\n- Dynamic worker discovery from database\n- Worker status and capability queries\n- Per-tenant worker configuration\n- Worker availability checks\n,,NEEDS_CLASSIFICATION,ITERATION_1,L6 Platform Substrate (Registry),TRANSFER
890,app/services/worker_write_service_async.py,CUSTOMER,general,L5,app/houseofcards/customer/general/engines/worker_write_service_async.py,"# Layer: L4 — Domain Engine\n# Product: system-wide (Worker API)\n# Temporal:\n#   Trigger: api\n#   Execution: async\n# Role: DB write delegation for Worker API (Phase 2B extraction)\n# Callers: api/workers.py\n# Allowed Imports: L6 (models, db)\n# Forbidden Imports: L2 (api), L3 (adapters)\n# Reference: PIN-250 Phase 2B Batch 4\n\n""""""\nWorker Write Service (Async) - DB write operations for Worker API.\n\nPhase 2B Batch 4: Extracted from api/workers.py.",\nWorker Write Service (Async) - DB write operations for Worker API.\n\nPhase 2B Batch 4: Extracted from api/workers.py.\n\nConstraints (enforced by PIN-250):\n- Write-only: No policy logic\n- No cross-service calls\n- No domain refactoring\n- Call-path relocation only\n- Preserve async semantics exactly\n,,NEEDS_CLASSIFICATION,ITERATION_1,Top-level service; Domain uncertain,TRANSFER
891,app/skill_http.py,INTERNAL,general,L5,app/houseofcards/internal/general/engines/skill_http.py,"# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: HTTP skill execution adapter\n# Callers: skill runtime\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Skill System\n\nimport asyncio\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict\n",,,NEEDS_CLASSIFICATION,ITERATION_1,HTTP skill; Domain uncertain,TRANSFER
892,app/skills/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# NOVA Skills Package\n# Pluggable skill adapters for agent execution\n#\n# IMPORT HYGIENE: This module uses lazy imports to avoid pulling heavy\n# dependencies (httpx, anthropic, etc.) when only metadata is needed.\n# Skills are loaded on-demand via load_skill() or load_all_skills().\n#\n# GAP-066: Skill Registry Filter Integration\n# In governed environments, ungoverned skills are filtered from the registry\n# to prevent unsafe operations (raw SQL, raw HTTP, shell execution, etc.)\n\nfrom typing import TYPE_CHECKING, Optional\nimport logging\n\n_logger = logging.getLogger(""nova.skills"")","Lazy-load a skill class by name.\n\nArgs:\n    name: Skill class name (e.g., ""HttpCallSkill"")\n\nReturns:\n    The skill class\n\nRaises:\n    ImportError: If skill not found",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
893,app/skills/adapters/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# adapters/__init__.py\n""""""\nLLM Adapters Package (M11)\n\nProvides adapter implementations for different LLM providers with\nenvironment-based factory selection.\n\nAvailable Adapters:\n- ClaudeAdapter: Anthropic Claude API (default)\n- OpenAIAdapter: OpenAI API (cost-effective fallback)\n- StubAdapter: Deterministic testing\n\nSTRICT MODE (ENV=prod or ENV=production):\n- Raises AdapterConfigurationError instead of falling back to stub\n- Ensures production deployments never silently degrade",\nLLM Adapters Package (M11)\n\nProvides adapter implementations for different LLM providers with\nenvironment-based factory selection.\n\nAvailable Adapters:\n- ClaudeAdapter: Anthropic Claude API (default)\n- OpenAIAdapter: OpenAI API (cost-effective fallback)\n- StubAdapter: Deterministic testing\n\nSTRICT MODE (ENV=prod or ENV=production):\n- Raises AdapterConfigurationError instead of falling back to stub\n- Ensures production deployments never silently degrade\n\nEnvironment Variables:\n- ENV: environment,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
894,app/skills/adapters/claude_adapter.py,INTERNAL,agent,L3,app/houseofcards/internal/agent/facades/claude_adapter.py,"# adapters/claude_adapter.py\n""""""\nClaude Adapter for LLM Invoke Skill (M3)\n\nImplements LLMAdapter interface for Anthropic Claude API.\nSupports:\n- Deterministic fallback (temperature=0, seed hashing)\n- Error mapping to contract errors\n- Cost tracking\n- Rate limit handling\n\nSee: app/skills/llm_invoke_v2.py for adapter interface\nSee: app/skills/contracts/llm_invoke.contract.yaml for contract\n""""""\n","\nClaude Adapter for LLM Invoke Skill (M3)\n\nImplements LLMAdapter interface for Anthropic Claude API.\nSupports:\n- Deterministic fallback (temperature=0, seed hashing)\n- Error mapping to contract errors\n- Cost tracking\n- Rate limit handling\n\nSee: app/skills/llm_invoke_v2.py for adapter interface\nSee: app/skills/contracts/llm_invoke.contract.yaml for contract\n",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
895,app/skills/adapters/metrics.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/metrics.py,"# LLM Adapter Metrics (M11)\n""""""\nToken metering decorator and helpers for LLM adapter instrumentation.\n\nProvides:\n- @track_llm_usage decorator for automatic metrics collection\n- track_llm_response() helper for manual tracking\n- Cost estimation utilities\n\nUsage:\n    from app.skills.adapters.metrics import track_llm_usage, track_llm_response\n\n    # Decorator usage:\n    @track_llm_usage\n    async def invoke(self, prompt, config):","\nToken metering decorator and helpers for LLM adapter instrumentation.\n\nProvides:\n- @track_llm_usage decorator for automatic metrics collection\n- track_llm_response() helper for manual tracking\n- Cost estimation utilities\n\nUsage:\n    from app.skills.adapters.metrics import track_llm_usage, track_llm_response\n\n    # Decorator usage:\n    @track_llm_usage\n    async def invoke(self, prompt, config):\n        ...\n\n    # Manual tracking:\n    response = await adapter.invoke(prompt, config)\n    track_llm",,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
896,app/skills/adapters/openai_adapter.py,INTERNAL,agent,L3,app/houseofcards/internal/agent/facades/openai_adapter.py,"# adapters/openai_adapter.py\n# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: async\n# Role: OpenAI API translation adapter\n# Callers: llm_invoke_v2 skill\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-254 Phase B Fix\n""""""\nOpenAI Adapter for LLM Invoke Skill (M11)\n\nImplements LLMAdapter interface for OpenAI API.","\nOpenAI Adapter for LLM Invoke Skill (M11)\n\nImplements LLMAdapter interface for OpenAI API.\nSupports:\n- GPT-4o and GPT-4o-mini (cost-effective fallback to Claude)\n- Native seeding support for determinism\n- Error mapping to contract errors\n- Cost tracking\n\nB01 FIX: Safety limits moved to L4 LLMPolicyEngine.\nThis adapter now delegates policy decisions to L4.\nL3 is translation-only: shape, transport, protocol binding.\n\nSee: app/skills/llm_invoke_v2.py for adapter interface\nSee: app/services/llm_pol",,NEEDS_CLASSIFICATION,ITERATION_1,L3 Adapter,TRANSFER
897,app/skills/adapters/tenant_config.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/tenant_config.py,"# Per-Tenant LLM Configuration (M11)\n# Layer: L3 — Boundary Adapter\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: async\n# Role: Tenant LLM configuration adapter\n# Callers: llm_invoke skills\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: PIN-254 Phase B Fix\n""""""\nPer-tenant LLM model configuration for cost optimization and rate limiting.\n\nB05 FIX: Model selection policy moved to L4 LLMPolicyEngine.","\nPer-tenant LLM model configuration for cost optimization and rate limiting.\n\nB05 FIX: Model selection policy moved to L4 LLMPolicyEngine.\nThis adapter provides tenant configuration data but delegates\npolicy decisions to L4.\n\nAllows tenants to:\n- Override default model (e.g., use gpt-4o-mini instead of Claude)\n- Set per-tenant rate limits\n- Set per-tenant budget limits\n- Configure model preferences\n\nConfiguration can come from:\n1. Environment variables (TENANT_{ID}_LLM_MODEL, etc.)\n2. Vault secr",,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
898,app/skills/base.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/skills_base.py,"# Skill Base Classes for M11\n# Provides common patterns for idempotent, deterministic skills\n\nimport logging\nimport os\nimport time\nfrom abc import ABC, abstractmethod\nfrom datetime import datetime, timedelta, timezone\nfrom typing import Any, Dict, Optional, Type\n\nfrom pydantic import BaseModel\nfrom sqlalchemy import create_engine, text\nfrom sqlalchemy.orm import sessionmaker\n\nfrom ..metrics import (","Lightweight circuit breaker for M11 external skills.\n\nUses m11_audit.circuit_breaker_state table for persistent state.\n\nStates:\n- CLOSED: Normal operation, requests pass through\n- OPEN: Too many failures, requests fast-fail\n- HALF_OPEN: Testing if service recovered\n\nUsage:\n    breaker = SkillCircuitBreaker(""slack_api"")\n\n    if await breaker.is_open():\n        return {""error"": ""circuit_open"", ""retry_after"": breaker.cooldown_until}\n\n    try:\n        result = await call_slack_api()\n        await br",,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
899,app/skills/calendar_write.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/calendar_write.py,"# Calendar Write Skill\n# Mock calendar skill for creating calendar events\n\nimport logging\nimport time\nimport uuid\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, Optional\n\nfrom .registry import register_skill\n\nlogger = logging.getLogger(""nova.skills.calendar_write"")\n\n\nclass CalendarWriteSkill:","Calendar write skill for creating calendar events.\n\nThis is a mock implementation that returns metadata and side effects.\nProduction implementation would integrate with Google Calendar, Outlook, etc.",,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
900,app/skills/email_send.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/email_send.py,"# Email Send Skill (Resend)\n# Pluggable email skill using Resend API with external call control\n\nimport logging\nimport os\nimport time\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, Optional, Type\n\nimport httpx\nfrom pydantic import BaseModel\n\nfrom ..schemas.skill import EmailSendInput, EmailSendOutput\nfrom .registry import skill\n",Configuration schema for email_send skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
901,app/skills/executor.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/executor.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (via runner.py)\n#   Execution: async\n# Role: Skill execution with validation and evidence capture\n# Authority: Skill invocation, validation, evidence capture (NO step advancement)\n# Callers: runner.py (passes cursor.context)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: Evidence Architecture v1.1\n\n""""""\nSkill Executor - Validation wrapper for skill execution at the runner boundary.\n",\nSkill Executor - Validation wrapper for skill execution at the runner boundary.\n\nEvidence Architecture v1.1:\n- Receives ExecutionContext from runner (via cursor.context)\n- Context is READ-ONLY - executor cannot advance steps\n- Captures Activity (B) and Provider (G) evidence using context\n- Step advancement is runner's responsibility via ExecutionCursor\n,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
902,app/skills/http_call.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/http_call.py,"# HTTP Call Skill\n# Pluggable HTTP skill with retry logic and external call control\n\nimport asyncio\nimport logging\nimport time\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, Type\n\nimport httpx\nfrom pydantic import BaseModel\n\nfrom ..schemas.skill import HttpCallInput, HttpCallOutput\nfrom .registry import skill\n",Configuration schema for http_call skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
903,app/skills/http_call_v2.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/http_call_v2.py,"# http_call_v2.py\n""""""\nHTTP Call Skill v2 (M3)\n\nDeterministic, contract-compliant HTTP skill with:\n- Error contract enforcement (error_contract.md)\n- Idempotency key requirement for mutating operations\n- Deterministic retry with seeded backoff\n- Response canonicalization for replay\n\nSee: app/skills/contracts/http_call.contract.yaml\nSee: app/specs/error_contract.md\n""""""\n\nimport hashlib","\nHTTP Call Skill v2 (M3)\n\nDeterministic, contract-compliant HTTP skill with:\n- Error contract enforcement (error_contract.md)\n- Idempotency key requirement for mutating operations\n- Deterministic retry with seeded backoff\n- Response canonicalization for replay\n\nSee: app/skills/contracts/http_call.contract.yaml\nSee: app/specs/error_contract.md\n",,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
904,app/skills/json_transform.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/json_transform.py,"# JSON Transform Skill\n# Safe, deterministic JSON transformation using dot-path mapping\n\nimport logging\nfrom typing import Any, Dict, List, Optional\n\nfrom pydantic import BaseModel, Field\n\nfrom .registry import skill\n\nlogger = logging.getLogger(""nova.skills.json_transform"")\n\n\nclass TransformMapping(BaseModel):\n    """"""A single transformation mapping.""""""",A single transformation mapping.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
905,app/skills/json_transform_v2.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/json_transform_v2.py,"# json_transform_v2.py\n""""""\nJSON Transform Skill v2 (M3)\n\nDeterministic, contract-compliant JSON transformation skill.\nReturns StructuredOutcome for all operations.\nProduces canonical JSON for replay compatibility.\n\nSee: app/skills/contracts/json_transform.contract.yaml\n""""""\n\nimport hashlib\nimport json\nimport logging\nimport re","\nJSON Transform Skill v2 (M3)\n\nDeterministic, contract-compliant JSON transformation skill.\nReturns StructuredOutcome for all operations.\nProduces canonical JSON for replay compatibility.\n\nSee: app/skills/contracts/json_transform.contract.yaml\n",,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
906,app/skills/kv_store.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/kv_store.py,"# KV Store Skill (M11)\n# Redis-backed key-value operations with idempotency support\n\nimport json\nimport logging\nimport os\nimport time\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, Optional, Type\n\nimport redis.asyncio as redis\nfrom pydantic import BaseModel\n\nfrom ..schemas.skill import KVStoreInput, KVStoreOutput\nfrom .registry import skill",Configuration schema for kv_store skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
907,app/skills/llm_invoke.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/llm_invoke.py,"# LLM Invoke Skill\n# Provides LLM inference as a skill step for agent plans\n# Includes prompt caching for cost reduction (M13+)\n\nimport hashlib\nimport json\nimport logging\nimport os\nimport threading\nimport time\nfrom dataclasses import dataclass\nfrom datetime import datetime, timedelta, timezone\nfrom typing import Any, Dict, Optional\n\nfrom ..metrics import (",A cached LLM response with metadata.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
908,app/skills/llm_invoke_v2.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/llm_invoke_v2.py,"# llm_invoke_v2.py\n""""""\nLLM Invoke Skill v2 (M3)\n\nInvokes language models with:\n- Adapter pattern for multiple providers\n- Deterministic seeding support (when model supports it)\n- Error contract enforcement\n- Cost tracking and token counting\n\nSee: app/skills/contracts/llm_invoke.contract.yaml\nSee: app/specs/error_contract.md\n""""""\n\nimport hashlib",\nLLM Invoke Skill v2 (M3)\n\nInvokes language models with:\n- Adapter pattern for multiple providers\n- Deterministic seeding support (when model supports it)\n- Error contract enforcement\n- Cost tracking and token counting\n\nSee: app/skills/contracts/llm_invoke.contract.yaml\nSee: app/specs/error_contract.md\n,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
909,app/skills/postgres_query.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/postgres_query.py,"# PostgreSQL Query Skill\n# Safe, parameterized SQL queries with read-only by default\n\nimport logging\nimport os\nimport re\nfrom typing import Any, Dict, List, Optional\n\nfrom pydantic import BaseModel, Field, field_validator\n\nfrom .registry import skill\n\nlogger = logging.getLogger(""nova.skills.postgres_query"")\n\n# Configuration",Input schema for postgres_query skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
910,app/skills/registry.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/registry.py,"# Skills Registry\n# Central registry for pluggable skill adapters with decorator-based registration\n\nimport logging\nfrom typing import (\n    Any,\n    Callable,\n    Dict,\n    List,\n    Optional,\n    Protocol,\n    Type,\n    TypeVar,\n    runtime_checkable,\n)",Protocol defining the skill interface.\n\nAll skills must implement this interface.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
911,app/skills/registry_v2.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/registry_v2.py,"# skills/registry_v2.py\n""""""\nSkill Registry v2 (M2)\n\nEnhanced registry that integrates with M1 runtime interfaces:\n- SkillDescriptor from runtime/core.py\n- Versioned skill resolution\n- Async handler registration\n- Persistence layer support (sqlite for dev, Postgres adapter for prod)\n\nThis registry maintains backwards compatibility with registry.py while\nproviding the new machine-native interfaces.\n""""""\n\nfrom __future__ import annotations","\nSkill Registry v2 (M2)\n\nEnhanced registry that integrates with M1 runtime interfaces:\n- SkillDescriptor from runtime/core.py\n- Versioned skill resolution\n- Async handler registration\n- Persistence layer support (sqlite for dev, Postgres adapter for prod)\n\nThis registry maintains backwards compatibility with registry.py while\nproviding the new machine-native interfaces.\n",,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
912,app/skills/sdsr_fail_trigger.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/sdsr_fail_trigger.py,"# Layer: L8 — Catalyst / Meta\n# Product: system-wide (SDSR testing infrastructure)\n# Temporal:\n#   Trigger: worker (skill execution)\n#   Execution: sync\n# Role: SDSR failure trigger skill for controlled test failures\n# Callers: Worker runtime (via plan execution)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-370 (Scenario-Driven System Realization), SDSR-E2E-003\n\n""""""\nSDSR Failure Trigger Skill\n\nPURPOSE:","\nSDSR Failure Trigger Skill\n\nPURPOSE:\n    This skill enables SDSR scenarios to trigger controlled failures\n    that the worker will recognize and process correctly.\n\n    Instead of using non-existent fake skills, this skill:\n    - Is registered in the real skill registry\n    - Raises exceptions that map to specific failure codes\n    - Enables IncidentEngine to receive the correct error_code\n\nUSAGE:\n    Plan step:\n    {\n        ""skill"": ""__sdsr_fail_trigger__"",\n        ""params"": {\n            ""er",,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
913,app/skills/skill_registry_filter.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/skill_registry_filter.py,"# Layer: L4 — Domain Engines\n# Product: system-wide\n# Temporal:\n#   Trigger: startup (registry initialization)\n#   Execution: sync\n# Role: Filter skill registry based on governance profile\n# Callers: skills/__init__.py, skill execution\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: GAP-066\n\n""""""\nModule: skill_registry_filter\nPurpose: Filter skill registry based on governance profile.\n","\nModule: skill_registry_filter\nPurpose: Filter skill registry based on governance profile.\n\nUngoverned skills (e.g., raw LLM invocation, raw HTTP, raw SQL) are\nremoved from the registry in governed environments.\n\nImports (Dependencies):\n    - None (standalone, governance profile passed as parameter)\n\nExports (Provides):\n    - filter_skills_for_governance(registry, profile) -> FilteredRegistry\n    - validate_skill_governance(skill_name) -> bool\n    - UNGOVERNED_SKILLS: Set of skills to exclude in",,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
914,app/skills/slack_send.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/slack_send.py,"# Slack Send Skill (M11)\n# Send messages to Slack via webhook with idempotency support\n\nimport logging\nimport os\nimport time\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, Optional, Type\n\nimport httpx\nfrom pydantic import BaseModel\n\nfrom ..schemas.skill import SlackSendInput, SlackSendOutput\nfrom .registry import skill\n",Configuration schema for slack_send skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
915,app/skills/stubs/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# skills/stubs/__init__.py\n""""""\nSkill Stubs (M2)\n\nDeterministic stub implementations for testing:\n- http_call_stub: Mock HTTP responses\n- llm_invoke_stub: Deterministic LLM responses\n- json_transform_stub: Deterministic JSON transformations\n\nThese stubs conform to SkillDescriptor from runtime/core.py\nand produce deterministic outputs for replay tests.\n""""""\n\nfrom .http_call_stub import HTTP_CALL_STUB_DESCRIPTOR, HttpCallStub, http_call_stub_handler\nfrom .json_transform_stub import JSON_TRANSFORM_STUB_DESCRIPTOR, JsonTransformStub, json_transform_stub_handler",\nSkill Stubs (M2)\n\nDeterministic stub implementations for testing:\n- http_call_stub: Mock HTTP responses\n- llm_invoke_stub: Deterministic LLM responses\n- json_transform_stub: Deterministic JSON transformations\n\nThese stubs conform to SkillDescriptor from runtime/core.py\nand produce deterministic outputs for replay tests.\n,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
916,app/skills/stubs/http_call_stub.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/http_call_stub.py,"# skills/stubs/http_call_stub.py\n""""""\nHTTP Call Stub (M2)\n\nDeterministic stub for http_call skill for testing.\nReturns configurable mock responses based on URL patterns.\n\nFeatures:\n- Deterministic behavior (seeded randomness only if explicit)\n- Configurable timeout & mock responses\n- Side-effect logging\n- Conforms to SkillDescriptor from runtime/core.py\n""""""\n\nfrom __future__ import annotations",\nHTTP Call Stub (M2)\n\nDeterministic stub for http_call skill for testing.\nReturns configurable mock responses based on URL patterns.\n\nFeatures:\n- Deterministic behavior (seeded randomness only if explicit)\n- Configurable timeout & mock responses\n- Side-effect logging\n- Conforms to SkillDescriptor from runtime/core.py\n,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
917,app/skills/stubs/json_transform_stub.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/json_transform_stub.py,"# skills/stubs/json_transform_stub.py\n""""""\nJSON Transform Stub (M2)\n\nDeterministic stub for json_transform skill for testing.\nApplies deterministic JSON transformations.\n\nFeatures:\n- Deterministic transforms\n- JSON Schema validation\n- JSONPath extraction\n- Conforms to SkillDescriptor from runtime/core.py\n""""""\n\nfrom __future__ import annotations",\nJSON Transform Stub (M2)\n\nDeterministic stub for json_transform skill for testing.\nApplies deterministic JSON transformations.\n\nFeatures:\n- Deterministic transforms\n- JSON Schema validation\n- JSONPath extraction\n- Conforms to SkillDescriptor from runtime/core.py\n,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
918,app/skills/stubs/llm_invoke_stub.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/llm_invoke_stub.py,"# skills/stubs/llm_invoke_stub.py\n""""""\nLLM Invoke Stub (M2)\n\nDeterministic stub for llm_invoke skill for testing.\nReturns seeded deterministic responses based on prompt hash.\n\nFeatures:\n- Deterministic token-level structure for replay tests\n- Configurable responses based on prompt patterns\n- Token cost estimation\n- Conforms to SkillDescriptor from runtime/core.py\n""""""\n\nfrom __future__ import annotations",\nLLM Invoke Stub (M2)\n\nDeterministic stub for llm_invoke skill for testing.\nReturns seeded deterministic responses based on prompt hash.\n\nFeatures:\n- Deterministic token-level structure for replay tests\n- Configurable responses based on prompt patterns\n- Token cost estimation\n- Conforms to SkillDescriptor from runtime/core.py\n,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
919,app/skills/voyage_embed.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/voyage_embed.py,"# Voyage Embed Skill (M11)\n# Generate embeddings using Voyage AI API\n\nimport logging\nimport os\nimport time\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, Optional, Type\n\nimport httpx\nfrom pydantic import BaseModel\n\nfrom ..schemas.skill import VoyageEmbedInput, VoyageEmbedOutput\nfrom .registry import skill\n",Configuration schema for voyage_embed skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
920,app/skills/webhook_send.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/webhook_send.py,"# Webhook Send Skill (M11)\n# Generic webhook with HMAC-SHA256 signing\n\nimport hashlib\nimport hmac\nimport json\nimport logging\nimport os\nimport time\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, Optional, Type\n\nimport httpx\nfrom pydantic import BaseModel\n",Configuration schema for webhook_send skill.,,NEEDS_CLASSIFICATION,ITERATION_1,Skills,TRANSFER
921,app/startup/__init__.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/__init__.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Role: Startup validation and boot guards\n\n""""""\nStartup Package\n\nContains boot-time validation and guards:\n- boot_guard: SPINE component validation (GAP-067)\n""""""\n\nfrom app.startup.boot_guard import (\n    validate_spine_components,\n    SpineValidationError,\n    get_boot_status,",\nStartup Package\n\nContains boot-time validation and guards:\n- boot_guard: SPINE component validation (GAP-067)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/secrets/__init__.py,SKIP_INIT_COLLISION
922,app/startup/boot_guard.py,INTERNAL,policies,L6,app/houseofcards/internal/policies/drivers/boot_guard.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: startup\n#   Execution: sync (blocking)\n# Role: Enforce boot-fail policy for SPINE components\n# Callers: main.py lifespan\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-067\n\n""""""\nModule: boot_guard\nPurpose: Validates all SPINE components at startup, blocks server if any fail.\n","\nModule: boot_guard\nPurpose: Validates all SPINE components at startup, blocks server if any fail.\n\nImports (Dependencies):\n    - app.events.reactor_initializer: get_reactor_status\n    - app.services.governance.profile: get_governance_config, validate_governance_config\n\nExports (Provides):\n    - validate_spine_components(): SpineValidationResult\n    - SpineValidationError: Exception for boot failures\n    - get_boot_status(): BootStatus\n\nWiring Points:\n    - Called from: main.py:lifespan_startup(",,NEEDS_CLASSIFICATION,ITERATION_1,Startup,TRANSFER
923,app/storage/__init__.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/__init__.py,# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Storage layer package marker\n# Callers: Storage imports\n# Allowed Imports: None\n# Forbidden Imports: None\n# Reference: Package Structure\n\n# NOVA Storage Module\n# Provides artifact storage backends for run outputs\n\nfrom .artifact import (,,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/secrets/__init__.py,SKIP_INIT_COLLISION
924,app/storage/artifact.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/artifact.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Artifact storage (R2/S3)\n# Callers: services, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Storage System\n\n# Artifact Storage\n# Provides storage backends for run artifacts (files, blobs, etc.)\n\nimport hashlib",Metadata for a stored artifact.,,NEEDS_CLASSIFICATION,ITERATION_1,Storage; Domain uncertain,TRANSFER
925,app/stores/__init__.py,INTERNAL,logs,L6,app/houseofcards/internal/logs/drivers/__init__.py,"# Store Factory Functions (M11)\n""""""\nUnified factory functions for pluggable storage backends.\n\nProvides environment-based switching between:\n- In-memory stores (testing, single-worker)\n- Redis stores (Upstash, multi-worker budget/idempotency)\n- PostgreSQL stores (Neon, checkpoints/traces)\n- R2 offload (Cloudflare R2, checkpoint archival)\n\nAll credentials are expected to be injected via environment variables\n(populated from Vault: secret/data/user/<service>).\n\nSTRICT MODE (ENV=prod or ENV=production):\n- Raises ConfigurationError instead of falling back to memory stores","\nUnified factory functions for pluggable storage backends.\n\nProvides environment-based switching between:\n- In-memory stores (testing, single-worker)\n- Redis stores (Upstash, multi-worker budget/idempotency)\n- PostgreSQL stores (Neon, checkpoints/traces)\n- R2 offload (Cloudflare R2, checkpoint archival)\n\nAll credentials are expected to be injected via environment variables\n(populated from Vault: secret/data/user/<service>).\n\nSTRICT MODE (ENV=prod or ENV=production):\n- Raises ConfigurationError i",,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/core/__init__.py,SKIP_INIT_COLLISION
926,app/stores/checkpoint_offload.py,INTERNAL,analytics,L6,app/houseofcards/internal/analytics/drivers/checkpoint_offload.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Checkpoint offload to object storage\n# Callers: workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Storage System\n\n# Checkpoint Offload to Cloudflare R2 (M11)\n""""""\nOffloads old checkpoints from PostgreSQL to Cloudflare R2 for cost optimization.\n","\nOffloads old checkpoints from PostgreSQL to Cloudflare R2 for cost optimization.\n\nFeatures:\n- Gzip compression before upload (typically 5-10x reduction)\n- Date-partitioned S3-compatible key structure\n- Configurable retention policy\n- Async batch processing\n- SAFE OFFLOAD: upload → verify → delete sequence\n- SHA256 integrity hash verification\n- Exponential backoff retry with jitter\n\nThis module is designed to be run as a scheduled job (e.g., daily cron).\n\nEnvironment Variables:\n- DATABASE_URL: P",,NEEDS_CLASSIFICATION,ITERATION_1,Stores,TRANSFER
927,app/stores/health.py,INTERNAL,general,L6,app/houseofcards/internal/general/drivers/health.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Store health checks\n# Callers: health API\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Storage System\n\n# Store Health Probes (M12 Beta Readiness)\n""""""\nHealth probes for database and Redis connectivity.\n",\nHealth probes for database and Redis connectivity.\n\nRequired for M12 Beta rollout:\n- Kubernetes readiness/liveness probes\n- Prometheus health metrics\n- Graceful degradation signaling\n\nEnvironment Variables:\n- DATABASE_URL: PostgreSQL connection string\n- REDIS_URL: Redis connection string\n- HEALTH_CHECK_TIMEOUT_SECONDS: Timeout for health checks (default: 5)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Stores; Domain uncertain,TRANSFER
928,app/tasks/__init__.py,INTERNAL,activity,L5,app/houseofcards/internal/activity/engines/__init__.py,"# Tasks module\n""""""\nTask definitions for background processing.\n\nPhase 2A: Wired exports for modules that are imported directly.\n""""""\n\n# Memory update tasks\n# M10 Metrics collection\nfrom .m10_metrics_collector import collect_m10_metrics, run_metrics_collector\nfrom .memory_update import apply_update_rules, apply_update_rules_sync\n\n# Recovery queue tasks\nfrom .recovery_queue_stream import enqueue_stream, get_dead_letter_count, get_stream_info\n",\nTask definitions for background processing.\n\nPhase 2A: Wired exports for modules that are imported directly.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In tasks/ dir,TRANSFER
929,app/tasks/m10_metrics_collector.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/m10_metrics_collector.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler\n#   Execution: async\n# Role: M10 metrics collection task\n# Callers: scheduler\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: M10 Metrics\n\nfrom app.infra import FeatureIntent\n\n# Phase-2.3: Feature Intent Declaration\n# Reads from Redis and DB, updates in-memory Prometheus gauges",,,NEEDS_CLASSIFICATION,ITERATION_1,In tasks/ dir,TRANSFER
930,app/tasks/memory_update.py,INTERNAL,general,L5,app/houseofcards/internal/general/engines/memory_update.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Memory update background task\n# Callers: workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: Memory System\n\n""""""\nMemory Update Tasks - M7 Implementation\n\nProvides async and sync wrappers for applying memory update rules after","\nMemory Update Tasks - M7 Implementation\n\nProvides async and sync wrappers for applying memory update rules after\ntrace execution. Used by CostSim and other execution endpoints.\n\nFeatures:\n- Async apply_update_rules for non-blocking updates\n- Sync apply_update_rules_sync for deterministic test scenarios\n- Memory audit trail logging\n- Prometheus metrics\n\nUsage:\n    # Async (default, non-blocking)\n    asyncio.create_task(apply_update_rules(tenant, workflow, request_id, trace_input, trace_output))\n",,NEEDS_CLASSIFICATION,ITERATION_1,In tasks/ dir; Domain uncertain,TRANSFER
931,app/tasks/recovery_queue.py,INTERNAL,recovery,L5,app/houseofcards/internal/recovery/engines/recovery_queue.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Recovery queue processing\n# Callers: workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: M10 Recovery\n\n# app/tasks/recovery_queue.py\n""""""\nRedis-based task queue for M10 Recovery evaluation.\n","\nRedis-based task queue for M10 Recovery evaluation.\n\nProvides async enqueue/dequeue functions for recovery candidate evaluation.\n\nUsage:\n    # Enqueue (from ingest endpoint)\n    await enqueue_evaluation(candidate_id=123)\n\n    # Dequeue (from worker)\n    task = await dequeue_evaluation(timeout=5)\n    if task:\n        await process_task(task[""candidate_id""])\n\nEnvironment Variables:\n    REDIS_URL: Redis connection URL (default: redis://localhost:6379/0)\n    RECOVERY_QUEUE_KEY: Queue key name (defa",,NEEDS_CLASSIFICATION,ITERATION_1,In tasks/ dir,TRANSFER
932,app/tasks/recovery_queue_stream.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/recovery_queue_stream.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Recovery queue stream processing\n# Callers: workers\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: M10 Recovery\n\nfrom app.infra import FeatureIntent, RetryPolicy\n\n# Phase-2.3: Feature Intent Declaration\n# Redis Streams with consumer groups for durable message processing","Calculate exponential backoff based on reclaim attempts.\n\nBackoff formula: min(MAX_BACKOFF, BASE_BACKOFF * 2^(attempts-1))\nExamples with 60s base:\n    1 attempt:  60s (1 min)\n    2 attempts: 120s (2 min)\n    3 attempts: 240s (4 min)\n    4 attempts: 480s (8 min)\n    5 attempts: 960s (16 min)\n    ...\n    Max: 86400s (24 hours)\n\nArgs:\n    attempts: Number of previous reclaim attempts\n\nReturns:\n    Minimum idle time in milliseconds before next reclaim",,NEEDS_CLASSIFICATION,ITERATION_1,In tasks/ dir,TRANSFER
933,app/traces/__init__.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/__init__.py,"# AOS Trace Storage Module\n# M6/M8 Deliverable: Run traces with correlation IDs, PostgreSQL storage, replay enforcement\n\nfrom .idempotency import (\n    IdempotencyResponse,\n    IdempotencyResult,\n    InMemoryIdempotencyStore,\n    RedisIdempotencyStore,\n    canonical_json,\n    get_idempotency_store,\n    hash_request,\n)\nfrom .models import (\n    ParityResult,\n    TraceRecord,",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
934,app/traces/idempotency.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/idempotency.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: async\n# Role: Trace idempotency enforcement (Redis + Lua scripts)\n# Authority: Idempotency state mutation (NEW/DUPLICATE/CONFLICT)\n# Callers: trace store, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md (Guarantee 2: Idempotent Trace Emission)\n\n""""""\nRedis Idempotency Store for AOS Traces\n",\nRedis Idempotency Store for AOS Traces\n\nM8 Deliverable: Atomic idempotency enforcement using Redis + Lua scripts.\n\nFeatures:\n- Atomic check-and-set with Lua scripts\n- Configurable TTL per key\n- Conflict detection with hash comparison\n- Async Redis support\n,,NEEDS_CLASSIFICATION,ITERATION_1,Trace storage,TRANSFER
935,app/traces/models.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/traces_models.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Trace data models\n# Callers: traces/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Trace System\n\n""""""\nTrace Models for AOS\nM6 Deliverable: Run traces with correlation IDs\n","\nTrace Models for AOS\nM6 Deliverable: Run traces with correlation IDs\n\nThese models define the structure of execution traces used for:\n- Debugging and inspection\n- Replay verification\n- Determinism testing\n\nDeterminism Invariant (PIN-126):\n- Given the same trace input, replay must produce identical output hash\n- Or fail loudly with a classified reason\n",,NEEDS_CLASSIFICATION,ITERATION_1,Trace storage,TRANSFER
936,app/traces/pg_store.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/pg_store.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: PostgreSQL trace storage\n# Callers: trace store abstraction\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Trace System\n\n""""""\nPostgreSQL Trace Store for AOS\nM8 Deliverable: Production-grade trace storage with PostgreSQL\n","\nPostgreSQL Trace Store for AOS\nM8 Deliverable: Production-grade trace storage with PostgreSQL\n\nProvides:\n- Async PostgreSQL storage with connection pooling\n- RBAC-aware trace access\n- PII redaction before storage\n- Efficient indexing for query API\n\nFROZEN SEMANTICS (PIN-198, S6 Trace Integrity Truth):\n- All trace INSERTs use ON CONFLICT DO NOTHING (Invariant #15: First Truth Wins)\n- No UPDATE on aos_trace_steps (Invariant #13: Trace Ledger Semantics)\n- Only status/completed_at UPDATE allowed on",,NEEDS_CLASSIFICATION,ITERATION_1,Trace storage,TRANSFER
937,app/traces/redact.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/redact.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Trace data redaction for security\n# Callers: trace store\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Trace System\n\n""""""\nPII Redaction Utility for Trace Storage\nM8 Deliverable: Secure trace storage with PII masking\n","\nPII Redaction Utility for Trace Storage\nM8 Deliverable: Secure trace storage with PII masking\n\nRedacts sensitive data from traces before storage:\n- Passwords, API keys, tokens\n- Credit card numbers\n- Email addresses\n- Custom patterns via configuration\n",,NEEDS_CLASSIFICATION,ITERATION_1,Trace storage,TRANSFER
938,app/traces/replay.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/replay.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Trace replay execution\n# Callers: API routes\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Trace System\n\n""""""\nServer-Side Replay Enforcement\nM8 Deliverable: Enforce replay_behavior during trace execution\n","\nServer-Side Replay Enforcement\nM8 Deliverable: Enforce replay_behavior during trace execution\n\nProvides:\n- Replay behavior enforcement (execute, skip, check)\n- Idempotency key validation\n- Output verification for ""check"" mode\n- Replay mismatch detection\n",,NEEDS_CLASSIFICATION,ITERATION_1,Trace storage,TRANSFER
939,app/traces/store.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/traces_store.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Trace store abstraction\n# Callers: services, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Trace System\n\n""""""\nTrace Storage for AOS\nM6 Deliverable: Run traces with correlation IDs\n",\nTrace Storage for AOS\nM6 Deliverable: Run traces with correlation IDs\n\nProvides persistent storage for execution traces used in:\n- Debugging and inspection\n- Replay verification\n- Determinism testing\n,,NEEDS_CLASSIFICATION,ITERATION_1,Trace storage,TRANSFER
940,app/traces/traces_metrics.py,CUSTOMER,logs,L6,app/houseofcards/customer/logs/drivers/traces_metrics.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Trace metrics collection\n# Callers: trace store\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Trace System\n\n""""""\nPrometheus Metrics for AOS Traces API\n\nM8 Deliverable: Comprehensive observability for trace operations.","\nPrometheus Metrics for AOS Traces API\n\nM8 Deliverable: Comprehensive observability for trace operations.\n\nMetrics:\n- aos_trace_request_duration_seconds: Histogram of trace API latencies\n- aos_trace_requests_total: Counter of trace requests by operation/status\n- aos_trace_parity_status: Gauge for parity check results (1=pass, 0=fail)\n- aos_replay_enforcement_total: Counter of replay enforcement outcomes\n- aos_idempotency_total: Counter of idempotency check outcomes\n",,NEEDS_CLASSIFICATION,ITERATION_1,Trace storage,TRANSFER
941,app/utils/__init__.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/__init__.py,"# NOVA Utils\n# Utility modules for rate limiting, idempotency, budget tracking\n# Uses lazy imports to avoid pulling in heavy dependencies (sqlmodel, redis)\n\nfrom typing import TYPE_CHECKING\n\n\n# Lazy imports for test compatibility (avoid sqlmodel/redis dependency)\ndef get_existing_run(*args, **kwargs):\n    from .idempotency import get_existing_run as _get_existing_run\n\n    return _get_existing_run(*args, **kwargs)\n\n\ndef check_idempotency(*args, **kwargs):",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
942,app/utils/budget_tracker.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/budget_tracker.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Budget tracking utility\n# Callers: runtime, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Budget System\n\n# Budget Tracker\n# Tracks LLM costs and enforces budget limits per agent/tenant\n# Phase 5: Budget Protection Layer (BPL)\n",Current budget status for an agent.,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
943,app/utils/canonical_json.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/canonical_json.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Canonical JSON serialization for hashing\n# Callers: SDK, trace system\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Hash Parity\n\n# utils/canonical_json.py\n""""""\nCanonical JSON serialization for AOS.\n",\nCanonical JSON serialization for AOS.\n\nEnsures deterministic JSON output for:\n- Replay testing\n- Content hashing\n- Golden file comparison\n\nSee: app/specs/canonical_json.md for full specification.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
944,app/utils/concurrent_runs.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/concurrent_runs.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Concurrent run limit enforcement\n# Callers: API routes\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Run Limits\n\n# Concurrent Runs Limiter\n# Limits concurrent runs per agent/tenant using Redis semaphore\n\nimport logging",Limits concurrent runs using Redis-based semaphore.\n\nUses Redis sets to track active runs per key.\nAutomatically expires slots after timeout.,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
945,app/utils/db_helpers.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/db_helpers.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Additional database utilities\n# Callers: services\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Core Infrastructure\n\n""""""Database helper functions for SQLModel row extraction.\n\nPIN-099: SQLModel Row Extraction Patterns\n","Database helper functions for SQLModel row extraction.\n\nPIN-099: SQLModel Row Extraction Patterns\n\nThis module provides helper functions to safely extract values from\nSQLModel/SQLAlchemy query results, avoiding common anti-patterns that\ncause runtime errors.\n\nCommon Issues Prevented:\n1. Row objects are truthy even when containing 0/None\n2. Row objects don't support direct comparison operators\n3. Row objects from .all() are not Python tuples\n\nUsage:\n    from app.utils.db_helpers import scalar_or_",,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
946,app/utils/deterministic.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/deterministic.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Deterministic execution utilities\n# Callers: runtime, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Determinism\n\n# Deterministic Utilities for M11 Skills\n# Provides seeded randomness and backoff for replay-safe operations\n\nimport hashlib",Generate deterministic jitter value from workflow ID and attempt number.\n\nUses HMAC-SHA256 to produce a consistent float between 0 and 1\nthat is reproducible given the same inputs.\n\nArgs:\n    workflow_run_id: Unique workflow run identifier\n    attempt: Current attempt number (1-based)\n\nReturns:\n    Float between 0.0 and 1.0,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
947,app/utils/guard_cache.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/guard_cache.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Guard decision caching\n# Callers: guard API\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Guard System\n\n# Guard API Cache Layer\n""""""\nRedis-based cache for Guard Console endpoints.\n","\nRedis-based cache for Guard Console endpoints.\n\nReduces database query latency by caching frequently-accessed data.\nCritical for cross-region deployments (EU server, Singapore DB).\n\nCache Keys:\n- guard:status:{tenant_id} - 5s TTL (real-time status)\n- guard:snapshot:{tenant_id} - 10s TTL (today's metrics)\n- guard:incidents:{tenant_id}:{limit}:{offset} - 5s TTL\n\nPerformance Target:\n- Reduce /guard/status from 4-7s to <100ms (cache hit)\n- Reduce /guard/snapshot/today from 2-6s to <100ms (cache hit",,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
948,app/utils/idempotency.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/idempotency.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Idempotency key utilities\n# Callers: API routes, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Idempotency\n\n# Idempotency Handling\n# Prevents duplicate runs using idempotency keys\n\nimport logging",Result of idempotency check.,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
949,app/utils/input_sanitizer.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/input_sanitizer.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Input sanitization for security\n# Callers: API routes\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Input Security\n\n# Input Sanitizer\n# Phase 5: Prompt-Injection Safe Input Gate\n# Sanitizes user input before it reaches the planner\n",Result of input sanitization.,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
950,app/utils/metrics_helpers.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/metrics_helpers.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Metrics helper functions\n# Callers: all modules\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Observability\n\n""""""\nPrometheus Metrics Helpers - Idempotent Registration\n\nThis module provides helper functions for creating Prometheus metrics","\nPrometheus Metrics Helpers - Idempotent Registration\n\nThis module provides helper functions for creating Prometheus metrics\nthat are safe to use in modules that may be reimported during testing.\n\nUsage:\n    from app.utils.metrics_helpers import get_or_create_counter, get_or_create_gauge\n\n    MY_COUNTER = get_or_create_counter(\n        ""mymodule_operations_total"",\n        ""Total operations"",\n        [""status"", ""type""]\n    )\n\nPrevention: PIN-120 / PREV-1 - Prevents duplicate timeseries errors in ",,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
951,app/utils/plan_inspector.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/plan_inspector.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Plan structure inspection\n# Callers: runtime API\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Plan System\n\n# Plan Safety Inspector\n# Validates plans before execution to prevent dangerous operations\n\nimport logging",A single validation error.,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
952,app/utils/rate_limiter.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/rate_limiter.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Rate limiting utilities\n# Callers: middleware, API routes\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Rate Limiting\n\n# Rate Limiter\n# Token bucket rate limiting using Redis\n\nimport logging",Token bucket rate limiter using Redis.\n\nProvides per-key rate limiting with configurable RPM.\nFalls back to allowing requests if Redis is unavailable.,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
953,app/utils/runtime.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/runtime.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Runtime utilities\n# Callers: runtime, workers\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Runtime\n\n""""""\nRuntime Utilities - Centralized Shared Helpers\n\nCANONICAL LOCATION: All code needing generate_uuid() or utc_now() must import from here.",\nRuntime Utilities - Centralized Shared Helpers\n\nCANONICAL LOCATION: All code needing generate_uuid() or utc_now() must import from here.\nDO NOT define these functions elsewhere.\nDO NOT import them transitively through other modules.\n\nThis prevents import hygiene violations where services fail at runtime\nbecause they relied on transitive imports that aren't guaranteed.\n\nSee LESSONS_ENFORCED.md Invariant #5: Import Locality\n,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
954,app/utils/schema_parity.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/schema_parity.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: any\n#   Execution: sync\n# Role: Schema parity checking utilities\n# Callers: SDK, API\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Schema Parity\n\n""""""\nM26 Prevention Mechanism #2: Startup Schema Parity Guard\n=========================================================\n",\nM26 Prevention Mechanism #2: Startup Schema Parity Guard\n=========================================================\n\nINVARIANT: SQLModel metadata must match live DB schema exactly.\nIf not → hard crash on boot.\n\nWhy hard-fail?\nBecause cost integrity errors are worse than downtime.\n,,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
955,app/utils/webhook_verify.py,CUSTOMER,general,L6,app/houseofcards/customer/general/drivers/webhook_verify.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: api\n#   Execution: sync\n# Role: Webhook signature verification\n# Callers: webhook API\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Webhook Security\n\n""""""\nWebhook Signature Verification Utility\n\nProvides HMAC-SHA256 signature verification for webhook receivers with","\nWebhook Signature Verification Utility\n\nProvides HMAC-SHA256 signature verification for webhook receivers with\nsupport for key versioning and grace periods during rotation.\n\nUsage (FastAPI example):\n    from app.utils.webhook_verify import WebhookVerifier\n\n    verifier = WebhookVerifier(keys={\n        ""v1"": ""old_key_hex..."",\n        ""v2"": ""new_key_hex..."",\n    }, current_version=""v2"", grace_versions=[""v1""])\n\n    @app.post(""/webhook"")\n    async def receive_webhook(request: Request):\n        body",,NEEDS_CLASSIFICATION,ITERATION_1,Utilities,TRANSFER
956,app/worker/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# NOVA Worker Package\n# Worker pool and runner for async run execution\n#\n# TECH-001: Lazy imports to avoid sqlmodel dependency in lightweight tests\n# Heavy imports (pool.py, runner.py) require sqlmodel which breaks test isolation.\n# Use lazy getters to defer import until actual usage.\n#\n# Reference: GAP-155 (Job Queue Worker), GAP-162-164 (Lifecycle Worker)\n\nfrom typing import TYPE_CHECKING\n\nif TYPE_CHECKING:\n    from .pool import WorkerPool\n    from .runner import RunRunner\n    from .job_queue_worker import JobQueueWorker",Lazy module wrapper for backwards compatibility.,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
957,app/worker/enforcement/__init__.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/__init__.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Role: Step-level enforcement for governance\n\n""""""\nEnforcement Package\n\nContains step-level enforcement guarantees:\n- step_enforcement: Same-step enforcement (GAP-016)\n- enforcement_guard: Step-level guarantee (GAP-030)\n""""""\n\nfrom app.worker.enforcement.step_enforcement import (\n    enforce_before_step_completion,\n    StepEnforcementError,",\nEnforcement Package\n\nContains step-level enforcement guarantees:\n- step_enforcement: Same-step enforcement (GAP-016)\n- enforcement_guard: Step-level guarantee (GAP-030)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/auth/mappings/__init__.py,SKIP_INIT_COLLISION
958,app/worker/enforcement/enforcement_guard.py,INTERNAL,general,L5,app/houseofcards/internal/general/engines/enforcement_guard.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (during step execution)\n#   Execution: sync (must complete before step returns)\n# Role: Guarantee enforcement check is never skipped\n# Callers: runner.py step execution loop\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: GAP-030\n\n""""""\nModule: enforcement_guard\nPurpose: Guarantees enforcement is never skipped.\n","\nModule: enforcement_guard\nPurpose: Guarantees enforcement is never skipped.\n\nContext managers that ensure enforcement checks are performed.\nIf enforcement check is bypassed, the guard raises an error at exit.\n\nImports (Dependencies):\n    - None (standalone)\n\nExports (Provides):\n    - EnforcementGuard: Context manager that ensures enforcement runs\n    - EnforcementSkippedError: Raised if enforcement was bypassed\n\nWiring Points:\n    - Called from: runner.py step execution loop\n    - Wraps: Each s",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir; Domain uncertain,TRANSFER
959,app/worker/enforcement/step_enforcement.py,INTERNAL,general,L5,app/houseofcards/internal/general/engines/step_enforcement.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (during step execution)\n#   Execution: sync (must complete before step returns)\n# Role: Guarantee enforcement happens within same step\n# Callers: runner.py step execution loop\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: GAP-016\n\n""""""\nModule: step_enforcement\nPurpose: Ensures STOP/KILL actions halt execution within the same step.\n","\nModule: step_enforcement\nPurpose: Ensures STOP/KILL actions halt execution within the same step.\n\nImports (Dependencies):\n    - app.services.governance.runtime_switch: is_governance_active\n    - app.policy.conflict_resolver: resolve_policy_conflict\n\nExports (Provides):\n    - enforce_before_step_completion(ctx, step_result) -> EnforcementResult\n    - StepEnforcementError: Raised when enforcement requires halt\n\nWiring Points:\n    - Called from: runner.py BEFORE returning step result\n    - Halts: ",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir; Domain uncertain,TRANSFER
960,app/worker/hooks/__init__.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/__init__.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Role: Worker hooks package\n# Reference: GAP-137, GAP-138, GAP-139, GAP-140\n\n""""""\nWorker hooks for governance enforcement in the runner execution path.\n\nThese hooks intercept execution at critical points to enforce:\n- Retrieval mediation (GAP-137)\n- Hallucination detection (GAP-138)\n- Monitor/limit enforcement (GAP-139)\n- Step enforcement event bus (GAP-140)\n""""""\n",\nWorker hooks for governance enforcement in the runner execution path.\n\nThese hooks intercept execution at critical points to enforce:\n- Retrieval mediation (GAP-137)\n- Hallucination detection (GAP-138)\n- Monitor/limit enforcement (GAP-139)\n- Step enforcement event bus (GAP-140)\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/auth/mappings/__init__.py,SKIP_INIT_COLLISION
961,app/worker/hooks/hallucination_hook.py,INTERNAL,general,L5,app/houseofcards/internal/general/engines/hallucination_hook.py,"# Layer: L5 — Execution & Workers\n# AUDIENCE: INTERNAL\n# PHASE: W0\n# Product: system-wide\n# Wiring Type: runner-hook\n# Parent Gap: GAP-023 (HallucinationDetector)\n# Reference: GAP-138\n# Temporal:\n#   Trigger: worker (after LLM response)\n#   Execution: async\n# Role: Wire HallucinationDetector to runner output annotation\n# Callers: app/worker/runner.py (after LLM response)\n# Allowed Imports: L4 (HallucinationDetector), L6\n# Forbidden Imports: L1, L2, L3\n",\nModule: hallucination_hook\nPurpose: Wire HallucinationDetector to runner output annotation.\n\nWires:\n    - Source: app/services/hallucination/hallucination_detector.py\n    - Target: app/worker/runner.py (after LLM response)\n\nDesign: Non-blocking per INV-002 (HALLU-INV-001)\n    - Detection runs async\n    - Results annotate response\n    - High confidence triggers alert (does not block)\n\nCRITICAL INVARIANT (INV-002 / HALLU-INV-001):\n    This hook MUST be non-blocking by default.\n    Hallucination d,,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir; Domain uncertain,TRANSFER
962,app/worker/hooks/limit_hook.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/limit_hook.py,"# Layer: L5 — Execution & Workers\n# AUDIENCE: INTERNAL\n# PHASE: W0\n# Product: system-wide\n# Wiring Type: runner-hook\n# Parent Gap: GAP-053 (UsageMonitor), GAP-054 (HealthMonitor), GAP-055 (LimitEnforcer)\n# Reference: GAP-139\n# Temporal:\n#   Trigger: worker (step loop)\n#   Execution: async\n# Role: Enforce usage limits and monitor health in runner\n# Callers: app/worker/runner.py (step loop)\n# Allowed Imports: L4 (monitors, limits), L6\n# Forbidden Imports: L1, L2, L3\n","\nModule: limit_hook\nPurpose: Enforce usage limits and monitor health in runner.\n\nWires:\n    - Source: app/services/monitors/usage_monitor.py\n    - Source: app/services/monitors/health_monitor.py\n    - Source: app/services/limits/limit_enforcer.py\n    - Target: app/worker/runner.py (step loop)\n\nEnforcement Points:\n    - Before step: Check limits, may block\n    - After step: Record usage, update monitors\n\nThis hook ensures:\n    1. Tenant limits are enforced before step execution\n    2. Usage is re",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
963,app/worker/hooks/retrieval_hook.py,INTERNAL,general,L5,app/houseofcards/internal/general/engines/retrieval_hook.py,"# Layer: L5 — Execution & Workers\n# AUDIENCE: INTERNAL\n# PHASE: W0\n# Product: system-wide\n# Wiring Type: runner-hook\n# Parent Gap: GAP-065 (RetrievalMediator)\n# Reference: GAP-137\n# Temporal:\n#   Trigger: worker (step execution)\n#   Execution: async\n# Role: Wire RetrievalMediator as MANDATORY in LLM path\n# Callers: app/worker/runner.py (step execution)\n# Allowed Imports: L4 (RetrievalMediator), L6\n# Forbidden Imports: L1, L2, L3\n",\nModule: retrieval_hook\nPurpose: Wire RetrievalMediator as MANDATORY in LLM execution path.\n\nWires:\n    - Source: app/services/mediation/retrieval_mediator.py\n    - Target: app/worker/runner.py (step execution)\n\nInvariant: NO BYPASS ALLOWED\n    - All external data retrieval MUST go through mediator\n    - Direct connector access from runner is FORBIDDEN\n    - Audit trail for every retrieval operation\n\nThis hook enforces:\n    1. All data retrievals in step execution go through RetrievalMediator\n  ,,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir; Domain uncertain,TRANSFER
964,app/worker/hooks/step_enforcement_hook.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/step_enforcement_hook.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Wiring Type: runner-hook\n# Parent Gap: GAP-016 (StepEnforcement)\n# Reference: GAP-140\n# Temporal:\n#   Trigger: worker (after step completion)\n#   Execution: async\n# Role: Wire StepEnforcement to event bus for policy evaluation\n# Callers: app/worker/runner.py (after step completion)\n# Allowed Imports: L4 (StepEnforcement), L6 (events)\n# Forbidden Imports: L1, L2, L3\n\n""""""\nModule: step_enforcement_hook","\nModule: step_enforcement_hook\nPurpose: Wire StepEnforcement to event bus for policy evaluation.\n\nWires:\n    - Source: app/worker/enforcement/step_enforcement.py\n    - Target: app/events (event bus)\n\nThis hook provides:\n    1. Event emission after step enforcement\n    2. Policy evaluation results publication\n    3. Audit trail for enforcement decisions\n\nThe hook bridges the step enforcement logic with the event system,\nallowing downstream consumers to react to policy decisions.\n\nAcceptance Crite",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
965,app/worker/idempotency.py,INTERNAL,general,L5,app/houseofcards/internal/general/engines/idempotency.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (job execution)\n#   Execution: async\n# Role: Idempotency guarantees for job execution\n# Callers: JobQueueWorker, lifecycle handlers\n# Allowed Imports: L6 (Redis)\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: INV-W0-003\n\n""""""\nModule: idempotency\nPurpose: Ensure job execution is idempotent by (job_id, plane_id).\n","\nModule: idempotency\nPurpose: Ensure job execution is idempotent by (job_id, plane_id).\n\nINV-W0-003: Same (job_id, plane_id) MUST produce same result.\n\nNetwork failures, restarts, and retries can cause duplicate job execution.\nWithout idempotency, side effects multiply.\n\nFeatures:\n    - Distributed idempotency via Redis\n    - TTL-based key expiration\n    - Cached result return for duplicates\n    - Support for retry on transient failures\n\nAcceptance Criteria:\n    - IDEM-001: All state-mutating jo",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir; Domain uncertain,TRANSFER
966,app/worker/job_queue_worker.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/job_queue_worker.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Wiring Type: worker\n# Parent Gap: GAP-039 (JobScheduler)\n# Reference: GAP-155\n# Depends On: GAP-154 (APScheduler Executor), INV-W0-002 (KillSwitch), INV-W0-003 (Idempotency)\n# Temporal:\n#   Trigger: worker (startup)\n#   Execution: async\n# Role: Background worker that processes job queue\n# Callers: Worker startup\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L3\n\n""""""",\nModule: job_queue_worker\nPurpose: Background worker that processes job queue.\n\nWires:\n    - Source: Redis job queue\n    - Target: Job handlers via APSchedulerExecutor\n\nProvides:\n    - Job pickup from queue (Redis BLPOP)\n    - Concurrent execution (configurable workers)\n    - Dead letter queue for failed jobs\n    - Graceful shutdown\n    - Kill switch integration (INV-W0-002)\n    - Idempotency enforcement (INV-W0-003)\n\nAcceptance Criteria:\n    - AC-155-01: Jobs are picked from Redis queue\n    - A,,NEEDS_CLASSIFICATION,ITERATION_1,L5 Worker,TRANSFER
967,app/worker/kill_switch_guard.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/kill_switch_guard.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (job execution)\n#   Execution: async\n# Role: Guard that enforces RuntimeSwitch checks during job execution\n# Callers: JobQueueWorker, lifecycle handlers, APScheduler executor\n# Allowed Imports: L4 (RuntimeSwitch), L6\n# Forbidden Imports: L1, L2, L3\n# Reference: INV-W0-002\n\n""""""\nModule: kill_switch_guard\nPurpose: Enforce RuntimeSwitch checks during job execution.\n","\nModule: kill_switch_guard\nPurpose: Enforce RuntimeSwitch checks during job execution.\n\nINV-W0-002: Jobs MUST be killable at any point.\n\nEvery job execution MUST check RuntimeSwitch:\n1. At start — before any work begins\n2. On heartbeat — every N seconds during execution\n3. On completion — before committing results\n\nIf RuntimeSwitch disables the capability, the job must be aborted.\n\nAcceptance Criteria:\n    - KS-001: All job handlers use KillSwitchGuard\n    - KS-002: Heartbeat check every 30s\n   ",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
968,app/worker/lifecycle_worker.py,INTERNAL,incidents,L4,app/houseofcards/internal/incidents/engines/lifecycle_worker.py,"# Layer: L5 — Execution & Workers\n# AUDIENCE: INTERNAL\n# PHASE: W1\n# Product: system-wide\n# Wiring Type: worker\n# Parent Gap: GAP-071-082 (Lifecycle Stages)\n# Reference: GAP-162, GAP-163, GAP-164\n# Depends On: GAP-154-158 (Job infrastructure), GAP-159-161 (Stage executors)\n# Temporal:\n#   Trigger: job queue\n#   Execution: async\n# Role: Lifecycle worker orchestration with progress tracking and failure recovery\n# Callers: JobQueueWorker, APSchedulerExecutor\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L3","\nModule: lifecycle_worker\nPurpose: Worker orchestration for knowledge plane lifecycle transitions.\n\nContains:\n    - LifecycleWorker (GAP-162): Orchestrates lifecycle stages via job queue\n    - LifecycleProgressManager (GAP-163): Tracks and reports progress\n    - LifecycleRecoveryManager (GAP-164): Handles failures and retries\n\nWires:\n    - Source: JobQueueWorker for job dispatch\n    - Target: Stage handlers for execution\n    - Uses: JobProgressTracker, JobRetryManager, JobAuditEmitter\n\nAcceptanc",,NEEDS_CLASSIFICATION,ITERATION_1,Lifecycle management,TRANSFER
969,app/worker/observability_guard.py,INTERNAL,incidents,L5,app/houseofcards/internal/incidents/engines/observability_guard.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (run execution)\n#   Execution: async\n# Role: Observability requirements guard - ensures trace creation with configurable failure modes\n# Callers: RunRunner (L5)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), FIX-004\n\n""""""\nObservability Guard (L5 Execution)\n\nThis guard ensures observability requirements are met during run execution.","\nObservability Guard (L5 Execution)\n\nThis guard ensures observability requirements are met during run execution.\nIt handles trace creation failures according to a configurable mode.\n\nProblem Addressed (PIN-454 G-003):\n- Trace failures run in ""dark mode"" — no observability, compliance blind spot\n- Current behavior silently continues execution when traces fail\n- No indication in the run record that observability was degraded\n\nModes:\n- STRICT: Fail run if trace creation fails (max observability, ma",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
970,app/worker/orchestration/__init__.py,INTERNAL,logs,L4,app/houseofcards/internal/logs/engines/__init__.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Run Orchestration Kernel module exports\n# Callers: WorkerPool (L5), RunRunner (L5)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""\nRun Orchestration Module\n\nThis module provides the Run Orchestration Kernel (ROK) for managing","\nRun Orchestration Module\n\nThis module provides the Run Orchestration Kernel (ROK) for managing\nrun lifecycle with audit contract integration.\n\nComponents:\n- RunOrchestrationKernel: Single authority for run lifecycle\n- PhaseStateMachine: Phase state tracking\n- RunPhase: Phase enum (CREATED → AUTHORIZED → EXECUTING → ...)\n\nUsage:\n    from app.worker.orchestration import create_rok, RunPhase\n\n    kernel = create_rok(run_id)\n    kernel.declare_expectations()\n\n    if kernel.authorize():\n        kern",,NEEDS_CLASSIFICATION,ITERATION_1,Orchestration,TRANSFER
971,app/worker/orchestration/phases.py,INTERNAL,logs,L4,app/houseofcards/internal/logs/engines/phases.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Run Orchestration Kernel phase definitions and state machine\n# Callers: RunOrchestrationKernel (L5)\n# Allowed Imports: L6 (stdlib only)\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), Section 8.1\n\n""""""\nROK Phase State Machine\n\nDefines the phases a run goes through during execution:",\nROK Phase State Machine\n\nDefines the phases a run goes through during execution:\n\n    CREATED → AUTHORIZED → EXECUTING → GOVERNANCE_CHECK → FINALIZING → COMPLETED/FAILED\n\nEach phase has:\n- Entry conditions (what must be true to enter)\n- Exit conditions (what must be true to exit)\n- Failure modes (what happens if something goes wrong)\n\nDesign Principles:\n1. Every phase transition is auditable\n2. GOVERNANCE_CHECK is mandatory before FINALIZING\n3. run_id is the correlation key across all phases\n4.,,NEEDS_CLASSIFICATION,ITERATION_1,Orchestration,TRANSFER
972,app/worker/orchestration/run_orchestration_kernel.py,INTERNAL,activity,L4,app/houseofcards/internal/activity/engines/run_orchestration_kernel.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker-pool\n#   Execution: sync-over-async\n# Role: Run Orchestration Kernel - Single authority for run lifecycle\n# Callers: WorkerPool (L5), RunRunner (L5)\n# Allowed Imports: L4 (via facades only), L6\n# Forbidden Imports: L1, L2, L3, L4 engines directly\n# Reference: PIN-454 (Cross-Domain Orchestration Audit), Section 8.1\n\n""""""\nRun Orchestration Kernel (ROK)\n\nThe ROK is the single authority for run lifecycle management. It:",\nRun Orchestration Kernel (ROK)\n\nThe ROK is the single authority for run lifecycle management. It:\n\n1. Manages phase transitions (CREATED → AUTHORIZED → EXECUTING → ...)\n2. Declares audit expectations at T0 (run start)\n3. Coordinates governance checks across domains\n4. Emits finalize_run acknowledgment when complete\n\nArchitecture:\n\n    ┌──────────────────────────────────────────────────────────────────┐\n    │                    Run Orchestration Kernel (ROK)                │\n    │               ,,NEEDS_CLASSIFICATION,ITERATION_1,Orchestration,TRANSFER
973,app/worker/outbox_processor.py,INTERNAL,incidents,L5,app/houseofcards/internal/incidents/engines/outbox_processor.py,"#!/usr/bin/env python3\n""""""\nOutbox Processor Worker\n\nProcesses transactional outbox events for exactly-once external side-effects.\nUses FOR UPDATE SKIP LOCKED pattern for concurrent-safe claiming.\n\nFeatures:\n- Leader election via distributed locks\n- Idempotent external calls (HTTP with Idempotency-Key header)\n- Exponential backoff on failures\n- Dead-letter after max retries\n- Prometheus metrics for observability\n\nUsage:",\nOutbox Processor Worker\n\nProcesses transactional outbox events for exactly-once external side-effects.\nUses FOR UPDATE SKIP LOCKED pattern for concurrent-safe claiming.\n\nFeatures:\n- Leader election via distributed locks\n- Idempotent external calls (HTTP with Idempotency-Key header)\n- Exponential backoff on failures\n- Dead-letter after max retries\n- Prometheus metrics for observability\n\nUsage:\n    # Run as worker (continuous)\n    python -m app.worker.outbox_processor\n\n    # One-time processing\n ,,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
974,app/worker/policy_checker.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/policy_checker.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Mid-execution policy checking for reactive enforcement\n# Callers: RunRunner (L5)\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-454, FIX-005 (Phase 5)\n\n""""""\nMid-Execution Policy Checker\n\nChecks policy constraints during execution, not just at submission.","\nMid-Execution Policy Checker\n\nChecks policy constraints during execution, not just at submission.\nEnables reactive policy enforcement for long-running runs.\n\nDESIGN CONSTRAINTS:\n1. Layer L5 — Execution & Workers\n2. Interval-based checking (not every step)\n3. Three decisions: CONTINUE, PAUSE, TERMINATE\n4. Non-blocking design (async-ready)\n5. Feature flag controlled\n\nKey Features:\n- Detects policy changes since submission\n- Checks budget consumption against new limits\n- Detects runtime policy vio",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
975,app/worker/pool.py,INTERNAL,logs,L5,app/houseofcards/internal/logs/engines/pool.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler (standalone process)\n#   Execution: sync (dispatch loop) + ThreadPoolExecutor (worker threads)\n# Role: Worker pool dispatch (polls DB, dispatches to RunRunner via ROK)\n# Authority: Run claim (pending → running via ThreadPool dispatch)\n# Callers: Standalone process (`python -m app.worker.pool`)\n# Allowed Imports: L5 (orchestration), L6\n# Forbidden Imports: L1, L2, L3, L4\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md (Guarantee 3: At-Least-Once Worker Dispatch)\n# Pattern: Sync dispatch loop with ThreadPoolExecutor for worker isolation\n# Reference: PIN-454 (Cross-Domain Orchestration Audit)\n\n""""""",\nWorker pool: polls runs table and dispatches runs to runner workers.\nDesigned to be launched as a separate process: `python -m app.worker.pool`\n\nSupports graceful shutdown via SIGTERM/SIGINT - waits for running tasks to complete.\n\nPIN-454 Integration:\n- Uses ROK for run lifecycle management\n- Declares audit expectations at dispatch time (T0)\n- Finalizes ROK after run completion\n,,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
976,app/worker/recovery_claim_worker.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/recovery_claim_worker.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler (standalone process)\n#   Execution: async\n# Role: Recovery claim processing orchestration (L5 execution wrapper)\n# Authority: Recovery candidate state mutation (unevaluated → claimed → processed)\n# Callers: Standalone process\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md (L5 Worker Rules)\n# Reference: PIN-257 Phase R-4 (L5→L4 Violation Fix)\n#\n# GOVERNANCE NOTE: L5 owns all DB operations.\n# Phase R-4 FIX: Removed L4 imports per layer model.","Worker that claims and processes recovery candidates using FOR UPDATE SKIP LOCKED.\n\nThis pattern ensures:\n- Multiple workers can run simultaneously without conflicts\n- Each worker claims distinct rows\n- Locked rows are skipped, preventing duplicate processing\n- Unclaimed rows are released on shutdown",,NEEDS_CLASSIFICATION,ITERATION_1,L5 Worker,TRANSFER
977,app/worker/recovery_evaluator.py,INTERNAL,incidents,L5,app/houseofcards/internal/incidents/engines/recovery_evaluator.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker (failure events)\n#   Execution: async\n# Role: Recovery execution (L5 pure execution)\n# Authority: Recovery action execution (M9/M10 pattern)\n# Callers: L4 RecoveryEvaluationEngine (via call-down)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md (Failure Semantics: recover mode)\n# Reference: PIN-257 Phase R-1 (L5→L4 Violation Fix)\n#\n# GOVERNANCE NOTE: L5 owns EXECUTION only.\n# L4 recovery_evaluation_engine.py provides domain decisions.",Event representing a failure that needs recovery evaluation.,,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
978,app/worker/runner.py,INTERNAL,analytics,L5,app/houseofcards/internal/analytics/engines/runner.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: worker-pool\n#   Execution: sync-over-async\n# Role: Run execution (sync entrypoint wrapping async internal execution)\n# Authority: Run state mutation (pending → running → succeeded/failed/halted)\n# Callers: WorkerPool (via ThreadPoolExecutor)\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md (Guarantee 3: At-Least-Once Worker Dispatch)\n# Pattern: Sync-over-async per contract (ThreadPool requires sync callable)\n\n""""""\nRunner: executes a single run's plan steps, handles retries and backoff.","\nRunner: executes a single run's plan steps, handles retries and backoff.\nThis runner expects `run_row` to contain id, agent_id, goal, plan_json, attempts.\n",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
979,app/worker/runtime/__init__.py,INTERNAL,incidents,L4,app/houseofcards/internal/incidents/engines/__init__.py,"# runtime/__init__.py\n""""""\nMachine-Native Runtime Interfaces (M1 + M2)\n\nThis module provides the core runtime APIs for AOS:\n- runtime.execute() - Execute skills, never throws, returns StructuredOutcome\n- runtime.describe_skill() - Get skill metadata\n- runtime.query() - Query budget, state, history\n- runtime.get_resource_contract() - Get resource constraints\n\nAll interfaces are designed for machine-native operation:\n- Queryable state (not log parsing)\n- Capability contracts (not just tool lists)\n- Structured outcomes (never throws)\n- Failure as data (navigable, not opaque)","\nMachine-Native Runtime Interfaces (M1 + M2)\n\nThis module provides the core runtime APIs for AOS:\n- runtime.execute() - Execute skills, never throws, returns StructuredOutcome\n- runtime.describe_skill() - Get skill metadata\n- runtime.query() - Query budget, state, history\n- runtime.get_resource_contract() - Get resource constraints\n\nAll interfaces are designed for machine-native operation:\n- Queryable state (not log parsing)\n- Capability contracts (not just tool lists)\n- Structured outcomes (nev",,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/jobs/__init__.py,SKIP_INIT_COLLISION
980,app/worker/runtime/contracts.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/contracts.py,"# runtime/contracts.py\n""""""\nContract Dataclasses for Machine-Native Runtime\n\nThese are auxiliary contract shapes used alongside the core runtime types.\nProvides structured metadata for skill contracts and versioning.\n""""""\n\nfrom dataclasses import dataclass, field\nfrom datetime import datetime, timezone\nfrom typing import Any, Dict, List\n\n\n@dataclass(frozen=True)\nclass ContractMetadata:",\nContract Dataclasses for Machine-Native Runtime\n\nThese are auxiliary contract shapes used alongside the core runtime types.\nProvides structured metadata for skill contracts and versioning.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir; Domain uncertain,TRANSFER
981,app/worker/runtime/core.py,INTERNAL,general,L4,app/houseofcards/internal/general/engines/core.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: async\n# Role: Core runtime execution (StructuredOutcome, never throws)\n# Authority: Skill execution, budget queries, state queries\n# Callers: API routes, workers, SDK\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md (L5 Worker Rules)\n# Invariant: execute() NEVER throws - always returns StructuredOutcome\n\n# runtime/core.py\n""""""","\nCore Runtime Implementation (M1)\n\nMachine-native runtime that provides:\n1. execute() - Never throws, returns StructuredOutcome\n2. describe_skill() - Returns SkillDescriptor with stable fields\n3. query() - Deterministic queries for budget, state, history\n4. get_resource_contract() - Resource constraints and limits\n\nDesign principles (from PIN-005):\n- Queryable state (agent asks questions, gets structured answers)\n- Capability awareness (agent knows what it can do and what it costs)\n- Failure as ",,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir; Domain uncertain,TRANSFER
982,app/worker/runtime/integrated_runtime.py,INTERNAL,agent,L4,app/houseofcards/internal/agent/engines/integrated_runtime.py,"# runtime/integrated_runtime.py\n""""""\nIntegrated Runtime (M2)\n\nRuntime that fetches handlers from SkillRegistry v2 instead of\ninternal registry map. Provides full machine-native interface\nwith registry-backed skill resolution.\n""""""\n\nfrom __future__ import annotations\n\nimport asyncio\nimport sys\nimport time\nimport uuid",\nIntegrated Runtime (M2)\n\nRuntime that fetches handlers from SkillRegistry v2 instead of\ninternal registry map. Provides full machine-native interface\nwith registry-backed skill resolution.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In runtime/ dir,TRANSFER
983,app/worker/simulate.py,INTERNAL,analytics,L5,app/houseofcards/internal/analytics/engines/simulate.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: api|worker\n#   Execution: sync\n# Role: Pre-execution cost simulation (M5)\n# Authority: Feasibility decisions (budget, permission, risk)\n# Callers: API runtime, workers (pre-run checks)\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: PIN-256 Phase E FIX-01\n#\n# Phase E FIX-01 Criteria Verification:\n# - Domain Decision: YES (cost/feasibility classification)\n# - Semantic Stability: YES (same plan = same result)","\nPre-Execution Cost Simulator (M5) - L4 Domain Orchestrator\n\nCost and feasibility simulation for workflow plans before execution.\n\nProvides:\n1. Cost estimation based on skill metadata\n2. Latency estimation\n3. Budget feasibility check\n4. Permission validation\n5. Risk assessment\n\nDesign Principles:\n- Offline-first: Uses static skill metadata, no execution\n- Conservative: Estimates tend toward upper bounds\n- Deterministic: Same plan produces same simulation result\n",,NEEDS_CLASSIFICATION,ITERATION_1,In worker/ dir,TRANSFER
984,app/workers/business_builder/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Business builder worker package marker\n# Callers: Worker imports\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: Package Structure\n\n# Business Builder Worker v0.2\n# The first worker that demonstrates M0-M20 moats\n""""""\nBusiness Builder: Idea -> Research -> Strategy -> Build -> Launch","\nBusiness Builder: Idea -> Research -> Strategy -> Build -> Launch\n\nUses:\n- M4: Deterministic execution engine\n- M9: Failure pattern catalog\n- M10: Recovery suggestion engine\n- M11: Skills (webhook, embed, kv_store)\n- M12: Multi-agent coordination\n- M15: Strategy-Bound Agents (SBA)\n- M17: CARE routing engine\n- M18: Drift detection & reputation\n- M19: Policy constitutional\n- M20: PLang compiler & runtime\n",,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
985,app/workers/business_builder/agents/__init__.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/__init__.py,"# Business Builder Worker Agents\n# Agent definitions using M15 SBA Schema\n""""""\nEach agent has a Strategy Cascade that:\n1. Defines WHY the agent exists (winning_aspiration)\n2. Defines BOUNDARIES (where_to_play)\n3. Defines TASKS (how_to_win)\n4. Defines DEPENDENCIES (capabilities_capacity)\n5. Defines GOVERNANCE (enabling_management_systems)\n\nThese agents are:\n- Registered via M12 agent registry\n- Routed via M17 CARE engine\n- Governed via M19 policy layer\n- Evolved via M18 CARE-L",\nEach agent has a Strategy Cascade that:\n1. Defines WHY the agent exists (winning_aspiration)\n2. Defines BOUNDARIES (where_to_play)\n3. Defines TASKS (how_to_win)\n4. Defines DEPENDENCIES (capabilities_capacity)\n5. Defines GOVERNANCE (enabling_management_systems)\n\nThese agents are:\n- Registered via M12 agent registry\n- Routed via M17 CARE engine\n- Governed via M19 policy layer\n- Evolved via M18 CARE-L\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/auth/mappings/__init__.py,SKIP_INIT_COLLISION
986,app/workers/business_builder/agents/definitions.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/definitions.py,"# Layer: L4 — Domain Engine\n# Product: product-builder\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Business builder agent definitions\n# Callers: business_builder worker\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Business Builder\n\n# Agent Definitions for Business Builder Worker\n# Uses M15 SBA Schema for strategy-bound execution\n""""""\nEach agent definition creates a complete Strategy Cascade:",\nEach agent definition creates a complete Strategy Cascade:\n- Winning Aspiration: WHY the agent exists\n- Where to Play: BOUNDARIES\n- How to Win: TASKS\n- Capabilities & Capacity: DEPENDENCIES\n- Enabling Management Systems: GOVERNANCE\n\nThese are registered with M12 and routed by M17.\n,,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
987,app/workers/business_builder/cli.py,INTERNAL,account,L5,app/houseofcards/internal/account/engines/cli.py,"# Layer: L7 — Ops & Deployment\n# Product: product-builder\n# Temporal:\n#   Trigger: user (CLI)\n#   Execution: sync\n# Role: Business builder CLI\n# Callers: shell\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Business Builder\n\n# CLI commands for Business Builder Worker\n""""""\nUsage:\n    # Run worker locally","\nUsage:\n    # Run worker locally\n    python -m app.workers.business_builder.cli build-business ""AI tool for podcasters""         --brand brand.json         --budget 3000         --strict\n\n    # Run worker via hosted API\n    python -m app.workers.business_builder.cli build-business ""AI tool for podcasters""         --api https://api.agenticverz.com         --api-key AGZ_live_xxx\n\n    # Replay previous execution\n    python -m app.workers.business_builder.cli replay token.json\n\n    # Inspect executio",,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
988,app/workers/business_builder/execution_plan.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/execution_plan.py,"# Layer: L4 — Domain Engine\n# Product: product-builder\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Business builder execution planning\n# Callers: business_builder worker\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Business Builder\n\n# Execution Plan for Business Builder Worker\n# Defines stages that map to M4 execution engine\n""""""\nExecution plan with governance-aware stages.",\nExecution plan with governance-aware stages.\n\nEach stage:\n1. Routes via CARE (M17) based on complexity\n2. Validates via Policy (M19/M20)\n3. Recovers via M9/M10 on failure\n4. Updates reputation via M18\n\nStages execute in governance order (SAFETY -> PRIVACY -> OPERATIONAL -> ROUTING -> CUSTOM)\n,,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
989,app/workers/business_builder/llm_service.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/llm_service.py,"# Layer: L3 — Boundary Adapter\n# Product: product-builder\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: LLM service adapter for business builder\n# Callers: business_builder stages\n# Allowed Imports: L4, L6\n# Forbidden Imports: L1, L2, L5\n# Reference: Business Builder\n\n# Worker LLM Service\n""""""\nLLM Service for Business Builder Worker v0.3\n","\nLLM Service for Business Builder Worker v0.3\n\nProvides:\n- Real LLM calls via Claude adapter\n- Stage-specific prompt templates\n- Token tracking for cost reporting\n- Deterministic execution support\n\nUsage:\n    service = WorkerLLMService()\n    result = await service.research(task, brand)\n    result = await service.generate_copy(brand, research_output)\n    result = await service.generate_ux(brand, copy_output)\n",,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
990,app/workers/business_builder/schemas/__init__.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/__init__.py,"# Worker schemas\nfrom .brand import BrandSchema, ForbiddenClaim, ToneRule\n\n__all__ = [""BrandSchema"", ""ToneRule"", ""ForbiddenClaim""]",,,NEEDS_CLASSIFICATION,ITERATION_1,HOC version already exists,SKIP_HOC_EXISTS
991,app/workers/business_builder/schemas/brand.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/brand.py,"# Layer: L6 — Platform Substrate\n# Product: product-builder\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Brand schema definitions\n# Callers: business_builder/*\n# Allowed Imports: None (foundational)\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Business Builder\n\n# Brand Schema for Business Builder Worker\n# Defines brand constraints that SBA agents must adhere to\n""""""\nBrand schema that triggers:",\nBrand schema that triggers:\n- M15: Strategy binding (agents must follow brand rules)\n- M18: Drift detection (outputs compared against brand embeddings)\n- M19: Policy governance (forbidden claims enforcement)\n,,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
992,app/workers/business_builder/stages/__init__.py,INTERNAL,logs,L5,app/houseofcards/internal/logs/engines/__init__.py,"# Layer: L5 — Execution & Workers\n# Product: system-wide\n# Temporal:\n#   Trigger: import-time\n#   Execution: sync\n# Role: Business builder stages package marker\n# Callers: Stage imports\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: Package Structure\n\n# Stage implementations for Business Builder Worker\n# Each stage can have custom logic beyond agent execution\n""""""\nStages provide:",\nStages provide:\n1. Input validation\n2. Output transformation\n3. Integration with external services\n4. Custom failure patterns\n,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/worker/orchestration/__init__.py,SKIP_INIT_COLLISION
993,app/workers/business_builder/stages/copy.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/copy.py,"# Layer: L4 — Domain Engine\n# Product: product-builder\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Copy generation stage\n# Callers: business_builder worker\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Business Builder\n\n# Copy Generation Stage Implementation\n""""""\nCopywriting stage that uses:\n- M15: SBA for tone enforcement",\nCopywriting stage that uses:\n- M15: SBA for tone enforcement\n- M18: Drift detection for brand consistency\n- M19: Forbidden claims policy enforcement\n,,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
994,app/workers/business_builder/stages/research.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/research.py,"# Layer: L4 — Domain Engine\n# Product: product-builder\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Research stage\n# Callers: business_builder worker\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Business Builder\n\n# Research Stage Implementation\n""""""\nMarket research stage that uses:\n- M11: web_search skill",\nMarket research stage that uses:\n- M11: web_search skill\n- M17: CARE routing for depth selection\n- M9: Failure patterns for hallucination detection\n,,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
995,app/workers/business_builder/stages/strategy.py,INTERNAL,policies,L5,app/houseofcards/internal/policies/engines/strategy.py,"# Layer: L4 — Domain Engine\n# Product: product-builder\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Strategy generation stage\n# Callers: business_builder worker\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Business Builder\n\n# Strategy Stage Implementation\n""""""\nBrand strategy stage that uses:\n- M15: SBA for brand constraint binding",\nBrand strategy stage that uses:\n- M15: SBA for brand constraint binding\n- M18: Drift detection against brand anchors\n- M19: Policy validation for forbidden claims\n,,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
996,app/workers/business_builder/stages/ux.py,INTERNAL,agent,L5,app/houseofcards/internal/agent/engines/ux.py,"# Layer: L4 — Domain Engine\n# Product: product-builder\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: UX generation stage\n# Callers: business_builder worker\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L5\n# Reference: Business Builder\n\n# UX Layout Generation Stage Implementation\n""""""\nUX stage that generates HTML/CSS landing pages.\nUses:",\nUX stage that generates HTML/CSS landing pages.\nUses:\n- M15: SBA for brand visual constraints\n- M18: Drift detection for visual consistency\n,,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
997,app/workers/business_builder/worker.py,INTERNAL,integrations,L5,app/houseofcards/internal/integrations/engines/worker.py,"# Layer: L5 — Execution & Workers\n# Product: product-builder\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Business builder main worker\n# Callers: worker pool\n# Allowed Imports: L6\n# Forbidden Imports: L1, L2, L3, L4\n# Reference: Business Builder\n\n# Business Builder Worker v0.3\n# Main entry point that integrates M0-M20 moats with REAL event emission\n""""""\nThe Business Builder Worker v0.3 - Real MOAT Integration","\nThe Business Builder Worker v0.3 - Real MOAT Integration\n\nExecutes stages and emits REAL events from actual M0-M20 integrations:\n- M4:  Deterministic execution via ExecutionPlan + golden replay\n- M9:  Failure pattern detection via FailureCatalog\n- M10: Recovery suggestion via RecoveryEngine\n- M11: Skills (llm_invoke, webhook, embedding)\n- M12: Multi-agent coordination\n- M15: Strategy-Bound Agents via SBASchema\n- M17: CARE routing (complexity-aware) - REAL routing decisions\n- M18: Drift detectio",,NEEDS_CLASSIFICATION,ITERATION_1,In workers/ dir,TRANSFER
998,app/workflow/__init__.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/__init__.py,"# Workflow Engine Module (M4 + Hardening)\n# Deterministic multi-step workflow execution with checkpoints, resume, and replay\n\nfrom .canonicalize import (\n    DEFAULT_VOLATILE_FIELDS,\n    SENSITIVE_FIELDS,\n    canonical_hash,\n    canonical_json,\n    canonicalize_for_golden,\n    compare_canonical,\n    redact_sensitive_fields,\n    strip_volatile_from_events,\n)\nfrom .checkpoint import (\n    CheckpointData,",,,NEEDS_CLASSIFICATION,ITERATION_1,Init collision - keeping app/domain/__init__.py,SKIP_INIT_COLLISION
999,app/workflow/canonicalize.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/canonicalize.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Workflow input/output canonicalization\n# Callers: workflow engine\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Workflow System\n\n# Golden File Canonicalization (M4 Hardening)\n""""""\nCanonicalization utilities for deterministic golden file comparison.\n","\nCanonicalization utilities for deterministic golden file comparison.\n\nProvides:\n1. Volatile field removal (timestamps, ephemeral IDs)\n2. Float precision normalization\n3. Key ordering for deterministic JSON\n4. Sensitive field redaction\n5. Key normalization (lowercase, collision-safe)\n\nDesign Principles:\n- Deterministic: Same logical content produces same canonical form\n- Configurable: Ignore fields can be customized per use case\n- Auditable: Redacted fields are marked, not silently removed\n- Cas",,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1000,app/workflow/checkpoint.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/checkpoint.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Workflow checkpoint persistence and recovery\n# Authority: Checkpoint state mutation (optimistic locking via version)\n# Callers: workflow engine\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Contract: EXECUTION_SEMANTIC_CONTRACT.md (Guarantee 4: Exactly-Once Step Execution)\n\n# Checkpoint Store (M4 + Hardening)\n""""""\nDB-backed checkpoint store for workflow resume-on-restart.","\nDB-backed checkpoint store for workflow resume-on-restart.\n\nProvides:\n1. Atomic checkpoint save/load with optimistic locking\n2. Step output persistence for dependency resolution\n3. Status tracking (running, completed, aborted, failed)\n4. Content hashing for replay verification\n5. Version-based concurrency control\n\nDesign:\n- Checkpoints are keyed by run_id (primary key)\n- Step outputs stored as JSON for resuming with dependencies\n- Uses SQLModel for type safety and migrations\n- Optimistic lockin",,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1001,app/workflow/engine.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/engine.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: async\n# Role: Deterministic workflow execution engine\n# Callers: workers, runtime service\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Workflow System\n\n# Workflow Engine (M4)\n""""""\nDeterministic Workflow Engine for multi-step execution.\n","\nDeterministic Workflow Engine for multi-step execution.\n\nDesign Principles (aligned with PIN-005 Machine-Native Architecture):\n1. Deterministic execution - same inputs produce same outputs\n2. Checkpoint & resume - workflows survive restarts\n3. Golden-file pipeline - CI gates on replay fidelity\n4. Per-step policy enforcement - budget, rate limits, sandbox validation\n5. Structured outcomes - never throws, always returns data\n\nUsage:\n    engine = WorkflowEngine(registry, checkpoint_store, golden)\n",,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1002,app/workflow/errors.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/errors.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Workflow error types and classification\n# Callers: workflow engine, steps\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Workflow System\n\n# Workflow Error Taxonomy (M4 Hardening)\n""""""\nCanonical error codes and taxonomy for workflow execution.\n",\nCanonical error codes and taxonomy for workflow execution.\n\nProvides:\n1. Structured error codes with categories\n2. Retry policies per error type\n3. HTTP status code mapping\n4. Recovery suggestions\n\nDesign Principles:\n- Deterministic: Same error conditions produce same codes\n- Actionable: Each code has clear recovery path\n- Auditable: Codes are logged and tracked in golden files\n,,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1003,app/workflow/external_guard.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/external_guard.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: External call guards for workflow safety\n# Callers: workflow engine\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Workflow System\n\n# External Calls Guard (M4 Hardening)\n""""""\nGuard for blocking external network calls during golden file tests.\n",\nGuard for blocking external network calls during golden file tests.\n\nProvides:\n1. Environment variable control for CI\n2. Socket patching for test isolation\n3. Request interception for debugging\n\nUsage in CI:\n    DISABLE_EXTERNAL_CALLS=1 pytest tests/workflow/\n\nUsage in tests:\n    from app.workflow.external_guard import ExternalCallsGuard\n\n    def test_golden_replay():\n        with ExternalCallsGuard():\n            # All external calls will raise ExternalCallBlockedError\n            run_workflow,,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1004,app/workflow/golden.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/golden.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Golden file validation for replay fidelity\n# Callers: workflow engine, CI\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Workflow System\n\n# Golden-File Pipeline (M4)\n""""""\nGolden-file recorder and verifier for workflow replay testing.\n",\nGolden-file recorder and verifier for workflow replay testing.\n\nProvides:\n1. Step-by-step recording during execution\n2. HMAC signing for tamper detection\n3. Replay verification against recorded golden files\n4. CI-ready diffing for merge gates\n\nDesign Principles:\n- Deterministic recording: same execution produces same golden file\n- Signed artifacts: HMAC protects against tampering\n- CI integration: diffs block merges on mismatch\n,,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1005,app/workflow/health.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/health.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: scheduler\n#   Execution: sync\n# Role: Workflow health checks and status\n# Callers: monitoring, health endpoints\n# Allowed Imports: None\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Observability\n\n# Workflow Engine Health Endpoints (M4 Hardening)\n""""""\nHealth and readiness endpoints for workflow engine.\n",\nHealth and readiness endpoints for workflow engine.\n\nProvides:\n1. /workflow/healthz - Liveness check (always returns OK if process is alive)\n2. /workflow/readyz - Readiness check (verifies checkpoint store and golden writer)\n3. /workflow/status - Detailed status with metrics\n\nDesign Principles:\n- Fail-fast: Return 503 immediately if not ready\n- Lightweight: No expensive operations in health checks\n- Observable: Include diagnostic info for debugging\n,,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1006,app/workflow/logging_context.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/logging_context.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Workflow logging context management\n# Callers: workflow engine, steps\n# Allowed Imports: None\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Observability\n\n# M4-T5: Observability Deepening - Logging Context\n""""""\nStructured logging context for workflow execution.\n","\nStructured logging context for workflow execution.\n\nProvides:\n1. Correlation ID propagation across all workflow operations\n2. Structured logging with run_id, step_id, agent_id\n3. Context manager for scoped logging\n4. Thread-safe context storage using contextvars\n\nUsage:\n    with WorkflowLoggingContext(run_id=""run-123"", agent_id=""agent-456""):\n        logger.info(""Step executed"", extra=get_logging_context())\n",,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1007,app/workflow/metrics.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/metrics.py,"# Layer: L6 — Platform Substrate\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Workflow Prometheus metrics instrumentation\n# Callers: workflow engine\n# Allowed Imports: None\n# Forbidden Imports: L1, L2, L3, L4, L5\n# Reference: Observability\n\n# Workflow Engine Metrics (M4 Hardening)\n""""""\nPrometheus metrics for workflow engine observability.\n","\nPrometheus metrics for workflow engine observability.\n\nProvides:\n1. Error code counters by spec_id and tenant\n2. Checkpoint operation metrics\n3. Golden replay verification metrics\n4. Step execution timing\n\nDesign Principles:\n- Low cardinality: Hash tenant_ids, limit label values\n- Actionable: Every metric should enable an alert or dashboard\n- Deterministic: Same errors produce same metric labels\n",,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1008,app/workflow/planner_sandbox.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/planner_sandbox.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Sandboxed planner execution for safety\n# Callers: workflow engine\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Workflow System\n\n# Planner Sandbox (M4)\n""""""\nSandbox for validating planner outputs before execution.\n","\nSandbox for validating planner outputs before execution.\n\nProvides:\n1. Forbidden skill detection (shell_exec, db_drop, etc.)\n2. Idempotency validation for side-effect operations\n3. Input sanitization checks\n4. Contract compliance verification\n\nDesign Principles:\n- Fail-fast: Reject invalid plans before execution\n- Zero trust: Validate all planner outputs\n- Explicit contracts: Skills must declare their capabilities\n",,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER
1009,app/workflow/policies.py,INTERNAL,platform,L5,app/houseofcards/internal/platform/engines/policies.py,"# Layer: L4 — Domain Engine\n# Product: system-wide\n# Temporal:\n#   Trigger: worker\n#   Execution: sync\n# Role: Workflow policy enforcement\n# Callers: workflow engine\n# Allowed Imports: L5, L6\n# Forbidden Imports: L1, L2, L3\n# Reference: Workflow System\n\n# Policy Enforcer (M4)\n""""""\nPer-step policy enforcement for workflow execution.\n","\nPer-step policy enforcement for workflow execution.\n\nProvides:\n1. Budget ceiling enforcement (per-step, per-workflow, per-tenant)\n2. Rate limit checks\n3. Idempotency validation\n4. Emergency stop controls\n\nIntegrates with existing BudgetTracker from Phase 5.\n\nDesign Principles:\n- Fail-fast: Reject before execution, not after\n- Deterministic: Same inputs produce same policy decisions\n- Zero hidden state: All decisions are based on explicit contracts\n- Multi-worker safe: Budget tracking via shared",,NEEDS_CLASSIFICATION,ITERATION_1,Workflow logic,TRANSFER

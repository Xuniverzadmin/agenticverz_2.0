# =============================================================================
# CAPABILITY REGISTRY — Single Source of Truth
# =============================================================================
#
# Reference: PIN-306 (Capability Registry Governance)
# Created: 2026-01-05
# Version: 1.0.0
#
# INVARIANTS:
#   - No capability exists unless registered here
#   - No UI expansion without governance.ui_expansion_allowed = true
#   - No lifecycle promotion without closure_requirements met
#   - No code without capability_id linkage
#
# =============================================================================

registry_version: "1.0.1"
schema_version: "1.0.0"
last_updated: "2026-01-06"
updated_by: "claude+founder"
pin_reference: "PIN-323"

# =============================================================================
# SECTION 1: ALLOWED ENUMS (LOCKED VOCABULARY)
# =============================================================================

enums:
  lifecycle_states:
    - PLANNED        # Intent declared, no code
    - PARTIAL        # Code exists, not all planes complete
    - READ_ONLY      # Can read/query, cannot mutate
    - CLOSED         # All planes complete, all requirements met
    - FROZEN         # Closed + no changes without founder approval
    - QUARANTINED    # Disabled, pending decision (delete or fix)

  capability_planes:
    - engine         # L4 domain logic exists
    - l2_api         # L2 API endpoints exist
    - client         # Frontend API client exists
    - ui             # Frontend UI pages exist
    - authority      # Governance/permission wiring exists
    - audit_replay   # Audit trail and replay support exists

  gap_types:
    - UNREGISTERED_CODE      # Code exists without registry entry
    - PLANE_ASYMMETRY        # Some planes true, others false
    - LIFECYCLE_INCOMPLETE   # Closure requirements not met
    - MISSING_AUTHORITY      # UI/API exists without governance wiring
    - MISSING_AUDIT          # Mutations without audit trail
    - STUBBED_INFRA          # Infrastructure code exists but not wired
    - INTENTIONALLY_ABSENT   # Explicitly not implemented (by design)

# =============================================================================
# SECTION 2: CAPABILITY ENTRIES
# =============================================================================

capabilities:

  # ---------------------------------------------------------------------------
  # CAP-001: REPLAY
  # ---------------------------------------------------------------------------
  replay:
    capability_id: CAP-001
    name: "Execution Replay"
    description: "Replay past executions for audit and debugging"
    owner: platform

    planes:
      engine: true           # /backend/app/traces/replay.py
      l2_api: true           # POST /guard/replay/{call_id}, POST /runtime/replay/{run_id}
      client: true           # /website/aos-console/console/src/api/replay.ts (PIN-311)
      ui: true               # ReplayResultsModal.tsx in Incidents
      authority: true        # RBAC v2 via authority.py (PIN-307+)
      audit_replay: true     # Replay itself is the audit mechanism

    lifecycle:
      state: CLOSED          # PIN-311: Client exists, all planes complete
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: true  # PIN-311: replay.ts exists
        ui_complete: true
        authority_wired: true   # RBAC v2 require_replay_execute on all routes
        audit_enabled: true

    governance:
      ui_expansion_allowed: true   # Authority complete, ready for expansion
      promotion_blocked_by: []     # PIN-311: All requirements met
      founder_approval_required: true

    evidence:
      engine: "/backend/app/traces/replay.py"
      l2_api:
        - "/backend/app/api/guard.py:replay_call"
        - "/backend/app/api/runtime.py:replay_run"
        - "/backend/app/api/workers.py:replay_execution_endpoint"
        - "/backend/app/api/v1_killswitch.py:replay_call"
        - "/backend/app/api/customer_activity.py"       # PIN-311: Unmapped file resolution
        - "/backend/app/api/guard_logs.py"              # PIN-311: Unmapped file resolution
        - "/backend/app/api/status_history.py"          # PIN-311: Unmapped file resolution
        - "/backend/app/api/replay.py"                  # PIN-311: Replay UX API (READ-ONLY)
        - "/backend/app/api/traces.py"                  # PIN-311: Trace storage/indexing
      client: "/website/aos-console/console/src/api/replay.ts"  # PIN-311: Client exists
      ui: "/website/aos-console/console/src/components/ReplayResultsModal.tsx"
      authority:
        - "/backend/app/auth/authority.py:require_replay_execute"
        - "/docs/governance/PERMISSION_TAXONOMY_V1.md:replay"

    gaps: []  # PIN-311: No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-002: COST SIMULATION
  # ---------------------------------------------------------------------------
  cost_simulation:
    capability_id: CAP-002
    name: "Cost Simulation V2"
    description: "Simulate execution costs before running"
    owner: platform

    planes:
      engine: true           # /backend/app/costsim/
      l2_api: true           # POST /costsim/v2/simulate, GET /costsim/divergence
      client: true           # /website/aos-console/console/src/api/costsim.ts
      ui: false              # N/A - programmatic capability, no user-facing UI required
      authority: true        # Circuit breaker governance
      audit_replay: true     # PIN-313: ProvenanceLog provides full audit trail

    lifecycle:
      state: CLOSED          # PIN-313: All requirements met
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: true
        ui_complete: true    # N/A - programmatic capability
        authority_wired: true
        audit_enabled: true  # PIN-313: ProvenanceLog persists to costsim_provenance table

    governance:
      ui_expansion_allowed: true   # Ready for UI if needed
      promotion_blocked_by: []     # PIN-313: No blockers
      founder_approval_required: false

    evidence:
      engine: "/backend/app/costsim/"
      l2_api:
        - "/backend/app/api/costsim.py"
        - "/backend/app/api/cost_guard.py"              # PIN-311: Unmapped file resolution
        - "/backend/app/api/cost_intelligence.py"       # PIN-311: Unmapped file resolution
        - "/backend/app/api/scenarios.py"               # PIN-311: H2 cost simulation
        - "/backend/app/api/v1_proxy.py"                # PIN-311: M22 KillSwitch proxy with budget enforcement
      client: "/website/aos-console/console/src/api/costsim.ts"
      audit_replay:                                     # PIN-313: Audit evidence
        - "/backend/app/costsim/provenance.py"          # ProvenanceLog dataclass
        - "/backend/app/costsim/provenance_async.py"    # Async DB persistence
        - "/backend/app/models/costsim_cb.py"           # CostSimProvenanceModel (costsim_provenance table)

    gaps: []  # PIN-313: No gaps - CLOSED

    notes: >
      PIN-313: Audit capability via ProvenanceLog was discovered during gap closure.
      Every simulation is logged with input_hash, output_hash, full payloads (compressed),
      model/adapter versions, commit SHA, and runtime metrics. DB-persisted to
      costsim_provenance table. UI plane marked N/A as this is a programmatic/advisory
      capability accessed via API/SDK, not user-facing dashboard.

  # ---------------------------------------------------------------------------
  # CAP-003: POLICY PROPOSALS
  # ---------------------------------------------------------------------------
  policy_proposals:
    capability_id: CAP-003
    name: "Policy Proposals"
    description: "View and manage policy change proposals (READ-ONLY advisory)"
    owner: platform

    planes:
      engine: true           # Policy proposal logic exists
      l2_api: true           # GET /api/v1/policy-proposals/
      client: false          # N/A - programmatic/internal capability
      ui: false              # N/A - proposals viewed in founder console, not dedicated UI
      authority: true        # Read-only authority
      audit_replay: true     # PIN-313: Proposal records include provenance (triggering_feedback_ids)

    lifecycle:
      state: READ_ONLY       # PIN-313: READ_ONLY is CORRECT final state by design
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: true   # N/A - internal capability
        ui_complete: true       # N/A - viewed via founder console
        authority_wired: true
        audit_enabled: true     # PIN-313: Provenance via triggering_feedback_ids

    governance:
      ui_expansion_allowed: true
      promotion_blocked_by: []  # PIN-313: READ_ONLY is the intended final state
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/services/policy/"
        - "/backend/app/services/policy_proposal.py"  # PIN-313: Create/list proposals
      l2_api: "/backend/app/api/policy_proposals.py"
      model: "/backend/app/models/policy.py"          # PIN-313: PolicyProposal model

    gaps: []  # PIN-313: No gaps - READ_ONLY is correct final state

    notes: >
      PIN-313: Origination semantics exist via PolicyProposal model:
      - proposal_type: rate_limit | cost_cap | retry_policy (origin type)
      - triggering_feedback_ids: JSONB provenance to source feedback
      - tenant_id: scope
      PB-S4 invariant: "Proposals never mutate policies. Human approval mandatory."
      READ_ONLY is the correct final state - no creation flow is intentional,
      proposals are generated by analytics engine (PB-S3) not user creation.

  # ---------------------------------------------------------------------------
  # CAP-004: PREDICTION PLANE (C2)
  # ---------------------------------------------------------------------------
  prediction_plane:
    capability_id: CAP-004
    name: "C2 Prediction Plane"
    description: "ML predictions for cost, risk, optimization (READ-ONLY advisory)"
    owner: platform

    planes:
      engine: true           # /backend/app/predictions/
      l2_api: true           # GET /api/v1/predictions/* (4 endpoints)
      client: false          # No API client
      ui: false              # No UI found
      authority: true        # RBAC v2 via authority.py (PIN-307+)
      audit_replay: true     # Authority audit via emit_authority_audit

    lifecycle:
      state: READ_ONLY       # Predictions are read-only advisory (PB-S5)
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: false   # N/A - API consumed directly
        ui_complete: false       # N/A - Advisory signals, no UI needed
        authority_wired: true    # RBAC v2 require_predictions_read on all routes
        audit_enabled: true      # emit_authority_audit on all endpoints

    governance:
      ui_expansion_allowed: true   # Authority complete, ready for UI if needed
      promotion_blocked_by: []     # READ_ONLY is appropriate for advisory predictions
      founder_approval_required: true

    evidence:
      engine: "/backend/app/predictions/"
      l2_api:
        - "/backend/app/api/predictions.py:list_predictions"
        - "/backend/app/api/predictions.py:get_prediction"
        - "/backend/app/api/predictions.py:get_predictions_for_subject"
        - "/backend/app/api/predictions.py:get_prediction_stats"
      authority:
        - "/backend/app/auth/authority.py:require_predictions_read"
        - "/docs/governance/PERMISSION_TAXONOMY_V1.md:predictions"

    gaps: []  # No gaps - READ_ONLY is complete for advisory predictions

    notes: >
      PIN-313: Visibility-only RBAC confirmed. Authority model is defined:
      - require_predictions_read enforces READ permission on all endpoints
      - Tenant/project scope via ActorContext
      - No execution capability (READ_ONLY advisory by design)
      - All access decisions audited via emit_authority_audit
      PB-S5 invariant (PIN-205): "Predictions are informational only.
      Predictions have zero side-effects. Predictions never modify
      execution, scheduling, or history."

  # ---------------------------------------------------------------------------
  # CAP-005: FOUNDER CONSOLE
  # ---------------------------------------------------------------------------
  founder_console:
    capability_id: CAP-005
    name: "Founder Console"
    description: "Founder-only operations and timeline"
    owner: founder

    planes:
      engine: true           # Founder actions, timeline services
      l2_api: true           # /founder/*, /ops/*
      client: true           # /api/ops.ts exists
      ui: true               # 5 pages in /pages/founder/ and /pages/ops/
      authority: true        # Founder-only RBAC
      audit_replay: true     # Founder actions audited

    lifecycle:
      state: CLOSED          # PIN-311: Routes verified wired in main.py
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: true
        ui_complete: true
        authority_wired: true
        audit_enabled: true
        routing_wired: true    # PIN-311: Verified - all founder routes wired in main.py

    governance:
      ui_expansion_allowed: true
      promotion_blocked_by: []  # PIN-311: All requirements met
      founder_approval_required: true

    evidence:
      l2_api:
        - "/backend/app/api/founder_actions.py"
        - "/backend/app/api/founder_review.py"
        - "/backend/app/api/founder_timeline.py"
        - "/backend/app/api/ops.py"
        - "/backend/app/api/cost_ops.py"                # PIN-311: Unmapped file resolution (FOPS auth)
        - "/backend/app/api/founder_explorer.py"        # PIN-311: H3 Founder Exploratory Mode
        - "/backend/app/api/platform.py"                # PIN-311: Platform health/eligibility (Founder-only)
      client: "/website/aos-console/console/src/api/ops.ts"
      ui:
        - "/website/aos-console/console/src/pages/founder/FounderControlsPage.tsx"
        - "/website/aos-console/console/src/pages/founder/FounderTimelinePage.tsx"
        - "/website/aos-console/console/src/pages/ops/FounderOpsConsole.tsx"
        - "/website/aos-console/console/src/pages/ops/FounderPulsePage.tsx"
        - "/website/aos-console/console/src/pages/ops/OpsConsoleEntry.tsx"

    gaps: []  # PIN-311: No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-006: AUTHENTICATION (Auth Gateway)
  # ---------------------------------------------------------------------------
  authentication:
    capability_id: CAP-006
    name: "Authentication"
    description: "Central auth gateway with JWT (human) and API key (machine) flows"
    owner: platform

    planes:
      engine: true           # /backend/app/auth/gateway.py - central entry point
      l2_api: true           # Auth middleware wired to main.py
      client: false          # No frontend auth client (delegated to Clerk)
      ui: false              # No login UI (delegated to Clerk)
      authority: true        # Invariant guards, route plane enforcement
      audit_replay: true     # gateway_audit.py emits all auth events

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: false   # N/A - delegated to Clerk
        ui_complete: false       # N/A - delegated to Clerk
        authority_wired: true    # Invariants enforced in gateway
        audit_enabled: true      # gateway_audit.py emits events
        gateway_wired: true      # Gateway middleware wired in main.py

    governance:
      ui_expansion_allowed: false
      promotion_blocked_by: []   # All requirements met
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/auth/gateway.py"          # Central auth entry point
        - "/backend/app/auth/contexts.py"         # HumanAuthContext, MachineCapabilityContext
        - "/backend/app/auth/gateway_types.py"    # GatewayResult, GatewayAuthError
        - "/backend/app/auth/clerk_provider.py"   # JWT verification
        - "/backend/app/auth/api_key_service.py"  # API key verification
        - "/backend/app/auth/session_store.py"    # Session revocation (Redis)
      l2_api:
        - "/backend/app/auth/gateway_middleware.py"  # FastAPI middleware
        - "/backend/app/auth/gateway_config.py"      # Gateway initialization
        - "/backend/app/api/onboarding.py"           # PIN-311: Unmapped file resolution
        - "/backend/app/api/auth_helpers.py"         # PIN-311: Console auth verification helpers
      authority:
        - "/backend/app/auth/invariants.py"       # Invariant guards (I1-I5)
        - "/backend/app/auth/route_planes.py"     # Route plane declarations
      audit: "/backend/app/auth/gateway_audit.py"

    gaps: []  # No gaps - CLOSED

    # Technical debt tracked separately:
    # - Legacy auth files grandfathered in CI (see capability_registry_enforcer.py)
    # - RBACv1 files to be migrated when RBACv2 promoted

  # ---------------------------------------------------------------------------
  # CAP-007: AUTHORIZATION (M28 RBAC v2)
  # ---------------------------------------------------------------------------
  authorization:
    capability_id: CAP-007
    name: "Authorization (RBAC v2)"
    description: "Role-based access control and permission taxonomy"
    owner: platform

    planes:
      engine: true           # /backend/app/auth/rbac*.py
      l2_api: true           # RBAC middleware on all routes
      client: false          # No dedicated client
      ui: false              # No RBAC management UI
      authority: true        # Self-referential (is the authority)
      audit_replay: true     # shadow_audit.py

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: false   # N/A for RBAC
        ui_complete: false       # N/A for RBAC
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: false
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/auth/rbac.py"
        - "/backend/app/auth/rbac_engine.py"
        - "/backend/app/auth/authorization.py"
      l2_api:
        - "/backend/app/auth/rbac_middleware.py"
        - "/backend/app/api/rbac_api.py"                 # PIN-311: RBAC management API
        - "/backend/app/api/authz_status.py"             # PIN-311: Authorization status endpoint
      audit: "/backend/app/auth/shadow_audit.py"

    gaps: []  # No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-008: M12 MULTI-AGENT ORCHESTRATION
  # ---------------------------------------------------------------------------
  multi_agent:
    capability_id: CAP-008
    name: "M12 Multi-Agent Orchestration"
    description: "Agent job execution, blackboard, credits, messaging"
    owner: platform

    planes:
      engine: true           # /backend/app/agents/
      l2_api: true           # /api/agents.py
      client: false          # No dedicated client
      ui: false              # No multi-agent UI
      authority: true        # governance_service.py
      audit_replay: true     # invoke_audit_service.py

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: false   # Internal capability
        ui_complete: false       # Internal capability
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: false
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/agents/services/job_service.py"
        - "/backend/app/agents/services/worker_service.py"
        - "/backend/app/agents/services/blackboard_service.py"
        - "/backend/app/agents/services/credit_service.py"
        - "/backend/app/agents/services/message_service.py"
        - "/backend/app/agents/services/registry_service.py"
        - "/backend/app/agents/services/governance_service.py"
        - "/backend/app/agents/services/invoke_audit_service.py"
      l2_api: "/backend/app/api/agents.py"
      skills:
        - "/backend/app/agents/skills/agent_invoke.py"
        - "/backend/app/agents/skills/agent_spawn.py"
        - "/backend/app/agents/skills/blackboard_ops.py"
        - "/backend/app/agents/skills/llm_invoke_governed.py"

    gaps: []  # No gaps - CLOSED (internal capability)

  # ---------------------------------------------------------------------------
  # CAP-009: M19 POLICY ENGINE
  # ---------------------------------------------------------------------------
  policy_engine:
    capability_id: CAP-009
    name: "M19 Policy Engine"
    description: "Constitutional policy evaluation and enforcement"
    owner: platform

    planes:
      engine: true           # /backend/app/policy/
      l2_api: true           # /api/policy.py, /api/policy_layer.py
      client: false          # No dedicated client
      ui: false              # Policies shown in Guard, no dedicated UI
      authority: true        # Self-referential (is the authority)
      audit_replay: true     # Policy decisions recorded

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: false   # API consumed by other services
        ui_complete: false       # Guard UI shows policies
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: true
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine: "/backend/app/policy/"
      l2_api:
        - "/backend/app/api/policy.py"
        - "/backend/app/api/policy_layer.py"
        - "/backend/app/api/guard_policies.py"
      adapters: "/backend/app/adapters/policy_adapter.py"

    gaps: []  # No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-010: M17 CARE-L ROUTING
  # ---------------------------------------------------------------------------
  care_routing:
    capability_id: CAP-010
    name: "M17 CARE-L Routing"
    description: "Cascade-aware agent routing with learning"
    owner: platform

    planes:
      engine: true           # /backend/app/routing/
      l2_api: false          # Internal routing, no direct API
      client: false          # N/A
      ui: false              # N/A
      authority: true        # Governor controls routing
      audit_replay: true     # Routing decisions recorded

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: false  # Internal capability
        client_complete: false
        ui_complete: false
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: false
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/routing/care.py"
        - "/backend/app/routing/governor.py"
        - "/backend/app/routing/learning.py"
        - "/backend/app/routing/feedback.py"
        - "/backend/app/routing/probes.py"

    gaps: []  # No gaps - CLOSED (internal capability)

  # ---------------------------------------------------------------------------
  # CAP-011: M28 GOVERNANCE ORCHESTRATION
  # ---------------------------------------------------------------------------
  governance_orchestration:
    capability_id: CAP-011
    name: "M28 Governance Orchestration"
    description: "Contract execution, audit workflows, eligibility"
    owner: platform

    planes:
      engine: true           # /backend/app/services/governance/
      l2_api: true           # /api/founder_review.py, /api/founder_actions.py
      client: false          # Founder console uses ops.ts
      ui: true               # Founder console pages
      authority: true        # Founder-only
      audit_replay: true     # Audit service

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: true  # Via ops.ts
        ui_complete: true      # Via founder console
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: true
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/services/governance/governance_orchestrator.py"
        - "/backend/app/services/governance/contract_service.py"
        - "/backend/app/services/governance/audit_service.py"
        - "/backend/app/services/governance/validator_service.py"
        - "/backend/app/services/governance/job_executor.py"
        - "/backend/app/services/governance/eligibility_engine.py"
      l2_api:
        - "/backend/app/api/discovery.py"                # PIN-311: Unmapped file resolution

    gaps: []  # No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-012: M4 WORKFLOW ENGINE
  # ---------------------------------------------------------------------------
  workflow_engine:
    capability_id: CAP-012
    name: "M4 Workflow Engine"
    description: "Deterministic workflow execution with checkpointing"
    owner: platform

    planes:
      engine: true           # /backend/app/workflow/
      l2_api: true           # Runtime APIs use workflow
      client: false          # Internal capability
      ui: false              # No dedicated UI
      authority: true        # Workflow policies enforced
      audit_replay: true     # Golden file testing, replay

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: false  # Internal
        ui_complete: false      # Internal
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: false
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/workflow/engine.py"
        - "/backend/app/workflow/checkpoint.py"
        - "/backend/app/workflow/golden.py"
        - "/backend/app/workflow/policies.py"

    gaps: []  # No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-013: M5 LEARNING PIPELINE
  # ---------------------------------------------------------------------------
  learning_pipeline:
    capability_id: CAP-013
    name: "M5 Learning Pipeline"
    description: "Learning from rollback, optimization suggestions"
    owner: platform

    planes:
      engine: true           # /backend/app/learning/
      l2_api: false          # Internal processing
      client: false          # Internal
      ui: false              # No UI
      authority: true        # Learning is governed
      audit_replay: true     # Learning decisions recorded

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: false  # Internal
        client_complete: false
        ui_complete: false
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: false
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/learning/s1_rollback.py"
        - "/backend/app/learning/suggestions.py"
        - "/backend/app/learning/config.py"
      l2_api:
        - "/backend/app/api/feedback.py"                 # PIN-311: PB-S3 Pattern Feedback (READ-ONLY)

    gaps: []  # No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-014: M7 MEMORY SYSTEM
  # ---------------------------------------------------------------------------
  memory_system:
    capability_id: CAP-014
    name: "M7 Memory System"
    description: "Agent memory, vector storage, drift detection"
    owner: platform

    planes:
      engine: true           # /backend/app/memory/
      l2_api: true           # /api/memory_pins.py
      client: false          # No dedicated client
      ui: false              # No dedicated UI
      authority: true        # Memory updates governed
      audit_replay: true     # Memory changes audited

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: false
        ui_complete: false
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: true
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/memory/memory_service.py"
        - "/backend/app/memory/store.py"
        - "/backend/app/memory/vector_store.py"
        - "/backend/app/memory/drift_detector.py"
      l2_api:
        - "/backend/app/api/memory_pins.py"
        - "/backend/app/api/embedding.py"                # PIN-311: Unmapped file resolution

    gaps: []  # No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-015: M22 OPTIMIZATION ENGINE
  # ---------------------------------------------------------------------------
  optimization_engine:
    capability_id: CAP-015
    name: "M22 Optimization Engine"
    description: "Multi-envelope optimization with killswitch"
    owner: platform

    planes:
      engine: true           # /backend/app/optimization/
      l2_api: false          # Internal processing
      client: false          # Internal
      ui: false              # No UI
      authority: true        # Optimization governed
      audit_replay: true     # Optimization decisions audited

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: false  # Internal
        client_complete: false
        ui_complete: false
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: false
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/optimization/coordinator.py"
        - "/backend/app/optimization/manager.py"
        - "/backend/app/optimization/envelope.py"
        - "/backend/app/optimization/killswitch.py"

    gaps: []  # No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-016: SKILL SYSTEM (M2/M3)
  # ---------------------------------------------------------------------------
  skill_system:
    capability_id: CAP-016
    name: "Skill System (M2/M3)"
    description: "Skill registration, execution, LLM adapters"
    owner: platform

    planes:
      engine: true           # /backend/app/skills/
      l2_api: true           # Skills exposed via runtime API
      client: false          # SDK consumes skills
      ui: false              # No skill management UI
      authority: true        # Skill execution governed
      audit_replay: true     # Skill calls audited

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: false  # SDK handles
        ui_complete: false
        authority_wired: true
        audit_enabled: true

    governance:
      ui_expansion_allowed: false
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/skills/base.py"
        - "/backend/app/skills/registry.py"
        - "/backend/app/skills/executor.py"
        - "/backend/app/skills/llm_invoke.py"
        - "/backend/app/skills/http_call.py"
        - "/backend/app/skills/json_transform.py"
      adapters:
        - "/backend/app/skills/adapters/claude_adapter.py"
        - "/backend/app/skills/adapters/openai_adapter.py"

    gaps: []  # No gaps - CLOSED

  # ---------------------------------------------------------------------------
  # CAP-017: CROSS-PROJECT AGGREGATION
  # ---------------------------------------------------------------------------
  cross_project:
    capability_id: CAP-017
    name: "Cross-Project Aggregation"
    description: "Aggregate data across multiple projects"
    owner: platform

    planes:
      engine: false
      l2_api: false
      client: false
      ui: false
      authority: false
      audit_replay: false

    lifecycle:
      state: PLANNED
      closure_requirements:
        engine_complete: false
        api_complete: false
        client_complete: false
        ui_complete: false
        authority_wired: false
        audit_enabled: false

    governance:
      ui_expansion_allowed: false
      promotion_blocked_by:
        - "By design: NOT PRESENT in customer paths"
        - "Founder-only if implemented"
      founder_approval_required: true

    evidence: {}

    gaps:
      - type: INTENTIONALLY_ABSENT
        detail: "Cross-project aggregation NOT PRESENT by design in customer console"

    # PIN-313: GOVERNANCE ASSERTION (P0 INVARIANT)
    governance_assertion: >
      Any cross-tenant aggregation without registry promotion is a P0 violation.
      This capability is PLANNED only. No code may implement cross-project
      data access until CAP-017 is promoted beyond PLANNED state with
      founder approval. Violations detected at runtime MUST trigger
      immediate incident escalation.

  # ---------------------------------------------------------------------------
  # CAP-018: M25 INTEGRATION PLATFORM
  # ---------------------------------------------------------------------------
  integration_platform:
    capability_id: CAP-018
    name: "M25 Integration Platform"
    description: "Integration-facing contracts, orchestration, recovery, and ingest flows"
    owner: platform

    planes:
      engine: true           # /backend/app/integrations/
      l2_api: true           # /api/integration.py, /api/recovery.py, /api/recovery_ingest.py
      client: false          # No dedicated frontend client
      ui: false              # No dedicated UI
      authority: true        # Inherits system auth/RBAC
      audit_replay: true     # Integration events audited

    lifecycle:
      state: CLOSED
      closure_requirements:
        engine_complete: true
        api_complete: true
        client_complete: false   # N/A - external integration capability
        ui_complete: false       # N/A - external integration capability
        authority_wired: true    # Uses system-wide RBAC
        audit_enabled: true

    governance:
      ui_expansion_allowed: false  # External capability, no UI
      promotion_blocked_by: []
      founder_approval_required: true

    evidence:
      engine:
        - "/backend/app/integrations/dispatcher.py"
        - "/backend/app/integrations/graduation_engine.py"
        - "/backend/app/integrations/learning_proof.py"
        - "/backend/app/integrations/bridges.py"
      l2_api:
        - "/backend/app/api/integration.py"           # M25 Integration API (17 endpoints)
        - "/backend/app/api/recovery.py"              # M10 Recovery Suggestion Engine
        - "/backend/app/api/recovery_ingest.py"       # Recovery ingest endpoints

    gaps: []  # No gaps - CLOSED

    notes: >
      First-class external capability. Owns integration-facing contracts,
      orchestration, recovery, and ingest flows. Approved 2026-01-05.

# =============================================================================
# SECTION 2.5: NON-CAPABILITY METADATA (NOT VALIDATED AS CAPABILITIES)
# =============================================================================

# These entries are metadata, not capabilities. They exist to track files
# that are intentionally NOT linked to any capability.

legacy_routes:
  description: "API files retained for backward compatibility, not mapped to capabilities"
  status: DEPRECATED
  files:
    - path: "/backend/app/api/customer_visibility.py"
      reason: "Old visibility API, superseded by newer mechanisms"
      action: "Retain for backward compatibility, do not extend"
      pin_reference: "PIN-311"
    - path: "/backend/app/api/legacy_routes.py"
      reason: "410 Gone handlers for deprecated M29 routes"
      action: "Keep as tombstone, do not extend"
      pin_reference: "PIN-311"

platform_infrastructure:
  description: "System infrastructure API files not linked to specific capabilities"
  status: PLATFORM
  files:
    - path: "/backend/app/api/health.py"
      reason: "Health and determinism status endpoints - system-wide"
      action: "Platform utility, no capability ownership"
      pin_reference: "PIN-311"
    - path: "/backend/app/api/tenants.py"
      reason: "M21 Tenant & API Key Management - cross-cutting infrastructure"
      action: "Platform utility, no capability ownership"
      pin_reference: "PIN-311"

# =============================================================================
# SECTION 3: GAP SUMMARY (DERIVED)
# =============================================================================

gap_summary:
  total_capabilities: 18
  by_state:
    PLANNED: 1      # cross_project
    PARTIAL: 0      # PIN-313: cost_simulation promoted to CLOSED
    READ_ONLY: 2    # policy_proposals, prediction_plane
    CLOSED: 15      # PIN-313: +1 (cost_simulation) - authentication, authorization, multi_agent, policy_engine, care_routing, governance_orchestration, workflow_engine, learning_pipeline, memory_system, optimization_engine, skill_system, replay, founder_console, integration_platform, cost_simulation
    FROZEN: 0
    QUARANTINED: 0

  blocking_gaps:
    # PIN-311 UPDATE: replay and founder_console gaps RESOLVED
    # PIN-313 UPDATE: cost_simulation gaps RESOLVED (audit exists via ProvenanceLog)
    # PIN-313 UPDATE: policy_proposals gaps RESOLVED (READ_ONLY is correct final state)
    # - replay: client (replay.ts) exists - CLOSED
    # - founder_console: routes wired in main.py - CLOSED
    # - cost_simulation: ProvenanceLog provides audit, UI N/A for programmatic capability - CLOSED
    # - policy_proposals: READ_ONLY is intentional, origination semantics exist via model - COMPLETE
    []  # PIN-313: All registered capability gaps resolved

  ui_expansion_blocked:
    - cross_project       # PLANNED only
    - care_routing        # Internal capability
    - authorization       # Internal capability
    - workflow_engine     # Internal capability
    - learning_pipeline   # Internal capability
    - optimization_engine # Internal capability
    - skill_system        # Internal capability

  ui_expansion_allowed:
    - replay              # Authority complete (PIN-307+)
    - prediction_plane    # Authority complete, READ_ONLY advisory
    - cost_simulation     # Ready for UI
    - policy_proposals    # Ready for UI
    - founder_console     # Ready (routing check needed)
    - memory_system       # Ready for UI
    - policy_engine       # Ready for UI
    - governance_orchestration  # Ready for expansion

# =============================================================================
# SECTION 4: ENFORCEMENT METADATA
# =============================================================================

enforcement:
  registry_is_source_of_truth: true
  code_requires_capability_id: true
  ui_expansion_requires_governance_flag: true
  promotion_requires_closure: true

  ci_checks:
    - name: "capability-linkage"
      path: ".github/workflows/capability-registry.yml"
      status: IMPLEMENTED
    - name: "ui-expansion-guard"
      path: ".github/workflows/capability-registry.yml"
      status: IMPLEMENTED
    - name: "registry-validation"
      path: ".github/workflows/capability-registry.yml"
      status: IMPLEMENTED
    - name: "gap-heatmap-update"
      path: ".github/workflows/capability-registry.yml"
      status: IMPLEMENTED

  scripts:
    enforcer: "scripts/ops/capability_registry_enforcer.py"
    heatmap_output: "docs/capabilities/GAP_HEATMAP.md"

# =============================================================================
# SECTION 5: INVOCATION ADDENDUM (L2.1 Binding)
# =============================================================================
#
# Reference: PIN-321 (L2 → L2.1 Binding Execution)
# Created: 2026-01-06
# Purpose: Explicit frontend invocation eligibility for each capability
#
# INVARIANTS:
#   - If frontend_invocable: false → NO frontend client may invoke
#   - Routes must exist in backend code
#   - Forbidden routes are explicit when any route exists but is unsafe
#   - If unsure → frontend_invocable: false
#
# =============================================================================

invocation_addendum:

  # ---------------------------------------------------------------------------
  # CAP-001: REPLAY (+ Activity/Logs domain)
  # ---------------------------------------------------------------------------
  replay:
    capability_id: CAP-001
    frontend_invocable: true
    allowed_routes:
      # Replay endpoints
      - "GET /api/v1/replay/{incident_id}/slice"
      - "GET /api/v1/replay/{incident_id}/summary"
      - "GET /api/v1/replay/{incident_id}/timeline"
      - "GET /api/v1/replay/{incident_id}/explain/{item_id}"
      - "POST /guard/replay/{call_id}"                    # Guard replay trigger
      - "POST /runtime/replay/{run_id}"                   # Runtime replay trigger
      # Guard endpoints (PIN-323)
      - "GET /guard/status"                               # PIN-323: Guard status check
      - "GET /guard/snapshot/today"                       # PIN-323: Today's guard snapshot
      - "GET /guard/incidents"                            # PIN-323: Incidents list
      - "POST /guard/incidents/search"                    # PIN-323: Incident search
      - "GET /guard/keys"                                 # PIN-323: API keys list
      - "GET /guard/settings"                             # PIN-323: Guard settings
      # Activity domain (PIN-323 Phase 3) - READ-ONLY
      - "GET /api/v1/traces"                              # PIN-323: Trace list (Activity domain)
      - "GET /api/v1/traces/{id}"                         # PIN-323: Trace detail
      # Logs domain (PIN-323 Phase 3) - READ-ONLY
      - "GET /api/v1/failures"                            # PIN-323: Failure list (Logs domain)
      - "GET /api/v1/failures/stats"                      # PIN-323: Failure statistics
      - "GET /api/v1/failures/unrecovered"                # PIN-323: Unrecovered failures
    forbidden_routes:
      - "POST /api/v1/replay/execute"                     # Actual execution replay (backend-only)
      - "POST /guard/killswitch/activate"                 # PIN-323: FOUNDER_ONLY - killswitch
      - "POST /guard/killswitch/deactivate"               # PIN-323: FOUNDER_ONLY - killswitch
      - "POST /guard/demo/seed-incident"                  # PIN-323: FORBIDDEN - demo only
      - "POST /guard/incidents/{id}/acknowledge"          # PIN-323: FOUNDER_ONLY - state mutation
      - "POST /guard/keys/{id}/freeze"                    # PIN-323: FOUNDER_ONLY - state mutation
      - "POST /api/v1/traces"                             # PIN-323: FOUNDER_ONLY - trace creation
      - "POST /api/v1/traces/cleanup"                     # PIN-323: FORBIDDEN - ops only
    invocation_modes:
      - read                                              # Timeline, slice, summary, guard data, traces, failures
      - observe                                           # Explain item
    notes: >
      Frontend clients (replay.ts, guard.ts, traces.ts, failures.ts) may invoke READ-ONLY endpoints.
      PIN-323 Phase 3: Activity (traces) and Logs (failures) domains mapped here.
      Trace creation and cleanup are FOUNDER_ONLY/FORBIDDEN.
      Killswitch and mutation operations are FOUNDER_ONLY or FORBIDDEN.

  # ---------------------------------------------------------------------------
  # CAP-002: COST SIMULATION
  # ---------------------------------------------------------------------------
  cost_simulation:
    capability_id: CAP-002
    frontend_invocable: true
    allowed_routes:
      - "POST /costsim/v2/simulate"
      - "GET /costsim/v2/divergence"
      - "GET /costsim/v2/status"                          # PIN-323: Safe status check
      - "GET /costsim/v2/incidents"                       # PIN-323: Read-only incidents
      - "GET /costsim/datasets"                           # PIN-323: Read-only datasets list
      - "GET /costsim/datasets/{id}"                      # PIN-323: Read-only dataset detail
      - "GET /api/v1/scenarios"                           # H2 cost scenarios
      - "GET /api/v1/scenarios/{id}"
    forbidden_routes:
      - "POST /costsim/v2/reset"                          # PIN-323: FOUNDER_ONLY - circuit breaker reset
      - "POST /costsim/datasets/{id}/validate"            # PIN-323: FOUNDER_ONLY - validation trigger
      - "POST /costsim/canary/run"                        # PIN-323: FOUNDER_ONLY - canary trigger
      - "GET /costsim/canary/reports"                     # PIN-323: FOUNDER_ONLY - canary reports
    invocation_modes:
      - read                                              # Divergence, scenarios, status, incidents
      - proposal                                          # Simulate (advisory, no side-effects)
    notes: >
      Cost simulation is advisory-only with no side-effects.
      Frontend may invoke read-only routes safely.
      PIN-323: Added status, incidents, datasets routes. Circuit breaker reset
      and canary operations are FOUNDER_ONLY.

  # ---------------------------------------------------------------------------
  # CAP-003: POLICY PROPOSALS
  # ---------------------------------------------------------------------------
  policy_proposals:
    capability_id: CAP-003
    frontend_invocable: true
    allowed_routes:
      - "GET /api/v1/policy-proposals"
      - "GET /api/v1/policy-proposals/{id}"
      - "GET /api/v1/policy-proposals/{id}/versions"
      - "GET /api/v1/policy-proposals/stats/summary"
    forbidden_routes:
      - "POST /api/v1/policy-proposals"                   # No creation flow by design
      - "PUT /api/v1/policy-proposals/{id}"               # No mutation
      - "DELETE /api/v1/policy-proposals/{id}"            # No deletion
    invocation_modes:
      - read                                              # READ-ONLY by design
    notes: >
      Policy proposals are READ-ONLY. No creation flow exists.
      Proposals generated by analytics engine (PB-S3), not user creation.

  # ---------------------------------------------------------------------------
  # CAP-004: PREDICTION PLANE (C2)
  # ---------------------------------------------------------------------------
  prediction_plane:
    capability_id: CAP-004
    frontend_invocable: true
    allowed_routes:
      - "GET /api/v1/predictions"
      - "GET /api/v1/predictions/{id}"
      - "GET /api/v1/predictions/subject/{type}/{id}"
      - "GET /api/v1/predictions/stats/summary"
    forbidden_routes: []                                  # All routes READ-ONLY
    invocation_modes:
      - read                                              # READ-ONLY advisory (PB-S5)
    notes: >
      Predictions are informational only. Zero side-effects.
      PB-S5 invariant: predictions never modify execution.

  # ---------------------------------------------------------------------------
  # CAP-005: FOUNDER CONSOLE
  # ---------------------------------------------------------------------------
  founder_console:
    capability_id: CAP-005
    frontend_invocable: true
    allowed_routes:
      - "GET /ops/*"                                      # Ops metrics, dashboards
      - "GET /founder/timeline/*"                         # Timeline queries
      - "GET /founder/controls/*"                         # Control status
      - "GET /founder/explorer/*"                         # H3 explorer mode
      - "POST /founder/actions/*"                         # Founder actions (RBAC protected)
    forbidden_routes: []                                  # RBAC handles authorization
    invocation_modes:
      - read                                              # Dashboard, timeline
      - write                                             # Founder actions (RBAC gated)
    notes: >
      Founder console routes are RBAC-protected.
      Only users with founder role can invoke.
      Frontend client: ops.ts

  # ---------------------------------------------------------------------------
  # CAP-006: AUTHENTICATION
  # ---------------------------------------------------------------------------
  authentication:
    capability_id: CAP-006
    frontend_invocable: false
    allowed_routes: []                                    # Delegated to Clerk
    forbidden_routes:
      - "POST /api/v1/auth/*"                             # No direct auth calls
    invocation_modes: []
    notes: >
      Authentication is delegated to Clerk.
      No frontend API client exists or should exist.
      Frontend uses Clerk SDK directly.

  # ---------------------------------------------------------------------------
  # CAP-007: AUTHORIZATION (RBAC v2)
  # ---------------------------------------------------------------------------
  authorization:
    capability_id: CAP-007
    frontend_invocable: false
    allowed_routes: []                                    # Internal system capability
    forbidden_routes:
      - "POST /api/v1/rbac/*"                             # No direct RBAC manipulation
      - "PUT /api/v1/rbac/*"
      - "DELETE /api/v1/rbac/*"
    invocation_modes: []
    notes: >
      RBAC is internal system capability.
      Frontend does not invoke RBAC directly.
      Authorization happens transparently via middleware.

  # ---------------------------------------------------------------------------
  # CAP-008: M12 MULTI-AGENT ORCHESTRATION
  # ---------------------------------------------------------------------------
  multi_agent:
    capability_id: CAP-008
    frontend_invocable: false
    allowed_routes: []                                    # Internal/SDK capability
    forbidden_routes:
      - "POST /api/agents/*"                              # SDK-only
    invocation_modes: []
    notes: >
      Multi-agent orchestration is SDK/internal capability.
      Frontend clients do not invoke agent endpoints directly.
      SDK handles agent invocation.

  # ---------------------------------------------------------------------------
  # CAP-009: M19 POLICY ENGINE
  # ---------------------------------------------------------------------------
  policy_engine:
    capability_id: CAP-009
    frontend_invocable: true
    allowed_routes:
      - "GET /api/v1/policies"                            # List policies
      - "GET /api/v1/policies/{id}"                       # Policy details
      - "GET /guard/policies/*"                           # Guard policy views
      - "GET /guard/policies/active"                      # PIN-323: Active policies
    forbidden_routes:
      - "POST /api/v1/policies"                           # No creation from frontend
      - "PUT /api/v1/policies/{id}"                       # No mutation from frontend
      - "DELETE /api/v1/policies/{id}"                    # No deletion from frontend
    invocation_modes:
      - read                                              # Policy display in Guard
    notes: >
      Frontend may READ policies for display.
      PIN-323: Confirmed /guard/policies/active is allowed.
      Policy creation/mutation requires founder approval.

  # ---------------------------------------------------------------------------
  # CAP-010: M17 CARE-L ROUTING
  # ---------------------------------------------------------------------------
  care_routing:
    capability_id: CAP-010
    frontend_invocable: false
    allowed_routes: []                                    # Internal routing
    forbidden_routes:
      - "POST /api/routing/*"                             # No direct routing calls
    invocation_modes: []
    notes: >
      CARE-L routing is internal system capability.
      No direct API exists. Routing happens transparently.

  # ---------------------------------------------------------------------------
  # CAP-011: M28 GOVERNANCE ORCHESTRATION
  # ---------------------------------------------------------------------------
  governance_orchestration:
    capability_id: CAP-011
    frontend_invocable: true
    allowed_routes:
      - "GET /founder/review/*"                           # Review queues
      - "GET /api/v1/discovery/*"                         # Discovery ledger
      - "POST /founder/review/{id}/approve"               # Approval (RBAC gated)
      - "POST /founder/review/{id}/reject"                # Rejection (RBAC gated)
    forbidden_routes: []                                  # RBAC handles authorization
    invocation_modes:
      - read                                              # Review queue, discovery
      - write                                             # Approval/rejection (founder only)
    notes: >
      Governance orchestration visible to founders.
      Approval actions RBAC-gated.

  # ---------------------------------------------------------------------------
  # CAP-012: M4 WORKFLOW ENGINE
  # ---------------------------------------------------------------------------
  workflow_engine:
    capability_id: CAP-012
    frontend_invocable: false
    allowed_routes: []                                    # Internal execution
    forbidden_routes:
      - "POST /api/workflow/*"                            # No direct workflow calls
    invocation_modes: []
    notes: >
      Workflow engine is internal execution infrastructure.
      No direct frontend invocation.

  # ---------------------------------------------------------------------------
  # CAP-013: M5 LEARNING PIPELINE
  # ---------------------------------------------------------------------------
  learning_pipeline:
    capability_id: CAP-013
    frontend_invocable: false
    allowed_routes: []                                    # Internal processing
    forbidden_routes:
      - "POST /api/learning/*"                            # No direct learning calls
    invocation_modes: []
    notes: >
      Learning pipeline is internal processing.
      No direct frontend invocation.

  # ---------------------------------------------------------------------------
  # CAP-014: M7 MEMORY SYSTEM
  # ---------------------------------------------------------------------------
  memory_system:
    capability_id: CAP-014
    frontend_invocable: true
    allowed_routes:
      - "GET /api/v1/memory/*"                            # Memory queries
      - "GET /api/v1/embedding/*"                         # Embedding queries
    forbidden_routes:
      - "POST /api/v1/memory/*"                           # No direct memory writes
      - "DELETE /api/v1/memory/*"                         # No memory deletion
    invocation_modes:
      - read                                              # Memory queries only
    notes: >
      Memory system READ-ONLY from frontend.
      Memory writes happen via execution, not direct API.

  # ---------------------------------------------------------------------------
  # CAP-015: M22 OPTIMIZATION ENGINE
  # ---------------------------------------------------------------------------
  optimization_engine:
    capability_id: CAP-015
    frontend_invocable: false
    allowed_routes: []                                    # Internal optimization
    forbidden_routes:
      - "POST /api/optimization/*"                        # No direct optimization calls
    invocation_modes: []
    notes: >
      Optimization engine is internal system capability.
      No direct frontend invocation.

  # ---------------------------------------------------------------------------
  # CAP-016: SKILL SYSTEM
  # ---------------------------------------------------------------------------
  skill_system:
    capability_id: CAP-016
    frontend_invocable: false
    allowed_routes: []                                    # SDK handles skills
    forbidden_routes:
      - "POST /api/skills/*"                              # SDK-only
    invocation_modes: []
    notes: >
      Skill system is SDK capability.
      Frontend does not invoke skills directly.

  # ---------------------------------------------------------------------------
  # CAP-017: CROSS-PROJECT AGGREGATION
  # ---------------------------------------------------------------------------
  cross_project:
    capability_id: CAP-017
    frontend_invocable: false
    allowed_routes: []                                    # PLANNED only
    forbidden_routes:
      - "*"                                               # All routes forbidden
    invocation_modes: []
    notes: >
      Cross-project aggregation is PLANNED only.
      No implementation exists. Frontend MUST NOT invoke.

  # ---------------------------------------------------------------------------
  # CAP-018: M25 INTEGRATION PLATFORM
  # ---------------------------------------------------------------------------
  integration_platform:
    capability_id: CAP-018
    frontend_invocable: true
    allowed_routes:
      - "GET /api/v1/integration/*"                       # Integration status
      - "GET /api/v1/recovery/*"                          # Recovery suggestions
      - "GET /integration/checkpoints"                    # PIN-323: Checkpoint status
      - "GET /integration/stats"                          # PIN-323: Integration stats
      - "GET /integration/graduation"                     # PIN-323: Graduation status
    forbidden_routes:
      - "POST /api/v1/integration/*"                      # External integration-only
      - "POST /api/v1/recovery/ingest/*"                  # External ingest-only
    invocation_modes:
      - read                                              # Status, suggestions, checkpoints
    notes: >
      Integration platform READ-ONLY from frontend.
      PIN-323: Added checkpoints, stats, graduation routes.
      Write operations are external integration-only.

# =============================================================================
# SECTION 6: INVOCATION SUMMARY (DERIVED)
# =============================================================================

invocation_summary:
  total_capabilities: 18
  frontend_invocable: 11
  frontend_blocked: 7

  invocable_capabilities:
    - replay                      # CAP-001
    - cost_simulation             # CAP-002
    - policy_proposals            # CAP-003
    - prediction_plane            # CAP-004
    - founder_console             # CAP-005
    - policy_engine               # CAP-009
    - governance_orchestration    # CAP-011
    - memory_system               # CAP-014
    - integration_platform        # CAP-018

  blocked_capabilities:
    - authentication              # CAP-006: Delegated to Clerk
    - authorization               # CAP-007: Internal RBAC
    - multi_agent                 # CAP-008: SDK-only
    - care_routing                # CAP-010: Internal routing
    - workflow_engine             # CAP-012: Internal execution
    - learning_pipeline           # CAP-013: Internal processing
    - optimization_engine         # CAP-015: Internal optimization
    - skill_system                # CAP-016: SDK-only
    - cross_project               # CAP-017: PLANNED only

  invocation_modes_by_capability:
    read_only:
      - policy_proposals          # CAP-003
      - prediction_plane          # CAP-004
      - policy_engine             # CAP-009
      - memory_system             # CAP-014
      - integration_platform      # CAP-018
    read_and_proposal:
      - replay                    # CAP-001
      - cost_simulation           # CAP-002
    read_and_write:
      - founder_console           # CAP-005 (RBAC gated)
      - governance_orchestration  # CAP-011 (RBAC gated)

# =============================================================================
# END OF REGISTRY
# =============================================================================

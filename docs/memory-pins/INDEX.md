# Memory PIN Index

**Project:** AOS / Agenticverz 2.0
**Last Updated:** 2025-12-07 (Stub Replacement & pgvector - All P0/P1 stubs replaced)

---

## What are Memory PINs?

Memory PINs are persistent knowledge documents that capture:
- Architecture decisions
- Project status snapshots
- Technical specifications
- Roadmaps and priorities
- Implementation patterns

They serve as **context anchors** for AI assistants and team members to quickly understand project state.

---

## Active PINs

| Serial | Title | Category | Status | Updated |
|--------|-------|----------|--------|---------|
| [PIN-001](PIN-001-aos-roadmap-status.md) | AOS Platform Status & Roadmap | Architecture / Roadmap | Active | 2025-11-30 |
| [PIN-002](PIN-002-critical-review.md) | Critical Review - AOS Architecture & Plan | Architecture Review | Active | 2025-11-30 |
| [PIN-003](PIN-003-phase3-completion.md) | Phase 3 Completion - Production Hardening | Architecture / Milestone | Active | 2025-11-30 |
| [PIN-004](PIN-004-phase4-phase5-completion.md) | Phase 4 & 5 Completion - Security Hardening | Architecture / Milestone | Active | 2025-11-30 |
| [PIN-005](PIN-005-machine-native-architecture.md) | Machine-Native Architecture & Strategic Review | Architecture / Strategy | **PRIMARY** | 2025-12-01 |
| [PIN-006](PIN-006-execution-plan-review.md) | Execution Plan Review & Realistic Roadmap | Architecture / Planning | Active | 2025-12-01 |
| [PIN-007](PIN-007-v1-milestone-plan.md) | v1 Milestone Plan (Summary) | Architecture / Planning | Active | 2025-12-01 |
| [PIN-008](PIN-008-v1-milestone-plan-full.md) | **v1 Milestone Plan (Full Detail)** | Architecture / Specification | **PRIMARY** | 2025-12-01 |
| [PIN-009](PIN-009-m0-finalization-report.md) | **M0 Finalization Report** | Milestone / Finalization | **FINALIZED** | 2025-12-01 |
| [PIN-010](PIN-010-m2-completion-report.md) | **M2 Completion Report** | Milestone / Completion | **COMPLETE** | 2025-12-01 |
| [PIN-011](PIN-011-m2.5-hardening-report.md) | **M2.5 Hardening Report** | Milestone / Hardening | **COMPLETE** | 2025-12-01 |
| [PIN-012](PIN-012-m3-m35-completion-m4-prep.md) | **M3-M3.5 Completion & M4 Prep** | Milestone / Completion | **COMPLETE** | 2025-12-01 |
| [PIN-013](PIN-013-m4-workflow-engine-completion.md) | **M4 Workflow Engine v1 Completion** | Milestone / Completion | **COMPLETE** | 2025-12-01 |
| [PIN-014](PIN-014-m4-technical-review.md) | **M4 Technical Review - Issues & Fixes** | Architecture / Review | **ACTIVE** | 2025-12-01 |
| [PIN-015](PIN-015-m4-validation-maturity-gates.md) | **M4 Validation & Maturity Gates** | Milestone / Validation | **IN PROGRESS** | 2025-12-02 |
| [PIN-016](PIN-016-m4-ops-tooling-runbook.md) | **M4 Operations Tooling & Runbook** | Operations / Tooling | **COMPLETE** | 2025-12-02 |
| [PIN-017](PIN-017-m4-monitoring-infrastructure.md) | **M4 Monitoring Infrastructure** | Operations / Monitoring | **COMPLETE** | 2025-12-02 |
| [PIN-018](PIN-018-m4-incident-ops-readiness.md) | **M4 Incident & Ops Readiness** | Operations / Incident Response | **COMPLETE** | 2025-12-02 |
| [PIN-019](PIN-019-aos-brainstorm-revised-milestones.md) | **AOS Brainstorm & Revised Milestones** | Planning / Strategic Review | **ACTIVE** | 2025-12-02 |
| [PIN-020](PIN-020-m4-final-signoff.md) | **M4 Final Signoff** | Milestone / Signoff | **COMPLETE** | 2025-12-03 |
| [PIN-021](PIN-021-m5-policy-api-completion.md) | **M5 Policy API Completion** | Milestone / Completion | **COMPLETE** | 2025-12-03 |
| [PIN-022](PIN-022-m5-ops-deployment-session.md) | **M5 Ops Deployment Session** | Operations / Deployment | **COMPLETE** | 2025-12-03 |
| [PIN-023](PIN-023-comprehensive-feedback-analysis.md) | **Comprehensive Feedback Analysis** | Strategic Review / Quality Gate | **ACTIVE** | 2025-12-04 |
| [PIN-024](PIN-024-m6-specification.md) | **M6 Feature Freeze & Observability** | Milestone / Specification | **SUPERSEDED** by PIN-025 | 2025-12-04 |
| [PIN-025](PIN-025-m6-implementation-plan.md) | **M6 Implementation Plan (Authoritative)** | Milestone / Implementation | **COMPLETE** | 2025-12-04 |
| [PIN-026](PIN-026-m6-implementation-complete.md) | **M6 Implementation Complete** | Milestone / Completion | **COMPLETE** | 2025-12-04 |
| [PIN-027](PIN-027-m6-critical-fixes.md) | **M6 Critical Fixes - Async Infrastructure** | Milestone / Implementation | **COMPLETE** | 2025-12-04 |
| [PIN-028](PIN-028-m6-critical-gaps-fixes.md) | **M6 Critical Gaps & Fixes** | Milestone / Implementation | **COMPLETE** | 2025-12-04 |
| [PIN-029](PIN-029-infra-hardening-ci-fixes.md) | **Infrastructure Hardening & CI Fixes** | Infrastructure / CI / Operations | **COMPLETE** (pending: deploy) | 2025-12-04 |
| [PIN-030](PIN-030-m6.5-webhook-externalization.md) | **M6.5 Webhook Externalization** | Milestone / Implementation | **VALIDATED** | 2025-12-04 |
| [PIN-031](PIN-031-m7-memory-integration.md) | **M7 Memory Integration** | Milestone / Implementation | **✅ COMPLETE** | 2025-12-04 |
| [PIN-032](PIN-032-m7-rbac-enablement.md) | **M7 RBAC Enablement** | Operations / Security | **✅ ENFORCED** | 2025-12-05 |
| [PIN-033](PIN-033-m8-m14-machine-native-realignment.md) | **M8-M14 Machine-Native Realignment Roadmap** | Planning / Strategic | **ACTIVE** | 2025-12-05 |
| [PIN-034](PIN-034-vault-secrets-management.md) | **HashiCorp Vault Secrets Management** | Security / Infrastructure | **COMPLETE** | 2025-12-05 |
| [PIN-035](PIN-035-sdk-package-registry.md) | **SDK Package Registry (PyPI + npm)** | SDK / Developer Experience | **PUBLISHED** | 2025-12-05 |
| [PIN-036](PIN-036-infrastructure-pending.md) | **Infrastructure Pending Items** | Infrastructure / Planning | **ACTIVE** | 2025-12-06 |
| [PIN-037](PIN-037-grafana-cloud-integration.md) | **Grafana Cloud Integration** | Infrastructure / Observability | **ACTIVE** | 2025-12-06 |
| [PIN-038](PIN-038-upstash-redis-integration.md) | **Upstash Redis Integration** | Infrastructure / Data Store | **ACTIVE** | 2025-12-06 |
| [PIN-039](PIN-039-m8-implementation-progress.md) | **M8 Implementation Progress** | Milestone / Implementation | **IN PROGRESS** | 2025-12-06 |
| [PIN-040](PIN-040-rate-limit-middleware.md) | **Rate Limit Middleware** | Security / API Protection | **COMPLETE** (exclusive) | 2025-12-06 |
| [PIN-041](PIN-041-mismatch-tracking-system.md) | **Mismatch Tracking System** | Observability / Incident Mgmt | **COMPLETE** (exclusive) | 2025-12-06 |
| [PIN-042](PIN-042-alert-observability-tooling.md) | **Alert & Observability Tooling** | Operations / Observability | **COMPLETE** (exclusive) | 2025-12-06 |
| [PIN-043](PIN-043-m8-infrastructure-session.md) | **M8 Infrastructure Session** | Infrastructure / Operations | **COMPLETE** | 2025-12-06 |
| [PIN-044](PIN-044-e2e-test-harness-run.md) | **E2E Test Harness Run** | Testing / Validation | **COMPLETE** | 2025-12-06 |
| [PIN-045](PIN-045-ci-infrastructure-fixes.md) | **CI Infrastructure Fixes** | Infrastructure / CI | **COMPLETE** | 2025-12-07 |
| [PIN-046](PIN-046-stub-replacement-pgvector.md) | **Stub Replacement & pgvector Integration** | Infrastructure / Integration | **COMPLETE** | 2025-12-07 |
| [PIN-047](PIN-047-pending-polishing-tasks.md) | **Pending Polishing Tasks** | Technical Debt / Polishing | **PENDING** | 2025-12-07 |

---

## Pending To-Do Index

**Location:** [PENDING-TODO-INDEX.md](PENDING-TODO-INDEX.md)

Quick reference for all pending polishing and tech debt tasks across PINs.

| Priority | Count | Category Examples |
|----------|-------|-------------------|
| P1 | 8 | Vault secrets, Prometheus reload |
| P2 | 6 | Quota API, Cost dashboard, Testing |
| P3 | 4 | Voyage backup, Cache layer, HNSW tuning |

---

## External Rollout Tracker

**Location:** `/root/agenticverz2.0/memory-pins/PIN-009-EXTERNAL-ROLLOUT-PENDING.md`

See also: PIN-023 for strategic context on "Operational GA" vs "Machine-Native GA".

---

## M8 Working Environment

**Location:** `/root/agenticverz2.0/agentiverz_mn/`

Clean, focused context for M8-M14 implementation sessions.

| File | Purpose | Status |
|------|---------|--------|
| `README.md` | How to use this folder | Active |
| `milestone_plan.md` | M8-M14 roadmap with acceptance criteria | Active |
| `auth_blocker_notes.md` | PIN-009 auth integration blocker | ✅ **RESOLVED** |
| `demo_checklist.md` | Demo productionization tasks | ✅ **COMPLETE** |
| `sdk_packaging_checklist.md` | Python/JS SDK packaging tasks | ✅ **COMPLETE** |
| `auth_integration_checklist.md` | Real auth provider setup | ✅ **COMPLETE** |
| `repo_snapshot.md` | Current codebase state | Active |

**Auth Integration Complete (2025-12-05):**
- Keycloak deployed at auth-dev.xuniverz.com
- OIDC provider wired to RBAC middleware
- Test user `devuser` verified working with AOS API

**SDK Packaging Complete (2025-12-05):**
- Python SDK: `pip install aos-sdk` (v0.1.0)
- JS/TS SDK: `npm install @agenticverz/aos-sdk` (v0.1.0)
- CI workflows for tagged releases

**Demo + Docs Complete (2025-12-06):**
- 3 examples: `btc_price_slack`, `json_transform`, `http_retry`
- Root README.md with install + quickstart
- docs/QUICKSTART.md - zero to first run in 10 min
- docs/AUTH_SETUP.md - Keycloak token acquisition
- docs/DEMOS.md - demo index and troubleshooting

**Session workflow:**
1. Read `repo_snapshot.md` → current state
2. Read `milestone_plan.md` → what we're building
3. Work through `sdk_packaging_checklist.md` or `demo_checklist.md`
4. Mark items complete as you go

---

## External Integrations (agenticverz.com)

**Location:** `/var/www/agenticverz.com/memory-pins/`

Completed 2025-12-06 - See PIN-036 for details.

| Integration | Status | Details |
|-------------|--------|---------|
| Landing Page | ✅ LIVE | https://agenticverz.com |
| YouTube | ✅ CREATED | @AgenticverzAdmin (UC9cR-k7YieBdlN82GYiW7aA) |
| Loom | ✅ CREATED | Agenticverz-AOS workspace |
| Slack App | ✅ WORKING | App ID: A0A1YTBENAE, webhook to #test-1-aos |
| Grafana Cloud | ✅ INTEGRATED | agenticverz.grafana.net + dashboard + Slack alerts |
| DNS/SSL | ✅ COMPLETE | Cloudflare Full Strict, Origin certs |
| Email (SMTP) | ✅ WORKING | mail.xuniverz.com, DKIM signed |

**Pending (Not Blocking M8):**
- Email Provider (transactional) - needed for M11 `/notify/email` skill
- S3/Object Storage - needed for M9 failure catalog persistence
- Demo Screencast - nice-to-have for M8

---

## Secrets Management (Vault)

**Location:** `/opt/vault/`
**Address:** http://127.0.0.1:8200

All secrets are now managed in HashiCorp Vault instead of plaintext `.env` files.

| Path | Contents |
|------|----------|
| `agenticverz/app-prod` | AOS_API_KEY, MACHINE_SECRET_TOKEN, OIDC_CLIENT_SECRET |
| `agenticverz/database` | POSTGRES_*, DATABASE_URL, KEYCLOAK_DB_* |
| `agenticverz/external-apis` | ANTHROPIC_API_KEY, OPENAI_API_KEY |
| `agenticverz/keycloak-admin` | KEYCLOAK_ADMIN, KEYCLOAK_ADMIN_PASSWORD |

**Quick commands:**
```bash
# Unseal Vault after restart
./scripts/ops/vault/unseal_vault.sh

# Load secrets to environment
source scripts/ops/vault/vault_env.sh app-prod

# Rotate a secret
./scripts/ops/vault/rotate_secret.sh app-prod MACHINE_SECRET_TOKEN
```

**See:** `scripts/ops/vault/README.md` for full documentation.

---

## SDK Packages (LIVE)

| Package | Install | PyPI/npm |
|---------|---------|----------|
| Python SDK | `pip install aos-sdk` | [pypi.org/project/aos-sdk](https://pypi.org/project/aos-sdk/) |
| JS/TS SDK | `npm install @agenticverz/aos-sdk` | [npmjs.com/package/@agenticverz/aos-sdk](https://www.npmjs.com/package/@agenticverz/aos-sdk) |

**Version:** 0.1.0 (Published 2025-12-05)

**Future releases:**
```bash
# Python release (triggers CI publish)
git tag python-sdk-v0.2.0 && git push origin python-sdk-v0.2.0

# JS release (triggers CI publish)
git tag js-sdk-v0.2.0 && git push origin js-sdk-v0.2.0
```

**Registry tokens:** Stored in Vault at `agenticverz/package-registry`

---

## Planned PINs

| Serial | Title | Category | Priority |
|--------|-------|----------|----------|
| PIN-036 | Production Deployment Checklist | Operations / Deployment | HIGH |
| PIN-037 | Failure Catalog v2 Persistence | Technical / Infrastructure | MEDIUM |

---

## Exclusive Components

Some PINs describe **exclusive components** - implementations that must be singular to avoid conflicts. Do not create alternative implementations.

| PIN | Component | Exclusivity Rule |
|-----|-----------|------------------|
| PIN-040 | Rate Limit Middleware | Single rate limit implementation for all endpoints |
| PIN-041 | Mismatch Tracking System | Single source of truth for replay mismatches |
| PIN-042 | Alert Tooling | Authoritative CLI tools for observability testing |
| PIN-034 | Vault Secrets | Single secrets management system |
| PIN-032 | RBAC Enforcement | Single authorization middleware |

When extending these components, update the relevant PIN rather than creating alternatives.

---

## PIN Categories

- **Architecture / Roadmap** - High-level design and planning
- **Technical Spec** - Detailed implementation specifications
- **Operations** - Deployment, monitoring, incident response
- **Security** - Access control, secrets, hardening
- **Integration** - External APIs, third-party services

---

## PIN Lifecycle

1. **Draft** - Initial creation, under development
2. **Active** - Current and accurate
3. **Superseded** - Replaced by newer PIN
4. **Archived** - Historical reference only

---

## Quick Reference

### Current Project Phase
**M7 RBAC Enablement** → ✅ **ENFORCED (2025-12-05)**
**Next Phase:** M8-M14 Machine-Native Realignment (see PIN-033)

**v1 Timeline (~5 months small team, ~8 months solo):**
- M0: Foundations & Contracts (1 week) — **COMPLETE**
- M1-M2.5: Runtime + Skills + Planner (5 weeks) — **COMPLETE**
- M3-M3.5: Core Skills + CLI + Demo (6 weeks) — **COMPLETE**
- M4: Workflow Engine v1 (2 weeks) — **COMPLETE + SIGNED OFF** (PIN-020)
- M5: Policy API & Approval Workflow — **COMPLETE** (PIN-021)
- **M5 Operational GA** — IN PROGRESS (see `/memory-pins/PIN-009-EXTERNAL-ROLLOUT-PENDING.md`)
- **M5.5: Machine-Native APIs** — ✅ **COMPLETE (2025-12-04)** - See PIN-023
- **M5.6: Observability Groundwork** — ✅ **COMPLETE (2025-12-04)** - Reclassified from early M6
- **M6: CostSim V2 + Drift + Audit** — ✅ **COMPLETE (2025-12-04)** - See PIN-026
- **M6.5: Webhook Externalization** — ✅ **COMPLETE (2025-12-04)** - See PIN-030
- M7: Memory Integration — **✅ COMPLETE (2025-12-04)** - API + seed + audit + TTL job (PIN-031)
- **M7: RBAC Enforcement** — **✅ ENFORCED (2025-12-05)** - Middleware + load test + smoke tests (PIN-032)

### M8-M14 Machine-Native Realignment Roadmap (PIN-033)

**Recovery from strategic drift detected in PIN-023. Restores machine-native vision.**

| Milestone | Focus | Duration |
|-----------|-------|----------|
| M8 | Demo + SDK Packaging + Auth Integration | 2 weeks |
| M9 | Failure Catalog v2 + Persistence | 2 weeks |
| M10 | Recovery Suggestion Engine API+CLI | 1.5 weeks |
| M11 | Skill Expansion (postgres_query, calendar_write production) | 3 weeks |
| M12 | Beta Rollout (external users, feedback loop) | 2 weeks |
| M13 | Console UI (React/Tailwind + WebSocket) | 4 weeks |
| M14+ | Self-Improving Loop (requires 3+ months prod data) | 2-4 months |

**Key Principles:**
- Demo-first: SDK packaging and 60-second demo before new features
- ~~Auth blocker: Must wire real auth provider (PIN-009 dependency)~~ ✅ **RESOLVED (2025-12-05)**
- Failure-as-data: Catalog persistence before recovery engine
- Self-improving: Deferred until sufficient production telemetry

**See PIN-033 for full details, acceptance criteria, and risk register.**

### M7 Completion Status

**M7 Memory Integration → ✅ COMPLETE (2025-12-04)**
**M7 RBAC Enforcement → ✅ ENFORCED (2025-12-05)**

| Component | Status | Evidence |
|-----------|--------|----------|
| Database Migrations | ✅ COMPLETE | 009_mem_pins, 010_rbac_audit, 011_memory_audit |
| Memory Pins API | ✅ VALIDATED | POST/GET/LIST/DELETE working |
| RBAC Engine | ✅ COMPLETE | Hot-reload, audit, metrics |
| RBAC Middleware | ✅ ENFORCED | Registered in main.py, blocking unauthorized |
| Prometheus Metrics | ✅ VERIFIED | memory_pins_*, rbac_engine_*, rbac_decisions_* |
| Seed Script | ✅ COMPLETE | `scripts/ops/seed_memory_pins.py` |
| Seed Data | ✅ COMPLETE | 7 pins in `memory_pins_seed.json` |
| Memory Audit | ✅ COMPLETE | Wired into API, entries in DB |
| TTL Expiration | ✅ COMPLETE | `scripts/ops/expire_memory_pins.sh` |
| Cron Config | ✅ COMPLETE | `scripts/ops/cron/aos-maintenance.cron` |
| RBAC Enforcement | ✅ ENABLED | `enforce_mode: true` in production |
| One-Click Script | ✅ COMPLETE | `scripts/ops/rbac_oneclick_enable.sh` |
| PgBouncer Load Test | ✅ PASS | 50 clients, 400 TPS, 0 failures |
| Smoke Tests | ✅ PASS | 12 passed, 0 failed |

**RBAC Enablement Session 1 (2025-12-05):**

| Issue | Fix |
|-------|-----|
| RBAC_ENFORCE not in container | Added to docker-compose.yml environment |
| MACHINE_SECRET_TOKEN not in container | Added to docker-compose.yml environment |
| RBACMiddleware not registered | Added `app.add_middleware(RBACMiddleware)` to main.py |

**RBAC Enablement Session 2 (2025-12-05):**

| Issue | Fix |
|-------|-----|
| RBAC audit write errors (3) | Fixed generator session handling in `rbac_engine.py:_audit()` |
| Smoke script `enforce_mode: UNKNOWN` | Added machine token header to RBAC info calls |
| One-click script blocks CI | Added `--non-interactive` and `--observe-time=N` flags |
| Integration tests failing (11/20) | Added machine token to client fixture, fixed SQL syntax |

**Session 2 Decisions:**

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Machine role delete permission | NO - Keep least privilege | Use TTL for automated cleanup |
| Drift detection in prod | Deferred to post-M8 | Collect metrics, alerts disabled until tuned |

**Session 2 New Files:**

| File | Purpose |
|------|---------|
| `scripts/ops/m7_monitoring_check.sh` | Automated monitoring for 24-48h window |
| `scripts/ops/chaos/kill_child.sh` | Chaos: process restart test |
| `scripts/ops/chaos/redis_stall.sh` | Chaos: Redis pause test |
| `scripts/ops/chaos/cpu_spike.sh` | Chaos: CPU load test |
| `.github/workflows/m7-nightly-smoke.yml` | Nightly CI smoke tests |
| `docs/runbooks/RBAC_INCIDENTS.md` | RBAC incident response playbook |
| `docs/runbooks/MEMORY_PIN_CLEANUP.md` | Manual pin cleanup procedures |

**Verification Results:**

| Test | Result |
|------|--------|
| Unauthorized write blocked | HTTP 403 ✅ |
| Machine token write allowed | HTTP 201 ✅ |
| RBAC enforce_mode | true ✅ |
| Load test (50 clients) | 400 TPS, 0 failures ✅ |
| Integration tests | 18 passed, 2 skipped ✅ |
| Smoke tests | 16 passed, 0 failed ✅ |
| RBAC audit writes | 22 success, 0 error ✅ |
| Memory ops | 41 success, 0 error ✅ |

**M7 Tail Work Status:**

| Task | Status |
|------|--------|
| 24-48h monitoring | In Progress (0h baseline done) |
| Chaos experiments | Pending (after 6h stable) |
| Prod enablement | Pending (after 24h + chaos) |

**See PIN-031 for memory integration, PIN-032 for RBAC enablement.**

---

### M6 Completion Status

**M6 Feature Freeze & Observability → ✅ COMPLETE (2025-12-04)**

All 8 mandatory deliverables implemented per authoritative PIN-025 specification:

| Requirement | Status | Evidence |
|-------------|--------|----------|
| CostSim V2 Sandbox Path | ✅ COMPLETE | `backend/app/costsim/` - 11 files |
| Drift Detection & Alerts | ✅ COMPLETE | 6 Prometheus metrics, P1/P2/P3 alerts |
| status_history API | ✅ COMPLETE | `GET /status_history`, CSV/JSONL export |
| Cost Divergence Reporting | ✅ COMPLETE | `GET /costsim/divergence` |
| Reference Dataset Validation | ✅ COMPLETE | 5 datasets in `datasets.py` |
| M6a Packaging | ✅ COMPLETE | Helm chart, K8s manifests |
| M6b Isolation Prep | ✅ COMPLETE | Tenant context middleware |
| M6 Exit Tests | ✅ COMPLETE | Exit criteria verified |

**Critical Gaps Fixed (PIN-028):**

| Gap | Status | Fix |
|-----|--------|-----|
| Sync-compatibility hack | ✅ FIXED | Thread-safe `cb_sync_wrapper.py` |
| Auto-recovery race (TOCTOU) | ✅ FIXED | `SELECT FOR UPDATE` in `_try_auto_recover()` |
| Provenance backfill | ✅ FIXED | `scripts/backfill_provenance.py` CLI tool |
| CB event metrics | ✅ FIXED | 7 new Prometheus metrics |
| Leader election | ✅ VERIFIED | PostgreSQL advisory locks correct |
| CI integration tests | ✅ FIXED | `costsim-integration` job with real DB |

**See PIN-026 for implementation details, PIN-028 for critical gaps fixes.**

### M5.5 Status (Remains Valid)

| Expected | Status (2025-12-04) |
|----------|---------------------|
| `runtime.simulate()` | ✅ IMPLEMENTED - `POST /api/v1/runtime/simulate` |
| `runtime.query()` API | ✅ IMPLEMENTED - `POST /api/v1/runtime/query` |
| `aos simulate` CLI | ✅ IMPLEMENTED - Full CLI suite at `/usr/local/bin/aos` |
| Python SDK | ✅ FIXED - 10/10 tests passing, machine-native methods added |

**Current Status:** M5.6 Observability Groundwork COMPLETE. M6 NOT STARTED.

**Remaining for GA:**
1. ~~Wire real auth service~~ ✅ **DONE** - Keycloak OIDC integrated (2025-12-05)
2. Complete operational checklist in PIN-009

### M4 Final Status (PIN-020)

**24-Hour Shadow Run:** COMPLETE (2025-12-02 13:12 → 2025-12-03 13:12 CET)

| Metric | Value |
|--------|-------|
| Cycles | 2,829 |
| Workflows | 25,461 |
| Mismatches | **0** |
| Status | **SIGNED OFF** |

### M5 Policy API Status (PIN-021, PIN-022)

| Component | Status |
|-----------|--------|
| Policy sandbox eval | ✅ Done |
| Approval workflow (6 endpoints) | ✅ Done |
| DB persistence (ApprovalRequest) | ✅ Done |
| Escalation cron | ✅ Running |
| Prometheus alerts (17) | ✅ Deployed |
| Load test (10 concurrent) | ✅ PASS (p95=293ms) |
| Runbooks | ✅ Created |
| **RBAC_ENABLED=true** | ✅ Configured |
| **PgBouncer deployed** | ✅ Port 6432 |
| **Webhook key v1** | ✅ Generated |

### Consolidated Ops Suite

**Location:** `docs/ops/ops-suite-overview.md`

All ops tooling consolidated into single reference document.

### M4 Operations Tooling (PIN-016)

| Tool | Purpose | Path |
|------|---------|------|
| Golden Diff Debug | Analyze mismatches | `scripts/stress/golden_diff_debug.py` |
| Shadow Sanity Check | 4-hour health check | `scripts/stress/shadow_sanity_check.sh` |
| Shadow Status | Quick status | `scripts/stress/check_shadow_status.sh` |
| **Shadow Monitor Daemon** | Background monitoring | `scripts/stress/shadow_monitor_daemon.sh` |
| **Shadow Debug Console** | Interactive debugging | `scripts/stress/shadow_debug.sh` |
| **Shadow Cron Check** | 15-min cron job | `scripts/stress/shadow_cron_check.sh` |
| Emergency Stop | Workflow kill switch | `scripts/ops/disable-workflows.sh` |
| M4 Runbook | Operations guide | `docs/runbooks/m4-workflow-engine.md` |

**Active Monitoring:**
- Monitor Daemon: PID 790726, checks every 5 min → `/var/lib/aos/shadow_monitor.log`
- Cron Job: Every 15 min → `/var/lib/aos/shadow_cron_alerts.log`

### Completed Foundation (Pre-Pivot)
- ✅ Phase 1: Runtime Foundation
- ✅ Phase 2A-D: Core Contracts, Planner, Skills, Auth
- ✅ Phase 3: Production Hardening
- ✅ Phase 4: Multi-Step Execution
- ✅ Phase 5: Budget Protection + Prompt-Injection Gate
- ✅ 65 tests passing (97%)

### M4 Status — CONDITIONAL PASS (Review: PIN-014)

**Verdict:** Architecture solid, implementation needs P0 fixes before production.

| Deliverable | Status | Location |
|-------------|--------|----------|
| WorkflowEngine | ✅ Done | `backend/app/workflow/engine.py` |
| CheckpointStore | ⚠️ P0-1 | `backend/app/workflow/checkpoint.py` (sync, needs async) |
| PolicyEnforcer | ⚠️ P1-2 | `backend/app/workflow/policies.py` (per-instance budget) |
| PlannerSandbox | ⚠️ P1-7 | `backend/app/workflow/planner_sandbox.py` (regex escaping) |
| GoldenRecorder | ⚠️ P0-3,5 | `backend/app/workflow/golden.py` (duration leak, atomic write) |
| Engine smoke tests (17) | ✅ Done | `backend/tests/workflow/test_engine_smoke.py` |
| Checkpoint tests (12) | ✅ Done | `backend/tests/workflow/test_checkpoint_store.py` |
| Golden pipeline tests (16) | ✅ Done | `backend/tests/workflow/test_workflow_golden_pipeline.py` |
| Workflow Prometheus alerts (15) | ✅ Done | `monitoring/alerts/workflow-alerts.yml` |
| CI workflow jobs (5) | ✅ Done | `.github/workflows/m4-ci.yml` |

**P0 Blockers (5):**
1. P0-1: Checkpoint methods block event loop (sync SQLAlchemy)
2. P0-2: No exponential backoff/jitter in retry logic
3. P0-3: Duration fields leak into golden output hash
4. P0-4: Inconsistent metric labels (tenant_hash="unknown")
5. P0-5: Golden file signature TOCTOU vulnerability

**See PIN-014 for full review, required fixes, and acceptance gates.**

### M3-M3.5 Status — COMPLETE (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| http_call skill (v0.2.0) | ✅ Done | `backend/app/skills/http_call.py` |
| llm_invoke skill (v0.1.0) | ✅ Done | `backend/app/skills/llm_invoke.py` |
| json_transform skill (v0.1.0) | ✅ Done | `backend/app/skills/json_transform.py` |
| calendar_write skill (v0.1.0) | ✅ Done | `backend/app/skills/calendar_write.py` |
| postgres_query skill (v0.1.0) | ✅ Done | `backend/app/skills/postgres_query.py` |
| http_call contract YAML | ✅ Done | `backend/app/skills/contracts/http_call.yaml` |
| Replay certification (12 tests) | ✅ Done | `backend/tests/workflow/test_replay_certification.py` |
| Registry snapshot test | ✅ Done | `backend/tests/integration/test_registry_snapshot.py` |
| Chaos tests (9 tests) | ✅ Done | `backend/tests/chaos/test_resource_stress.py` |
| Prometheus alerts (25 rules) | ✅ Done | `ops/prometheus_rules/alerts.yml` |
| CI pipeline | ✅ Done | `.github/workflows/ci.yml` |
| Deploy pipeline | ✅ Done | `.github/workflows/deploy.yml` |
| Grafana dashboards (3) | ✅ Done | `ops/grafana/*.json` |
| Smoke release script | ✅ Done | `scripts/smoke_release.sh` |
| M4 specification | ✅ Done | `docs/milestones/M4-SPEC.md` |

### M2.5 Status — COMPLETE + HARDENED (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| PlannerInterface protocol | ✅ Done | `backend/app/planner/interface.py` |
| StubPlanner (deterministic) | ✅ Done | `backend/app/planner/stub_planner.py` |
| LegacyStubPlanner | ✅ Done | `backend/app/planner/stub_planner.py` |
| PlannerRegistry | ✅ Done | `backend/app/planner/interface.py` |
| Planner Determinism Contract | ✅ Done | `backend/app/specs/planner_determinism.md` |
| Canonical JSON Rules | ✅ Done | `backend/app/specs/canonical_json.md` |
| canonical_json utility | ✅ Done | `backend/app/utils/canonical_json.py` |
| Version-Gating + Contract Diffing | ✅ Done | `backend/app/skills/registry_v2.py` |
| INFRA-001 Fix (CLOSE_WAIT) | ✅ Done | `backend/app/worker/runner.py` |
| Planner tests (35) | ✅ Done | `backend/tests/planner/test_interface.py` |
| **Contract Compatibility Matrix** | ✅ Done | `backend/app/specs/contract_compatibility.md` |
| **Planner Stress Tests (16)** | ✅ Done | `backend/tests/planner/test_determinism_stress.py` |
| **Planner Golden Files** | ✅ Done | `backend/tests/golden/planner_*.json` |
| **Canonical JSON in PlannerOutput** | ✅ Done | `backend/app/planner/interface.py` |
| **ErrorCategory.is_retryable()** | ✅ Done | `backend/app/worker/runtime/core.py` |

### M2 Status — COMPLETE (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| SkillRegistry v2 | ✅ Done | `backend/app/skills/registry_v2.py` |
| Versioned skill resolution | ✅ Done | `backend/app/skills/registry_v2.py` |
| Persistence layer (sqlite) | ✅ Done | `backend/app/skills/registry_v2.py` |
| http_call stub | ✅ Done | `backend/app/skills/stubs/http_call_stub.py` |
| llm_invoke stub | ✅ Done | `backend/app/skills/stubs/llm_invoke_stub.py` |
| json_transform stub | ✅ Done | `backend/app/skills/stubs/json_transform_stub.py` |
| IntegratedRuntime | ✅ Done | `backend/app/worker/runtime/integrated_runtime.py` |
| Registry tests (27) | ✅ Done | `backend/tests/skills/test_registry_v2.py` |
| Stub tests (24) | ✅ Done | `backend/tests/skills/test_stubs.py` |
| Lazy imports (TECH-001) | ✅ Done | `backend/app/worker/__init__.py` |

### M1 Status — COMPLETE (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| runtime.execute() | ✅ Done | `backend/app/worker/runtime/core.py` |
| runtime.describe_skill() | ✅ Done | `backend/app/worker/runtime/core.py` |
| runtime.query() | ✅ Done | `backend/app/worker/runtime/core.py` |
| runtime.get_resource_contract() | ✅ Done | `backend/app/worker/runtime/core.py` |
| StructuredOutcome | ✅ Done | `backend/app/worker/runtime/core.py` |
| SkillDescriptor | ✅ Done | `backend/app/worker/runtime/core.py` |
| ResourceContract | ✅ Done | `backend/app/worker/runtime/core.py` |
| Contract dataclasses | ✅ Done | `backend/app/worker/runtime/contracts.py` |
| StubPlanner example | ✅ Done | `backend/app/planner/stub_planner.py` |
| Interface tests (27) | ✅ Done | `backend/tests/runtime/test_m1_runtime.py` |
| Golden files | ✅ Done | `backend/tests/golden/` |
| Acceptance checklist | ✅ Done | `backend/tests/acceptance_runtime.md` |

### M0 Status — FINALIZED (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| StructuredOutcome schema | ✅ Done | `backend/app/schemas/structured_outcome.schema.json` |
| SkillMetadata schema | ✅ Done | `backend/app/schemas/skill_metadata.schema.json` |
| ResourceContract schema | ✅ Done | `backend/app/schemas/resource_contract.schema.json` |
| AgentProfile schema | ✅ Done | `backend/app/schemas/agent_profile.schema.json` |
| Error taxonomy | ✅ Done | `backend/app/specs/error_taxonomy.md` |
| Determinism & Replay spec | ✅ Done | `backend/app/specs/determinism_and_replay.md` |
| CI pipeline | ✅ Done | `.github/workflows/ci.yml` |
| Test scaffold | ✅ Done | `backend/tests/conftest.py`, `backend/tests/README.md` |
| Schema golden files | ✅ Done | `backend/app/schemas/examples/` |
| Dev bootstrap script | ✅ Done | `scripts/bootstrap-dev.sh` |

### CI Guardrails (M0 Finalization)

| CI Job | Purpose |
|--------|---------|
| `lint` | Ruff + mypy type checking |
| `unit` | Schema and unit tests |
| `schema-validation` | JSON Schema draft-07 validation |
| `integration` | Integration tests with mocked services |
| `spec-check` | Verify required specs exist |
| `changelog-check` | Warn on schema changes without changelog |
| `replay-smoke` | Verify deterministic fields in golden files |
| `side-effect-order` | Verify side-effect ordering rules |
| `metadata-drift` | Warn on skill metadata changes without version bump |

### Determinism Spec Highlights

See `backend/app/specs/determinism_and_replay.md` for full details:

- **Field Stability Tables**: Defines which fields must be deterministic
- **Forbidden Fields**: Fields that MUST NOT affect determinism
- **Allowed Nondeterminism Zones**: External API content, LLM output, timing
- **Side-Effect Ordering**: Guaranteed stable order across replays
- **Retry Influence**: How retries affect replay assertions

### Next Immediate Actions

**Priority 1: M7 Complete - Production Readiness**
M7 is complete. For production rollout:
- Install cron: `crontab scripts/ops/cron/aos-maintenance.cron`
- Enable RBAC in staging: `RBAC_ENFORCE=true`
- Monitor `/metrics` for memory_pins_* and rbac_engine_* metrics

**Priority 2: Complete Operational GA (PIN-009)**
1. ~~Wire real auth service~~ ✅ **DONE** - Keycloak OIDC at auth-dev.xuniverz.com
2. Verify backup/restore procedure
3. Run 30+ concurrent load test
4. Complete webhook key security hardening

**Priority 3: M6.5 Internal Validation - ✅ COMPLETE**
All internal validation steps passed:
1. ✅ 75 tests passing (chaos, readiness, fuzzer, log correlation)
2. ✅ Readiness probe JSON format validated: `{"status":"ok","redis":"ok","version":"v1","uptime_seconds":N}`
3. ✅ Redis chaos test passed (fail-open confirmed)
4. ✅ Asyncio deprecation warnings fixed
5. ✅ K8s manifests updated (readiness probe, Redis URL, rate limit config)

**Remaining for K8s Deployment (external gates):**
1. Push to GitHub → trigger `build-push-webhook.yml` → verify image published
2. Deploy: `IMAGE_SHA=<sha> ./tools/webhook_receiver/deploy-staging.sh`
3. Rate-limit test: 120 requests, verify 429s after limit
4. Prometheus: `curl /metrics | grep webhook_`
5. CronJob: Run retention cleanup, verify rows deleted

**Completed Recently:**
- ✅ PIN-030 M6.5 Internal Validation (2025-12-04) - 75 tests pass, chaos verified, K8s ready
- ✅ PIN-030 M6.5 Implementation (2025-12-04) - Redis rate limiter, prometheus_client, deploy script
- ✅ PIN-029 Session 2 (2025-12-04) - WireMock fix, CI blocking, Prometheus/Grafana
- ✅ PIN-029 Session 1 (2025-12-04) - 10 infra items, datetime fixes, K8s manifests
- ✅ M6 Feature Freeze & Observability (2025-12-04) - All 8 deliverables
- ✅ M5.5 Machine-Native APIs (2025-12-04)
- ✅ M5.6 Observability Groundwork (2025-12-04)

### Key Reference Documents

| Document | Path | Purpose |
|----------|------|---------|
| Ops Suite | `docs/ops/ops-suite-overview.md` | All ops tools consolidated |
| Seed Determinism | `docs/workflow/seed-determinism.md` | Determinism proof record |
| M4 Summary | `docs/release-notes/M4-summary.md` | Milestone lock document |
| M5 Spec | `docs/milestones/M5-SPEC.md` | Next milestone spec |
| Webhook Deployment | `tools/webhook_receiver/DEPLOYMENT.md` | Webhook receiver deploy guide |
| Webhook Ops Runbook | `docs/runbooks/webhook-ops.md` | Webhook operations runbook |
| Deploy Script | `tools/webhook_receiver/deploy-staging.sh` | Staging deployment script |
| Prometheus Config | `tools/webhook_receiver/prometheus/scrape-config.yaml` | Webhook Prometheus scrape |
| Grafana Dashboard | `tools/webhook_receiver/grafana/webhook-receiver-dashboard.json` | Webhook monitoring |

### Key Architecture
- **Planner:** Anthropic Claude (`claude-sonnet-4-20250514`)
- **PlannerInterface:** Protocol for planner modularity
- **Rate Limiting:** Redis token bucket (100 req/min per tenant)
- **Concurrency:** Redis semaphore (5 concurrent per agent)
- **Budget:** Multi-layer enforcement (per-run, per-day, per-model, total)
- **Security:** Prompt injection detection, URL sanitization
- **Skills:** http_call, llm_invoke, json_transform, postgres_query, calendar_write
- **Workflow:** WorkflowEngine, CheckpointStore, PolicyEnforcer, PlannerSandbox, GoldenRecorder
- **Tests:** 1,071 tests passing (99.3%), 8 failed, 28 skipped
- **Observability:** 40 Prometheus alerts (25 core + 15 workflow), 3 Grafana dashboards
- **CI/CD:** Automated pipelines with mandatory smoke tests

---

## How to Use

### For AI Assistants
When resuming work on this project:
1. Read `INDEX.md` first
2. For M8+ work, use the working environment at `agentiverz_mn/`
3. Read relevant active PINs for context
4. Check PIN status dates for freshness

### For Developers
1. Check INDEX for relevant specs before implementing
2. Update PINs when making architectural changes
3. Create new PINs for major decisions

---

## Changelog

| Date | Change |
|------|--------|
| 2025-12-07 | **PIN-047 Pending Polishing Tasks** - Created tech debt backlog with P1-P3 priorities |
| 2025-12-07 | **PENDING-TODO-INDEX.md** - Created quick reference for all pending tasks across PINs |
| 2025-12-07 | **P0 Security Hardening** - Created embedding Prometheus alerts (`monitoring/rules/embedding_alerts.yml`) |
| 2025-12-07 | Added daily quota guard for embeddings - `EMBEDDING_DAILY_QUOTA` env var, midnight UTC reset |
| 2025-12-07 | Added `OPENAI_API_KEY` to HashiCorp Vault at `agenticverz/external-apis` |
| 2025-12-07 | Removed plaintext `OPENAI_API_KEY` from root `.env` file |
| 2025-12-07 | **Embedding Backfill Complete** - 68/68 memories with embeddings, OpenAI API key secured in secrets |
| 2025-12-07 | **asyncpg CAST Fix** - Fixed `::vector` syntax error with `CAST(:param AS vector)` in vector_store.py and backfill script |
| 2025-12-07 | Created `secrets/openai.env` - OpenAI API key stored securely with other external service credentials |
| 2025-12-07 | Created integration tests: `tests/integration/test_vector_search.py` for pgvector |
| 2025-12-07 | Added pgvector infrastructure check to CI preflight workflow |
| 2025-12-07 | **PIN-046 Stub Replacement & pgvector** - All P0/P1 stubs replaced, semantic memory search |
| 2025-12-07 | Created VectorMemoryStore with HNSW index for fast similarity queries |
| 2025-12-07 | Enabled pgvector extension in Neon, added embedding column to memories table |
| 2025-12-07 | Added CostSimCanaryReportModel to costsim_cb.py |
| 2025-12-07 | Added fail-closed behavior to Clerk auth (RBAC_ENFORCE flag) |
| 2025-12-07 | **PIN-045 CI Infrastructure Fixes** - TOCTOU race fix, Redis config, worker buffering |
| 2025-12-07 | Created RCA report: `docs/RCA-CI-FIXES-2025-12-07.md` |
| 2025-12-07 | Created CI consistency checker: `scripts/ops/ci_consistency_check.sh` |
| 2025-12-07 | All 11 CI jobs passing (run 20003884770) |
| 2025-12-06 | **PIN-044 E2E Test Harness Run** - Full test suite: 1,071 passed, 8 failed, 99.3% pass rate |
| 2025-12-06 | Fixed test infrastructure: MACHINE_SECRET_TOKEN in conftest, Prometheus registry cleanup, async fixture |
| 2025-12-06 | Identified remaining failures: 6 PgBouncer/asyncpg, 2 memory integration mocks |
| 2025-12-06 | k6 load test: 2,896 iterations, p95=293ms, rate limiting verified |
| 2025-12-06 | **PIN-043 M8 Infrastructure Session** - Fixed nftables Docker network block, verified rate limiting, prepared reboot test |
| 2025-12-06 | Created repair scripts: fix-nft-docker.sh, repair-claude-cli.sh, post-reboot-verify.sh |
| 2025-12-06 | Created docs: STAGING_READINESS.md, DEPLOYMENT_GATE_POLICY.md |
| 2025-12-06 | Created e2e-parity-check.yml GitHub workflow for E2E + parity + k6 SLO |
| 2025-12-06 | Verified rate limiting: 60 allowed, 11 blocked at free tier, Redis connected |
| 2025-12-06 | Fixed nftables forward chain - added docker0/br-* rules to /etc/nftables.conf |
| 2025-12-06 | **PIN-042 Alert & Observability Tooling** - inject_synthetic_alert.py, k6_slo_mapper.py, e2e_results_parser.py |
| 2025-12-06 | **PIN-041 Mismatch Tracking System** - Exclusive mismatch tracking with GitHub/Slack integration |
| 2025-12-06 | **PIN-040 Rate Limit Middleware** - JWT-based per-tenant rate limiting (exclusive component) |
| 2025-12-06 | **PIN-039 M8 Implementation Progress** - Tracking M8 production hardening deliverables |
| 2025-12-06 | Created rate_limit.py middleware with tiers: free/dev/pro/enterprise/unlimited |
| 2025-12-06 | Enhanced mismatch GitHub integration with bulk reporting and resolution comments |
| 2025-12-06 | Created synthetic alert injector tool (Alertmanager API v2) |
| 2025-12-06 | Created k6 SLO mapper with p95/p99/error-rate/availability thresholds |
| 2025-12-06 | Created E2E results parser supporting pytest-json, JUnit XML, AOS harness |
| 2025-12-06 | Wired rate_limit_dependency into /simulate and /replay endpoints |
| 2025-12-06 | **PIN-038 Upstash Redis Integration** - Production Redis at on-sunbeam-19994.upstash.io |
| 2025-12-06 | **PIN-037 Grafana Cloud Integration** - Dashboards + metrics at agenticverz.grafana.net |
| 2025-12-06 | **PIN-036 Infrastructure Pending Items** - Tracking M9/M11 dependencies |
| 2025-12-06 | **agenticverz.com Integrations Complete** - YouTube, Loom, Slack, Grafana Cloud |
| 2025-12-06 | Updated sdk_packaging_checklist.md to COMPLETE |
| 2025-12-06 | Added External Integrations section to INDEX.md |
| 2025-12-06 | Grafana Cloud dashboard created with Slack alerting |
| 2025-12-06 | Landing page live at https://agenticverz.com |
| 2025-12-05 | **SDK Package Registry PUBLISHED** - aos-sdk v0.1.0 live on PyPI and npm |
| 2025-12-05 | Created `sdk/python/aos_sdk/` with AOSClient, CLI, machine-native APIs |
| 2025-12-05 | Created `sdk/js/aos-sdk/` with TypeScript types and full ESM/CJS support |
| 2025-12-05 | Created CI workflows: `publish-python-sdk.yml`, `publish-js-sdk.yml` |
| 2025-12-05 | Added Vault path `agenticverz/package-registry` for PyPI/npm tokens |
| 2025-12-05 | Verified: Python SDK installs, CLI works (`aos version`), imports work |
| 2025-12-05 | Verified: JS SDK builds, CJS/ESM dual build, TypeScript types included |
| 2025-12-05 | **HashiCorp Vault Deployed** - Secrets management operational at 127.0.0.1:8200 |
| 2025-12-05 | Migrated secrets to Vault KV v2: app-prod, database, external-apis, keycloak-admin |
| 2025-12-05 | Created Vault client `backend/app/secrets/vault_client.py` for app integration |
| 2025-12-05 | Created rotation script `scripts/ops/vault/rotate_secret.sh` - verified working |
| 2025-12-05 | Updated `.env.example` - no plaintext secrets, references Vault paths |
| 2025-12-05 | **RBAC + Keycloak VERIFIED** - Full integration test suite passed |
| 2025-12-05 | Verified: Token acquisition, role extraction (admin), read/write auth, unauthorized blocked |
| 2025-12-05 | Created test script `scripts/smoke/test_rbac_keycloak.sh` for RBAC verification |
| 2025-12-05 | **M8 Auth Integration COMPLETE** - Keycloak live at auth-dev.xuniverz.com |
| 2025-12-05 | Deployed Keycloak with PostgreSQL persistence (nova_db, keycloak database) |
| 2025-12-05 | Created agentiverz-dev realm with aos-backend OIDC client |
| 2025-12-05 | Implemented OIDC provider (`backend/app/auth/oidc_provider.py`) - JWKS validation |
| 2025-12-05 | Wired OIDC to RBAC middleware - Keycloak tokens now work with AOS API |
| 2025-12-05 | Added PyJWT + cryptography for RS256 signature verification |
| 2025-12-05 | Created Apache vhost for auth-dev.xuniverz.com with TLS (Cloudflare Origin) |
| 2025-12-05 | Verified Cloudflare proxy enabled (cf-ray header present) |
| 2025-12-05 | **PIN-009 Auth Blocker RESOLVED** - Real auth provider now wired |
| 2025-12-05 | Test user devuser created with admin role, API calls verified working |
| 2025-12-05 | **Hygiene Automation** - Created session_start.sh, hygiene_check.sh, weekly cron |
| 2025-12-05 | Updated CLAUDE.md with Session Start Protocol (MANDATORY) |
| 2025-12-05 | **M8 Working Environment Created** - `agentiverz_mn/` with 7 focused context files |
| 2025-12-05 | Created checklists: auth_integration, sdk_packaging, demo, repo_snapshot |
| 2025-12-05 | Added M8 Working Environment section to INDEX.md |
| 2025-12-05 | **PIN-033 M8-M14 Machine-Native Realignment Roadmap** - Created recovery roadmap addressing strategic drift |
| 2025-12-05 | Updated INDEX.md with M8-M14 roadmap summary, revised planned PINs |
| 2025-12-05 | ✅ **PIN-032 M7 RBAC Enablement** - ENFORCED |
| 2025-12-05 | Fixed docker-compose.yml: added RBAC_ENFORCE, MACHINE_SECRET_TOKEN env vars |
| 2025-12-05 | Fixed main.py: registered RBACMiddleware |
| 2025-12-05 | Created one-click enablement script: `scripts/ops/rbac_oneclick_enable.sh` |
| 2025-12-05 | Created Grafana M7 dashboard: `monitoring/dashboards/m7_rbac_memory_dashboard.json` |
| 2025-12-05 | Created integration tests: `backend/tests/integration/test_m7_rbac_memory.py` |
| 2025-12-05 | Added drift detection metrics to memory_service.py and costsim.py |
| 2025-12-05 | PgBouncer load test: 50 clients, 400 TPS, 0 failures |
| 2025-12-05 | Smoke tests: 12 passed, 0 failed, RBAC enforcement verified |
| 2025-12-05 | RBAC_ENFORCE=true enabled in production |
| 2025-12-05 | **Session 2:** Fixed RBAC audit write errors (generator session handling in rbac_engine.py) |
| 2025-12-05 | **Session 2:** Fixed smoke script auth (uses machine token for RBAC info endpoint) |
| 2025-12-05 | **Session 2:** Added --non-interactive mode to one-click script (for CI/CD) |
| 2025-12-05 | **Session 2:** Fixed integration tests for RBAC enforcement (18 passed, 2 skipped) |
| 2025-12-05 | **Session 2:** Created chaos scripts: kill_child.sh, redis_stall.sh, cpu_spike.sh |
| 2025-12-05 | **Session 2:** Created GitHub Actions nightly smoke workflow (m7-nightly-smoke.yml) |
| 2025-12-05 | **Session 2:** Created runbooks: RBAC_INCIDENTS.md, MEMORY_PIN_CLEANUP.md |
| 2025-12-05 | **Session 2:** Created m7_monitoring_check.sh for 24-48h stabilization |
| 2025-12-05 | **Session 2:** Decision: Machine role keeps least privilege (no delete permission) |
| 2025-12-05 | **Session 2:** Decision: Drift detection deferred to post-M8 (collect metrics, alerts disabled) |
| 2025-12-05 | **Session 2:** 0h monitoring baseline: audit_writes=22 success/0 error, memory_ops=41 success/0 error |
| 2025-12-04 | ✅ **PIN-031 M7 Memory Integration** - COMPLETE |
| 2025-12-04 | **Session 3:** Seed script, memory audit, TTL job, DELETE test - all complete |
| 2025-12-04 | Created: seed_memory_pins.py, memory_pins_seed.json (7 pins), expire_memory_pins.sh |
| 2025-12-04 | Wired memory audit logging into API, verified entries in system.memory_audit |
| 2025-12-04 | Full test suite: 1038 passed, 2 flaky, 13 skipped |
| 2025-12-04 | **Session 2 Fixes:** Migration chain (010 down_revision), PyJWT dep, SQL binding |
| 2025-12-04 | Verified: POST/GET/LIST/DELETE memory pins, RBAC info/matrix/reload, Prometheus metrics |
| 2025-12-04 | Database tables: system.memory_pins, rbac_audit, memory_audit |
| 2025-12-04 | Created memory_pins migration (009), API, RBAC middleware, Prometheus CI |
| 2025-12-04 | Created alert fuzzer, RBAC tests, replay parity tests |
| 2025-12-04 | Updated feature flags: memory_pins_enabled, rbac_enforce, chaos_allowed |
| 2025-12-04 | ✅ **PIN-030 M6.5 Live Runtime Validation** - Rate limit 429s confirmed, Prometheus metrics verified |
| 2025-12-04 | ✅ Pushed to GitHub: `feature/m4.5-failure-catalog-integration` branch |
| 2025-12-04 | ✅ **PIN-030 M6.5 Internal Validation COMPLETE** - 75 tests pass, K8s ready |
| 2025-12-04 | Created 4 new test files: chaos, readiness probe, metric fuzzer, log correlation |
| 2025-12-04 | Fixed asyncio deprecation: replaced `get_event_loop().run_until_complete()` with `asyncio.run()` |
| 2025-12-04 | Fixed FastAPI dependency override for database mocking in tests |
| 2025-12-04 | Fixed rate limit test: override `RATE_LIMIT_RPM` module constant for predictable behavior |
| 2025-12-04 | Updated K8s manifests: readiness probe `/ready`, added `REDIS_URL`, `RATE_LIMIT_RPM` |
| 2025-12-04 | Redis chaos test verified: fail-open behavior confirmed (webhooks accepted when Redis down) |
| 2025-12-04 | Readiness probe JSON format verified: `{"status":"ok","redis":"ok","version":"v1","uptime_seconds":N}` |
| 2025-12-04 | ⏳ **PIN-030 Internal Gating: 5/9 PASSED** - Remaining 4 require K8s deployment |
| 2025-12-04 | Fixed pytest_asyncio fixture decorator for async tests |
| 2025-12-04 | Fixed Redis close() deprecation → aclose() |
| 2025-12-04 | Fixed kustomize base structure (moved manifests to k8s/base/) |
| 2025-12-04 | Added `/ready` endpoint with Redis connectivity check |
| 2025-12-04 | Passed: Unit tests (21/21), kustomize validation, CI YAML, security checks |
| 2025-12-04 | Pending: Deploy staging, rate-limit runtime, Prometheus scrape, CronJob test |
| 2025-12-04 | ✅ **PIN-030: M6.5 Webhook Externalization Implementation COMPLETE** |
| 2025-12-04 | Created Redis-backed rate limiter (`tools/webhook_receiver/app/rate_limiter.py`) |
| 2025-12-04 | Integrated prometheus_client metrics in webhook receiver main.py |
| 2025-12-04 | Created kustomize overlay for staging (`k8s/overlay-staging/kustomization.yaml`) |
| 2025-12-04 | Created CI workflow (`build-push-webhook.yml`) for Docker image build/push |
| 2025-12-04 | Created deploy-staging.sh script with secrets, kustomize, smoke tests |
| 2025-12-04 | Created rate limiter unit tests (`tests/test_rate_limiter.py`) |
| 2025-12-04 | Created webhook operations runbook (`docs/runbooks/webhook-ops.md`) |
| 2025-12-04 | ✅ **PIN-029 Session 2: Critical Risks Addressed** |
| 2025-12-04 | Fixed WireMock mapping UUID issue (removed invalid `id` fields) |
| 2025-12-04 | Removed `\|\| true` from CI e2e job (now blocks on failure) |
| 2025-12-04 | Created Prometheus scrape config (`prometheus/scrape-config.yaml`) |
| 2025-12-04 | Created Grafana dashboard (`grafana/webhook-receiver-dashboard.json`) |
| 2025-12-04 | Created deployment guide (`DEPLOYMENT.md`) with security checklist |
| 2025-12-04 | ✅ **PIN-029: Infrastructure Hardening & CI Fixes** - 10 items addressed |
| 2025-12-04 | Fixed 39 `datetime.utcnow()` deprecation warnings across codebase |
| 2025-12-04 | Created `docker-compose.staging.yml` for webhook receiver deployment |
| 2025-12-04 | Created K8s manifests (8 files) in `tools/webhook_receiver/k8s/` |
| 2025-12-04 | Split WireMock mappings into individual JSON files for CI |
| 2025-12-04 | Added rate limiting to webhook receiver (slowapi, 100 RPM default) |
| 2025-12-04 | Updated CI workflow: WireMock via docker run, new E2E job |
| 2025-12-04 | Changed skipped tests to conditional skipif (RUN_E2E_TESTS) |
| 2025-12-04 | ✅ **PIN-028: M6 Critical Gaps Fixed** - 6 critical gaps addressed |
| 2025-12-04 | Created `cb_sync_wrapper.py` - Thread-safe sync wrapper for async CB functions |
| 2025-12-04 | Fixed auto-recovery with SELECT FOR UPDATE to prevent TOCTOU race |
| 2025-12-04 | Created `scripts/backfill_provenance.py` - Provenance backfill CLI tool |
| 2025-12-04 | Added 7 Prometheus metrics for CB events (disabled, incidents, queue, failures) |
| 2025-12-04 | Verified leader election implementation (PostgreSQL advisory locks) |
| 2025-12-04 | Updated CI with `costsim-integration` job (real PostgreSQL + Alertmanager) |
| 2025-12-04 | Added 8 CostSim alert rules to `ops/prometheus_rules/alerts.yml` |
| 2025-12-04 | Fixed PgBouncer + asyncpg prepared statement conflict in `db_async.py` |
| 2025-12-04 | Fixed Alembic migration revision IDs (shortened to ≤32 chars) |
| 2025-12-04 | ✅ **M6 IMPLEMENTATION COMPLETE** - All 8 mandatory deliverables implemented (PIN-026) |
| 2025-12-04 | Created PIN-026: M6 Implementation Complete report |
| 2025-12-04 | Created PIN-025: M6 Implementation Plan (Authoritative spec) |
| 2025-12-04 | Implemented CostSim V2 sandbox path (`backend/app/costsim/` - 11 files) |
| 2025-12-04 | Implemented 6 Prometheus metrics for drift detection |
| 2025-12-04 | Created P1/P2/P3 alert rules (`monitoring/rules/costsim_v2_alerts.yml`) |
| 2025-12-04 | Implemented status_history API with CSV/JSONL export |
| 2025-12-04 | Implemented cost divergence report endpoint |
| 2025-12-04 | Created 5 reference datasets for V2 validation |
| 2025-12-04 | Created Helm chart (`helm/aos/`) with liveness/readiness/startup probes |
| 2025-12-04 | Created K8s sandbox namespace (`k8s/costsim-v2-namespace.yaml`) |
| 2025-12-04 | Implemented tenant context middleware for isolation |
| 2025-12-04 | ❌ **"M6 COMPLETE" CLAIM REJECTED** - Did not meet authoritative gate criteria |
| 2025-12-04 | Gap analysis: M6 at ~6% compliance, requires 11-18 weeks of genuine work |
| 2025-12-04 | Previous work reclassified as **M5.6 Observability Groundwork** |
| 2025-12-04 | PIN-024 rewritten with full M6 authoritative requirements |
| 2025-12-04 | M6 requires: CostSim V2, Drift Detection, status_history API, Divergence Reports, 5 Datasets |
| 2025-12-04 | ~~✅ M6 Feature Freeze & Observability COMPLETE~~ (SUPERSEDED) |
| 2025-12-04 | Created metrics wiring integration tests (15 tests) - now classified as M5.6 |
| 2025-12-04 | Metrics wiring, replay endpoint, traces - now classified as M5.6 |
| 2025-12-04 | Created `docs/v1_feature_freeze.md` - now classified as M5.6 |
| 2025-12-04 | Created tracing infrastructure: `backend/app/traces/` - now classified as M5.6 |
| 2025-12-04 | Created `docs/replay_scope.md` - now classified as M5.6 |
| 2025-12-04 | Implemented `runtime.replay()` API - now classified as M5.6 |
| 2025-12-04 | Created 17 runtime determinism tests - now classified as M5.6 |
| 2025-12-04 | ✅ **M5.5 Machine-Native APIs COMPLETE** - All primitives now exposed |
| 2025-12-04 | Implemented `POST /api/v1/runtime/simulate` - Plan simulation working |
| 2025-12-04 | Implemented `POST /api/v1/runtime/query` - Runtime queries working |
| 2025-12-04 | Implemented `GET /api/v1/runtime/capabilities` - Skill/budget/rate-limit info |
| 2025-12-04 | Created `aos` CLI at `/usr/local/bin/aos` (simulate, skills, capabilities, query) |
| 2025-12-04 | Fixed Python SDK - Added machine-native methods, 10/10 tests passing |
| 2025-12-04 | 60-second demo scenario verified in SDK tests |
| 2025-12-04 | Maturity upgraded: L2 → L4 (Machine-native primitives exposed) |
| 2025-12-04 | Strategic drift CORRECTED - vision/reality now aligned |
| 2025-12-04 | **PIN-023 Comprehensive Feedback Analysis** - Strategic consistency review completed |
| 2025-12-04 | DRIFT DETECTED: M5 scope mutation from machine-native to operational features |
| 2025-12-04 | Added M5.5 Machine-Native APIs to roadmap as NEXT priority |
| 2025-12-04 | Updated external rollout tracker (PIN-009) with strategic context |
| 2025-12-04 | Recommended path: Operational GA → M5.5 → SDK fix → True GA |
| 2025-12-03 | **PIN-022 M5 Ops Deployment Session** - RBAC enabled, PgBouncer deployed (port 6432), webhook key v1 created |
| 2025-12-03 | Updated Claude permissions: +15 entries for aos dirs, scripts/smoke, scripts/ops/webhook, mkdir commands |
| 2025-12-03 | **PIN-021 M5 Policy API Completion** - M5 COMPLETE: 6 endpoints, DB persistence, escalation, 17 alerts |
| 2025-12-03 | **PIN-020 M4 Final Signoff** - M4 SIGNED OFF: 24h shadow run, 2829 cycles, 0 mismatches |
| 2025-12-03 | Fixed 12 issues: connection pool, alembic container, indexes, Prometheus permissions |
| 2025-12-03 | Created M5_POLICY_RUNBOOK.md, WEBHOOK_SECRET_ROTATION.md runbooks |
| 2025-12-03 | Load test: 100% success at 10 concurrent (p95=293ms), escalation verified (16 requests) |
| 2025-12-02 | **PIN-019 AOS Brainstorm & Revised Milestones** - Comprehensive roadmap review |
| 2025-12-02 | Identified M4 P0 blockers not addressed, M5 scope conflict, SDK broken |
| 2025-12-02 | Proposed: Insert M4.1 (P0 fixes), split M6 into M6a/b/c, add SDK repair time |
| 2025-12-02 | Created ops-suite-overview.md, seed-determinism.md, M4-summary.md, M5-SPEC.md |
| 2025-12-02 | Created failure_catalog.schema.json, recovery_modes.md (M5 groundwork) |
| 2025-12-02 | Consistency sweep: verified all PIN paths, script paths, runbook paths |
| 2025-12-02 | **PIN-018 M4 Incident & Ops Readiness** - Playbook, self-sign checklist, golden retention |
| 2025-12-02 | Created incident playbook, self-sign runbook (20 items), golden_retention.sh script |
| 2025-12-02 | Shadow run T+1h10m: 138 cycles, 1242 workflows, 0 mismatches |
| 2025-12-02 | **PIN-017 M4 Monitoring Infrastructure** - Daemon, debug console, cron check documented |
| 2025-12-02 | Shadow run T+1h: 119 cycles, 1071 workflows, 0 mismatches |
| 2025-12-02 | **PIN-016 Updated** - Added monitoring daemon, debug console, cron check documentation |
| 2025-12-02 | Shadow run T+58min: 115 cycles, 1035 workflows, 0 mismatches |
| 2025-12-02 | **PIN-016 Updated** - Added session summary: 7 issues, 7 decisions, 6 fixes, 5 pending items |
| 2025-12-02 | **PIN-016 M4 Operations Tooling & Runbook** - Scripts, runbook, completion template |
| 2025-12-02 | Created golden_diff_debug.py, shadow_sanity_check.sh, disable-workflows.sh |
| 2025-12-02 | Created M4 workflow engine runbook with tabletop exercise checklist |
| 2025-12-02 | Fixed mismatch grep false positive in shadow_sanity_check.sh |
| 2025-12-02 | **PIN-015 M4 Validation & Maturity Gates** - 24h shadow run started, all pre-gates PASS |
| 2025-12-02 | Fixed bash arithmetic bug in `run_shadow_simulation.sh` (exit code 1 on zero result) |
| 2025-12-02 | Completed Phase A-E validation (except 24h shadow), 22,500 determinism iterations |
| 2025-12-01 | **PIN-014 M4 Technical Review** - Identified 5 P0 blockers, 7 P1 issues. Conditional pass. |
| 2025-12-01 | **M4 COMPLETE** - 599 tests, Workflow Engine v1 (PIN-013) |
| 2025-12-01 | **M3-M3.5 COMPLETE** - 554 tests, 0 xfailed (PIN-012) |
| 2025-12-01 | Added PIN-012: M3-M3.5 Completion & M4 Prep Report |
| 2025-12-01 | Created M4 specification (`docs/milestones/M4-SPEC.md`) |
| 2025-12-01 | Added Prometheus alerts (25 rules), Grafana dashboards (3) |
| 2025-12-01 | Added CI/CD pipelines with mandatory smoke tests |
| 2025-12-01 | Added chaos tests (9), replay certification (12) |
| 2025-12-01 | Created http_call contract YAML, fixed local URL behavior |
| 2025-12-01 | Fixed datetime.utcnow() deprecation (25+ occurrences) |
| 2025-12-01 | Fixed @validator deprecation, event loop issues |
| 2025-12-01 | M2.5 Hardening COMPLETE - 246 tests total passing (PIN-011) |
| 2025-12-01 | Added Contract Compatibility Matrix, Planner Stress Tests, Golden Files |
| 2025-12-01 | Fixed A1-A4 blockers: is_retryable(), ResourceContract, status_code, lazy imports |
| 2025-12-01 | M2.5 Planner Abstraction COMPLETE - 113 tests total passing |
| 2025-12-01 | Added PlannerInterface, StubPlanner, canonical JSON, version-gating |
| 2025-12-01 | Fixed INFRA-001 (CLOSE_WAIT leak), added runtime invariants tests |
| 2025-12-01 | Added PIN-010 M2 Completion Report - 78 tests passing |
| 2025-12-01 | M2 Skill Registration + Stubs COMPLETE - 78 tests total passing |
| 2025-12-01 | M1 Runtime Interfaces COMPLETE - 27 tests passing |
| 2025-12-01 | Added PIN-009 M0 Finalization Report - FINALIZED milestone |
| 2025-12-01 | Added PIN-008 v1 Milestone Plan (Full Detail) - PRIMARY reference |
| 2025-12-01 | Added PIN-007 v1 Milestone Plan (Summary) |
| 2025-12-01 | Added PIN-006 Execution Plan Review & Realistic Roadmap |
| 2025-12-01 | Added PIN-005 Machine-Native Architecture & Strategic Review |
| 2025-11-30 | Added PIN-004 Phase 4 & 5 Completion, updated Quick Reference |
| 2025-11-30 | Added PIN-003 Phase 3 Completion |
| 2025-11-30 | Created index with PIN-001 and PIN-002 |

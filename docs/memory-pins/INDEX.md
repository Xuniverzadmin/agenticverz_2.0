# Memory PIN Index

**Project:** AOS / Agenticverz 2.0
**Last Updated:** 2025-12-04 (M6.5 Internal Validation - ✅ ALL TESTS PASS)

---

## What are Memory PINs?

Memory PINs are persistent knowledge documents that capture:
- Architecture decisions
- Project status snapshots
- Technical specifications
- Roadmaps and priorities
- Implementation patterns

They serve as **context anchors** for AI assistants and team members to quickly understand project state.

---

## Active PINs

| Serial | Title | Category | Status | Updated |
|--------|-------|----------|--------|---------|
| [PIN-001](PIN-001-aos-roadmap-status.md) | AOS Platform Status & Roadmap | Architecture / Roadmap | Active | 2025-11-30 |
| [PIN-002](PIN-002-critical-review.md) | Critical Review - AOS Architecture & Plan | Architecture Review | Active | 2025-11-30 |
| [PIN-003](PIN-003-phase3-completion.md) | Phase 3 Completion - Production Hardening | Architecture / Milestone | Active | 2025-11-30 |
| [PIN-004](PIN-004-phase4-phase5-completion.md) | Phase 4 & 5 Completion - Security Hardening | Architecture / Milestone | Active | 2025-11-30 |
| [PIN-005](PIN-005-machine-native-architecture.md) | Machine-Native Architecture & Strategic Review | Architecture / Strategy | **PRIMARY** | 2025-12-01 |
| [PIN-006](PIN-006-execution-plan-review.md) | Execution Plan Review & Realistic Roadmap | Architecture / Planning | Active | 2025-12-01 |
| [PIN-007](PIN-007-v1-milestone-plan.md) | v1 Milestone Plan (Summary) | Architecture / Planning | Active | 2025-12-01 |
| [PIN-008](PIN-008-v1-milestone-plan-full.md) | **v1 Milestone Plan (Full Detail)** | Architecture / Specification | **PRIMARY** | 2025-12-01 |
| [PIN-009](PIN-009-m0-finalization-report.md) | **M0 Finalization Report** | Milestone / Finalization | **FINALIZED** | 2025-12-01 |
| [PIN-010](PIN-010-m2-completion-report.md) | **M2 Completion Report** | Milestone / Completion | **COMPLETE** | 2025-12-01 |
| [PIN-011](PIN-011-m2.5-hardening-report.md) | **M2.5 Hardening Report** | Milestone / Hardening | **COMPLETE** | 2025-12-01 |
| [PIN-012](PIN-012-m3-m35-completion-m4-prep.md) | **M3-M3.5 Completion & M4 Prep** | Milestone / Completion | **COMPLETE** | 2025-12-01 |
| [PIN-013](PIN-013-m4-workflow-engine-completion.md) | **M4 Workflow Engine v1 Completion** | Milestone / Completion | **COMPLETE** | 2025-12-01 |
| [PIN-014](PIN-014-m4-technical-review.md) | **M4 Technical Review - Issues & Fixes** | Architecture / Review | **ACTIVE** | 2025-12-01 |
| [PIN-015](PIN-015-m4-validation-maturity-gates.md) | **M4 Validation & Maturity Gates** | Milestone / Validation | **IN PROGRESS** | 2025-12-02 |
| [PIN-016](PIN-016-m4-ops-tooling-runbook.md) | **M4 Operations Tooling & Runbook** | Operations / Tooling | **COMPLETE** | 2025-12-02 |
| [PIN-017](PIN-017-m4-monitoring-infrastructure.md) | **M4 Monitoring Infrastructure** | Operations / Monitoring | **COMPLETE** | 2025-12-02 |
| [PIN-018](PIN-018-m4-incident-ops-readiness.md) | **M4 Incident & Ops Readiness** | Operations / Incident Response | **COMPLETE** | 2025-12-02 |
| [PIN-019](PIN-019-aos-brainstorm-revised-milestones.md) | **AOS Brainstorm & Revised Milestones** | Planning / Strategic Review | **ACTIVE** | 2025-12-02 |
| [PIN-020](PIN-020-m4-final-signoff.md) | **M4 Final Signoff** | Milestone / Signoff | **COMPLETE** | 2025-12-03 |
| [PIN-021](PIN-021-m5-policy-api-completion.md) | **M5 Policy API Completion** | Milestone / Completion | **COMPLETE** | 2025-12-03 |
| [PIN-022](PIN-022-m5-ops-deployment-session.md) | **M5 Ops Deployment Session** | Operations / Deployment | **COMPLETE** | 2025-12-03 |
| [PIN-023](PIN-023-comprehensive-feedback-analysis.md) | **Comprehensive Feedback Analysis** | Strategic Review / Quality Gate | **ACTIVE** | 2025-12-04 |
| [PIN-024](PIN-024-m6-specification.md) | **M6 Feature Freeze & Observability** | Milestone / Specification | **SUPERSEDED** by PIN-025 | 2025-12-04 |
| [PIN-025](PIN-025-m6-implementation-plan.md) | **M6 Implementation Plan (Authoritative)** | Milestone / Implementation | **COMPLETE** | 2025-12-04 |
| [PIN-026](PIN-026-m6-implementation-complete.md) | **M6 Implementation Complete** | Milestone / Completion | **COMPLETE** | 2025-12-04 |
| [PIN-027](PIN-027-m6-critical-fixes.md) | **M6 Critical Fixes - Async Infrastructure** | Milestone / Implementation | **COMPLETE** | 2025-12-04 |
| [PIN-028](PIN-028-m6-critical-gaps-fixes.md) | **M6 Critical Gaps & Fixes** | Milestone / Implementation | **COMPLETE** | 2025-12-04 |
| [PIN-029](PIN-029-infra-hardening-ci-fixes.md) | **Infrastructure Hardening & CI Fixes** | Infrastructure / CI / Operations | **COMPLETE** (pending: deploy) | 2025-12-04 |
| [PIN-030](PIN-030-m6.5-webhook-externalization.md) | **M6.5 Webhook Externalization** | Milestone / Implementation | **VALIDATED** | 2025-12-04 |

---

## External Rollout Tracker

**Location:** `/root/agenticverz2.0/memory-pins/PIN-009-EXTERNAL-ROLLOUT-PENDING.md`

See also: PIN-023 for strategic context on "Operational GA" vs "Machine-Native GA".

---

## Planned PINs

| Serial | Title | Category | Priority |
|--------|-------|----------|----------|
| PIN-030 | M7 Memory Integration Spec | Milestone / Spec | HIGH |
| PIN-031 | SDK Repair & Validation | Technical / Integration | MEDIUM |
| PIN-032 | API Versioning Strategy | Architecture / Spec | MEDIUM |

---

## PIN Categories

- **Architecture / Roadmap** - High-level design and planning
- **Technical Spec** - Detailed implementation specifications
- **Operations** - Deployment, monitoring, incident response
- **Security** - Access control, secrets, hardening
- **Integration** - External APIs, third-party services

---

## PIN Lifecycle

1. **Draft** - Initial creation, under development
2. **Active** - Current and accurate
3. **Superseded** - Replaced by newer PIN
4. **Archived** - Historical reference only

---

## Quick Reference

### Current Project Phase
**M6.5 Webhook Externalization** → ✅ **COMPLETE (2025-12-04)**

**v1 Timeline (~5 months small team, ~8 months solo):**
- M0: Foundations & Contracts (1 week) — **COMPLETE**
- M1-M2.5: Runtime + Skills + Planner (5 weeks) — **COMPLETE**
- M3-M3.5: Core Skills + CLI + Demo (6 weeks) — **COMPLETE**
- M4: Workflow Engine v1 (2 weeks) — **COMPLETE + SIGNED OFF** (PIN-020)
- M5: Policy API & Approval Workflow — **COMPLETE** (PIN-021)
- **M5 Operational GA** — IN PROGRESS (see `/memory-pins/PIN-009-EXTERNAL-ROLLOUT-PENDING.md`)
- **M5.5: Machine-Native APIs** — ✅ **COMPLETE (2025-12-04)** - See PIN-023
- **M5.6: Observability Groundwork** — ✅ **COMPLETE (2025-12-04)** - Reclassified from early M6
- **M6: CostSim V2 + Drift + Audit** — ✅ **COMPLETE (2025-12-04)** - See PIN-026
- **M6.5: Webhook Externalization** — ✅ **COMPLETE (2025-12-04)** - See PIN-030
- M7: Memory Integration — **NEXT** (after M6.5)

### M6 Completion Status

**M6 Feature Freeze & Observability → ✅ COMPLETE (2025-12-04)**

All 8 mandatory deliverables implemented per authoritative PIN-025 specification:

| Requirement | Status | Evidence |
|-------------|--------|----------|
| CostSim V2 Sandbox Path | ✅ COMPLETE | `backend/app/costsim/` - 11 files |
| Drift Detection & Alerts | ✅ COMPLETE | 6 Prometheus metrics, P1/P2/P3 alerts |
| status_history API | ✅ COMPLETE | `GET /status_history`, CSV/JSONL export |
| Cost Divergence Reporting | ✅ COMPLETE | `GET /costsim/divergence` |
| Reference Dataset Validation | ✅ COMPLETE | 5 datasets in `datasets.py` |
| M6a Packaging | ✅ COMPLETE | Helm chart, K8s manifests |
| M6b Isolation Prep | ✅ COMPLETE | Tenant context middleware |
| M6 Exit Tests | ✅ COMPLETE | Exit criteria verified |

**Critical Gaps Fixed (PIN-028):**

| Gap | Status | Fix |
|-----|--------|-----|
| Sync-compatibility hack | ✅ FIXED | Thread-safe `cb_sync_wrapper.py` |
| Auto-recovery race (TOCTOU) | ✅ FIXED | `SELECT FOR UPDATE` in `_try_auto_recover()` |
| Provenance backfill | ✅ FIXED | `scripts/backfill_provenance.py` CLI tool |
| CB event metrics | ✅ FIXED | 7 new Prometheus metrics |
| Leader election | ✅ VERIFIED | PostgreSQL advisory locks correct |
| CI integration tests | ✅ FIXED | `costsim-integration` job with real DB |

**See PIN-026 for implementation details, PIN-028 for critical gaps fixes.**

### M5.5 Status (Remains Valid)

| Expected | Status (2025-12-04) |
|----------|---------------------|
| `runtime.simulate()` | ✅ IMPLEMENTED - `POST /api/v1/runtime/simulate` |
| `runtime.query()` API | ✅ IMPLEMENTED - `POST /api/v1/runtime/query` |
| `aos simulate` CLI | ✅ IMPLEMENTED - Full CLI suite at `/usr/local/bin/aos` |
| Python SDK | ✅ FIXED - 10/10 tests passing, machine-native methods added |

**Current Status:** M5.6 Observability Groundwork COMPLETE. M6 NOT STARTED.

**Remaining for GA:**
1. Wire real auth service (RBAC stub deployed, needs real auth)
2. Complete operational checklist in PIN-009

### M4 Final Status (PIN-020)

**24-Hour Shadow Run:** COMPLETE (2025-12-02 13:12 → 2025-12-03 13:12 CET)

| Metric | Value |
|--------|-------|
| Cycles | 2,829 |
| Workflows | 25,461 |
| Mismatches | **0** |
| Status | **SIGNED OFF** |

### M5 Policy API Status (PIN-021, PIN-022)

| Component | Status |
|-----------|--------|
| Policy sandbox eval | ✅ Done |
| Approval workflow (6 endpoints) | ✅ Done |
| DB persistence (ApprovalRequest) | ✅ Done |
| Escalation cron | ✅ Running |
| Prometheus alerts (17) | ✅ Deployed |
| Load test (10 concurrent) | ✅ PASS (p95=293ms) |
| Runbooks | ✅ Created |
| **RBAC_ENABLED=true** | ✅ Configured |
| **PgBouncer deployed** | ✅ Port 6432 |
| **Webhook key v1** | ✅ Generated |

### Consolidated Ops Suite

**Location:** `docs/ops/ops-suite-overview.md`

All ops tooling consolidated into single reference document.

### M4 Operations Tooling (PIN-016)

| Tool | Purpose | Path |
|------|---------|------|
| Golden Diff Debug | Analyze mismatches | `scripts/stress/golden_diff_debug.py` |
| Shadow Sanity Check | 4-hour health check | `scripts/stress/shadow_sanity_check.sh` |
| Shadow Status | Quick status | `scripts/stress/check_shadow_status.sh` |
| **Shadow Monitor Daemon** | Background monitoring | `scripts/stress/shadow_monitor_daemon.sh` |
| **Shadow Debug Console** | Interactive debugging | `scripts/stress/shadow_debug.sh` |
| **Shadow Cron Check** | 15-min cron job | `scripts/stress/shadow_cron_check.sh` |
| Emergency Stop | Workflow kill switch | `scripts/ops/disable-workflows.sh` |
| M4 Runbook | Operations guide | `docs/runbooks/m4-workflow-engine.md` |

**Active Monitoring:**
- Monitor Daemon: PID 790726, checks every 5 min → `/var/lib/aos/shadow_monitor.log`
- Cron Job: Every 15 min → `/var/lib/aos/shadow_cron_alerts.log`

### Completed Foundation (Pre-Pivot)
- ✅ Phase 1: Runtime Foundation
- ✅ Phase 2A-D: Core Contracts, Planner, Skills, Auth
- ✅ Phase 3: Production Hardening
- ✅ Phase 4: Multi-Step Execution
- ✅ Phase 5: Budget Protection + Prompt-Injection Gate
- ✅ 65 tests passing (97%)

### M4 Status — CONDITIONAL PASS (Review: PIN-014)

**Verdict:** Architecture solid, implementation needs P0 fixes before production.

| Deliverable | Status | Location |
|-------------|--------|----------|
| WorkflowEngine | ✅ Done | `backend/app/workflow/engine.py` |
| CheckpointStore | ⚠️ P0-1 | `backend/app/workflow/checkpoint.py` (sync, needs async) |
| PolicyEnforcer | ⚠️ P1-2 | `backend/app/workflow/policies.py` (per-instance budget) |
| PlannerSandbox | ⚠️ P1-7 | `backend/app/workflow/planner_sandbox.py` (regex escaping) |
| GoldenRecorder | ⚠️ P0-3,5 | `backend/app/workflow/golden.py` (duration leak, atomic write) |
| Engine smoke tests (17) | ✅ Done | `backend/tests/workflow/test_engine_smoke.py` |
| Checkpoint tests (12) | ✅ Done | `backend/tests/workflow/test_checkpoint_store.py` |
| Golden pipeline tests (16) | ✅ Done | `backend/tests/workflow/test_workflow_golden_pipeline.py` |
| Workflow Prometheus alerts (15) | ✅ Done | `monitoring/alerts/workflow-alerts.yml` |
| CI workflow jobs (5) | ✅ Done | `.github/workflows/m4-ci.yml` |

**P0 Blockers (5):**
1. P0-1: Checkpoint methods block event loop (sync SQLAlchemy)
2. P0-2: No exponential backoff/jitter in retry logic
3. P0-3: Duration fields leak into golden output hash
4. P0-4: Inconsistent metric labels (tenant_hash="unknown")
5. P0-5: Golden file signature TOCTOU vulnerability

**See PIN-014 for full review, required fixes, and acceptance gates.**

### M3-M3.5 Status — COMPLETE (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| http_call skill (v0.2.0) | ✅ Done | `backend/app/skills/http_call.py` |
| llm_invoke skill (v0.1.0) | ✅ Done | `backend/app/skills/llm_invoke.py` |
| json_transform skill (v0.1.0) | ✅ Done | `backend/app/skills/json_transform.py` |
| calendar_write skill (v0.1.0) | ✅ Done | `backend/app/skills/calendar_write.py` |
| postgres_query skill (v0.1.0) | ✅ Done | `backend/app/skills/postgres_query.py` |
| http_call contract YAML | ✅ Done | `backend/app/skills/contracts/http_call.yaml` |
| Replay certification (12 tests) | ✅ Done | `backend/tests/workflow/test_replay_certification.py` |
| Registry snapshot test | ✅ Done | `backend/tests/integration/test_registry_snapshot.py` |
| Chaos tests (9 tests) | ✅ Done | `backend/tests/chaos/test_resource_stress.py` |
| Prometheus alerts (25 rules) | ✅ Done | `ops/prometheus_rules/alerts.yml` |
| CI pipeline | ✅ Done | `.github/workflows/ci.yml` |
| Deploy pipeline | ✅ Done | `.github/workflows/deploy.yml` |
| Grafana dashboards (3) | ✅ Done | `ops/grafana/*.json` |
| Smoke release script | ✅ Done | `scripts/smoke_release.sh` |
| M4 specification | ✅ Done | `docs/milestones/M4-SPEC.md` |

### M2.5 Status — COMPLETE + HARDENED (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| PlannerInterface protocol | ✅ Done | `backend/app/planner/interface.py` |
| StubPlanner (deterministic) | ✅ Done | `backend/app/planner/stub_planner.py` |
| LegacyStubPlanner | ✅ Done | `backend/app/planner/stub_planner.py` |
| PlannerRegistry | ✅ Done | `backend/app/planner/interface.py` |
| Planner Determinism Contract | ✅ Done | `backend/app/specs/planner_determinism.md` |
| Canonical JSON Rules | ✅ Done | `backend/app/specs/canonical_json.md` |
| canonical_json utility | ✅ Done | `backend/app/utils/canonical_json.py` |
| Version-Gating + Contract Diffing | ✅ Done | `backend/app/skills/registry_v2.py` |
| INFRA-001 Fix (CLOSE_WAIT) | ✅ Done | `backend/app/worker/runner.py` |
| Planner tests (35) | ✅ Done | `backend/tests/planner/test_interface.py` |
| **Contract Compatibility Matrix** | ✅ Done | `backend/app/specs/contract_compatibility.md` |
| **Planner Stress Tests (16)** | ✅ Done | `backend/tests/planner/test_determinism_stress.py` |
| **Planner Golden Files** | ✅ Done | `backend/tests/golden/planner_*.json` |
| **Canonical JSON in PlannerOutput** | ✅ Done | `backend/app/planner/interface.py` |
| **ErrorCategory.is_retryable()** | ✅ Done | `backend/app/worker/runtime/core.py` |

### M2 Status — COMPLETE (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| SkillRegistry v2 | ✅ Done | `backend/app/skills/registry_v2.py` |
| Versioned skill resolution | ✅ Done | `backend/app/skills/registry_v2.py` |
| Persistence layer (sqlite) | ✅ Done | `backend/app/skills/registry_v2.py` |
| http_call stub | ✅ Done | `backend/app/skills/stubs/http_call_stub.py` |
| llm_invoke stub | ✅ Done | `backend/app/skills/stubs/llm_invoke_stub.py` |
| json_transform stub | ✅ Done | `backend/app/skills/stubs/json_transform_stub.py` |
| IntegratedRuntime | ✅ Done | `backend/app/worker/runtime/integrated_runtime.py` |
| Registry tests (27) | ✅ Done | `backend/tests/skills/test_registry_v2.py` |
| Stub tests (24) | ✅ Done | `backend/tests/skills/test_stubs.py` |
| Lazy imports (TECH-001) | ✅ Done | `backend/app/worker/__init__.py` |

### M1 Status — COMPLETE (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| runtime.execute() | ✅ Done | `backend/app/worker/runtime/core.py` |
| runtime.describe_skill() | ✅ Done | `backend/app/worker/runtime/core.py` |
| runtime.query() | ✅ Done | `backend/app/worker/runtime/core.py` |
| runtime.get_resource_contract() | ✅ Done | `backend/app/worker/runtime/core.py` |
| StructuredOutcome | ✅ Done | `backend/app/worker/runtime/core.py` |
| SkillDescriptor | ✅ Done | `backend/app/worker/runtime/core.py` |
| ResourceContract | ✅ Done | `backend/app/worker/runtime/core.py` |
| Contract dataclasses | ✅ Done | `backend/app/worker/runtime/contracts.py` |
| StubPlanner example | ✅ Done | `backend/app/planner/stub_planner.py` |
| Interface tests (27) | ✅ Done | `backend/tests/runtime/test_m1_runtime.py` |
| Golden files | ✅ Done | `backend/tests/golden/` |
| Acceptance checklist | ✅ Done | `backend/tests/acceptance_runtime.md` |

### M0 Status — FINALIZED (2025-12-01)

| Deliverable | Status | Location |
|-------------|--------|----------|
| StructuredOutcome schema | ✅ Done | `backend/app/schemas/structured_outcome.schema.json` |
| SkillMetadata schema | ✅ Done | `backend/app/schemas/skill_metadata.schema.json` |
| ResourceContract schema | ✅ Done | `backend/app/schemas/resource_contract.schema.json` |
| AgentProfile schema | ✅ Done | `backend/app/schemas/agent_profile.schema.json` |
| Error taxonomy | ✅ Done | `backend/app/specs/error_taxonomy.md` |
| Determinism & Replay spec | ✅ Done | `backend/app/specs/determinism_and_replay.md` |
| CI pipeline | ✅ Done | `.github/workflows/ci.yml` |
| Test scaffold | ✅ Done | `backend/tests/conftest.py`, `backend/tests/README.md` |
| Schema golden files | ✅ Done | `backend/app/schemas/examples/` |
| Dev bootstrap script | ✅ Done | `scripts/bootstrap-dev.sh` |

### CI Guardrails (M0 Finalization)

| CI Job | Purpose |
|--------|---------|
| `lint` | Ruff + mypy type checking |
| `unit` | Schema and unit tests |
| `schema-validation` | JSON Schema draft-07 validation |
| `integration` | Integration tests with mocked services |
| `spec-check` | Verify required specs exist |
| `changelog-check` | Warn on schema changes without changelog |
| `replay-smoke` | Verify deterministic fields in golden files |
| `side-effect-order` | Verify side-effect ordering rules |
| `metadata-drift` | Warn on skill metadata changes without version bump |

### Determinism Spec Highlights

See `backend/app/specs/determinism_and_replay.md` for full details:

- **Field Stability Tables**: Defines which fields must be deterministic
- **Forbidden Fields**: Fields that MUST NOT affect determinism
- **Allowed Nondeterminism Zones**: External API content, LLM output, timing
- **Side-Effect Ordering**: Guaranteed stable order across replays
- **Retry Influence**: How retries affect replay assertions

### Next Immediate Actions

**Priority 1: Begin M7 Memory Integration**
With M6.5 complete, the system is ready for:
- M7: Memory Integration (1 week estimated)
- Production deployment with `COSTSIM_V2_SANDBOX=true` for shadow testing
- Canary validation over 2+ weeks before V2 promotion

**Priority 2: Complete Operational GA (PIN-009)**
1. Wire real auth service (AUTH_SERVICE_URL)
2. Verify backup/restore procedure
3. Run 30+ concurrent load test
4. Complete webhook key security hardening

**Priority 3: M6.5 Internal Validation - ✅ COMPLETE**
All internal validation steps passed:
1. ✅ 75 tests passing (chaos, readiness, fuzzer, log correlation)
2. ✅ Readiness probe JSON format validated: `{"status":"ok","redis":"ok","version":"v1","uptime_seconds":N}`
3. ✅ Redis chaos test passed (fail-open confirmed)
4. ✅ Asyncio deprecation warnings fixed
5. ✅ K8s manifests updated (readiness probe, Redis URL, rate limit config)

**Remaining for K8s Deployment (external gates):**
1. Push to GitHub → trigger `build-push-webhook.yml` → verify image published
2. Deploy: `IMAGE_SHA=<sha> ./tools/webhook_receiver/deploy-staging.sh`
3. Rate-limit test: 120 requests, verify 429s after limit
4. Prometheus: `curl /metrics | grep webhook_`
5. CronJob: Run retention cleanup, verify rows deleted

**Completed Recently:**
- ✅ PIN-030 M6.5 Internal Validation (2025-12-04) - 75 tests pass, chaos verified, K8s ready
- ✅ PIN-030 M6.5 Implementation (2025-12-04) - Redis rate limiter, prometheus_client, deploy script
- ✅ PIN-029 Session 2 (2025-12-04) - WireMock fix, CI blocking, Prometheus/Grafana
- ✅ PIN-029 Session 1 (2025-12-04) - 10 infra items, datetime fixes, K8s manifests
- ✅ M6 Feature Freeze & Observability (2025-12-04) - All 8 deliverables
- ✅ M5.5 Machine-Native APIs (2025-12-04)
- ✅ M5.6 Observability Groundwork (2025-12-04)

### Key Reference Documents

| Document | Path | Purpose |
|----------|------|---------|
| Ops Suite | `docs/ops/ops-suite-overview.md` | All ops tools consolidated |
| Seed Determinism | `docs/workflow/seed-determinism.md` | Determinism proof record |
| M4 Summary | `docs/release-notes/M4-summary.md` | Milestone lock document |
| M5 Spec | `docs/milestones/M5-SPEC.md` | Next milestone spec |
| Webhook Deployment | `tools/webhook_receiver/DEPLOYMENT.md` | Webhook receiver deploy guide |
| Webhook Ops Runbook | `docs/runbooks/webhook-ops.md` | Webhook operations runbook |
| Deploy Script | `tools/webhook_receiver/deploy-staging.sh` | Staging deployment script |
| Prometheus Config | `tools/webhook_receiver/prometheus/scrape-config.yaml` | Webhook Prometheus scrape |
| Grafana Dashboard | `tools/webhook_receiver/grafana/webhook-receiver-dashboard.json` | Webhook monitoring |

### Key Architecture
- **Planner:** Anthropic Claude (`claude-sonnet-4-20250514`)
- **PlannerInterface:** Protocol for planner modularity
- **Rate Limiting:** Redis token bucket (100 req/min per tenant)
- **Concurrency:** Redis semaphore (5 concurrent per agent)
- **Budget:** Multi-layer enforcement (per-run, per-day, per-model, total)
- **Security:** Prompt injection detection, URL sanitization
- **Skills:** http_call, llm_invoke, json_transform, postgres_query, calendar_write
- **Workflow:** WorkflowEngine, CheckpointStore, PolicyEnforcer, PlannerSandbox, GoldenRecorder
- **Tests:** 599 tests passing, 0 xfailed, 20 skipped, 2 warnings (external)
- **Observability:** 40 Prometheus alerts (25 core + 15 workflow), 3 Grafana dashboards
- **CI/CD:** Automated pipelines with mandatory smoke tests

---

## How to Use

### For AI Assistants
When resuming work on this project:
1. Read `INDEX.md` first
2. Read relevant active PINs for context
3. Check PIN status dates for freshness

### For Developers
1. Check INDEX for relevant specs before implementing
2. Update PINs when making architectural changes
3. Create new PINs for major decisions

---

## Changelog

| Date | Change |
|------|--------|
| 2025-12-04 | ✅ **PIN-030 M6.5 Internal Validation COMPLETE** - 75 tests pass, K8s ready |
| 2025-12-04 | Created 4 new test files: chaos, readiness probe, metric fuzzer, log correlation |
| 2025-12-04 | Fixed asyncio deprecation: replaced `get_event_loop().run_until_complete()` with `asyncio.run()` |
| 2025-12-04 | Fixed FastAPI dependency override for database mocking in tests |
| 2025-12-04 | Fixed rate limit test: override `RATE_LIMIT_RPM` module constant for predictable behavior |
| 2025-12-04 | Updated K8s manifests: readiness probe `/ready`, added `REDIS_URL`, `RATE_LIMIT_RPM` |
| 2025-12-04 | Redis chaos test verified: fail-open behavior confirmed (webhooks accepted when Redis down) |
| 2025-12-04 | Readiness probe JSON format verified: `{"status":"ok","redis":"ok","version":"v1","uptime_seconds":N}` |
| 2025-12-04 | ⏳ **PIN-030 Internal Gating: 5/9 PASSED** - Remaining 4 require K8s deployment |
| 2025-12-04 | Fixed pytest_asyncio fixture decorator for async tests |
| 2025-12-04 | Fixed Redis close() deprecation → aclose() |
| 2025-12-04 | Fixed kustomize base structure (moved manifests to k8s/base/) |
| 2025-12-04 | Added `/ready` endpoint with Redis connectivity check |
| 2025-12-04 | Passed: Unit tests (21/21), kustomize validation, CI YAML, security checks |
| 2025-12-04 | Pending: Deploy staging, rate-limit runtime, Prometheus scrape, CronJob test |
| 2025-12-04 | ✅ **PIN-030: M6.5 Webhook Externalization Implementation COMPLETE** |
| 2025-12-04 | Created Redis-backed rate limiter (`tools/webhook_receiver/app/rate_limiter.py`) |
| 2025-12-04 | Integrated prometheus_client metrics in webhook receiver main.py |
| 2025-12-04 | Created kustomize overlay for staging (`k8s/overlay-staging/kustomization.yaml`) |
| 2025-12-04 | Created CI workflow (`build-push-webhook.yml`) for Docker image build/push |
| 2025-12-04 | Created deploy-staging.sh script with secrets, kustomize, smoke tests |
| 2025-12-04 | Created rate limiter unit tests (`tests/test_rate_limiter.py`) |
| 2025-12-04 | Created webhook operations runbook (`docs/runbooks/webhook-ops.md`) |
| 2025-12-04 | ✅ **PIN-029 Session 2: Critical Risks Addressed** |
| 2025-12-04 | Fixed WireMock mapping UUID issue (removed invalid `id` fields) |
| 2025-12-04 | Removed `\|\| true` from CI e2e job (now blocks on failure) |
| 2025-12-04 | Created Prometheus scrape config (`prometheus/scrape-config.yaml`) |
| 2025-12-04 | Created Grafana dashboard (`grafana/webhook-receiver-dashboard.json`) |
| 2025-12-04 | Created deployment guide (`DEPLOYMENT.md`) with security checklist |
| 2025-12-04 | ✅ **PIN-029: Infrastructure Hardening & CI Fixes** - 10 items addressed |
| 2025-12-04 | Fixed 39 `datetime.utcnow()` deprecation warnings across codebase |
| 2025-12-04 | Created `docker-compose.staging.yml` for webhook receiver deployment |
| 2025-12-04 | Created K8s manifests (8 files) in `tools/webhook_receiver/k8s/` |
| 2025-12-04 | Split WireMock mappings into individual JSON files for CI |
| 2025-12-04 | Added rate limiting to webhook receiver (slowapi, 100 RPM default) |
| 2025-12-04 | Updated CI workflow: WireMock via docker run, new E2E job |
| 2025-12-04 | Changed skipped tests to conditional skipif (RUN_E2E_TESTS) |
| 2025-12-04 | ✅ **PIN-028: M6 Critical Gaps Fixed** - 6 critical gaps addressed |
| 2025-12-04 | Created `cb_sync_wrapper.py` - Thread-safe sync wrapper for async CB functions |
| 2025-12-04 | Fixed auto-recovery with SELECT FOR UPDATE to prevent TOCTOU race |
| 2025-12-04 | Created `scripts/backfill_provenance.py` - Provenance backfill CLI tool |
| 2025-12-04 | Added 7 Prometheus metrics for CB events (disabled, incidents, queue, failures) |
| 2025-12-04 | Verified leader election implementation (PostgreSQL advisory locks) |
| 2025-12-04 | Updated CI with `costsim-integration` job (real PostgreSQL + Alertmanager) |
| 2025-12-04 | Added 8 CostSim alert rules to `ops/prometheus_rules/alerts.yml` |
| 2025-12-04 | Fixed PgBouncer + asyncpg prepared statement conflict in `db_async.py` |
| 2025-12-04 | Fixed Alembic migration revision IDs (shortened to ≤32 chars) |
| 2025-12-04 | ✅ **M6 IMPLEMENTATION COMPLETE** - All 8 mandatory deliverables implemented (PIN-026) |
| 2025-12-04 | Created PIN-026: M6 Implementation Complete report |
| 2025-12-04 | Created PIN-025: M6 Implementation Plan (Authoritative spec) |
| 2025-12-04 | Implemented CostSim V2 sandbox path (`backend/app/costsim/` - 11 files) |
| 2025-12-04 | Implemented 6 Prometheus metrics for drift detection |
| 2025-12-04 | Created P1/P2/P3 alert rules (`monitoring/rules/costsim_v2_alerts.yml`) |
| 2025-12-04 | Implemented status_history API with CSV/JSONL export |
| 2025-12-04 | Implemented cost divergence report endpoint |
| 2025-12-04 | Created 5 reference datasets for V2 validation |
| 2025-12-04 | Created Helm chart (`helm/aos/`) with liveness/readiness/startup probes |
| 2025-12-04 | Created K8s sandbox namespace (`k8s/costsim-v2-namespace.yaml`) |
| 2025-12-04 | Implemented tenant context middleware for isolation |
| 2025-12-04 | ❌ **"M6 COMPLETE" CLAIM REJECTED** - Did not meet authoritative gate criteria |
| 2025-12-04 | Gap analysis: M6 at ~6% compliance, requires 11-18 weeks of genuine work |
| 2025-12-04 | Previous work reclassified as **M5.6 Observability Groundwork** |
| 2025-12-04 | PIN-024 rewritten with full M6 authoritative requirements |
| 2025-12-04 | M6 requires: CostSim V2, Drift Detection, status_history API, Divergence Reports, 5 Datasets |
| 2025-12-04 | ~~✅ M6 Feature Freeze & Observability COMPLETE~~ (SUPERSEDED) |
| 2025-12-04 | Created metrics wiring integration tests (15 tests) - now classified as M5.6 |
| 2025-12-04 | Metrics wiring, replay endpoint, traces - now classified as M5.6 |
| 2025-12-04 | Created `docs/v1_feature_freeze.md` - now classified as M5.6 |
| 2025-12-04 | Created tracing infrastructure: `backend/app/traces/` - now classified as M5.6 |
| 2025-12-04 | Created `docs/replay_scope.md` - now classified as M5.6 |
| 2025-12-04 | Implemented `runtime.replay()` API - now classified as M5.6 |
| 2025-12-04 | Created 17 runtime determinism tests - now classified as M5.6 |
| 2025-12-04 | ✅ **M5.5 Machine-Native APIs COMPLETE** - All primitives now exposed |
| 2025-12-04 | Implemented `POST /api/v1/runtime/simulate` - Plan simulation working |
| 2025-12-04 | Implemented `POST /api/v1/runtime/query` - Runtime queries working |
| 2025-12-04 | Implemented `GET /api/v1/runtime/capabilities` - Skill/budget/rate-limit info |
| 2025-12-04 | Created `aos` CLI at `/usr/local/bin/aos` (simulate, skills, capabilities, query) |
| 2025-12-04 | Fixed Python SDK - Added machine-native methods, 10/10 tests passing |
| 2025-12-04 | 60-second demo scenario verified in SDK tests |
| 2025-12-04 | Maturity upgraded: L2 → L4 (Machine-native primitives exposed) |
| 2025-12-04 | Strategic drift CORRECTED - vision/reality now aligned |
| 2025-12-04 | **PIN-023 Comprehensive Feedback Analysis** - Strategic consistency review completed |
| 2025-12-04 | DRIFT DETECTED: M5 scope mutation from machine-native to operational features |
| 2025-12-04 | Added M5.5 Machine-Native APIs to roadmap as NEXT priority |
| 2025-12-04 | Updated external rollout tracker (PIN-009) with strategic context |
| 2025-12-04 | Recommended path: Operational GA → M5.5 → SDK fix → True GA |
| 2025-12-03 | **PIN-022 M5 Ops Deployment Session** - RBAC enabled, PgBouncer deployed (port 6432), webhook key v1 created |
| 2025-12-03 | Updated Claude permissions: +15 entries for aos dirs, scripts/smoke, scripts/ops/webhook, mkdir commands |
| 2025-12-03 | **PIN-021 M5 Policy API Completion** - M5 COMPLETE: 6 endpoints, DB persistence, escalation, 17 alerts |
| 2025-12-03 | **PIN-020 M4 Final Signoff** - M4 SIGNED OFF: 24h shadow run, 2829 cycles, 0 mismatches |
| 2025-12-03 | Fixed 12 issues: connection pool, alembic container, indexes, Prometheus permissions |
| 2025-12-03 | Created M5_POLICY_RUNBOOK.md, WEBHOOK_SECRET_ROTATION.md runbooks |
| 2025-12-03 | Load test: 100% success at 10 concurrent (p95=293ms), escalation verified (16 requests) |
| 2025-12-02 | **PIN-019 AOS Brainstorm & Revised Milestones** - Comprehensive roadmap review |
| 2025-12-02 | Identified M4 P0 blockers not addressed, M5 scope conflict, SDK broken |
| 2025-12-02 | Proposed: Insert M4.1 (P0 fixes), split M6 into M6a/b/c, add SDK repair time |
| 2025-12-02 | Created ops-suite-overview.md, seed-determinism.md, M4-summary.md, M5-SPEC.md |
| 2025-12-02 | Created failure_catalog.schema.json, recovery_modes.md (M5 groundwork) |
| 2025-12-02 | Consistency sweep: verified all PIN paths, script paths, runbook paths |
| 2025-12-02 | **PIN-018 M4 Incident & Ops Readiness** - Playbook, self-sign checklist, golden retention |
| 2025-12-02 | Created incident playbook, self-sign runbook (20 items), golden_retention.sh script |
| 2025-12-02 | Shadow run T+1h10m: 138 cycles, 1242 workflows, 0 mismatches |
| 2025-12-02 | **PIN-017 M4 Monitoring Infrastructure** - Daemon, debug console, cron check documented |
| 2025-12-02 | Shadow run T+1h: 119 cycles, 1071 workflows, 0 mismatches |
| 2025-12-02 | **PIN-016 Updated** - Added monitoring daemon, debug console, cron check documentation |
| 2025-12-02 | Shadow run T+58min: 115 cycles, 1035 workflows, 0 mismatches |
| 2025-12-02 | **PIN-016 Updated** - Added session summary: 7 issues, 7 decisions, 6 fixes, 5 pending items |
| 2025-12-02 | **PIN-016 M4 Operations Tooling & Runbook** - Scripts, runbook, completion template |
| 2025-12-02 | Created golden_diff_debug.py, shadow_sanity_check.sh, disable-workflows.sh |
| 2025-12-02 | Created M4 workflow engine runbook with tabletop exercise checklist |
| 2025-12-02 | Fixed mismatch grep false positive in shadow_sanity_check.sh |
| 2025-12-02 | **PIN-015 M4 Validation & Maturity Gates** - 24h shadow run started, all pre-gates PASS |
| 2025-12-02 | Fixed bash arithmetic bug in `run_shadow_simulation.sh` (exit code 1 on zero result) |
| 2025-12-02 | Completed Phase A-E validation (except 24h shadow), 22,500 determinism iterations |
| 2025-12-01 | **PIN-014 M4 Technical Review** - Identified 5 P0 blockers, 7 P1 issues. Conditional pass. |
| 2025-12-01 | **M4 COMPLETE** - 599 tests, Workflow Engine v1 (PIN-013) |
| 2025-12-01 | **M3-M3.5 COMPLETE** - 554 tests, 0 xfailed (PIN-012) |
| 2025-12-01 | Added PIN-012: M3-M3.5 Completion & M4 Prep Report |
| 2025-12-01 | Created M4 specification (`docs/milestones/M4-SPEC.md`) |
| 2025-12-01 | Added Prometheus alerts (25 rules), Grafana dashboards (3) |
| 2025-12-01 | Added CI/CD pipelines with mandatory smoke tests |
| 2025-12-01 | Added chaos tests (9), replay certification (12) |
| 2025-12-01 | Created http_call contract YAML, fixed local URL behavior |
| 2025-12-01 | Fixed datetime.utcnow() deprecation (25+ occurrences) |
| 2025-12-01 | Fixed @validator deprecation, event loop issues |
| 2025-12-01 | M2.5 Hardening COMPLETE - 246 tests total passing (PIN-011) |
| 2025-12-01 | Added Contract Compatibility Matrix, Planner Stress Tests, Golden Files |
| 2025-12-01 | Fixed A1-A4 blockers: is_retryable(), ResourceContract, status_code, lazy imports |
| 2025-12-01 | M2.5 Planner Abstraction COMPLETE - 113 tests total passing |
| 2025-12-01 | Added PlannerInterface, StubPlanner, canonical JSON, version-gating |
| 2025-12-01 | Fixed INFRA-001 (CLOSE_WAIT leak), added runtime invariants tests |
| 2025-12-01 | Added PIN-010 M2 Completion Report - 78 tests passing |
| 2025-12-01 | M2 Skill Registration + Stubs COMPLETE - 78 tests total passing |
| 2025-12-01 | M1 Runtime Interfaces COMPLETE - 27 tests passing |
| 2025-12-01 | Added PIN-009 M0 Finalization Report - FINALIZED milestone |
| 2025-12-01 | Added PIN-008 v1 Milestone Plan (Full Detail) - PRIMARY reference |
| 2025-12-01 | Added PIN-007 v1 Milestone Plan (Summary) |
| 2025-12-01 | Added PIN-006 Execution Plan Review & Realistic Roadmap |
| 2025-12-01 | Added PIN-005 Machine-Native Architecture & Strategic Review |
| 2025-11-30 | Added PIN-004 Phase 4 & 5 Completion, updated Quick Reference |
| 2025-11-30 | Added PIN-003 Phase 3 Completion |
| 2025-11-30 | Created index with PIN-001 and PIN-002 |

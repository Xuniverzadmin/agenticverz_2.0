# =============================================================================
# INTERACTION SEMANTICS REGISTRY
# =============================================================================
#
# Reference: PIN-321 (L2 â†’ L2.1 Binding Execution)
# Created: 2026-01-06
# Purpose: Declare interaction semantics per frontend-invocable capability
#
# INVARIANTS:
#   - Must align with L1 Constitution (no auto-enforcement, no learned authority)
#   - Ambiguous behavior must be explicitly marked
#   - Semantic classification must be explicit, not inferred
#
# =============================================================================

registry_version: "1.0.0"
created: "2026-01-06"
updated_by: "claude"

# =============================================================================
# SECTION 1: INTERACTION SEMANTICS BY CAPABILITY
# =============================================================================

capabilities:

  # ---------------------------------------------------------------------------
  # CAP-001: REPLAY
  # ---------------------------------------------------------------------------
  replay:
    capability_id: CAP-001
    name: "Execution Replay"

    input_type: query
    output_type: report

    feedback_loop:
      type: closed
      human_required: false
      notes: >
        Replay is a closed feedback loop. Input (incident_id) produces
        deterministic output (historical trace). No human intervention required
        for read operations.

    mutability:
      writes_state: false
      notes: >
        Replay is READ-ONLY. It reads historical traces but never mutates them.
        S6 constitutional guarantee: traces are immutable.

    l1_constitution_alignment:
      no_auto_enforcement: true     # Replay doesn't enforce anything
      no_learned_authority: true    # No ML-based decisions

  # ---------------------------------------------------------------------------
  # CAP-002: COST SIMULATION
  # ---------------------------------------------------------------------------
  cost_simulation:
    capability_id: CAP-002
    name: "Cost Simulation V2"

    input_type: proposal
    output_type: recommendation

    feedback_loop:
      type: open
      human_required: false
      notes: >
        Cost simulation is advisory. Input (simulation request) produces
        recommendation (cost estimate). Recommendation does not auto-execute.

    mutability:
      writes_state: false
      notes: >
        Cost simulation is pure computation. No state mutations.
        ProvenanceLog records are audit trail, not execution state.

    l1_constitution_alignment:
      no_auto_enforcement: true     # Advisory only
      no_learned_authority: true    # No ML-based decisions (deterministic cost model)

  # ---------------------------------------------------------------------------
  # CAP-003: POLICY PROPOSALS
  # ---------------------------------------------------------------------------
  policy_proposals:
    capability_id: CAP-003
    name: "Policy Proposals"

    input_type: query
    output_type: report

    feedback_loop:
      type: open
      human_required: true
      notes: >
        Policy proposals require human approval. Viewing proposals is
        informational. Approval/rejection is a separate action requiring
        founder intervention.

    mutability:
      writes_state: false
      notes: >
        READ-ONLY capability. Proposals are generated by analytics engine,
        not created by API calls.

    l1_constitution_alignment:
      no_auto_enforcement: true     # Proposals don't auto-apply
      no_learned_authority: true    # Human approval mandatory

  # ---------------------------------------------------------------------------
  # CAP-004: PREDICTION PLANE (C2)
  # ---------------------------------------------------------------------------
  prediction_plane:
    capability_id: CAP-004
    name: "C2 Prediction Plane"

    input_type: query
    output_type: report

    feedback_loop:
      type: open
      human_required: false
      notes: >
        Predictions are informational only. Zero side-effects.
        PB-S5 invariant: predictions never modify execution.

    mutability:
      writes_state: false
      notes: >
        Pure READ. Predictions are advisory signals with no execution authority.

    l1_constitution_alignment:
      no_auto_enforcement: true     # Advisory only
      no_learned_authority: true    # Predictions inform, don't decide
      notes: >
        CRITICAL: Predictions MUST NOT influence execution paths.
        This is a constitutional constraint (PB-S5).

  # ---------------------------------------------------------------------------
  # CAP-005: FOUNDER CONSOLE
  # ---------------------------------------------------------------------------
  founder_console:
    capability_id: CAP-005
    name: "Founder Console"

    input_type: command          # Founder actions are commands
    output_type: state           # Returns system state

    feedback_loop:
      type: closed
      human_required: true       # Founder is the human
      notes: >
        Founder console is a human-in-the-loop control plane.
        All actions require explicit founder invocation.

    mutability:
      writes_state: true
      notes: >
        Founder actions CAN mutate state (freeze, throttle, approve).
        All mutations are RBAC-gated and audited.

    l1_constitution_alignment:
      no_auto_enforcement: true     # Founder decides, not system
      no_learned_authority: true    # Human authority, not ML

  # ---------------------------------------------------------------------------
  # CAP-009: POLICY ENGINE
  # ---------------------------------------------------------------------------
  policy_engine:
    capability_id: CAP-009
    name: "Policy Engine"

    input_type: query
    output_type: report

    feedback_loop:
      type: closed
      human_required: false
      notes: >
        Policy queries are read-only. Policy evaluation happens at execution
        time, not at query time.

    mutability:
      writes_state: false
      notes: >
        Frontend READ-ONLY. Policy mutations require founder approval
        and are not exposed to frontend.

    l1_constitution_alignment:
      no_auto_enforcement: true     # Policies displayed, not enforced by frontend
      no_learned_authority: true    # Constitutional policies, not ML-derived

  # ---------------------------------------------------------------------------
  # CAP-011: GOVERNANCE ORCHESTRATION
  # ---------------------------------------------------------------------------
  governance_orchestration:
    capability_id: CAP-011
    name: "Governance Orchestration"

    input_type: command          # Approval/rejection are commands
    output_type: state           # Returns governance state

    feedback_loop:
      type: closed
      human_required: true       # Founder approval required
      notes: >
        Governance orchestration is founder-controlled.
        All approval/rejection actions require explicit human decision.

    mutability:
      writes_state: true
      notes: >
        Approval/rejection mutates governance state.
        All mutations are RBAC-gated (founder only) and audited.

    l1_constitution_alignment:
      no_auto_enforcement: true     # Human approval, not auto
      no_learned_authority: true    # Founder authority

  # ---------------------------------------------------------------------------
  # CAP-014: MEMORY SYSTEM
  # ---------------------------------------------------------------------------
  memory_system:
    capability_id: CAP-014
    name: "Memory System"

    input_type: query
    output_type: report

    feedback_loop:
      type: closed
      human_required: false
      notes: >
        Memory queries are read-only from frontend.
        Memory writes happen via execution, not direct API.

    mutability:
      writes_state: false
      notes: >
        Frontend READ-ONLY. Memory mutations happen during agent execution,
        not via frontend API calls.

    l1_constitution_alignment:
      no_auto_enforcement: true     # Query only
      no_learned_authority: true    # No ML decisions in query path

  # ---------------------------------------------------------------------------
  # CAP-018: INTEGRATION PLATFORM
  # ---------------------------------------------------------------------------
  integration_platform:
    capability_id: CAP-018
    name: "Integration Platform"

    input_type: query
    output_type: report

    feedback_loop:
      type: open
      human_required: false
      notes: >
        Integration status and recovery suggestions are informational.
        Actual integration actions are external (not via frontend).

    mutability:
      writes_state: false
      notes: >
        Frontend READ-ONLY. Write operations are external integration-only.

    l1_constitution_alignment:
      no_auto_enforcement: true     # Informational only
      no_learned_authority: true    # No ML decisions exposed

# =============================================================================
# SECTION 2: AMBIGUOUS CAPABILITIES (REQUIRES RESOLUTION)
# =============================================================================

ambiguous:
  # No ambiguous capabilities identified.
  # All frontend-invocable capabilities have clear interaction semantics.
  []

# =============================================================================
# SECTION 3: INTERACTION PATTERNS SUMMARY
# =============================================================================

summary:

  by_input_type:
    query:
      - replay              # CAP-001
      - policy_proposals    # CAP-003
      - prediction_plane    # CAP-004
      - policy_engine       # CAP-009
      - memory_system       # CAP-014
      - integration_platform # CAP-018
    proposal:
      - cost_simulation     # CAP-002
    command:
      - founder_console     # CAP-005
      - governance_orchestration # CAP-011

  by_output_type:
    report:
      - replay              # CAP-001
      - cost_simulation     # CAP-002 (recommendation)
      - policy_proposals    # CAP-003
      - prediction_plane    # CAP-004
      - policy_engine       # CAP-009
      - memory_system       # CAP-014
      - integration_platform # CAP-018
    recommendation:
      - cost_simulation     # CAP-002
    state:
      - founder_console     # CAP-005
      - governance_orchestration # CAP-011

  by_feedback_loop:
    closed:
      - replay              # Deterministic trace query
      - founder_console     # Human-controlled
      - policy_engine       # Query-response
      - governance_orchestration # Human approval
      - memory_system       # Query-response
    open:
      - cost_simulation     # Advisory
      - policy_proposals    # Requires human decision
      - prediction_plane    # Informational
      - integration_platform # Informational

  by_mutability:
    writes_state_false:     # READ-ONLY from frontend
      - replay
      - cost_simulation
      - policy_proposals
      - prediction_plane
      - policy_engine
      - memory_system
      - integration_platform
    writes_state_true:      # Can mutate (RBAC gated)
      - founder_console
      - governance_orchestration

  human_required:
    required:
      - policy_proposals    # Approval required
      - founder_console     # Founder action
      - governance_orchestration # Founder approval
    not_required:
      - replay
      - cost_simulation
      - prediction_plane
      - policy_engine
      - memory_system
      - integration_platform

# =============================================================================
# SECTION 4: L1 CONSTITUTION COMPLIANCE
# =============================================================================

l1_compliance:
  all_capabilities_compliant: true

  invariants_verified:
    - name: "No Auto-Enforcement"
      description: "No capability auto-enforces rules without human decision"
      status: VERIFIED

    - name: "No Learned Authority"
      description: "No capability derives authority from ML predictions"
      status: VERIFIED

    - name: "Human-in-the-Loop for Mutations"
      description: "State mutations require explicit human action"
      status: VERIFIED
      capabilities_with_mutations:
        - founder_console
        - governance_orchestration

# =============================================================================
# END OF INTERACTION SEMANTICS REGISTRY
# =============================================================================

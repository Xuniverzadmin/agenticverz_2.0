domain,layer,folder,filename,rel_path,lines,purpose,functions,fn_count,async_count,classes,cls_count,calls_l5,calls_l5_schema,calls_l6,calls_l7,cross_domain,external_deps,called_by,caller_layers,header_callers,header_allowed_imports,header_forbidden_imports,linkage_chain,disposition
_models,L7,models,alert_config,backend/app/models/alert_config.py,188,Configure alerting behavior for near-threshold events,,0,0,AlertChannel | AlertConfig | AlertConfigCreate | AlertConfigUpdate | AlertConfigResponse,5,,,,,,pydantic | sqlmodel,L4:alert_emitter | ?:alert_emitter | ?:test_multi_tier_alerts,? + L4,"services/alert_emitter.py, api/policy_alerts.py","L5, L6","L1, L2, L3",? + L4 → THIS(L7),
_models,L7,models,audit_ledger,backend/app/models/audit_ledger.py,145,Audit Ledger model for Logs domain (PIN-413),utc_now | generate_uuid,2,0,ActorType | AuditEntityType | AuditEventType | AuditLedger,4,,,,,,postgresql | sqlalchemy | sqlmodel,L5:incident_write_engine | L5:audit_ledger_service | L6:audit_ledger_service_async | L6:logs_domain_store | L6:overview_facade_driver | L5:policy_limits_engine | L5:policy_proposal_engine | L5:policy_rules_engine | L7:__init__ | ?:incident_write_engine,? + L5 + L6 + L7,runtime_projections/logs/*,None (foundational),"L1, L2, L3, L4, L5",? + L5 + L6 + L7 → THIS(L7),
_models,L7,models,contract,backend/app/models/contract.py,587,System Contract database models,,0,0,ContractStatus | AuditVerdict | RiskLevel | ProposedChangeType | ContractSource | SystemContract | ProposedChangeBase | CapabilityEnableChange | CapabilityDisableChange | ConfigurationUpdateChange | ParameterChangeChange | ValidatorVerdictData | EligibilityVerdictData | TransitionRecord | ContractCreate | ContractResponse | ContractApproval | ContractRejection | InvalidTransitionError | ContractImmutableError | MayNotVerdictError,21,,,,costsim_cb,,postgresql | pydantic | sqlalchemy,?:founder_contract_review | L5:audit_engine | ?:founder_review | L4:contract_engine | L4:governance_orchestrator | ?:http_call_v2 | ?:json_transform_v2 | ?:llm_invoke_v2 | ?:claude_adapter | L7:__init__,? + L3 + L4 + L5 + L7,"governance/*, L4 domain services",None (foundational),"L1, L2, L3, L4, L5",? + L4 + L5 + L7 → THIS(L7) → L7,
_models,L7,models,costsim_cb,backend/app/models/costsim_cb.py,355,CostSim circuit breaker models,,0,0,CostSimCBStateModel | CostSimCBIncidentModel | CostSimProvenanceModel | CostSimCanaryReportModel | CostSimAlertQueueModel,5,,,,,,orm | postgresql | sqlalchemy,?:alert_worker | ?:circuit_breaker_async | ?:provenance_async | L6:provenance_async | L6:circuit_breaker_async | L4:alert_driver | L7:__init__ | L7:contract | L7:execution_envelope | L7:external_response,? + L4 + L6 + L7,costsim/*,None (foundational),"L1, L2, L3, L4, L5",? + L4 + L6 + L7 → THIS(L7),
_models,L7,models,cus_models,backend/app/models/cus_models.py,410,Customer integration data models,utc_now | generate_uuid,2,0,CusProviderType | CusIntegrationStatus | CusHealthState | CusPolicyResult | CusIntegration | CusLLMUsage | CusUsageDaily,7,,,,,,postgresql | sqlalchemy | sqlmodel,L5:cus_health_engine | L5s:cus_schemas | ?:cus_schemas | ?:cus_enforcement_driver | ?:cus_health_driver | ?:cus_health_engine | ?:cus_integration_driver | ?:cus_integration_engine | ?:cus_telemetry_driver | ?:cus_health_check,? + L5 + L5s,"cus_* services, cus_* APIs",None (foundational),"L1, L2, L3, L4, L5",? + L5 + L5s → THIS(L7),
_models,L7,models,execution_envelope,backend/app/models/execution_envelope.py,226,Execution envelope models for implicit authority hardening,,0,0,ExecutionEnvelopeModel | ExecutionEnvelopeStats,2,,,,costsim_cb,,postgresql | sqlalchemy,?:evidence_sink | ?:invocation_context | ?:kernel | L5:kernel | ?:test_execution_envelope,? + L5,"auth/execution_envelope.py, worker/*",None (foundational),"L1, L2, L3, L4, L5",? + L5 → THIS(L7) → L7,
_models,L7,models,export_bundles,backend/app/models/export_bundles.py,264,"Structured export bundle models for SOC2, evidence, and executive debrief",utc_now | generate_bundle_id,2,0,TraceStepEvidence | PolicyContext | EvidenceBundle | SOC2ControlMapping | SOC2Bundle | ExecutiveDebriefBundle | ExportBundleRequest | ExportBundleResponse,8,,,,,,pydantic,L6:export_bundle_driver | L5:pdf_renderer | L3:export_bundle_adapter | L7:__init__ | ?:export_bundle_service | ?:pdf_renderer | ?:test_export_scope_resolution,? + L3 + L5 + L6 + L7,"services/export_bundle_service.py, services/pdf_renderer.py",None (foundational),"L1, L2, L3, L4, L5",? + L3 + L5 + L6 + L7 → THIS(L7),
_models,L7,models,external_response,backend/app/models/external_response.py,188,External response data models (DB tables),,0,0,ExternalResponse | ExternalResponseCreate | InterpretationUpdate | ExternalResponseRead | InterpretedResponse,5,,,,costsim_cb,,postgresql | pydantic | sql | sqlalchemy,L6:external_response_driver | ?:external_response_service | L7:__init__,? + L6 + L7,"L3 adapters (write raw), L4 engines (read/interpret)",None (foundational),"L1, L2, L3, L4, L5",? + L6 + L7 → THIS(L7) → L7,
_models,L7,models,feedback,backend/app/models/feedback.py,110,Feedback data models,,0,0,PatternFeedback | PatternFeedbackCreate | PatternFeedbackResponse,3,,,,,,orm | postgresql | pydantic | sql | sqlalchemy,?:071_create_signal_feedback | ?:feedback | L2:feedback | ?:main | L5:pattern_detection | L6:pattern_detection_driver | L6:prediction_driver | L6:policy_proposal_read_driver | ?:__init__ | ?:pattern_detection,? + L2 + L5 + L6,"feedback API, services",None (foundational),"L1, L2, L3, L4, L5",? + L2 + L5 + L6 → THIS(L7),
_models,L7,models,governance,backend/app/models/governance.py,148,Governance signal data models (DB tables),,0,0,GovernanceSignal | GovernanceSignalCreate | GovernanceSignalResponse | GovernanceSignalQuery | GovernanceCheckResult,5,,,,costsim_cb,,postgresql | pydantic | sql | sqlalchemy,L3:founder_contract_review_adapter | ?:schema | ?:validator | ?:embedding | ?:founder_contract_review | ?:governance | ?:logs | ?:__init__ | ?:reactor_initializer | ?:decorator,? + L2 + L3 + L4 + L5 + L6 + L7,"governance/*, L4 orchestrators, L5 executors",None (foundational),"L1, L2, L3, L4, L5",? + L3 → THIS(L7) → L7,
_models,L7,models,governance_job,backend/app/models/governance_job.py,380,Governance Job database models,,0,0,JobStatus | StepStatus | GovernanceJob | JobStep | StepResult | HealthSnapshot | JobCreate | JobResponse | JobTransitionRecord | InvalidJobTransitionError | JobImmutableError | OrphanJobError,12,,,,costsim_cb,,postgresql | pydantic | sqlalchemy,L4:job_executor | L4:governance_orchestrator | L7:__init__ | ?:governance_orchestrator | ?:job_executor | ?:test_executor_invariants | ?:test_orchestrator_invariants,? + L4 + L7,"governance/*, L4 domain services",None (foundational),"L1, L2, L3, L4, L5",? + L4 + L7 → THIS(L7) → L7,
_models,L7,models,killswitch,backend/app/models/killswitch.py,659,Killswitch data models,utc_now | generate_uuid,2,0,EntityType | TriggerType | IncidentSeverity | IncidentStatus | IncidentLifecycleState | IncidentCauseType | GuardrailAction | GuardrailCategory | KillSwitchState | ProxyCall | Incident | IncidentEvent | DefaultGuardrail | KillSwitchStatus | KillSwitchAction | IncidentSummary | IncidentDetail | GuardrailSummary | ProxyCallSummary | ProxyCallDetail | ReplayRequest | ReplayResult | DemoSimulationRequest | DemoSimulationResult,24,,,,,,pydantic | sqlmodel,L3:customer_killswitch_adapter | ?:guard | ?:incidents | ?:ops | ?:replay | ?:v1_killswitch | ?:v1_proxy | L2:incidents | L2:guard | L2:replay,? + L2 + L3 + L4 + L5 + L6,"killswitch API, services",None (foundational),"L1, L2, L3, L4, L5",? + L2 + L3 → THIS(L7),
_models,L7,models,knowledge_lifecycle,backend/app/models/knowledge_lifecycle.py,496,GAP-089 Knowledge Plane Lifecycle State Machine,is_valid_transition | get_valid_transitions | validate_transition | get_action_for_transition | get_transition_for_action | get_next_onboarding_state | get_next_offboarding_state,7,0,KnowledgePlaneLifecycleState | LifecycleAction | TransitionResult,3,,,,,,,L4:offboarding | L4:onboarding | L4:lifecycle_stages_base | ?:lifecycle_worker | ?:knowledge_lifecycle_manager | ?:knowledge_sdk | ?:base | ?:offboarding | ?:onboarding | ?:test_async_job_coordination,? + L4,"KnowledgeLifecycleManager, SDK facade, policy gates",stdlib only,"L1, L2, L3, L5, L6",? + L4 → THIS(L7),
_models,L7,models,lessons_learned,backend/app/models/lessons_learned.py,150,Lessons learned data model for policy domain intelligence,,0,0,LessonType | LessonStatus | LessonSeverity | LessonLearned | LessonSummary | LessonDetail,6,,,,,,postgresql | sqlalchemy | sqlmodel,,,"LessonsLearnedEngine (L4), API facades (L2)","sqlalchemy, sqlmodel","L1, L2, L3, L4, L5",THIS(L7),
_models,L7,models,log_exports,backend/app/models/log_exports.py,138,Log Exports model for LOGS Domain V2 (O5 evidence bundles),utc_now | generate_uuid,2,0,ExportScope | ExportFormat | ExportOrigin | ExportStatus | LogExport,5,,,,,,sqlmodel,L6:logs_domain_store | ?:logs_facade,? + L6,"logs API, LogExportService",None (foundational),"L1, L2, L3, L4, L5",? + L6 → THIS(L7),
_models,L7,models,logs_records,backend/app/models/logs_records.py,226,LLM Run Records and System Records models for Logs domain (PIN-413),utc_now | generate_uuid,2,0,ExecutionStatus | RecordSource | SystemComponent | SystemEventType | SystemSeverity | SystemCausedBy | LLMRunRecord | SystemRecord,8,,,,,,postgresql | sqlalchemy | sqlmodel,?:main | L6:logs_domain_store | ?:runner | ?:pool | L7:__init__ | ?:logs_facade,? + L6 + L7,"runtime_projections/logs/*, worker capture",None (foundational),"L1, L2, L3, L4, L5",? + L6 + L7 → THIS(L7),
_models,L7,models,m10_recovery,backend/app/models/m10_recovery.py,348,M10 recovery data models,,0,0,SuggestionInput | SuggestionAction | SuggestionProvenance,3,,,,,,orm | postgresql | sql | sqlalchemy,?:test_m10_recovery_enhanced,?,"recovery services, workers",None (foundational),"L1, L2, L3, L4, L5",? → THIS(L7),
_models,L7,models,monitor_config,backend/app/models/monitor_config.py,191,Define what signals to monitor during run execution,,0,0,MonitorMetric | MonitorConfig | MonitorConfigCreate | MonitorConfigUpdate | MonitorConfigResponse,5,,,,,,pydantic | sqlmodel,?:test_inspection_constraints | ?:test_monitor_enhancements,?,"policy/prevention_engine.py, api/policy_monitors.py","L5, L6","L1, L2, L3",? → THIS(L7),
_models,L7,models,override_authority,backend/app/models/override_authority.py,285,Define emergency override rules for policies,,0,0,OverrideAuthority | OverrideRecord | OverrideAuthorityCreate | OverrideAuthorityUpdate | ApplyOverrideRequest | OverrideAuthorityResponse | OverrideRecordResponse,7,,,,,,pydantic | sqlmodel,?:test_override_authority,?,"policy/prevention_engine.py, api/policy_overrides.py","L5, L6","L1, L2, L3",? → THIS(L7),
_models,L7,models,policy,backend/app/models/policy.py,162,Policy data models (DB tables),,0,0,PolicyProposal | PolicyVersion | PolicyProposalCreate | PolicyProposalResponse | PolicyApprovalRequest | PolicyVersionResponse,6,,,,,,orm | postgresql | pydantic | sql | sqlalchemy,L3:customer_policies_adapter | ?:guard | ?:policy | ?:policy_layer | ?:policy_proposals | ?:recovery | ?:workers | ?:rbac_engine | ?:state_resolver | L2:guard,? + L2 + L3 + L4 + L5 + L6,policy/*,None (foundational),"L1, L2, L3, L4, L5",? + L2 + L3 → THIS(L7),
_models,L7,models,policy_control_plane,backend/app/models/policy_control_plane.py,439,Policy control-plane models (PIN-412),utc_now | generate_uuid,2,0,EnforcementMode | PolicyScope | LimitScope | PolicyRuleStatus | PolicySource | RuleType | EnforcementAction | LimitCategory | LimitEnforcement | LimitConsequence | ResetPeriod | LimitStatus | BreachType | PolicyRule | PolicyEnforcement | Limit | LimitBreach | IntegrityStatus | PolicyRuleIntegrity | LimitIntegrity,20,,,,,,postgresql | sqlalchemy | sqlmodel,?:policy | ?:policy_limits_crud | L2:policy | L2:policy_limits_crud | L6:limits_read_driver | L6:override_driver | L6:policy_limits_driver | L6:threshold_driver | L6:overview_facade_driver | L5:policy_limits_engine,? + L2 + L4 + L5 + L6 + L7,"policy/*, api/policies/*",None (foundational),"L1, L2, L3, L4, L5",? + L2 + L5 + L6 → THIS(L7),
_models,L7,models,policy_precedence,backend/app/models/policy_precedence.py,145,Define policy precedence and conflict resolution strategies,,0,0,ConflictStrategy | BindingMoment | PolicyPrecedence | ArbitrationResult | PolicyPrecedenceCreate | PolicyPrecedenceUpdate | PolicyPrecedenceResponse,7,,,,,,pydantic | sqlmodel,L6:arbitrator | ?:arbitrator | ?:test_control_action_enhancements,? + L6,"policy/arbitrator.py, api/policy_precedence.py","L5, L6","L1, L2, L3",? + L6 → THIS(L7),
_models,L7,models,policy_scope,backend/app/models/policy_scope.py,267,"Define policy scope selectors for targeting runs by agent, API key, or human actor",,0,0,ScopeType | PolicyScope | PolicyScopeCreate | PolicyScopeUpdate | PolicyScopeResponse,5,,,,,,pydantic | sqlmodel,L6:scope_resolver | ?:scope_resolver | ?:test_export_scope_resolution | ?:test_scope_selector,? + L6,"policy/scope_resolver.py, api/policy_scopes.py","L5, L6","L1, L2, L3",? + L6 → THIS(L7),
_models,L7,models,policy_snapshot,backend/app/models/policy_snapshot.py,205,Immutable policy snapshot for run-time governance,utc_now,1,0,PolicySnapshot | PolicySnapshotCreate | PolicySnapshotResponse | ThresholdSnapshot,4,,,,,,pydantic | sqlmodel,L5:prevention_engine | L7:__init__ | ?:prevention_engine | ?:test_threshold_snapshot_hash,? + L5 + L7,"worker/runner.py, policy/engine.py",None (foundational),"L1, L2, L3, L4, L5",? + L5 + L7 → THIS(L7),
_models,L7,models,prediction,backend/app/models/prediction.py,106,Prediction data models,,0,0,PredictionEvent | PredictionEventCreate | PredictionEventResponse,3,,,,,,orm | postgresql | pydantic | sql | sqlalchemy,?:predictions | L2:predictions | L5:prediction | L6:prediction_driver | ?:api | ?:prediction | ?:test_pb_s5_prediction,? + L2 + L5 + L6,predictions/*,None (foundational),"L1, L2, L3, L4, L5",? + L2 + L5 + L6 → THIS(L7),
_models,L7,models,retrieval_evidence,backend/app/models/retrieval_evidence.py,119,Audit log model for mediated data access,utc_now | generate_uuid,2,0,RetrievalEvidence,1,,,,,,postgresql | sqlalchemy | sqlmodel,?:test_retrieval_evidence,?,"RetrievalMediator (GAP-065), export services",L6 (sqlmodel),"L1, L2, L3",? → THIS(L7),
_models,L7,models,run_lifecycle,backend/app/models/run_lifecycle.py,153,Run lifecycle enums and models for governance,get_lifecycle_state,1,0,RunTerminationReason | RunStatus | RunLifecycleState | PolicyViolationType | ViolationSeverity | RunViolationInfo | RunTerminationInfo,7,,,,,,pydantic,L7:__init__,L7,"worker/runner.py, services/*, api/*",None (foundational),"L1, L2, L3, L4, L5",L7 → THIS(L7),
_models,L7,models,tenant,backend/app/models/tenant.py,738,Tenant data models,utc_now | generate_uuid,2,0,Tenant | User | TenantMembership | Invitation | APIKey | Subscription | UsageRecord | WorkerRegistry | WorkerConfig | WorkerRun | SupportTicket | AuditLog | FounderAction,13,,,,,,onboarding_state | sqlmodel | tier_gating,L3:runtime_adapter | ?:M17_internal_worker | ?:aos_accounts | ?:guard | ?:ops | ?:policy_layer | ?:predictions | ?:runtime | ?:v1_killswitch | ?:v1_proxy,? + L2 + L3 + L4 + L5 + L6 + L7,tenant services,None (foundational),"L1, L2, L3, L4, L5",? + L3 → THIS(L7),
_models,L7,models,threshold_signal,backend/app/models/threshold_signal.py,203,Record near-threshold and breach events for alerting and audit,,0,0,SignalType | ThresholdMetric | ThresholdSignal | ThresholdSignalResponse | ThresholdSignalListResponse,5,,,,,,pydantic | sqlmodel,L4:alert_emitter | ?:alert_emitter | ?:test_control_action_enhancements | ?:test_limit_enhancements,? + L4,"policy/prevention_engine.py, services/alert_emitter.py","L5, L6","L1, L2, L3",? + L4 → THIS(L7),
account,L5,L5_engines,accounts_facade,backend/app/hoc/cus/account/L5_engines/accounts_facade.py,1140,Accounts domain facade - unified entry point for account management,get_accounts_facade,1,0,ProjectSummaryResult | ProjectsListResult | ProjectDetailResult | UserSummaryResult | UsersListResult | UserDetailResult | TenantUserResult | TenantUsersListResult | ProfileResult | ProfileUpdateResult | BillingSummaryResult | InvoiceSummaryResult | InvoiceListResult | SupportContactResult | SupportTicketResult | SupportTicketListResult | InvitationResult | InvitationListResult | AcceptInvitationResult | AccountsErrorResult | AccountsFacade,21,,,accounts_facade_driver,,,__future__ | asyncio,?:aos_accounts | L2:aos_accounts | L5:__init__ | L4:account_handler,? + L2 + L4 + L5,L2 accounts API (accounts.py),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L4 + L5 → THIS(L5) → L6,
account,L5,L5_engines,billing_provider,backend/app/hoc/cus/account/L5_engines/billing_provider.py,251,Phase-6 BillingProvider protocol and MockBillingProvider,get_billing_provider | set_billing_provider,2,0,BillingProvider | MockBillingProvider,2,,,,,,limits | plan | state,,,"billing middleware, billing APIs, runtime enforcement","L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
account,L5,L5_engines,email_verification,backend/app/hoc/cus/account/L5_engines/email_verification.py,302,Email OTP verification engine for customer onboarding,get_email_verification_service,1,0,VerificationResult | EmailVerificationError | EmailVerificationService,3,,,,,,httpx | redis,L5:__init__,L5,onboarding.py (auth flow),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5),
account,L5,L5_engines,identity_resolver,backend/app/hoc/cus/account/L5_engines/identity_resolver.py,207,Identity resolution from various providers,create_default_identity_chain,1,0,IdentityResolver | ClerkIdentityResolver | APIKeyIdentityResolver | SystemIdentityResolver | IdentityChain,5,,,,,,iam_service | jwt,?:__init__,?,"IAMService, Auth middleware","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
account,L5,L5_engines,notifications_facade,backend/app/hoc/cus/account/L5_engines/notifications_facade.py,480,Notifications Facade - Centralized access to notification operations,get_notifications_facade,1,0,NotificationChannel | NotificationPriority | NotificationStatus | NotificationInfo | ChannelInfo | NotificationPreferences | NotificationsFacade,7,,,,,,,L5:__init__ | L4:account_handler,L4 + L5,"L2 notifications.py API, SDK, Worker","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 + L5 → THIS(L5),
account,L5,L5_engines,profile,backend/app/hoc/cus/account/L5_engines/profile.py,459,Governance Profile configuration and validation,_get_bool_env | get_governance_profile | load_governance_config | validate_governance_config | get_governance_config | reset_governance_config | validate_governance_at_startup,7,0,GovernanceProfile | GovernanceConfig | GovernanceConfigError,3,,,,,,,?:aos_accounts | ?:reactor_initializer | L2:aos_accounts | ?:main | L4:profile_policy_mode | ?:failure_mode_handler | ?:profile | ?:boot_guard | ?:test_stubs,? + L2 + L4,"main.py (L2), workers (L5)","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L4 → THIS(L5),
account,L5,L5_engines,tenant_engine,backend/app/hoc/cus/account/L5_engines/tenant_engine.py,582,Tenant domain engine - business logic for tenant operations,get_tenant_engine,1,0,TenantEngineError | QuotaExceededError | TenantEngine,3,,,tenant_driver,tenant,,__future__ | sqlmodel | time,L5:__init__,L5,"L2 APIs, L5 workers","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5) → L6 + L7,
account,L5,L5_engines,user_write_engine,backend/app/hoc/cus/account/L5_engines/user_write_engine.py,91,User write operations (L5 engine over L6 driver),,0,0,UserWriteService,1,,,user_write_driver,tenant,,sqlmodel,L5:__init__,L5,api/onboarding.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5) → L6 + L7,
account,L5,L5_support,crm_validator_engine,backend/app/hoc/cus/account/L5_support/CRM/engines/crm_validator_engine.py,739,"Issue Validator - pure analysis, advisory verdicts (pure business logic)",,0,0,IssueType | Severity | RecommendedAction | IssueSource | ValidatorInput | ValidatorVerdict | ValidatorErrorType | ValidatorError | ValidatorService,9,,,,,,,L4:contract_engine | L4:__init__,L4,"L3 (adapters), L4 (orchestrators)","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 → THIS(L5),
account,L5,L5_support,validator_engine,backend/app/hoc/cus/account/L5_support/CRM/engines/validator_engine.py,735,"Issue Validator engine - pure analysis, advisory verdicts",,0,0,IssueType | Severity | RecommendedAction | IssueSource | ValidatorInput | ValidatorVerdict | ValidatorErrorType | ValidatorError | ValidatorService,9,,,,,,,?:__init__ | ?:aurora_semantic_validator,?,"L3 (adapters), L2 (governance APIs)",L6,"L1, L2, L3, L5",? → THIS(L5),
account,L6,L6_drivers,accounts_facade_driver,backend/app/hoc/cus/account/L6_drivers/accounts_facade_driver.py,954,Accounts domain facade driver - pure data access — L6 DOES NOT COMMIT,get_accounts_facade_driver,1,0,TenantSnapshot | TenantDetailSnapshot | UserSnapshot | UserDetailSnapshot | MembershipSnapshot | ProfileSnapshot | SubscriptionSnapshot | InvitationSnapshot | TicketSnapshot | AccountsFacadeDriver,10,,,,tenant,,__future__ | asyncio | sqlalchemy,L5:accounts_facade | L6:__init__,L5 + L6,"accounts_facade.py (L5), must own transaction boundary","L6, L7 (models)",,L5 + L6 → THIS(L6) → L7,
account,L6,L6_drivers,tenant_driver,backend/app/hoc/cus/account/L6_drivers/tenant_driver.py,574,Tenant domain driver - pure data access for tenant operations — L6 DOES NOT COMMIT,get_tenant_driver,1,0,TenantCoreSnapshot | RunCountSnapshot | APIKeySnapshot | UsageRecordSnapshot | RunSnapshot | TenantDriver,6,,,,tenant,,__future__ | sqlmodel | time,L5:tenant_engine | L6:__init__,L5 + L6,"tenant_engine.py (L5), must provide session, must own transaction boundary","L6, L7 (models)",,L5 + L6 → THIS(L6) → L7,
account,L6,L6_drivers,user_write_driver,backend/app/hoc/cus/account/L6_drivers/user_write_driver.py,137,Data access for user write operations,get_user_write_driver,1,0,UserWriteDriver,1,,,,tenant,,sqlmodel | time,L5:user_write_engine | L6:__init__,L5 + L6,user_write_engine.py (L5),"L6, L7 (models)",,L5 + L6 → THIS(L6) → L7,
activity,L5,L5_engines,activity_enums,backend/app/hoc/cus/activity/L5_engines/activity_enums.py,120,Canonical enums for activity domain - owned by engines,,0,0,SignalType | SeverityLevel | RunState | RiskType | EvidenceHealth,5,,,,,,,L5:activity_facade,L5,"activity_facade.py, signal engines",none (pure enums),"all (pure enums, no imports needed)",L5 → THIS(L5),
activity,L5,L5_engines,activity_facade,backend/app/hoc/cus/activity/L5_engines/activity_facade.py,1387,Activity Facade - Centralized access to activity domain operations,get_activity_facade,1,0,PolicyContextResult | RunSummaryResult | RunSummaryV2Result | RunListResult | RunsResult | RunDetailResult | RunEvidenceResult | RunProofResult | StatusCount | StatusSummaryResult | SignalProjectionResult | SignalsResult | MetricsResult | ThresholdSignalResult | ThresholdSignalsResult | RiskSignalsResult | ActivityFacade,17,activity_enums | attention_ranking_engine | cost_analysis_engine | pattern_detection_engine | signal_feedback_engine | signal_identity,,activity_read_driver,,,__future__ | asyncio,?:activity | L5:__init__ | L3:customer_activity_adapter | L5:customer_activity_adapter | L4:activity_handler,? + L3 + L4 + L5,app.api.activity (L2),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L3 + L4 + L5 → THIS(L5) → L5 + L6,
activity,L5,L5_engines,attention_ranking_engine,backend/app/hoc/cus/activity/L5_engines/attention_ranking_engine.py,99,Attention ranking engine for activity signals,,0,0,AttentionSignal | AttentionQueueResult | AttentionRankingService,3,,,,,,time,L5:activity_facade,L5,activity_facade.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5),
activity,L5,L5_engines,cost_analysis_engine,backend/app/hoc/cus/activity/L5_engines/cost_analysis_engine.py,93,Cost analysis engine for activity signals,,0,0,CostAnomaly | CostAnalysisResult | CostAnalysisService,3,,,,,,time,L5:activity_facade,L5,activity_facade.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5),
activity,L5,L5_engines,cus_telemetry_service,backend/app/hoc/cus/activity/L5_engines/cus_telemetry_service.py,77,Customer telemetry service - LLM usage ingestion and reporting,get_cus_telemetry_service,1,0,,0,,,,,,cus_telemetry_engine,?:cus_telemetry | L4:activity_handler | ?:cus_telemetry_service | ?:shim_guard,? + L4,cus_telemetry.py,L6 (drivers),"L1, L2, L3, sqlalchemy direct",? + L4 → THIS(L5),
activity,L5,L5_engines,pattern_detection_engine,backend/app/hoc/cus/activity/L5_engines/pattern_detection_engine.py,92,Pattern detection engine for activity signals,,0,0,DetectedPattern | PatternDetectionResult | PatternDetectionService,3,,,,,,time,L5:activity_facade,L5,activity_facade.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5),
activity,L5,L5_engines,signal_feedback_engine,backend/app/hoc/cus/activity/L5_engines/signal_feedback_engine.py,140,Signal feedback engine for acknowledging/suppressing signals,,0,0,AcknowledgeResult | SuppressResult | SignalFeedbackStatus | SignalFeedbackService,4,,,,,,time,L5:activity_facade | L4:activity_handler,L4 + L5,activity_facade.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 + L5 → THIS(L5),
activity,L5,L5_engines,signal_identity,backend/app/hoc/cus/activity/L5_engines/signal_identity.py,79,Signal identity computation for deduplication,compute_signal_fingerprint_from_row | compute_signal_fingerprint,2,0,,0,,,,,,,?:activity | L5:activity_facade | L4:activity_handler | ?:__init__ | ?:activity_facade | ?:test_signal_feedback,? + L4 + L5,"activity_facade.py, signal engines",L5,"L1, L2, L3, L6, sqlalchemy (runtime)",? + L4 + L5 → THIS(L5),
activity,L6,L6_drivers,activity_read_driver,backend/app/hoc/cus/activity/L6_drivers/activity_read_driver.py,344,Activity read data access operations,get_activity_read_driver,1,0,ActivityReadDriver,1,,,,,,asyncio | sqlalchemy,L5:activity_facade,L5,activity_facade.py (L5 engine),"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 → THIS(L6),
activity,L6,L6_drivers,orphan_recovery,backend/app/hoc/cus/activity/L6_drivers/orphan_recovery.py,259,"Orphan detection logic, PB-S2 truth guarantee",detect_orphaned_runs | mark_run_as_crashed | recover_orphaned_runs | get_crash_recovery_summary,4,4,,0,,,,tenant,,asyncio | db | infra | sqlalchemy,?:main | ?:check_priority5_intent,?,"L5 workers (startup), L7 ops scripts","L6, L7 (models)",,? → THIS(L6) → L7,
activity,L6,L6_drivers,run_signal_service,backend/app/hoc/cus/activity/L6_drivers/run_signal_service.py,188,RunSignalService - updates run risk levels based on threshold signals,,0,0,RunSignalService,1,,,,,,sqlalchemy,L6:threshold_driver | ?:llm_threshold_service,? + L6,"threshold_driver.py, llm_threshold_driver.py","L6, L7 (models)","L1, L2, L3, L5",? + L6 → THIS(L6),
analytics,L5,L5_engines,ai_console_panel_engine,backend/app/hoc/cus/analytics/L5_engines/ai_console_panel_engine.py,338,Main orchestration engine for panel evaluation,create_panel_engine | get_panel_engine,2,2,AIConsolePanelEngine,1,,,,,,panel_consistency_checker | panel_dependency_resolver | panel_metrics_emitter | panel_response_assembler | panel_signal_collector | panel_slot_evaluator | panel_spec_loader | panel_types | panel_verification_engine,?:__init__,?,L2 APIs (ai-console),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
analytics,L5,L5_engines,analytics_facade,backend/app/hoc/cus/analytics/L5_engines/analytics_facade.py,639,Analytics Facade - Centralized access to analytics domain operations,get_analytics_facade,1,0,ResolutionType | ScopeType | TimeWindowResult | UsageTotalsResult | UsageDataPointResult | SignalSourceResult | UsageStatisticsResult | CostTotalsResult | CostDataPointResult | CostByModelResult | CostByFeatureResult | CostStatisticsResult | TopicStatusResult | AnalyticsStatusResult | SignalAdapter | AnalyticsFacade,16,,,analytics_read_driver,,,__future__ | asyncio,?:analytics | L2:analytics | L4:analytics_handler,? + L2 + L4,app.api.analytics (L2),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L4 → THIS(L5) → L6,
analytics,L5,L5_engines,canary,backend/app/hoc/cus/analytics/L5_engines/canary.py,648,"CostSim V2 canary runner (daily validation, drift detection)",run_canary,1,1,CanarySample | CanaryRunConfig | CanaryRunner,3,,,,,,__future__ | circuit_breaker | circuit_breaker_async | config | leader | models | provenance | simulate | v2_adapter,?:__init__ | ?:test_canary,?,"systemd timer, cron","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
analytics,L5,L5_engines,config,backend/app/hoc/cus/analytics/L5_engines/config.py,169,CostSim V2 configuration and feature flags,get_config | is_v2_sandbox_enabled | is_v2_disabled_by_drift | get_commit_sha,4,0,CostSimConfig,1,,,,,,__future__ | subprocess,?:env | L3:webhook_adapter | ?:retry_policy | ?:llm_invoke_governed | ?:costsim | ?:jwt_auth | ?:__init__ | ?:console_modes | ?:flag_sync | ?:secrets,? + L2 + L3 + L4 + L5 + L5s + L6,"costsim engine, sandbox runner","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L3 → THIS(L5),
analytics,L5,L5_engines,coordinator,backend/app/hoc/cus/analytics/L5_engines/coordinator.py,565,Optimization envelope coordination,,0,0,CoordinationError | CoordinationManager,2,,,,,,audit_persistence | envelope | infra | sqlmodel,?:__init__ | ?:check_priority4_intent | ?:test_c4_s1_coordination,?,workers,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
analytics,L5,L5_engines,cost_anomaly_detector,backend/app/hoc/cus/analytics/L5_engines/cost_anomaly_detector.py,1072,Cost anomaly detection business logic (System Truth),classify_severity | run_anomaly_detection | run_anomaly_detection_with_facts | run_anomaly_detection_with_governance,4,3,AnomalyType | AnomalySeverity | DerivedCause | DetectedAnomaly | CostAnomalyDetector,5,,,cost_anomaly_driver,,,__future__ | anomaly_bridge | db | sqlmodel,?:cost_intelligence | L2:cost_intelligence | L5:detection_facade | ?:anomaly_severity | ?:facade | ?:test_category4_cost_intelligence | ?:test_m26_prevention,? + L2 + L5,"tests, future background job","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L5 → THIS(L5) → L6,
analytics,L5,L5_engines,cost_model_engine,backend/app/hoc/cus/analytics/L5_engines/cost_model_engine.py,455,Cost modeling and risk estimation domain authority (System Truth),get_skill_coefficients | estimate_step_cost | calculate_cumulative_risk | check_feasibility | classify_drift | is_significant_risk,6,0,DriftVerdict | StepCostEstimate | FeasibilityResult | DriftAnalysis,4,,,,,,,?:v2_adapter | L3:v2_adapter,? + L3,"CostSimV2Adapter (L3), simulation endpoints","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L3 → THIS(L5),
analytics,L5,L5_engines,cost_snapshots,backend/app/hoc/cus/analytics/L5_engines/cost_snapshots.py,933,Cost snapshot computation with embedded DB operations,run_hourly_snapshot_job | run_daily_snapshot_and_baseline_job,2,2,SnapshotComputer | BaselineComputer | SnapshotAnomalyDetector,3,,,,,,__future__ | asyncio | cost_snapshot_schemas,,,"workers, cost services","L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
analytics,L5,L5_engines,cost_write_engine,backend/app/hoc/cus/analytics/L5_engines/cost_write_engine.py,161,Cost write operations (L5 facade over L6 driver),,0,0,CostWriteService,1,,,cost_write_driver,,,db | sqlmodel,,,api/cost_intelligence.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5) → L6,
analytics,L5,L5_engines,costsim_models,backend/app/hoc/cus/analytics/L5_engines/costsim_models.py,305,"CostSim V2 data models (simulation status, results)",,0,0,V2SimulationStatus | ComparisonVerdict | V2SimulationResult | ComparisonResult | DiffResult | CanaryReport | DivergenceReport | ValidationResult,8,,,,,,__future__,,,"sandbox, canary, divergence engines","L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
analytics,L5,L5_engines,datasets,backend/app/hoc/cus/analytics/L5_engines/datasets.py,723,CostSim V2 reference datasets (validation samples),get_dataset_validator | validate_dataset | validate_all_datasets,3,2,DatasetSample | ReferenceDataset | DatasetValidator,3,,,,,,__future__ | models | random | v2_adapter,?:costsim | L2:costsim,? + L2,"canary runner, divergence engine","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 → THIS(L5),
analytics,L5,L5_engines,detection_facade,backend/app/hoc/cus/analytics/L5_engines/detection_facade.py,559,Detection Facade - Centralized access to anomaly detection operations,get_detection_facade,1,0,DetectionType | AnomalyStatus | DetectionResult | AnomalyInfo | DetectionStatusInfo | DetectionFacade,6,cost_anomaly_detector,,,,,,?:anomaly_severity | L4:analytics_handler,? + L4,"L2 detection.py API, SDK, Worker","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 → THIS(L5) → L5,
analytics,L5,L5_engines,divergence,backend/app/hoc/cus/analytics/L5_engines/divergence.py,365,"CostSim V2 divergence reporting (delta metrics, KL divergence)",generate_divergence_report,1,1,DivergenceSample | DivergenceAnalyzer,2,,,,,,__future__ | config | models | provenance,?:costsim | ?:__init__ | L2:costsim,? + L2,"canary runner, sandbox API","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 → THIS(L5),
analytics,L5,L5_engines,envelope,backend/app/hoc/cus/analytics/L5_engines/envelope.py,436,Base optimization envelope definition,get_envelope_priority | has_higher_priority | validate_envelope | calculate_bounded_value | create_audit_record,5,0,DeltaType | EnvelopeClass | BaselineSource | EnvelopeLifecycle | RevertReason | EnvelopeTrigger | EnvelopeScope | EnvelopeBounds | EnvelopeTimebox | EnvelopeBaseline | EnvelopeAuditRecord | CoordinationDecisionType | CoordinationAuditRecord | CoordinationDecision | Envelope | EnvelopeValidationError,16,,,,,,,?:logs | L2:logs | L5:coordinator | L5:s1_retry_backoff | L5:s2_cost_smoothing | ?:s1_rollback | ?:__init__ | ?:coordinator | ?:s1_retry_backoff | ?:s2_cost_smoothing,? + L2 + L5,optimization/*,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L5 → THIS(L5),
analytics,L5,L5_engines,metrics,backend/app/hoc/cus/analytics/L5_engines/metrics.py,617,"CostSim V2 Prometheus metrics (drift detection, circuit breaker)",get_metrics | get_alert_rules,2,0,CostSimMetrics,1,,,,,,__future__ | config | prometheus_client,?:activity | ?:analytics | ?:incidents | ?:recovery | ?:recovery_ingest | ?:rbac_integration | ?:rbac_middleware | ?:tier_gating | ?:policy_command | ?:__init__,? + L2 + L3 + L4 + L5 + L6,"sandbox, canary engines","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
analytics,L5,L5_engines,pattern_detection,backend/app/hoc/cus/analytics/L5_engines/pattern_detection.py,409,Pattern detection (PB-S3) - observe → feedback → no mutation (System Truth),compute_error_signature | detect_failure_patterns | detect_cost_spikes | emit_feedback | run_pattern_detection | get_feedback_summary,6,5,,0,,,pattern_detection_driver,feedback,,db | time,,,None (DORMANT BY DESIGN),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5) → L6 + L7,
analytics,L5,L5_engines,prediction,backend/app/hoc/cus/analytics/L5_engines/prediction.py,463,Prediction generation and orchestration (advisory only),predict_failure_likelihood | predict_cost_overrun | emit_prediction | run_prediction_cycle | get_prediction_summary,5,5,,0,,,prediction_driver,prediction,,db | time,?:predictions | L2:predictions | L6:prediction_driver | ?:api | ?:prediction | ?:test_pb_s5_prediction,? + L2 + L6,predictions API (read-side),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L6 → THIS(L5) → L6 + L7,
analytics,L5,L5_engines,provenance,backend/app/hoc/cus/analytics/L5_engines/provenance.py,385,CostSim V2 provenance logging (full audit trail),compute_hash | compress_json | get_provenance_logger,3,0,ProvenanceLog | ProvenanceLogger,2,,,,,,__future__ | config | gzip,?:feedback | ?:__init__ | ?:canary | ?:divergence | ?:v2_adapter | L2:feedback | L5:canary | L5:divergence | L5:pattern_detection | L3:v2_adapter,? + L2 + L3 + L5,sandbox engine,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L3 + L5 → THIS(L5),
analytics,L5,L5_engines,s1_retry_backoff,backend/app/hoc/cus/analytics/L5_engines/s1_retry_backoff.py,148,S1 Retry backoff envelope implementation,create_s1_envelope,1,0,,0,,,,,,envelope,?:__init__ | ?:test_c3_failure_scenarios | ?:test_c3_s3_failure_matrix,?,optimization/coordinator,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
analytics,L5,L5_engines,sandbox,backend/app/hoc/cus/analytics/L5_engines/sandbox.py,307,"CostSim V2 sandbox routing (V1/V2 comparison, shadow mode)",simulate_with_sandbox | get_sandbox,2,1,SandboxResult | CostSimSandbox,2,,,,,,__future__ | circuit_breaker_async | config | models | simulate | v2_adapter,?:__init__ | ?:engine,?,cost simulation API,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
analytics,L5,L5_schemas,cost_snapshot_schemas,backend/app/hoc/cus/analytics/L5_schemas/cost_snapshot_schemas.py,243,Cost snapshot dataclasses and enums,,0,0,SnapshotType | SnapshotStatus | EntityType | CostSnapshot | SnapshotAggregate | SnapshotBaseline | AnomalyEvaluation,7,,,,,,__future__,L5:cost_snapshots | L5s:__init__,L5 + L5s,"cost_snapshot_engine, cost_snapshot_driver",stdlib only,"L6, sqlalchemy",L5 + L5s → THIS(L5),
analytics,L6,L6_drivers,analytics_read_driver,backend/app/hoc/cus/analytics/L6_drivers/analytics_read_driver.py,376,Analytics read data access operations,get_analytics_read_driver,1,0,AnalyticsReadDriver,1,,,,,,asyncio | sqlalchemy,L5:analytics_facade,L5,analytics_facade.py (L5 engine),"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 → THIS(L6),
analytics,L6,L6_drivers,audit_persistence,backend/app/hoc/cus/analytics/L6_drivers/audit_persistence.py,169,Optimization audit trail persistence,_now_utc | persist_audit_record,2,0,CoordinationAuditRecordDB,1,,,,,,infra | sqlmodel,L5:coordinator | ?:coordinator | ?:check_priority4_intent,? + L5,coordinator.py (L5 engine),"L6, L7 (models)","L1, L2, L3, L4, L5",? + L5 → THIS(L6),
analytics,L6,L6_drivers,cost_anomaly_driver,backend/app/hoc/cus/analytics/L6_drivers/cost_anomaly_driver.py,992,Data access for cost anomaly detection operations,get_cost_anomaly_driver,1,0,CostAnomalyDriver,1,,,,,,sqlalchemy | sqlmodel,L5:cost_anomaly_detector | L6:__init__,L5 + L6,cost_anomaly_detector.py (L5 engine),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 + L6 → THIS(L6),
analytics,L6,L6_drivers,cost_write_driver,backend/app/hoc/cus/analytics/L6_drivers/cost_write_driver.py,251,Data access for cost write operations,get_cost_write_driver,1,0,CostWriteDriver,1,,,,,,db | sqlmodel | time,L5:cost_write_engine,L5,cost_write_engine.py (L5 engine),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6),
analytics,L6,L6_drivers,leader,backend/app/hoc/cus/analytics/L6_drivers/leader.py,359,CostSim Leader Election via PostgreSQL Advisory Locks,try_acquire_leader_lock | release_leader_lock | is_lock_held | leader_election | with_leader_lock | with_canary_lock | with_alert_worker_lock | with_archiver_lock,8,8,LeaderContext,1,,,,,,__future__ | asyncio | db_async | sqlalchemy,?:__init__ | ?:alert_worker | ?:canary | ?:leader | L5:canary | ?:test_integration_real_db | ?:test_leader,? + L5,"canary.py, alert_worker.py (L5 engines)","L6, L7 (models)",,? + L5 → THIS(L6),
analytics,L6,L6_drivers,pattern_detection_driver,backend/app/hoc/cus/analytics/L6_drivers/pattern_detection_driver.py,209,Pattern detection data access operations,get_pattern_detection_driver,1,0,PatternDetectionDriver,1,,,,feedback | tenant,,asyncio | sqlalchemy,L5:pattern_detection,L5,pattern_detection.py (L5 engine),"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 → THIS(L6) → L7,
analytics,L6,L6_drivers,prediction_driver,backend/app/hoc/cus/analytics/L6_drivers/prediction_driver.py,319,Data access for prediction operations,get_prediction_driver,1,0,PredictionDriver,1,,,,feedback | prediction | tenant,,asyncio | sqlalchemy,L5:prediction | L6:__init__,L5 + L6,prediction.py (L5 engine),"L6, L7 (models)","L1, L2, L3, L4, L5, httpx",L5 + L6 → THIS(L6) → L7,
analytics,L6,L6_drivers,provenance_async,backend/app/hoc/cus/analytics/L6_drivers/provenance_async.py,463,CostSim V2 Provenance Logger - Async Implementation,write_provenance | write_provenance_batch | query_provenance | count_provenance | get_drift_stats | check_duplicate | compute_input_hash | backfill_v1_baseline,8,7,,0,,,,costsim_cb,,__future__ | asyncio | db_async | sqlalchemy,?:provenance_async | ?:test_integration_real_db,?,sandbox.py (L5 engine),"L6, L7 (models)",,? → THIS(L6) → L7,
api_keys,L5,L5_engines,api_keys_facade,backend/app/hoc/cus/api_keys/L5_engines/api_keys_facade.py,237,API Keys domain engine - unified entry point for API key operations,get_api_keys_facade,1,0,APIKeySummaryResult | APIKeysListResult | APIKeyDetailResult | APIKeysFacade,4,,,api_keys_facade_driver,,,__future__ | asyncio,?:aos_api_key | L5:__init__ | ?:__init__ | L4:api_keys_handler,? + L4 + L5,L2 api-keys API (aos_api_key.py),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 → THIS(L5) → L6,
api_keys,L5,L5_engines,keys_engine,backend/app/hoc/cus/api_keys/L5_engines/keys_engine.py,233,API Keys domain engine - business logic for key operations,get_keys_read_engine | get_keys_write_engine,2,0,KeysReadEngine | KeysWriteEngine,2,,,keys_driver,,,__future__ | sqlmodel,L3:customer_keys_adapter | L5:customer_keys_adapter,L3 + L5,"customer_keys_adapter.py (L3), runtime, gateway — NOT L2","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L3 + L5 → THIS(L5) → L6,
api_keys,L6,L6_drivers,api_keys_facade_driver,backend/app/hoc/cus/api_keys/L6_drivers/api_keys_facade_driver.py,209,API Keys Facade Driver - Pure data access for API key queries,,0,0,APIKeySnapshot | APIKeyDetailSnapshot | APIKeysFacadeDriver,3,,,,tenant,,asyncio | sqlalchemy,L5:api_keys_facade,L5,api_keys_facade.py (L5),"L6, L7 (models)",,L5 → THIS(L6) → L7,
api_keys,L6,L6_drivers,keys_driver,backend/app/hoc/cus/api_keys/L6_drivers/keys_driver.py,291,Keys Driver - Pure data access for API key engine operations,get_keys_driver,1,0,KeySnapshot | KeyUsageSnapshot | KeysDriver,3,,,,killswitch | tenant,,sqlalchemy | sqlmodel,L3:customer_keys_adapter | L5:keys_engine | L5:keys_shim,L3 + L5,keys_engine.py (L5),"L6, L7 (models)",,L3 + L5 → THIS(L6) → L7,
apis,L6,L6_drivers,keys_driver,backend/app/hoc/cus/apis/L6_drivers/keys_driver.py,196,API Keys data access operations,get_keys_driver,1,0,KeysDriver,1,,,,killswitch | tenant,,sqlalchemy | sqlmodel,L3:customer_keys_adapter | L5:keys_engine | L5:keys_shim,L3 + L5,"keys_service.py (L5 shim), customer_keys_adapter.py (L3)","L6, L7 (models)","L1, L2, L3, L4, L5",L3 + L5 → THIS(L6) → L7,
controls,L5,L5_controls,customer_killswitch_read_engine,backend/app/hoc/cus/controls/L5_controls/engines/customer_killswitch_read_engine.py,179,Customer killswitch read operations (L5 engine over L6 driver),get_customer_killswitch_read_service,1,0,KillswitchState | GuardrailInfo | IncidentStats | KillswitchStatusInfo | CustomerKillswitchReadService,5,,,,,,killswitch_read_driver | pydantic | sqlmodel,L3:customer_killswitch_adapter,L3,customer_killswitch_adapter.py (L3),"L6 (drivers only, NOT ORM models)","L1, L2, L3, L4, sqlalchemy, sqlmodel",L3 → THIS(L5),
controls,L5,L5_controls,killswitch_read_driver,backend/app/hoc/cus/controls/L5_controls/drivers/killswitch_read_driver.py,229,Data access for killswitch read operations,get_killswitch_read_driver,1,0,KillswitchStateDTO | GuardrailInfoDTO | IncidentStatsDTO | KillswitchStatusDTO | KillswitchReadDriver,5,,,,killswitch,,db | pydantic | sqlalchemy | sqlmodel,L5:customer_killswitch_read_engine | L5:__init__,L5,killswitch engines (L4),ORM models,"L1, L2, L3, L4, L5",L5 → THIS(L5) → L7,
controls,L5,L5_engines,alert_fatigue,backend/app/hoc/cus/controls/L5_engines/alert_fatigue.py,535,Alert deduplication and fatigue control (Redis-backed),get_alert_fatigue_controller | reset_alert_fatigue_controller,2,0,AlertSuppressReason | AlertRecord | TenantFatigueSettings | AlertCheckResult | AlertFatigueController,5,,,,,,,?:alert_fatigue,?,"AlertEmitter (L3), EventReactor (L5)","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
controls,L5,L5_engines,budget_enforcement_engine,backend/app/hoc/cus/controls/L5_engines/budget_enforcement_engine.py,341,Budget enforcement decision-making (domain logic),emit_budget_halt_decision | process_pending_budget_decisions,2,1,BudgetEnforcementEngine,1,,,budget_enforcement_driver,,,decisions,?:main,?,"Background tasks, API endpoints","L5, L6","L1, L2, L3",? → THIS(L5) → L6,
controls,L5,L5_engines,cb_sync_wrapper,backend/app/hoc/cus/controls/L5_engines/cb_sync_wrapper.py,169,Circuit breaker sync wrapper (thread-safe async bridge),_get_executor | _run_async_in_thread | is_v2_disabled_sync | get_state_sync | shutdown_executor,5,0,,0,,,,,,__future__ | circuit_breaker_async | futures,?:__init__ | ?:cb_sync_wrapper | ?:circuit_breaker_async | L6:circuit_breaker_async | ?:test_integration_real_db,? + L6,"sync middleware, legacy code","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L6 → THIS(L5),
controls,L5,L5_engines,controls_facade,backend/app/hoc/cus/controls/L5_engines/controls_facade.py,438,Controls Facade - Centralized access to control operations,get_controls_facade,1,0,ControlType | ControlState | ControlConfig | ControlStatusSummary | ControlsFacade,5,,,,,,,L4:controls_handler,L4,"L2 controls.py API, SDK","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 → THIS(L5),
controls,L5,L5_engines,cost_safety_rails,backend/app/hoc/cus/controls/L5_engines/cost_safety_rails.py,402,Cost safety rail enforcement (business rules),get_safety_rails,1,0,SafetyConfig | CostSafetyRails | SafeCostLoopOrchestrator,3,,,,,,__future__ | cost_bridges,?:test_m27_cost_loop,?,"cost services, workers","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
controls,L5,L5_engines,decisions,backend/app/hoc/cus/controls/L5_engines/decisions.py,221,Phase-7 Decision enum and result types,allow | reject_rate_limit | reject_cost_limit | throttle | warn,5,0,Decision | ProtectionResult | AnomalySignal,3,,,,,,,?:protection_gate | ?:overview | ?:protection_dependencies | ?:workers | L2:protection_dependencies | L2:overview | L2:workers | ?:main | L5:budget_enforcement_engine | L5:overview_facade,? + L2 + L5,"AbuseProtectionProvider, protection middleware","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L5 → THIS(L5),
controls,L5,L5_engines,killswitch,backend/app/hoc/cus/controls/L5_engines/killswitch.py,262,Optimization killswitch for emergency stops (pure state logic),get_killswitch | reset_killswitch_for_testing,2,0,KillSwitchState | KillSwitchTrigger | RollbackStatus | KillSwitchEvent | KillSwitch,5,,,,,,,L3:customer_killswitch_adapter | ?:guard | ?:incidents | ?:ops | ?:replay | ?:v1_killswitch | ?:v1_proxy | L2:incidents | L2:guard | L2:replay,? + L2 + L3 + L4 + L5 + L6,"API routes, workers","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L3 → THIS(L5),
controls,L5,L5_engines,s2_cost_smoothing,backend/app/hoc/cus/controls/L5_engines/s2_cost_smoothing.py,220,S2 Cost smoothing envelope implementation,create_s2_envelope | validate_s2_envelope | calculate_s2_bounded_value,3,0,,0,,,,,,envelope,?:__init__ | ?:test_c3_s2_cost_smoothing | ?:test_c3_s3_failure_matrix,?,optimization/coordinator,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
controls,L5,L5_engines,threshold_engine,backend/app/hoc/cus/controls/L5_engines/threshold_engine.py,708,Threshold resolution and evaluation logic (decision engine),create_threshold_signal_record | collect_signals_from_evaluation,2,0,ThresholdParams | ThresholdParamsUpdate | ThresholdSignal | ThresholdEvaluationResult | ThresholdDriverProtocol | ThresholdDriverSyncProtocol | LLMRunThresholdResolver | LLMRunEvaluator | LLMRunThresholdResolverSync | LLMRunEvaluatorSync | ThresholdSignalRecord,11,,,threshold_driver,,,pydantic,?:policy_limits_crud | L5:__init__ | L6:threshold_driver | L4:controls_handler | ?:runner,? + L4 + L5 + L6,"L3 Adapters, API routes","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 + L6 → THIS(L5) → L6,
controls,L5,L5_schemas,overrides,backend/app/hoc/cus/controls/L5_schemas/overrides.py,187,Limit override request/response schemas,,0,0,OverrideStatus | LimitOverrideRequest | LimitOverrideResponse | OverrideApprovalRequest | OverrideListResponse,5,,,,,,pydantic,?:override | L2:override | L6:override_driver | ?:__init__ | ?:override_service,? + L2 + L6,"api/limits/override.py, services/limits/override_service.py",None (foundational),"L1, L2, L3, L4, L5",? + L2 + L6 → THIS(L5),
controls,L5,L5_schemas,policy_limits,backend/app/hoc/cus/controls/L5_schemas/policy_limits.py,189,Policy limits request/response schemas,,0,0,LimitCategoryEnum | LimitScopeEnum | LimitEnforcementEnum | ResetPeriodEnum | CreatePolicyLimitRequest | UpdatePolicyLimitRequest | PolicyLimitResponse,7,,,,,,pydantic,?:policy_limits_crud | L2:policy_limits_crud | L5:policy_limits_engine | ?:__init__ | ?:policy_limits_service | ?:test_limit_enhancements,? + L2 + L5,"api/policies.py, services/limits/policy_limits_service.py",None (foundational),"L1, L2, L3, L4, L5",? + L2 + L5 → THIS(L5),
controls,L5,L5_schemas,simulation,backend/app/hoc/cus/controls/L5_schemas/simulation.py,216,Limit simulation request/response schemas,,0,0,SimulationDecision | MessageCode | LimitSimulationRequest | LimitCheckResult | HeadroomInfo | LimitWarning | LimitSimulationResponse,7,,,,,,pydantic,?:legacy_routes | ?:simulate | ?:interpreter | L2:simulate | L5:interpreter | ?:evaluator | ?:__init__ | ?:simulation_engine,? + L2 + L5,"api/limits/simulate.py, services/limits/simulation_service.py",None (foundational),"L1, L2, L3, L4, L5",? + L2 + L5 → THIS(L5),
controls,L6,L6_drivers,budget_enforcement_driver,backend/app/hoc/cus/controls/L6_drivers/budget_enforcement_driver.py,124,Budget enforcement data access operations,get_budget_enforcement_driver,1,0,BudgetEnforcementDriver,1,,,,,,sqlalchemy,L5:budget_enforcement_engine,L5,budget_enforcement_engine.py (L5 engine),"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 → THIS(L6),
controls,L6,L6_drivers,circuit_breaker,backend/app/hoc/cus/controls/L6_drivers/circuit_breaker.py,983,DB-backed circuit breaker state tracking (sync) — L6 DOES NOT COMMIT,create_circuit_breaker | is_v2_disabled | disable_v2 | enable_v2,4,3,CircuitBreakerState | Incident | CircuitBreaker,3,,,,,,__future__ | config | db | httpx | infra | sqlmodel,?:__init__ | ?:canary | ?:circuit_breaker | L5:canary | ?:check_priority5_intent | ?:test_circuit_breaker | ?:conftest,? + L5,"L5 engines (must provide session, must own transaction boundary)","L6, L7 (models)",,? + L5 → THIS(L6),
controls,L6,L6_drivers,circuit_breaker_async,backend/app/hoc/cus/controls/L6_drivers/circuit_breaker_async.py,999,Async DB-backed circuit breaker state tracking,_get_or_create_state | is_v2_disabled | _try_auto_recover | _auto_recover | get_state | report_drift | report_schema_error | disable_v2 | enable_v2 | _trip | _resolve_incident | get_incidents | _enqueue_alert | _build_disable_alert_payload | _build_enable_alert_payload | get_async_circuit_breaker,16,13,CircuitBreakerState | Incident | AsyncCircuitBreaker,3,,,,costsim_cb,,__future__ | asyncio | cb_sync_wrapper | config | db_async | infra | metrics | sqlalchemy,?:__init__ | ?:canary | ?:cb_sync_wrapper | ?:circuit_breaker_async | ?:sandbox | L5:canary | L5:sandbox | L5:cb_sync_wrapper | ?:check_priority5_intent | ?:test_circuit_breaker_async,? + L5,"sandbox.py, canary.py (L5 engines)","L6, L7 (models)",,? + L5 → THIS(L6) → L7,
controls,L6,L6_drivers,limits_read_driver,backend/app/hoc/cus/controls/L6_drivers/limits_read_driver.py,281,Read operations for limits,get_limits_read_driver,1,0,LimitsReadDriver,1,,,,policy_control_plane,,asyncio | sqlalchemy | time,L5:policies_limits_query_engine | L6:__init__,L5 + L6,L5 policies_limits_query_engine,"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 + L6 → THIS(L6) → L7,
controls,L6,L6_drivers,override_driver,backend/app/hoc/cus/controls/L6_drivers/override_driver.py,266,Limit override driver (PIN-LIM-05) - DB boundary crossing,,0,0,LimitOverrideServiceError | LimitNotFoundError | OverrideNotFoundError | OverrideValidationError | StackingAbuseError | LimitOverrideService,6,,overrides,,policy_control_plane,,asyncio | cross_domain | sqlalchemy | time,L2:override,L2,"L5 engines, api/limits/override.py","L6, L7 (models)","L1, L2, L3, L4, L5",L2 → THIS(L6) → L5s + L7,
controls,L6,L6_drivers,policy_limits_driver,backend/app/hoc/cus/controls/L6_drivers/policy_limits_driver.py,117,Data access for policy limits CRUD operations,get_policy_limits_driver,1,0,PolicyLimitsDriver,1,,,,policy_control_plane,,asyncio | sqlalchemy,L5:policy_limits_engine,L5,policy_limits_service.py (L5 engine),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6) → L7,
controls,L6,L6_drivers,scoped_execution,backend/app/hoc/cus/controls/L6_drivers/scoped_execution.py,696,"Pre-execution gate, scope enforcement",get_scope_store | create_recovery_scope | execute_with_scope | validate_scope_required | requires_scoped_execution | test_recovery_scope,6,4,RiskClass | ExecutionScope | ScopedExecutionResult | RecoveryAction | ScopedExecutionContext | ScopedExecutionRequired | ScopeNotFound | ScopeExhausted | ScopeExpired | ScopeActionMismatch | ScopeIncidentMismatch | BoundExecutionScope | ScopeStore,13,,,,,,__future__,?:recovery | L2:recovery | ?:scoped_execution,? + L2,"L2 APIs (recovery actions), L5 workers","L6, L7 (models)",,? + L2 → THIS(L6),
controls,L6,L6_drivers,threshold_driver,backend/app/hoc/cus/controls/L6_drivers/threshold_driver.py,380,Database operations for threshold limits,emit_threshold_signal_sync | emit_and_persist_threshold_signal,2,0,LimitSnapshot | ThresholdDriver | ThresholdDriverSync,3,threshold_engine,,run_signal_service,policy_control_plane,activity/run_signal_service,asyncio | event_emitter | sqlalchemy | sqlmodel,L6:__init__ | L5:threshold_engine | ?:runner,? + L5 + L6,threshold_engine.py (L5),"L6, L7 (models)",,? + L5 + L6 → THIS(L6) → L5 + L6 + L7,
incidents,L5,L5_engines,anomaly_bridge,backend/app/hoc/cus/incidents/L5_engines/anomaly_bridge.py,351,"Anomaly-to-Incident bridge (incidents-owned, not analytics)",get_anomaly_incident_bridge,1,0,CostAnomalyFact | AnomalyIncidentBridge,2,,,incident_write_driver,,,governance | metrics | sqlalchemy,L5:cost_anomaly_detector,L5,Orchestrators that process CostAnomalyFact from analytics,"L6 (incidents drivers), L4 (incident engines)","L1, L2, analytics engines/drivers",L5 → THIS(L5) → L6,
incidents,L5,L5_engines,hallucination_detector,backend/app/hoc/cus/incidents/L5_engines/hallucination_detector.py,467,Detect potential hallucinations in LLM outputs (non-blocking),create_detector_for_tenant,1,0,HallucinationType | HallucinationSeverity | HallucinationIndicator | HallucinationResult | HallucinationConfig | HallucinationDetector,6,,,,,,,?:hallucination_hook | ?:__init__,?,"worker/runner.py, services/incident_engine.py","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
incidents,L5,L5_engines,incident_driver,backend/app/hoc/cus/incidents/L5_engines/incident_driver.py,279,Incident Domain Engine - Internal orchestration for incident operations,get_incident_driver,1,0,IncidentDriver,1,incident_engine,,,,,audit_store | rac_models,L4:transaction_coordinator | ?:incident_driver | ?:__init__,? + L4,"worker runtime, governance services, transaction coordinator","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 → THIS(L5) → L5,
incidents,L5,L5_engines,incident_engine,backend/app/hoc/cus/incidents/L5_engines/incident_engine.py,905,Incident creation decision-making (domain logic),_get_lessons_learned_engine | get_incident_engine,2,0,IncidentEngine,1,lessons_engine,,incident_write_driver,,policies/lessons_engine,orm | sqlalchemy | sqlmodel | time,L5:hallucination_detector | L5:incident_driver | ?:incident_driver | ?:hallucination_detector | ?:inject_synthetic,? + L5,"Worker runtime, API endpoints","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5) → L5 + L6,
incidents,L5,L5_engines,incident_pattern_engine,backend/app/hoc/cus/incidents/L5_engines/incident_pattern_engine.py,279,Detect structural patterns across incidents,,0,0,PatternMatch | PatternResult | IncidentPatternService,3,,,incident_pattern_driver,,,asyncio | time,L5:incidents_facade,L5,Incidents API (L2),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5) → L6,
incidents,L5,L5_engines,incident_read_engine,backend/app/hoc/cus/incidents/L5_engines/incident_read_engine.py,153,Incident domain read operations (L5 facade over L6 driver),get_incident_read_service,1,0,IncidentReadService,1,,,incident_read_driver,killswitch,,sqlmodel,L3:customer_incidents_adapter | L5:customer_incidents_adapter,L3 + L5,customer_incidents_adapter.py (L3),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L3 + L5 → THIS(L5) → L6 + L7,
incidents,L5,L5_engines,incident_severity_engine,backend/app/hoc/cus/incidents/L5_engines/incident_severity_engine.py,218,Severity calculation and escalation decisions for incidents,generate_incident_title,1,0,SeverityConfig | IncidentSeverityEngine,2,,,,killswitch,,,L6:incident_aggregator,L6,"incident_aggregator.py (L6), incident engines","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L6 → THIS(L5) → L7,
incidents,L5,L5_engines,incident_write_engine,backend/app/hoc/cus/incidents/L5_engines/incident_write_engine.py,303,Incident domain write operations with audit (L5 facade over L6 driver),get_incident_write_service,1,0,IncidentWriteService,1,audit_ledger_service,,incident_write_driver,audit_ledger | killswitch,logs/audit_ledger_service,sqlmodel,L3:customer_incidents_adapter | L5:customer_incidents_adapter | ?:incident_write_service,? + L3 + L5,customer_incidents_adapter.py (L3),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L3 + L5 → THIS(L5) → L5 + L6 + L7,
incidents,L5,L5_engines,incidents_facade,backend/app/hoc/cus/incidents/L5_engines/incidents_facade.py,983,Incidents domain facade - unified entry point for incident management operations,get_incidents_facade,1,0,IncidentSummaryResult | PaginationResult | IncidentListResult | IncidentDetailResult | IncidentsByRunResult | PatternMatchResult | PatternDetectionResult | RecurrenceGroupResult | RecurrenceAnalysisResult | CostImpactSummaryResult | CostImpactResult | IncidentMetricsResult | HistoricalTrendDataPointResult | HistoricalTrendResult | HistoricalDistributionEntryResult | HistoricalDistributionResult | CostTrendDataPointResult | CostTrendResult | LearningInsightResult | ResolutionSummaryResult | LearningsResult | IncidentsFacade,22,incident_pattern_engine | postmortem_engine | recurrence_analysis_engine,,incidents_facade_driver,,,asyncio,?:incidents | ?:learning_insight_result | ?:learnings_result | ?:pattern_detection_result | ?:pattern_match_result | ?:recurrence_analysis_result | ?:recurrence_group_result | ?:resolution_summary_result | L4:incidents_handler,? + L4,L2 incidents API (incidents.py),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 → THIS(L5) → L5 + L6,
incidents,L5,L5_engines,incidents_types,backend/app/hoc/cus/incidents/L5_engines/incidents_types.py,44,Shared type aliases for incidents domain engines,,0,0,,0,,,,,,,,,All incidents domain engines,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
incidents,L5,L5_engines,llm_failure_engine,backend/app/hoc/cus/incidents/L5_engines/llm_failure_engine.py,348,"S4 failure truth model, fact persistence",,0,0,LLMFailureFact | LLMFailureResult | LLMFailureService,3,,,llm_failure_driver,,,asyncio | runtime,?:llm_failure_service,?,L5 workers (on LLM failure),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5) → L6,
incidents,L5,L5_engines,policy_violation_engine,backend/app/hoc/cus/incidents/L5_engines/policy_violation_engine.py,713,"S3 violation truth model, fact persistence, evidence linking",create_policy_evaluation_record | handle_policy_evaluation_for_run | handle_policy_violation | create_policy_evaluation_sync,4,3,ViolationFact | ViolationIncident | PolicyViolationService | PolicyEvaluationResult,4,,,incident_aggregator | policy_violation_driver,,,asyncio | db | runtime | sqlmodel,,,"L5 policy engine, L5 workers","L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5) → L6,
incidents,L5,L5_engines,postmortem_engine,backend/app/hoc/cus/incidents/L5_engines/postmortem_engine.py,444,Extract learnings and post-mortem insights from resolved incidents,,0,0,ResolutionSummary | LearningInsight | PostMortemResult | CategoryLearnings | PostMortemService,5,,,postmortem_driver,,,asyncio,L5:incidents_facade,L5,Incidents API (L2),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5) → L6,
incidents,L5,L5_engines,prevention_engine,backend/app/hoc/cus/incidents/L5_engines/prevention_engine.py,890,Prevention-based policy validation,get_prevention_engine | evaluate_prevention | create_incident_from_violation | _create_incident_with_service,4,2,PolicyType | Severity | PreventionAction | PolicyViolation | PreventionContext | PreventionResult | BaseValidator | ContentAccuracyValidatorV2 | PIIValidator | SafetyValidator | HallucinationValidator | BudgetValidator | PreventionEngine,13,policy_violation_service,,,,,db_async | prometheus_client,L5:authority_checker | L6:arbitrator | L6:scope_resolver | L4:alert_emitter | ?:step_enforcement | L7:monitor_config | L7:override_authority | L7:threshold_signal | ?:__init__ | ?:arbitrator,? + L4 + L5 + L6 + L7,"policy/engine, workers","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 + L6 + L7 → THIS(L5) → L5,
incidents,L5,L5_engines,recovery_rule_engine,backend/app/hoc/cus/incidents/L5_engines/recovery_rule_engine.py,802,Rule-based evaluation engine for recovery suggestions,combine_confidences | should_select_action | should_auto_execute | classify_error_category | suggest_recovery_mode | evaluate_rules,6,0,RuleContext | RuleResult | EvaluationResult | Rule | ErrorCodeRule | HistoricalPatternRule | SkillSpecificRule | OccurrenceThresholdRule | CompositeRule | RecoveryRuleEngine,10,,,,,,,?:recovery | ?:failure_intelligence | L2:recovery | L5:recovery_evaluation_engine | ?:failure_classification_engine | ?:recovery_evaluation_engine | ?:test_m10_recovery_enhanced,? + L2 + L5,recovery_evaluator.py (worker),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L5 → THIS(L5),
incidents,L5,L5_engines,recurrence_analysis_engine,backend/app/hoc/cus/incidents/L5_engines/recurrence_analysis_engine.py,189,Analyze recurring incident patterns (business logic),,0,0,RecurrenceGroup | RecurrenceResult | RecurrenceAnalysisService,3,,,recurrence_analysis_driver,,,asyncio | time,L5:incidents_facade,L5,"Incidents API (L2), incidents_facade.py (L5)","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5) → L6,
incidents,L5,L5_engines,semantic_failures,backend/app/hoc/cus/incidents/L5_engines/semantic_failures.py,298,Semantic failure taxonomy and fix guidance for incidents domain,get_failure_info | get_fix_owner | get_fix_action | get_violation_class | format_violation_message,5,0,,0,,,,,,semantic_types,?:semantic_validator | ?:__init__,?,"Panel adapters (L3), incident engines (L5)","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
incidents,L6,L6_drivers,export_bundle_driver,backend/app/hoc/cus/incidents/L6_drivers/export_bundle_driver.py,421,Generate structured export bundles from incidents and traces,get_export_bundle_service,1,0,ExportBundleService,1,,,,export_bundles,,db | sqlmodel | store,L2:incidents,L2,api/incidents.py,"L6, L7 (models)","L1, L2, L3, L4, L5",L2 → THIS(L6) → L7,
incidents,L6,L6_drivers,incident_aggregator,backend/app/hoc/cus/incidents/L6_drivers/incident_aggregator.py,613,Incident aggregation persistence - pure data access,create_incident_aggregator,1,0,IncidentAggregatorConfig | IncidentKey | IncidentAggregator,3,incident_severity_engine,,,killswitch,,runtime | sqlalchemy | sqlmodel,L5:policy_violation_engine,L5,"L2 APIs, L5 workers","L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6) → L5 + L7,
incidents,L6,L6_drivers,incident_pattern_driver,backend/app/hoc/cus/incidents/L6_drivers/incident_pattern_driver.py,255,Data access for incident pattern detection operations (async),get_incident_pattern_driver,1,0,IncidentPatternDriver,1,,,,,,asyncio | sqlalchemy,L5:incident_pattern_engine,L5,IncidentPatternEngine (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6),
incidents,L6,L6_drivers,incident_read_driver,backend/app/hoc/cus/incidents/L6_drivers/incident_read_driver.py,209,Data access for incident read operations,get_incident_read_driver,1,0,IncidentReadDriver,1,,,,killswitch,,sqlalchemy | sqlmodel,L5:incident_read_engine | L6:__init__,L5 + L6,incident engines (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 + L6 → THIS(L6) → L7,
incidents,L6,L6_drivers,incident_write_driver,backend/app/hoc/cus/incidents/L6_drivers/incident_write_driver.py,540,Data access for incident write operations,get_incident_write_driver,1,0,IncidentWriteDriver,1,,,,killswitch,,sqlalchemy | sqlmodel,L5:anomaly_bridge | L5:incident_engine | L5:incident_write_engine | L6:__init__ | ?:incident_write_engine,? + L5 + L6,incident engines (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",? + L5 + L6 → THIS(L6) → L7,
incidents,L6,L6_drivers,incidents_facade_driver,backend/app/hoc/cus/incidents/L6_drivers/incidents_facade_driver.py,531,Database operations for incidents facade - pure data access,,0,0,IncidentSnapshot | IncidentListSnapshot | MetricsSnapshot | CostImpactRowSnapshot | IncidentsFacadeDriver,5,,,,killswitch,,asyncio | sqlalchemy,L5:incidents_facade,L5,incidents_facade.py (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6) → L7,
incidents,L6,L6_drivers,lessons_driver,backend/app/hoc/cus/incidents/L6_drivers/lessons_driver.py,649,Data access for lessons_learned operations,get_lessons_driver,1,0,LessonsDriver,1,,,,,,sqlalchemy | sqlmodel,L5:lessons_engine,L5,LessonsLearnedEngine (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6),
incidents,L6,L6_drivers,llm_failure_driver,backend/app/hoc/cus/incidents/L6_drivers/llm_failure_driver.py,331,Data access for LLM failure operations (async),get_llm_failure_driver,1,0,LLMFailureDriver,1,,,,,,asyncio | sqlalchemy,L5:llm_failure_engine | ?:llm_failure_engine,? + L5,LLMFailureEngine (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",? + L5 → THIS(L6),
incidents,L6,L6_drivers,policy_violation_driver,backend/app/hoc/cus/incidents/L6_drivers/policy_violation_driver.py,490,Data access for policy violation operations (async + sync),insert_policy_evaluation_sync | get_policy_violation_driver,2,0,PolicyViolationDriver,1,,,,,,asyncio | psycopg2 | sqlalchemy,L5:policy_violation_engine,L5,PolicyViolationEngine (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6),
incidents,L6,L6_drivers,postmortem_driver,backend/app/hoc/cus/incidents/L6_drivers/postmortem_driver.py,316,Data access for post-mortem analytics operations (async),get_postmortem_driver,1,0,PostMortemDriver,1,,,,,,asyncio | sqlalchemy,L5:postmortem_engine,L5,PostMortemEngine (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6),
incidents,L6,L6_drivers,recurrence_analysis_driver,backend/app/hoc/cus/incidents/L6_drivers/recurrence_analysis_driver.py,213,Database operations for recurrence analysis - pure data access,,0,0,RecurrenceGroupSnapshot | RecurrenceAnalysisDriver,2,,,,,,asyncio | sqlalchemy,L5:recurrence_analysis_engine | ?:__init__ | ?:incidents_facade,? + L5,recurrence_analysis_engine.py (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",? + L5 → THIS(L6),
integrations,L5,L5_engines,bridges,backend/app/hoc/cus/integrations/L5_engines/bridges.py,1229,Integration bridge abstractions with embedded DB operations,_check_frozen | create_bridges | register_all_bridges,3,0,BaseBridge | IncidentToCatalogBridge | PatternToRecoveryBridge | RecoveryToPolicyBridge | PolicyToRoutingBridge | LoopStatusBridge,6,,,,,,__future__ | audit_schemas | bridges_driver | dispatcher | loop_events | sqlalchemy,?:__init__,?,"dispatcher, workers","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
integrations,L5,L5_engines,cloud_functions_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/cloud_functions_adapter.py,313,Google Cloud Functions serverless adapter,,0,0,CloudFunctionsAdapter,1,,,,,,base | cloud | httpx,L3:__init__,L3,"SkillExecutor, WorkflowEngine","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,connectors_facade,backend/app/hoc/cus/integrations/L5_engines/connectors_facade.py,439,Connectors Facade - Centralized access to connector operations,get_connectors_facade,1,0,ConnectorInfo | TestResult | ConnectorsFacade,3,,,connector_registry,,,,L4:integrations_handler,L4,"L2 connectors.py API, SDK","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 → THIS(L5) → L6,
integrations,L5,L5_engines,cost_bridges_engine,backend/app/hoc/cus/integrations/L5_engines/cost_bridges_engine.py,1147,Cost-related integration bridges (cost loop business logic),,0,0,AnomalyType | AnomalySeverity | CostAnomaly | CostLoopBridge | CostPatternMatcher | CostRecoveryGenerator | CostPolicyGenerator | CostRoutingAdjuster | CostEstimationProbe | CostLoopOrchestrator,10,,,,,,__future__ | loop_events | orchestrator,L5:__init__,L5,"cost services, workers","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5),
integrations,L5,L5_engines,cus_health_engine,backend/app/hoc/cus/integrations/L5_engines/cus_health_engine.py,534,Health checking engine for customer LLM integrations,,0,0,CusHealthService,1,,,,cus_models,,cus_credential_service | db | httpx | sqlmodel,?:cus_health_service,?,"cus_integration_service.py, scheduled health checks","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5) → L7,
integrations,L5,L5_engines,cus_integration_service,backend/app/hoc/cus/integrations/L5_engines/cus_integration_service.py,68,"Customer integration service - LLM BYOK, SDK, RAG management",get_cus_integration_service,1,0,,0,,,,,,cus_integration_engine,L5:integrations_facade | ?:cus_integration_service | ?:shim_guard,? + L5,integrations_facade.py,L6 (drivers),"L1, L2, L3, sqlalchemy direct",? + L5 → THIS(L5),
integrations,L5,L5_engines,customer_activity_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/customer_activity_adapter.py,332,Customer activity boundary adapter (L2 → L3 → L5),get_customer_activity_adapter,1,0,CustomerActivitySummary | CustomerActivityDetail | CustomerActivityListResponse | CustomerActivityAdapter,4,activity_facade,,,,activity/activity_facade,asyncio | pydantic,?:test_l2_l3_contracts,?,L2 activity routes,L5,"L1, L2, L6",? → THIS(L5) → L5,
integrations,L5,L5_engines,customer_incidents_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/customer_incidents_adapter.py,398,Customer incidents boundary adapter (L2 → L3 → L4),_translate_severity | _translate_status | get_customer_incidents_adapter,3,0,CustomerIncidentSummary | CustomerIncidentEvent | CustomerIncidentDetail | CustomerIncidentListResponse | CustomerIncidentsAdapter,5,incident_read_engine | incident_write_engine,,,,incidents/incident_read_engine | incidents/incident_write_engine,pydantic | sqlmodel,L3:__init__ | ?:guard | L2:guard | ?:test_l2_l3_contracts,? + L2 + L3,guard.py (L2) — to be wired,L4,"L1, L2, L5, L6",? + L2 + L3 → THIS(L5) → L5,
integrations,L5,L5_engines,customer_keys_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/customer_keys_adapter.py,305,Customer API keys boundary adapter (L2 → L3 → L4),get_customer_keys_adapter,1,0,CustomerKeyInfo | CustomerKeyListResponse | CustomerKeyAction | CustomerKeysAdapter,4,keys_engine,,,,api_keys/keys_engine,pydantic | sqlmodel,L3:__init__ | ?:guard | L2:guard | ?:test_l2_l3_contracts,? + L2 + L3,guard.py (L2) — to be wired,L4,"L1, L2, L5, L6",? + L2 + L3 → THIS(L5) → L5,
integrations,L5,L5_engines,customer_logs_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/customer_logs_adapter.py,410,Customer logs boundary adapter (L2 → L3 → L4),get_customer_logs_adapter,1,0,CustomerLogSummary | CustomerLogStep | CustomerLogDetail | CustomerLogListResponse | CustomerLogsAdapter,5,logs_read_engine,,,,logs/logs_read_engine,pydantic,L3:__init__ | ?:guard_logs | L2:guard_logs | ?:test_l2_l3_contracts,? + L2 + L3,guard_logs.py (L2),L4,"L1, L2, L5, L6",? + L2 + L3 → THIS(L5) → L5,
integrations,L5,L5_engines,customer_policies_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/customer_policies_adapter.py,279,Customer policies boundary adapter (L2 → L3 → L4),get_customer_policies_adapter,1,0,CustomerBudgetConstraint | CustomerRateLimit | CustomerGuardrail | CustomerPolicyConstraints | CustomerPoliciesAdapter,5,customer_policy_read_engine,,,,policies/customer_policy_read_engine,pydantic,L3:__init__ | ?:guard_policies | L2:guard_policies | ?:test_l2_l3_contracts,? + L2 + L3,guard_policies.py (L2),L4,"L1, L2, L5, L6",? + L2 + L3 → THIS(L5) → L5,
integrations,L5,L5_engines,datasources_facade,backend/app/hoc/cus/integrations/L5_engines/datasources_facade.py,451,DataSources Facade - Centralized access to data source operations,get_datasources_facade,1,0,TestConnectionResult | DataSourcesFacade,2,,datasource_model,,,,,L4:integrations_handler,L4,"L2 datasources.py API, SDK","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 → THIS(L5) → L5s,
integrations,L5,L5_engines,dispatcher,backend/app/hoc/cus/integrations/L5_engines/dispatcher.py,806,Integration event dispatcher with embedded DB persistence,,0,0,DispatcherConfig | IntegrationDispatcher,2,,,,,,__future__ | loop_events | sqlalchemy,L5:bridges | ?:__init__ | ?:bridges | ?:test_m25_integration_loop,? + L5,"workers, bridges","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
integrations,L5,L5_engines,file_storage_base,backend/app/hoc/cus/integrations/L5_engines/external_adapters/file_storage_base.py,299,Base class for file storage adapters,,0,0,FileMetadata | UploadResult | DownloadResult | ListResult | FileStorageAdapter,5,,,,,,,,,File storage adapter implementations,"L4, L6","L1, L2",THIS(L5),
integrations,L5,L5_engines,founder_ops_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/founder_ops_adapter.py,145,Translate OpsIncident domain models to Founder-facing views,,0,0,FounderIncidentSummaryView | FounderIncidentsSummaryResponse | FounderOpsAdapter,3,,,,,,ops_domain_models,?:ops,?,ops.py (L2),"L4, L6","L1, L2, L5",? → THIS(L5),
integrations,L5,L5_engines,gcs_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/gcs_adapter.py,442,Google Cloud Storage file storage adapter,,0,0,GCSAdapter,1,,,,,,base | cloud,L3:__init__,L3,"DataIngestionExecutor, ExportService","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,graduation_engine,backend/app/hoc/cus/integrations/L5_engines/graduation_engine.py,594,Agent graduation evaluation domain logic (pure computation),,0,0,GraduationThresholds | GateEvidence | GraduationEvidence | GraduationLevel | ComputedGraduationStatus | GraduationEngine | CapabilityGates | SimulationState,8,,,,,,__future__,?:M25_integrations | L2:M25_integrations | ?:graduation_evaluator | ?:test_m25_graduation_downgrade,? + L2,graduation_evaluator.py (L5),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 → THIS(L5),
integrations,L5,L5_engines,http_connector,backend/app/hoc/cus/integrations/L5_engines/http_connector.py,367,Machine-controlled HTTP connector (NOT LLM-controlled),,0,0,HttpMethod | EndpointConfig | HttpConnectorConfig | HttpConnectorError | RateLimitExceededError | HttpConnectorService,6,credentials,,,,,httpx,?:__init__ | ?:test_connectors,?,RetrievalMediator,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5) → L5,
integrations,L5,L5_engines,iam_engine,backend/app/hoc/cus/integrations/L5_engines/iam_engine.py,440,IAM engine for identity and access management,,0,0,IdentityProvider | ActorType | Identity | AccessDecision | IAMService,5,,,,,,jwt,,,"Auth middleware, API routes","L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
integrations,L5,L5_engines,integrations_facade,backend/app/hoc/cus/integrations/L5_engines/integrations_facade.py,491,Integrations domain facade - unified entry point for integration management,get_integrations_facade,1,0,IntegrationSummaryResult | IntegrationListResult | IntegrationDetailResult | IntegrationLifecycleResult | IntegrationDeleteResult | HealthCheckResult | HealthStatusResult | LimitsStatusResult | IntegrationsFacade,9,cus_integration_service,,,,,,?:aos_cus_integrations | L4:integrations_handler,? + L4,L2 integrations API (aos_cus_integrations.py),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 → THIS(L5) → L5,
integrations,L5,L5_engines,lambda_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/lambda_adapter.py,281,AWS Lambda serverless adapter,,0,0,LambdaAdapter,1,,,,,,aioboto3 | base,L3:__init__,L3,"SkillExecutor, WorkflowEngine","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,mcp_connector,backend/app/hoc/cus/integrations/L5_engines/mcp_connector.py,423,Model Context Protocol (MCP) tool invocation with governance,,0,0,McpToolDefinition | McpConnectorConfig | McpConnectorError | McpApprovalRequiredError | McpRateLimitExceededError | McpSchemaValidationError | McpConnectorService,7,credentials,,,,,httpx | jsonschema,?:__init__ | ?:test_connectors,?,RetrievalMediator,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5) → L5,
integrations,L5,L5_engines,pgvector_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/pgvector_adapter.py,378,PGVector production adapter,,0,0,PGVectorAdapter,1,,,,,,asyncpg | base,L3:__init__,L3,"RetrievalMediator, IndexingExecutor","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,pinecone_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/pinecone_adapter.py,283,Pinecone vector store adapter,,0,0,PineconeAdapter,1,,,,,,base | pinecone,L3:__init__,L3,"RetrievalMediator, IndexingExecutor","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,prevention_contract,backend/app/hoc/cus/integrations/L5_engines/prevention_contract.py,201,Prevention contract enforcement (validation logic),validate_prevention_candidate | assert_prevention_immutable | assert_no_deletion | validate_prevention_for_graduation,4,0,PreventionContractViolation | PreventionCandidate,2,,,,,,__future__,L5:__init__,L5,"policy engine, workers","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5),
integrations,L5,L5_engines,protocol,backend/app/hoc/cus/integrations/L5_engines/credentials/protocol.py,63,Canonical CredentialService protocol for connector services,,0,0,CredentialService,1,,,,,,types,L5:__init__ | L5:http_connector | L5:mcp_connector | L5:sql_gateway | ?:credential_service,? + L5,"http_connector.py, mcp_connector.py, sql_gateway.py","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
integrations,L5,L5_engines,runtime_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/runtime_adapter.py,215,Translate API requests into runtime domain commands,get_runtime_adapter,1,0,RuntimeAdapter,1,,,,,,runtime_command,L3:__init__ | ?:runtime | L2:runtime | L4:runtime_adapter,? + L2 + L3 + L4,runtime.py (L2),"L4, L6","L1, L2, L5",? + L2 + L3 + L4 → THIS(L5),
integrations,L5,L5_engines,s3_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/s3_adapter.py,393,AWS S3 file storage adapter,,0,0,S3Adapter,1,,,,,,aioboto3 | base,L3:__init__,L3,"DataIngestionExecutor, ExportService","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,serverless_base,backend/app/hoc/cus/integrations/L5_engines/external_adapters/serverless_base.py,236,Base class for serverless adapters,,0,0,InvocationType | InvocationRequest | InvocationResult | FunctionInfo | ServerlessAdapter,5,,,,,,,,,Serverless adapter implementations,"L4, L6","L1, L2",THIS(L5),
integrations,L5,L5_engines,slack_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/slack_adapter.py,305,Slack notification adapter,,0,0,SlackAdapter,1,,,,,,async_client | base,L3:__init__,L3,"NotificationService, AlertManager","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,smtp_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/smtp_adapter.py,259,SMTP email notification adapter,,0,0,SMTPAdapter,1,,,,,,aiosmtplib | base | email | multipart | text,L3:__init__,L3,"NotificationService, AlertManager","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,sql_gateway,backend/app/hoc/cus/integrations/L5_engines/sql_gateway.py,464,Template-based SQL queries (NO raw SQL from LLM),,0,0,ParameterType | ParameterSpec | QueryTemplate | SqlGatewayConfig | SqlGatewayError | SqlInjectionAttemptError | SqlGatewayService,7,credentials,,,,,asyncpg,?:__init__ | ?:test_connectors,?,RetrievalMediator,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5) → L5,
integrations,L5,L5_engines,types,backend/app/hoc/cus/integrations/L5_engines/types.py,56,Canonical Credential dataclass for connector services,,0,0,Credential,1,,,,,,,?:gateway_middleware | ?:onboarding_gate | ?:rbac_middleware | L5:__init__ | L5:protocol | L5:http_connector | L5:mcp_connector | L5:sql_gateway | ?:credential,? + L5,"http_connector.py, mcp_connector.py, sql_gateway.py","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
integrations,L5,L5_engines,vector_stores_base,backend/app/hoc/cus/integrations/L5_engines/external_adapters/vector_stores_base.py,265,Base class for vector store adapters,,0,0,VectorRecord | QueryResult | UpsertResult | DeleteResult | IndexStats | VectorStoreAdapter,6,,,,,,,,,Vector store adapter implementations,"L4, L6","L1, L2",THIS(L5),
integrations,L5,L5_engines,weaviate_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/weaviate_adapter.py,399,Weaviate vector store adapter,,0,0,WeaviateAdapter,1,,,,,,auth | base | weaviate,L3:__init__,L3,"RetrievalMediator, IndexingExecutor","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,webhook_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/webhook_adapter.py,472,Webhook notification adapter with retry logic,,0,0,CircuitState | CircuitBreakerConfig | CircuitBreaker | WebhookDeliveryAttempt | WebhookDelivery | WebhookAdapter,6,,,,,,base | httpx,L3:__init__,L3,"NotificationService, AlertManager","L4, L6","L1, L2",L3 → THIS(L5),
integrations,L5,L5_engines,workers_adapter,backend/app/hoc/cus/integrations/L5_engines/external_adapters/workers_adapter.py,208,Worker execution boundary adapter (L2 → L3 → L4),get_workers_adapter,1,0,WorkersAdapter,1,,,,,,worker_execution_command,L3:__init__ | ?:workers | L2:workers,? + L2 + L3,workers.py (L2),"L4, L6","L1, L2, L5",? + L2 + L3 → THIS(L5),
integrations,L5,L5_notifications,channel_engine,backend/app/hoc/cus/integrations/L5_notifications/engines/channel_engine.py,1102,Configurable notification channel management engine,get_notify_service | _reset_notify_service | get_channel_config | send_notification | check_channel_health,5,2,NotifyChannel | NotifyEventType | NotifyChannelStatus | NotifyChannelError | NotifyDeliveryResult | NotifyChannelConfig | NotifyChannelConfigResponse | NotificationSender | NotifyChannelService,9,,,,,,,,,"alert_emitter, incident_service, policy_engine","L5, L6","L1, L2, L3",THIS(L5),
integrations,L5,L5_schemas,audit_schemas,backend/app/hoc/cus/integrations/L5_schemas/audit_schemas.py,59,Audit trail dataclasses for integration bridges,,0,0,PolicyActivationAudit,1,,,,,,__future__,L5:bridges | L5s:__init__ | L6:bridges_driver,L5 + L5s + L6,"bridges, engines",stdlib only,"L6, sqlalchemy",L5 + L5s + L6 → THIS(L5),
integrations,L5,L5_schemas,cus_schemas,backend/app/hoc/cus/integrations/L5_schemas/cus_schemas.py,498,"Pydantic schemas for Customer Integration domain (LLM BYOK, SDK, RAG)",,0,0,CusIntegrationCreate | CusIntegrationUpdate | CusLLMUsageIngest | CusLLMUsageBatchIngest | CusIntegrationResponse | CusIntegrationSummary | CusLimitsStatus | CusUsageSummary | CusIntegrationUsage | CusLLMUsageResponse | CusHealthCheckResponse,11,,,,cus_models,,pydantic,?:aos_cus_integrations | ?:cus_telemetry | L2:cus_telemetry | L2:aos_cus_integrations | ?:cus_integration_engine | ?:cus_telemetry_engine,? + L2,"aos_cus_integrations.py, cus_telemetry.py APIs",cus_models.py (enums only),"L1, L2, L3, L4, L5",? + L2 → THIS(L5) → L7,
integrations,L5,L5_schemas,datasource_model,backend/app/hoc/cus/integrations/L5_schemas/datasource_model.py,582,CustomerDataSource - Customer data source models and registry.,get_datasource_registry | _reset_registry | create_datasource | get_datasource | list_datasources,5,0,DataSourceType | DataSourceStatus | DataSourceConfig | CustomerDataSource | DataSourceError | DataSourceStats | DataSourceRegistry,7,,,,,,,L5:datasources_facade | ?:__init__ | ?:facade | ?:test_customer_datasource,? + L5,,,,? + L5 → THIS(L5),
integrations,L5,L5_schemas,loop_events,backend/app/hoc/cus/integrations/L5_schemas/loop_events.py,968,"Integration loop event definitions (dataclasses, enums)",ensure_json_serializable,1,0,ConfidenceCalculator | ConfidenceBand | LoopStage | LoopFailureState | PolicyMode | HumanCheckpointType | LoopEvent | PatternMatchResult | RecoverySuggestion | PolicyRule | RoutingAdjustment | HumanCheckpoint | LoopStatus,13,,,,,,__future__,L5:bridges | L5:cost_bridges_engine | L5:dispatcher | L5s:__init__ | L6:bridges_driver,L5 + L5s + L6,"integrations/engines/*, integrations/drivers/*",stdlib only,"L6, sqlalchemy",L5 + L5s + L6 → THIS(L5),
integrations,L5,L5_vault,service,backend/app/hoc/cus/integrations/L5_vault/engines/service.py,551,High-level credential service with validation and auditing,,0,0,CredentialAccessRecord | CredentialService,2,,,,,,vault,?:__init__ | ?:agent_spawn | ?:rbac_engine | ?:role_mapping | ?:datasets | ?:failure_intelligence | L5:datasets | ?:definitions,? + L5,"ConnectorRegistry, LifecycleHandlers, API routes","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
integrations,L5,L5_vault,vault,backend/app/hoc/cus/integrations/L5_vault/drivers/vault.py,749,Credential vault abstraction with multiple provider support,create_credential_vault,1,0,VaultProvider | CredentialType | CredentialMetadata | CredentialData | CredentialVault | HashiCorpVault | EnvCredentialVault,7,,,,,,httpx,L5s:cus_schemas | ?:service | L7:cus_models | ?:cus_schemas | ?:__init__,? + L5s + L7,CredentialService,"L6, L7 (models)",,? + L5s + L7 → THIS(L5),
integrations,L6,L6_drivers,connector_registry,backend/app/hoc/cus/integrations/L6_drivers/connector_registry.py,838,Connector management and registration,get_connector_registry | _reset_registry | register_connector | get_connector | list_connectors,5,0,ConnectorType | ConnectorStatus | ConnectorCapability | ConnectorConfig | ConnectorError | BaseConnector | VectorConnector | FileConnector | ServerlessConnector | ConnectorStats | ConnectorRegistry,11,,,,,,,L5:connectors_facade | L4:execution | L4:retrieval_mediator | ?:__init__ | ?:facade | ?:retrieval_mediator | ?:test_retrieval_mediator | ?:test_connector_registry,? + L4 + L5,L5 engines,"L6, L7 (models)",,? + L4 + L5 → THIS(L6),
integrations,L6,L6_drivers,external_response_driver,backend/app/hoc/cus/integrations/L6_drivers/external_response_driver.py,289,External response persistence and interpretation driver,record_external_response | interpret_response | get_interpreted_response,3,0,ExternalResponseService,1,,,,external_response,,orm | sqlalchemy,,,"L3 adapters (record_raw), L4/L5 engines (interpret), L2 (read_interpreted)","L6, L7 (models)",,THIS(L6) → L7,
integrations,L6,L6_drivers,worker_registry_driver,backend/app/hoc/cus/integrations/L6_drivers/worker_registry_driver.py,424,"Worker discovery, status queries, capability registry driver",get_worker_registry_service,1,0,WorkerRegistryError | WorkerNotFoundError | WorkerUnavailableError | WorkerRegistryService,4,,,,tenant,,sqlmodel,L6:__init__,L6,"L5 engines, L2 APIs","L6, L7 (models)",,L6 → THIS(L6) → L7,
logs,L5,L5_engines,audit_evidence,backend/app/hoc/cus/logs/L5_engines/audit_evidence.py,671,Emit compliance-grade audit for MCP tool calls,_hash_value | _contains_sensitive | _redact_sensitive | get_mcp_audit_emitter | configure_mcp_audit_emitter | reset_mcp_audit_emitter,6,0,MCPAuditEventType | MCPAuditEvent | MCPAuditEmitter,3,,,,,,events,?:__init__,?,"Runner, skill executor","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
logs,L5,L5_engines,audit_ledger_service,backend/app/hoc/cus/logs/L5_engines/audit_ledger_service.py,220,Sync audit ledger writer for governance events (incidents),get_audit_ledger_service,1,0,AuditLedgerService,1,,,,audit_ledger,,sqlmodel,L5:incident_write_engine | ?:incident_write_engine,? + L5,incident_write_engine (L5),"L6, L7 (models)","L1, L2, L3, L4",? + L5 → THIS(L5) → L7,
logs,L5,L5_engines,audit_reconciler,backend/app/hoc/cus/logs/L5_engines/audit_reconciler.py,322,Reconcile audit expectations against acknowledgments,get_audit_reconciler,1,0,AuditReconciler,1,,,,,,audit_store | prometheus_client | rac_models,?:run_orchestration_kernel,?,"ROK (L5), Scheduler (L5)","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
logs,L5,L5_engines,certificate,backend/app/hoc/cus/logs/L5_engines/certificate.py,386,Cryptographic certificate generation for deterministic replay,,0,0,CertificateType | CertificatePayload | Certificate | CertificateService,4,replay_determinism,,,,,,?:guard | L4:logs_handler | ?:certificate | ?:mypy_zones | ?:apply,? + L4,guard.py (replay endpoint),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 → THIS(L5) → L5,
logs,L5,L5_engines,completeness_checker,backend/app/hoc/cus/logs/L5_engines/completeness_checker.py,518,Evidence PDF completeness validation for SOC2 compliance,check_evidence_completeness | ensure_evidence_completeness,2,0,CompletenessCheckResult | EvidenceCompletenessError | CompletenessCheckResponse | EvidenceCompletenessChecker,4,,,,,,,?:__init__,?,"pdf_renderer, evidence_report, export APIs","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
logs,L5,L5_engines,evidence_facade,backend/app/hoc/cus/logs/L5_engines/evidence_facade.py,570,Evidence Facade - Centralized access to evidence and export operations,get_evidence_facade,1,0,EvidenceType | ExportFormat | ExportStatus | EvidenceLink | EvidenceChain | VerificationResult | EvidenceExport | EvidenceFacade,8,,,,,,,L5:__init__ | L4:logs_handler,L4 + L5,"L2 evidence.py API, SDK","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 + L5 → THIS(L5),
logs,L5,L5_engines,evidence_report,backend/app/hoc/cus/logs/L5_engines/evidence_report.py,1164,Evidence report generator - Legal-grade PDF export,generate_evidence_report,1,0,CertificateEvidence | IncidentEvidence | EvidenceReportGenerator,3,,,,,,enums | lib | pagesizes | platypus | styles | units,?:guard | L4:logs_handler | ?:mypy_zones | ?:apply,? + L4,guard.py (incident export endpoint),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 → THIS(L5),
logs,L5,L5_engines,logs_facade,backend/app/hoc/cus/logs/L5_engines/logs_facade.py,1407,Logs domain facade - unified entry point for all logs operations,get_logs_facade,1,0,SourceDomain | Origin | EvidenceMetadataResult | LLMRunRecordResult | LLMRunRecordsResult | TraceStepResult | LLMRunEnvelopeResult | LLMRunTraceResult | GovernanceEventResult | LLMRunGovernanceResult | ReplayEventResult | LLMRunReplayResult | LLMRunExportResult | SystemRecordResult | SystemRecordsResult | SystemSnapshotResult | TelemetryStubResult | SystemEventResult | SystemEventsResult | SystemReplayResult | SystemAuditResult | AuditLedgerItemResult | AuditLedgerDetailResult | AuditLedgerListResult | IdentityEventResult | AuditIdentityResult | AuthorizationDecisionResult | AuditAuthorizationResult | AccessEventResult | AuditAccessResult | IntegrityCheckResult | AuditIntegrityResult | ExportRecordResult | AuditExportsResult | LogsFacade,35,,,logs_domain_store,,,,?:logs | L5:__init__ | L4:logs_handler,? + L4 + L5,"L2 logs API, L3 adapters","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 → THIS(L5) → L6,
logs,L5,L5_engines,logs_read_engine,backend/app/hoc/cus/logs/L5_engines/logs_read_engine.py,215,Logs/Traces domain read operations (L5),get_logs_read_service,1,0,LogsReadService,1,,,,,,models | pg_store,L5:customer_logs_adapter | L3:customer_logs_adapter,L3 + L5,customer_logs_adapter.py (L3),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L3 + L5 → THIS(L5),
logs,L5,L5_engines,mapper,backend/app/hoc/cus/logs/L5_engines/mapper.py,273,Map incidents to relevant SOC2 controls,get_control_mappings_for_incident,1,0,SOC2ControlMapper,1,,,,,,control_registry | time,L4:control_registry | ?:__init__ | ?:control_registry,? + L4,"services/export_bundle_service.py, api/incidents.py","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 → THIS(L5),
logs,L5,L5_engines,panel_response_assembler,backend/app/hoc/cus/logs/L5_engines/panel_response_assembler.py,265,Assemble final panel response envelope,create_response_assembler,1,0,PanelResponseAssembler,1,,,,,,panel_consistency_checker | panel_types,L5:ai_console_panel_engine | ?:ai_console_panel_engine | ?:__init__,? + L5,Panel adapters,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
logs,L5,L5_engines,pdf_renderer,backend/app/hoc/cus/logs/L5_engines/pdf_renderer.py,687,Render export bundles to PDF format,get_pdf_renderer,1,0,PDFRenderer,1,,,,export_bundles,,enums | lib | pagesizes | platypus | styles | units,?:incidents | L4:logs_handler | L7:export_bundles,? + L4 + L7,api/incidents.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L7 → THIS(L5) → L7,
logs,L5,L5_engines,redact,backend/app/hoc/cus/logs/L5_engines/redact.py,267,Trace data redaction for security,redact_json_string | redact_dict | redact_list | redact_string_value | redact_trace_data | is_sensitive_field | add_sensitive_field | add_redaction_pattern,8,0,,0,,,,,,,?:traces | L2:traces | L6:pg_store | ?:__init__ | ?:pg_store | ?:mypy_zones,? + L2 + L6,trace store,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L6 → THIS(L5),
logs,L5,L5_engines,replay_determinism,backend/app/hoc/cus/logs/L5_engines/replay_determinism.py,519,Replay determinism validation for LLM calls — CANONICAL DEFINITIONS,,0,0,DeterminismLevel | ModelVersion | PolicyDecision | ReplayMatch | ReplayResult | CallRecord | ReplayValidator | ReplayContextBuilder,8,,,,,,,?:guard | L2:guard | L5:certificate | L4:logs_handler | ?:certificate | ?:replay_determinism,? + L2 + L4 + L5,"logs_facade.py, evidence services, other domains (read-only)","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L4 + L5 → THIS(L5),
logs,L5,L5_engines,trace_facade,backend/app/hoc/cus/logs/L5_engines/trace_facade.py,297,Trace Domain Facade - Centralized access to trace operations with RAC acks,get_trace_facade,1,0,TraceFacade,1,,,,,,audit_store | models | trace_store,L5:__init__ | L4:transaction_coordinator | ?:transaction_coordinator | ?:__init__ | ?:trace_facade,? + L4 + L5,"L5 runner/observability guard (via dependency injection), API routes","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 → THIS(L5),
logs,L5,L5_engines,traces_metrics,backend/app/hoc/cus/logs/L5_engines/traces_metrics.py,297,Trace metrics collection (Prometheus),get_traces_metrics | instrument_trace_request | instrument_replay_check | instrument_parity_check,4,0,TracesMetrics,1,,,,,,prometheus_client,?:__init__,?,trace store,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
logs,L5,L5_engines,traces_models,backend/app/hoc/cus/logs/L5_engines/traces_models.py,420,Trace data models (dataclasses),_normalize_for_determinism | compare_traces,2,0,TraceStatus | TraceStep | TraceSummary | TraceRecord | ParityResult,5,,,,,,,,,traces/*,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
logs,L5,L5_support,audit_engine,backend/app/hoc/cus/logs/L5_support/CRM/engines/audit_engine.py,888,Audit Engine - verifies job execution against contract intent,audit_result_to_record | create_audit_input_from_evidence,2,0,CheckResult | AuditCheck | AuditInput | AuditResult | AuditChecks | AuditService | RolloutGate,7,,,,contract,,,L4:__init__,L4,GovernanceOrchestrator (via AuditTrigger),L6 models only,"L1, L2, L3, L4, L5 (auditor is independent)",L4 → THIS(L5) → L7,
logs,L6,L6_drivers,audit_ledger_service_async,backend/app/hoc/cus/logs/L6_drivers/audit_ledger_service_async.py,329,Async audit ledger writer for governance events,get_audit_ledger_service_async,1,0,AuditLedgerServiceAsync,1,,,,audit_ledger,,asyncio,L5:policy_limits_engine | L5:policy_proposal_engine | L5:policy_rules_engine | ?:policy_limits_service | ?:policy_rules_service | ?:policy_proposal,? + L5,"policy_limits_engine, policy_rules_engine, policy_proposal_engine (L5)","L6, L7 (models)","L1, L2, L3, L4, L5",? + L5 → THIS(L6) → L7,
logs,L6,L6_drivers,bridges_driver,backend/app/hoc/cus/logs/L6_drivers/bridges_driver.py,104,Database operations for integration bridges,record_policy_activation,1,1,,0,,,,,,__future__ | audit_schemas | loop_events | sqlalchemy,L5:bridges | L6:__init__,L5 + L6,bridges_engine,"L6, L7 (models)","L1, L2, L3, L4, L5",L5 + L6 → THIS(L6),
logs,L6,L6_drivers,capture,backend/app/hoc/cus/logs/L6_drivers/capture.py,869,Taxonomy evidence capture service (ctx-aware) — L6 DOES NOT COMMIT,_assert_context_exists | _record_capture_failure | _hash_content | capture_environment_evidence | capture_activity_evidence | capture_provider_evidence | capture_policy_decision_evidence | compute_integrity | capture_integrity_evidence | hash_prompt,10,0,EvidenceContextError | CaptureFailureReason | FailureResolution,3,,,,,,__future__ | exc | execution_context | integrity | sqlalchemy | sqlmodel,?:workers | ?:__init__ | L2:workers | ?:executor | ?:runner | ?:inject_synthetic,? + L2,"L5 engines (must provide session, must own transaction boundary)","L6, L7 (models)",,? + L2 → THIS(L6),
logs,L6,L6_drivers,export_bundle_store,backend/app/hoc/cus/logs/L6_drivers/export_bundle_store.py,242,"Database operations for export bundle data (incidents, runs, traces)",get_export_bundle_store,1,0,IncidentSnapshot | RunSnapshot | TraceSummarySnapshot | TraceStepSnapshot | ExportBundleStore,5,,,,,,db | sqlmodel | store,L6:__init__ | L3:export_bundle_adapter,L3 + L6,L3 ExportBundleAdapter,"L6, L7 (models)",,L3 + L6 → THIS(L6),
logs,L6,L6_drivers,idempotency,backend/app/hoc/cus/logs/L6_drivers/idempotency.py,398,Trace idempotency enforcement (Redis + Lua scripts),_load_lua_script | canonical_json | hash_request | get_idempotency_store,4,1,IdempotencyResult | IdempotencyResponse | RedisIdempotencyStore | InMemoryIdempotencyStore,4,,,,,,asyncio,?:main | ?:skills_base | ?:job_queue_worker | ?:base | ?:__init__,?,"trace store, workers","L6, L7 (models)",,? → THIS(L6),
logs,L6,L6_drivers,integrity,backend/app/hoc/cus/logs/L6_drivers/integrity.py,523,Integrity computation with separated concerns,compute_integrity_v2,1,0,IntegrityState | IntegrityGrade | EvidenceClass | FailureResolution | CaptureFailure | IntegrityFacts | IntegrityAssembler | IntegrityEvaluation | IntegrityEvaluator,9,,,,,,__future__ | exc | sqlalchemy,?:logs | ?:__init__ | ?:capture | L2:logs | L6:capture | ?:SDSR_output_emit_AURORA_L2,? + L2 + L6,"runner.py (at terminal), evidence.capture","L6, L7 (models)",,? + L2 + L6 → THIS(L6),
logs,L6,L6_drivers,job_execution,backend/app/hoc/cus/logs/L6_drivers/job_execution.py,880,"Job execution support services (retry, progress, audit)",_hash_value | get_job_retry_manager | get_job_progress_tracker | get_job_audit_emitter | reset_job_execution_services,5,0,RetryStrategy | RetryConfig | RetryAttempt | JobRetryManager | ProgressStage | ProgressUpdate | JobProgressTracker | JobAuditEventType | JobAuditEvent | JobAuditEmitter,10,,,,,,events | random,?:__init__,?,"JobQueueWorker, APSchedulerExecutor","L6, L7 (models)",,? → THIS(L6),
logs,L6,L6_drivers,logs_domain_store,backend/app/hoc/cus/logs/L6_drivers/logs_domain_store.py,673,"Database operations for Logs domain (LLM runs, system records, audit ledger)",get_logs_domain_store,1,0,LLMRunSnapshot | SystemRecordSnapshot | AuditLedgerSnapshot | LogExportSnapshot | TraceStepSnapshot | QueryResult | LogsDomainStore,7,,,,audit_ledger | log_exports | logs_records,,asyncio | sqlalchemy,L5:logs_facade | L6:__init__,L5 + L6,L5 LogsFacade,"L6, L7 (models)",,L5 + L6 → THIS(L6) → L7,
logs,L6,L6_drivers,panel_consistency_checker,backend/app/hoc/cus/logs/L6_drivers/panel_consistency_checker.py,250,Cross-slot consistency enforcement,create_consistency_checker,1,0,ConsistencyViolation | ConsistencyCheckResult | PanelConsistencyChecker,3,,,,,,panel_types,L5:ai_console_panel_engine | L5:panel_response_assembler | ?:ai_console_panel_engine | ?:panel_metrics_emitter | ?:panel_response_assembler | ?:__init__,? + L5,Panel adapters,"L6, L7 (models)",,? + L5 → THIS(L6),
logs,L6,L6_drivers,pg_store,backend/app/hoc/cus/logs/L6_drivers/pg_store.py,769,PostgreSQL trace storage,_status_to_level | get_postgres_trace_store,2,0,PostgresTraceStore,1,,,,,,asyncpg | models | redact,?:traces | L2:traces | L5:logs_read_engine | ?:runner | ?:replay | ?:logs_read_service | ?:__init__ | ?:mypy_zones | ?:test_trace_fail_closed | ?:apply,? + L2 + L5,trace store abstraction,"L6, L7 (models)",,? + L2 + L5 → THIS(L6),
logs,L6,L6_drivers,replay,backend/app/hoc/cus/logs/L6_drivers/replay.py,329,Trace replay execution,hash_output | get_replay_enforcer,2,0,ReplayBehavior | ReplayMismatchError | IdempotencyViolationError | ReplayResult | ReplayEnforcer | IdempotencyStore | InMemoryIdempotencyStore | RedisIdempotencyStore,8,,,,,,asyncio,?:logs | ?:runtime | ?:workers | L2:logs | L2:runtime | L2:workers | ?:main | L4:logs_handler | ?:execution_plan | ?:__init__,? + L2 + L4,API routes,"L6, L7 (models)",,? + L2 + L4 → THIS(L6),
logs,L6,L6_drivers,traces_store,backend/app/hoc/cus/logs/L6_drivers/traces_store.py,757,Trace store abstraction,generate_correlation_id | generate_run_id,2,0,TraceStore | SQLiteTraceStore | InMemoryTraceStore,3,,,,,,models | sqlite3,,,"services, workers","L6, L7 (models)",,THIS(L6),
overview,L5,L5_engines,overview_facade,backend/app/hoc/cus/overview/L5_engines/overview_facade.py,619,Overview Engine - Centralized access to overview domain operations,get_overview_facade,1,0,SystemPulse | DomainCount | HighlightsResult | DecisionItem | DecisionsResult | CostPeriod | LimitCostItem | CostsResult | DecisionsCountResult | RecoveryStatsResult | OverviewFacade,11,,,overview_facade_driver,,,__future__ | asyncio | time,?:overview | L5:__init__ | L4:overview_handler | L4:operation_registry | ?:overview_facade,? + L4 + L5,L2 API routes (/overview/*),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 → THIS(L5) → L6,
overview,L6,L6_drivers,overview_facade_driver,backend/app/hoc/cus/overview/L6_drivers/overview_facade_driver.py,519,Overview Facade Driver - Pure data access for overview aggregation,,0,0,IncidentCountSnapshot | ProposalCountSnapshot | BreachCountSnapshot | RunCountSnapshot | AuditCountSnapshot | IncidentSnapshot | ProposalSnapshot | LimitSnapshot | RunCostSnapshot | BreachStatsSnapshot | IncidentDecisionCountSnapshot | RecoverySnapshot | OverviewFacadeDriver,13,,,,audit_ledger | killswitch | policy | policy_control_plane | tenant,,asyncio | sqlalchemy | time,L5:overview_facade | L6:__init__,L5 + L6,overview_facade.py (L5),"L6, L7 (models)",,L5 + L6 → THIS(L6) → L7,
policies,L5,L5_engines,ast,backend/app/hoc/cus/policies/L5_engines/ast.py,381,"Policy DSL AST node definitions (immutable, typed)",is_predicate | is_exists_predicate | is_logical_condition | is_warn_action | is_block_action | is_require_approval_action,6,0,Scope | Mode | Comparator | LogicalOperator | WarnAction | BlockAction | RequireApprovalAction | Predicate | ExistsPredicate | LogicalCondition | Clause | PolicyMetadata | PolicyAST,13,,,,,,__future__,?:__init__ | ?:ir_compiler | ?:parser | ?:validator | L5:compiler_parser | L5:dsl_parser | L5:ir_builder | L5:ir_compiler | L5:validator | L5:visitors,? + L5,"policy/compiler, policy/engine","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
policies,L5,L5_engines,authority_checker,backend/app/hoc/cus/policies/L5_engines/authority_checker.py,284,Check override authority before policy enforcement,should_skip_enforcement,1,0,OverrideStatus | OverrideCheckResult | OverrideAuthorityChecker,3,,,,,,,?:__init__,?,"policy/prevention_engine.py, services/enforcement/","L6, L7","L1, L2, L3, L4, sqlalchemy, sqlmodel",? → THIS(L5),
policies,L5,L5_engines,binding_moment_enforcer,backend/app/hoc/cus/policies/L5_engines/binding_moment_enforcer.py,276,Enforce binding moments - when policies are evaluated,should_evaluate_policy | get_binding_moment | clear_run_cache | _mark_evaluated | _was_evaluated | _check_fields_changed,6,0,BindingMoment | EvaluationPoint | BindingDecision,3,,,,,,,L5:prevention_engine | ?:prevention_engine | ?:test_binding_moment_enforcer,? + L5,prevention_engine.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
policies,L5,L5_engines,claim_decision_engine,backend/app/hoc/cus/policies/L5_engines/claim_decision_engine.py,123,Domain engine for recovery claim decisions.,is_candidate_claimable | determine_claim_status | get_result_confidence,3,0,,0,,,,,,,,,L4 services (L5 no longer imports this module),,,THIS(L5),
policies,L5,L5_engines,compiler_parser,backend/app/hoc/cus/policies/L5_engines/compiler_parser.py,460,Policy language parser,,0,0,ParseError | Parser,2,,,,,,grammar | nodes | tokenizer,,,policy/engine,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
policies,L5,L5_engines,content_accuracy,backend/app/hoc/cus/policies/L5_engines/content_accuracy.py,386,Policy content accuracy validation (pure logic),validate_content_accuracy,1,0,AssertionType | ValidationResult | AssertionCheck | ContentAccuracyResult | ContentAccuracyValidator,5,,,,,,,L5:prevention_hook | ?:__init__ | ?:prevention_hook,? + L5,policy/engine,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
policies,L5,L5_engines,cus_enforcement_service,backend/app/hoc/cus/policies/L5_engines/cus_enforcement_service.py,80,Customer enforcement service - LLM integration policy enforcement,get_cus_enforcement_service,1,0,,0,,,,,,cus_enforcement_engine,?:cus_enforcement | L4:policies_handler | ?:shim_guard,? + L4,cus_enforcement.py,L6 (drivers),"L1, L2, L3, sqlalchemy direct",? + L4 → THIS(L5),
policies,L5,L5_engines,customer_policy_read_engine,backend/app/hoc/cus/policies/L5_engines/customer_policy_read_engine.py,343,Customer policy domain read operations with business logic (pure logic),get_customer_policy_read_service,1,0,BudgetConstraint | RateLimit | GuardrailSummary | PolicyConstraints | CustomerPolicyReadService,5,,,policy_read_driver,,,sqlmodel,L5:customer_policies_adapter | L3:customer_policies_adapter,L3 + L5,customer_policies_adapter.py (L3),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L3 + L5 → THIS(L5) → L6,
policies,L5,L5_engines,decorator,backend/app/hoc/cus/policies/L5_engines/decorator.py,192,Optional ergonomic decorator over ExecutionKernel,governed | _extract_tenant_id | _extract_subject,3,0,,0,,,,,,__future__ | kernel,?:__init__,?,"HTTP route handlers, CLI commands","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,degraded_mode,backend/app/hoc/cus/policies/L5_engines/degraded_mode.py,217,Degraded mode for governance system (pure state logic),enter_degraded_mode | exit_degraded_mode | is_degraded_mode_active | get_degraded_mode_status | should_allow_new_run | get_existing_run_action,6,0,DegradedModeStatus | DegradedModeTransition,2,,,,,,,?:test_degraded_mode,?,"main.py, prevention_engine.py","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,deterministic_engine,backend/app/hoc/cus/policies/L5_engines/deterministic_engine.py,513,Deterministic policy execution engine,,0,0,ExecutionStatus | ExecutionContext | ExecutionResult | DeterministicEngine,4,,,,,,grammar | intent | ir_nodes,L4:dag_executor | ?:worker | ?:__init__ | ?:dag_executor | ?:mypy_zones | ?:test_m20_runtime | ?:apply,? + L4,"policy evaluators, workers","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 → THIS(L5),
policies,L5,L5_engines,dsl_parser,backend/app/hoc/cus/policies/L5_engines/dsl_parser.py,523,Policy DSL text parser (DSL → AST) - pure parsing,parse | parse_condition,2,0,ParseLocation | ParseError | Token | Lexer | Parser,5,,,,,,__future__ | ast,,,policy/compiler,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
policies,L5,L5_engines,eligibility_engine,backend/app/hoc/cus/policies/L5_engines/eligibility_engine.py,836,"Eligibility Engine - pure rules, deterministic gating",,0,0,EligibilityDecision | SystemHealthStatus | EligibilityConfig | CapabilityLookup | GovernanceSignalLookup | SystemHealthLookup | ContractLookup | PreApprovalLookup | DefaultCapabilityLookup | DefaultGovernanceSignalLookup | DefaultSystemHealthLookup | DefaultContractLookup | DefaultPreApprovalLookup | EligibilityInput | RuleResult | EligibilityVerdict | EligibilityEngine,17,,,,,,orchestrator,L4:contract_engine | L4:__init__ | ?:__init__ | ?:contract_service | ?:test_contract_invariants | ?:test_eligibility_invariants | ?:test_founder_review_invariants,? + L4,"L3 (adapters), L2 (governance APIs)","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 → THIS(L5),
policies,L5,L5_engines,engine,backend/app/hoc/cus/policies/L5_engines/engine.py,2843,Policy rule evaluation engine,get_policy_engine,1,0,PolicyEngine,1,,,policy_engine_driver,,,__future__ | decisions | exc | models | routing,?:service | ?:credit_service | ?:governance_service | ?:invoke_audit_driver | ?:job_service | ?:message_service | ?:registry_service | ?:worker_service | ?:agent_invoke | ?:policy,? + L2 + L4 + L5 + L6 + L7,"API routes, workers, services","L5, L6","L1, L2, L3, sqlalchemy (at runtime)",? → THIS(L5) → L6,
policies,L5,L5_engines,failure_mode_handler,backend/app/hoc/cus/policies/L5_engines/failure_mode_handler.py,273,Handle failure modes - default to fail-closed,get_failure_mode | handle_policy_failure | handle_missing_policy | handle_evaluation_error | handle_timeout,5,0,FailureMode | FailureType | FailureDecision,3,,,,,,profile_policy_mode,L5:prevention_engine | ?:prevention_engine | ?:test_failure_mode_handler,? + L5,prevention_engine.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
policies,L5,L5_engines,folds,backend/app/hoc/cus/policies/L5_engines/folds.py,403,Policy constant folding optimizations (pure logic),,0,0,FoldResult | ConstantFolder | DeadCodeEliminator | PolicySimplifier,4,,,,,,ir_nodes,?:__init__ | ?:test_m20_optimizer,?,policy/optimizer,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,governance_facade,backend/app/hoc/cus/policies/L5_engines/governance_facade.py,618,Governance Facade - Centralized access to governance control operations,get_governance_facade,1,0,GovernanceMode | GovernanceStateResult | KillSwitchResult | ConflictResolutionResult | BootStatusResult | GovernanceFacade,6,policy_driver,,,,,runtime_switch,L4:policies_handler,L4,"L2 governance.py API, SDK","L4 domain engines, L6 (models, db)","L1, L2, L3, L5",L4 → THIS(L5) → L5,
policies,L5,L5_engines,grammar,backend/app/hoc/cus/policies/L5_engines/grammar.py,216,Policy language grammar definitions (pure definitions),,0,0,GrammarNodeType | PolicyCategory | ActionType | GrammarProduction | PLangGrammar,5,,,,,,,L5:compiler_parser | L5:deterministic_engine | L5:ir_builder | L5:ir_nodes | L5:nodes | L5:visitors | L6:optimizer_conflict_resolver | L6:symbol_table | L4:dag_executor | L4:dag_sorter,? + L4 + L5 + L6,policy/compiler/parser,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 + L5 + L6 → THIS(L5),
policies,L5,L5_engines,intent,backend/app/hoc/cus/policies/L5_engines/intent.py,365,Policy intent model and declaration,,0,0,IntentType | IntentPayload | Intent | IntentEmitter,4,,,,,,,?:recovery | L2:recovery | L5:deterministic_engine | L4:dag_executor | ?:__init__ | ?:dag_executor | ?:deterministic_engine | ?:test_m20_runtime,? + L2 + L4 + L5,"policy engine, evaluators","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L4 + L5 → THIS(L5),
policies,L5,L5_engines,interpreter,backend/app/hoc/cus/policies/L5_engines/interpreter.py,562,Policy DSL Interpreter (pure IR evaluation),evaluate | evaluate_policy,2,0,EvaluationError | TypeMismatchError | MissingMetricError | ActionResult | ClauseResult | EvaluationResult | Interpreter | _LenientInterpreter | _MissingSentinel,9,,,,,,__future__ | ir_compiler,?:__init__ | ?:test_interpreter | ?:test_replay | ?:test_roundtrip,?,policy engine,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,ir_builder,backend/app/hoc/cus/policies/L5_engines/ir_builder.py,408,Policy intermediate representation builder,,0,0,IRBuilder,1,,,,,,grammar | ir_nodes | nodes | symbol_table | visitors,?:__init__ | ?:test_m20_ir | ?:test_m20_optimizer | ?:test_m20_runtime,?,policy/engine,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,ir_compiler,backend/app/hoc/cus/policies/L5_engines/ir_compiler.py,460,Policy DSL IR Compiler (AST → bytecode) - pure compilation logic,compile_policy | ir_hash,2,0,OpCode | Instruction | CompiledClause | PolicyIR | IRCompiler | OptimizingIRCompiler,6,,,,,,__future__ | ast,?:__init__ | ?:interpreter | L5:interpreter | ?:test_interpreter | ?:test_ir_compiler | ?:test_replay | ?:test_roundtrip,? + L5,policy engine,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
policies,L5,L5_engines,ir_nodes,backend/app/hoc/cus/policies/L5_engines/ir_nodes.py,404,Policy IR node definitions (pure data structures),,0,0,IRType | IRGovernance | IRNode | IRInstruction | IRLoadConst | IRLoadVar | IRStoreVar | IRBinaryOp | IRUnaryOp | IRCompare | IRJump | IRJumpIf | IRCall | IRReturn | IRAction | IRCheckPolicy | IREmitIntent | IRBlock | IRFunction | IRModule,20,,,,,,grammar,L5:deterministic_engine | L5:folds | L5:ir_builder | L6:optimizer_conflict_resolver | L4:dag_executor | L4:dag_sorter | ?:__init__ | ?:ir_builder | ?:conflict_resolver | ?:dag_sorter,? + L4 + L5 + L6,policy/ir/*,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 + L6 → THIS(L5),
policies,L5,L5_engines,kernel,backend/app/hoc/cus/policies/L5_engines/kernel.py,623,Mandatory execution kernel - single choke point for all EXECUTE power,get_enforcement_mode | set_enforcement_mode,2,0,EnforcementMode | InvocationContext | ExecutionResult | ExecutionKernel,4,,,,,,__future__ | execution_envelope,?:__init__ | ?:decorator | ?:main | L5:decorator | ?:recovery_claim_worker | ?:aos,? + L5,"HTTP handlers, CLI dispatchers, SDK wrappers, workers, AUTO_EXECUTE","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
policies,L5,L5_engines,keys_shim,backend/app/hoc/cus/policies/L5_engines/keys_shim.py,152,API Keys domain operations — delegates to L6 driver,get_keys_read_service | get_keys_write_service,2,0,KeysReadService | KeysWriteService,2,,,keys_driver,tenant,apis/keys_driver,sqlmodel,,,,,,THIS(L5) → L6 + L7,
policies,L5,L5_engines,kill_switch,backend/app/hoc/cus/policies/L5_engines/kill_switch.py,223,Runtime kill switch for governance bypass (pure state logic),activate_kill_switch | deactivate_kill_switch | is_kill_switch_active | should_bypass_governance,4,0,KillSwitchStatus | KillSwitchActivation | KillSwitchDeactivation,3,,,,,,,?:test_kill_switch,?,"main.py, prevention_engine.py","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,learning_proof_engine,backend/app/hoc/cus/policies/L5_engines/learning_proof_engine.py,850,"Learning proof generation (graduation gates, regret tracking)",,0,0,PreventionOutcome | PreventionRecord | PreventionTracker | RegretType | RegretEvent | PolicyRegretTracker | GlobalRegretTracker | PatternCalibration | AdaptiveConfidenceSystem | CheckpointPriority | CheckpointConfig | PrioritizedCheckpoint | M25GraduationStatus | PreventionTimeline,14,,,,,,__future__,L5:__init__,L5,"learning workers, policy engines","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L5 → THIS(L5),
policies,L5,L5_engines,lessons_engine,backend/app/hoc/cus/policies/L5_engines/lessons_engine.py,1080,Lessons learned creation and management (domain logic),is_valid_transition | get_threshold_band | get_lessons_learned_engine,3,0,LessonsLearnedEngine,1,,,lessons_driver,,incidents/lessons_driver,orm | prometheus_client | sqlalchemy | sqlmodel | time,?:policy | ?:policy_layer | ?:main | L5:incident_engine | L4:policies_handler | L4:run_governance_facade | ?:run_governance_facade | ?:incident_engine | ?:policies_facade | ?:__init__,? + L4 + L5,"IncidentEngine, Worker runtime, API endpoints","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 → THIS(L5) → L6,
policies,L5,L5_engines,limits,backend/app/hoc/cus/policies/L5_engines/limits.py,157,"Phase-6 Limits derivation (code only, not stored)",derive_limits,1,0,Limits,1,,,,,,,?:aos_cus_integrations | ?:billing_dependencies | ?:__init__ | ?:override | ?:simulate | ?:billing_gate | ?:policies | ?:policy_limits_crud | ?:policy_rules_crud | ?:rate_limits,? + L2 + L4 + L5,"BillingProvider, enforcement middleware","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,limits_facade,backend/app/hoc/cus/policies/L5_engines/limits_facade.py,459,Limits Facade - Centralized access to rate limits and quotas,get_limits_facade,1,0,LimitType | LimitPeriod | LimitConfig | LimitCheckResult | UsageSummary | LimitsFacade,6,,,,,,,L4:policies_handler,L4,"L2 limits.py API, SDK","L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 → THIS(L5),
policies,L5,L5_engines,limits_simulation_service,backend/app/hoc/cus/policies/L5_engines/limits_simulation_service.py,80,Limits simulation service - pre-execution limit checks,get_limits_simulation_service,1,0,,0,,,,,,asyncio | simulation_engine,L4:policies_handler,L4,simulate.py,"L6 (drivers), schemas","L1, L2, L3, sqlalchemy direct",L4 → THIS(L5),
policies,L5,L5_engines,llm_policy_engine,backend/app/hoc/cus/policies/L5_engines/llm_policy_engine.py,442,LLM policy and safety limits enforcement (pure logic),estimate_tokens | estimate_cost_cents | check_safety_limits | is_model_allowed | is_expensive_model | get_model_for_task | get_effective_model,7,0,SafetyCheckResult | LLMRateLimiter,2,,,,,,,?:tenant_config | ?:openai_adapter | L3:openai_adapter | L3:tenant_config,? + L3,"OpenAIAdapter (L3), TenantLLMConfig (L3), llm_invoke skills","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L3 → THIS(L5),
policies,L5,L5_engines,nodes,backend/app/hoc/cus/policies/L5_engines/nodes.py,379,Policy AST node definitions (pure data structures),,0,0,GovernanceMetadata | ASTNode | ExprNode | ProgramNode | PolicyDeclNode | RuleDeclNode | ImportNode | RuleRefNode | PriorityNode | ConditionBlockNode | ActionBlockNode | RouteTargetNode | BinaryOpNode | UnaryOpNode | ValueNode | IdentNode | LiteralNode | FuncCallNode | AttrAccessNode | ASTVisitor,20,,,,,,grammar,L5:compiler_parser | L5:ir_builder | L5:policy_graph_engine | L5:visitors | L4:knowledge_plane | L4:dag_sorter | ?:__init__ | ?:visitors | ?:parser | ?:ir_builder,? + L4 + L5,"policy/compiler, policy/engine","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 → THIS(L5),
policies,L5,L5_engines,phase_status_invariants,backend/app/hoc/cus/policies/L5_engines/phase_status_invariants.py,360,Phase-status invariant enforcement from GovernanceConfig,check_phase_status_invariant | ensure_phase_status_invariant,2,0,InvariantCheckResult | PhaseStatusInvariantEnforcementError | InvariantCheckResponse | PhaseStatusInvariantChecker,4,,,,,,,?:__init__,?,"ROK (L5), worker runtime","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,plan,backend/app/hoc/cus/policies/L5_engines/plan.py,145,"Phase-6 Plan model (abstract, no DB persistence)",,0,0,PlanTier | Plan,2,,,,,,,?:083_s6_lifecycle_aware_immutability | ?:billing_dependencies | ?:guard | ?:billing_gate | ?:evidence_sink | ?:execution_envelope | ?:tenant_auth | ?:__init__ | ?:provider | L2:billing_dependencies,? + L2 + L5 + L6,"BillingProvider, limits derivation","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 → THIS(L5),
policies,L5,L5_engines,plan_generation_engine,backend/app/hoc/cus/policies/L5_engines/plan_generation_engine.py,257,Plan generation (domain logic),generate_plan_for_run,1,0,PlanGenerationContext | PlanGenerationResult | PlanGenerationEngine,3,,,,,,budget_tracker | memory | plan_inspector | planners | skills,?:main,?,"API endpoints (L2), run creation flow","L5, L6","L1, L2, L3",? → THIS(L5),
policies,L5,L5_engines,policies_facade,backend/app/hoc/cus/policies/L5_engines/policies_facade.py,111,Policies facade - unified entry point for policy management,,0,0,,0,,,,,,policies_facade,?:policies | ?:dependency_graph_result | ?:policy_conflict_result | ?:policy_dependency_edge | ?:policy_node_result | L4:policies_handler,? + L4,policies.py (L2 API),L6 (drivers),"L1, L2, L3, sqlalchemy direct",? + L4 → THIS(L5),
policies,L5,L5_engines,policies_limits_query_engine,backend/app/hoc/cus/policies/L5_engines/policies_limits_query_engine.py,318,Limits query engine - read-only operations for limits,get_limits_query_engine,1,0,LimitSummaryResult | LimitsListResult | LimitDetailResult | BudgetDefinitionResult | BudgetsListResult | LimitsQueryEngine,6,,,limits_read_driver,,controls/limits_read_driver,asyncio,,,L2 policies API,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5) → L6,
policies,L5,L5_engines,policies_proposals_query_engine,backend/app/hoc/cus/policies/L5_engines/policies_proposals_query_engine.py,224,Proposals query engine - read-only operations for policy proposals list,get_proposals_query_engine,1,0,PolicyRequestResult | PolicyRequestsListResult | PolicyRequestDetailResult | ProposalsQueryEngine,4,,,proposals_read_driver,,,asyncio,,,L2 policies API,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5) → L6,
policies,L5,L5_engines,policies_rules_query_engine,backend/app/hoc/cus/policies/L5_engines/policies_rules_query_engine.py,246,Policy rules query engine - read-only operations for policy rules,get_policy_rules_query_engine,1,0,PolicyRuleSummaryResult | PolicyRulesListResult | PolicyRuleDetailResult | PolicyRulesQueryEngine,4,,,policy_rules_read_driver,,,asyncio,,,L2 policies API,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5) → L6,
policies,L5,L5_engines,policy_command,backend/app/hoc/cus/policies/L5_engines/policy_command.py,478,Policy evaluation and decision authority,simulate_cost | check_policy_violations | evaluate_policy | _record_policy_decision | _record_capability_violation | _record_budget_rejection | _record_approval_request_created | _record_approval_action | _record_approval_escalation | _record_webhook_fallback | record_approval_created | record_approval_outcome | record_escalation | record_webhook_used,14,3,PolicyViolation | PolicyEvaluationResult | ApprovalConfig,3,,,,,,cost_sim | metrics | policies,L3:policy_adapter | ?:__init__,? + L3,policy_adapter.py (L3),"L4, L5, L6","L1, L2, L3",? + L3 → THIS(L5),
policies,L5,L5_engines,policy_conflict_resolver,backend/app/hoc/cus/policies/L5_engines/policy_conflict_resolver.py,267,Resolve conflicts when multiple policies trigger different actions (pure logic),resolve_policy_conflict | create_conflict_log | get_action_severity | is_more_restrictive,4,0,ActionSeverity | ConflictResolutionStrategy | PolicyAction | ResolvedAction | PolicyConflictLog,5,,,,,,,,,prevention_engine.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
policies,L5,L5_engines,policy_driver,backend/app/hoc/cus/policies/L5_engines/policy_driver.py,415,Policy Domain Driver - Internal orchestration for policy operations,get_policy_driver | reset_policy_driver,2,0,PolicyDriver,1,,,,,,engine,L5:governance_facade | L4:policies_handler | ?:__init__ | ?:policy_driver,? + L4 + L5,"policy_layer API, governance services, worker runtime","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 → THIS(L5),
policies,L5,L5_engines,policy_graph_engine,backend/app/hoc/cus/policies/L5_engines/policy_graph_engine.py,797,Policy conflict detection and dependency graph computation,get_conflict_engine | get_dependency_engine,2,0,ConflictType | ConflictSeverity | DependencyType | PolicyConflict | PolicyDependency | PolicyNode | DependencyGraphResult | ConflictDetectionResult | PolicyConflictEngine | PolicyDependencyEngine,10,,,policy_graph_driver,,,__future__,L5:policy_proposal_engine | ?:dependency_graph_result | ?:policy_conflict_result | ?:policy_dependency_edge | ?:policy_node_result | ?:policies_facade | ?:policy_proposal,? + L5,"policies.py, policy_layer.py","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5) → L6,
policies,L5,L5_engines,policy_limits_engine,backend/app/hoc/cus/policies/L5_engines/policy_limits_engine.py,371,Policy limits CRUD engine (PIN-LIM-01) - pure business logic,,0,0,PolicyLimitsServiceError | LimitNotFoundError | LimitValidationError | ImmutableFieldError | PolicyLimitsService,5,,policy_limits,audit_ledger_service_async | policy_limits_driver,audit_ledger | policy_control_plane,controls/policy_limits_driver | logs/audit_ledger_service_async,asyncio | cross_domain | time,L4:policies_handler,L4,api/policies.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 → THIS(L5) → L5s + L6 + L7,
policies,L5,L5_engines,policy_mapper,backend/app/hoc/cus/policies/L5_engines/policy_mapper.py,490,Map MCP tool invocations to policy gates,get_mcp_policy_mapper | configure_mcp_policy_mapper | reset_mcp_policy_mapper,3,0,MCPPolicyDecisionType | MCPDenyReason | MCPPolicyDecision | MCPToolPolicy | MCPPolicyMapper,5,engine,,,,,,L5:audit_evidence | ?:__init__ | ?:audit_evidence,? + L5,"Runner, skill executor","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5) → L5,
policies,L5,L5_engines,policy_models,backend/app/hoc/cus/policies/L5_engines/policy_models.py,739,Policy domain models and types,,0,0,PolicyCategory | PolicyDecision | ActionType | ViolationType | ViolationSeverity | RecoverabilityType | SafetyRuleType | EthicalConstraintType | BusinessRuleType | PolicyEvaluationRequest | PolicyModification | PolicyEvaluationResult | PolicyViolation | PolicyRule | Policy | RiskCeiling | SafetyRule | EthicalConstraint | BusinessRule | PolicyState | PolicyLoadResult | PolicyVersion | PolicyProvenance | PolicyDependency | PolicyConflict | DependencyGraph | TemporalPolicyType | TemporalPolicy | TemporalMetricWindow | PolicyContext | EnhancedPolicyEvaluationRequest | EnhancedPolicyViolation | EnhancedPolicyEvaluationResult,33,,,,,,pydantic,,,policy/*,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
policies,L5,L5_engines,policy_proposal_engine,backend/app/hoc/cus/policies/L5_engines/policy_proposal_engine.py,713,Policy proposal lifecycle engine - manages proposal state machine,generate_default_rule | get_policy_proposal_engine | check_proposal_eligibility | create_policy_proposal | review_policy_proposal | delete_policy_rule | get_proposal_summary,7,5,PolicyActivationBlockedError | PolicyDeletionBlockedError | PolicyProposalEngine,3,policy_graph_engine,,audit_ledger_service_async | policy_proposal_read_driver | policy_proposal_write_driver,audit_ledger | policy,logs/audit_ledger_service_async,asyncio | time,,,L2 policies API,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5) → L5 + L6 + L7,
policies,L5,L5_engines,policy_rules_engine,backend/app/hoc/cus/policies/L5_engines/policy_rules_engine.py,394,Policy rules CRUD engine (PIN-LIM-02) - pure business logic,,0,0,PolicyRulesServiceError | RuleNotFoundError | RuleValidationError | PolicyRulesService,4,,policy_rules,audit_ledger_service_async | policy_rules_driver,audit_ledger | policy_control_plane,logs/audit_ledger_service_async,asyncio | cross_domain | time,L4:policies_handler,L4,api/policies.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",L4 → THIS(L5) → L5s + L6 + L7,
policies,L5,L5_engines,prevention_engine,backend/app/hoc/cus/policies/L5_engines/prevention_engine.py,521,Policy prevention engine for runtime enforcement,create_policy_snapshot_for_run,1,0,PreventionAction | ViolationType | PreventionContext | PreventionResult | PolicyViolationError | PreventionEngine,6,,,,policy_snapshot,,binding_moment_enforcer | conflict_resolver | db | failure_mode_handler | sqlmodel,L5:authority_checker | L6:arbitrator | L6:scope_resolver | L4:alert_emitter | ?:step_enforcement | L7:monitor_config | L7:override_authority | L7:threshold_signal | ?:__init__ | ?:arbitrator,? + L4 + L5 + L6 + L7,worker/runner.py,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L4 + L5 + L6 + L7 → THIS(L5) → L7,
policies,L5,L5_engines,prevention_hook,backend/app/hoc/cus/policies/L5_engines/prevention_hook.py,302,Prevention hook for policy enforcement,create_prevention_hook | get_prevention_hook | evaluate_response,3,0,PreventionAction | PreventionContext | PreventionResult | PreventionHook,4,,,,,,content_accuracy,?:__init__,?,"workers, execution runtime","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,protection_provider,backend/app/hoc/cus/policies/L5_engines/protection_provider.py,388,Phase-7 AbuseProtectionProvider protocol and MockAbuseProtectionProvider,get_protection_provider | set_protection_provider,2,0,AbuseProtectionProvider | MockAbuseProtectionProvider,2,,,,,,billing | decisions,,,"protection middleware, SDK endpoints, runtime paths","L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
policies,L5,L5_engines,recovery_evaluation_engine,backend/app/hoc/cus/policies/L5_engines/recovery_evaluation_engine.py,411,Recovery evaluation decision-making (domain logic),evaluate_recovery | evaluate_and_execute,2,1,FailureContext | RecoveryDecision | RecoveryEvaluationEngine,3,recovery_rule_engine,,recovery_matcher,,incidents/recovery_rule_engine,decisions | recovery_evaluator,?:recovery_evaluator | ?:test_m10_recovery_enhanced,?,"API endpoints, failure processing pipeline","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5) → L5 + L6,
policies,L5,L5_engines,runtime_command,backend/app/hoc/cus/policies/L5_engines/runtime_command.py,561,Runtime domain commands and query logic (pure logic),get_supported_query_types | query_remaining_budget | query_execution_history | query_allowed_skills | query_last_step_outcome | query_skills_for_goal | execute_query | get_skill_info | list_skills | get_all_skill_descriptors | get_resource_contract | get_capabilities,12,0,QueryResult | SkillInfo | ResourceContractInfo | CapabilitiesInfo,4,,,,,,,L3:runtime_adapter | ?:runtime | ?:__init__ | L2:runtime | L5:runtime_adapter | L4:runtime_adapter,? + L2 + L3 + L4 + L5,runtime_adapter.py (L3),"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L2 + L3 + L4 + L5 → THIS(L5),
policies,L5,L5_engines,sandbox_engine,backend/app/hoc/cus/policies/L5_engines/sandbox_engine.py,551,High-level sandbox engine with policy enforcement (pure business logic),,0,0,SandboxPolicy | ExecutionRequest | ExecutionRecord | SandboxService,4,,,,,,sandbox_executor,,,"Runtime, API routes, Skill executors","L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
policies,L5,L5_engines,snapshot_engine,backend/app/hoc/cus/policies/L5_engines/snapshot_engine.py,594,Policy snapshot immutability engine (pure business logic),get_snapshot_registry | _reset_snapshot_registry | create_policy_snapshot | get_policy_snapshot | get_active_snapshot | get_snapshot_history | verify_snapshot,7,0,SnapshotStatus | ImmutabilityViolation | PolicySnapshotData | PolicySnapshotError | SnapshotRegistryStats | PolicySnapshotRegistry,6,,,,,,,,,"L4 orchestrators, policy engines","L5, L6","L1, L2, L3, sqlalchemy (runtime)",THIS(L5),
policies,L5,L5_engines,state,backend/app/hoc/cus/policies/L5_engines/state.py,108,Phase-6 Billing State enum (pure enum definitions),,0,0,BillingState,1,,,,,,,L3:customer_killswitch_adapter | L3:webhook_adapter | L3:platform_eligibility_adapter | ?:agents | ?:billing_dependencies | ?:incidents | ?:billing_gate | ?:lifecycle_gate | ?:console_auth | ?:gateway_config,? + L2 + L3 + L4 + L5 + L6,"BillingProvider, Tenant model (when extended), billing middleware","L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L3 → THIS(L5),
policies,L5,L5_engines,tokenizer,backend/app/hoc/cus/policies/L5_engines/tokenizer.py,352,Policy language tokenizer (pure lexical analysis),,0,0,TokenType | Token | TokenizerError | Tokenizer,4,,,,,,,L5:compiler_parser | ?:__init__ | ?:parser | ?:test_m20_parser,? + L5,policy/compiler/parser,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
policies,L5,L5_engines,validator,backend/app/hoc/cus/policies/L5_engines/validator.py,386,Policy DSL semantic validator (pure validation logic),validate | is_valid,2,0,Severity | ValidationIssue | ValidationResult | PolicyValidator,4,,,,,,__future__ | ast,?:__init__ | ?:service | ?:test_roundtrip | ?:test_validator,?,policy engine,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? → THIS(L5),
policies,L5,L5_engines,visitors,backend/app/hoc/cus/policies/L5_engines/visitors.py,307,Policy AST visitor pattern implementations,,0,0,BaseVisitor | PrintVisitor | CategoryCollector | RuleExtractor,4,,,,,,grammar | nodes,L5:ir_builder | ?:__init__ | ?:ir_builder | ?:test_m20_parser,? + L5,policy/engine,"L5, L6","L1, L2, L3, sqlalchemy (runtime)",? + L5 → THIS(L5),
policies,L5,L5_engines,worker_execution_command,backend/app/hoc/cus/policies/L5_engines/worker_execution_command.py,353,Worker execution authorization and delegation,calculate_cost_cents | get_brand_schema_types | convert_brand_request | execute_worker | replay_execution,5,2,WorkerExecutionResult | ReplayResult,2,,,,,,brand | runner | worker,L3:workers_adapter | ?:__init__ | L5:workers_adapter,? + L3 + L5,workers_adapter.py (L3),"L4, L5, L6","L1, L2, L3",? + L3 + L5 → THIS(L5),
policies,L5,L5_schemas,policy_rules,backend/app/hoc/cus/policies/L5_schemas/policy_rules.py,160,Policy rules request/response schemas,,0,0,EnforcementModeEnum | PolicyScopeEnum | PolicySourceEnum | CreatePolicyRuleRequest | UpdatePolicyRuleRequest | PolicyRuleResponse,6,,,,,,pydantic,?:policy_rules_crud | L2:policy_rules_crud | L5:policy_rules_engine | ?:__init__ | ?:policy_rules_service,? + L2 + L5,"api/policies.py, services/limits/policy_rules_service.py",None (foundational),"L1, L2, L3, L4, L5",? + L2 + L5 → THIS(L5),
policies,L6,L6_drivers,arbitrator,backend/app/hoc/cus/policies/L6_drivers/arbitrator.py,339,Resolve conflicts between multiple applicable policies,get_policy_arbitrator,1,0,PolicyLimit | PolicyAction | ArbitrationInput | PolicyArbitrator,4,,,,policy_precedence,,db | sqlmodel,L7:policy_precedence | ?:test_control_action_enhancements,? + L7,"policy/prevention_engine.py, worker/runner.py","L6, L7 (models)",,? + L7 → THIS(L6) → L7,
policies,L6,L6_drivers,optimizer_conflict_resolver,backend/app/hoc/cus/policies/L6_drivers/optimizer_conflict_resolver.py,390,Policy conflict resolution,,0,0,ConflictType | PolicyConflict | ConflictResolver,3,,,,,,grammar | ir_nodes,,,policy/engine,"L6, L7 (models)","L1, L2, L3, L5",THIS(L6),
policies,L6,L6_drivers,policy_engine_driver,backend/app/hoc/cus/policies/L6_drivers/policy_engine_driver.py,1411,Policy Engine data access operations,get_policy_engine_driver,1,0,PolicyEngineDriver,1,,,,,,engine | sqlalchemy,L5:engine,L5,engine.py (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6),
policies,L6,L6_drivers,policy_graph_driver,backend/app/hoc/cus/policies/L6_drivers/policy_graph_driver.py,226,Policy graph data access operations,get_policy_graph_driver,1,0,PolicyGraphDriver,1,,,,,,asyncio | sqlalchemy,L5:policy_graph_engine,L5,policy_graph_engine.py (L5 engine),"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 → THIS(L6),
policies,L6,L6_drivers,policy_proposal_read_driver,backend/app/hoc/cus/policies/L6_drivers/policy_proposal_read_driver.py,201,Read operations for policy proposal engine,get_policy_proposal_read_driver,1,0,PolicyProposalReadDriver,1,,,,feedback | policy,,asyncio | sqlalchemy,L5:policy_proposal_engine | L6:__init__,L5 + L6,L5 policy_proposal_engine,"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 + L6 → THIS(L6) → L7,
policies,L6,L6_drivers,policy_proposal_write_driver,backend/app/hoc/cus/policies/L6_drivers/policy_proposal_write_driver.py,229,Write operations for policy proposal engine,get_policy_proposal_write_driver,1,0,PolicyProposalWriteDriver,1,,,,policy,,asyncio | sqlalchemy | time,L5:policy_proposal_engine | L6:__init__,L5 + L6,L5 policy_proposal_engine,"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 + L6 → THIS(L6) → L7,
policies,L6,L6_drivers,policy_read_driver,backend/app/hoc/cus/policies/L6_drivers/policy_read_driver.py,243,Data access for customer policy read operations,get_policy_read_driver,1,0,TenantBudgetDataDTO | UsageSumDTO | GuardrailDTO | PolicyReadDriver,4,,,,killswitch | tenant,,pydantic | sqlalchemy | sqlmodel,L5:customer_policy_read_engine | L6:__init__,L5 + L6,policy engines (L5),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 + L6 → THIS(L6) → L7,
policies,L6,L6_drivers,policy_rules_driver,backend/app/hoc/cus/policies/L6_drivers/policy_rules_driver.py,117,Data access for policy rules CRUD operations,get_policy_rules_driver,1,0,PolicyRulesDriver,1,,,,policy_control_plane,,asyncio | sqlalchemy,L5:policy_rules_engine,L5,policy_rules_service.py (L5 engine),"L6, L7 (models)","L1, L2, L3, L4, L5",L5 → THIS(L6) → L7,
policies,L6,L6_drivers,policy_rules_read_driver,backend/app/hoc/cus/policies/L6_drivers/policy_rules_read_driver.py,256,Read operations for policy rules,get_policy_rules_read_driver,1,0,PolicyRulesReadDriver,1,,,,policy_control_plane,,asyncio | sqlalchemy | time,L5:policies_rules_query_engine | L6:__init__,L5 + L6,L5 policies_rules_query_engine,"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 + L6 → THIS(L6) → L7,
policies,L6,L6_drivers,proposals_read_driver,backend/app/hoc/cus/policies/L6_drivers/proposals_read_driver.py,205,Read operations for policy proposals (list view),get_proposals_read_driver,1,0,ProposalsReadDriver,1,,,,policy,,asyncio | sqlalchemy | time,L5:policies_proposals_query_engine | L6:__init__,L5 + L6,L5 policies_proposals_query_engine,"L7 (models), sqlalchemy","L1, L2, L3, L4, L5",L5 + L6 → THIS(L6) → L7,
policies,L6,L6_drivers,recovery_matcher,backend/app/hoc/cus/policies/L6_drivers/recovery_matcher.py,953,Match failure patterns and generate recovery suggestions — L6 DOES NOT COMMIT,,0,0,MatchResult | RecoveryMatcher,2,,,,,,httpx | infra | redis | sanitize | sqlalchemy | sqlmodel | vector_store,?:recovery | ?:workers | L2:workers | L2:recovery | L5:recovery_evaluation_engine | ?:worker | ?:recovery_matcher | ?:__init__ | ?:recovery_evaluation_engine | ?:check_priority5_intent,? + L2 + L5,"L5 engines (must provide session, must own transaction boundary)","L6, L7 (models)",,? + L2 + L5 → THIS(L6),
policies,L6,L6_drivers,recovery_write_driver,backend/app/hoc/cus/policies/L6_drivers/recovery_write_driver.py,265,DB write driver for Recovery APIs (DB boundary crossing),,0,0,RecoveryWriteService,1,,,,,,infra | sqlalchemy | sqlmodel,L2:recovery | L2:recovery_ingest,L2,"L5 engines, api/recovery_ingest.py, api/recovery.py","L6, L7 (models)","L1, L2, L3, L4, L5",L2 → THIS(L6),
policies,L6,L6_drivers,scope_resolver,backend/app/hoc/cus/policies/L6_drivers/scope_resolver.py,259,Resolve which policies apply to a given run context,get_scope_resolver,1,0,RunContext | ScopeResolutionResult | ScopeResolver,3,,,,policy_scope,,db | sqlmodel,L7:policy_scope | ?:test_export_scope_resolution | ?:test_scope_selector,? + L7,"policy/prevention_engine.py, worker/runner.py","L6, L7 (models)","L1, L2, L3",? + L7 → THIS(L6) → L7,
policies,L6,L6_drivers,symbol_table,backend/app/hoc/cus/policies/L6_drivers/symbol_table.py,309,Policy symbol table management,,0,0,SymbolType | Symbol | Scope | SymbolTable,4,,,,,,grammar,L5:ir_builder | ?:__init__ | ?:ir_builder | ?:test_m20_ir,? + L5,policy/ir/ir_builder,"L6, L7 (models)","L1, L2, L3, L5",? + L5 → THIS(L6),
